"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8163],{8163:(Se,G,k)=>{k.r(G),k.d(G,{AddTodoMenuPageModule:()=>Re});var $=k(177),R=k(4341),I=k(5374),S=k(9858),b=k(467),A=k(8326),j=k(7892),F=k(4237),w=k(9349),M=k(736),N=k(8902),D=k(5402),B=k(7920),t=k(3953),E=k(3656),L=k(4234),U=k(9900),V=k(345),W=k(755),X=k(5547),Y=k(8065),J=k(482);const z=["StartCalendar"],K=["Calendar"],H=["StoreAt"],Q=["ImporantSel"];function Z(c,_){if(1&c){const o=t.RV6();t.j41(0,"ion-grid",44)(1,"ion-row")(2,"ion-col",45)(3,"ion-item",46),t.bIt("click",function(){t.eBV(o);const i=t.XpG();return t.Njj(i.doneTodo())}),t.j41(4,"ion-label",47),t.EFF(5),t.k0s()()()()()}if(2&c){const o=t.XpG();t.R7$(3),t.Y8G("disabled",o.isButtonClicked),t.R7$(2),t.JRh(o.lang.text.TodoDetail.TodoComplete)}}function q(c,_){if(1&c&&(t.j41(0,"ion-select-option",52),t.EFF(1),t.k0s()),2&c){const o=_.$implicit;t.Y8G("value",o),t.R7$(),t.SpI("",o.name," ")}}function ee(c,_){if(1&c){const o=t.RV6();t.j41(0,"ion-item",48),t.bIt("click",function(){t.eBV(o);const i=t.XpG();return t.Njj(i.StoreAtSelClicked())}),t.j41(1,"ion-select",49,3),t.bIt("ionChange",function(i){t.eBV(o);const l=t.XpG();return t.Njj(l.StoreAtSelChanged(i))}),t.j41(3,"ion-select-option",50),t.EFF(4),t.k0s(),t.DNE(5,q,2,2,"ion-select-option",51),t.k0s()()}if(2&c){const o=t.XpG();t.R7$(),t.Y8G("label",o.lang.text.TodoDetail.StoreAt),t.R7$(3),t.JRh(o.lang.text.TodoDetail.OnThisDevice),t.R7$(),t.Y8G("ngForOf",o.AvailableStorageList)}}function te(c,_){if(1&c){const o=t.RV6();t.j41(0,"div")(1,"ion-item",48),t.bIt("click",function(){t.eBV(o);const i=t.XpG();return t.Njj(i.ChangeDisconnectStatus())}),t.j41(2,"ion-label",53),t.EFF(3),t.k0s(),t.j41(4,"ion-label",54),t.EFF(5),t.k0s()()()}if(2&c){const o=t.XpG();t.R7$(3),t.JRh(o.userInput.display_store||o.lang.text.TodoDetail.WIP),t.R7$(2),t.JRh(o.userInput.display_creator)}}function ie(c,_){if(1&c){const o=t.RV6();t.j41(0,"ion-icon",55),t.bIt("click",function(){t.eBV(o);const i=t.XpG();return t.Njj(i.SpeechToTitleText())}),t.k0s()}}function ae(c,_){if(1&c){const o=t.RV6();t.j41(0,"ion-item")(1,"ion-checkbox",56),t.mxI("ngModelChange",function(i){const l=t.eBV(o).$implicit;return t.DH7(l.todo_checked,i)||(l.todo_checked=i),t.Njj(i)}),t.EFF(2),t.k0s()()}if(2&c){const o=_.$implicit;t.R7$(),t.R50("ngModel",o.todo_checked),t.R7$(),t.JRh(o.override_name||o.display_name)}}function ne(c,_){if(1&c){const o=t.RV6();t.j41(0,"ion-accordion",52)(1,"ion-item",30)(2,"ion-label"),t.EFF(3),t.k0s()(),t.j41(4,"div",33)(5,"ion-item",21),t.bIt("click",function(){const i=t.eBV(o).$implicit,l=t.XpG(2);return t.Njj(l.toggle_all_user(i.id))}),t.j41(6,"ion-label"),t.EFF(7),t.k0s()(),t.DNE(8,ae,3,2,"ion-item",36),t.k0s()()}if(2&c){const o=_.$implicit,e=t.XpG(2);t.Y8G("value",o.id),t.R7$(3),t.JRh(o.name),t.R7$(4),t.JRh(e.lang.text.TodoDetail.ToggleWorkers),t.R7$(),t.Y8G("ngForOf",e.AvailableWorker[o.id])}}function oe(c,_){if(1&c&&(t.j41(0,"div")(1,"ion-accordion-group",null,4)(3,"ion-accordion")(4,"ion-item",30)(5,"ion-label"),t.EFF(6),t.k0s()(),t.j41(7,"div",33)(8,"ion-accordion-group",null,5),t.DNE(10,ne,9,4,"ion-accordion",51),t.k0s()()()()()),2&c){const o=t.XpG();t.R7$(6),t.JRh(o.lang.text.TodoDetail.ManageWorker),t.R7$(4),t.Y8G("ngForOf",o.WorkerGroups)}}function re(c,_){if(1&c&&(t.j41(0,"div",64),t.EFF(1),t.k0s()),2&c){const o=t.XpG().$implicit;t.R7$(),t.JRh(o.displayTime)}}function se(c,_){1&c&&t.nrm(0,"ion-icon",65)}function le(c,_){1&c&&t.nrm(0,"ion-icon",66)}function ue(c,_){1&c&&t.nrm(0,"ion-icon",67)}function de(c,_){if(1&c&&(t.j41(0,"ion-item",59)(1,"ion-label"),t.EFF(2),t.k0s(),t.DNE(3,re,2,1,"div",60)(4,se,1,0,"ion-icon",61)(5,le,1,0,"ion-icon",62)(6,ue,1,0,"ion-icon",63),t.k0s()),2&c){const o=_.$implicit;t.R7$(2),t.JRh(o.name),t.R7$(),t.Y8G("ngIf",o.displayTime),t.R7$(),t.Y8G("ngIf",void 0===o.isDelete),t.R7$(),t.Y8G("ngIf",1==o.isDelete),t.R7$(),t.Y8G("ngIf",0==o.isDelete)}}function ce(c,_){if(1&c&&(t.j41(0,"div")(1,"ion-accordion-group",null,4)(3,"ion-accordion")(4,"ion-item",30)(5,"ion-label"),t.EFF(6),t.k0s(),t.j41(7,"ion-label",57),t.EFF(8),t.k0s()(),t.j41(9,"div",33),t.DNE(10,de,7,5,"ion-item",58),t.k0s()()()()),2&c){const o=t.XpG();t.R7$(6),t.JRh(o.lang.text.TodoDetail.ManageWorker),t.R7$(2),t.JRh(o.worker_done+" / "+o.userInput.workers.length),t.R7$(2),t.Y8G("ngForOf",o.userInput.workers)}}function he(c,_){if(1&c){const o=t.RV6();t.j41(0,"ion-accordion",68)(1,"ion-item",30)(2,"ion-label"),t.EFF(3),t.k0s(),t.j41(4,"ion-label",31),t.EFF(5),t.k0s(),t.nrm(6,"ion-icon",32),t.k0s(),t.j41(7,"div",33)(8,"ion-datetime",34,6),t.bIt("ionChange",function(i){t.eBV(o);const l=t.XpG();return t.Njj(l.start_change(i))}),t.k0s()()()}if(2&c){const o=t.XpG();t.R7$(3),t.JRh(o.lang.text.TodoDetail.startFrom),t.R7$(2),t.JRh(o.startDisplay||o.lang.text.TodoDetail.startImmediatly),t.R7$(3),t.Y8G("locale",o.lang.lang)}}function pe(c,_){if(1&c){const o=t.RV6();t.j41(0,"ion-item-divider")(1,"ion-label"),t.EFF(2),t.k0s(),t.j41(3,"ion-icon",55),t.bIt("click",function(){t.eBV(o);const i=t.XpG();return t.Njj(i.SpeechToDetailText())}),t.k0s()()}if(2&c){const o=t.XpG();t.R7$(2),t.JRh(o.lang.text.TodoDetail.description)}}function me(c,_){if(1&c){const o=t.RV6();t.j41(0,"ion-button",48),t.bIt("click",function(){t.eBV(o);const i=t.XpG().index,l=t.XpG();return t.Njj(l.remove_attach(i))}),t.EFF(1),t.k0s()}if(2&c){const o=t.XpG(2);t.R7$(),t.SpI(" ",o.lang.text.ChatRoom.Delete," ")}}function _e(c,_){if(1&c){const o=t.RV6();t.j41(0,"img",72),t.bIt("contextmenu",function(){t.eBV(o);const i=t.XpG(2),l=i.$implicit,a=i.index,u=t.XpG();return t.Njj(u.AttachmentContextMenu(l,a))}),t.k0s()}if(2&c){const o=t.XpG(2).$implicit;t.Y8G("src",o.thumbnail,t.B4B)("alt",o.filename)}}function ge(c,_){if(1&c&&(t.j41(0,"ion-item",73)(1,"ion-label",53),t.EFF(2),t.k0s()()),2&c){const o=t.XpG(3);t.R7$(2),t.JRh(o.lang.text.TodoDetail.open_content_viewer)}}function fe(c,_){if(1&c){const o=t.RV6();t.j41(0,"div",48),t.bIt("click",function(){t.eBV(o);const i=t.XpG().index,l=t.XpG();return t.Njj(l.open_content_viewer(i))}),t.DNE(1,_e,1,2,"img",70)(2,ge,3,1,"ion-item",71),t.k0s()}if(2&c){const o=t.XpG().$implicit;t.R7$(),t.Y8G("ngIf",o.thumbnail),t.R7$(),t.Y8G("ngIf",!o.thumbnail)}}function Ie(c,_){if(1&c&&(t.j41(0,"div")(1,"ion-item")(2,"ion-label",69),t.EFF(3),t.k0s(),t.DNE(4,me,2,1,"ion-button",17),t.k0s(),t.DNE(5,fe,3,2,"div",17),t.k0s()),2&c){const o=_.$implicit,e=t.XpG();t.R7$(3),t.JRh(o.filename),t.R7$(),t.Y8G("ngIf",e.isModifiable),t.R7$(),t.Y8G("ngIf",o.viewer)}}function be(c,_){if(1&c&&(t.j41(0,"ion-label",76),t.EFF(1),t.k0s()),2&c){const o=t.XpG(2);t.R7$(),t.JRh(o.DisplayDBSelectedName)}}function ke(c,_){if(1&c&&t.nrm(0,"ion-icon",77),2&c){const o=t.XpG(2);t.Y8G("name",o.DisplayDBSelector)}}function ye(c,_){if(1&c){const o=t.RV6();t.j41(0,"ion-item",21),t.bIt("click",function(){t.eBV(o);const i=t.XpG();return t.Njj(i.toggle_custom_attach())}),t.j41(1,"ion-label"),t.EFF(2),t.k0s(),t.DNE(3,be,2,1,"ion-label",74)(4,ke,1,1,"ion-icon",75),t.k0s()}if(2&c){const o=t.XpG();t.R7$(2),t.JRh(o.lang.text.TodoDetail.attachments),t.R7$(),t.Y8G("ngIf",o.isCDNToggleAvailable),t.R7$(),t.Y8G("ngIf",o.isCDNToggleAvailable)}}function ve(c,_){if(1&c&&t.nrm(0,"ion-icon",82),2&c){const o=t.XpG().$implicit;t.Y8G("name",o.icon||"close-circle")}}function Te(c,_){if(1&c&&t.nrm(0,"img",83),2&c){const o=t.XpG().$implicit;t.Y8G("src","assets/icon/"+o.icon_img,t.B4B)("alt",o.title)}}function xe(c,_){if(1&c){const o=t.RV6();t.j41(0,"div",78)(1,"div",79),t.bIt("click",function(){const i=t.eBV(o).$implicit;return t.Njj(i.act())}),t.DNE(2,ve,1,1,"ion-icon",80)(3,Te,1,2,"img",81),t.j41(4,"div"),t.EFF(5),t.k0s()()()}if(2&c){const o=_.$implicit;t.R7$(),t.Aen("cursor: "+(o.cursor||"pointer")+";"),t.Y8G("hidden",o.isHide),t.R7$(),t.Y8G("ngIf",o.icon),t.R7$(),t.Y8G("ngIf",o.icon_img),t.R7$(2),t.JRh(o.name)}}function De(c,_){if(1&c){const o=t.RV6();t.j41(0,"td")(1,"ion-button",84),t.bIt("click",function(){t.eBV(o);const i=t.XpG();return t.Njj(i.deleteData())}),t.EFF(2),t.k0s()()}if(2&c){const o=t.XpG();t.R7$(),t.Y8G("disabled",o.isButtonClicked),t.R7$(),t.SpI(" ",o.lang.text.TodoDetail.remove," ")}}const Ce=[{path:"",component:(()=>{var c;class _{constructor(e,i,l,a,u,n,r,s,d,h,p,f,g,T){var v,m=this;this.route=e,this.router=i,this.modalCtrl=l,this.lang=a,this.p5toast=u,this.sanitizer=n,this.indexed=r,this.nakama=s,this.alertCtrl=d,this.noti=h,this.statusBar=p,this.loadingCtrl=f,this.global=g,this.navCtrl=T,this.userInput={id:void 0,storeAt:"local",display_store:"",title:void 0,create_at:void 0,written:void 0,startFrom:void 0,limit:void 0,custom_color:void 0,workers:void 0,importance:"0",description:void 0,remote:void 0,display_creator:void 0,attach:[],done:void 0,noti_id:void 0},this.isMobile=!1,this.useVoiceRecording=!1,this.extended_buttons=[{icon:"document-attach-outline",name:this.lang.text.ChatRoom.attachments,act:(v=(0,b.A)(function*(){if(!m.isButtonClicked)try{return void(yield m.new_attach({detail:{value:"link"}}))}catch(y){"done"!=y&&m.new_attach({detail:{value:"load"}})}}),function(){return v.apply(this,arguments)})},{icon_img:"voidDraw.png",name:this.lang.text.ChatRoom.voidDraw,act:function(){var v=(0,b.A)(function*(){m.isButtonClicked||m.modalCtrl.create({component:M.c,componentProps:{},cssClass:"fullscreen"}).then(C=>{m.global.StoreShortCutAct("add-todo"),C.onWillDismiss().then(function(){var O=(0,b.A)(function*(P){P.data&&(yield m.voidDraw_fileAct_callback(P,void 0))});return function(P){return O.apply(this,arguments)}}()),C.onDidDismiss().then(()=>{m.global.RestoreShortCutAct("add-todo")}),delete m.global.p5key.KeyShortCut.Escape,C.present()})});return function(){return v.apply(this,arguments)}}()},{icon:"reader-outline",name:this.lang.text.ChatRoom.newText,act:function(){var v=(0,b.A)(function*(){let y={info:{content:{is_new:void 0,type:"text/plain",viewer:"text",filename:void 0,path:void 0}},no_edit:void 0};y.info.content.is_new="text",y.info.content.filename=m.global.TextEditorNewFileName(),y.no_edit=!0,m.modalCtrl.create({component:j.c,componentProps:y}).then(x=>{m.global.StoreShortCutAct("add-todo"),x.onWillDismiss().then(C=>{if(C.data){let O=m.global.TextEditorAfterAct(C.data,{display_name:m.nakama.users.self.display_name});m.userInput.attach.push(O)}}),x.onDidDismiss().then(()=>{m.global.RestoreShortCutAct("add-todo")}),delete m.global.p5key.KeyShortCut.Escape,x.present()})});return function(){return v.apply(this,arguments)}}()},{icon:"camera-outline",name:this.lang.text.ChatRoom.Camera,act:function(){var v=(0,b.A)(function*(){if(!m.isButtonClicked)try{let y=yield m.global.from_camera("tmp_files/post/",{user_id:"local"==m.userInput.storeAt?void 0:m.nakama.servers[m.userInput.remote.isOfficial][m.userInput.remote.target].session.user_id,display_name:m.nakama.users.self.display_name});m.userInput.attach.push(y)}catch(y){console.log("\ucd2c\uc601 \uc2e4\ud328: ",y),m.p5toast.show({text:`${m.lang.text.GlobalAct.ErrorFromCamera}: ${y}`})}});return function(){return v.apply(this,arguments)}}()},{icon:"mic-circle-outline",name:this.lang.text.ChatRoom.Voice,act:function(){var v=(0,b.A)(function*(){m.isButtonClicked||(m.useVoiceRecording=!m.useVoiceRecording,m.useVoiceRecording?(yield D.R.hasAudioRecordingPermission()).value?(m.extended_buttons[4].icon="stop-circle-outline",m.p5toast.show({text:m.lang.text.ChatRoom.StartVRecord}),yield D.R.startRecording()):(m.useVoiceRecording=!1,m.extended_buttons[4].icon="mic-circle-outline",yield D.R.requestAudioRecordingPermission()):yield m.StopAndSaveVoiceRecording())});return function(){return v.apply(this,arguments)}}()}],this.BackButtonPressed=!1,this.buttonDisplay={saveTodo:this.lang.text.TodoDetail.buttonDisplay_add},this.AmICreator=!0,this.isModify=!1,this.isModifiable=!1,this.isStoreAtChanged=!1,this.isStoreAtChangable=!0,this.isLimitUsable=!1,this.normal_color="#8888",this.alert_color="#0bb8",this.AlertLerpStartFrom=.8,this.input_ele_ids=[],this.file_sel_id="",this.AvailableStorageList=[],this.isManager=!1,this.AvailableWorker={},this.WorkerGroups=[],this.toggle_logs={},this.worker_done=0,this.lock_modal_open=!1,this.useFirstCustomCDN=0,this.isCDNToggleClicked=!1,this.isCDNToggleAvailable=!0,this.isButtonClicked=!1,this.WillLeavePage=!1}StopAndSaveVoiceRecording(){var e=this;return(0,b.A)(function*(){let i=yield e.loadingCtrl.create({message:e.lang.text.AddPost.SavingRecord});i.present();try{let l=yield D.R.stopRecording(),a=e.global.Base64ToBlob(`${l.value.mimeType},${l.value.recordDataBase64}`);a.name=`${e.lang.text.ChatRoom.VoiceRecord}.${l.value.mimeType.split("/").pop().split(";")[0]}`,a.type_override=l.value.mimeType,yield e.selected_blobFile_callback_act(a),i.dismiss()}catch(l){e.p5toast.show({text:`${e.lang.text.AddPost.FailedToSaveVoice}:${l}`}),i.dismiss()}e.extended_buttons[4].icon="mic-circle-outline",e.extended_buttons[4].name=e.lang.text.ChatRoom.Voice})()}ngOnInit(){var e=this;if(window.history.pushState(null,null,window.location.href),window.onpopstate=()=>{this.BackButtonPressed||(window.onpopstate=null,this.BackButtonPressed=!0,this.navCtrl.back())},this.MainDiv=document.getElementById("main_div"),this.isMobile="Android"==w.aH||"iOS"==w.aH,this.route.queryParams.subscribe(i=>{const l=this.router.getCurrentNavigation().extras.state;l&&(this.received_data=l.data),this.received_data&&(this.userInput={...this.userInput,...JSON.parse(this.received_data)})}),this.nakama.AddTodoLinkAct=function(){var i=(0,b.A)(function*(l){e.p5timer&&e.p5timer.remove(),e.received_data=l,e.userInput=JSON.parse(e.received_data),yield e.ionViewWillEnter(),e.show_count_timer()});return function(l){return i.apply(this,arguments)}}(),this.nakama.AddTodoManageUpdateAct=(i,l,a,u)=>{if(this.userInput.id==i)for(let n=0,r=this.userInput.workers.length;n<r;n++)if((this.userInput.workers[n].user_id||this.userInput.workers[n].id)==l){this.userInput.workers[n].isDelete=a,this.userInput.workers[n].timestamp=u,this.userInput.workers[n].displayTime=new Date(u).toLocaleString(),this.worker_done++;break}},"DesktopPWA"==w.aH&&setTimeout(()=>{this.CreateDrop()},100),this.userInput.workers)for(let i=0,l=this.userInput.workers.length;i<l;i++)this.userInput.workers[i].timestamp&&(this.userInput.workers[i].displayTime=new Date(this.userInput.workers[i].timestamp).toLocaleString(),this.worker_done++);this.nakama.StatusBarChangedCallback=()=>{if(this.isModify){if(this.LoadStorageList(),this.userInput.remote)try{let i=!1;for(let l=0,a=this.AvailableStorageList.length;l<a;l++)if(this.AvailableStorageList[l].type==`${this.userInput.remote.isOfficial}/${this.userInput.remote.target}`){i=!0;break}this.isModifiable=i,this.userInput.display_creator=i?this.nakama.GetOverrideName(this.userInput.remote.creator_id,this.userInput.remote.isOfficial,this.userInput.remote.target)||this.nakama.load_other_user(this.userInput.remote.creator_id,this.userInput.remote.isOfficial,this.userInput.remote.target).display_name:this.lang.text.TodoDetail.Disconnected}catch{}}else this.LoadStorageList()}}ChangeDisconnectStatus(){var i,e=this;this.userInput.display_creator==this.lang.text.TodoDetail.Disconnected&&this.alertCtrl.create({header:this.lang.text.TodoDetail.MoveToLocal,message:this.lang.text.TodoDetail.RemoveFromRemote,buttons:[{text:this.lang.text.Nakama.LocalNotiOK,cssClass:"redfont",handler:(i=(0,b.A)(function*(){e.isButtonClicked=!0,yield e.nakama.deleteTodoFromStorage(!0,JSON.parse(JSON.stringify(e.userInput))),e.StoreAtSelChanged({detail:{value:"local"}}),e.isModify=!1,e.userInput.id=void 0,e.userInput.noti_id=void 0,e.userInput.create_at=void 0,delete e.userInput.modified,e.saveData()}),function(){return i.apply(this,arguments)})}]}).then(i=>i.present())}CreateDrop(){var e=this;let i=document.getElementById("p5Drop_todo");this.p5canvas=new A(l=>{l.setup=()=>{let a=l.createCanvas(i.clientWidth,i.clientHeight);a.parent(i),l.pixelDensity(.1),a.drop(function(){var u=(0,b.A)(function*(n){yield e.selected_blobFile_callback_act(n.file)});return function(n){return u.apply(this,arguments)}}())},l.mouseMoved=a=>{a.dataTransfer?(i.style.pointerEvents="all",i.style.backgroundColor="#0008"):(i.style.pointerEvents="none",i.style.backgroundColor="transparent")}})}selected_blobFile_callback_act(e){var i=this;return(0,b.A)(function*(){let l=yield i.loadingCtrl.create({message:i.lang.text.TodoDetail.WIP});l.present();let a=i.global.selected_blobFile_callback_act(e,"tmp_files/todo/",{display_name:i.nakama.users.self.display_name});yield i.checkHasSameFileAndRename(a);let u=URL.createObjectURL(e);"image"==a.viewer&&(a.thumbnail=i.sanitizer.bypassSecurityTrustUrl(u));try{yield i.indexed.saveBlobToUserPath(e,a.path),i.userInput.attach.push(a),setTimeout(()=>{URL.revokeObjectURL(u)},0),l.dismiss()}catch(n){console.error("\ud30c\uc77c \uc62c\ub9ac\uae30 \uc2e4\ud328: ",n),i.p5toast.show({text:i.lang.text.TodoDetail.load_failed}),l.dismiss()}i.auto_scroll_down()})()}checkHasSameFileAndRename(e){var i=this;return(0,b.A)(function*(){let l=!1;if(l=yield i.indexed.checkIfFileExist(e.path),i.userInput.id&&!l)try{l=yield i.indexed.checkIfFileExist(`todo/${i.userInput.id}_${i.userInput.remote.isOfficial}_${i.userInput.remote.target}/${e.filename}`)}catch{l=yield i.indexed.checkIfFileExist(`todo/${i.userInput.id}/${e.filename}`)}l&&(e.filename=`${e.filename.substring(0,e.filename.lastIndexOf("."))}_.${e.file_ext}`,e.path=`tmp_files/todo/${e.filename}`,yield i.checkHasSameFileAndRename(e))})()}AttachmentContextMenu(e,i){var l,a=this;let u=null!==(l=e.url)&&void 0!==l?l:URL.createObjectURL(e.blob);return new A(n=>{n.setup=()=>{n.noCanvas(),n.loadImage(u,r=>{let s=[];if(e.content_related_creator&&(s=[...e.content_related_creator]),e.content_creator){let d=!1;for(let h=0,p=s.length;h<p;h++)if(void 0!==s[h].user_id&&void 0!==e.content_creator.user_id&&s[h].user_id==e.content_creator.user_id){d=!0;break}d||s.push(e.content_creator)}this.modalCtrl.create({component:M.c,componentProps:{path:e.alt_path||e.path,width:r.width,height:r.height},cssClass:"fullscreen"}).then(d=>{this.removeShortCut(),d.onDidDismiss().then(h=>{this.AddShortCut()}),d.onWillDismiss().then(function(){var h=(0,b.A)(function*(p){p.data&&a.voidDraw_fileAct_callback(p,s,i)});return function(p){return h.apply(this,arguments)}}()),d.present()}),e.url||URL.revokeObjectURL(u),n.remove()},r=>{console.log("\ube60\ub978 \ud3b8\uc9d1\uae30 \uc774\ub3d9 \uc2e4\ud328: ",r),e.url||URL.revokeObjectURL(u),n.remove()})}}),!1}ionViewWillEnter(){var e=this;return(0,b.A)(function*(){let i;if(e.WillLeavePage=!1,e.cont&&e.cont.abort(),e.cont=new AbortController,e.LoadStorageList(),e.received_data){if(e.buttonDisplay.saveTodo=e.lang.text.TodoDetail.buttonDisplay_modify,i=JSON.parse(e.received_data),e.userInput={...e.userInput,...i},e.isModify=!0,e.isModify&&e.userInput.noti_id&&e.noti.ClearNoti(e.userInput.noti_id),"local"==e.userInput.storeAt)e.StoreAt.value="local";else for(let n=0,r=e.AvailableStorageList.length;n<r;n++)if(e.userInput.remote.isOfficial==e.AvailableStorageList[n].isOfficial&&e.userInput.remote.target==e.AvailableStorageList[n].target){e.StoreAt.value=e.AvailableStorageList[n];break}}else e.userInput.limit=(new Date).getTime(),e.limitTimeP5Display=e.userInput.limit,e.AvailableStorageList.length&&(e.StoreAt.value=e.AvailableStorageList[0].target,e.StoreAtSelChanged({detail:{value:e.AvailableStorageList[0]}}));let l=document.getElementById("titleInput");e.titleIonInput=l.children[0].children[1].children[0],setTimeout(()=>{!e.isModify&&!e.checkIfInputFocus()&&e.titleIonInput.focus()},200),e.ImporantSelChanged({detail:{value:e.userInput.importance}}),e.file_sel_id=`${e.userInput.id||"new_todo_id"}_${(new Date).getTime()}`;let a=!1;try{a=yield e.indexed.checkIfFileExist(`todo/${e.userInput.id}_${e.userInput.remote.isOfficial}_${e.userInput.remote.target}/thumbnail.png`)}catch{a=yield e.indexed.checkIfFileExist(`todo/${e.userInput.id}/thumbnail.png`)}if(e.userInput.attach.length)for(let n=0,r=e.userInput.attach.length;n<r;n++){let s=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});s.present();try{if(e.userInput.remote){if(e.userInput.attach[n].url)e.userInput.attach[n].thumbnail=e.userInput.attach[n].url;else try{e.userInput.attach[n].alt_path=`todo/${e.userInput.id}_${e.userInput.remote.isOfficial}_${e.userInput.remote.target}/${e.userInput.attach[n].filename}`,e.userInput.attach[n].blob=(yield e.nakama.sync_load_file(e.userInput.attach[n],e.userInput.remote.isOfficial,e.userInput.remote.target,"todo_attach",e.userInput.remote.creator_id)).value}catch{}if(!a&&"image"==e.userInput.attach[n].viewer){let h=e.userInput.attach[n].url;e.userInput.attach[n].blob.size&&(h=URL.createObjectURL(e.userInput.attach[n].blob)),yield new Promise(p=>{new A(f=>{f.setup=()=>{f.noCanvas(),f.loadImage(h,g=>{g.width>g.height?g.resize(g.width/g.height*128,128):g.resize(128,g.height/g.width*128);let m=f.createCanvas(128,128);m.hide(),f.smooth(),f.pixelDensity(1),f.image(g,-(g.width-128)/2,-(g.height-128)/2);let y,v=m.elt.toDataURL("image/png").replace("image/png","image/octet-stream");try{y=`todo/${e.userInput.id}_${e.userInput.remote.isOfficial}_${e.userInput.remote.target}/thumbnail.png`}catch{y=`todo/${e.userInput.id}/thumbnail.png`}e.indexed.saveBase64ToUserPath(v,y,x=>{e.global.p5todo&&e.global.p5todo.add_todo&&e.global.p5todo.add_todo(JSON.stringify(e.userInput)),p()}),e.userInput.attach[n].blob&&URL.revokeObjectURL(h),f.remove()},g=>{console.error("Todo-\ub4f1\ub85d\ub41c \uc774\ubbf8\uc9c0 \ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",g),e.userInput.attach[n].blob&&URL.revokeObjectURL(h),f.remove(),p()})}})})}}else{if("image"!=e.userInput.attach[n].viewer&&"text"!=e.userInput.attach[n].viewer)throw"\ubc88\uc678 \uc378\ub124\uc77c \ud544\uc694";e.userInput.attach[n].blob=yield e.indexed.loadBlobFromUserPath(e.userInput.attach[n].path,e.userInput.attach[n].type)}if(!e.userInput.attach[n].blob){s.dismiss();continue}let d=URL.createObjectURL(e.userInput.attach[n].blob);e.global.modulate_thumbnail(e.userInput.attach[n],d,e.cont)}catch{e.global.modulate_thumbnail(e.userInput.attach[n],"",e.cont)}s.dismiss(),e.userInput.attach[n].exist=!0}try{if("local"==e.userInput.storeAt)e.isModify||(e.StoreAt.value=e.userInput.storeAt),e.userInput.display_store=e.lang.text.TodoDetail.OnThisDevice,e.userInput.display_creator=e.lang.text.TodoDetail.WrittenByMe,e.isModifiable=!0;else if(e.userInput.remote){if(e.isModify||(e.StoreAt.value=e.userInput.remote),e.userInput.display_store=e.userInput.remote.name,e.userInput.display_creator=e.lang.text.TodoDetail.Disconnected,!e.nakama.servers[e.userInput.remote.isOfficial]||!e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target])throw e.userInput.display_creator=e.lang.text.TodoDetail.DeletedServer,{text:"Server Deleted",isModifiable:!0};if(e.statusBar.groupServer[e.userInput.remote.isOfficial]&&"online"!=e.statusBar.groupServer[e.userInput.remote.isOfficial][e.userInput.remote.target])throw e.isStoreAtChangable=!1,{text:"Server disconnected",isModifiable:!1};"online"==e.statusBar.groupServer[e.userInput.remote.isOfficial][e.userInput.remote.target]&&(e.isModifiable=!0),e.userInput.remote.creator_id&&(e.AmICreator=e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session.user_id==e.userInput.remote.creator_id),e.userInput.display_creator=e.AmICreator?e.lang.text.TodoDetail.WrittenByMe:e.nakama.GetOverrideName(e.userInput.remote.creator_id,e.userInput.remote.isOfficial,e.userInput.remote.target)||e.nakama.load_other_user(e.userInput.remote.creator_id,e.userInput.remote.isOfficial,e.userInput.remote.target).display_name,e.userInput.remote.group_id&&(e.isModifiable="online"==e.nakama.groups[e.userInput.remote.isOfficial][e.userInput.remote.target][e.userInput.remote.group_id].status)}}catch(n){e.isModifiable=n.isModifiable,console.log("Server issue: ",n)}e.noti.Current=e.userInput.id;let u=new Date(e.userInput.limit);if(e.Calendar.value=new Date(u.getTime()-60*u.getTimezoneOffset()*1e3).toISOString(),i&&(e.limitTimeP5Display=new Date(i.limit).getTime()),e.userInput.startFrom){let n=new Date(e.userInput.startFrom);e.startDisplay=n.toLocaleString(e.lang.lang),e.startDisplay=e.startDisplay.substring(0,e.startDisplay.lastIndexOf(":"))}if(e.limit_change({detail:{value:e.userInput.limit}}),e.userInput.workers)for(let n=0,r=e.userInput.workers.length;n<r;n++){try{e.userInput.workers[n].name=e.nakama.GetOverrideName(e.userInput.workers[n].id,e.userInput.remote.isOfficial,e.userInput.remote.target)||e.nakama.load_other_user(e.userInput.workers[n].id,e.userInput.remote.isOfficial,e.userInput.remote.target).display_name}catch{}e.userInput.workers[n].timestamp&&(e.userInput.workers[n].displayTime=new Date(e.userInput.workers[n].timestamp).toLocaleString())}e.desc_input=document.getElementById("descInput"),e.desc_input.onpaste=n=>{let r=[];for(const s of n.clipboardData.files)r.push({file:s});if(r.length){for(let s=0,d=r.length;s<d;s++)e.selected_blobFile_callback_act(r[s].file);return!1}},e.useFirstCustomCDN=Number(localStorage.getItem("useFFSCDN"))||0,e.toggle_custom_attach(e.useFirstCustomCDN)})()}LoadStorageList(){let e=[];Object.keys(this.nakama.servers).forEach(a=>{Object.keys(this.nakama.servers[a]).forEach(n=>{"online"==this.statusBar.groupServer[a][n]&&e.push({name:`${this.nakama.servers[a][n].info.name}`,isOfficial:a,target:n,type:`${a}/${n}`})})}),[...e].forEach(a=>{this.AvailableStorageList.push(a)})}ionViewDidEnter(){this.show_count_timer(),this.AddShortCut()}AddShortCut(){setTimeout(()=>{delete this.global.p5key.KeyShortCut.Digit,this.global.p5key.KeyShortCut.Escape=()=>{this.navCtrl.pop()},this.global.p5key.KeyShortCut.AddAct=()=>{this.checkIfInputFocus()||this.open_select_new()},this.global.p5key.KeyShortCut.EnterAct=e=>{document.activeElement==this.titleIonInput&&setTimeout(()=>{this.desc_input.focus()},0),e.ctrlKey&&this.saveData()}},0)}removeShortCut(){delete this.global.p5key.KeyShortCut.Escape,delete this.global.p5key.KeyShortCut.AddAct,delete this.global.p5key.KeyShortCut.Digit}start_change(e){this.userInput.startFrom=e.detail.value,this.startDisplay=new Date(e.detail.value).toLocaleString(this.lang.lang),this.startDisplay=this.startDisplay.substring(0,this.startDisplay.lastIndexOf(":")),this.startTimeP5Display=new Date(this.userInput.startFrom).getTime()}limit_change(e){this.userInput.limit=e.detail.value;let i=new Date(e.detail.value);i.getTime()<=Date.now()?this.limitDisplay=this.lang.text.TodoDetail.NoDeadLine:(this.limitDisplay=i.toLocaleString(this.lang.lang),this.limitDisplay=this.limitDisplay.substring(0,this.limitDisplay.lastIndexOf(":"))),this.limitTimeP5Display=new Date(this.userInput.limit).getTime(),this.startTimeP5Display=Date.now(),this.isLimitUsable=this.limitTimeP5Display>this.startTimeP5Display}remove_attach(e){this.userInput.attach.splice(e,1)}show_count_timer(){this.p5timer=new A(e=>{let i=0;this.startTimeP5Display=this.userInput.startFrom||this.userInput.written?new Date(this.userInput.startFrom||this.userInput.written).getTime():(new Date).getTime(),this.startTimeP5Display=e.min(this.startTimeP5Display,this.limitTimeP5Display);let l,a=e.color(this.normal_color);e.setup=()=>{let d=document.getElementById("p5timer"),h=e.createCanvas(d.clientWidth,d.clientHeight);h.id("timer"),h.style("position","inherit"),h.style("width","100%"),h.style("height","100%"),h.parent(d),e.noStroke()};let u=0,n=()=>{l=(new Date).getTime(),u=this.limitTimeP5Display<l?1:e.map(l,this.startTimeP5Display,this.limitTimeP5Display,0,1,!0),u<=this.AlertLerpStartFrom?a=e.color(this.userInput.custom_color?this.userInput.custom_color+"88":this.normal_color):u>this.AlertLerpStartFrom&&(a=this.userInput.custom_color?e.color(this.userInput.custom_color+"88"):e.lerpColor(e.color(this.normal_color),e.color(this.alert_color),e.map(u,this.AlertLerpStartFrom,1,0,1)*i))};e.draw=()=>{n(),e.clear(255,255,255,255),e.push(),e.fill(a),i<1?(i+=.04,i>=1&&(i=1),e.rect(0,0,e.lerp(0,e.width,u*r(i)),e.height)):e.rect(0,0,e.lerp(0,e.width,u),e.height),e.pop()};let r=d=>s(e.sq(s(d))),s=d=>1-d})}open_select_new(){if(this.isCDNToggleClicked)return;delete this.global.p5key.KeyShortCut.Escape,delete this.global.p5key.KeyShortCut.AddAct;let e=["camera","image","text","inapp","load"];this.global.p5key.KeyShortCut.Digit=i=>{this.checkIfInputFocus()||(delete this.global.p5key.KeyShortCut.Digit,e.length>i&&this.new_attach({detail:{value:e[i]}}))}}checkIfInputFocus(){this.input_ele_ids.length||(this.input_ele_ids.push(this.titleIonInput),this.input_ele_ids.push(this.desc_input));let e=!1;for(let i=0,l=this.input_ele_ids.length;i<l;i++)if(document.activeElement==this.input_ele_ids[i]){e=!0;break}return e}new_attach(e){var i=this;return(0,b.A)(function*(){switch(e.detail.value){case"camera":try{let u=yield i.global.from_camera("tmp_files/todo/",{display_name:i.nakama.users.self.display_name});u.thumbnail=i.sanitizer.bypassSecurityTrustUrl(u.base64),i.userInput.attach.push(u)}catch(u){console.log("\ucd2c\uc601 \uc2e4\ud328: ",u),i.p5toast.show({text:`${i.lang.text.GlobalAct.ErrorFromCamera}: ${u}`})}i.AddShortCut(),i.auto_scroll_down(100);break;case"text":let l=i.global.TextEditorNewFileName();i.modalCtrl.create({component:j.c,componentProps:{info:{content:{is_new:"text",type:"text/plain",viewer:"text",filename:l}},no_edit:!0}}).then(u=>{i.removeShortCut(),u.onWillDismiss().then(n=>{if(n.data){let r=i.global.TextEditorAfterAct(n.data,{display_name:i.nakama.users.self.display_name});i.userInput.attach.push(r),i.auto_scroll_down()}}),u.onDidDismiss().then(()=>{i.AddShortCut()}),u.present()});break;case"image":i.modalCtrl.create({component:M.c,cssClass:"fullscreen"}).then(u=>{i.removeShortCut(),u.onWillDismiss().then(function(){var n=(0,b.A)(function*(r){r.data&&i.voidDraw_fileAct_callback(r)});return function(r){return n.apply(this,arguments)}}()),u.onDidDismiss().then(()=>{i.AddShortCut()}),u.present()});break;case"inapp":i.modalCtrl.create({component:B.f}).then(u=>{u.onWillDismiss().then(function(){var n=(0,b.A)(function*(r){r.data&&i.selected_blobFile_callback_act(r.data)});return function(r){return n.apply(this,arguments)}}()),u.onDidDismiss().then(()=>{i.AddShortCut()}),u.present()});break;case"load":i.select_attach(),i.AddShortCut();break;case"link":let a;try{let u;if(void 0===u)try{let s=yield i.global.GetValueFromClipboard();switch(s.type){case"text/plain":u=s.value;break;case"image/png":return void i.inputImageSelected({target:{files:[s.value]}})}}catch(s){throw s}try{let s=i.global.Base64ToBlob(u),d=u.split(";")[0].split(":")[1];throw a=new File([s],`${i.lang.text.ChatRoom.FileLink}.${d.split("/").pop()}`,{type:d}),yield i.selected_blobFile_callback_act(a),"done"}catch(s){if("done"===s)throw s}try{if(0!=u.indexOf("http:")&&0!=u.indexOf("https:"))throw"\uc62c\ubc14\ub978 \uc6f9 \uc8fc\uc18c\uac00 \uc544\ub2d8";if(a)throw"\uc774\ubbf8 \ud30c\uc77c\uc774 \ucca8\ubd80\ub428, \ud1a0\uae00\ub9cc \uc2dc\ub3c4"}catch(s){throw s}let n={};n.url=u,n.content_related_creator=[],n.content_related_creator.push({user_id:"local"==i.userInput.remote.isOfficial?"local":i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].session.user_id,timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"link"}),n.content_creator={user_id:"local"==i.userInput.remote.isOfficial?"local":i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].session.user_id,timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"link"};let r=n.url.split(".");n.file_ext=r.pop().split("?").shift(),n.filename=decodeURIComponent(`${r.pop().split("/").pop()||i.lang.text.ChatRoom.ExternalLinkFile}.${n.file_ext}`),i.global.set_viewer_category_from_ext(n),n.type="",n.typeheader=n.viewer,i.global.modulate_thumbnail(n,n.url,i.cont),i.userInput.attach.push(n)}catch(u){throw"done"==u?u:`\uc778\uc2dd \ubd88\uac00\ub2a5\ud55c URL \uc815\ubcf4: ${u}`}}})()}select_attach(){document.getElementById(this.file_sel_id).click()}inputImageSelected(e){var i=this;return(0,b.A)(function*(){if(e.target.files.length){for(let a=0,u=e.target.files.length;a<u;a++)yield i.selected_blobFile_callback_act(e.target.files[a]);document.getElementById(i.file_sel_id).value=""}})()}StoreAtSelClicked(){this.StoreAt.open()}StoreAtSelChanged(e){this.isStoreAtChanged=!0;let i=e.detail.value;"local"==i?(this.userInput.storeAt="local",this.userInput.remote=void 0,this.isManager=!1,this.userInput.workers=void 0):(this.userInput.storeAt=i.type,this.userInput.remote=i,this.userInput.workers=[],this.nakama.servers[i.isOfficial][i.target].client.getAccount(this.nakama.servers[i.isOfficial][i.target].session).then(l=>{let a=JSON.parse(l.user.metadata);if(this.WorkerGroups.length=0,this.AvailableWorker={},a.is_admin)this.nakama.servers[i.isOfficial][i.target].client.rpc(this.nakama.servers[i.isOfficial][i.target].session,"query_all_groups",{}).then(u=>{let n=u.payload;for(let r=0,s=n.length;r<s;r++){this.AvailableWorker[n[r].id]||(this.AvailableWorker[n[r].id]=[]);for(let d=0,h=n[r].users.length;d<h;d++){let p=this.nakama.load_other_user(n[r].users[d].user.user_id,i.isOfficial,i.target,f=>{delete f.todo_checked,f.email||(f.override_name=this.nakama.GetOverrideName(f.id||f.user_id,this.userInput.remote.isOfficial,this.userInput.remote.target))});p.email||this.AvailableWorker[n[r].id].push(p)}this.AvailableWorker[n[r].id].length?this.WorkerGroups.push({id:n[r].id,name:n[r].name}):delete this.AvailableWorker[n[r].id]}this.isManager=!0});else if(a.is_manager){for(let u=a.is_manager.length-1;u>=0;u--)try{let n=this.nakama.groups[i.isOfficial][i.target][a.is_manager[u]];this.AvailableWorker[n.id]||(this.AvailableWorker[n.id]=[]);for(let r=0,s=n.users.length;r<s;r++){if(!n.users[r].user.user_id&&!n.users[r].user.id||(n.users[r].user.user_id||n.users[r].user.id)==this.nakama.servers[i.isOfficial][i.target].session.user_id)continue;let d=this.nakama.load_other_user(n.users[r].user.user_id||n.users[r].user.id,i.isOfficial,i.target,h=>{delete h.todo_checked,(h.id||h.user_id)!=this.nakama.servers[i.isOfficial][i.target].session.user_id&&h.display_name&&(h.override_name=this.nakama.GetOverrideName(h.id||h.user_id,this.userInput.remote.isOfficial,this.userInput.remote.target))});(d.id||d.user_id)!=this.nakama.servers[i.isOfficial][i.target].session.user_id&&d.display_name&&this.AvailableWorker[n.id].push(d)}this.AvailableWorker[n.id].length?this.WorkerGroups.push({id:n.id,name:n.name}):delete this.AvailableWorker[n.id]}catch{a.is_manager.splice(u,1)}this.isManager=a.is_manager.length,this.isManager||delete a.is_manager,this.nakama.servers[i.isOfficial][i.target].client.rpc(this.nakama.servers[i.isOfficial][i.target].session,"update_user_metadata_fn",{user_id:this.nakama.servers[i.isOfficial][i.target].session.user_id,metadata:a}).catch(u=>{})}})),setTimeout(()=>{!this.isModify&&this.titleIonInput&&this.titleIonInput.focus()},200)}toggle_all_user(e){this.toggle_logs[e]=!this.toggle_logs[e];for(let i=0,l=this.AvailableWorker[e].length;i<l;i++)this.AvailableWorker[e][i].todo_checked=this.toggle_logs[e]}ImporantSelClicked(){this.ImporantSel.open()}ImporantSelChanged(e){switch(this.userInput.importance=e.detail.value,this.userInput.importance){case"0":this.normal_color="#888b",this.alert_color="#58a19288",this.AlertLerpStartFrom=.8;break;case"1":this.normal_color="#888b",this.alert_color="#ddbb4188",this.AlertLerpStartFrom=.5;break;case"2":this.normal_color="#dddd0c88",this.alert_color="#b9543788",this.AlertLerpStartFrom=.4}}SpeechToTitleText(){var e=this;return(0,b.A)(function*(){yield D.R.requestAudioRecordingPermission();let i=yield N.o.start({language:e.lang.lang,maxResults:1,prompt:e.lang.text.ChatRoom.TalkMessage,partialResults:!0,popup:!0});e.userInput.title=i.matches[0]})()}SpeechToDetailText(){var e=this;return(0,b.A)(function*(){yield D.R.requestAudioRecordingPermission();let i=yield N.o.start({language:e.lang.lang,maxResults:1,prompt:e.lang.text.ChatRoom.TalkMessage,partialResults:!0,popup:!0});e.userInput.description?e.userInput.description+="\n":e.userInput.description="",e.userInput.description+=i.matches[0]})()}toggle_custom_color(){this.userInput.custom_color?this.userInput.custom_color=void 0:(document.getElementById("TodoCustomColorInput").click(),this.userInput.custom_color="#ff0000")}open_content_viewer(e){if(this.lock_modal_open)return;this.lock_modal_open=!0;let i=[];for(let l=0,a=this.userInput.attach.length;l<a;l++)i.push({content:this.userInput.attach[l]});this.modalCtrl.create({component:j.c,componentProps:{info:{content:this.userInput.attach[e]},path:this.userInput.attach[e].alt_path||this.userInput.attach[e].path,relevance:i,noEdit:!this.isModifiable},cssClass:"fullscreen"}).then(l=>{this.removeShortCut(),l.onDidDismiss().then(a=>{if(this.lock_modal_open=!1,this.AddShortCut(),a.data)switch(a.data.type){case"image":let u=[];if(this.userInput.attach[a.data.index].content_related_creator&&(u=[...this.userInput.attach[a.data.index].content_related_creator]),this.userInput.attach[a.data.index].content_creator){let n=!1;for(let r=0,s=u.length;r<s;r++)if(void 0!==u[r].user_id&&void 0!==this.userInput.attach[a.data.index].content_creator.user_id&&u[r].user_id==this.userInput.attach[a.data.index].content_creator.user_id){n=!0;break}n||u.push(this.userInput.attach[a.data.index].content_creator)}return delete this.userInput.attach[a.data.index].exist,void this.modalCtrl.create({component:M.c,componentProps:{path:a.data.path||this.userInput.attach[a.data.index].alt_path||this.userInput.attach[a.data.index].path,width:a.data.width,height:a.data.height,text:a.data.text},cssClass:"fullscreen"}).then(n=>{this.removeShortCut(),n.onWillDismiss().then(r=>{r.data&&("image"===a.data.msg.content.viewer?this.voidDraw_fileAct_callback(r,u,a.data.index):this.voidDraw_fileAct_callback(r,u))}),n.onDidDismiss().then(r=>{this.AddShortCut()}),n.present()});case"text":this.userInput.attach[a.data.index].content_related_creator.push(this.userInput.attach[a.data.index].content_creator),this.userInput.attach[a.data.index].content_creator={timestamp:(new Date).getTime(),display_name:this.nakama.users.self.display_name,various:"textedit"},this.userInput.attach[a.data.index].blob=a.data.blob,this.userInput.attach[a.data.index].path=a.data.path,this.userInput.attach[a.data.index].size=a.data.blob.size,this.userInput.attach[a.data.index].filename=a.data.blob.name||this.userInput.attach[a.data.index].filename,delete this.userInput.attach[a.data.index].exist}}),this.noti.Current="IonicViewerPage",l.present()})}auto_scroll_down(e=0){setTimeout(()=>{this.MainDiv.scrollTo({top:this.MainDiv.scrollHeight,behavior:"smooth"})},e)}voidDraw_fileAct_callback(e,i,l){var a=this;return(0,b.A)(function*(){let u=yield a.global.voidDraw_fileAct_callback(e,"tmp_files/todo/",{display_name:a.nakama.users.self.display_name},i);try{if(void 0===l)throw"not overwrite";a.userInput.attach[l]=u}catch{a.userInput.attach.push(u)}a.auto_scroll_down(100)})()}doneTodo(){this.isButtonClicked=!0,this.nakama.doneTodo(this.userInput)}toggle_custom_attach(e){var i=this;return(0,b.A)(function*(){switch(i.isCDNToggleClicked=!0,i.useFirstCustomCDN=(null!=e?e:i.useFirstCustomCDN+1)%(i.userInput.remote?3:2),"Android"==w.aH&&(i.useFirstCustomCDN=2,i.isCDNToggleAvailable=!1),i.useFirstCustomCDN){case 0:i.DisplayDBSelector="cloud-offline-outline",i.DisplayDBSelectedName=i.lang.text.ChatRoom.Detour;break;case 1:i.DisplayDBSelector="cloud-done-outline",i.DisplayDBSelectedName=i.lang.text.ChatRoom.useFSS;break;case 2:i.DisplayDBSelector="server-outline",i.DisplayDBSelectedName=i.lang.text.ChatRoom.forceSQL}localStorage.setItem("useFFSCDN",`${i.useFirstCustomCDN}`),setTimeout(()=>{i.isCDNToggleClicked=!1},0)})()}saveData(){var e=this;return(0,b.A)(function*(){if(!e.userInput.title)return void e.p5toast.show({text:e.lang.text.TodoDetail.needDisplayName});e.isButtonClicked=!0,e.useVoiceRecording&&(yield e.StopAndSaveVoiceRecording());let i=!!e.userInput.attach.length;if(delete e.userInput.display_store,delete e.userInput.display_creator,JSON.stringify(e.userInput)==e.received_data)return void e.navCtrl.pop();e.userInput.create_at||(e.userInput.create_at=(new Date).getTime());let a=e.received_data?JSON.parse(e.received_data):void 0;if(e.isStoreAtChanged&&e.isModify){for(let r=0,s=a.attach.length;r<s;r++)if(a.attach[r].url){let d=a.attach[r].filename,p=yield(yield fetch(a.attach[r].url,{signal:e.cont.signal})).blob(),f=`tmp_files/todo/${d}`;yield e.indexed.saveBlobToUserPath(p,f),e.userInput.attach[r].path=f,e.userInput.attach[r].blob=p,delete e.userInput.attach[r].exist}else try{let d=a.attach[r].filename,h=yield e.indexed.loadBlobFromUserPath(a.attach[r].path,a.attach[r].type),p=`tmp_files/todo/${d}`;yield e.indexed.saveBlobToUserPath(h,p),e.userInput.attach[r].path=p,e.userInput.attach[r].blob=h,delete e.userInput.attach[r].exist}catch{}yield e.nakama.deleteTodoFromStorage(!0,a),e.isModify=!1}if(!e.userInput.id||!e.isModify)if(e.userInput.remote)try{let r=yield e.nakama.getRemoteTodoCounter(e.userInput.remote.isOfficial,e.userInput.remote.target);e.userInput.id=`RemoteTodo_${r}`}catch{}else e.userInput.id=new Date(e.userInput.create_at).toISOString().replace(/[:|.|\/]/g,"_");e.userInput.noti_id&&(e.isMobile||(clearTimeout(e.nakama.web_noti_id[e.userInput.noti_id]),delete e.nakama.web_noti_id[e.userInput.noti_id]),e.nakama.removeRegisteredId(e.userInput.noti_id),e.noti.ClearNoti(e.userInput.noti_id)),e.userInput.noti_id=e.nakama.get_noti_id(),e.nakama.set_todo_notification(e.userInput);let n,u=!1;if(!e.isModify&&e.userInput.workers){e.userInput.workers.length=0;let r=Object.keys(e.AvailableWorker),s=[];for(let d=0,h=r.length;d<h;d++)for(let p=0,f=e.AvailableWorker[r[d]].length;p<f;p++){let g=e.AvailableWorker[r[d]][p].id||e.AvailableWorker[r[d]][p].user_id;e.AvailableWorker[r[d]][p].todo_checked&&!s.includes(g)&&(e.userInput.workers.push({id:g,name:e.nakama.load_other_user(g,e.userInput.remote.isOfficial,e.userInput.remote.target).display_name}),s.push(g))}e.userInput.workers.length||(e.userInput.workers=void 0)}try{a.attach.forEach(d=>{delete d.exist,delete d.thumbnail,delete d.base64,delete d.blob});let r=JSON.stringify(a.attach),s=JSON.parse(JSON.stringify(e.userInput.attach));s.forEach(d=>{delete d.exist,delete d.thumbnail,delete d.base64,delete d.blob}),s=JSON.stringify(s),u=r!=s}catch{u=!0}if(i&&u){let s,r=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});if(r.present(),a)try{let d;try{d=`todo/${e.userInput.id}_${e.userInput.remote.isOfficial}_${e.userInput.remote.target}/thumbnail.png`}catch{d=`todo/${e.userInput.id}/thumbnail.png`}yield e.indexed.removeFileFromUserPath(d);for(let h=0,p=a.attach.length;h<p;h++){for(let f=0,g=e.userInput.attach.length;f<g;f++)if(e.userInput.attach[f].path==a.attach[h].path){a.attach[h].exist=!0,a.attach[h].index=f;break}(!a.attach[h].exist||a.attach[h].exist&&!e.userInput.attach[a.attach[h].index])&&(a.attach[h].url?yield e.global.remove_file_from_storage(a.attach[h].url):yield e.indexed.removeFileFromUserPath(a.attach[h].path))}}catch{}for(let d=0,h=e.userInput.attach.length;d<h;d++){let p,f=!1;try{if(s)throw"already exist";p=yield e.indexed.loadBlobFromUserPath(`${e.userInput.attach[d].path}_thumbnail.png`,"image/png"),f=!0}catch{}if(!e.userInput.attach[d].exist||!s&&"image"==e.userInput.attach[d].viewer){try{f||(p=yield e.indexed.loadBlobFromUserPath(e.userInput.attach[d].path,e.userInput.attach[d].type))}catch{}try{if(1!=e.useFirstCustomCDN)throw"FFS \uc0ac\uc6a9 \uc21c\uc704\uc5d0 \uc5c6\uc74c";let g;if(r.message=`${e.lang.text.AddPost.SyncAttaches}: ${e.userInput.attach[d].filename}`,g=yield e.global.try_upload_to_user_custom_fs(e.userInput.attach[d],e.nakama.users.self.display_name,r),!g)throw"\uc5c5\ub85c\ub4dc \uc2e4\ud328";delete e.userInput.attach[d].partsize,delete e.userInput.attach[d].size,e.userInput.attach[d].url=g}catch{try{e.userInput.attach[d].path=`todo/${e.userInput.id}_${e.userInput.remote.isOfficial}_${e.userInput.remote.target}/${e.userInput.attach[d].filename}`}catch{e.userInput.attach[d].path=`todo/${e.userInput.id}/${e.userInput.attach[d].filename}`}try{yield e.indexed.saveBlobToUserPath(p,e.userInput.attach[d].path)}catch{}}}else delete e.userInput.attach[d].exist;if(!s&&("image"==e.userInput.attach[d].viewer||f))try{s=URL.createObjectURL(p)}catch{}}s&&(yield new Promise(d=>{new A(h=>{h.setup=()=>{h.noCanvas(),h.loadImage(s,p=>{p.width>p.height?p.resize(p.width/p.height*128,128):p.resize(128,p.height/p.width*128);let g=h.createCanvas(128,128);g.hide(),h.smooth(),h.pixelDensity(1),h.image(p,-(p.width-128)/2,-(p.height-128)/2);let m,T=g.elt.toDataURL("image/png").replace("image/png","image/octet-stream");try{m=`todo/${e.userInput.id}_${e.userInput.remote.isOfficial}_${e.userInput.remote.target}/thumbnail.png`}catch{m=`todo/${e.userInput.id}/thumbnail.png`}e.indexed.saveBase64ToUserPath(T,m,v=>{d()}),URL.revokeObjectURL(s),h.remove()},p=>{console.error("Todo-\ub4f1\ub85d\ub41c \uc774\ubbf8\uc9c0 \ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",p),d(),URL.revokeObjectURL(s),h.remove()})}})})),r.dismiss()}if(!i&&u&&a){let r;try{r=`todo/${e.userInput.id}_${e.userInput.remote.isOfficial}_${e.userInput.remote.target}/thumbnail.png`}catch{r=`todo/${e.userInput.id}/thumbnail.png`}if(yield e.indexed.removeFileFromUserPath(r),a.attach)for(let s=0,d=a.attach.length;s<d;s++)a.attach[s].url?yield e.global.remove_file_from_storage(a.attach[s].url):yield e.indexed.removeFileFromUserPath(a.attach[s].path)}if(e.userInput.attach.forEach(r=>{URL.revokeObjectURL(r.thumbnail),delete r.thumbnail,delete r.exist,delete r.base64}),e.userInput.written=(new Date).getTime(),e.userInput.startFrom){let r=new Date(e.userInput.startFrom).getTime();(new Date).getTime()>r?delete e.userInput.startFrom:e.userInput.startFrom=r}if(e.userInput.limit=new Date(e.userInput.limit).getTime(),e.isModify||e.userInput.remote&&!e.userInput.remote.creator_id&&(e.userInput.remote.creator_id=e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session.user_id),e.userInput.remote){let r=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});r.present();try{if(e.userInput.attach.forEach(s=>{URL.revokeObjectURL(s.thumbnail),delete s.thumbnail,delete s.exist,delete s.base64}),i&&u&&a)for(let s=0,d=a.attach.length;s<d;s++){for(let h=0,p=e.userInput.attach.length;h<p;h++)if(e.userInput.attach[h].path==a.attach[s].path){a.attach[s].exist=!0,a.attach[s].index=h;break}if(!a.attach[s].exist||a.attach[s].exist&&!e.userInput.attach[a.attach[s].index])if(a.attach[s].url)yield e.global.remove_file_from_storage(a.attach[s].url);else try{yield e.nakama.sync_remove_file(a.attach[s].path,e.userInput.remote.isOfficial,e.userInput.remote.target,"todo_attach")}catch{}}for(let s=0,d=e.userInput.attach.length;s<d;s++)try{if(2==e.useFirstCustomCDN)throw"ForceSQL";!e.userInput.attach[s].blob.size&&e.userInput.attach[s].url&&(e.userInput.attach[s].blob=yield(yield fetch(e.userInput.attach[s].url,{signal:e.cont.signal})).blob());let h=e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].info.address,p=e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].info.useSSL?"https:":"http:",f=`${e.userInput.id}_${e.nakama.users.self.display_name}`;try{f=`${e.userInput.id}_${e.userInput.remote.creator_id}`}catch{}let g=yield e.global.upload_file_to_storage(e.userInput.attach[s],f,p,h,1==e.useFirstCustomCDN);if(!g)throw"\ub9c1\ud06c \ub9cc\ub4e4\uae30 \uc2e4\ud328";delete e.userInput.attach[s].size,delete e.userInput.attach[s].partsize,e.userInput.attach[s].url=g}catch(h){console.log("cdn \uc5c5\ub85c\ub4dc \ucc98\ub9ac \uc2e4\ud328: ",h),"ForceSQL"==h&&e.userInput.attach[s].url&&(e.userInput.attach[s].blob=yield(yield fetch(e.userInput.attach[s].url,{signal:e.cont.signal})).blob());try{yield e.nakama.sync_save_file(e.userInput.attach[s],e.userInput.remote.isOfficial,e.userInput.remote.target,"todo_attach")}catch{}}if(e.userInput.workers){if(!e.isModify){let s=yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].client.rpc(e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session,"manage_todo_add_fn",e.userInput);e.userInput.id=`RemoteTodo_${s.payload.value}`,e.nakama.RemoteTodoCounter[e.userInput.remote.isOfficial][e.userInput.remote.target].push(s.payload.value),e.nakama.updateRemoteCounter(e.userInput.remote.isOfficial,e.userInput.remote.target)}for(let s=0,d=e.userInput.workers.length;s<d;s++)try{let h=yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].client.readStorageObjects(e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session,{object_ids:[{collection:"self_share",key:"private_match",user_id:e.userInput.workers[s].id}]});h.objects.length&&(yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].socket.joinMatch(h.objects[0].value.match_id),yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].socket.sendMatchState(h.objects[0].value.match_id,F.I.MANAGE_TODO,encodeURIComponent(`add,server_todo,${e.userInput.id}`)),yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].socket.leaveMatch(h.objects[0].value.match_id))}catch(h){console.log(h)}}else yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].client.writeStorageObjects(e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session,[{collection:"server_todo",key:e.userInput.id,permission_read:2,permission_write:1,value:e.userInput}]).then(function(){var s=(0,b.A)(function*(d){yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].socket.sendMatchState(e.nakama.self_match[e.userInput.remote.isOfficial][e.userInput.remote.target].match_id,F.I.MANAGE_TODO,encodeURIComponent(`add,${d.acks[0].collection},${d.acks[0].key}`))});return function(d){return s.apply(this,arguments)}}());e.isModify||(yield e.nakama.updateRemoteCounter(e.userInput.remote.isOfficial,e.userInput.remote.target)),r.dismiss()}catch(s){if(console.error("\ud574\uc57c\ud560 \uc77c\uc774 \uc11c\ubc84\uc5d0 \uc804\uc1a1\ub418\uc9c0 \uc54a\uc74c: ",s),r.dismiss(),e.isModify){let d;e.p5toast.show({text:e.lang.text.TodoDetail.SaveAfterConnectServer}),e.userInput.modified=!0,e.global.p5todo&&e.global.p5todo.add_todo&&e.global.p5todo.add_todo(JSON.stringify(e.userInput));try{d=`todo/${e.userInput.id}_${e.userInput.remote.isOfficial}_${e.userInput.remote.target}/info.todo`}catch{d=`todo/${e.userInput.id}/info.todo`}yield e.indexed.saveTextFileToUserPath(JSON.stringify(e.userInput),d),e.navCtrl.pop()}else e.p5toast.show({text:e.lang.text.TodoDetail.CanAddToServer});return void(e.isButtonClicked=!1)}}e.userInput.is_me=!0,e.global.p5todo&&e.global.p5todo.add_todo&&e.global.p5todo.add_todo(JSON.stringify(e.userInput));try{n=`todo/${e.userInput.id}_${e.userInput.remote.isOfficial}_${e.userInput.remote.target}/info.todo`}catch{n=`todo/${e.userInput.id}/info.todo`}yield e.indexed.saveTextFileToUserPath(JSON.stringify(e.userInput),n),e.navCtrl.pop()})()}deleteData(){var i,e=this;this.alertCtrl.create({header:this.lang.text.TodoDetail.remove,message:this.lang.text.ChatRoom.CannotUndone,buttons:[{text:this.lang.text.TodoDetail.remove,handler:(i=(0,b.A)(function*(){e.isButtonClicked=!0,yield e.nakama.deleteTodoFromStorage(!0,e.userInput),e.navCtrl.pop()}),function(){return i.apply(this,arguments)}),cssClass:"redfont"}]}).then(i=>{this.global.p5key.KeyShortCut.Escape=()=>{i.dismiss()},i.onDidDismiss().then(()=>{this.global.p5key.KeyShortCut.Escape=()=>{this.navCtrl.pop()}}),i.present()})}ionViewWillLeave(){var e=this;return(0,b.A)(function*(){e.WillLeavePage=!0,delete e.global.p5key.KeyShortCut.EnterAct,e.removeShortCut(),e.noti.Current="",e.p5timer&&e.p5timer.remove()})()}ngOnDestroy(){this.route.queryParams.unsubscribe(),this.desc_input.onpaste=null,this.cont.abort(),this.nakama.AddTodoLinkAct=void 0,this.nakama.AddTodoManageUpdateAct=void 0,this.p5canvas&&this.p5canvas.remove(),delete this.nakama.StatusBarChangedCallback,window.onfocus=void 0}}return(c=_).\u0275fac=function(e){return new(e||c)(t.rXU(S.nX),t.rXU(S.Ix),t.rXU(I.W3),t.rXU(L.y),t.rXU(U.G),t.rXU(V.up),t.rXU(W.n),t.rXU(F.X),t.rXU(I.hG),t.rXU(X.r),t.rXU(Y.j),t.rXU(I.Xi),t.rXU(J.z3),t.rXU(E.q9))},c.\u0275cmp=t.VBU({type:c,selectors:[["app-add-todo-menu"]],viewQuery:function(e,i){if(1&e&&(t.GBs(z,5),t.GBs(K,5),t.GBs(H,5),t.GBs(Q,5)),2&e){let l;t.mGM(l=t.lsd())&&(i.StartCalendar=l.first),t.mGM(l=t.lsd())&&(i.Calendar=l.first),t.mGM(l=t.lsd())&&(i.StoreAt=l.first),t.mGM(l=t.lsd())&&(i.ImporantSel=l.first)}},decls:64,vars:33,consts:[["ImporantSel",""],["DateTime",""],["Calendar",""],["StoreAt",""],["ManageWorker",""],["Groups",""],["StartCalendar",""],[1,"ion-no-border"],["slot","start"],["defaultHref","portal/main"],["id","p5Drop_todo",2,"position","absolute","width","100%","height","100%","display","flex","pointer-events","none","z-index","500"],["id","main_table",2,"width","100%","height","100%"],[2,"height","100%"],[2,"vertical-align","top"],["id","p5timer",2,"position","absolute","width","100%","height","8px","z-index","2"],["id","main_div",1,"main",2,"max-width","100vw"],["fixed","",4,"ngIf"],[3,"click",4,"ngIf"],[4,"ngIf"],["id","titleInput",1,"ion-text-right",3,"ngModelChange","label","ngModel","placeholder"],["slot","end","name","mic-outline",3,"click",4,"ngIf"],["button","",3,"click"],[2,"pointer-events","none",3,"ionChange","label","value"],["value","2"],["value","1"],["value","0"],[1,"additional_form","new_bg_form"],["id","TodoCustomColorInput","type","color",2,"width","0px","height","0px","opacity","0",3,"ngModelChange","ngModel"],["value","Start",4,"ngIf"],["value","Limit"],["button","","slot","header"],[1,"ion-text-right","uneditable_data"],[1,"ion-accordion-toggle-icon","hide_accordion_icon"],["slot","content"],[2,"max-width","none",3,"ionChange","locale"],["id","descInput",1,"infobox",2,"height","240px",3,"ngModelChange","ngModel","placeholder"],[4,"ngFor","ngForOf"],["button","",3,"click",4,"ngIf"],[2,"width","100%","text-align","center","padding-bottom","16px"],["style","display: inline-block;",4,"ngFor","ngForOf"],["hidden","","type","file","accept","*","multiple","",3,"change","id"],[2,"width","100%"],["id","bottom_buttons",2,"width","100%","background-color","black"],["expand","block",3,"click","disabled"],["fixed",""],["col-33",""],["button","","color","success",3,"click","disabled"],[1,"ion-text-center"],[3,"click"],[2,"pointer-events","none",3,"ionChange","label"],["value","local"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["color","medium"],["color","medium",1,"ion-text-right"],["slot","end","name","mic-outline",3,"click"],[3,"ngModelChange","ngModel"],[1,"ion-text-end"],["class","ignore_check",4,"ngFor","ngForOf"],[1,"ignore_check"],["style","color: var(--ion-color-medium);",4,"ngIf"],["slot","end","color","medium","name","ellipsis-horizontal-circle-outline",4,"ngIf"],["slot","end","color","danger","name","close-circle-outline",4,"ngIf"],["slot","end","color","success","name","checkmark-circle-outline",4,"ngIf"],[2,"color","var(--ion-color-medium)"],["slot","end","color","medium","name","ellipsis-horizontal-circle-outline"],["slot","end","color","danger","name","close-circle-outline"],["slot","end","color","success","name","checkmark-circle-outline"],["value","Start"],["text-wrap",""],["class","image_thumbnail",3,"src","alt","contextmenu",4,"ngIf"],["button","",4,"ngIf"],[1,"image_thumbnail",3,"contextmenu","src","alt"],["button",""],["slot","end",4,"ngIf"],["slot","end",3,"name",4,"ngIf"],["slot","end"],["slot","end",3,"name"],[2,"display","inline-block"],[1,"ext_button","ext_button_override",3,"click","hidden"],["slot","icon-only","style","width: 36px; height: 36px;",3,"name",4,"ngIf"],["class","ext_icon_img",3,"src","alt",4,"ngIf"],["slot","icon-only",2,"width","36px","height","36px",3,"name"],[1,"ext_icon_img",3,"src","alt"],["color","danger","expand","block",3,"click","disabled"]],template:function(e,i){if(1&e){const l=t.RV6();t.j41(0,"ion-header",7)(1,"ion-toolbar")(2,"ion-title"),t.EFF(3),t.k0s(),t.j41(4,"ion-buttons",8),t.nrm(5,"ion-back-button",9),t.k0s()()(),t.j41(6,"ion-content"),t.nrm(7,"div",10),t.j41(8,"table",11)(9,"tr",12)(10,"td",13),t.nrm(11,"div",14),t.j41(12,"div",15),t.DNE(13,Z,6,2,"ion-grid",16)(14,ee,6,3,"ion-item",17)(15,te,6,2,"div",18),t.j41(16,"ion-item")(17,"ion-input",19),t.mxI("ngModelChange",function(u){return t.eBV(l),t.DH7(i.userInput.title,u)||(i.userInput.title=u),t.Njj(u)}),t.k0s(),t.DNE(18,ie,1,0,"ion-icon",20),t.k0s(),t.DNE(19,oe,11,2,"div",18),t.j41(20,"ion-item",21),t.bIt("click",function(){return t.eBV(l),t.Njj(i.ImporantSelClicked())}),t.j41(21,"ion-select",22,0),t.bIt("ionChange",function(u){return t.eBV(l),t.Njj(i.ImporantSelChanged(u))}),t.j41(23,"ion-select-option",23),t.EFF(24),t.k0s(),t.j41(25,"ion-select-option",24),t.EFF(26),t.k0s(),t.j41(27,"ion-select-option",25),t.EFF(28),t.k0s()()(),t.DNE(29,ce,11,3,"div",18),t.j41(30,"ion-item",21),t.bIt("click",function(){return t.eBV(l),t.Njj(i.toggle_custom_color())}),t.j41(31,"ion-label"),t.EFF(32),t.k0s(),t.j41(33,"div",26)(34,"input",27),t.mxI("ngModelChange",function(u){return t.eBV(l),t.DH7(i.userInput.custom_color,u)||(i.userInput.custom_color=u),t.Njj(u)}),t.k0s()()(),t.j41(35,"ion-accordion-group",null,1),t.DNE(37,he,10,3,"ion-accordion",28),t.j41(38,"ion-accordion",29)(39,"ion-item",30)(40,"ion-label"),t.EFF(41),t.k0s(),t.j41(42,"ion-label",31),t.EFF(43),t.k0s(),t.nrm(44,"ion-icon",32),t.k0s(),t.j41(45,"div",33)(46,"ion-datetime",34,2),t.bIt("ionChange",function(u){return t.eBV(l),t.Njj(i.limit_change(u))}),t.k0s()()()(),t.DNE(48,pe,4,1,"ion-item-divider",18),t.j41(49,"textarea",35),t.mxI("ngModelChange",function(u){return t.eBV(l),t.DH7(i.userInput.description,u)||(i.userInput.description=u),t.Njj(u)}),t.k0s(),t.DNE(50,Ie,6,3,"div",36)(51,ye,5,3,"ion-item",37),t.j41(52,"div",38),t.DNE(53,xe,6,6,"div",39),t.k0s(),t.j41(54,"input",40),t.bIt("change",function(u){return t.eBV(l),t.Njj(i.inputImageSelected(u))}),t.k0s()()()(),t.j41(55,"tr")(56,"td")(57,"div",41)(58,"table",42)(59,"tr")(60,"td")(61,"ion-button",43),t.bIt("click",function(){return t.eBV(l),t.Njj(i.saveData())}),t.EFF(62),t.k0s()(),t.DNE(63,De,3,2,"td",18),t.k0s()()()()()()()}2&e&&(t.R7$(3),t.JRh(i.lang.text.TodoDetail.Title),t.R7$(10),t.Y8G("ngIf",i.isModify),t.R7$(),t.Y8G("ngIf",i.isStoreAtChangable&&i.AmICreator),t.R7$(),t.Y8G("ngIf",!i.isStoreAtChangable||!i.AmICreator),t.R7$(2),t.Y8G("label",i.lang.text.TodoDetail.DisplayName),t.R50("ngModel",i.userInput.title),t.Y8G("placeholder",i.lang.text.TodoDetail.DisplayName_placeholder),t.R7$(),t.Y8G("ngIf",i.isMobile),t.R7$(),t.Y8G("ngIf","local"!=i.userInput.storeAt&&i.isManager&&i.WorkerGroups.length),t.R7$(2),t.Y8G("label",i.lang.text.TodoDetail.Importance)("value",i.userInput.importance),t.R7$(3),t.JRh(i.lang.text.TodoDetail.Importance_2),t.R7$(2),t.JRh(i.lang.text.TodoDetail.Importance_1),t.R7$(2),t.JRh(i.lang.text.TodoDetail.Importance_0),t.R7$(),t.Y8G("ngIf",!i.isStoreAtChanged&&i.userInput.workers),t.R7$(3),t.JRh(i.lang.text.TodoDetail.CustomColor),t.R7$(),t.Aen("background-image: linear-gradient(to right, #0000, "+(i.userInput.custom_color||i.alert_color)+")"),t.R7$(),t.R50("ngModel",i.userInput.custom_color),t.R7$(3),t.Y8G("ngIf",i.isLimitUsable),t.R7$(4),t.JRh(i.lang.text.TodoDetail.limit),t.R7$(2),t.JRh(i.limitDisplay),t.R7$(3),t.Y8G("locale",i.lang.lang),t.R7$(2),t.Y8G("ngIf",i.isMobile),t.R7$(),t.R50("ngModel",i.userInput.description),t.Y8G("placeholder",i.lang.text.TodoDetail.description),t.R7$(),t.Y8G("ngForOf",i.userInput.attach),t.R7$(),t.Y8G("ngIf",i.isModifiable),t.R7$(2),t.Y8G("ngForOf",i.extended_buttons),t.R7$(),t.Y8G("id",i.file_sel_id),t.R7$(7),t.Y8G("disabled",i.isButtonClicked),t.R7$(),t.SpI(" ",i.buttonDisplay.saveTodo," "),t.R7$(),t.Y8G("ngIf",i.isModify))},dependencies:[$.Sq,$.bT,R.me,R.BC,R.vS,I.xk,I.YH,I.Jm,I.QW,I.eY,I.hU,I.W9,I.A9,I.lO,I.eU,I.iq,I.$w,I.uz,I.Dg,I.he,I.ln,I.Nm,I.Ip,I.BC,I.ai,I.hB,I.Je,I.Gw,I.el],styles:[".uneditable_data[_ngcontent-%COMP%]{color:#888}.main[_ngcontent-%COMP%]{width:100%;height:100%;padding-top:8px;overflow-x:hidden;overflow-y:auto;scroll-behavior:smooth}.logs[_ngcontent-%COMP%]{background:var(--voidDraw-menu-background);border-radius:8px;margin:8px;padding:4px 8px;text-align:center}.image_thumbnail[_ngcontent-%COMP%]{width:auto;height:auto;object-fit:contain;display:block;margin:auto}.ignore_check[_ngcontent-%COMP%]{pointer-events:none}"]}),_})()}];let Ae=(()=>{var c;class _{}return(c=_).\u0275fac=function(e){return new(e||c)},c.\u0275mod=t.$C({type:c}),c.\u0275inj=t.G2t({imports:[S.iI.forChild(Ce),S.iI]}),_})(),Re=(()=>{var c;class _{}return(c=_).\u0275fac=function(e){return new(e||c)},c.\u0275mod=t.$C({type:c}),c.\u0275inj=t.G2t({imports:[$.MD,R.YN,I.bv,Ae]}),_})()}}]);