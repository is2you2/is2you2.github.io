"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7703],{1889:(I,x,d)=>{d.d(x,{Wi:()=>D});var D=function(f){return f.UTF8="utf8",f.ASCII="ascii",f.UTF16="utf16",f}(D||{})},7703:(I,x,d)=>{d.d(x,{f:()=>pe});var h=d(467),D=d(9349),b=d(7892),v=d(5083);d(1889);const k=(0,v.F3)("Filesystem",{web:()=>d.e(2937).then(d.bind(d,2937)).then(s=>new s.FilesystemWeb)});var R=d(8326),C=d(736),e=d(3953),g=d(5374),y=d(3656),T=d(755),P=d(4234),E=d(3295),G=d(9900),j=d(345),$=d(252),S=d(5547),B=d(4237),U=d(177);const w=["FileSel"];function L(s,_){if(1&s){const r=e.RV6();e.j41(0,"ion-icon",10),e.bIt("click",function(){e.eBV(r);const t=e.XpG();return e.Njj(t.toggle_thumbnail())}),e.k0s()}}function A(s,_){if(1&s){const r=e.RV6();e.j41(0,"ion-icon",11),e.bIt("click",function(){e.eBV(r);const t=e.XpG();return e.Njj(t.toggle_thumbnail())}),e.k0s()}}function N(s,_){if(1&s){const r=e.RV6();e.j41(0,"div")(1,"ion-item",19),e.bIt("click",function(){e.eBV(r);const t=e.XpG(2);return e.Njj(t.SelectImportFolder())}),e.nrm(2,"ion-icon",20),e.j41(3,"ion-label"),e.EFF(4),e.k0s()(),e.j41(5,"input",21),e.bIt("change",function(t){e.eBV(r);const n=e.XpG(2);return e.Njj(n.inputImageSelected(t))}),e.k0s()()}if(2&s){const r=e.XpG(2);e.R7$(4),e.SpI(" ",r.lang.text.UserFsDir.ImportFolder," ")}}function X(s,_){if(1&s){const r=e.RV6();e.j41(0,"ion-button",15),e.bIt("click",function(){e.eBV(r);const t=e.XpG(2);return e.Njj(t.ExportDirectoryRecursive())}),e.EFF(1),e.k0s()}if(2&s){const r=e.XpG(2);e.R7$(),e.SpI(" ",r.lang.text.UserFsDir.ExportDir," ")}}function V(s,_){if(1&s){const r=e.RV6();e.j41(0,"ion-item",19),e.bIt("click",function(){e.eBV(r);const t=e.XpG(2);return e.Njj(t.MoveToUpDir())}),e.nrm(1,"ion-icon",13),e.j41(2,"ion-label"),e.EFF(3,".."),e.k0s()()}}function O(s,_){if(1&s){const r=e.RV6();e.j41(0,"ion-item",19),e.bIt("click",function(){e.eBV(r);const t=e.XpG().$implicit,n=e.XpG(2);return e.Njj(n.SelectFolder(t))}),e.nrm(1,"ion-icon",13),e.j41(2,"ion-label"),e.EFF(3),e.k0s()()}if(2&s){const r=e.XpG().$implicit;e.R7$(3),e.JRh(r.name)}}function M(s,_){if(1&s&&(e.j41(0,"div"),e.DNE(1,O,4,1,"ion-item",17),e.k0s()),2&s){const r=_.$implicit,i=e.XpG(2);e.R7$(),e.Y8G("ngIf",i.CurrentDir==r.dir)}}function Y(s,_){1&s&&e.nrm(0,"ion-icon",39)}function H(s,_){1&s&&e.nrm(0,"ion-icon",40)}function W(s,_){1&s&&e.nrm(0,"ion-icon",41)}function z(s,_){1&s&&e.nrm(0,"ion-icon",42)}function J(s,_){1&s&&e.nrm(0,"ion-icon",43)}function K(s,_){1&s&&e.nrm(0,"ion-icon",44)}function Q(s,_){1&s&&e.nrm(0,"ion-icon",45)}function Z(s,_){1&s&&e.nrm(0,"ion-icon",46)}function q(s,_){if(1&s&&(e.j41(0,"ion-label",47),e.EFF(1),e.k0s()),2&s){const r=e.XpG(2).$implicit;e.R7$(),e.JRh(r.name)}}function ee(s,_){if(1&s&&(e.j41(0,"ion-label"),e.EFF(1),e.k0s()),2&s){const r=e.XpG(2).$implicit;e.R7$(),e.JRh(r.name)}}function te(s,_){if(1&s){const r=e.RV6();e.j41(0,"ion-button",48),e.bIt("click",function(){e.eBV(r);const t=e.XpG(2).$implicit,n=e.XpG(2);return e.Njj(n.OpenFile(t))}),e.EFF(1),e.k0s()}if(2&s){const r=e.XpG(4);e.R7$(),e.SpI(" ",r.lang.text.UserFsDir.Open," ")}}function ie(s,_){if(1&s){const r=e.RV6();e.j41(0,"ion-button",48),e.bIt("click",function(){e.eBV(r);const t=e.XpG(2).$implicit,n=e.XpG(2);return e.Njj(n.dismiss_page(t))}),e.EFF(1),e.k0s()}if(2&s){const r=e.XpG(4);e.R7$(),e.SpI(" ",r.lang.text.UserFsDir.Select," ")}}function ne(s,_){if(1&s){const r=e.RV6();e.j41(0,"ion-button",48),e.bIt("click",function(){e.eBV(r);const t=e.XpG(2).$implicit,n=e.XpG(2);return e.Njj(n.DownloadFile(t))}),e.EFF(1),e.k0s()}if(2&s){const r=e.XpG(4);e.R7$(),e.SpI(" ",r.lang.text.UserFsDir.Download," ")}}function re(s,_){if(1&s){const r=e.RV6();e.j41(0,"div",49),e.bIt("click",function(){e.eBV(r);const t=e.XpG(2).$implicit,n=e.XpG(2);return e.Njj(n.OpenFile(t))}),e.nrm(1,"img",50),e.k0s()}if(2&s){const r=e.XpG(2).$implicit,i=e.XpG(2);e.R7$(),e.Aen(i.HideThumbnail?"filter: blur(6px);":""),e.Y8G("src",r.thumbnail,e.B4B)("alt",r.name)}}function se(s,_){if(1&s){const r=e.RV6();e.j41(0,"ion-accordion",23)(1,"ion-item",24),e.DNE(2,Y,1,0,"ion-icon",25)(3,H,1,0,"ion-icon",26)(4,W,1,0,"ion-icon",27)(5,z,1,0,"ion-icon",28)(6,J,1,0,"ion-icon",29)(7,K,1,0,"ion-icon",30)(8,Q,1,0,"ion-icon",31)(9,Z,1,0,"ion-icon",32)(10,q,2,1,"ion-label",33)(11,ee,2,1,"ion-label",9),e.nrm(12,"ion-icon",34),e.k0s(),e.j41(13,"div",35)(14,"ion-item",12)(15,"ion-label"),e.EFF(16),e.k0s(),e.DNE(17,te,2,1,"ion-button",36)(18,ie,2,1,"ion-button",36)(19,ne,2,1,"ion-button",36),e.j41(20,"ion-button",37),e.bIt("click",function(){e.eBV(r);const t=e.XpG(),n=t.$implicit,o=t.index,l=e.XpG(2);return e.Njj(l.RemoveFile(n,o))}),e.EFF(21),e.k0s()(),e.DNE(22,re,2,4,"div",38),e.k0s()()}if(2&s){const r=e.XpG().$implicit;e.XpG();const i=e.sdS(17),t=e.XpG();e.Y8G("value",r.path),e.R7$(2),e.Y8G("ngIf","image"==r.viewer),e.R7$(),e.Y8G("ngIf","audio"==r.viewer),e.R7$(),e.Y8G("ngIf","video"==r.viewer),e.R7$(),e.Y8G("ngIf","text"==r.viewer),e.R7$(),e.Y8G("ngIf","godot"==r.viewer),e.R7$(),e.Y8G("ngIf","code"==r.viewer),e.R7$(),e.Y8G("ngIf","blender"==r.viewer),e.R7$(),e.Y8G("ngIf","disabled"==r.viewer),e.R7$(),e.Y8G("ngIf",i.value==r.path),e.R7$(),e.Y8G("ngIf",i.value!=r.path),e.R7$(5),e.JRh(t.lang.text.UserFsDir.Action),e.R7$(),e.Y8G("ngIf","image"!=r.viewer),e.R7$(),e.Y8G("ngIf",t.is_file_selector),e.R7$(),e.Y8G("ngIf",t.cant_dedicated&&!t.is_file_selector),e.R7$(2),e.SpI(" ",t.lang.text.UserFsDir.Delete," "),e.R7$(),e.Y8G("ngIf","image"==r.viewer)}}function oe(s,_){if(1&s&&(e.j41(0,"div"),e.DNE(1,se,23,17,"ion-accordion",22),e.k0s()),2&s){const r=_.$implicit,i=e.XpG(2);e.R7$(),e.Y8G("ngIf",i.CurrentDir==r.dir||i.is_file_selector)}}function le(s,_){if(1&s){const r=e.RV6();e.j41(0,"ion-list"),e.DNE(1,N,6,1,"div",9),e.j41(2,"div")(3,"ion-item",12),e.nrm(4,"ion-icon",13),e.j41(5,"ion-label"),e.EFF(6,"."),e.k0s(),e.DNE(7,X,2,1,"ion-button",14),e.j41(8,"ion-button",15),e.bIt("click",function(){e.eBV(r);const t=e.XpG();return e.Njj(t.CreateNewFolder())}),e.EFF(9),e.k0s(),e.j41(10,"ion-button",15),e.bIt("click",function(){e.eBV(r);const t=e.XpG();return e.Njj(t.SelectFiles())}),e.EFF(11),e.k0s(),e.j41(12,"ion-button",16),e.bIt("click",function(){e.eBV(r);const t=e.XpG();return e.Njj(t.RemoveDirectoryRecursive())}),e.EFF(13),e.k0s()(),e.DNE(14,V,4,0,"ion-item",17),e.k0s(),e.DNE(15,M,2,1,"div",18),e.j41(16,"ion-accordion-group",null,0),e.DNE(18,oe,2,1,"div",18),e.k0s()()}if(2&s){const r=e.XpG();e.R7$(),e.Y8G("ngIf",""==r.CurrentDir&&!r.is_file_selector&&r.CanImportFolder),e.R7$(6),e.Y8G("ngIf",!r.cant_dedicated),e.R7$(2),e.SpI(" ",r.lang.text.UserFsDir.NewFolder," "),e.R7$(2),e.SpI(" ",r.lang.text.UserFsDir.AddFile," "),e.R7$(2),e.SpI(" ",r.lang.text.UserFsDir.RemoveCurrentDir," "),e.R7$(),e.Y8G("ngIf",""!=r.CurrentDir),e.R7$(),e.Y8G("ngForOf",r.DirList),e.R7$(3),e.Y8G("ngForOf",r.FileList)}}function ae(s,_){if(1&s){const r=e.RV6();e.j41(0,"ion-item",19),e.bIt("click",function(){e.eBV(r);const t=e.XpG().$implicit,n=e.XpG(2);return e.Njj(n.importFolderMiddleAct(t))}),e.nrm(1,"ion-icon",13),e.j41(2,"ion-label"),e.EFF(3),e.k0s()()}if(2&s){const r=e.XpG().$implicit;e.R7$(3),e.JRh(r.name)}}function ce(s,_){if(1&s&&(e.j41(0,"ion-item",53),e.nrm(1,"ion-icon",46),e.j41(2,"ion-label"),e.EFF(3),e.k0s()()),2&s){const r=e.XpG().$implicit;e.R7$(3),e.JRh(r.name)}}function _e(s,_){if(1&s&&(e.j41(0,"div"),e.DNE(1,ae,4,1,"ion-item",17)(2,ce,4,1,"ion-item",52),e.k0s()),2&s){const r=_.$implicit;e.R7$(),e.Y8G("ngIf",r.isDirectory),e.R7$(),e.Y8G("ngIf",r.isFile)}}function de(s,_){if(1&s){const r=e.RV6();e.j41(0,"ion-list")(1,"ion-item",19),e.bIt("click",function(){e.eBV(r);const t=e.XpG();return e.Njj(t.InAppBrowser=!0)}),e.nrm(2,"ion-icon",13),e.j41(3,"ion-label",51),e.EFF(4,"/sdcard/Android/data/org.pjcone.portal/files"),e.k0s()(),e.DNE(5,_e,3,2,"div",18),e.k0s()}if(2&s){const r=e.XpG();e.R7$(5),e.Y8G("ngForOf",r.ExternalFolder)}}let pe=(()=>{var s;class _{constructor(i,t,n,o,l,c,a,m,u,p,F,me,ue){this.modalCtrl=i,this.indexed=t,this.loadingCtrl=n,this.lang=o,this.global=l,this.p5toast=c,this.alertCtrl=a,this.sanitizer=m,this.file=u,this.navCtrl=p,this.noti=F,this.navParams=me,this.nakama=ue,this.DirList=[],this.FileList=[],this.cant_dedicated=!1,this.InAppBrowser=!0,this.is_ready=!1,this.is_file_selector=!1,this.HideThumbnail=!1,this.CanImportFolder=!0,this.BackButtonPressed=!1,this.StopIndexing=!1,this.lock_modal_open=!1,this.isCreateFolderRecursive=!1,this.ExternalFolder=[]}toggle_thumbnail(){this.HideThumbnail=!this.HideThumbnail,localStorage.setItem("user-fs-thumbnail",this.HideThumbnail?"1":"0")}InitBrowserBackButtonOverride(){try{window.history.pushState(null,null,window.location.href),window.onpopstate=()=>{this.BackButtonPressed||(this.BackButtonPressed=!0,this.navCtrl.back())}}catch(i){console.log("\ud0d0\uc0c9 \uae30\ub85d \ubcc0\uacbd\uc2dc \uc624\ub958 \ubc1c\uc0dd: ",i)}}ngOnInit(){this.InitBrowserBackButtonOverride(),"DesktopPWA"==D.aH&&setTimeout(()=>{this.CreateDrop()},100),this.CanImportFolder="MobilePWA"!=D.aH}ionViewDidEnter(){this.global.p5key.KeyShortCut.Escape=()=>{this.is_ready?""==this.CurrentDir?this.navCtrl.pop():this.MoveToUpDir():(this.initLoadingElement.dismiss(),this.is_ready=!0)}}CreateDrop(){var i=this;let t=document.getElementById("p5Drop_userfs");this.p5canvas=new R(n=>{n.setup=()=>{let m=n.createCanvas(t.clientWidth,t.clientHeight);m.parent(t),n.pixelDensity(.1),m.drop(u=>{let p=n.millis();c<p-400?(l=!1,a.length=0,a.push(u)):(l=!0,a.push(u)),c=p,clearTimeout(o),o=setTimeout((0,h.A)(function*(){if(l)i.MultipleDrops(a);else{let F=yield i.loadingCtrl.create({message:i.lang.text.TodoDetail.WIP});F.present(),i.importSelected(u.file),F.dismiss()}}),400)})};let o,l=!1,c=0,a=[];n.mouseMoved=m=>{m.dataTransfer?(t.style.pointerEvents="all",t.style.backgroundColor="#0008"):(t.style.pointerEvents="none",t.style.backgroundColor="transparent")}})}CreateNewFolder(){var t,i=this;this.alertCtrl.create({header:this.lang.text.UserFsDir.CreateFolder,inputs:[{type:"text",placeholder:this.lang.text.UserFsDir.FolderName}],buttons:[{text:this.lang.text.UserFsDir.Create,handler:(t=(0,h.A)(function*(n){if(n[0])try{let o=`${i.CurrentDir}/${n[0]}`;yield i.indexed.createDirectory(o);let l=yield i.indexed.GetFileInfoFromDB(o),c={path:o,mode:l.mode,timestamp:l.timestamp,db:i.indexed.ionicDB};c.name=n[0],c.dir=i.CurrentDir,i.DirList.push(c)}catch(o){console.error("\ud3f4\ub354 \uc0dd\uc131 \uc2e4\ud328: ",o),i.p5toast.show({text:`${i.lang.text.UserFsDir.FailedToCreateFolder}: ${o}`})}else i.p5toast.show({text:i.lang.text.UserFsDir.NeedFolderName})}),function(o){return t.apply(this,arguments)})}]}).then(t=>{this.global.p5key.KeyShortCut.Escape=()=>{t.dismiss()},t.onDidDismiss().then(()=>{this.ionViewDidEnter()}),t.present()})}SelectFiles(){document.getElementById("import_file").click()}MultipleDrops(i){var t=this;return(0,h.A)(function*(){let n=yield t.loadingCtrl.create({message:t.lang.text.TodoDetail.WIP});n.present();for(let o=0,l=i.length;o<l;o++)yield t.importSelected(i[o].file);n.dismiss()})()}inputFileSelected(i){var t=this;return(0,h.A)(function*(){if(i.target.files.length)if(1!=i.target.files.length){let o=yield t.loadingCtrl.create({message:t.lang.text.UserFsDir.MultipleSave});o.present();for(let l=0,c=i.target.files.length;l<c&&!t.StopIndexing;l++)o.message=`${t.lang.text.UserFsDir.MultipleSave}: ${c-l}`,yield t.importSelected(i.target.files[l]);t.noti.ClearNoti(4),o.dismiss()}else{let o=yield t.loadingCtrl.create({message:t.lang.text.TodoDetail.WIP});o.present(),yield t.importSelected(i.target.files[0]),o.dismiss()}})()}importSelected(i){var t=this;return(0,h.A)(function*(){try{let n=`${t.CurrentDir}/${i.name}`;yield t.indexed.saveBlobToUserPath(i,n);let o=yield t.indexed.GetFileInfoFromDB(n),l={path:n,mode:o.mode,timestamp:o.timestamp,db:t.indexed.ionicDB};l.name=i.name,l.dir=t.CurrentDir,l.file_ext=l.name.split(".").pop(),t.global.set_viewer_category_from_ext(l),"image"==l.viewer&&t.indexed.loadBlobFromUserPath(l.path,"",c=>{let a=URL.createObjectURL(c);l.thumbnail=t.sanitizer.bypassSecurityTrustUrl(a)});try{let c=l.path.split("/");if(5!=c.length||"groups"!=c[3])throw"\uadf8\ub8f9 \uc774\ubbf8\uc9c0 \ud30c\uc77c\uc774 \uc544\ub2d8";t.SetDisplayGroupImageName(l,c)}catch{}for(let c=0,a=t.FileList.length;c<a;c++)if(t.FileList[c].path==n){t.FileList.splice(c,1);break}t.FileList.push(l)}catch(n){console.log("importSelected error: ",n)}})()}ionViewWillEnter(){this.HideThumbnail="1"==localStorage.getItem("user-fs-thumbnail"),this.CurrentDir="",this.is_file_selector=!!this.navParams.data.modal,this.LoadAllIndexedFiles(),("DesktopPWA"==D.aH||"MobilePWA"==D.aH)&&(this.cant_dedicated=!0)}dismiss_page(i){var t=this;return(0,h.A)(function*(){if(t.is_file_selector){let n;i&&(n=yield t.indexed.loadBlobFromUserPath(i.path,""),n.name=i.name,n.file_ext=i.file_ext),t.modalCtrl.dismiss(n)}})()}LoadAllIndexedFiles(){var i=this;return(0,h.A)(function*(){if(i.initLoadingElement=yield i.loadingCtrl.create({message:i.lang.text.UserFsDir.LoadingExplorer}),i.initLoadingElement.present(),i.DirList.length=0,i.FileList.length=0,i.is_file_selector)if(i.navParams.get("path")){let t=yield i.indexed.GetFileListFromDB(i.navParams.get("path"));yield i.ModulateIndexedFile(t)}else{let t=yield i.indexed.GetFileListFromDB("/files/");yield i.ModulateIndexedFile(t)}else{let t=yield i.indexed.GetFileListFromDB("/");yield i.ModulateIndexedFile(t)}i.is_file_selector?i.FileList.sort((t,n)=>t.timestamp<n.timestamp?1:t.timestamp>n.timestamp?-1:0):(i.FileList.sort((t,n)=>t.path>n.path?1:t.path<n.path?-1:0),i.DirList.sort((t,n)=>t.path>n.path?1:t.path<n.path?-1:0)),i.noti.ClearNoti(5),i.initLoadingElement.dismiss(),i.is_ready=!0})()}ModulateIndexedFile(i){var t=this;return(0,h.A)(function*(){for(let n=0,o=i.length;n<o;n++){if(t.StopIndexing)return;t.initLoadingElement.message=`${t.lang.text.UserFsDir.LoadingExplorer}: ${i.length-n}`,yield t.indexed.GetFileInfoFromDB(i[n],c=>{let a={path:i[n],mode:c.mode,timestamp:c.timestamp};switch(a.name=a.path.substring(a.path.lastIndexOf("/")+1),a.dir=i[n].substring(0,i[n].lastIndexOf("/")),a.mode){case 33206:a.file_ext=a.name.split(".").pop(),t.global.set_viewer_category_from_ext(a),"image"==a.viewer&&t.indexed.loadBlobFromUserPath(a.path,"",p=>{let F=URL.createObjectURL(p);a.thumbnail=t.sanitizer.bypassSecurityTrustUrl(F)});try{let p=a.path.split("/");if(5!=p.length||"groups"!=p[3])throw"\uadf8\ub8f9 \uc774\ubbf8\uc9c0 \ud30c\uc77c\uc774 \uc544\ub2d8";t.SetDisplayGroupImageName(a,p)}catch{}t.FileList.push(a);break;case 16893:0==a.path.indexOf("todo/")&&t.SetDisplayTodoName(a);let m=!1,u=a.path.split("/");try{if(5!=u.length||"channels"!=u[3])throw"\ucc44\ub110 \ud3f4\ub354\uac00 \uc544\ub2d8";t.SetDisplayChannelName(a,u),m=!0}catch{}try{if(m||5!=u.length||"users"!=u[3])throw"\uc0ac\uc6a9\uc790 \ud3f4\ub354\uac00 \uc544\ub2d8";t.SetDisplayUserName(a,u),m=!0}catch{}t.DirList.push(a);break;default:console.log("\uc608\uc0c1\ud558\uc9c0 \ubabb\ud55c \ud30c\uc77c \ubaa8\ub4dc: ",a)}})}t.noti.ClearNoti(5)})()}SetDisplayTodoName(i){var t=this;return(0,h.A)(function*(){try{let n=yield t.indexed.loadTextFromUserPath(`${i.path}/info.todo`),o=JSON.parse(n);i.name=o.title}catch(n){console.error("SetDisplayTodoName error: ",n)}})()}SetDisplayUserName(i,t){try{i.name=this.nakama.users[t[1]][t[2]][t[4]].display_name}catch{}}SetDisplayChannelName(i,t){try{i.name=this.nakama.channels_orig[t[1]][t[2]][i.name].title}catch{}}SetDisplayGroupImageName(i,t){try{i.name=`${this.nakama.groups[t[1]][t[2]][t[4].split(".").shift()].name}.img`}catch(n){console.log("SetDisplayGroupImageName error: ",n)}}MoveToUpDir(){this.CurrentDir=this.CurrentDir.substring(0,this.CurrentDir.lastIndexOf("/")),this.FileSel.value=void 0}SelectFolder(i){this.CurrentDir=i.path,this.FileSel.value=void 0}OpenFile(i){var t=this;return(0,h.A)(function*(){if(t.lock_modal_open||(t.lock_modal_open=!0,!t.CheckIfAccessable(i.path)))return;let n=[];if(t.is_file_selector){if(t.navParams.data.path)for(let o=0,l=t.FileList.length;o<l;o++)n.push({content:t.FileList[o]})}else for(let o=0,l=t.FileList.length;o<l;o++)t.FileList[o].dir==t.CurrentDir&&n.push({content:t.FileList[o]});{let o=yield t.indexed.loadBlobFromUserPath(i.path,"");i.size=o.size}t.modalCtrl.create({component:b.c,componentProps:{info:{content:i},no_edit:!0,path:i.path,relevance:n},cssClass:"fullscreen"}).then(o=>{delete t.global.p5key.KeyShortCut.Escape,delete t.global.p5key.KeyShortCut.Digit,o.onDidDismiss().then(l=>{if(t.lock_modal_open=!1,l.data)switch(l.data.type){case"image":return void t.modalCtrl.create({component:C.c,componentProps:{path:l.data.path,width:l.data.width,height:l.data.height,text:l.data.text,isDarkMode:l.data.isDarkMode,scrollHeight:l.data.scrollHeight},cssClass:"fullscreen"}).then(c=>{c.onWillDismiss().then(function(){var a=(0,h.A)(function*(m){if(m.data){let u=t.global.Base64ToBlob(m.data.img,"image/png");u.name=m.data.name,yield t.importSelected(u),m.data.loadingCtrl.dismiss()}t.ionViewDidEnter()});return function(m){return a.apply(this,arguments)}}()),c.present()});case"text":t.importSelected(l.data.blob)}else t.ionViewDidEnter()}),o.present()})})()}CheckIfAccessable(i){switch(i){case"servers/webrtc_server.json":case"servers/self/profile.json":return this.p5toast.show({text:this.lang.text.UserFsDir.PrivateAccessDenied}),!1}return!0}DownloadFile(i){this.CheckIfAccessable(i.path)&&this.indexed.DownloadFileFromUserPath(i.path,"",i.name)}ExportDirectoryRecursive(){this.alertCtrl.create({header:this.lang.text.UserFsDir.ExportDirTitle,message:this.lang.text.UserFsDir.ExportDirMsg,buttons:[{text:this.lang.text.UserFsDir.ExportConfirm,handler:()=>{this.ExportDirectoryRecursiveAct()}}]}).then(i=>{this.global.p5key.KeyShortCut.Escape=()=>{i.dismiss()},i.onDidDismiss().then(()=>{this.ionViewDidEnter()}),i.present()})}ExportDirectoryRecursiveAct(){var i=this;return(0,h.A)(function*(){let t=yield i.loadingCtrl.create({message:i.lang.text.UserFsDir.ExportDirTitle});t.present();let n=yield i.indexed.GetFileListFromDB(i.CurrentDir);for(let o=0,l=n.length;o<l;o++){if(i.StopIndexing)return void t.dismiss();let c=yield i.indexed.GetFileInfoFromDB(n[o]),a=yield i.indexed.loadBlobFromUserPath(n[o],""),m=n[o].lastIndexOf("/"),u=n[o].substring(0,m),p=n[o].substring(m+1);i.isCreateFolderRecursive||(i.isCreateFolderRecursive=!0,yield i.CreateFolderRecursive(u));try{if(16893==c.mode)throw yield i.file.createDir(i.file.externalDataDirectory+u,p,!0),t.message=`${i.lang.text.UserFsDir.ExportDirTitle}: ${p}`,"\uc774\uac70 \ud3f4\ub354\uc784";if(!i.CheckIfAccessable(n[o]))throw"\uc5f4\ub78c \ubd88\uac00 \ud30c\uc77c \uc81c\uc678";t.message=`${i.lang.text.UserFsDir.ExportDirTitle}: ${p}`,yield i.file.writeFile(i.file.externalDataDirectory+u+"/",p,a,{replace:!0})}catch(F){console.error(n[o],": \ud30c\uc77c \uc800\uc7a5 \uc2e4\ud328: ",F)}}i.isCreateFolderRecursive=!1,t.dismiss()})()}CreateFolderRecursive(i){var t=this;return(0,h.A)(function*(){let n=i.lastIndexOf("/")+1,o=i.substring(0,n),l=i.substring(n);o&&(yield t.CreateFolderRecursive(i.substring(0,n-1)));try{yield t.file.createDir(t.file.externalDataDirectory+o,l,!0)}catch{}})()}BrowseExternalFiles(){var i=this;return(0,h.A)(function*(){i.ExternalFolder.length=0,i.InAppBrowser=!1,i.ExternalFolder=yield i.file.listDir(i.file.externalApplicationStorageDirectory,"files"),i.ExternalFolder.sort(),i.ExternalFolder.sort((t,n)=>t.isDirectory?-1:1)})()}importFolderMiddleAct(i){var t=this;return(0,h.A)(function*(){let n=yield t.loadingCtrl.create({message:t.lang.text.UserFsDir.Import});n.present(),yield t.importThisFolder(i,n),t.InAppBrowser=!0,n.dismiss(),t.p5toast.show({text:t.lang.text.UserFsDir.NeedResetToApply})})()}importThisFolder(i,t){var n=this;return(0,h.A)(function*(){let o=i.nativeURL.substring(0,i.nativeURL.length-1),l=o.lastIndexOf("/"),c=[];try{c=yield n.file.listDir(o.substring(0,l)+"/",o.substring(l+1))}catch{}for(let a=0,m=c.length;a<m;a++){if(n.StopIndexing)return void t.dismiss();if(c[a].isDirectory)yield n.importThisFolder(c[a],t);else{let u=c[a].nativeURL.split("org.pjcone.portal/files/")[1];try{t.message=`${n.lang.text.UserFsDir.Import}: ${c[a].name}`;let F=(yield k.readFile({path:c[a].nativeURL})).data.replace(/"|\\|=/g,"");yield n.indexed.saveBase64ToUserPath(","+F,decodeURIComponent(u))}catch(p){console.log("\ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",p),n.p5toast.show({text:`${n.lang.text.UserFsDir.ImportFailed}: ${p}`})}}}})()}SelectImportFolder(){this.cant_dedicated?document.getElementById("folder_sel_id").click():this.BrowseExternalFiles()}inputImageSelected(i){var t=this;return(0,h.A)(function*(){let n=yield t.loadingCtrl.create({message:t.lang.text.UserFsDir.LoadingExplorer});n.present();for(let o=0,l=i.target.files.length;o<l;o++){if(t.StopIndexing)return void n.dismiss();yield t.indexed.saveBlobToUserPath(i.target.files[o],i.target.files[o].webkitRelativePath)}t.LoadAllIndexedFiles(),n.dismiss(),t.p5toast.show({text:t.lang.text.UserFsDir.NeedResetToApply})})()}RemoveDirectoryRecursive(){var t,i=this;this.alertCtrl.create({header:this.CurrentDir.substring(this.CurrentDir.lastIndexOf("/")+1)||this.lang.text.UserFsDir.ResetDB,message:this.lang.text.UserFsDir.RemoveThisFolder,buttons:[{text:this.lang.text.UserFsDir.RemoveApply,handler:(t=(0,h.A)(function*(){let n=yield i.loadingCtrl.create({message:i.lang.text.UserFsDir.DeleteFile});n.present();let o=yield i.indexed.GetFileListFromDB(i.CurrentDir);for(let l=0,c=o.length;l<c;l++){if(i.StopIndexing)return void n.dismiss();n.message=`${i.lang.text.UserFsDir.DeleteFile}: ${c-l}`,yield i.indexed.removeFileFromUserPath(o[l])}for(let l=i.DirList.length-1;l>=0;l--)0==i.DirList[l].path.indexOf(i.CurrentDir)&&i.DirList.splice(l,1);for(let l=i.FileList.length-1;l>=0;l--)0==i.FileList[l].path.indexOf(i.CurrentDir)&&i.FileList.splice(l,1);i.MoveToUpDir(),n.dismiss(),i.noti.ClearNoti(4)}),function(){return t.apply(this,arguments)}),cssClass:"redfont"}]}).then(t=>{this.global.p5key.KeyShortCut.Escape=()=>{t.dismiss()},t.onDidDismiss().then(()=>{this.ionViewDidEnter()}),t.present()})}RemoveFile(i,t){this.alertCtrl.create({header:this.lang.text.UserFsDir.DeleteFile,message:this.lang.text.ChatRoom.CannotUndone,buttons:[{text:this.lang.text.UserFsDir.DeleteAccept,handler:()=>{this.indexed.removeFileFromUserPath(i.path,()=>{this.FileList.splice(t,1)})},cssClass:"redfont"}]}).then(n=>{this.global.p5key.KeyShortCut.Escape=()=>{n.dismiss()},n.onDidDismiss().then(()=>{this.ionViewDidEnter()}),n.present()})}ionViewDidLeave(){this.StopIndexing=!0,this.FileList.forEach(i=>{URL.revokeObjectURL(i.thumbnail)}),setTimeout(()=>{this.noti.ClearNoti(4),this.noti.ClearNoti(5)},1e3)}ionViewWillLeave(){delete this.global.p5key.KeyShortCut.Escape,delete this.global.p5key.KeyShortCut.Digit}}return(s=_).\u0275fac=function(i){return new(i||s)(e.rXU(g.W3),e.rXU(T.n),e.rXU(g.Xi),e.rXU(P.y),e.rXU(E.z3),e.rXU(G.G),e.rXU(g.hG),e.rXU(j.up),e.rXU($.Z),e.rXU(y.q9),e.rXU(S.r),e.rXU(y.y8),e.rXU(B.X))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-user-fs-dir"]],viewQuery:function(i,t){if(1&i&&e.GBs(w,5),2&i){let n;e.mGM(n=e.lsd())&&(t.FileSel=n.first)}},decls:13,vars:5,consts:[["FileSel",""],[1,"ion-no-border"],["slot","start",3,"click"],["defaultHref",""],["class","top_icon","slot","end","name","eye-outline",3,"click",4,"ngIf"],["class","top_icon","slot","end","name","eye-off-outline",3,"click",4,"ngIf"],["oncontextmenu","return false;"],["id","p5Drop_userfs",2,"position","absolute","width","100%","height","100%","display","flex","pointer-events","none"],["hidden","","type","file","id","import_file","accept","*","multiple","",3,"change"],[4,"ngIf"],["slot","end","name","eye-outline",1,"top_icon",3,"click"],["slot","end","name","eye-off-outline",1,"top_icon",3,"click"],["button",""],["slot","start","name","folder"],["class","folder_button",3,"click",4,"ngIf"],[1,"folder_button",3,"click"],[3,"click"],["button","",3,"click",4,"ngIf"],[4,"ngFor","ngForOf"],["button","",3,"click"],["slot","start","name","arrow-down-circle"],["hidden","","type","file","id","folder_sel_id","webkitdirectory","",3,"change"],[3,"value",4,"ngIf"],[3,"value"],["slot","header"],["slot","start","name","image",4,"ngIf"],["slot","start","name","musical-notes",4,"ngIf"],["slot","start","name","play-circle",4,"ngIf"],["slot","start","name","reader",4,"ngIf"],["slot","start","name","extension-puzzle",4,"ngIf"],["slot","start","name","code-slash-outline",4,"ngIf"],["slot","start","name","cube-outline",4,"ngIf"],["slot","start","name","document",4,"ngIf"],["text-wrap","",4,"ngIf"],[1,"ion-accordion-toggle-icon","hide_accordion_icon"],["slot","content"],["class","ion-text-right button_dist",3,"click",4,"ngIf"],[1,"ion-text-end","button_dist",3,"click"],["class","image_front_form",3,"click",4,"ngIf"],["slot","start","name","image"],["slot","start","name","musical-notes"],["slot","start","name","play-circle"],["slot","start","name","reader"],["slot","start","name","extension-puzzle"],["slot","start","name","code-slash-outline"],["slot","start","name","cube-outline"],["slot","start","name","document"],["text-wrap",""],[1,"ion-text-right","button_dist",3,"click"],[1,"image_front_form",3,"click"],[1,"image_front_view",3,"src","alt"],["color","medium"],["button","","disabled","",4,"ngIf"],["button","","disabled",""]],template:function(i,t){1&i&&(e.j41(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-title"),e.EFF(3),e.k0s(),e.j41(4,"ion-buttons",2),e.bIt("click",function(){return t.dismiss_page()}),e.nrm(5,"ion-back-button",3),e.k0s(),e.DNE(6,L,1,0,"ion-icon",4)(7,A,1,0,"ion-icon",5),e.k0s()(),e.j41(8,"ion-content",6)(9,"div",7)(10,"input",8),e.bIt("change",function(o){return t.inputFileSelected(o)}),e.k0s()(),e.DNE(11,le,19,8,"ion-list",9)(12,de,6,1,"ion-list",9),e.k0s()),2&i&&(e.R7$(3),e.JRh(t.lang.text.Settings.InAppExplorer),e.R7$(3),e.Y8G("ngIf",!t.HideThumbnail),e.R7$(),e.Y8G("ngIf",t.HideThumbnail),e.R7$(4),e.Y8G("ngIf",t.InAppBrowser),e.R7$(),e.Y8G("ngIf",!t.InAppBrowser))},dependencies:[U.Sq,U.bT,g.xk,g.YH,g.Jm,g.QW,g.W9,g.eU,g.iq,g.uz,g.he,g.nf,g.BC,g.ai,g.el],styles:[".item.sc-ion-label-md-h[_ngcontent-%COMP%], .item[_ngcontent-%COMP%]   .sc-ion-label-md-h[_ngcontent-%COMP%]{overflow:unset}.image_front_form[_ngcontent-%COMP%]{display:flex;justify-content:center;text-align:center}.image_front_view[_ngcontent-%COMP%]{max-height:233px}.top_icon[_ngcontent-%COMP%]{width:28px;height:28px;padding-right:28px;cursor:pointer}.button_dist[_ngcontent-%COMP%]{padding-left:2px}.folder_button[_ngcontent-%COMP%]{padding-right:4px}"]}),_})()}}]);