"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7048],{5404:(b,x,_)=>{_.d(x,{Gq:()=>f});var f=function(F){return F.UTF8="utf8",F.ASCII="ascii",F.UTF16="utf16",F}(f||{})},7048:(b,x,_)=>{_.d(x,{w:()=>me});var g=_(1528),f=_(5193),y=_(3664),C=_(6400);_(5404);const G=(0,C.C_)("Filesystem",{web:()=>_.e(7688).then(_.bind(_,7688)).then(r=>new r.FilesystemWeb)});var U=_(9352),E=_(8372),e=_(4496),h=_(5624),v=_(9240),T=_(4668),R=_(4500),k=_(5020),O=_(3824),P=_(4476),w=_(544),S=_(6819),$=_(7136),I=_(1368);const L=["FileSel"];function A(r,d){if(1&r){const s=e.KQA();e.I0R(0,"ion-icon",9),e.qCj("click",function(){e.usT(s);const t=e.GaO();return e.CGJ(t.toggle_thumbnail())}),e.C$Y()}}function B(r,d){if(1&r){const s=e.KQA();e.I0R(0,"ion-icon",10),e.qCj("click",function(){e.usT(s);const t=e.GaO();return e.CGJ(t.toggle_thumbnail())}),e.C$Y()}}function Y(r,d){if(1&r){const s=e.KQA();e.I0R(0,"div")(1,"ion-item",19),e.qCj("click",function(){e.usT(s);const t=e.GaO(2);return e.CGJ(t.SelectImportFolder())}),e.wR5(2,"ion-icon",20),e.I0R(3,"ion-label"),e.OEk(4),e.C$Y()(),e.I0R(5,"input",21),e.qCj("change",function(t){e.usT(s);const n=e.GaO(2);return e.CGJ(n.inputImageSelected(t))}),e.C$Y()()}if(2&r){const s=e.GaO(2);e.yG2(4),e.oRS(" ",s.lang.text.UserFsDir.ImportFolder," ")}}function j(r,d){if(1&r){const s=e.KQA();e.I0R(0,"ion-button",14),e.qCj("click",function(){e.usT(s);const t=e.GaO(2);return e.CGJ(t.ExportDirectoryRecursive())}),e.OEk(1),e.C$Y()}if(2&r){const s=e.GaO(2);e.yG2(),e.oRS(" ",s.lang.text.UserFsDir.ExportDir," ")}}function M(r,d){if(1&r){const s=e.KQA();e.I0R(0,"ion-item",19),e.qCj("click",function(){e.usT(s);const t=e.GaO(2);return e.CGJ(t.MoveToUpDir())}),e.wR5(1,"ion-icon",12),e.I0R(2,"ion-label"),e.OEk(3,".."),e.C$Y()()}}function N(r,d){if(1&r){const s=e.KQA();e.I0R(0,"ion-item",19),e.qCj("click",function(){e.usT(s);const t=e.GaO().$implicit,n=e.GaO(2);return e.CGJ(n.SelectFolder(t))}),e.wR5(1,"ion-icon",12),e.I0R(2,"ion-label"),e.OEk(3),e.C$Y()()}if(2&r){const s=e.GaO().$implicit;e.yG2(3),e.cNF(s.name)}}function K(r,d){if(1&r&&(e.I0R(0,"div"),e.yuY(1,N,4,1,"ion-item",16),e.C$Y()),2&r){const s=d.$implicit,i=e.GaO(2);e.yG2(),e.E7m("ngIf",i.CurrentDir==s.dir)}}function J(r,d){1&r&&e.wR5(0,"ion-icon",39)}function Q(r,d){1&r&&e.wR5(0,"ion-icon",40)}function H(r,d){1&r&&e.wR5(0,"ion-icon",41)}function V(r,d){1&r&&e.wR5(0,"ion-icon",42)}function W(r,d){1&r&&e.wR5(0,"ion-icon",43)}function z(r,d){1&r&&e.wR5(0,"ion-icon",44)}function X(r,d){1&r&&e.wR5(0,"ion-icon",45)}function q(r,d){1&r&&e.wR5(0,"ion-icon",46)}function Z(r,d){if(1&r&&(e.I0R(0,"ion-label",47),e.OEk(1),e.C$Y()),2&r){const s=e.GaO(2).$implicit;e.yG2(),e.cNF(s.name)}}function ee(r,d){if(1&r&&(e.I0R(0,"ion-label"),e.OEk(1),e.C$Y()),2&r){const s=e.GaO(2).$implicit;e.yG2(),e.cNF(s.name)}}function te(r,d){if(1&r){const s=e.KQA();e.I0R(0,"ion-button",48),e.qCj("click",function(){e.usT(s);const t=e.GaO(2).$implicit,n=e.GaO(2);return e.CGJ(n.OpenFile(t))}),e.OEk(1),e.C$Y()}if(2&r){const s=e.GaO(4);e.yG2(),e.oRS(" ",s.lang.text.UserFsDir.Open," ")}}function ie(r,d){if(1&r){const s=e.KQA();e.I0R(0,"ion-button",48),e.qCj("click",function(){e.usT(s);const t=e.GaO(2).$implicit,n=e.GaO(2);return e.CGJ(n.dismiss_page(t))}),e.OEk(1),e.C$Y()}if(2&r){const s=e.GaO(4);e.yG2(),e.oRS(" ",s.lang.text.UserFsDir.Select," ")}}function ne(r,d){if(1&r){const s=e.KQA();e.I0R(0,"ion-button",48),e.qCj("click",function(){e.usT(s);const t=e.GaO(2).$implicit,n=e.GaO(2);return e.CGJ(n.DownloadFile(t))}),e.OEk(1),e.C$Y()}if(2&r){const s=e.GaO(4);e.yG2(),e.oRS(" ",s.lang.text.UserFsDir.Download," ")}}function se(r,d){if(1&r){const s=e.KQA();e.I0R(0,"div",49),e.qCj("click",function(){e.usT(s);const t=e.GaO(2).$implicit,n=e.GaO(2);return e.CGJ(n.OpenFile(t))}),e.wR5(1,"img",50),e.C$Y()}if(2&r){const s=e.GaO(2).$implicit,i=e.GaO(2);e.yG2(),e.m_g(i.HideThumbnail?"filter: blur(6px);":""),e.E7m("src",s.thumbnail,e.K6U)("alt",s.name)}}function re(r,d){if(1&r){const s=e.KQA();e.I0R(0,"ion-accordion",23)(1,"ion-item",24),e.yuY(2,J,1,0,"ion-icon",25)(3,Q,1,0,"ion-icon",26)(4,H,1,0,"ion-icon",27)(5,V,1,0,"ion-icon",28)(6,W,1,0,"ion-icon",29)(7,z,1,0,"ion-icon",30)(8,X,1,0,"ion-icon",31)(9,q,1,0,"ion-icon",32)(10,Z,2,1,"ion-label",33)(11,ee,2,1,"ion-label",8),e.wR5(12,"ion-icon",34),e.C$Y(),e.I0R(13,"div",35)(14,"ion-item",11)(15,"ion-label"),e.OEk(16),e.C$Y(),e.yuY(17,te,2,1,"ion-button",36)(18,ie,2,1,"ion-button",36)(19,ne,2,1,"ion-button",36),e.I0R(20,"ion-button",37),e.qCj("click",function(){e.usT(s);const t=e.GaO(),n=t.$implicit,o=t.index,l=e.GaO(2);return e.CGJ(l.RemoveFile(n,o))}),e.OEk(21),e.C$Y()(),e.yuY(22,se,2,4,"div",38),e.C$Y()()}if(2&r){const s=e.GaO().$implicit;e.GaO();const i=e.Gew(17),t=e.GaO();e.E7m("value",s.path),e.yG2(2),e.E7m("ngIf","image"==s.viewer),e.yG2(),e.E7m("ngIf","audio"==s.viewer),e.yG2(),e.E7m("ngIf","video"==s.viewer),e.yG2(),e.E7m("ngIf","text"==s.viewer),e.yG2(),e.E7m("ngIf","godot"==s.viewer),e.yG2(),e.E7m("ngIf","code"==s.viewer),e.yG2(),e.E7m("ngIf","blender"==s.viewer),e.yG2(),e.E7m("ngIf","disabled"==s.viewer),e.yG2(),e.E7m("ngIf",i.value==s.path),e.yG2(),e.E7m("ngIf",i.value!=s.path),e.yG2(5),e.cNF(t.lang.text.UserFsDir.Action),e.yG2(),e.E7m("ngIf","image"!=s.viewer),e.yG2(),e.E7m("ngIf",t.is_file_selector),e.yG2(),e.E7m("ngIf",t.cant_dedicated&&!t.is_file_selector),e.yG2(2),e.oRS(" ",t.lang.text.UserFsDir.Delete," "),e.yG2(),e.E7m("ngIf","image"==s.viewer)}}function oe(r,d){if(1&r&&(e.I0R(0,"div"),e.yuY(1,re,23,17,"ion-accordion",22),e.C$Y()),2&r){const s=d.$implicit,i=e.GaO(2);e.yG2(),e.E7m("ngIf",i.CurrentDir==s.dir||i.is_file_selector)}}function le(r,d){if(1&r){const s=e.KQA();e.I0R(0,"ion-list"),e.yuY(1,Y,6,1,"div",8),e.I0R(2,"div")(3,"ion-item",11),e.wR5(4,"ion-icon",12),e.I0R(5,"ion-label"),e.OEk(6,"."),e.C$Y(),e.yuY(7,j,2,1,"ion-button",13),e.I0R(8,"ion-button",14),e.qCj("click",function(){e.usT(s);const t=e.GaO();return e.CGJ(t.CreateNewFolder())}),e.OEk(9),e.C$Y(),e.I0R(10,"ion-button",14),e.qCj("click",function(){e.usT(s);const t=e.GaO();return e.CGJ(t.SelectFiles())}),e.OEk(11),e.C$Y(),e.I0R(12,"ion-button",15),e.qCj("click",function(){e.usT(s);const t=e.GaO();return e.CGJ(t.RemoveDirectoryRecursive())}),e.OEk(13),e.C$Y()(),e.yuY(14,M,4,0,"ion-item",16),e.C$Y(),e.yuY(15,K,2,1,"div",17),e.I0R(16,"ion-accordion-group",null,18),e.yuY(18,oe,2,1,"div",17),e.C$Y()()}if(2&r){const s=e.GaO();e.yG2(),e.E7m("ngIf",""==s.CurrentDir&&!s.is_file_selector&&s.CanImportFolder),e.yG2(6),e.E7m("ngIf",!s.cant_dedicated),e.yG2(2),e.oRS(" ",s.lang.text.UserFsDir.NewFolder," "),e.yG2(2),e.oRS(" ",s.lang.text.UserFsDir.AddFile," "),e.yG2(2),e.oRS(" ",s.lang.text.UserFsDir.RemoveCurrentDir," "),e.yG2(),e.E7m("ngIf",""!=s.CurrentDir),e.yG2(),e.E7m("ngForOf",s.DirList),e.yG2(3),e.E7m("ngForOf",s.FileList)}}function ae(r,d){if(1&r){const s=e.KQA();e.I0R(0,"ion-item",19),e.qCj("click",function(){e.usT(s);const t=e.GaO().$implicit,n=e.GaO(2);return e.CGJ(n.importFolderMiddleAct(t))}),e.wR5(1,"ion-icon",12),e.I0R(2,"ion-label"),e.OEk(3),e.C$Y()()}if(2&r){const s=e.GaO().$implicit;e.yG2(3),e.cNF(s.name)}}function ce(r,d){if(1&r&&(e.I0R(0,"ion-item",53),e.wR5(1,"ion-icon",46),e.I0R(2,"ion-label"),e.OEk(3),e.C$Y()()),2&r){const s=e.GaO().$implicit;e.yG2(3),e.cNF(s.name)}}function de(r,d){if(1&r&&(e.I0R(0,"div"),e.yuY(1,ae,4,1,"ion-item",16)(2,ce,4,1,"ion-item",52),e.C$Y()),2&r){const s=d.$implicit;e.yG2(),e.E7m("ngIf",s.isDirectory),e.yG2(),e.E7m("ngIf",s.isFile)}}function _e(r,d){if(1&r){const s=e.KQA();e.I0R(0,"ion-list")(1,"ion-item",19),e.qCj("click",function(){e.usT(s);const t=e.GaO();return e.CGJ(t.InAppBrowser=!0)}),e.wR5(2,"ion-icon",12),e.I0R(3,"ion-label",51),e.OEk(4,"/sdcard/Android/data/org.pjcone.portal/files"),e.C$Y()(),e.yuY(5,de,3,2,"div",17),e.C$Y()}if(2&r){const s=e.GaO();e.yG2(5),e.E7m("ngForOf",s.ExternalFolder)}}let me=(()=>{var r;class d{constructor(i,t,n,o,l,a,c,u,p,m,D,ue,pe){this.modalCtrl=i,this.indexed=t,this.loadingCtrl=n,this.lang=o,this.global=l,this.p5toast=a,this.alertCtrl=c,this.sanitizer=u,this.file=p,this.navCtrl=m,this.noti=D,this.navParams=ue,this.nakama=pe,this.DirList=[],this.FileList=[],this.cant_dedicated=!1,this.InAppBrowser=!0,this.is_ready=!1,this.is_file_selector=!1,this.HideThumbnail=!1,this.CanImportFolder=!0,this.BackButtonPressed=!1,this.StopIndexing=!1,this.EventListenerAct=ge=>{ge.detail.register(110,he=>{this.is_ready?""==this.CurrentDir?he():this.MoveToUpDir():(this.initLoadingElement.dismiss(),this.is_ready=!0)})},this.lock_modal_open=!1,this.isCreateFolderRecursive=!1,this.ExternalFolder=[]}toggle_thumbnail(){this.HideThumbnail=!this.HideThumbnail,localStorage.setItem("user-fs-thumbnail",this.HideThumbnail?"1":"0")}InitBrowserBackButtonOverride(){window.history.pushState(null,null,window.location.href),window.onpopstate=()=>{this.BackButtonPressed||(this.BackButtonPressed=!0,this.navCtrl.back())}}ngOnInit(){this.InitBrowserBackButtonOverride(),"DesktopPWA"==f.s1&&setTimeout(()=>{this.CreateDrop()},0),this.CanImportFolder="MobilePWA"!=f.s1}ionViewDidEnter(){this.global.p5key.KeyShortCut.Escape=()=>{this.is_ready?""==this.CurrentDir?this.navCtrl.pop():this.MoveToUpDir():(this.initLoadingElement.dismiss(),this.is_ready=!0)}}CreateDrop(){var i=this;let t=document.getElementById("p5Drop_userfs");this.p5canvas=new U(n=>{n.setup=()=>{let u=n.createCanvas(t.clientWidth,t.clientHeight);u.parent(t),n.pixelDensity(.1),u.drop(p=>{let m=n.millis();a<m-400?(l=!1,c.length=0,c.push(p)):(l=!0,c.push(p)),a=m,clearTimeout(o),o=setTimeout((0,g.c)(function*(){if(l)i.MultipleDrops(c);else{let D=yield i.loadingCtrl.create({message:i.lang.text.TodoDetail.WIP});D.present(),i.importSelected(p.file),D.dismiss()}}),400)})};let o,l=!1,a=0,c=[];n.mouseMoved=u=>{u.dataTransfer?(t.style.pointerEvents="all",t.style.backgroundColor="#0008"):(t.style.pointerEvents="none",t.style.backgroundColor="transparent")}})}CreateNewFolder(){var t,i=this;this.alertCtrl.create({header:this.lang.text.UserFsDir.CreateFolder,inputs:[{type:"text",placeholder:this.lang.text.UserFsDir.FolderName}],buttons:[{text:this.lang.text.UserFsDir.Create,handler:(t=(0,g.c)(function*(n){if(n[0])try{let o=`${i.CurrentDir}/${n[0]}`;yield i.indexed.createDirectory(o);let l=yield i.indexed.GetFileInfoFromDB(o),a={path:o,mode:l.mode,timestamp:l.timestamp,db:i.indexed.ionicDB};a.name=n[0],a.dir=i.CurrentDir,i.DirList.push(a)}catch(o){console.error("\ud3f4\ub354 \uc0dd\uc131 \uc2e4\ud328: ",o),i.p5toast.show({text:`${i.lang.text.UserFsDir.FailedToCreateFolder}: ${o}`})}else i.p5toast.show({text:i.lang.text.UserFsDir.NeedFolderName})}),function(o){return t.apply(this,arguments)})}]}).then(t=>{this.global.p5key.KeyShortCut.Escape=()=>{t.dismiss()},t.onDidDismiss().then(()=>{this.ionViewDidEnter()}),t.present()})}SelectFiles(){document.getElementById("import_file").click()}MultipleDrops(i){var t=this;return(0,g.c)(function*(){let n=yield t.loadingCtrl.create({message:t.lang.text.TodoDetail.WIP});n.present();for(let o=0,l=i.length;o<l;o++)yield t.importSelected(i[o].file);n.dismiss()})()}inputFileSelected(i){var t=this;return(0,g.c)(function*(){if(i.target.files.length)if(1!=i.target.files.length){let o=yield t.loadingCtrl.create({message:t.lang.text.UserFsDir.MultipleSave});o.present(),t.noti.noti.schedule({id:4,title:t.lang.text.UserFsDir.MultipleSave,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://diychat",color:"b0b0b0"});for(let l=0,a=i.target.files.length;l<a&&!t.StopIndexing;l++)o.message=`${t.lang.text.UserFsDir.MultipleSave}: ${a-l}`,t.noti.noti.schedule({id:4,title:t.lang.text.UserFsDir.MultipleSave,progressBar:{value:l,maxValue:a},sound:null,smallIcon:"res://diychat",color:"b0b0b0"}),yield t.importSelected(i.target.files[l]);t.noti.ClearNoti(4),o.dismiss()}else{let o=yield t.loadingCtrl.create({message:t.lang.text.TodoDetail.WIP});o.present(),yield t.importSelected(i.target.files[0]),o.dismiss()}})()}importSelected(i){var t=this;return(0,g.c)(function*(){try{let n=`${t.CurrentDir}/${i.name}`;yield t.indexed.saveBlobToUserPath(i,n);let o=yield t.indexed.GetFileInfoFromDB(n),l={path:n,mode:o.mode,timestamp:o.timestamp,db:t.indexed.ionicDB};l.name=i.name,l.dir=t.CurrentDir,l.file_ext=l.name.split(".").pop(),t.global.set_viewer_category_from_ext(l),"image"==l.viewer&&t.indexed.loadBlobFromUserPath(l.path,"",a=>{let c=URL.createObjectURL(a);l.thumbnail=t.sanitizer.bypassSecurityTrustUrl(c)});try{let a=l.path.split("/");if(5!=a.length||"groups"!=a[3])throw"\uadf8\ub8f9 \uc774\ubbf8\uc9c0 \ud30c\uc77c\uc774 \uc544\ub2d8";t.SetDisplayGroupImageName(l,a)}catch{}for(let a=0,c=t.FileList.length;a<c;a++)if(t.FileList[a].path==n){t.FileList.splice(a,1);break}t.FileList.push(l)}catch(n){console.log("importSelected error: ",n)}})()}ionViewWillEnter(){this.HideThumbnail="1"==localStorage.getItem("user-fs-thumbnail"),this.CurrentDir="",this.is_file_selector=!!this.navParams.data.modal,this.LoadAllIndexedFiles(),("DesktopPWA"==f.s1||"MobilePWA"==f.s1)&&(this.cant_dedicated=!0),document.addEventListener("ionBackButton",this.EventListenerAct)}dismiss_page(i){var t=this;return(0,g.c)(function*(){if(t.is_file_selector){let n;i&&(n=yield t.indexed.loadBlobFromUserPath(i.path,""),n.name=i.name,n.file_ext=i.file_ext),t.modalCtrl.dismiss(n)}})()}LoadAllIndexedFiles(){var i=this;return(0,g.c)(function*(){if(i.initLoadingElement=yield i.loadingCtrl.create({message:i.lang.text.UserFsDir.LoadingExplorer}),i.initLoadingElement.present(),i.DirList.length=0,i.FileList.length=0,("Android"==f.s1||"iOS"==f.s1)&&i.noti.noti.schedule({id:5,title:i.lang.text.UserFsDir.LoadingExplorer,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"}),i.is_file_selector)if(i.navParams.get("path")){let t=yield i.indexed.GetFileListFromDB(i.navParams.get("path"));yield i.ModulateIndexedFile(t)}else{let t=yield i.indexed.GetFileListFromDB("/files/");yield i.ModulateIndexedFile(t)}else{let t=yield i.indexed.GetFileListFromDB("/");yield i.ModulateIndexedFile(t)}i.is_file_selector?i.FileList.sort((t,n)=>t.timestamp<n.timestamp?1:t.timestamp>n.timestamp?-1:0):(i.FileList.sort((t,n)=>t.path>n.path?1:t.path<n.path?-1:0),i.DirList.sort((t,n)=>t.path>n.path?1:t.path<n.path?-1:0)),i.noti.ClearNoti(5),i.initLoadingElement.dismiss(),i.is_ready=!0})()}ModulateIndexedFile(i){var t=this;return(0,g.c)(function*(){for(let n=0,o=i.length;n<o;n++){if(t.StopIndexing)return;let l=`${t.lang.text.UserFsDir.LoadingExplorer}: ${i.length-n}`;("Android"==f.s1||"iOS"==f.s1)&&t.noti.noti.schedule({id:5,title:l,progressBar:{value:n,maxValue:i.length},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"}),t.initLoadingElement.message=l,yield t.indexed.GetFileInfoFromDB(i[n],a=>{let c={path:i[n],mode:a.mode,timestamp:a.timestamp};switch(c.name=c.path.substring(c.path.lastIndexOf("/")+1),c.dir=i[n].substring(0,i[n].lastIndexOf("/")),c.mode){case 33206:c.file_ext=c.name.split(".").pop(),t.global.set_viewer_category_from_ext(c),"image"==c.viewer&&t.indexed.loadBlobFromUserPath(c.path,"",m=>{let D=URL.createObjectURL(m);c.thumbnail=t.sanitizer.bypassSecurityTrustUrl(D)});try{let m=c.path.split("/");if(5!=m.length||"groups"!=m[3])throw"\uadf8\ub8f9 \uc774\ubbf8\uc9c0 \ud30c\uc77c\uc774 \uc544\ub2d8";t.SetDisplayGroupImageName(c,m)}catch{}t.FileList.push(c);break;case 16893:0==c.path.indexOf("todo/")&&t.SetDisplayTodoName(c);let u=!1,p=c.path.split("/");try{if(5!=p.length||"channels"!=p[3])throw"\ucc44\ub110 \ud3f4\ub354\uac00 \uc544\ub2d8";t.SetDisplayChannelName(c,p),u=!0}catch{}try{if(u||5!=p.length||"users"!=p[3])throw"\uc0ac\uc6a9\uc790 \ud3f4\ub354\uac00 \uc544\ub2d8";t.SetDisplayUserName(c,p),u=!0}catch{}t.DirList.push(c);break;default:console.log("\uc608\uc0c1\ud558\uc9c0 \ubabb\ud55c \ud30c\uc77c \ubaa8\ub4dc: ",c)}})}t.noti.ClearNoti(5)})()}SetDisplayTodoName(i){var t=this;return(0,g.c)(function*(){try{let n=yield t.indexed.loadTextFromUserPath(`${i.path}/info.todo`),o=JSON.parse(n);i.name=o.title}catch(n){console.error("SetDisplayTodoName error: ",n)}})()}SetDisplayUserName(i,t){try{i.name=this.nakama.users[t[1]][t[2]][t[4]].display_name}catch{}}SetDisplayChannelName(i,t){try{i.name=this.nakama.channels_orig[t[1]][t[2]][i.name].title}catch{}}SetDisplayGroupImageName(i,t){try{i.name=`${this.nakama.groups[t[1]][t[2]][t[4].split(".").shift()].name}.img`}catch(n){console.log("SetDisplayGroupImageName error: ",n)}}MoveToUpDir(){this.CurrentDir=this.CurrentDir.substring(0,this.CurrentDir.lastIndexOf("/")),this.FileSel.value=void 0}SelectFolder(i){this.CurrentDir=i.path,this.FileSel.value=void 0}OpenFile(i){var t=this;return(0,g.c)(function*(){if(t.lock_modal_open||(t.lock_modal_open=!0,!t.CheckIfAccessable(i.path)))return;document.removeEventListener("ionBackButton",t.EventListenerAct);let n=[];if(t.is_file_selector){if(t.navParams.data.path)for(let o=0,l=t.FileList.length;o<l;o++)n.push({content:t.FileList[o]})}else for(let o=0,l=t.FileList.length;o<l;o++)t.FileList[o].dir==t.CurrentDir&&n.push({content:t.FileList[o]});{let o=yield t.indexed.loadBlobFromUserPath(i.path,"");i.size=o.size}t.modalCtrl.create({component:y.K,componentProps:{info:{content:i},no_edit:!0,path:i.path,relevance:n},cssClass:"fullscreen"}).then(o=>{delete t.global.p5key.KeyShortCut.Escape,delete t.global.p5key.KeyShortCut.Digit,o.onDidDismiss().then(l=>{if(t.lock_modal_open=!1,l.data)switch(l.data.type){case"image":return void t.modalCtrl.create({component:E.S,componentProps:{path:l.data.path,width:l.data.width,height:l.data.height,text:l.data.text,isDarkMode:l.data.isDarkMode,scrollHeight:l.data.scrollHeight},cssClass:"fullscreen"}).then(a=>{a.onWillDismiss().then(function(){var c=(0,g.c)(function*(u){if(u.data){let p=t.global.Base64ToBlob(u.data.img,"image/png");p.name=u.data.name,yield t.importSelected(p),u.data.loadingCtrl.dismiss()}document.addEventListener("ionBackButton",t.EventListenerAct),t.ionViewDidEnter()});return function(u){return c.apply(this,arguments)}}()),a.present()});case"text":t.importSelected(l.data.blob)}else document.addEventListener("ionBackButton",t.EventListenerAct),t.ionViewDidEnter()}),o.present()})})()}CheckIfAccessable(i){switch(i){case"servers/webrtc_server.json":case"servers/self/profile.json":return this.p5toast.show({text:this.lang.text.UserFsDir.PrivateAccessDenied}),!1}return!0}DownloadFile(i){this.CheckIfAccessable(i.path)&&this.indexed.DownloadFileFromUserPath(i.path,"",i.name)}ExportDirectoryRecursive(){this.alertCtrl.create({header:this.lang.text.UserFsDir.ExportDirTitle,message:this.lang.text.UserFsDir.ExportDirMsg,buttons:[{text:this.lang.text.UserFsDir.ExportConfirm,handler:()=>{this.ExportDirectoryRecursiveAct()}}]}).then(i=>{this.global.p5key.KeyShortCut.Escape=()=>{i.dismiss()},i.onDidDismiss().then(()=>{this.ionViewDidEnter()}),i.present()})}ExportDirectoryRecursiveAct(){var i=this;return(0,g.c)(function*(){let t=yield i.loadingCtrl.create({message:i.lang.text.UserFsDir.ExportDirTitle});t.present();let n=yield i.indexed.GetFileListFromDB(i.CurrentDir);for(let o=0,l=n.length;o<l;o++){if(i.StopIndexing)return void t.dismiss();let a=yield i.indexed.GetFileInfoFromDB(n[o]),c=yield i.indexed.loadBlobFromUserPath(n[o],""),u=n[o].lastIndexOf("/"),p=n[o].substring(0,u),m=n[o].substring(u+1);i.isCreateFolderRecursive||(i.isCreateFolderRecursive=!0,yield i.CreateFolderRecursive(p));try{if(16893==a.mode)throw yield i.file.createDir(i.file.externalDataDirectory+p,m,!0),t.message=`${i.lang.text.UserFsDir.ExportDirTitle}: ${m}`,"\uc774\uac70 \ud3f4\ub354\uc784";if(!i.CheckIfAccessable(n[o]))throw"\uc5f4\ub78c \ubd88\uac00 \ud30c\uc77c \uc81c\uc678";t.message=`${i.lang.text.UserFsDir.ExportDirTitle}: ${m}`,yield i.file.writeFile(i.file.externalDataDirectory+p+"/",m,c,{replace:!0})}catch(D){console.error(n[o],": \ud30c\uc77c \uc800\uc7a5 \uc2e4\ud328: ",D)}}i.isCreateFolderRecursive=!1,t.dismiss()})()}CreateFolderRecursive(i){var t=this;return(0,g.c)(function*(){let n=i.lastIndexOf("/")+1,o=i.substring(0,n),l=i.substring(n);o&&(yield t.CreateFolderRecursive(i.substring(0,n-1)));try{yield t.file.createDir(t.file.externalDataDirectory+o,l,!0)}catch{}})()}BrowseExternalFiles(){var i=this;return(0,g.c)(function*(){i.ExternalFolder.length=0,i.InAppBrowser=!1,i.ExternalFolder=yield i.file.listDir(i.file.externalApplicationStorageDirectory,"files"),i.ExternalFolder.sort(),i.ExternalFolder.sort((t,n)=>t.isDirectory?-1:1)})()}importFolderMiddleAct(i){var t=this;return(0,g.c)(function*(){let n=yield t.loadingCtrl.create({message:t.lang.text.UserFsDir.Import});n.present(),yield t.importThisFolder(i,n),t.InAppBrowser=!0,n.dismiss(),t.p5toast.show({text:t.lang.text.UserFsDir.NeedResetToApply})})()}importThisFolder(i,t){var n=this;return(0,g.c)(function*(){let o=i.nativeURL.substring(0,i.nativeURL.length-1),l=o.lastIndexOf("/"),a=[];try{a=yield n.file.listDir(o.substring(0,l)+"/",o.substring(l+1))}catch{}for(let c=0,u=a.length;c<u;c++){if(n.StopIndexing)return void t.dismiss();if(a[c].isDirectory)yield n.importThisFolder(a[c],t);else{let p=a[c].nativeURL.split("org.pjcone.portal/files/")[1];try{t.message=`${n.lang.text.UserFsDir.Import}: ${a[c].name}`;let D=(yield G.readFile({path:a[c].nativeURL})).data.replace(/"|\\|=/g,"");yield n.indexed.saveBase64ToUserPath(","+D,decodeURIComponent(p))}catch(m){console.log("\ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",m),n.p5toast.show({text:`${n.lang.text.UserFsDir.ImportFailed}: ${m}`})}}}})()}SelectImportFolder(){this.cant_dedicated?document.getElementById("folder_sel_id").click():this.BrowseExternalFiles()}inputImageSelected(i){var t=this;return(0,g.c)(function*(){let n=yield t.loadingCtrl.create({message:t.lang.text.UserFsDir.LoadingExplorer});n.present();for(let o=0,l=i.target.files.length;o<l;o++){if(t.StopIndexing)return void n.dismiss();yield t.indexed.saveBlobToUserPath(i.target.files[o],i.target.files[o].webkitRelativePath)}t.LoadAllIndexedFiles(),n.dismiss(),t.p5toast.show({text:t.lang.text.UserFsDir.NeedResetToApply})})()}RemoveDirectoryRecursive(){var t,i=this;this.alertCtrl.create({header:this.CurrentDir.substring(this.CurrentDir.lastIndexOf("/")+1)||this.lang.text.UserFsDir.ResetDB,message:this.lang.text.UserFsDir.RemoveThisFolder,buttons:[{text:this.lang.text.UserFsDir.RemoveApply,handler:(t=(0,g.c)(function*(){let n=yield i.loadingCtrl.create({message:i.lang.text.UserFsDir.DeleteFile});n.present(),("Android"==f.s1||"iOS"==f.s1)&&i.noti.noti.schedule({id:4,title:i.lang.text.UserFsDir.DeleteFile,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"});let o=yield i.indexed.GetFileListFromDB(i.CurrentDir);for(let l=0,a=o.length;l<a;l++){if(i.StopIndexing)return void n.dismiss();("Android"==f.s1||"iOS"==f.s1)&&i.noti.noti.schedule({id:4,title:`${i.lang.text.UserFsDir.DeleteFile}: ${a-l}`,progressBar:{value:l,maxValue:a},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"}),n.message=`${i.lang.text.UserFsDir.DeleteFile}: ${a-l}`,yield i.indexed.removeFileFromUserPath(o[l])}for(let l=i.DirList.length-1;l>=0;l--)0==i.DirList[l].path.indexOf(i.CurrentDir)&&i.DirList.splice(l,1);for(let l=i.FileList.length-1;l>=0;l--)0==i.FileList[l].path.indexOf(i.CurrentDir)&&i.FileList.splice(l,1);i.MoveToUpDir(),n.dismiss(),i.noti.ClearNoti(4)}),function(){return t.apply(this,arguments)}),cssClass:"redfont"}]}).then(t=>{this.global.p5key.KeyShortCut.Escape=()=>{t.dismiss()},t.onDidDismiss().then(()=>{this.ionViewDidEnter()}),t.present()})}RemoveFile(i,t){this.alertCtrl.create({header:this.lang.text.UserFsDir.DeleteFile,message:this.lang.text.ChatRoom.CannotUndone,buttons:[{text:this.lang.text.UserFsDir.DeleteAccept,handler:()=>{this.indexed.removeFileFromUserPath(i.path,()=>{this.FileList.splice(t,1)})},cssClass:"redfont"}]}).then(n=>{this.global.p5key.KeyShortCut.Escape=()=>{n.dismiss()},n.onDidDismiss().then(()=>{this.ionViewDidEnter()}),n.present()})}ionViewDidLeave(){this.StopIndexing=!0,this.FileList.forEach(i=>{URL.revokeObjectURL(i.thumbnail)}),setTimeout(()=>{this.noti.ClearNoti(4),this.noti.ClearNoti(5)},1e3)}ionViewWillLeave(){document.removeEventListener("ionBackButton",this.EventListenerAct),delete this.global.p5key.KeyShortCut.Escape,delete this.global.p5key.KeyShortCut.Digit}}return(r=d).\u0275fac=function(i){return new(i||r)(e.GI1(h.qS),e.GI1(T.k),e.GI1(h.Kg),e.GI1(R.o),e.GI1(k.A1),e.GI1(O.O),e.GI1(h.iW),e.GI1(P.mI),e.GI1(w.S),e.GI1(v.wX),e.GI1(S.s),e.GI1(v.a6),e.GI1($.h))},r.\u0275cmp=e.In1({type:r,selectors:[["app-user-fs-dir"]],viewQuery:function(i,t){if(1&i&&e.CC$(L,5),2&i){let n;e.wto(n=e.Gqi())&&(t.FileSel=n.first)}},decls:13,vars:5,consts:[[1,"ion-no-border"],["slot","start",3,"click"],["defaultHref",""],["class","top_icon","slot","end","name","eye-outline",3,"click",4,"ngIf"],["class","top_icon","slot","end","name","eye-off-outline",3,"click",4,"ngIf"],["oncontextmenu","return false;"],["id","p5Drop_userfs",2,"position","absolute","width","100%","height","100%","display","flex","pointer-events","none"],["hidden","","type","file","id","import_file","accept","*","multiple","",3,"change"],[4,"ngIf"],["slot","end","name","eye-outline",1,"top_icon",3,"click"],["slot","end","name","eye-off-outline",1,"top_icon",3,"click"],["button",""],["slot","start","name","folder"],["class","folder_button",3,"click",4,"ngIf"],[1,"folder_button",3,"click"],[3,"click"],["button","",3,"click",4,"ngIf"],[4,"ngFor","ngForOf"],["FileSel",""],["button","",3,"click"],["slot","start","name","arrow-down-circle"],["hidden","","type","file","id","folder_sel_id","webkitdirectory","",3,"change"],[3,"value",4,"ngIf"],[3,"value"],["slot","header"],["slot","start","name","image",4,"ngIf"],["slot","start","name","musical-notes",4,"ngIf"],["slot","start","name","play-circle",4,"ngIf"],["slot","start","name","reader",4,"ngIf"],["slot","start","name","extension-puzzle",4,"ngIf"],["slot","start","name","code-slash-outline",4,"ngIf"],["slot","start","name","cube-outline",4,"ngIf"],["slot","start","name","document",4,"ngIf"],["text-wrap","",4,"ngIf"],[1,"ion-accordion-toggle-icon","hide_accordion_icon"],["slot","content"],["class","ion-text-right button_dist",3,"click",4,"ngIf"],[1,"ion-text-end","button_dist",3,"click"],["class","image_front_form",3,"click",4,"ngIf"],["slot","start","name","image"],["slot","start","name","musical-notes"],["slot","start","name","play-circle"],["slot","start","name","reader"],["slot","start","name","extension-puzzle"],["slot","start","name","code-slash-outline"],["slot","start","name","cube-outline"],["slot","start","name","document"],["text-wrap",""],[1,"ion-text-right","button_dist",3,"click"],[1,"image_front_form",3,"click"],[1,"image_front_view",3,"src","alt"],["color","medium"],["button","","disabled","",4,"ngIf"],["button","","disabled",""]],template:function(i,t){1&i&&(e.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),e.OEk(3),e.C$Y(),e.I0R(4,"ion-buttons",1),e.qCj("click",function(){return t.dismiss_page()}),e.wR5(5,"ion-back-button",2),e.C$Y(),e.yuY(6,A,1,0,"ion-icon",3)(7,B,1,0,"ion-icon",4),e.C$Y()(),e.I0R(8,"ion-content",5)(9,"div",6)(10,"input",7),e.qCj("change",function(o){return t.inputFileSelected(o)}),e.C$Y()(),e.yuY(11,le,19,8,"ion-list",8)(12,_e,6,1,"ion-list",8),e.C$Y()),2&i&&(e.yG2(3),e.cNF(t.lang.text.Settings.InAppExplorer),e.yG2(3),e.E7m("ngIf",!t.HideThumbnail),e.yG2(),e.E7m("ngIf",t.HideThumbnail),e.yG2(4),e.E7m("ngIf",t.InAppBrowser),e.yG2(),e.E7m("ngIf",!t.InAppBrowser))},dependencies:[I.ay,I.u_,h.cm,h.qU,h.sn,h.GS,h._i,h.wB,h.Ko,h.Yb,h.QR,h.OC,h.tM,h.Md,h.Im],styles:[".item.sc-ion-label-md-h[_ngcontent-%COMP%], .item[_ngcontent-%COMP%]   .sc-ion-label-md-h[_ngcontent-%COMP%]{overflow:unset}.image_front_form[_ngcontent-%COMP%]{display:flex;justify-content:center;text-align:center}.image_front_view[_ngcontent-%COMP%]{max-height:233px}.top_icon[_ngcontent-%COMP%]{width:28px;height:28px;padding-right:28px;cursor:pointer}.button_dist[_ngcontent-%COMP%]{padding-left:2px}.folder_button[_ngcontent-%COMP%]{padding-right:4px}"]}),d})()}}]);