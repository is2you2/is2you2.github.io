"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7602],{5087:(X,V,h)=>{h.d(V,{r:()=>K});var a=h(655),r=h(3996),u=h(5016),Z=h(549),e=h(9863),D=h(1282),t=h(3496),q=h(5742),N=h(4433),Y=h(3336),T=h(9912),O=h(9808);function p(_,w){if(1&_){const o=e.EpF();e.TgZ(0,"ion-item",12),e.NdJ("click",function(){return e.CHM(o),e.oxw(2).ShowContentInfoGodot.present()}),e.TgZ(1,"ion-label"),e._uU(2),e.qZA()()}if(2&_){const o=e.oxw(2);e.xp6(2),e.Oqu(o.lang.text.ContentViewer.ContentInfo)}}function P(_,w){if(1&_){const o=e.EpF();e.TgZ(0,"ion-content")(1,"ion-list")(2,"ion-item",10),e.NdJ("click",function(){return e.CHM(o),e.oxw().snapshot_modify()}),e.TgZ(3,"ion-label"),e._uU(4),e.qZA()(),e.YNc(5,p,3,1,"ion-item",11),e.TgZ(6,"ion-item",10),e.NdJ("click",function(){return e.CHM(o),e.oxw().ShareContent()}),e.TgZ(7,"ion-label"),e._uU(8),e.qZA()(),e.TgZ(9,"ion-item",10),e.NdJ("click",function(){return e.CHM(o),e.oxw().download_file()}),e.TgZ(10,"ion-label"),e._uU(11),e.qZA()()()()}if(2&_){const o=e.oxw();e.xp6(4),e.Oqu(o.lang.text.ContentViewer.Edit),e.xp6(1),e.Q6J("ngIf",o.FileInfo.content_creator),e.xp6(3),e.Oqu(o.lang.text.ContentViewer.ShareContent),e.xp6(3),e.Oqu(o.lang.text.ContentViewer.Download)}}function A(_,w){if(1&_&&(e.TgZ(0,"ion-label",13),e._uU(1),e.qZA()),2&_){const o=e.oxw(3);e.xp6(1),e.Oqu(o.lang.text.GlobalAct.variousCreator)}}function E(_,w){if(1&_&&(e.TgZ(0,"ion-label",13),e._uU(1),e.qZA()),2&_){const o=e.oxw(3);e.xp6(1),e.Oqu(o.lang.text.GlobalAct.FromCamera)}}function k(_,w){if(1&_&&(e.TgZ(0,"ion-label",13),e._uU(1),e.qZA()),2&_){const o=e.oxw(3);e.xp6(1),e.Oqu(o.lang.text.GlobalAct.FromVoidDraw)}}function B(_,w){if(1&_&&(e.TgZ(0,"ion-item")(1,"ion-label"),e._uU(2),e.qZA(),e.YNc(3,A,2,1,"ion-label",17),e.YNc(4,E,2,1,"ion-label",17),e.YNc(5,k,2,1,"ion-label",17),e.qZA()),2&_){const o=e.oxw(2);e.xp6(2),e.Oqu(o.lang.text.ContentInfo.SourceFrom),e.xp6(1),e.Q6J("ngIf","loaded"==o.content_creator.various),e.xp6(1),e.Q6J("ngIf","camera"==o.content_creator.various),e.xp6(1),e.Q6J("ngIf","voidDraw"==o.content_creator.various)}}function R(_,w){if(1&_&&(e.TgZ(0,"ion-label",13),e._uU(1),e.qZA()),2&_){const o=e.oxw(3);e.xp6(1),e.Oqu(o.lang.text.GlobalAct.variousCreator)}}function S(_,w){if(1&_&&(e.TgZ(0,"ion-label",13),e._uU(1),e.qZA()),2&_){const o=e.oxw(3);e.xp6(1),e.Oqu(o.lang.text.GlobalAct.FromCamera)}}function G(_,w){if(1&_&&(e.TgZ(0,"ion-label",13),e._uU(1),e.qZA()),2&_){const o=e.oxw(3);e.xp6(1),e.Oqu(o.lang.text.GlobalAct.FromVoidDraw)}}function H(_,w){if(1&_&&(e.TgZ(0,"div")(1,"ion-item-divider")(2,"div",18),e._uU(3),e.qZA()(),e.TgZ(4,"ion-item")(5,"ion-label"),e._uU(6),e.qZA(),e.TgZ(7,"ion-label",13),e._uU(8),e.qZA()(),e.TgZ(9,"ion-item")(10,"ion-label"),e._uU(11),e.qZA(),e.YNc(12,R,2,1,"ion-label",17),e.YNc(13,S,2,1,"ion-label",17),e.YNc(14,G,2,1,"ion-label",17),e.qZA()()),2&_){const o=w.$implicit,c=e.oxw(2);e.xp6(3),e.Oqu(o.timeDisplay),e.xp6(3),e.Oqu(c.lang.text.ContentInfo.Publisher),e.xp6(2),e.Oqu(o.publisher||o.display_name||c.lang.text.Profile.noname_user),e.xp6(3),e.Oqu(c.lang.text.ContentInfo.SourceFrom),e.xp6(1),e.Q6J("ngIf","loaded"==o.various),e.xp6(1),e.Q6J("ngIf","camera"==o.various),e.xp6(1),e.Q6J("ngIf","voidDraw"==o.various)}}function $(_,w){if(1&_){const o=e.EpF();e.TgZ(0,"ion-content")(1,"ion-item-divider")(2,"ion-label"),e._uU(3),e.qZA()(),e.TgZ(4,"ion-item")(5,"ion-label"),e._uU(6),e.qZA(),e.TgZ(7,"ion-label",13),e._uU(8),e.qZA()(),e.YNc(9,B,6,4,"ion-item",14),e.TgZ(10,"ion-item")(11,"ion-label"),e._uU(12),e.qZA(),e.TgZ(13,"ion-label",13),e._uU(14),e.qZA()(),e.YNc(15,H,15,7,"div",15),e.TgZ(16,"ion-item",10),e.NdJ("click",function(){return e.CHM(o),e.oxw().ShowContentInfoGodot.dismiss()}),e.TgZ(17,"ion-label",16),e._uU(18),e.qZA()()()}if(2&_){const o=e.oxw();e.xp6(3),e.Oqu(o.lang.text.ContentInfo.WorkLogs),e.xp6(3),e.Oqu(o.lang.text.ContentInfo.LastPost),e.xp6(2),e.hij(" ",(o.content_creator.user_id?o.content_creator.is_me?o.nakama.users.self.display_name:o.nakama.users[o.isOfficial][o.target][o.content_creator.user_id].display_name:o.content_creator.display_name)||o.lang.text.Profile.noname_user,""),e.xp6(1),e.Q6J("ngIf",o.content_creator.various),e.xp6(3),e.Oqu(o.lang.text.ContentInfo.TimeAt),e.xp6(2),e.Oqu(o.content_creator.timeDisplay),e.xp6(1),e.Q6J("ngForOf",o.content_related_creator),e.xp6(3),e.Oqu(o.lang.text.ContentInfo.CloseModal)}}const J=function(){return[.5,1]};let K=(()=>{class _{constructor(o,c,l,x,i,n,s,d,m,I){this.modalCtrl=o,this.navParams=c,this.global=l,this.indexed=x,this.lang=i,this.file=n,this.alertCtrl=s,this.loadingCtrl=d,this.p5toast=m,this.nakama=I,this.EventListenerAct=v=>{v.detail.register(120,b=>{})}}ngOnInit(){this.FileInfo=this.navParams.get("info"),this.CreateContentInfo()}CreateContentInfo(){this.isOfficial=this.navParams.get("isOfficial"),this.target=this.navParams.get("target");try{this.content_creator=this.FileInfo.content_creator,this.content_creator.timeDisplay=new Date(this.content_creator.timestamp).toLocaleString(),this.content_related_creator=this.FileInfo.content_related_creator,this.content_creator.user_id&&(this.content_creator.is_me=this.nakama.servers[this.isOfficial][this.target].session.user_id==this.content_creator.user_id);for(let o=0,c=this.content_related_creator.length;o<c;o++)this.content_related_creator[o].user_id&&(this.content_related_creator[o].is_me=this.nakama.servers[this.isOfficial][this.target].session.user_id==this.content_related_creator[o].user_id),this.content_related_creator[o].timeDisplay=new Date(this.content_related_creator[o].timestamp).toLocaleString()}catch(o){}try{this.content_related_creator[0].publisher=this.content_related_creator[0].is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_related_creator[0].user_id].display_name,this.content_related_creator[0].timestamp==this.content_related_creator[1].timestamp&&(this.content_related_creator[0].publisher=this.content_related_creator[1].is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_related_creator[1].user_id].display_name,this.content_related_creator.splice(1,1))}catch(o){try{this.content_related_creator[0].publisher||(this.content_related_creator[0].publisher=this.content_related_creator[0].display_name)}catch(c){}}try{this.content_related_creator.sort((o,c)=>o.timestamp>c.timestamp?-1:o.timestamp<c.timestamp?1:0)}catch(o){}}ionViewDidEnter(){return(0,a.mG)(this,void 0,void 0,function*(){document.addEventListener("ionBackButton",this.EventListenerAct),yield this.global.CreateGodotIFrame("viewer",{local_url:"assets/data/godot/viewer.pck",title:"ViewerEx",path:this.navParams.get("path"),ext:this.FileInfo.file_ext,force_logo:!0,receive_image:(o,c,l)=>{this.modalCtrl.dismiss({base64:","+o,width:c,height:l})}},"create_thumbnail")})}snapshot_modify(){this.global.godot_window.modify_image()}download_file(){"DesktopPWA"==u.n$||"MobilePWA"==u.n$?this.indexed.DownloadFileFromUserPath(this.navParams.get("path"),this.FileInfo.type,this.FileInfo.filename):this.alertCtrl.create({header:this.lang.text.ContentViewer.Filename,inputs:[{name:"filename",placeholder:this.FileInfo.filename,type:"text"}],buttons:[{text:this.lang.text.ContentViewer.saveFile,handler:o=>(0,a.mG)(this,void 0,void 0,function*(){let c=yield this.loadingCtrl.create({message:this.lang.text.TodoDetail.WIP});c.present();let l=o.filename?`${o.filename.replace(/:|\?|\/|\\|<|>/g,"")}.${this.FileInfo.file_ext}`:this.FileInfo.filename,x=yield this.indexed.loadBlobFromUserPath(this.navParams.get("path"),this.FileInfo.type);this.file.writeFile(this.file.externalDataDirectory,l,x).then(i=>{c.dismiss(),this.p5toast.show({text:this.lang.text.ContentViewer.fileSaved})}).catch(i=>{12===(c.dismiss(),i.code)?(this.p5toast.show({text:this.lang.text.ContentViewer.AlreadyExist}),this.download_file()):console.log("\uc900\ube44\ub418\uc9c0 \uc54a\uc740 \uc624\ub958 \ubc18\ud658: ",i)})})}]}).then(o=>o.present())}ShareContent(){let o=this.nakama.rearrange_channels();for(let c=o.length-1;c>=0;c--)("missing"==o[c].status||"offline"==o[c].status)&&o.splice(c,1);o.length?this.modalCtrl.create({component:Z.D,componentProps:{file:this.FileInfo,channels:o}}).then(c=>{c.onDidDismiss().then(l=>this.modalCtrl.dismiss()),c.present()}):this.p5toast.show({text:this.lang.text.ShareContentToOther.NoChannelToShare})}ionViewWillLeave(){document.removeEventListener("ionBackButton",this.EventListenerAct),this.global.godot_window.filename=this.FileInfo.filename,this.global.godot_window.create_thumbnail(this.FileInfo)}}return _.\u0275fac=function(o){return new(o||_)(e.Y36(r.IN),e.Y36(r.X1),e.Y36(D.AN),e.Y36(t.H),e.Y36(q.b),e.Y36(N.$),e.Y36(r.Br),e.Y36(r.HT),e.Y36(Y.F),e.Y36(T.a))},_.\u0275cmp=e.Xpm({type:_,selectors:[["app-godot-viewer"]],viewQuery:function(o,c){if(1&o&&e.Gf(r.ki,5),2&o){let l;e.iGM(l=e.CRH())&&(c.ShowContentInfoGodot=l.first)}},decls:22,vars:5,consts:[["slot","start",3,"click"],["defaultHref",""],[1,"main_table",2,"width","100%","height","100%","margin","0"],[2,"height","0"],["text-wrap",""],["id","menu_trigger"],["name","ellipsis-vertical"],["trigger","menu_trigger","dismissOnSelect",""],["id","viewer",1,"full_screen",2,"display","flex"],["trigger","ShowContentInfoGodot",3,"initialBreakpoint","breakpoints"],["button","",3,"click"],["button","","id","ShowContentInfoGodot",3,"click",4,"ngIf"],["button","","id","ShowContentInfoGodot",3,"click"],[1,"ion-text-end"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"ion-text-center"],["class","ion-text-end",4,"ngIf"],[2,"width","100%","text-align","center"]],template:function(o,c){1&o&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e._uU(3),e.qZA(),e.TgZ(4,"ion-buttons",0),e.NdJ("click",function(){return c.modalCtrl.dismiss()}),e._UZ(5,"ion-back-button",1),e.qZA()()(),e.TgZ(6,"ion-content")(7,"table",2)(8,"tr",3)(9,"td")(10,"ion-list-header")(11,"ion-label",4),e._uU(12),e.qZA(),e.TgZ(13,"ion-button",5),e._UZ(14,"ion-icon",6),e.qZA(),e.TgZ(15,"ion-popover",7),e.YNc(16,P,12,4,"ng-template"),e.qZA()()()(),e.TgZ(17,"tr")(18,"td"),e._UZ(19,"div",8),e.qZA()()(),e.TgZ(20,"ion-modal",9),e.YNc(21,$,19,8,"ng-template"),e.qZA()()),2&o&&(e.xp6(3),e.Oqu(c.lang.text.ContentViewer.Title),e.xp6(9),e.Oqu(c.FileInfo.filename),e.xp6(8),e.Q6J("initialBreakpoint",.5)("breakpoints",e.DdM(4,J)))},directives:[r.Gu,r.sr,r.wd,r.Sm,r.oU,r.cs,r.W2,r.yh,r.Q$,r.YG,r.gu,r.d8,r.q_,r.Ie,O.O5,r.ki,r.rH,O.sg],styles:[""]}),_})()},774:(X,V,h)=>{h.d(V,{B:()=>c});var a=h(655),r=h(3996),u=h(5016),Z=h(6505),D=h(549),t=h(9863),q=h(3496),N=h(5742),Y=h(4433),T=h(3336),O=h(6690),p=h(1282),P=h(9912),A=h(9808);function E(l,x){if(1&l){const i=t.EpF();t.TgZ(0,"ion-item",15),t.NdJ("click",function(){return t.CHM(i),t.oxw(2).modify_image()}),t.TgZ(1,"ion-label"),t._uU(2),t.qZA()()}if(2&l){const i=t.oxw(2);t.xp6(2),t.Oqu(i.lang.text.ContentViewer.Edit)}}function k(l,x){if(1&l){const i=t.EpF();t.TgZ(0,"ion-item",16),t.NdJ("click",function(){return t.CHM(i),t.oxw(2).open_bottom_modal()}),t.TgZ(1,"ion-label"),t._uU(2),t.qZA()()}if(2&l){const i=t.oxw(2);t.xp6(2),t.Oqu(i.lang.text.ContentViewer.ContentInfo)}}function B(l,x){if(1&l){const i=t.EpF();t.TgZ(0,"ion-content")(1,"ion-list"),t.YNc(2,E,3,1,"ion-item",13),t.YNc(3,k,3,1,"ion-item",14),t.TgZ(4,"ion-item",15),t.NdJ("click",function(){return t.CHM(i),t.oxw().ShareContent()}),t.TgZ(5,"ion-label"),t._uU(6),t.qZA()(),t.TgZ(7,"ion-item",15),t.NdJ("click",function(){return t.CHM(i),t.oxw().download_file()}),t.TgZ(8,"ion-label"),t._uU(9),t.qZA()()()()}if(2&l){const i=t.oxw();t.xp6(2),t.Q6J("ngIf","audio"!=i.FileInfo.viewer&&!i.HasNoEditButton),t.xp6(1),t.Q6J("ngIf",i.FileInfo.content_creator),t.xp6(3),t.Oqu(i.lang.text.ContentViewer.ShareContent),t.xp6(3),t.Oqu(i.lang.text.ContentViewer.Download)}}function R(l,x){if(1&l&&(t.TgZ(0,"ion-label",17),t._uU(1),t.qZA()),2&l){const i=t.oxw(3);t.xp6(1),t.Oqu(i.lang.text.GlobalAct.variousCreator)}}function S(l,x){if(1&l&&(t.TgZ(0,"ion-label",17),t._uU(1),t.qZA()),2&l){const i=t.oxw(3);t.xp6(1),t.Oqu(i.lang.text.GlobalAct.FromCamera)}}function G(l,x){if(1&l&&(t.TgZ(0,"ion-label",17),t._uU(1),t.qZA()),2&l){const i=t.oxw(3);t.xp6(1),t.Oqu(i.lang.text.GlobalAct.FromVoidDraw)}}function H(l,x){if(1&l&&(t.TgZ(0,"ion-item")(1,"ion-label"),t._uU(2),t.qZA(),t.YNc(3,R,2,1,"ion-label",21),t.YNc(4,S,2,1,"ion-label",21),t.YNc(5,G,2,1,"ion-label",21),t.qZA()),2&l){const i=t.oxw(2);t.xp6(2),t.Oqu(i.lang.text.ContentInfo.SourceFrom),t.xp6(1),t.Q6J("ngIf","loaded"==i.content_creator.various),t.xp6(1),t.Q6J("ngIf","camera"==i.content_creator.various),t.xp6(1),t.Q6J("ngIf","voidDraw"==i.content_creator.various)}}function $(l,x){if(1&l&&(t.TgZ(0,"ion-label",17),t._uU(1),t.qZA()),2&l){const i=t.oxw(3);t.xp6(1),t.Oqu(i.lang.text.GlobalAct.variousCreator)}}function J(l,x){if(1&l&&(t.TgZ(0,"ion-label",17),t._uU(1),t.qZA()),2&l){const i=t.oxw(3);t.xp6(1),t.Oqu(i.lang.text.GlobalAct.FromCamera)}}function K(l,x){if(1&l&&(t.TgZ(0,"ion-label",17),t._uU(1),t.qZA()),2&l){const i=t.oxw(3);t.xp6(1),t.Oqu(i.lang.text.GlobalAct.FromVoidDraw)}}function _(l,x){if(1&l&&(t.TgZ(0,"div")(1,"ion-item-divider")(2,"div",22),t._uU(3),t.qZA()(),t.TgZ(4,"ion-item")(5,"ion-label"),t._uU(6),t.qZA(),t.TgZ(7,"ion-label",17),t._uU(8),t.qZA()(),t.TgZ(9,"ion-item")(10,"ion-label"),t._uU(11),t.qZA(),t.YNc(12,$,2,1,"ion-label",21),t.YNc(13,J,2,1,"ion-label",21),t.YNc(14,K,2,1,"ion-label",21),t.qZA()()),2&l){const i=x.$implicit,n=t.oxw(2);t.xp6(3),t.Oqu(i.timeDisplay),t.xp6(3),t.Oqu(n.lang.text.ContentInfo.Publisher),t.xp6(2),t.Oqu(i.publisher||i.display_name||n.lang.text.Profile.noname_user),t.xp6(3),t.Oqu(n.lang.text.ContentInfo.SourceFrom),t.xp6(1),t.Q6J("ngIf","loaded"==i.various),t.xp6(1),t.Q6J("ngIf","camera"==i.various),t.xp6(1),t.Q6J("ngIf","voidDraw"==i.various)}}function w(l,x){if(1&l){const i=t.EpF();t.TgZ(0,"ion-content")(1,"ion-item-divider")(2,"ion-label"),t._uU(3),t.qZA()(),t.TgZ(4,"ion-item")(5,"ion-label"),t._uU(6),t.qZA(),t.TgZ(7,"ion-label",17),t._uU(8),t.qZA()(),t.YNc(9,H,6,4,"ion-item",18),t.TgZ(10,"ion-item")(11,"ion-label"),t._uU(12),t.qZA(),t.TgZ(13,"ion-label",17),t._uU(14),t.qZA()(),t.YNc(15,_,15,7,"div",19),t.TgZ(16,"ion-item",15),t.NdJ("click",function(){return t.CHM(i),t.oxw().ShowContentInfoIonic.dismiss()}),t.TgZ(17,"ion-label",20),t._uU(18),t.qZA()()()}if(2&l){const i=t.oxw();t.xp6(3),t.Oqu(i.lang.text.ContentInfo.WorkLogs),t.xp6(3),t.Oqu(i.lang.text.ContentInfo.LastPost),t.xp6(2),t.hij(" ",(i.content_creator.user_id?i.content_creator.is_me?i.nakama.users.self.display_name:i.nakama.users[i.isOfficial][i.target][i.content_creator.user_id].display_name:i.content_creator.display_name)||i.lang.text.Profile.noname_user,""),t.xp6(1),t.Q6J("ngIf",i.content_creator.various),t.xp6(3),t.Oqu(i.lang.text.ContentInfo.TimeAt),t.xp6(2),t.Oqu(i.content_creator.timeDisplay),t.xp6(1),t.Q6J("ngForOf",i.content_related_creator),t.xp6(3),t.Oqu(i.lang.text.ContentInfo.CloseModal)}}const o=function(){return[.5,1]};let c=(()=>{class l{constructor(i,n,s,d,m,I,v,b,U,F,L){this.modalCtrl=i,this.navParams=n,this.indexed=s,this.lang=d,this.file=m,this.p5toast=I,this.alertCtrl=v,this.loadingCtrl=b,this.fileOpener=U,this.global=F,this.nakama=L,this.useP5Navigator=!0,this.image_info={}}ngOnInit(){return(0,a.mG)(this,void 0,void 0,function*(){this.FileInfo=this.navParams.get("info"),this.ContentBox=document.getElementById("ContentBox"),this.FileHeader=document.getElementById("FileHeader"),this.HasNoEditButton=this.navParams.get("no_edit")||!1,this.blob=yield this.indexed.loadBlobFromUserPath(this.navParams.get("path"),this.FileInfo.type),this.FileURL=URL.createObjectURL(this.blob),this.CreateContentInfo()})}CreateContentInfo(){this.isOfficial=this.navParams.get("isOfficial"),this.target=this.navParams.get("target");try{this.content_creator=this.FileInfo.content_creator,this.content_creator.timeDisplay=new Date(this.content_creator.timestamp).toLocaleString(),this.content_related_creator=this.FileInfo.content_related_creator,this.content_creator.user_id&&(this.content_creator.is_me=this.nakama.servers[this.isOfficial][this.target].session.user_id==this.content_creator.user_id);for(let i=0,n=this.content_related_creator.length;i<n;i++)this.content_related_creator[i].user_id&&(this.content_related_creator[i].is_me=this.nakama.servers[this.isOfficial][this.target].session.user_id==this.content_related_creator[i].user_id),this.content_related_creator[i].timeDisplay=new Date(this.content_related_creator[i].timestamp).toLocaleString()}catch(i){}try{this.content_related_creator[0].publisher=this.content_related_creator[0].is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_related_creator[0].user_id].display_name,this.content_related_creator[0].timestamp==this.content_related_creator[1].timestamp&&(this.content_related_creator[0].publisher=this.content_related_creator[1].is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_related_creator[1].user_id].display_name,this.content_related_creator.splice(1,1))}catch(i){try{this.content_related_creator[0].publisher=this.content_related_creator[1].display_name,this.content_related_creator[0].timestamp==this.content_related_creator[1].timestamp&&(this.content_related_creator[0].publisher=this.content_related_creator[1].display_name,this.content_related_creator.splice(1,1))}catch(n){}try{this.content_related_creator[0].publisher||(this.content_related_creator[0].publisher=this.content_related_creator[0].display_name)}catch(n){}}try{this.content_related_creator.sort((i,n)=>i.timestamp>n.timestamp?-1:i.timestamp<n.timestamp?1:0)}catch(i){}}ionViewDidEnter(){return(0,a.mG)(this,void 0,void 0,function*(){let i=document.getElementById("p5canvas");switch(this.FileInfo.viewer){case"image":this.p5canvas=new Z(n=>{let s;n.setup=()=>(0,a.mG)(this,void 0,void 0,function*(){i.style.maxWidth="100%",i.style.overflow="hidden",this.ContentBox.style.overflow="hidden",n.noCanvas();let g=document.createElement("img");g.hidden=!0,g.src=this.FileURL,g.onload=()=>{i.style.backgroundImage=`url(${this.FileURL})`,i.style.backgroundRepeat="no-repeat",i.style.pointerEvents="none",this.image_info.width=g.naturalWidth,this.image_info.height=g.naturalHeight,m=n.createVector(g.naturalWidth,g.naturalHeight),d(),g.remove()},("Android"==u.n$||"iOS"==u.n$)&&(s=document.createElement("iframe"),s.setAttribute("src",this.FileURL),s.setAttribute("frameborder","0"),s.setAttribute("class","full_screen"),s.setAttribute("style","position: relative; pointer-events: all"),s.hidden=!0,i.appendChild(s)),n.noLoop()});let d=()=>{if(this.image_info.width/this.image_info.height<i.clientWidth/i.clientHeight){let g=this.image_info.width*i.clientHeight/this.image_info.height;i.style.backgroundSize=`${g}px`,i.style.backgroundPositionX=(i.clientWidth-g)/2+"px",i.style.backgroundPositionY="0px"}else i.style.backgroundSize=`${i.clientWidth}px`,i.style.backgroundPositionX="0px",i.style.backgroundPositionY=i.clientHeight/2-m.y*(i.clientWidth/m.x)/2+"px"};n.windowResized=()=>{setTimeout(()=>{d()},50)};let m,I=n.createVector(),v=n.createVector(),b=n.createVector(),U=1,F=()=>{i.style.backgroundPositionX=`${I.x+b.x}px`,i.style.backgroundPositionY=`${I.y+b.y}px`},L=(g,M)=>{let f=U,y=U*M,W=Number(i.style.backgroundPositionX.split("px")[0]),z=Number(i.style.backgroundPositionY.split("px")[0]),tt=(f-y)*n.map(g.x,W,W+f,0,1),et=(f-y)/m.x*m.y*n.map(g.y,z,z+f/m.x*m.y,0,1);i.style.backgroundPositionX=`${W+tt}px`,i.style.backgroundPositionY=`${z+et}px`,i.style.backgroundSize=`${y}px`};n.mousePressed=()=>{!this.useP5Navigator||(n.mouseButton==n.CENTER&&d(),"DesktopPWA"==u.n$&&(I=n.createVector(Number(i.style.backgroundPositionX.split("px")[0]),Number(i.style.backgroundPositionY.split("px")[0])),v=n.createVector(n.mouseX,n.mouseY)))},n.mouseWheel=g=>{!this.useP5Navigator||(U=Number(i.style.backgroundSize.split("px")[0]),L(n.createVector(i.clientWidth/2,i.clientHeight/2),1-g.delta/1e3))},n.mouseDragged=()=>{!this.useP5Navigator||"DesktopPWA"==u.n$&&(b=n.createVector(n.mouseX,n.mouseY),b.sub(v),F())};let j,C={},Q=!1;n.touchStarted=g=>{if(this.useP5Navigator){for(let f=0,y=g.changedTouches.length;f<y;f++)C[g.changedTouches[f].identifier]=n.createVector(g.changedTouches[f].clientX,g.changedTouches[f].clientY);switch(Object.keys(C).length){case 1:I=n.createVector(Number(i.style.backgroundPositionX.split("px")[0]),Number(i.style.backgroundPositionY.split("px")[0])),v=C[g.changedTouches[0].identifier].copy();break;case 2:I=n.createVector(Number(i.style.backgroundPositionX.split("px")[0]),Number(i.style.backgroundPositionY.split("px")[0]));let f=C[0].copy();j=f.dist(C[1]),v=f.add(C[1]).div(2).copy(),U=Number(i.style.backgroundSize.split("px")[0]),F();break;default:Q=!0,d()}}},n.touchMoved=g=>{if(this.useP5Navigator&&!Q){for(let f=0,y=g.changedTouches.length;f<y;f++)C[g.changedTouches[f].identifier]=n.createVector(g.changedTouches[f].clientX,g.changedTouches[f].clientY);switch(Object.keys(C).length){case 1:b=C[g.changedTouches[0].identifier].copy(),b.sub(v),F();break;case 2:let f=C[0].copy(),y=f.dist(C[1]);b=f.add(C[1]).div(2).copy();let W=b.copy();b.sub(v),F(),L(W,y/j)}}},n.touchEnded=g=>{if(this.useP5Navigator&&"changedTouches"in g){for(let f=0,y=g.changedTouches.length;f<y;f++)delete C[g.changedTouches[f].identifier];switch(Object.keys(C).length){case 1:I=n.createVector(Number(i.style.backgroundPositionX.split("px")[0]),Number(i.style.backgroundPositionY.split("px")[0])),v=C[Object.keys(C)[0]].copy();break;case 0:Q=!1}}}});break;case"audio":this.p5canvas=new Z(n=>{var s;n.setup=()=>{n.noCanvas(),n.noLoop(),s=n.createAudio([this.FileURL],()=>{i.appendChild(s.elt),s.elt.hidden=!0,setTimeout(()=>{d(),s.elt.hidden=!1},50),s.showControls(),s.play()})};let d=()=>{let m=this.ContentBox.offsetWidth;s.elt.setAttribute("style","position: relative; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%);"),s.size(m,25)};n.windowResized=()=>{setTimeout(()=>{d()},50)}});break;case"video":this.p5canvas=new Z(n=>{var s;n.setup=()=>{n.noCanvas(),n.noLoop(),s=n.createVideo([this.FileURL],()=>{i.appendChild(s.elt),s.elt.hidden=!0,setTimeout(()=>{this.image_info.width=s.elt.videoWidth,this.image_info.height=s.elt.videoHeight,d(),s.elt.hidden=!1},50),s.showControls(),s.play()}),n.VideoMedia=s};let d=()=>{let m=this.ContentBox.offsetWidth,I=this.ContentBox.offsetHeight-this.FileHeader.offsetHeight,v=s.width,b=s.height;s.elt.setAttribute("style","position: relative; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%);"),v<b?(b=I,v=v/s.height*b):(v=m,b=b/s.width*v||I/2),s.size(v,b)};n.windowResized=()=>{setTimeout(()=>{d()},50)}});break;case"text":this.p5canvas=new Z(n=>{n.setup=()=>{n.noCanvas(),n.noLoop(),n.loadStrings(this.FileURL,s=>{let d=document.createElement("textarea");d.disabled=!0,d.className="infobox",d.setAttribute("style","height: 100%; display: block;"),d.textContent=s.join("\n"),i.appendChild(d),n.TextArea=d},s=>{console.error("\uc5f4\ub78c\ud560 \uc218 \uc5c6\ub294 \ud30c\uc77c: ",s),i.textContent="\uc5f4\ub78c\ud560 \uc218 \uc5c6\ub294 \ud30c\uc77c\uc785\ub2c8\ub2e4.",this.FileInfo.else=!0})}});break;case"disabled":try{yield this.file.writeFile(this.file.externalDataDirectory,`viewer_tmp.${this.FileInfo.file_ext}`,this.blob),this.fileOpener.open(this.file.externalDataDirectory+`viewer_tmp.${this.FileInfo.file_ext}`,this.FileInfo.type||`application/${this.FileInfo.file_ext}`)}catch(n){console.log("open file failed: ",n),this.p5toast.show({text:`${this.lang.text.ChatRoom.cannot_open_file}: ${n.message}`})}}})}open_bottom_modal(){this.ShowContentInfoIonic.onDidDismiss().then(i=>{this.useP5Navigator=!0}),this.useP5Navigator=!1,this.ShowContentInfoIonic.present()}modify_image(){return(0,a.mG)(this,void 0,void 0,function*(){switch(this.FileInfo.viewer){case"text":let i=yield this.loadingCtrl.create({message:this.lang.text.TodoDetail.WIP});i.present(),this.image_info.width=this.p5canvas.TextArea.clientWidth,this.image_info.height=this.p5canvas.TextArea.scrollHeight,this.p5canvas.createCanvas(this.image_info.width,this.image_info.height),this.p5canvas.textSize(16),this.p5canvas.textWrap(this.p5canvas.WORD);let n=.05*this.p5canvas.width;this.p5canvas.text(this.p5canvas.TextArea.textContent,n,n,this.p5canvas.width-2*n),this.p5canvas.saveFrames("","png",1,1,s=>(0,a.mG)(this,void 0,void 0,function*(){try{i.dismiss(),yield this.indexed.saveBase64ToUserPath(s[0].imageData.replace(/"|=|\\/g,""),"tmp_files/text_edit/text_copy.png"),this.image_info.path="tmp_files/text_edit/text_copy.png",this.modalCtrl.dismiss(this.image_info)}catch(d){console.log("\ud30c\uc77c \uc800\uc7a5 \uc624\ub958: ",d)}}));break;case"video":try{let s=yield this.loadingCtrl.create({message:this.lang.text.TodoDetail.WIP});s.present(),this.p5canvas.VideoMedia.pause(),this.p5canvas.createCanvas(this.image_info.width,this.image_info.height),this.p5canvas.image(this.p5canvas.VideoMedia,0,0,this.image_info.width,this.image_info.height),this.p5canvas.saveFrames("","png",1,1,d=>(0,a.mG)(this,void 0,void 0,function*(){try{s.dismiss(),yield this.indexed.saveBase64ToUserPath(d[0].imageData.replace(/"|=|\\/g,""),"tmp_files/video_edit/frame.png"),this.image_info.path="tmp_files/video_edit/frame.png",this.modalCtrl.dismiss(this.image_info)}catch(m){console.log("\ud30c\uc77c \uc800\uc7a5 \uc624\ub958: ",m)}}))}catch(s){console.log("\uc7ac\uc0dd\uc911\uc778 \ube44\ub514\uc624 \uc774\ubbf8\uc9c0 \ucd94\ucd9c \uc624\ub958: ",s)}break;default:this.modalCtrl.dismiss(this.image_info)}})}download_file(){"DesktopPWA"==u.n$||"MobilePWA"==u.n$?this.indexed.DownloadFileFromUserPath(this.navParams.get("path"),this.FileInfo.type,this.FileInfo.filename):this.alertCtrl.create({header:this.lang.text.ContentViewer.Filename,inputs:[{name:"filename",placeholder:this.FileInfo.filename,type:"text"}],buttons:[{text:this.lang.text.ContentViewer.saveFile,handler:i=>(0,a.mG)(this,void 0,void 0,function*(){let n=yield this.loadingCtrl.create({message:this.lang.text.TodoDetail.WIP});n.present();let s=i.filename?`${i.filename.replace(/:|\?|\/|\\|<|>/g,"")}.${this.FileInfo.file_ext}`:this.FileInfo.filename,d=yield this.indexed.loadBlobFromUserPath(this.navParams.get("path"),this.FileInfo.type);this.file.writeFile(this.file.externalDataDirectory,s,d).then(m=>{n.dismiss(),this.p5toast.show({text:this.lang.text.ContentViewer.fileSaved})}).catch(m=>{12===(n.dismiss(),m.code)?(this.p5toast.show({text:this.lang.text.ContentViewer.AlreadyExist}),this.download_file()):console.log("\uc900\ube44\ub418\uc9c0 \uc54a\uc740 \uc624\ub958 \ubc18\ud658: ",m)})})}]}).then(i=>i.present())}ShareContent(){let i=this.nakama.rearrange_channels();for(let n=i.length-1;n>=0;n--)("missing"==i[n].status||"offline"==i[n].status)&&i.splice(n,1);i.length?this.modalCtrl.create({component:D.D,componentProps:{file:this.FileInfo,channels:i}}).then(n=>{n.onDidDismiss().then(s=>this.modalCtrl.dismiss()),n.present()}):this.p5toast.show({text:this.lang.text.ShareContentToOther.NoChannelToShare})}ionViewWillLeave(){return(0,a.mG)(this,void 0,void 0,function*(){if("video"==this.FileInfo.viewer)try{let s,d,n=this.p5canvas.VideoMedia.size();n.width>n.height?(s=192,d=n.height/n.width*192):(s=n.width/n.height*192,d=192),this.p5canvas.createCanvas(s,d),this.p5canvas.image(this.p5canvas.VideoMedia,0,0,s,d),this.p5canvas.fill(255,128),this.p5canvas.rect(0,0,s,d),this.p5canvas.textWrap(this.p5canvas.CHAR),this.p5canvas.textSize(16);let m=d/16;this.p5canvas.push(),this.p5canvas.translate(m/6,m/6),this.p5canvas.fill(0),this.p5canvas.text(this.FileInfo.filename,m,m,s-2*m,d-2*m),this.p5canvas.filter(this.p5canvas.BLUR,3),this.p5canvas.pop(),this.p5canvas.fill(255),this.p5canvas.text(this.FileInfo.filename,m,m,s-2*m,d-2*m),this.p5canvas.saveFrames("","png",1,1,I=>(0,a.mG)(this,void 0,void 0,function*(){try{yield this.indexed.saveBase64ToUserPath(I[0].imageData.replace(/"|=|\\/g,""),`${this.FileInfo.path}_thumbnail.png`),this.global.modulate_thumbnail(this.FileInfo,"")}catch(v){console.log("\uc378\ub124\uc77c \uc800\uc7a5 \uc624\ub958: ",v)}}))}catch(n){console.log("\uc791\uc5c5\uc911 \uc624\ub958\ubcf4\uae30: ",n)}this.p5canvas&&this.p5canvas.remove(),this.FileURL&&URL.revokeObjectURL(this.FileURL),this.file.checkFile(this.file.externalDataDirectory,`viewer_tmp.${this.FileInfo.file_ext}`)&&this.file.removeFile(this.file.externalDataDirectory,`viewer_tmp.${this.FileInfo.file_ext}`)})}}return l.\u0275fac=function(i){return new(i||l)(t.Y36(r.IN),t.Y36(r.X1),t.Y36(q.H),t.Y36(N.b),t.Y36(Y.$),t.Y36(T.F),t.Y36(r.Br),t.Y36(r.HT),t.Y36(O.u),t.Y36(p.AN),t.Y36(P.a))},l.\u0275cmp=t.Xpm({type:l,selectors:[["app-ionic-viewer"]],viewQuery:function(i,n){if(1&i&&t.Gf(r.ki,5),2&i){let s;t.iGM(s=t.CRH())&&(n.ShowContentInfoIonic=s.first)}},decls:22,vars:5,consts:[["id","Toolbar"],["slot","start",3,"click"],["defaultHref",""],["id","ContentBox"],[1,"main_table_elt"],[2,"height","0"],["id","FileHeader"],["text-wrap",""],["id","menu_trigger"],["name","ellipsis-vertical"],["trigger","menu_trigger","dismissOnSelect",""],["id","p5canvas",1,"full_screen"],["trigger","ShowContentInfoIonic",3,"initialBreakpoint","breakpoints"],["button","",3,"click",4,"ngIf"],["button","","id","ShowContentInfoIonic",3,"click",4,"ngIf"],["button","",3,"click"],["button","","id","ShowContentInfoIonic",3,"click"],[1,"ion-text-end"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"ion-text-center"],["class","ion-text-end",4,"ngIf"],[2,"width","100%","text-align","center"]],template:function(i,n){1&i&&(t.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),t._uU(3),t.qZA(),t.TgZ(4,"ion-buttons",1),t.NdJ("click",function(){return n.modalCtrl.dismiss()}),t._UZ(5,"ion-back-button",2),t.qZA()()(),t.TgZ(6,"ion-content",3)(7,"table",4)(8,"tr",5)(9,"td")(10,"ion-list-header",6)(11,"ion-label",7),t._uU(12),t.qZA(),t.TgZ(13,"ion-button",8),t._UZ(14,"ion-icon",9),t.qZA(),t.TgZ(15,"ion-popover",10),t.YNc(16,B,10,4,"ng-template"),t.qZA()()()(),t.TgZ(17,"tr")(18,"td"),t._UZ(19,"div",11),t.qZA()()(),t.TgZ(20,"ion-modal",12),t.YNc(21,w,19,8,"ng-template"),t.qZA()()),2&i&&(t.xp6(3),t.Oqu(n.lang.text.ContentViewer.Title),t.xp6(9),t.Oqu(n.FileInfo.filename),t.xp6(8),t.Q6J("initialBreakpoint",.5)("breakpoints",t.DdM(4,o)))},directives:[r.Gu,r.sr,r.wd,r.Sm,r.oU,r.cs,r.W2,r.yh,r.Q$,r.YG,r.gu,r.d8,r.q_,A.O5,r.Ie,r.ki,r.rH,A.sg],styles:[".main_table_elt[_ngcontent-%COMP%]{width:100%;height:100%;border:0;margin:0}"]}),l})()},549:(X,V,h)=>{h.d(V,{D:()=>Y});var a=h(9863),r=h(5742),u=h(3996),Z=h(4606),e=h(9912),D=h(9808);function t(T,O){1&T&&a._UZ(0,"div",11)}function q(T,O){if(1&T&&a._UZ(0,"img",12),2&T){const p=a.oxw().$implicit;a.Akn("online"==p.status||3==p.redirect.type&&"pending"==p.status?"filter: grayscale(0) contrast(1)":"filter: grayscale(.9) contrast(1.4)"),a.Q6J("src",p.info.img,a.LSH)}}function N(T,O){if(1&T){const p=a.EpF();a.TgZ(0,"ion-item",3),a.NdJ("click",function(){const E=a.CHM(p).$implicit;return a.oxw().go_to_chatroom(E)}),a.TgZ(1,"div",4),a.YNc(2,t,1,0,"div",5),a.qZA(),a.TgZ(3,"div",6),a.YNc(4,q,1,3,"img",7),a.qZA(),a.TgZ(5,"ion-label")(6,"div",8)(7,"table")(8,"tr")(9,"td"),a._uU(10),a.qZA(),a.TgZ(11,"td",9),a._uU(12),a.qZA()()()(),a.TgZ(13,"div",10),a._uU(14),a.qZA()()()}if(2&T){const p=O.$implicit,P=a.oxw();a.xp6(1),a.Akn("background-color: "+P.statusBar.colors[p.status||"offline"]),a.xp6(1),a.Q6J("ngIf",p.is_new),a.xp6(2),a.Q6J("ngIf",p.info),a.xp6(6),a.hij(" ",p.info?p.info.name||p.info.display_name||P.lang.text.ChatRoom.noname_chatroom:p.title||P.lang.text.ChatRoom.noname_chatroom," "),a.xp6(2),a.hij(" ","("+p.server.target+")"," "),a.xp6(2),a.hij(" ",p.last_comment||p.noti||P.lang.text.Subscribes.noMessageHistory," ")}}let Y=(()=>{class T{constructor(p,P,A,E,k){this.lang=p,this.navParams=P,this.modalCtrl=A,this.statusBar=E,this.nakama=k}ngOnInit(){this.channels=this.navParams.get("channels")}go_to_chatroom(p){this.nakama.go_to_chatroom_without_admob_act(p,this.navParams.get("file")),this.modalCtrl.dismiss()}}return T.\u0275fac=function(p){return new(p||T)(a.Y36(r.b),a.Y36(u.X1),a.Y36(u.IN),a.Y36(Z.g),a.Y36(e.a))},T.\u0275cmp=a.Xpm({type:T,selectors:[["app-share-content-to-other"]],decls:11,vars:3,consts:[["slot","start",3,"click"],["defaultHref",""],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"],[1,"additional_form","status_bar_double"],["class","new_circle",4,"ngIf"],[1,"additional_form","bg_img_form"],["class","profile_img",3,"style","src",4,"ngIf"],[1,"form_margin","header"],[1,"server_target"],[1,"form_margin","content"],[1,"new_circle"],[1,"profile_img",3,"src"]],template:function(p,P){1&p&&(a.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),a._uU(3),a.qZA(),a.TgZ(4,"ion-buttons",0),a.NdJ("click",function(){return P.modalCtrl.dismiss()}),a._UZ(5,"ion-back-button",1),a.qZA()()(),a.TgZ(6,"ion-content")(7,"ion-item-divider")(8,"ion-label"),a._uU(9),a.qZA()(),a.YNc(10,N,15,7,"ion-item",2),a.qZA()),2&p&&(a.xp6(3),a.Oqu(P.lang.text.ShareContentToOther.Title),a.xp6(6),a.Oqu(P.lang.text.ShareContentToOther.AvailableChannels),a.xp6(1),a.Q6J("ngForOf",P.channels))},directives:[u.Gu,u.sr,u.wd,u.Sm,u.oU,u.cs,u.W2,u.rH,u.Q$,D.sg,u.Ie,D.O5],styles:[".server_target[_ngcontent-%COMP%]{color:#888;padding-left:4px}.content[_ngcontent-%COMP%]{color:#888;height:24px;display:table-cell;vertical-align:middle;padding:0 16px}"]}),T})()}}]);