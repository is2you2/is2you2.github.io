"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3875],{3875:(Mt,b,r)=>{r.r(b),r.d(b,{ChatRoomPageModule:()=>wt});var C=r(9808),x=r(4182),_=r(3996),v=r(9705),u=r(655),O=r(6505),P=r(9194),w=r(9123),m=r(5016),R=r(774),$=r(5087),y=r(9805),Z=r(7898),L=r(428),t=r(9863),A=r(9912),U=r(8677),J=r(3336),F=r(4606),M=r(3496),D=r(5742),N=r(2313),H=r(1282),Y=r(5129),Q=r(4433);function S(i,o){if(1&i&&(t.TgZ(0,"div",30)(1,"font",31),t._uU(2),t.qZA()()),2&i){const e=t.oxw().$implicit;t.xp6(2),t.hij(" ",e.msgDate," ")}}function E(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div",32)(1,"span",33),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().$implicit;return t.oxw().user_detail(n)}),t.TgZ(2,"b")(3,"font",34),t._uU(4),t.qZA()()(),t.TgZ(5,"span",35),t._uU(6),t.qZA()()}if(2&i){const e=t.oxw().$implicit,s=t.oxw();t.xp6(3),t.MGl("color","#",e.is_me&&s.nakama.users.self.online||!e.is_me&&s.nakama.users[s.isOfficial][s.target][e.sender_id].online?e.color:"888",""),t.xp6(1),t.hij(" ",e.user_display_name,""),t.xp6(2),t.Oqu(e.msgTime)}}function j(i,o){1&i&&t._UZ(0,"div",44)}function B(i,o){if(1&i&&(t.TgZ(0,"span",45),t._uU(1),t.qZA()),2&i){const e=o.$implicit;t.xp6(1),t.hij(" ",e," ")}}function z(i,o){if(1&i&&(t.TgZ(0,"div",40)(1,"p",41),t._uU(2),t.qZA(),t.YNc(3,j,1,0,"div",42),t.YNc(4,B,2,1,"span",43),t.qZA()),2&i){const e=t.oxw(2).$implicit;t.xp6(2),t.hij(" ",e.content.filename," "),t.xp6(1),t.Q6J("ngIf",e.content.text),t.xp6(1),t.Q6J("ngForOf",e.content.text)}}function G(i,o){if(1&i&&(t.TgZ(0,"div",46),t._UZ(1,"img",47),t.qZA()),2&i){const e=t.oxw(2).$implicit;t.xp6(1),t.Q6J("src",e.content.thumbnail,t.LSH)("alt",e.content.filename)}}function q(i,o){if(1&i&&(t.TgZ(0,"div",48),t._uU(1),t.qZA()),2&i){const e=t.oxw(2).$implicit,s=t.oxw();t.xp6(1),t.hij(" ",s.nakama.channel_transfer[s.isOfficial][s.target][e.channel_id][e.message_id].progress.length,"")}}function W(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div",36),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().$implicit;return t.oxw().file_detail(n)}),t.YNc(1,z,5,3,"div",37),t.YNc(2,G,2,2,"div",38),t.YNc(3,q,2,1,"div",39),t.qZA()}if(2&i){const e=t.oxw().$implicit,s=t.oxw();t.xp6(1),t.Q6J("ngIf",!e.content.thumbnail),t.xp6(1),t.Q6J("ngIf",e.content.thumbnail),t.xp6(1),t.Q6J("ngIf",s.nakama.channel_transfer[s.isOfficial][s.target]&&s.nakama.channel_transfer[s.isOfficial][s.target][e.channel_id]&&s.nakama.channel_transfer[s.isOfficial][s.target][e.channel_id][e.message_id])}}function V(i,o){if(1&i&&(t.TgZ(0,"div",49)(1,"div",50),t._uU(2),t.qZA()()),2&i){const e=t.oxw().$implicit;t.xp6(2),t.hij(" ",e.content.noti," ")}}function K(i,o){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.text," ")}}function X(i,o){if(1&i&&(t.TgZ(0,"a",55),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.Q6J("href",e.text,t.LSH),t.xp6(1),t.Oqu(e.text)}}function tt(i,o){if(1&i&&(t.TgZ(0,"span"),t.YNc(1,K,2,1,"span",53),t.YNc(2,X,2,2,"a",54),t.qZA()),2&i){const e=o.$implicit;t.xp6(1),t.Q6J("ngIf",!e.href),t.xp6(1),t.Q6J("ngIf",e.href)}}function et(i,o){if(1&i&&(t.TgZ(0,"div"),t.YNc(1,tt,3,2,"span",52),t.qZA()),2&i){const e=o.$implicit;t.xp6(1),t.Q6J("ngForOf",e)}}function it(i,o){if(1&i&&(t.TgZ(0,"div",51),t.YNc(1,et,2,1,"div",52),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngForOf",e.content.msg)}}function st(i,o){if(1&i&&(t.TgZ(0,"div",56),t._uU(1),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.hij(" ",e.lang.text.ChatRoom.YouReadHereLast,"")}}function nt(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div",23),t.NdJ("click",function(){const a=t.CHM(e).$implicit;return t.oxw().message_detail(a)}),t.YNc(1,S,3,1,"div",24),t.YNc(2,E,7,3,"div",25),t.YNc(3,W,4,3,"div",26),t.YNc(4,V,3,1,"div",27),t.YNc(5,it,2,1,"div",28),t.YNc(6,st,2,1,"div",29),t.qZA()}if(2&i){const e=o.$implicit;t.xp6(1),t.Q6J("ngIf",e.showInfo&&e.showInfo.date),t.xp6(1),t.Q6J("ngIf",e.showInfo&&e.showInfo.sender),t.xp6(1),t.Q6J("ngIf",e.content.filename),t.xp6(1),t.Q6J("ngIf",e.content.noti),t.xp6(1),t.Q6J("ngIf",e.content.msg),t.xp6(1),t.Q6J("ngIf",e.isLastRead)}}function at(i,o){1&i&&t._UZ(0,"div",44)}function ot(i,o){if(1&i&&(t.TgZ(0,"span",45),t._uU(1),t.qZA()),2&i){const e=o.$implicit;t.xp6(1),t.hij(" ",e," ")}}function lt(i,o){if(1&i&&(t.TgZ(0,"div",40)(1,"p",41),t._uU(2),t.qZA(),t.YNc(3,at,1,0,"div",42),t.YNc(4,ot,2,1,"span",43),t.qZA()),2&i){const e=t.oxw(2).$implicit;t.xp6(2),t.hij(" ",e.content.filename," "),t.xp6(1),t.Q6J("ngIf",e.content.text),t.xp6(1),t.Q6J("ngForOf",e.content.text)}}function rt(i,o){if(1&i&&(t.TgZ(0,"div",46),t._UZ(1,"img",47),t.qZA()),2&i){const e=t.oxw(2).$implicit;t.xp6(1),t.Q6J("src",e.content.thumbnail,t.LSH)("alt",e.content.filename)}}function ht(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div",36),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().$implicit;return t.oxw().file_detail(n)}),t.YNc(1,lt,5,3,"div",37),t.YNc(2,rt,2,2,"div",38),t.qZA()}if(2&i){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngIf",!e.content.thumbnail),t.xp6(1),t.Q6J("ngIf",e.content.thumbnail)}}function ct(i,o){if(1&i&&(t.TgZ(0,"span",59),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.text," ")}}function dt(i,o){if(1&i&&(t.TgZ(0,"a",60),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.Q6J("href",e.text,t.LSH),t.xp6(1),t.Oqu(e.text)}}function _t(i,o){if(1&i&&(t.TgZ(0,"span"),t.YNc(1,ct,2,1,"span",57),t.YNc(2,dt,2,2,"a",58),t.qZA()),2&i){const e=o.$implicit;t.xp6(1),t.Q6J("ngIf",!e.href),t.xp6(1),t.Q6J("ngIf",e.href)}}function ft(i,o){if(1&i&&(t.TgZ(0,"div"),t.YNc(1,_t,3,2,"span",52),t.qZA()),2&i){const e=o.$implicit;t.xp6(1),t.Q6J("ngForOf",e)}}function mt(i,o){if(1&i&&(t.TgZ(0,"div",51),t.YNc(1,ft,2,1,"div",52),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngForOf",e.content.msg)}}function ut(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div",23),t.NdJ("click",function(){const a=t.CHM(e).$implicit;return t.oxw().message_detail(a)}),t.YNc(1,ht,3,2,"div",26),t.YNc(2,mt,2,1,"div",28),t.qZA()}if(2&i){const e=o.$implicit;t.xp6(1),t.Q6J("ngIf",e.content.filename),t.xp6(1),t.Q6J("ngIf",e.content.msg)}}function gt(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"ion-item",61),t.NdJ("click",function(){return t.CHM(e),t.oxw().pull_msg_history(!1)}),t.TgZ(1,"ion-label"),t._uU(2),t.qZA()()}if(2&i){const e=t.oxw();t.Q6J("disabled",!e.pullable),t.xp6(2),t.Oqu(e.lang.text.ChatRoom.fetch_next_chat)}}function pt(i,o){if(1&i&&t._UZ(0,"img",65),2&i){const e=t.oxw(3);t.Q6J("src",e.userInput.file.thumbnail,t.LSH)("alt",e.userInput.file.name)}}function xt(i,o){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&i){const e=o.$implicit;t.xp6(1),t.hij(" ",e," ")}}function vt(i,o){if(1&i&&(t.TgZ(0,"div",66),t.YNc(1,xt,2,1,"span",52),t.qZA()),2&i){const e=t.oxw(3);t.xp6(1),t.Q6J("ngForOf",e.userInput.file.thumbnail)}}function It(i,o){if(1&i&&(t.TgZ(0,"div"),t.YNc(1,pt,1,2,"img",63),t.YNc(2,vt,2,1,"div",64),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf","image"==e.userInput.file.typeheader),t.xp6(1),t.Q6J("ngIf","text"==e.userInput.file.typeheader)}}function Ct(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div",23),t.NdJ("click",function(){return t.CHM(e),t.oxw().removeAttach()}),t.TgZ(1,"div",62),t._uU(2),t.qZA(),t.YNc(3,It,3,2,"div",53),t.qZA()}if(2&i){const e=t.oxw();t.xp6(2),t.hij(" ",e.userInput.file.filename," "),t.xp6(1),t.Q6J("ngIf",e.userInput.file.thumbnail)}}function yt(i,o){if(1&i&&t._UZ(0,"ion-icon",70),2&i){const e=t.oxw().$implicit;t.Q6J("name",e.icon||"close-circle")}}function bt(i,o){if(1&i&&t._UZ(0,"img",71),2&i){const e=t.oxw().$implicit;t.Q6J("src","assets/icon/"+e.icon_img,t.LSH)("alt",e.title)}}function kt(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div",67),t.NdJ("click",function(){return t.CHM(e).$implicit.act()}),t.TgZ(1,"div"),t.YNc(2,yt,1,1,"ion-icon",68),t.YNc(3,bt,1,2,"img",69),t.qZA()()}if(2&i){const e=o.$implicit;t.Akn("cursor: "+(e.cursor||"pointer")+";"),t.Q6J("hidden",e.isHide),t.xp6(2),t.Q6J("ngIf",e.icon),t.xp6(1),t.Q6J("ngIf",e.icon_img)}}const Ot=[{path:"",component:(()=>{class i{constructor(e,s,n,a,l,c,h,p,Rt,$t,Zt,Lt,At,Ut,Jt,Ft){this.modalCtrl=e,this.navCtrl=s,this.route=n,this.router=a,this.nakama=l,this.noti=c,this.p5toast=h,this.statusBar=p,this.indexed=Rt,this.alertCtrl=$t,this.lang=Zt,this.sanitizer=Lt,this.global=At,this.loadingCtrl=Ut,this.camera=Jt,this.file=Ft,this.info={},this.foundLastRead=!1,this.messages=[],this.sending_msg=[],this.temporary_open_thumbnail={},this.extended_buttons=[{isHide:!0,icon:"close-circle-outline",act:()=>(0,u.mG)(this,void 0,void 0,function*(){let d=yield this.loadingCtrl.create({message:this.lang.text.TodoDetail.WIP});d.present(),delete this.nakama.channels_orig[this.isOfficial][this.target][this.info.id],this.nakama.channel_transfer[this.isOfficial][this.target]&&this.nakama.channel_transfer[this.isOfficial][this.target][this.info.id]&&delete this.nakama.channel_transfer[this.isOfficial][this.target][this.info.id],3==this.info.redirect.type&&(yield this.nakama.remove_group_list(this.nakama.groups[this.isOfficial][this.target][this.info.group_id],this.isOfficial,this.target)),yield this.nakama.remove_channel_files(this.isOfficial,this.target,this.info.id),yield this.indexed.GetFileListFromDB(`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}`,f=>{f.forEach(g=>this.indexed.removeFileFromUserPath(g)),d.dismiss()}),this.navCtrl.back()})},{icon:"log-out-outline",act:()=>(0,u.mG)(this,void 0,void 0,function*(){if(3!=this.info.redirect.type)try{yield this.nakama.servers[this.isOfficial][this.target].socket.leaveChat(this.info.id),this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].status="missing",this.extended_buttons.forEach(d=>{d.isHide=!0}),this.extended_buttons[0].isHide=!1}catch(d){console.error("\ucc44\ub110\uc5d0\uc11c \ub098\uc624\uae30 \uc2e4\ud328: ",d)}else this.extended_buttons[1].isHide=!0})},{icon:"settings-outline",act:()=>{3!=this.info.redirect.type?this.extended_buttons[2].isHide=!0:this.lock_modal_open||(this.lock_modal_open=!0,this.modalCtrl.create({component:L.x,componentProps:{info:this.nakama.groups[this.isOfficial][this.target][this.info.group_id],server:{isOfficial:this.isOfficial,target:this.target}}}).then(d=>{d.onWillDismiss().then(f=>{f.data&&(this.extended_buttons.forEach(g=>{g.isHide=!0}),this.extended_buttons[0].isHide=!1)}),d.present(),this.lock_modal_open=!1}))}},{icon:"camera-outline",act:()=>{this.camera.getPicture({destinationType:0,correctOrientation:!0}).then(d=>{this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId)),this.userInput.file={};let f=new Date;this.userInput.file.filename=`Camera_${f.toLocaleString().replace(/:/g,"_")}.jpeg`,this.userInput.file.file_ext="jpeg",this.userInput.file.thumbnail=this.sanitizer.bypassSecurityTrustUrl("data:image/jpeg;base64,"+d),this.userInput.file.type="image/jpeg",this.userInput.file.typeheader="image",this.userInput.file.content_related_creator=[{user_id:this.nakama.servers[this.isOfficial][this.target].session.user_id,timestamp:(new Date).toLocaleString(),display_name:this.nakama.users.self.display_name}],this.userInput.file.content_creator={user_id:this.nakama.servers[this.isOfficial][this.target].session.user_id,timestamp:(new Date).toLocaleString(),display_name:this.nakama.users.self.display_name},this.userInput.file.base64="data:image/jpeg;base64,"+d})}},{icon:"document-attach-outline",act:()=>{this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId)),document.getElementById(this.file_sel_id).click()}},{icon:"folder-open-outline",act:()=>{this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId)),this.modalCtrl.create({component:Z.P,componentProps:{path:`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files`,return:!0}}).then(d=>{d.onDidDismiss().then(f=>(0,u.mG)(this,void 0,void 0,function*(){if(f.data){let g=f.data.info,k=yield this.loadingCtrl.create({message:this.lang.text.TodoDetail.WIP});k.present();try{let I=yield this.indexed.loadBlobFromUserPath(g.path,""),T=URL.createObjectURL(I);setTimeout(()=>{URL.revokeObjectURL(T)},0),this.userInput.file={},this.userInput.file.filename=g.name,this.userInput.file.file_ext=g.file_ext,this.userInput.file.thumbnail=this.sanitizer.bypassSecurityTrustUrl(T),this.userInput.file.type="",this.userInput.file.typeheader=g.viewer,this.userInput.file.content_related_creator=[{display_name:this.lang.text.GlobalAct.UnCheckableCreator,timestamp:(new Date).toLocaleString()}],this.userInput.file.content_creator={user_id:this.nakama.servers[this.isOfficial][this.target].session.user_id,timestamp:(new Date).toLocaleString(),display_name:this.nakama.users.self.display_name},this.userInput.file.base64=yield this.global.GetBase64ThroughFileReader(I)}catch(I){console.log("\ud30c\uc77c \ubd88\ub7ec\uc624\uae30\uc5d0 \uc2e4\ud328\ud568: ",I)}k.dismiss()}})),d.present()})}},{icon_img:"voidDraw.png",act:()=>{this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId)),this.modalCtrl.create({component:y.$}).then(d=>{d.onWillDismiss().then(f=>{f.data&&(this.userInput.file={},this.userInput.file.filename=f.data.name,this.userInput.file.file_ext="png",this.userInput.file.thumbnail=this.sanitizer.bypassSecurityTrustUrl(f.data.img),this.userInput.file.type="image/png",this.userInput.file.typeheader="image",this.userInput.file.content_related_creator=[{user_id:this.nakama.servers[this.isOfficial][this.target].session.user_id,timestamp:(new Date).toLocaleString(),display_name:this.nakama.users.self.display_name}],this.userInput.file.content_creator={user_id:this.nakama.servers[this.isOfficial][this.target].session.user_id,timestamp:(new Date).toLocaleString(),display_name:this.nakama.users.self.display_name},this.userInput.file.base64=f.data.img,this.inputPlaceholder=`(${this.lang.text.ChatRoom.attachments}: ${this.userInput.file.filename})`,f.data.loadingCtrl.dismiss())}),d.present()})}}],this.next_cursor="",this.prev_cursor="",this.file_sel_id="file_sel_id",this.userInput={file:void 0,text:""},this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder,this.FILESIZE_LIMIT=5e6,this.pullable=!0,this.isHistoryLoaded=!1,this.LocalHistoryList=[],this.isHidden=!0,this.ChannelUserInputId="ChannelUserInputId",this.lock_modal_open=!1}inputFileSelected(e){return(0,u.mG)(this,void 0,void 0,function*(){if(e.target.files.length){this.userInput.file={},this.userInput.file.filename=e.target.files[0].name,this.userInput.file.file_ext=e.target.files[0].name.split(".")[1]||e.target.files[0].type||this.lang.text.ChatRoom.unknown_ext,this.userInput.file.size=e.target.files[0].size,this.userInput.file.type=e.target.files[0].type,this.userInput.file.typeheader=e.target.files[0].type.split("/")[0],this.userInput.file.content_related_creator=[{timestamp:(new Date).toLocaleString(),display_name:this.lang.text.GlobalAct.UnCheckableCreator}],this.userInput.file.content_creator={user_id:this.nakama.servers[this.isOfficial][this.target].session.user_id,timestamp:(new Date).toLocaleString(),display_name:this.nakama.users.self.display_name};let s=setInterval(()=>{},110);if(setTimeout(()=>{clearInterval(s)},1500),this.userInput.file.base64=yield this.global.GetBase64ThroughFileReader(e.target.files[0]),this.userInput.file.thumbnail=void 0,this.userInput.file.size<24e4)switch(this.userInput.file.typeheader){case"image":this.userInput.file.thumbnail=this.sanitizer.bypassSecurityTrustUrl(this.userInput.file.base64);break;case"text":new O(n=>{n.setup=()=>{n.loadStrings(this.userInput.file.base64,a=>{this.userInput.file.thumbnail=a,n.remove()},a=>{console.error("\ubb38\uc790\uc5f4 \ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",a),n.remove()})}})}this.inputPlaceholder=`(${this.lang.text.ChatRoom.attachments}: ${this.userInput.file.filename})`}else delete this.userInput.file,this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder})}ngOnInit(){this.nakama.removeBanner(),this.nakama.ChatroomLinkAct=e=>{delete this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].update,this.messages.length=0,this.info=e,this.init_chatroom()},this.route.queryParams.subscribe(e=>{const s=this.router.getCurrentNavigation().extras.state;s&&(this.info=s.info),this.init_chatroom()})}init_chatroom(){return(0,u.mG)(this,void 0,void 0,function*(){switch(this.file_sel_id=`chatroom_${this.info.id}_${(new Date).getTime()}`,this.ChannelUserInputId=`chatroom_input_${this.info.id}_${(new Date).getTime()}`,this.noti.Current=this.info.cnoti_id,this.info.cnoti_id&&this.noti.ClearNoti(this.info.cnoti_id),this.noti.RemoveListener(`openchat${this.info.cnoti_id}`),this.isOfficial=this.info.server.isOfficial,this.target=this.info.server.target,this.foundLastRead=this.info.last_read_id==this.info.last_comment_id,this.extended_buttons[3].isHide="Android"!=m.n$&&"iOS"!=m.n$,this.info.redirect.type){case 2:"missing"!=this.info.status&&(this.info.redirect?"online"==this.statusBar.groupServer[this.isOfficial][this.target]&&(this.info.status=this.nakama.load_other_user(this.info.redirect.id,this.isOfficial,this.target).online?"online":"pending"):this.info.status=this.info.info.online?"online":"pending",this.extended_buttons[2].isHide=!0);break;case 3:yield this.nakama.load_groups(this.isOfficial,this.target,this.info.group_id),this.extended_buttons[1].isHide=!0,delete this.extended_buttons[2].isHide}this.content_panel=document.getElementById("content"),this.send_thumbnail=document.getElementById("send_thumbnail"),this.nakama.channels_orig[this.isOfficial][this.target]&&this.nakama.channels_orig[this.isOfficial][this.target][this.info.id]&&(this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].update=e=>{this.nakama.check_sender_and_show_name(e,this.isOfficial,this.target),e.content.filename&&this.ModulateFileEmbedMessage(e),this.info.last_read_id=this.info.last_comment_id,this.check_if_send_msg(e),this.messages.push(e),this.modulate_chatmsg(this.messages.length-1,this.messages.length),setTimeout(()=>{this.info.is_new=!1,this.nakama.has_new_channel_msg=!1,this.content_panel.scrollIntoView({block:"start"})},0)}),"missing"==this.info.status&&(this.extended_buttons.forEach(e=>{e.isHide=!0}),this.extended_buttons[0].isHide=!1,3==this.info.redirect.type&&(this.extended_buttons[2].isHide=!1)),this.pull_msg_history(),setTimeout(()=>{this.content_panel.scrollIntoView({block:"start"})},500)})}ionViewDidEnter(){setTimeout(()=>{this.content_panel.scrollIntoView({behavior:"smooth",block:"start"})},0)}check_if_send_msg(e){for(let s=0,n=this.sending_msg.length;s<n;s++)if(e.sender_id==this.nakama.servers[this.isOfficial][this.target].session.user_id&&e.content.local_comp==this.sending_msg[s].content.local_comp){e.content.filename&&this.auto_open_thumbnail(e),this.sending_msg.splice(s,1);break}}auto_open_thumbnail(e){try{this.temporary_open_thumbnail[e.message_id]()}catch(s){this.temporary_open_thumbnail[e.message_id]=()=>{this.indexed.loadBlobFromUserPath(`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${e.message_id}.${e.content.file_ext}`,e.content.type,n=>{let a=URL.createObjectURL(n);this.global.modulate_thumbnail(e.content,a)}),delete this.temporary_open_thumbnail[e.message_id]}}}removeAttach(){delete this.userInput.file,this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder}pull_msg_history(e=!0){return(0,u.mG)(this,void 0,void 0,function*(){if(this.pullable)if(this.pullable=!1,e)try{yield this.nakama.servers[this.isOfficial][this.target].client.listChannelMessages(this.nakama.servers[this.isOfficial][this.target].session,this.info.id,15,!1,this.next_cursor).then(s=>{this.info.is_new=!1,s.messages.forEach(n=>{n=this.nakama.modulation_channel_message(n,this.isOfficial,this.target),this.nakama.check_sender_and_show_name(n,this.isOfficial,this.target),this.info.last_comment||(this.info.last_comment=(n.content.filename?`(${this.lang.text.ChatRoom.attachments}) `:"")+(n.content.msg||n.content.noti||"")),!this.foundLastRead&&this.info.last_read_id?this.info.last_read_id==n.message_id&&(n.isLastRead=!0,this.foundLastRead=!0,this.info.last_read_id=this.info.last_comment_id):this.foundLastRead=!0,this.nakama.translate_updates(n),n.content.filename&&this.ModulateFileEmbedMessage(n),this.nakama.ModulateTimeDate(n),this.nakama.content_to_hyperlink(n),this.messages.unshift(n),this.modulate_chatmsg(0,this.messages.length)}),this.next_cursor=s.next_cursor,this.prev_cursor=s.prev_cursor,this.pullable=!0,this.nakama.saveListedMessage(this.messages,this.info,this.isOfficial,this.target)})}catch(s){if(3==this.info.redirect.type&&this.nakama.groups[this.isOfficial][this.target]&&this.nakama.groups[this.isOfficial][this.target][this.info.group_id]&&!this.nakama.groups[this.isOfficial][this.target][this.info.group_id].open){let n=[{content:{msg:[{text:this.lang.text.ChatRoom.closed_group_must_online}]}},{content:{msg:[{text:this.lang.text.ChatRoom.closed_group_not_allow}]}}];return this.next_cursor=void 0,this.isHistoryLoaded=!0,void n.forEach(a=>this.messages.push(a))}this.LoadLocalChatHistory()}else console.log("\uc9c0\uae08 \ubcf4\uace0\uc788\ub294 \uae30\ub85d\ubcf4\ub2e4 \ucd5c\uadfc \uae30\ub85d \ubd88\ub7ec\uc624\uae30")})}LoadLocalChatHistory(){this.isHistoryLoaded?this.indexed.loadTextFromUserPath(this.LocalHistoryList.pop(),(e,s)=>{if(e&&s){let n=JSON.parse(s.trim());for(let a=n.length-1;a>=0;a--)this.ModulateFileEmbedMessage(n[a]),this.nakama.translate_updates(n[a]),n[a]=this.nakama.modulation_channel_message(n[a],this.isOfficial,this.target),this.nakama.ModulateTimeDate(n[a]),this.messages.unshift(n[a]),this.modulate_chatmsg(0,this.messages.length)}this.pullable=Boolean(this.LocalHistoryList.length)}):this.indexed.GetFileListFromDB(`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/chats/`,e=>{this.LocalHistoryList=e,this.isHistoryLoaded=!0,this.LocalHistoryList.length&&this.indexed.loadTextFromUserPath(this.LocalHistoryList.pop(),(s,n)=>{if(s&&n){let a=JSON.parse(n.trim());for(let l=a.length-1;l>=0;l--)this.ModulateFileEmbedMessage(a[l]),this.nakama.translate_updates(a[l]),a[l]=this.nakama.modulation_channel_message(a[l],this.isOfficial,this.target),this.nakama.ModulateTimeDate(a[l]),this.messages.unshift(a[l]),this.modulate_chatmsg(0,this.messages.length)}this.next_cursor=null,this.pullable=Boolean(this.LocalHistoryList.length)})})}open_ext_with_delay(){this.isHidden=!this.isHidden}make_ext_hidden(){"DesktopPWA"!=m.n$&&(this.isHidden=!0)}check_key(e){this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId)),"DesktopPWA"==m.n$?"Enter"!=e.key||e.shiftKey||"keydown"!=e.type?(this.userInputTextArea.style.height="36px",this.userInputTextArea.style.height=this.userInputTextArea.scrollHeight+"px"):this.send(!0):(this.userInputTextArea.style.height="36px",this.userInputTextArea.style.height=this.userInputTextArea.scrollHeight+"px")}send(e=!1){if(e&&("Android"==m.n$||"iOS"==m.n$))return;if(!this.userInput.text.trim()&&!this.userInput.file)return setTimeout(()=>{this.userInput.text=""},0),void(this.userInputTextArea.style.height="36px");this.userInputTextArea.style.height="36px";let s={};s.msg=this.userInput.text;let n=[];this.userInput.file&&(s.filename=this.userInput.file.filename,s.filesize=this.userInput.file.size,s.file_ext=this.userInput.file.file_ext,s.type=this.userInput.file.type,s.msg=s.msg,s.content_creator=this.userInput.file.content_creator,s.content_related_creator=this.userInput.file.content_related_creator,n=this.userInput.file.base64.match(/(.{1,220000})/g),s.partsize=n.length),s.local_comp=Math.random();let a={content:JSON.parse(JSON.stringify(s))};this.nakama.content_to_hyperlink(a),this.sending_msg.push(a);try{this.nakama.servers[this.isOfficial][this.target].socket.writeChatMessage(this.info.id,s).then(l=>{n.length&&this.indexed.saveFileToUserPath(this.userInput.file.base64,`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${l.message_id}.${this.userInput.file.file_ext}`,()=>{this.auto_open_thumbnail({content:s,message_id:l.message_id}),this.nakama.WriteStorage_From_channel(l,n,this.isOfficial,this.target)}),delete this.userInput.file,this.userInput.text="",this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder})}catch(l){setTimeout(()=>{this.userInput.text=""},0),this.userInputTextArea.style.height="36px",setTimeout(()=>{for(let c=this.sending_msg.length-1;c>=0;c--)this.sending_msg[c].content.local_comp==s.local_comp&&this.sending_msg.splice(c,1)},1500)}}message_detail(e){console.log("msg detail idle log")}file_detail(e){this.indexed.checkIfFileExist(`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${e.message_id}.${e.content.file_ext}`,s=>{if(s){if(this.nakama.channel_transfer[this.isOfficial][this.target]&&this.nakama.channel_transfer[this.isOfficial][this.target][e.channel_id]&&this.nakama.channel_transfer[this.isOfficial][this.target][e.channel_id][e.message_id]&&this.nakama.channel_transfer[this.isOfficial][this.target][e.channel_id][e.message_id].OnProgress)return void this.indexed.loadBlobFromUserPath(`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${e.message_id}.${e.content.file_ext}`,e.content.type,n=>(0,u.mG)(this,void 0,void 0,function*(){let l=(yield this.global.GetBase64ThroughFileReader(n)).match(/(.{1,220000})/g);this.nakama.WriteStorage_From_channel(e,l,this.isOfficial,this.target,this.nakama.channel_transfer[this.isOfficial][this.target][e.channel_id][e.message_id].progress[0]),delete this.nakama.channel_transfer[this.isOfficial][this.target][e.channel_id][e.message_id].OnProgress}));e.content.text||(e.content.text=[this.lang.text.ChatRoom.downloaded]),this.indexed.loadBlobFromUserPath(`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${e.message_id}.${e.content.file_ext}`,e.content.type,n=>{let a=URL.createObjectURL(n);this.global.modulate_thumbnail(e.content,a)}),this.open_viewer(e,`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${e.message_id}.${e.content.file_ext}`)}else try{if(this.nakama.channel_transfer[this.isOfficial][this.target]&&this.nakama.channel_transfer[this.isOfficial][this.target][e.channel_id]&&this.nakama.channel_transfer[this.isOfficial][this.target][e.channel_id][e.message_id]){if(this.nakama.channel_transfer[this.isOfficial][this.target][e.channel_id][e.message_id].OnProgress)throw delete this.nakama.channel_transfer[this.isOfficial][this.target][e.channel_id][e.message_id],"Need to download file again";return}throw"Need to download file"}catch(n){console.log(n),"DesktopPWA"==m.n$||"MobilePWA"==m.n$?this.isHistoryLoaded||this.nakama.ReadStorage_From_channel(e,this.isOfficial,this.target,a=>{let l=URL.createObjectURL(a);this.global.modulate_thumbnail(e.content,l)}):"disabled"==e.content.viewer?this.isHistoryLoaded||this.alertCtrl.create({header:this.lang.text.ChatRoom.cannot_open_from_mobile,message:this.lang.text.ChatRoom.cannot_open_with_viewer,buttons:[{text:this.lang.text.ChatRoom.download_anyway,handler:()=>{this.nakama.ReadStorage_From_channel(e,this.isOfficial,this.target,a=>{let l=URL.createObjectURL(a);this.global.modulate_thumbnail(e.content,l)})}}]}).then(a=>a.present()):this.isHistoryLoaded||this.nakama.ReadStorage_From_channel(e,this.isOfficial,this.target,a=>{let l=URL.createObjectURL(a);this.global.modulate_thumbnail(e.content,l)})}})}modulate_chatmsg(e,s){this.messages[e].showInfo||(this.messages[e].showInfo={}),this.messages[e].showInfo.date=Boolean(this.messages[e].msgDate),this.messages[e].showInfo.sender=!this.messages[e].content.noti&&this.messages[e].user_display_name,e-1>=0&&(this.messages[e].showInfo.date=Boolean(this.messages[e].msgDate)&&this.messages[e].msgDate!=this.messages[e-1].msgDate,this.messages[e].showInfo.sender=!this.messages[e].content.noti&&this.messages[e].user_display_name&&(this.messages[e-1].isLastRead||this.messages[e].sender_id!=this.messages[e-1].sender_id||this.messages[e-1].content.noti||this.messages[e].msgDate!=this.messages[e-1].msgDate)),e+1<s&&(this.messages[e+1].showInfo.date=Boolean(this.messages[e].msgDate)&&this.messages[e].msgDate!=this.messages[e+1].msgDate,this.messages[e+1].showInfo.sender=!this.messages[e+1].content.noti&&this.messages[e+1].user_display_name&&(this.messages[e].isLastRead||this.messages[e].sender_id!=this.messages[e+1].sender_id||this.messages[e].content.noti||this.messages[e].msgDate!=this.messages[e+1].msgDate))}ModulateFileEmbedMessage(e){this.global.set_viewer_category(e.content),this.indexed.checkIfFileExist(`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${e.message_id}.${e.content.file_ext}`,s=>{s&&(e.content.text=[this.lang.text.ChatRoom.downloaded],(e.content.filesize||0)<this.FILESIZE_LIMIT&&this.indexed.loadBlobFromUserPath(`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${e.message_id}.${e.content.file_ext}`,e.content.type,n=>{let a=URL.createObjectURL(n);this.global.modulate_thumbnail(e.content,a)}))})}open_viewer(e,s){switch(e.content.viewer){case"godot":this.open_godot_viewer(e,s);break;case"disabled":this.alert_download(e,s);break;default:this.open_ionic_viewer(e,s)}}open_ionic_viewer(e,s){this.lock_modal_open||(this.lock_modal_open=!0,this.modalCtrl.create({component:R.B,componentProps:{info:e.content,path:s}}).then(n=>{n.onDidDismiss().then(a=>{if(a.data){let l=[];if(e.content.content_related_creator&&l.push(...e.content.content_related_creator),e.content.content_creator){let c=!1;for(let h=0,p=l.length;h<p;h++)if(l[h].user_id==e.content.content_creator.user_id){c=!0;break}c||l.push(e.content.content_creator)}this.modalCtrl.create({component:y.$,componentProps:{path:s,width:a.data.width,height:a.data.height}}).then(c=>{c.onWillDismiss().then(h=>{h.data&&(this.userInput.file={},this.userInput.file.filename=h.data.name,this.userInput.file.file_ext="png",this.userInput.file.thumbnail=this.sanitizer.bypassSecurityTrustUrl(h.data.img),this.userInput.file.type="image/png",this.userInput.file.typeheader="image",h.data.is_modify?(this.userInput.file.content_related_creator=l,this.userInput.file.content_creator={user_id:this.nakama.servers[this.isOfficial][this.target].session.user_id,timestamp:(new Date).toLocaleString(),display_name:this.nakama.users.self.display_name}):(this.userInput.file.content_related_creator=[{user_id:this.nakama.servers[this.isOfficial][this.target].session.user_id,timestamp:(new Date).toLocaleString(),display_name:this.nakama.users.self.display_name}],this.userInput.file.content_creator={user_id:this.nakama.servers[this.isOfficial][this.target].session.user_id,timestamp:(new Date).toLocaleString(),display_name:this.nakama.users.self.display_name}),this.userInput.file.base64=h.data.img,this.inputPlaceholder=`(${this.lang.text.ChatRoom.attachments}: ${this.userInput.file.filename})`,h.data.loadingCtrl.dismiss())}),c.present()})}else this.noti.Current=this.info.cnoti_id,this.info.cnoti_id&&this.noti.ClearNoti(this.info.cnoti_id),this.noti.RemoveListener(`openchat${this.info.cnoti_id}`)}),this.noti.Current="IonicViewerPage",n.present(),this.lock_modal_open=!1}))}open_godot_viewer(e,s){this.lock_modal_open||(this.lock_modal_open=!0,this.modalCtrl.create({component:$.r,componentProps:{info:e.content,path:s}}).then(n=>{n.onDidDismiss().then(a=>{if(a.data){let l=[];if(e.content.content_related_creator&&l.push(...e.content.content_related_creator),e.content.content_creator){let c=!1;for(let h=0,p=l.length;h<p;h++)if(l[h].user_id==e.content.content_creator.user_id){c=!0;break}c||l.push(e.content.content_creator)}this.modalCtrl.create({component:y.$,componentProps:{path:a.data.path,width:a.data.width,height:a.data.height}}).then(c=>{c.onWillDismiss().then(h=>{h.data&&(this.userInput.file={},this.userInput.file.filename=h.data.name,this.userInput.file.file_ext="png",this.userInput.file.thumbnail=this.sanitizer.bypassSecurityTrustUrl(h.data.img),this.userInput.file.type="image/png",this.userInput.file.typeheader="image",h.data.is_modify?(this.userInput.file.content_related_creator=l,this.userInput.file.content_creator={user_id:this.nakama.servers[this.isOfficial][this.target].session.user_id,timestamp:(new Date).toLocaleString(),display_name:this.nakama.users.self.display_name}):(this.userInput.file.content_related_creator=[{user_id:this.nakama.servers[this.isOfficial][this.target].session.user_id,timestamp:(new Date).toLocaleString(),display_name:this.nakama.users.self.display_name}],this.userInput.file.content_creator={user_id:this.nakama.servers[this.isOfficial][this.target].session.user_id,timestamp:(new Date).toLocaleString(),display_name:this.nakama.users.self.display_name}),this.userInput.file.base64=h.data.img,this.inputPlaceholder=`(${this.lang.text.ChatRoom.attachments}: ${this.userInput.file.filename})`,h.data.loadingCtrl.dismiss())}),c.present()})}this.noti.Current=this.info.cnoti_id,this.info.cnoti_id&&this.noti.ClearNoti(this.info.cnoti_id),this.noti.RemoveListener(`openchat${this.info.cnoti_id}`)}),this.noti.Current="GodotViewerPage",n.present(),this.lock_modal_open=!1}))}alert_download(e,s){"DesktopPWA"==m.n$||"MobilePWA"==m.n$?this.alertCtrl.create({header:this.lang.text.ChatRoom.viewer_not_support,message:this.lang.text.ChatRoom.cannot_open_file,buttons:[{text:this.lang.text.ChatRoom.export_download,handler:()=>{this.indexed.DownloadFileFromUserPath(s,e.content.type,e.content.filename)}}]}).then(n=>n.present()):this.alertCtrl.create({header:this.lang.text.ContentViewer.Filename,inputs:[{name:"filename",placeholder:e.content.filename,type:"text"}],buttons:[{text:this.lang.text.ContentViewer.saveFile,handler:n=>(0,u.mG)(this,void 0,void 0,function*(){let a=yield this.loadingCtrl.create({message:this.lang.text.TodoDetail.WIP});a.present();let l=n.filename?`${n.filename.replace(/:|\?|\/|\\|<|>/g,"")}.${e.content.file_ext}`:e.content.filename,c=yield this.indexed.loadBlobFromUserPath(s,e.content.type);this.file.writeFile(this.file.externalDataDirectory,l,c).then(h=>{a.dismiss(),this.p5toast.show({text:this.lang.text.ContentViewer.fileSaved})}).catch(h=>{12===(a.dismiss(),h.code)?(this.p5toast.show({text:this.lang.text.ContentViewer.AlreadyExist}),this.alert_download(e,s)):console.log("\uc900\ube44\ub418\uc9c0 \uc54a\uc740 \uc624\ub958 \ubc18\ud658: ",h)})})}]}).then(n=>n.present())}user_detail(e){this.lock_modal_open||(this.lock_modal_open=!0,e.is_me?this.modalCtrl.create({component:P.G}).then(s=>{s.onDidDismiss().then(n=>{this.noti.Current=this.info.cnoti_id,this.info.cnoti_id&&this.noti.ClearNoti(this.info.cnoti_id),this.noti.RemoveListener(`openchat${this.info.cnoti_id}`)}),this.noti.Current="ProfilePage",s.present(),this.lock_modal_open=!1}):this.modalCtrl.create({component:w.r,componentProps:{info:{user:this.nakama.load_other_user(e.sender_id,this.isOfficial,this.target)},group:this.info,has_admin:!1}}).then(s=>{s.onDidDismiss().then(n=>{this.noti.Current=this.info.cnoti_id,this.info.cnoti_id&&this.noti.ClearNoti(this.info.cnoti_id),this.noti.RemoveListener(`openchat${this.info.cnoti_id}`)}),this.noti.Current="OthersProfilePage",s.present(),this.lock_modal_open=!1}))}ionViewWillLeave(){this.nakama.rearrange_channels(),this.nakama.channels_orig[this.isOfficial][this.target]&&this.nakama.channels_orig[this.isOfficial][this.target][this.info.id]&&delete this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].update,this.noti.Current=void 0}ngOnDestroy(){this.nakama.ChatroomLinkAct=void 0}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(_.IN),t.Y36(_.SH),t.Y36(v.gz),t.Y36(v.F0),t.Y36(A.a),t.Y36(U.J),t.Y36(J.F),t.Y36(F.g),t.Y36(M.H),t.Y36(_.Br),t.Y36(D.b),t.Y36(N.H7),t.Y36(H.A),t.Y36(_.HT),t.Y36(Y.V1),t.Y36(Q.$))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-chat-room"]],decls:38,vars:16,consts:[["slot","start"],["defaultHref","subscribes"],["id","main_table",2,"width","100%","height","100%","background-color","var(--chatroom-background)"],[2,"height","100%"],[2,"vertical-align","top"],["id","main_div",1,"main"],["button","",3,"disabled","click"],[3,"click",4,"ngFor","ngForOf"],["hidden","","button","",3,"disabled","click",4,"ngIf"],["id","content"],["id","send_thumbnail",3,"hidden"],[3,"click",4,"ngIf"],["id","input_table",2,"width","100%","background-color","var(--chatroom-input-background)"],["fill","clear",1,"ion-text-center",3,"disabled","click"],["slot","start","name","add",2,"margin","0"],[2,"width","100%","vertical-align","bottom"],[1,"TextAreaInput",3,"id","ngModel","placeholder","ngModelChange","keyup","keydown","click"],["fill","clear","expand","block",3,"disabled","click"],["slot","start","name","send",2,"margin","0"],["id","ext_menu",3,"hidden"],[1,"expanded"],["hidden","","type","file","accept","*",3,"id","change"],["class","ext_button",3,"hidden","style","click",4,"ngFor","ngForOf"],[3,"click"],["style","text-align: center; font-size: 16px; padding-top: 8px;",4,"ngIf"],["class","message_form",4,"ngIf"],["class","file_message_form",3,"click",4,"ngIf"],["class","notice_form",4,"ngIf"],["class","message_content_form",4,"ngIf"],["class","read_last_here",4,"ngIf"],[2,"text-align","center","font-size","16px","padding-top","8px"],["color","#888"],[1,"message_form"],[1,"message_span_form",3,"click"],[3,"color"],[1,"time_form"],[1,"file_message_form",3,"click"],["class","file_button",4,"ngIf"],["class","file_name_form",4,"ngIf"],["class","transfer_count",4,"ngIf"],[1,"file_button"],[1,"file_info"],["class","text_seperator",4,"ngIf"],["class","file_text_thumbnail",4,"ngFor","ngForOf"],[1,"text_seperator"],[1,"file_text_thumbnail"],[1,"file_name_form"],[1,"file_thumbnail",3,"src","alt"],[1,"transfer_count"],[1,"notice_form"],[1,"notice"],[1,"message_content_form"],[4,"ngFor","ngForOf"],[4,"ngIf"],["target","_system",3,"href",4,"ngIf"],["target","_system",3,"href"],[1,"read_last_here"],["class","comp_local_content",4,"ngIf"],["class","comp_local_content","target","_system",3,"href",4,"ngIf"],[1,"comp_local_content"],["target","_system",1,"comp_local_content",3,"href"],["hidden","","button","",3,"disabled","click"],[2,"height","24px","text-align","center"],["class","image_thumbnail",3,"src","alt",4,"ngIf"],["style","display: grid;",4,"ngIf"],[1,"image_thumbnail",3,"src","alt"],[2,"display","grid"],[1,"ext_button",3,"hidden","click"],["slot","icon-only","style","width: 36px; height: 36px;",3,"name",4,"ngIf"],["class","ext_icon_img",3,"src","alt",4,"ngIf"],["slot","icon-only",2,"width","36px","height","36px",3,"name"],[1,"ext_icon_img",3,"src","alt"]],template:function(e,s){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t._uU(3),t.qZA(),t.TgZ(4,"ion-buttons",0),t._UZ(5,"ion-back-button",1),t.qZA()()(),t.TgZ(6,"ion-content")(7,"table",2)(8,"tr",3)(9,"td",4)(10,"div",5)(11,"ion-item",6),t.NdJ("click",function(){return s.pull_msg_history()}),t.TgZ(12,"ion-label"),t._uU(13),t.qZA()(),t.YNc(14,nt,7,6,"div",7),t.YNc(15,ut,3,2,"div",7),t.YNc(16,gt,3,2,"ion-item",8),t._UZ(17,"div",9),t.qZA(),t.TgZ(18,"div",10),t.YNc(19,Ct,4,2,"div",11),t.qZA()()(),t.TgZ(20,"tr")(21,"td")(22,"div")(23,"table",12)(24,"tr")(25,"td")(26,"ion-button",13),t.NdJ("click",function(){return s.open_ext_with_delay()}),t._UZ(27,"ion-icon",14),t.qZA()(),t.TgZ(28,"td",15)(29,"textarea",16),t.NdJ("ngModelChange",function(a){return s.userInput.text=a})("keyup",function(a){return s.check_key(a)})("keydown",function(a){return s.check_key(a)})("click",function(){return s.make_ext_hidden()}),t.qZA()(),t.TgZ(30,"td")(31,"ion-button",17),t.NdJ("click",function(){return s.send(!1)}),t._UZ(32,"ion-icon",18),t.qZA()()()()()()(),t.TgZ(33,"tr",19)(34,"td")(35,"div",20)(36,"input",21),t.NdJ("change",function(a){return s.inputFileSelected(a)}),t.qZA(),t.YNc(37,kt,4,5,"div",22),t.qZA()()()()()),2&e&&(t.xp6(3),t.Oqu(s.info.title||s.lang.text.ChatRoom.noname_chatroom),t.xp6(8),t.Q6J("disabled",void 0===s.next_cursor||!s.pullable),t.xp6(2),t.Oqu(s.lang.text.ChatRoom.fetch_previous_chat),t.xp6(1),t.Q6J("ngForOf",s.messages),t.xp6(1),t.Q6J("ngForOf",s.sending_msg),t.xp6(1),t.Q6J("ngIf",s.prev_cursor),t.xp6(2),t.Q6J("hidden",!s.userInput.file),t.xp6(1),t.Q6J("ngIf",s.userInput.file),t.xp6(7),t.Q6J("disabled",!s.info.status||"offline"==s.info.status),t.xp6(3),t.Q6J("id",s.ChannelUserInputId)("ngModel",s.userInput.text)("placeholder",s.inputPlaceholder),t.xp6(2),t.Q6J("disabled",!s.info.status||"missing"==s.info.status||"offline"==s.info.status),t.xp6(2),t.Q6J("hidden",s.isHidden),t.xp6(3),t.Q6J("id",s.file_sel_id),t.xp6(1),t.Q6J("ngForOf",s.extended_buttons))},directives:[_.Gu,_.sr,_.wd,_.Sm,_.oU,_.cs,_.W2,_.Ie,_.Q$,C.sg,C.O5,_.YG,_.gu,x.Fj,x.JJ,x.On],styles:[".main[_ngcontent-%COMP%]{width:100%;height:100%;padding:8px;overflow-x:hidden;overflow-y:auto;scroll-behavior:smooth}.message_form[_ngcontent-%COMP%]{margin:8px 0 0}.message_span_form[_ngcontent-%COMP%]{margin-right:8px}.time_form[_ngcontent-%COMP%]{font-size:12px;color:#888}.file_message_form[_ngcontent-%COMP%]{display:flex}.file_name_form[_ngcontent-%COMP%]{margin-top:4px;max-width:192px;max-height:192px}.file_thumbnail[_ngcontent-%COMP%]{max-width:192px;max-height:192px;width:auto;height:auto}.file_info[_ngcontent-%COMP%]{margin:0}.file_text_thumbnail[_ngcontent-%COMP%]{margin-top:2px;display:grid}.message_content_form[_ngcontent-%COMP%]{margin:4px 0 0}.comp_local_content[_ngcontent-%COMP%]{color:#888}.text_seperator[_ngcontent-%COMP%]{background-color:#fff;margin-top:2px;position:relative;width:100%;height:2px}.expanded[_ngcontent-%COMP%]{height:240px;overflow-x:hidden;overflow-y:auto;scroll-behavior:smooth;text-align:center;background-color:var(--chatroom-input-background)}.ext_button[_ngcontent-%COMP%]{display:inline-block;width:64px;height:48px;margin:16px 8px 0;text-align:center}.ext_button_icon[_ngcontent-%COMP%]{width:72px;height:72px}.file_button[_ngcontent-%COMP%]{width:160px;height:112px;overflow:hidden;background-color:gray;margin-top:4px}#send_thumbnail[_ngcontent-%COMP%]{width:100%;max-width:100vw;height:-moz-fit-content;height:fit-content;max-height:160px;transform:translateY(-100%);position:relative;background:#bbbb;padding:8px;overflow:hidden}.image_thumbnail[_ngcontent-%COMP%]{width:auto;max-height:96px;height:auto;object-fit:contain;display:block;margin:auto}.transfer_count[_ngcontent-%COMP%]{align-self:flex-end;margin-left:4px}.notice_form[_ngcontent-%COMP%]{text-align:center;margin:12px}.notice[_ngcontent-%COMP%]{font-size:12px;display:inline;background:#444;border-radius:8px;padding:4px 8px;color:#fff}.read_last_here[_ngcontent-%COMP%]{text-align:center;font-size:12px;display:inherit;background:var(--chatroom-you-read-here-backgruond);margin:4px 0;color:var(--chatroom-you-read-here-text)}.ext_icon_img[_ngcontent-%COMP%]{max-width:36px;max-height:36px}.TextAreaInput[_ngcontent-%COMP%]{width:100%;height:36px;max-height:156px;resize:none;padding:6px;margin-top:5px;border:0;overflow:hidden;background-color:var(--chatroom-input-background)}"]}),i})()},{path:"ionic-viewer",loadChildren:()=>r.e(132).then(r.bind(r,132)).then(i=>i.IonicViewerPageModule)},{path:"godot-viewer",loadChildren:()=>r.e(9788).then(r.bind(r,9788)).then(i=>i.GodotViewerPageModule)},{path:"void-draw",loadChildren:()=>r.e(4695).then(r.bind(r,4695)).then(i=>i.VoidDrawPageModule)}];let Pt=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[v.Bz.forChild(Ot)],v.Bz]}),i})(),wt=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[C.ez,x.u5,_.Pc,Pt]]}),i})()}}]);