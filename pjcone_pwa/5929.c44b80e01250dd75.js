"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5929],{9373:(Z,B,_)=>{_.d(B,{I:()=>n});const n=(0,_(6400).C_)("SpeechRecognition",{web:()=>_.e(7384).then(_.bind(_,7384)).then(G=>new G.SpeechRecognitionWeb)})},8828:(Z,B,_)=>{_.d(B,{_8:()=>V,on:()=>G,wd:()=>n});var V=function($){return $.Prompt="PROMPT",$.Camera="CAMERA",$.Photos="PHOTOS",$}(V||{}),n=function($){return $.Rear="REAR",$.Front="FRONT",$}(n||{}),G=function($){return $.Uri="uri",$.Base64="base64",$.DataUrl="dataUrl",$}(G||{})},4120:(Z,B,_)=>{_.d(B,{Ut:()=>G,_8:()=>n._8,on:()=>n.on});var V=_(6400),n=_(8828);const G=(0,V.C_)("Camera",{web:()=>_.e(9028).then(_.bind(_,9028)).then($=>new $.CameraWeb)})},4580:(Z,B,_)=>{_.d(B,{m:()=>ie});var V=_(5193),n=_(4496),G=_(4500),$=_(5020),m=_(7136),L=_(5624),W=_(9240),ee=_(4668),A=_(1368);function J(P,U){if(1&P&&(n.I0R(0,"ion-select-option",7),n.OEk(1),n.C$Y()),2&P){const E=U.$implicit;n.E7m("value",E),n.yG2(),n.oRS("",E.name," ")}}function z(P,U){if(1&P&&(n.I0R(0,"ion-select-option",7),n.OEk(1),n.C$Y()),2&P){const E=U.$implicit;n.E7m("value",E),n.yG2(),n.cNF(E.name+" ("+E.server.name+")")}}function X(P,U){if(1&P&&(n.I0R(0,"ion-select-option",7),n.OEk(1),n.C$Y()),2&P){const E=U.$implicit;n.E7m("value",E),n.yG2(),n.oRS(" ",E.urls[0],"")}}function te(P,U){if(1&P){const E=n.KQA();n.I0R(0,"ion-item",8),n.qCj("click",function(){n.usT(E);const y=n.GaO();return n.CGJ(y.scanQRCode())}),n.I0R(1,"ion-label",9),n.OEk(2),n.C$Y()()}if(2&P){const E=n.GaO();n.E7m("disabled",!E.ActKeyLength),n.yG2(2),n.cNF(E.lang.text.QuickQRShare.SendData)}}function N(P,U){if(1&P&&n.wR5(0,"img",10),2&P){const E=n.GaO();n.E7m("src",E.QRCodeSRC,n.K6U)}}let ie=(()=>{var P;class U{constructor(I,y,O,D,t,q){this.lang=I,this.global=y,this.nakama=O,this.modalCtrl=D,this.navParams=t,this.indexed=q,this.ActKeyLength=!1,this.userInput={servers:[],groups:[],rtcserver:[]},this.servers=[],this.groups=[],this.rtcServer=[],this.NoReturn=!1}ngOnInit(){this.NoReturn=this.navParams.get("NoReturn"),this.servers=this.nakama.get_all_server_info(),this.groups=this.nakama.rearrange_group_list(),this.indexed.loadTextFromUserPath("servers/webrtc_server.json",(I,y)=>{I&&y&&(this.rtcServer=JSON.parse(y))});for(let I=this.groups.length-1;I>=0;I--)"missing"==this.groups[I].status&&this.groups.splice(I,1)}SelectGroupServer(I){this.userInput.servers=I.detail.value||[],this.information_changed()}SelectGroupChannel(I){this.userInput.groups=I.detail.value||[],this.information_changed()}SelectRTCServer(I){this.userInput.rtcserver=I.detail.value||[],this.information_changed()}information_changed(){this.result_address=`${V.uM}pjcone_pwa/`;let I="",y=0;for(let O=0,D=this.userInput.servers.length;O<D;O++)I+=y?"&":"?",I+="server=",I+=`${this.userInput.servers[O].name||""},${this.userInput.servers[O].address||""},${this.userInput.servers[O].useSSL||""},${this.userInput.servers[O].port||7350},${this.userInput.servers[O].key||""}`,y++;for(let O=0,D=this.userInput.groups.length;O<D;O++)I+=y?"&":"?",I+="group=",I+=`${this.userInput.groups[O].name},${this.userInput.groups[O].id}`,y++;if(this.userInput.rtcserver.length)for(let O=0,D=this.userInput.rtcserver.length;O<D;O++)I+=y?"&":"?",I+="rtcserver=",I+=`[${this.userInput.rtcserver[O].urls}],${this.userInput.rtcserver[O].username},${this.userInput.rtcserver[O].credential}`,y++;I?(this.result_address+=I,this.QRCodeSRC=this.global.readasQRCodeFromString(this.result_address),this.ActKeyLength=!0):(this.QRCodeSRC="",this.ActKeyLength=!1)}scanQRCode(){this.modalCtrl.dismiss(this.result_address)}}return(P=U).\u0275fac=function(I){return new(I||P)(n.GI1(G.o),n.GI1($.A1),n.GI1(m.h),n.GI1(L.qS),n.GI1(W.a6),n.GI1(ee.k))},P.\u0275cmp=n.In1({type:P,selectors:[["app-qr-share"]],decls:24,vars:14,consts:[[1,"ion-no-border"],["slot","start",3,"click"],["defaultHref",""],["multiple","true",3,"label","placeholder","ionChange"],[3,"value",4,"ngFor","ngForOf"],["button","",3,"disabled","click",4,"ngIf"],["style","width: 100%; height: auto;","alt","QRCodeSRC",3,"src",4,"ngIf"],[3,"value"],["button","",3,"disabled","click"],[1,"ion-text-center"],["alt","QRCodeSRC",2,"width","100%","height","auto",3,"src"]],template:function(I,y){1&I&&(n.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),n.OEk(3),n.C$Y(),n.I0R(4,"ion-buttons",1),n.qCj("click",function(){return y.modalCtrl.dismiss()}),n.wR5(5,"ion-back-button",2),n.C$Y()()(),n.I0R(6,"ion-content")(7,"ion-item-divider")(8,"ion-label"),n.OEk(9),n.C$Y()(),n.I0R(10,"ion-item")(11,"ion-select",3),n.qCj("ionChange",function(D){return y.SelectGroupServer(D)}),n.yuY(12,J,2,2,"ion-select-option",4),n.C$Y()(),n.I0R(13,"ion-item")(14,"ion-select",3),n.qCj("ionChange",function(D){return y.SelectGroupChannel(D)}),n.yuY(15,z,2,2,"ion-select-option",4),n.C$Y()(),n.I0R(16,"ion-item")(17,"ion-select",3),n.qCj("ionChange",function(D){return y.SelectRTCServer(D)}),n.yuY(18,X,2,2,"ion-select-option",4),n.C$Y()(),n.yuY(19,te,3,2,"ion-item",5),n.I0R(20,"ion-item-divider")(21,"ion-label"),n.OEk(22),n.C$Y()(),n.yuY(23,N,1,1,"img",6),n.C$Y()),2&I&&(n.yG2(3),n.cNF(y.lang.text.Settings.quickQRshare),n.yG2(6),n.cNF(y.lang.text.QuickQRShare.SelectData),n.yG2(2),n.E7m("label",y.lang.text.QuickQRShare.GroupServer)("placeholder",y.lang.text.QuickQRShare.EmptyData),n.yG2(),n.E7m("ngForOf",y.servers),n.yG2(2),n.E7m("label",y.lang.text.QuickQRShare.Group)("placeholder",y.lang.text.QuickQRShare.EmptyData),n.yG2(),n.E7m("ngForOf",y.groups),n.yG2(2),n.E7m("label",y.lang.text.WebRTCDevManager.Title)("placeholder",y.lang.text.QuickQRShare.EmptyData),n.yG2(),n.E7m("ngForOf",y.rtcServer),n.yG2(),n.E7m("ngIf",!y.NoReturn),n.yG2(3),n.cNF(y.lang.text.QuickQRShare.ReceiveData),n.yG2(),n.E7m("ngIf",y.QRCodeSRC))},dependencies:[A.ay,A.u_,L.GS,L._i,L.wB,L.Yb,L.S8,L.QR,L.Cy,L.gd,L.tM,L.Md,L.IT,L.Im]}),U})()},5929:(Z,B,_)=>{_.r(B),_.d(B,{ChatRoomPageModule:()=>ot});var V=_(1368),n=_(4716),G=_(5624),$=_(3332),m=_(1528),L=_(4708),W=_(9352),ee=_(4428),A=_(5193),J=_(8744),z=_(1052),X=_(5020),te=_(6756),N=_(4120),ie=_(340),P=_(4580),U=_(192),E=_(2272);const y=(0,_(6400).C_)("TextToSpeech",{web:()=>_.e(2728).then(_.bind(_,2728)).then(o=>new o.TextToSpeechWeb)});"speechSynthesis"in window&&window;var O=_(9373),D=_(7048),t=_(4496),q=_(9240),C=_(7136),S=_(6819),p=_(4180),x=_(4668),f=_(4500),R=_(4476),T=_(8696),H=_(3824),ne=_(7756);function oe(o,u){if(1&o){const s=t.KQA();t.I0R(0,"ion-icon",28),t.qCj("click",function(){t.usT(s);const i=t.GaO();return t.CGJ(i.toggle_thumbnail())}),t.C$Y()}}function le(o,u){if(1&o){const s=t.KQA();t.I0R(0,"ion-icon",29),t.qCj("click",function(){t.usT(s);const i=t.GaO();return t.CGJ(i.toggle_thumbnail())}),t.C$Y()}}function re(o,u){if(1&o&&(t.I0R(0,"div",41)(1,"font",42),t.OEk(2),t.C$Y()()),2&o){const s=t.GaO().$implicit;t.yG2(2),t.oRS(" ",s.msgDate," ")}}function ce(o,u){if(1&o){const s=t.KQA();t.I0R(0,"div",43)(1,"span",44),t.qCj("click",function(){t.usT(s);const i=t.GaO().$implicit,a=t.GaO(2);return t.CGJ(a.user_detail(i))}),t.I0R(2,"b")(3,"font",45),t.OEk(4),t.C$Y()()(),t.I0R(5,"span",46),t.OEk(6),t.C$Y()()}if(2&o){const s=t.GaO().$implicit,e=t.GaO(2);t.yG2(3),t.CI5("color","#",s.is_me&&e.nakama.users.self.online||!s.is_me&&e.nakama.users[e.isOfficial][e.target][s.sender_id].online?s.color:"888",""),t.yG2(),t.oRS(" ",s.user_display_name||e.lang.text.Profile.noname_user,""),t.yG2(2),t.cNF(s.msgTime)}}function _e(o,u){if(1&o){const s=t.KQA();t.I0R(0,"div",47),t.qCj("click",function(){t.usT(s);const i=t.GaO().$implicit,a=t.GaO(2);return t.CGJ(a.quickShare_act(i))}),t.OEk(1),t.C$Y()}if(2&o){const s=t.GaO(3);t.yG2(),t.oRS(" ",s.lang.text.ChatRoom.QuickShare," ")}}function de(o,u){if(1&o){const s=t.KQA();t.I0R(0,"div",47),t.qCj("click",function(){t.usT(s);const i=t.GaO().$implicit,a=t.GaO(2);return t.CGJ(a.JoinWebRTCMatch(i))}),t.OEk(1),t.C$Y()}if(2&o){const s=t.GaO(3);t.yG2(),t.oRS(" ",s.lang.text.ChatRoom.JoinWebRTCMatch," ")}}function he(o,u){1&o&&t.wR5(0,"div",56)}function ue(o,u){if(1&o&&(t.I0R(0,"span",57),t.OEk(1),t.C$Y()),2&o){const s=u.$implicit;t.yG2(),t.oRS(" ",s," ")}}function me(o,u){if(1&o){const s=t.KQA();t.I0R(0,"div",52),t.qCj("click",function(){t.usT(s);const i=t.GaO(2).$implicit,a=t.GaO(2);return t.CGJ(a.file_detail(i))}),t.I0R(1,"p",53),t.OEk(2),t.C$Y(),t.yuY(3,he,1,0,"div",54)(4,ue,2,1,"span",55),t.C$Y()}if(2&o){const s=t.GaO(2).$implicit,e=t.GaO(2);t.m_g(e.info.HideAutoThumbnail?"filter: blur(6px);":""),t.yG2(2),t.oRS(" ",s.content.filename," "),t.yG2(),t.E7m("ngIf",s.content.text),t.yG2(),t.E7m("ngForOf",s.content.text)}}function ge(o,u){if(1&o){const s=t.KQA();t.I0R(0,"div",58),t.qCj("click",function(){t.usT(s);const i=t.GaO(2).$implicit,a=t.GaO(2);return t.CGJ(a.file_detail(i))}),t.wR5(1,"img",59),t.C$Y()}if(2&o){const s=t.GaO(2).$implicit,e=t.GaO(2);t.yG2(),t.m_g(e.info.HideAutoThumbnail?"filter: blur(6px);":""),t.E7m("src",s.content.thumbnail,t.K6U)("alt",s.content.filename)}}function fe(o,u){if(1&o&&(t.I0R(0,"div",60),t.OEk(1),t.C$Y()),2&o){const s=t.GaO(2).$implicit;t.yG2(),t.oRS(" ",s.content.transfer_index.index,"")}}function pe(o,u){if(1&o&&(t.I0R(0,"div",48),t.yuY(1,me,5,5,"div",49)(2,ge,2,4,"div",50)(3,fe,2,1,"div",51),t.C$Y()),2&o){const s=t.GaO().$implicit;t.yG2(),t.E7m("ngIf",!s.content.thumbnail),t.yG2(),t.E7m("ngIf",s.content.thumbnail),t.yG2(),t.E7m("ngIf",s.content.transfer_index)}}function ve(o,u){if(1&o&&(t.I0R(0,"div",61)(1,"div",62),t.OEk(2),t.C$Y()()),2&o){const s=t.GaO().$implicit;t.yG2(2),t.oRS(" ",s.content.noti," ")}}function xe(o,u){if(1&o){const s=t.KQA();t.I0R(0,"span",33),t.qCj("click",function(){t.usT(s);const i=t.GaO(6);return t.CGJ(i.SetOtherAct())}),t.OEk(1),t.C$Y()}if(2&o){const s=t.GaO().$implicit;t.m_g("font-size: "+(s.size||16)+"px"),t.yG2(),t.oRS(" ",s.text," ")}}function Ce(o,u){if(1&o){const s=t.KQA();t.I0R(0,"a",67),t.qCj("click",function(){t.usT(s);const i=t.GaO(6);return t.CGJ(i.SetOtherAct())}),t.OEk(1),t.C$Y()}if(2&o){const s=t.GaO().$implicit;t.E7m("href",s.text,t.K6U),t.yG2(),t.cNF(s.text)}}function ye(o,u){if(1&o&&(t.I0R(0,"span"),t.yuY(1,xe,2,3,"span",65)(2,Ce,2,2,"a",66),t.C$Y()),2&o){const s=u.$implicit;t.yG2(),t.E7m("ngIf",!s.href),t.yG2(),t.E7m("ngIf",s.href)}}function be(o,u){if(1&o&&(t.I0R(0,"span",68),t.OEk(1),t.C$Y()),2&o){const s=t.GaO(5);t.yG2(),t.cNF("("+s.lang.text.ChatRoom.MsgEdited+")")}}function Ie(o,u){if(1&o&&(t.I0R(0,"div")(1,"span"),t.yuY(2,ye,3,2,"span",32),t.C$Y(),t.yuY(3,be,2,1,"span",64),t.C$Y()),2&o){const s=u.$implicit,e=u.index,i=t.GaO(2).$implicit;t.yG2(2),t.E7m("ngForOf",s),t.yG2(),t.E7m("ngIf",i.content.edited&&e==i.content.msg.length-1)}}function Re(o,u){if(1&o&&(t.I0R(0,"div",63),t.yuY(1,Ie,4,2,"div",32),t.C$Y()),2&o){const s=t.GaO().$implicit;t.yG2(),t.E7m("ngForOf",s.content.msg)}}function ke(o,u){if(1&o&&(t.I0R(0,"div",69),t.OEk(1),t.C$Y()),2&o){const s=t.GaO(3);t.yG2(),t.oRS(" ",s.lang.text.ChatRoom.YouReadHereLast,"")}}function we(o,u){if(1&o){const s=t.KQA();t.I0R(0,"div",33),t.qCj("click",function(){const i=t.usT(s),a=i.$implicit,l=i.index,c=t.GaO(2);return t.CGJ(c.message_detail(a,l))}),t.yuY(1,re,3,1,"div",34)(2,ce,7,3,"div",35)(3,_e,2,1,"div",36)(4,de,2,1,"div",36)(5,pe,4,3,"div",37)(6,ve,3,1,"div",38)(7,Re,2,1,"div",39)(8,ke,2,1,"div",40),t.C$Y()}if(2&o){const s=u.$implicit;t.yG2(),t.E7m("ngIf",s.showInfo&&s.showInfo.date),t.yG2(),t.E7m("ngIf",s.showInfo&&s.showInfo.sender),t.yG2(),t.E7m("ngIf",s.content.quickShare),t.yG2(),t.E7m("ngIf",s.content.match),t.yG2(),t.E7m("ngIf",s.content.filename),t.yG2(),t.E7m("ngIf",s.content.noti),t.yG2(),t.E7m("ngIf",s.content.msg),t.yG2(),t.E7m("ngIf",s.isLastRead)}}function Oe(o,u){if(1&o){const s=t.KQA();t.I0R(0,"div",47),t.qCj("click",function(){t.usT(s);const i=t.GaO().$implicit,a=t.GaO(2);return t.CGJ(a.quickShare_act(i))}),t.OEk(1),t.C$Y()}if(2&o){const s=t.GaO(3);t.yG2(),t.oRS(" ",s.lang.text.ChatRoom.QuickShare," ")}}function Te(o,u){1&o&&t.wR5(0,"div",56)}function Me(o,u){if(1&o&&(t.I0R(0,"span",57),t.OEk(1),t.C$Y()),2&o){const s=u.$implicit;t.yG2(),t.oRS(" ",s," ")}}function Ge(o,u){if(1&o&&(t.I0R(0,"div",72)(1,"p",53),t.OEk(2),t.C$Y(),t.yuY(3,Te,1,0,"div",54)(4,Me,2,1,"span",55),t.C$Y()),2&o){const s=t.GaO(2).$implicit,e=t.GaO(2);t.m_g(e.info.HideAutoThumbnail?"filter: blur(6px);":""),t.yG2(2),t.oRS(" ",s.content.filename," "),t.yG2(),t.E7m("ngIf",s.content.text),t.yG2(),t.E7m("ngForOf",s.content.text)}}function $e(o,u){if(1&o&&(t.I0R(0,"div",73),t.wR5(1,"img",59),t.C$Y()),2&o){const s=t.GaO(2).$implicit,e=t.GaO(2);t.yG2(),t.m_g(e.info.HideAutoThumbnail?"filter: blur(6px);":""),t.E7m("src",s.content.thumbnail,t.K6U)("alt",s.content.filename)}}function Pe(o,u){if(1&o&&(t.I0R(0,"div",48),t.yuY(1,Ge,5,5,"div",70)(2,$e,2,4,"div",71),t.C$Y()),2&o){const s=t.GaO().$implicit;t.yG2(),t.E7m("ngIf",!s.content.thumbnail),t.yG2(),t.E7m("ngIf",s.content.thumbnail)}}function Se(o,u){if(1&o){const s=t.KQA();t.I0R(0,"span",76),t.qCj("click",function(){t.usT(s);const i=t.GaO(6);return t.CGJ(i.SetOtherAct())}),t.OEk(1),t.C$Y()}if(2&o){const s=t.GaO().$implicit;t.yG2(),t.oRS(" ",s.text," ")}}function Ee(o,u){if(1&o){const s=t.KQA();t.I0R(0,"a",77),t.qCj("click",function(){t.usT(s);const i=t.GaO(6);return t.CGJ(i.SetOtherAct())}),t.OEk(1),t.C$Y()}if(2&o){const s=t.GaO().$implicit;t.E7m("href",s.text,t.K6U),t.yG2(),t.cNF(s.text)}}function Le(o,u){if(1&o&&(t.I0R(0,"span"),t.yuY(1,Se,2,1,"span",74)(2,Ee,2,2,"a",75),t.C$Y()),2&o){const s=u.$implicit;t.yG2(),t.E7m("ngIf",!s.href),t.yG2(),t.E7m("ngIf",s.href)}}function De(o,u){if(1&o&&(t.I0R(0,"div"),t.yuY(1,Le,3,2,"span",32),t.C$Y()),2&o){const s=u.$implicit;t.yG2(),t.E7m("ngForOf",s)}}function Fe(o,u){if(1&o&&(t.I0R(0,"div",63),t.yuY(1,De,2,1,"div",32),t.C$Y()),2&o){const s=t.GaO().$implicit;t.yG2(),t.E7m("ngForOf",s.content.msg)}}function Ve(o,u){if(1&o&&(t.I0R(0,"div"),t.yuY(1,Oe,2,1,"div",36)(2,Pe,3,2,"div",37)(3,Fe,2,1,"div",39),t.C$Y()),2&o){const s=u.$implicit;t.yG2(),t.E7m("ngIf",s.content.quickShare),t.yG2(),t.E7m("ngIf",s.content.filename),t.yG2(),t.E7m("ngIf",s.content.msg)}}function Ae(o,u){if(1&o){const s=t.KQA();t.I0R(0,"div")(1,"ion-item",30),t.qCj("click",function(){t.usT(s);const i=t.GaO();return t.CGJ(i.pull_msg_history())}),t.I0R(2,"ion-label"),t.OEk(3),t.C$Y()(),t.yuY(4,we,9,8,"div",31)(5,Ve,4,3,"div",32),t.C$Y()}if(2&o){const s=t.GaO();t.yG2(),t.E7m("disabled",void 0===s.next_cursor&&!s.ViewMsgIndex||!s.pullable),t.yG2(2),t.cNF(s.lang.text.ChatRoom.fetch_previous_chat),t.yG2(),t.E7m("ngForOf",s.ViewableMessage),t.yG2(),t.E7m("ngForOf",s.sending_msg)}}function Ue(o,u){if(1&o&&(t.I0R(0,"div",10)(1,"div",78),t.wR5(2,"ion-icon",79),t.I0R(3,"div")(4,"ion-label",80),t.OEk(5),t.C$Y()()()()),2&o){const s=t.GaO();t.yG2(5),t.cNF(s.lang.text.ChatRoom.CannotOpenClosedGroup)}}function Ye(o,u){if(1&o){const s=t.KQA();t.I0R(0,"tr",81),t.qCj("click",function(){t.usT(s);const i=t.GaO();return t.CGJ(i.cancel_qrshare())}),t.I0R(1,"td",82)(2,"span"),t.OEk(3),t.C$Y()()()}if(2&o){const s=t.GaO();t.yG2(3),t.cNF(s.lang.text.Settings.quickQRshare)}}function Qe(o,u){if(1&o&&t.wR5(0,"img",88),2&o){const s=t.GaO(4);t.E7m("src",s.userInput.file.thumbnail,t.K6U)("alt",s.userInput.file.name)}}function Be(o,u){if(1&o&&(t.I0R(0,"div"),t.yuY(1,Qe,1,2,"img",87),t.C$Y()),2&o){const s=t.GaO(3);t.yG2(),t.E7m("ngIf","image"==s.userInput.file.typeheader)}}function He(o,u){if(1&o&&(t.I0R(0,"span"),t.OEk(1),t.C$Y()),2&o){const s=u.$implicit;t.yG2(),t.oRS(" ",s," ")}}function je(o,u){if(1&o&&(t.I0R(0,"div",89),t.yuY(1,He,2,1,"span",32),t.C$Y()),2&o){const s=t.GaO(3);t.yG2(),t.E7m("ngForOf",s.userInput.file.thumbnail)}}function Ke(o,u){if(1&o){const s=t.KQA();t.I0R(0,"div",33),t.qCj("click",function(){t.usT(s);const i=t.GaO(2);return t.CGJ(i.removeAttach())}),t.I0R(1,"div",85),t.OEk(2),t.C$Y(),t.yuY(3,Be,2,1,"div",11)(4,je,2,1,"div",86),t.C$Y()}if(2&o){const s=t.GaO(2);t.yG2(2),t.oRS(" ",s.userInput.file.filename," "),t.yG2(),t.E7m("ngIf",s.userInput.file.thumbnail),t.yG2(),t.E7m("ngIf","text"==s.userInput.file.typeheader)}}function Ne(o,u){if(1&o&&(t.I0R(0,"tr",83)(1,"td"),t.yuY(2,Ke,5,3,"div",84),t.C$Y()()),2&o){const s=t.GaO();t.yG2(2),t.E7m("ngIf",s.userInput.file)}}function We(o,u){if(1&o){const s=t.KQA();t.I0R(0,"tr",81),t.qCj("click",function(){t.usT(s);const i=t.GaO();return t.CGJ(i.init_chatroom())}),t.I0R(1,"td",90),t.OEk(2),t.C$Y()()}if(2&o){const s=t.GaO();t.yG2(2),t.cNF(s.lang.text.ChatRoom.GoToRecent)}}function Je(o,u){if(1&o){const s=t.KQA();t.I0R(0,"span",33),t.qCj("click",function(){t.usT(s);const i=t.GaO(4);return t.CGJ(i.SetOtherAct())}),t.OEk(1),t.C$Y()}if(2&o){const s=t.GaO().$implicit;t.yG2(),t.oRS(" ",s.text," ")}}function ze(o,u){if(1&o){const s=t.KQA();t.I0R(0,"a",67),t.qCj("click",function(){t.usT(s);const i=t.GaO(4);return t.CGJ(i.SetOtherAct())}),t.OEk(1),t.C$Y()}if(2&o){const s=t.GaO().$implicit;t.E7m("href",s.text,t.K6U),t.yG2(),t.cNF(s.text)}}function Xe(o,u){if(1&o&&(t.I0R(0,"span"),t.yuY(1,Je,2,1,"span",84)(2,ze,2,2,"a",66),t.C$Y()),2&o){const s=u.$implicit;t.yG2(),t.E7m("ngIf",!s.href),t.yG2(),t.E7m("ngIf",s.href)}}function qe(o,u){if(1&o&&(t.I0R(0,"span"),t.yuY(1,Xe,3,2,"span",32),t.C$Y()),2&o){const s=u.$implicit;t.yG2(),t.E7m("ngForOf",s)}}function Ze(o,u){if(1&o){const s=t.KQA();t.I0R(0,"tr",81),t.qCj("click",function(){t.usT(s);const i=t.GaO();return t.CGJ(i.init_chatroom())}),t.I0R(1,"td",91)(2,"span")(3,"b"),t.OEk(4),t.C$Y()(),t.yuY(5,qe,2,1,"span",32),t.C$Y()()}if(2&o){const s=t.GaO();t.yG2(2),t.m_g("margin-right: 8px; color: #"+s.last_message_viewer.color),t.yG2(2),t.cNF((s.last_message_viewer.is_me?s.nakama.users.self.display_name:s.nakama.users[s.isOfficial][s.target][s.last_message_viewer.user_id].display_name)||s.lang.text.Profile.noname_user),t.yG2(),t.E7m("ngForOf",s.last_message_viewer.message)}}function et(o,u){if(1&o){const s=t.KQA();t.I0R(0,"td")(1,"ion-button",92),t.qCj("click",function(){t.usT(s);const i=t.GaO();return t.CGJ(i.GetSpeechToText())}),t.wR5(2,"ion-icon",93),t.C$Y()()}}function tt(o,u){if(1&o&&t.wR5(0,"ion-icon",98),2&o){const s=t.GaO().$implicit;t.E7m("name",s.icon||"close-circle")}}function it(o,u){if(1&o&&t.wR5(0,"img",99),2&o){const s=t.GaO().$implicit;t.E7m("src","assets/icon/"+s.icon_img,t.K6U)("alt",s.title)}}function nt(o,u){if(1&o){const s=t.KQA();t.I0R(0,"div",94)(1,"div",95),t.qCj("click",function(){const a=t.usT(s).$implicit;return t.CGJ(a.act())}),t.yuY(2,tt,1,1,"ion-icon",96)(3,it,1,2,"img",97),t.C$Y()()}if(2&o){const s=u.$implicit;t.yG2(),t.m_g("cursor: "+(s.cursor||"pointer")+";"),t.E7m("hidden",s.isHide),t.yG2(),t.E7m("ngIf",s.icon),t.yG2(),t.E7m("ngIf",s.icon_img)}}const at=[{path:"",component:(()=>{var o;class u{constructor(e,i,a,l,c,h,d,v,g,k,w,j,Y,se,lt,rt,ct){var M,r=this;this.modalCtrl=e,this.navCtrl=i,this.route=a,this.router=l,this.nakama=c,this.noti=h,this.statusBar=d,this.indexed=v,this.lang=g,this.sanitizer=k,this.global=w,this.loadingCtrl=j,this.webrtc=Y,this.p5toast=se,this.mClipboard=lt,this.alertCtrl=rt,this.platform=ct,this.info={},this.foundLastRead=!1,this.messages=[],this.sending_msg=[],this.temporary_open_thumbnail={},this.extended_buttons=[{icon:"settings-outline",act:()=>{3!=this.info.redirect.type?this.extended_buttons[0].isHide=!0:this.lock_modal_open||(this.lock_modal_open=!0,this.modalCtrl.create({component:te.q,componentProps:{info:this.nakama.groups[this.isOfficial][this.target][this.info.group_id],server:{isOfficial:this.isOfficial,target:this.target}}}).then(M=>{M.onWillDismiss().then(b=>{b.data&&(this.extended_buttons.forEach(Q=>{Q.isHide=!0}),this.extended_buttons[0].isHide=!1,this.extended_buttons[8].isHide=!1,this.extended_buttons[11].isHide=!1)}),M.onDidDismiss().then(()=>{this.ionViewDidEnter()}),this.removeShortCutKey(),M.present(),this.lock_modal_open=!1}))}},{icon:"hammer-outline",isHide:!0,act:()=>{document.getElementById("local_channel").click()}},{icon_img:"voidDraw.png",act:(M=(0,m.c)(function*(){r.userInputTextArea||(r.userInputTextArea=document.getElementById(r.ChannelUserInputId));let Q,b={};if(r.userInput.file)switch(r.userInput.file.typeheader){case"image":try{r.userInput.file.url&&(r.userInput.file.blob=yield fetch(r.userInput.file.url).then(ae=>ae.blob()));let F=`tmp_files/chatroom/attached.${r.userInput.file.file_ext}`;yield r.indexed.saveBlobToUserPath(r.userInput.file.blob,F,void 0,r.indexed.godotDB);let K=document.getElementById("ChatroomSelectedImage");b.path=F,b.width=K.naturalWidth,b.height=K.naturalHeight,Q=r.userInput.file.content_related_creator}catch(F){return void r.p5toast.show({text:`${r.lang.text.ContentViewer.CannotEditFile}: ${F}`})}break;case"text":b.text=r.userInput.file.thumbnail}r.modalCtrl.create({component:z.S,componentProps:b,cssClass:"fullscreen"}).then(F=>{F.onWillDismiss().then(function(){var K=(0,m.c)(function*(ae){ae.data&&(yield r.voidDraw_fileAct_callback(ae,Q))});return function(ae){return K.apply(this,arguments)}}()),F.onDidDismiss().then(()=>{r.is_modal=!1,r.ionViewDidEnter()}),r.is_modal=!0,F.present()})}),function(){return M.apply(this,arguments)})},{icon:"document-attach-outline",act:()=>{this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId)),this.new_attach({detail:{value:"load"}})}},{icon:"link-outline",act:function(){var M=(0,m.c)(function*(){if(r.userInputTextArea||(r.userInputTextArea=document.getElementById(r.ChannelUserInputId)),r.useCDN)try{return void(yield r.new_attach({detail:{value:"link"}}))}catch{}r.toggle_linked_attach()});return function(){return M.apply(this,arguments)}}()},{icon:"camera-outline",act:function(){var M=(0,m.c)(function*(){try{const b=yield N.Ut.getPhoto({quality:90,resultType:N.on.Base64,source:N._8.Camera});let Q=yield r.loadingCtrl.create({message:r.lang.text.TodoDetail.WIP});Q.present(),r.userInputTextArea||(r.userInputTextArea=document.getElementById(r.ChannelUserInputId)),r.userInput.file={},r.userInput.file.filename=`Camera_${(new Date).toLocaleString().replace(/:/g,"_")}.${b.format}`,r.userInput.file.file_ext=b.format,r.userInput.file.thumbnail=r.sanitizer.bypassSecurityTrustUrl("data:image/jpeg;base64,"+b.base64String),r.userInput.file.type=`image/${b.format}`,r.userInput.file.typeheader="image",r.userInput.file.content_related_creator=[{user_id:r.info.local?"local":r.nakama.servers[r.isOfficial][r.target].session.user_id,timestamp:(new Date).getTime(),display_name:r.nakama.users.self.display_name,various:"camera"}],r.userInput.file.content_creator={user_id:r.info.local?"local":r.nakama.servers[r.isOfficial][r.target].session.user_id,timestamp:(new Date).getTime(),display_name:r.nakama.users.self.display_name,various:"camera"},yield r.indexed.saveBase64ToUserPath("data:image/jpeg;base64,"+b.base64String,`tmp_files/chatroom/${r.userInput.file.filename}`,K=>{r.userInput.file.blob=new Blob([K],{type:r.userInput.file.type})}),Q.dismiss()}catch{}});return function(){return M.apply(this,arguments)}}()},{icon:"server-outline",act:()=>{this.modalCtrl.create({component:P.m}).then(M=>{M.onDidDismiss().then(b=>{b.data?(this.userInput.quickShare=b.data,this.inputPlaceholder=this.lang.text.ChatRoom.QuickShare_placeholder):this.cancel_qrshare(),this.ionViewDidEnter()}),this.removeShortCutKey(),M.present()})}},{icon:"call-outline",act:function(){var M=(0,m.c)(function*(){try{yield r.webrtc.initialize("audio",void 0,{isOfficial:r.isOfficial,target:r.target,channel_id:r.info.id,user_id:r.info.info.id||r.info.info.user_id}),r.webrtc.CurrentMatch=yield r.nakama.servers[r.isOfficial][r.target].socket.createMatch(),yield r.nakama.servers[r.isOfficial][r.target].socket.writeChatMessage(r.info.id,{match:r.webrtc.CurrentMatch.match_id}),r.scroll_down_logs(),r.webrtc.CreateOfffer()}catch(b){console.log("webrtc \uc2dc\uc791\ub2e8\uacc4 \uc624\ub958: ",b)}});return function(){return M.apply(this,arguments)}}()},{isHide:!1,icon:"file-tray-full-outline",act:()=>{this.modalCtrl.create({component:D.w,componentProps:{path:`/${this.info.id}/files/`}}).then(M=>{M.onWillDismiss().then(function(){var b=(0,m.c)(function*(Q){Q.data&&r.selected_blobFile_callback_act(Q.data)});return function(Q){return b.apply(this,arguments)}}()),M.onDidDismiss().then(()=>{this.is_modal=!1,this.ionViewDidEnter()}),this.is_modal=!0,M.present()})}},{icon:"volume-mute-outline",act:function(){var M=(0,m.c)(function*(){r.toggle_speakermode()});return function(){return M.apply(this,arguments)}}()},{icon:"log-out-outline",act:function(){var M=(0,m.c)(function*(){if(3!=r.info.redirect.type)try{yield r.nakama.remove_group_list(r.nakama.groups[r.isOfficial][r.target][r.info.group_id]||r.info.info,r.isOfficial,r.target,!1),yield r.nakama.servers[r.isOfficial][r.target].socket.leaveChat(r.info.id),r.nakama.channels_orig[r.isOfficial][r.target][r.info.id].status="missing",r.extended_buttons.forEach(b=>{b.isHide=!0}),r.extended_buttons[8].isHide=!1,r.extended_buttons[11].isHide=!1}catch(b){console.error("\ucc44\ub110\uc5d0\uc11c \ub098\uc624\uae30 \uc2e4\ud328: ",b)}else r.extended_buttons[10].isHide=!0;r.ionViewDidEnter()});return function(){return M.apply(this,arguments)}}()},{isHide:!0,icon:"close-circle-outline",act:()=>{this.alertCtrl.create({header:this.lang.text.ChatRoom.RemoveChannel,message:this.lang.text.ChatRoom.CannotUndone,buttons:[{text:this.lang.text.ChatRoom.Delete,handler:function(){var M=(0,m.c)(function*(){let b=yield r.loadingCtrl.create({message:r.lang.text.TodoDetail.WIP});switch(b.present(),delete r.nakama.channels_orig[r.isOfficial][r.target][r.info.id],r.info.redirect.type){case 3:yield r.nakama.remove_group_list(r.nakama.groups[r.isOfficial][r.target][r.info.group_id]||r.info.info,r.isOfficial,r.target);break;case 0:yield r.indexed.removeFileFromUserPath(`servers/${r.isOfficial}/${r.target}/groups/${r.info.id}.img`)}try{delete r.nakama.groups[r.isOfficial][r.target][r.info.group_id]}catch(F){console.log("DeleteGroupFailed: ",F)}r.nakama.remove_channel_files(r.isOfficial,r.target,r.info.id),r.nakama.save_groups_with_less_info();let Q=yield r.indexed.GetFileListFromDB(`servers/${r.isOfficial}/${r.target}/channels/${r.info.id}`);for(let F=0,K=Q.length;F<K;F++)b.message=`${r.lang.text.UserFsDir.DeleteFile}: ${K-F}`,yield r.indexed.removeFileFromUserPath(Q[F]);b.dismiss(),r.navCtrl.pop()});return function(){return M.apply(this,arguments)}}(),cssClass:"red_font"}]}).then(M=>M.present())}}],this.is_modal=!1,this.useCDN=!0,this.next_cursor="",this.prev_cursor="",this.file_sel_id="file_sel_id",this.ShowGoToBottom=!1,this.isMobile=!1,this.last_message_viewer={user_id:void 0,message:void 0,color:void 0,is_me:void 0},this.userInput={file:void 0,quickShare:void 0,text:""},this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder,this.pullable=!0,this.ViewableMessage=[],this.ViewMsgIndex=0,this.RefreshCount=15,this.ViewCount=45,this.ShowRecentMsg=!1,this.isOfflineClosedGroup=!1,this.useSpeaker=!1,this.isSpeeching=!1,this.SpeechThese=[],this.isHistoryLoaded=!1,this.LocalHistoryList=[],this.isHidden=!0,this.isIphone=!1,this.ChannelUserInputId="ChannelUserInputId",this.isOtherAct=!1,this.lock_modal_open=!1}add_shortcut(){this.is_modal||this.ionViewDidEnter()}ionViewDidEnter(){this.nakama.resumeBanner(),this.global.p5key.KeyShortCut.Escape=()=>{this.navCtrl.pop()},this.global.p5key.KeyShortCut.BottomTab=i=>{document.activeElement!=document.getElementById(this.ChannelUserInputId)&&"E"===i&&this.open_ext_with_delay()};let e=[];for(let i=0,a=this.extended_buttons.length;i<a;i++)this.extended_buttons[i].isHide||e.push(this.extended_buttons[i]);this.global.p5key.KeyShortCut.Digit=i=>{!this.isHidden&&document.activeElement!=document.getElementById(this.ChannelUserInputId)&&e.length>i&&e[i].act()},this.global.p5key.KeyShortCut.EnterAct=()=>{document.activeElement!=document.getElementById(this.ChannelUserInputId)&&setTimeout(()=>{this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId)),this.userInputTextArea.focus()},0)}}new_attach(e){var i=this;return(0,m.c)(function*(){switch(e.detail.value){case"load":i.userInputTextArea||(i.userInputTextArea=document.getElementById(i.ChannelUserInputId)),document.getElementById(i.file_sel_id).click();break;case"link":try{let a;try{a=yield i.mClipboard.paste()}catch{try{a=yield E.c.read()}catch(d){throw d}}try{if(!(yield fetch(a)).ok)throw"URL \uad6c\uc870\uac00 \uc815\uc0c1\uc774 \uc544\ub2d8"}catch{throw"URL \uad6c\uc870\uac00 \uc815\uc0c1\uc774 \uc544\ub2d8"}let l={};l.url=a,l.content_related_creator=[{user_id:i.info.local?"local":i.nakama.servers[i.isOfficial][i.target].session.user_id,timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"link"}],l.content_creator={user_id:i.info.local?"local":i.nakama.servers[i.isOfficial][i.target].session.user_id,timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"link"};let c=l.url.split(".");l.file_ext=c.pop().split("?").shift(),l.filename=decodeURIComponent(`${c.pop().split("/").pop()||i.lang.text.ChatRoom.ExternalLinkFile}.${l.file_ext}`),i.global.set_viewer_category_from_ext(l),l.type="",l.typeheader=l.viewer,i.global.modulate_thumbnail(l,l.url),i.NeedScrollDown()&&setTimeout(()=>{i.scroll_down_logs()},100),i.userInput.file=l,i.inputPlaceholder=`(${i.lang.text.ChatRoom.FileLink}: ${i.userInput.file.filename})`}catch(a){throw console.warn("\uc778\uc2dd \ubd88\uac00\ub2a5\ud55c URL \uc815\ubcf4: ",a),"\uc778\uc2dd \ubd88\uac00\ub2a5\ud55c URL \uc815\ubcf4"}}})()}toggle_linked_attach(){var e=this;return(0,m.c)(function*(){e.useCDN=!e.useCDN,e.extended_buttons[4].icon=e.useCDN?"link-outline":"unlink-outline"})()}toggle_speakermode(e){var i=this;return(0,m.c)(function*(){if(i.useSpeaker=null!=e?e:!i.useSpeaker,i.extended_buttons[9].icon=i.useSpeaker?"volume-high-outline":"volume-mute-outline",!i.useSpeaker)try{yield y.stop()}catch{}})()}cancel_qrshare(){delete this.userInput.quickShare,this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder}inputFileSelected(e){var i=this;return(0,m.c)(function*(){if(e.target.files.length)if(1!=e.target.files.length)(yield i.alertCtrl.create({header:i.lang.text.ChatRoom.MultipleSend,message:`${i.lang.text.ChatRoom.CountFile}: ${e.target.files.length}`,buttons:[{text:i.lang.text.ChatRoom.Send,handler:(c=(0,m.c)(function*(){let h=yield i.loadingCtrl.create({message:i.lang.text.ChatRoom.MultipleSend});h.present(),i.noti.noti.schedule({id:7,title:i.lang.text.ChatRoom.MultipleSend,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://diychat",color:"b0b0b0"});for(let d=0,v=e.target.files.length;d<v;d++)h.message=`${i.lang.text.ChatRoom.MultipleSend}: ${v-d}`,i.noti.noti.schedule({id:7,title:i.lang.text.ChatRoom.MultipleSend,progressBar:{value:d,maxValue:v},sound:null,smallIcon:"res://diychat",color:"b0b0b0"}),yield i.selected_blobFile_callback_act(e.target.files[d]),yield i.send();i.noti.ClearNoti(7),h.dismiss(),setTimeout(()=>{i.scroll_down_logs()},300)}),function(){return c.apply(this,arguments)})}]})).present();else{let l=yield i.loadingCtrl.create({message:i.lang.text.TodoDetail.WIP});l.present(),yield i.selected_blobFile_callback_act(e.target.files[0]),l.dismiss()}else delete i.userInput.file,i.inputPlaceholder=i.lang.text.ChatRoom.input_placeholder;var c})()}LocalChannelImageChanged(e){var i=this;return(0,m.c)(function*(){let a=yield i.global.GetBase64ThroughFileReader(e.target.files[0]);i.nakama.limit_image_size(a,l=>{i.info.info.img=l.canvas.toDataURL(),i.indexed.saveTextFileToUserPath(i.info.info.img,`servers/${i.info.server.isOfficial}/${i.info.server.target}/groups/${i.info.id}.img`),i.p5toast.show({text:i.lang.text.ChatRoom.LocalImageChanged})})})()}ngOnInit(){var e=this;this.isIphone=this.platform.is("iphone"),this.ChatLogs=document.getElementById("chatroom_div"),this.ChatLogs.onscroll=i=>{Math.abs(this.ChatLogs.scrollHeight-(this.ChatLogs.scrollTop+this.ChatLogs.clientHeight))<1&&(this.ShowGoToBottom||this.ShowRecentMsg||this.init_last_message_viewer(),this.ShowRecentMsg&&this.pull_msg_history(!1)),this.ShowGoToBottom=this.ChatLogs.scrollHeight-220>this.ChatLogs.scrollTop+this.ChatLogs.clientHeight},this.nakama.ChatroomLinkAct=function(){var i=(0,m.c)(function*(a,l){delete e.nakama.channels_orig[e.isOfficial][e.target][e.info.id].update,e.info=a,yield e.init_chatroom(),e.userInput.file=l,e.userInput.file&&e.create_thumbnail_imported(l)});return function(a,l){return i.apply(this,arguments)}}(),this.route.queryParams.subscribe(function(){var i=(0,m.c)(function*(a){const l=e.router.getCurrentNavigation().extras.state;l&&(e.info=l.info),yield new Promise(c=>setTimeout(c,100)),yield e.init_chatroom(),e.userInput.file=l.file,e.userInput.file&&e.create_thumbnail_imported(l.file)});return function(a){return i.apply(this,arguments)}}()),"DesktopPWA"==A.s1&&setTimeout(()=>{this.CreateDrop()},0),this.isMobile="Android"==A.s1||"iOS"==A.s1}GetSpeechToText(){var e=this;return(0,m.c)(function*(){let i=yield O.I.start({language:e.lang.lang,maxResults:1,prompt:e.lang.text.ChatRoom.TalkMessage,partialResults:!0,popup:!0});e.userInput.text=i.matches[0]})()}CreateDrop(){var e=this;let i=document.getElementById("p5Drop_chatroom");this.p5canvas=new W(a=>{a.setup=()=>{let v=a.createCanvas(i.clientWidth,i.clientHeight);v.parent(i),a.pixelDensity(1),v.drop(g=>{let k=a.millis();h<k-400?(c=!1,d.length=0,d.push(g)):(c=!0,d.push(g)),h=k,clearTimeout(l),l=setTimeout((0,m.c)(function*(){if(c)e.alertCtrl.create({header:e.lang.text.ChatRoom.MultipleSend,message:`${e.lang.text.ChatRoom.CountFile}: ${d.length}`,buttons:[{text:e.lang.text.ChatRoom.Send,handler:()=>{e.DropSendAct(d)}}]}).then(w=>w.present());else{let w=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});w.present(),e.selected_blobFile_callback_act(g.file),w.dismiss()}}),400)})};let l,c=!1,h=0,d=[];a.mouseMoved=v=>{v.dataTransfer?(i.style.pointerEvents="all",i.style.backgroundColor="#0008"):(i.style.pointerEvents="none",i.style.backgroundColor="transparent")}})}DropSendAct(e){var i=this;return(0,m.c)(function*(){let a=yield i.loadingCtrl.create({message:i.lang.text.TodoDetail.WIP});a.present();for(let l=0,c=e.length;l<c;l++)yield i.selected_blobFile_callback_act(e[l].file),yield i.send();a.dismiss(),setTimeout(()=>{i.scroll_down_logs()},300)})()}selected_blobFile_callback_act(e,i=[],a="loaded",l){var c=this;return(0,m.c)(function*(){c.userInput.file={},c.userInput.file.filename=e.name,c.userInput.file.file_ext=e.name.split(".").pop()||e.type||c.lang.text.ChatRoom.unknown_ext,c.userInput.file.size=e.size,c.userInput.file.type=e.type,l&&(c.userInput.file.path=l),c.userInput.file.content_related_creator=[...i,{user_id:c.info.local?"local":c.nakama.servers[c.isOfficial][c.target].session.user_id,timestamp:(new Date).getTime(),display_name:c.nakama.users.self.display_name,various:a}],c.userInput.file.content_creator={user_id:c.info.local?"local":c.nakama.servers[c.isOfficial][c.target].session.user_id,timestamp:(new Date).getTime(),display_name:c.nakama.users.self.display_name,various:a},c.userInput.file.blob=e,c.create_selected_thumbnail(),c.inputPlaceholder=`(${c.lang.text.ChatRoom.attachments}: ${c.userInput.file.filename})`})()}create_thumbnail_imported(e){var i=this;return(0,m.c)(function*(){let a=yield i.indexed.loadBlobFromUserPath(e.path,e.type);a.name=e.filename||e.name,i.selected_blobFile_callback_act(a,e.content_related_creator,"shared",e.path)})()}create_selected_thumbnail(){var e=this;return(0,m.c)(function*(){if(e.global.set_viewer_category_from_ext(e.userInput.file),e.userInput.file.url)return e.userInput.file.thumbnail=e.userInput.file.url,void(e.userInput.file.typeheader=e.userInput.file.viewer);try{e.userInput.file.thumbnail=yield e.indexed.loadBlobFromUserPath(e.userInput.file.path,e.userInput.file.type)}catch{}let i=URL.createObjectURL(e.userInput.file.blob);switch(e.userInput.file.typeheader=e.userInput.file.blob.type.split("/")[0]||e.userInput.file.viewer,setTimeout(()=>{URL.revokeObjectURL(i)},0),e.userInput.file.thumbnail=void 0,e.userInput.file.typeheader){case"image":e.userInput.file.thumbnail=e.sanitizer.bypassSecurityTrustUrl(i);break;case"text":new W(a=>{a.setup=()=>{a.noCanvas(),a.loadStrings(i,l=>{e.userInput.file.thumbnail=l,a.remove()},l=>{console.error("\ubb38\uc790\uc5f4 \ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",l),a.remove()})}})}})()}init_chatroom(){var e=this;return(0,m.c)(function*(){switch(e.nakama.OnTransferMessage={},e.ViewableMessage.length=0,e.ViewMsgIndex=0,e.ShowGoToBottom=!1,e.ShowRecentMsg=!1,e.isHistoryLoaded=!1,e.LocalHistoryList.length=0,e.messages.length=0,e.prev_cursor="",e.next_cursor="",e.pullable=!0,e.toggle_speakermode(!1),e.init_last_message_viewer(),e.file_sel_id=`chatroom_${e.info.id}_${(new Date).getTime()}`,e.ChannelUserInputId=`chatroom_input_${e.info.id}_${(new Date).getTime()}`,e.noti.Current=e.info.cnoti_id,e.info.cnoti_id&&e.noti.ClearNoti(e.info.cnoti_id),e.noti.RemoveListener(`openchat${e.info.cnoti_id}`),e.isOfficial=e.info.server.isOfficial,e.target=e.info.server.target,e.info=e.nakama.channels_orig[e.isOfficial][e.target][e.info.id],e.nakama.opened_page_info.channel={isOfficial:e.isOfficial,target:e.target,id:e.info.id},e.foundLastRead=e.info.last_read_id==e.info.last_comment_id,e.extended_buttons.forEach(i=>{i.isHide=!1}),e.info.redirect.type){case 2:"missing"!=e.info.status&&(e.info.redirect?"online"==e.statusBar.groupServer[e.isOfficial][e.target]&&(e.info.status=e.nakama.load_other_user(e.info.redirect.id,e.isOfficial,e.target).online?"online":"pending"):e.info.status=e.info.info.online?"online":"pending",e.extended_buttons[0].isHide=!0,e.extended_buttons[1].isHide=!0,e.extended_buttons[7].isHide="http:"==window.location.protocol&&0!=window.location.host.indexOf("localhost")||!1,delete e.extended_buttons[8].isHide,e.extended_buttons[11].isHide=!0);break;case 3:"missing"!=e.info.status&&(yield e.nakama.load_groups(e.isOfficial,e.target,e.info.group_id)),e.extended_buttons[1].isHide=!0,e.extended_buttons[10].isHide=!0,delete e.extended_buttons[0].isHide,e.extended_buttons[7].isHide=!0,e.extended_buttons[11].isHide=!0;break;case 0:e.extended_buttons[0].isHide=!0,e.extended_buttons[6].isHide=!0,e.extended_buttons[7].isHide=!0,e.extended_buttons[10].isHide=!0}e.nakama.channels_orig[e.isOfficial][e.target]&&e.nakama.channels_orig[e.isOfficial][e.target][e.info.id]&&"missing"!=e.info.status&&(e.nakama.channels_orig[e.isOfficial][e.target][e.info.id].update=i=>{if(1==i.code){for(let l=0,c=e.messages.length;l<c;l++)if(e.messages[l].message_id==i.message_id){e.messages[l].content=i.content;break}return}let a="local"==i.sender_id;a||e.nakama.check_sender_and_show_name(i,e.isOfficial,e.target),i.content.filename&&e.ModulateFileEmbedMessage(i),e.info.last_read_id=e.info.last_comment_id,e.nakama.save_channels_with_less_info(),a||e.check_if_send_msg(i),1==i.code||2==i.code||e.messages.push(i),e.ViewMsgIndex+e.ViewCount==e.messages.length-1&&e.ViewMsgIndex++,e.ViewableMessage=e.messages.slice(e.ViewMsgIndex,e.ViewMsgIndex+e.ViewCount),e.modulate_chatmsg(0,e.ViewableMessage.length),e.modulate_chatmsg(e.ViewableMessage.length-1,e.ViewableMessage.length),e.ShowRecentMsg=e.messages.length>e.ViewMsgIndex+e.ViewCount,e.useSpeaker&&e.SpeechReceivedMessage(i),setTimeout(()=>{if(e.info.is_new=!1,e.nakama.has_new_channel_msg=!1,e.NeedScrollDown()&&!e.ShowRecentMsg)e.init_last_message_viewer(),e.ChatLogs.scrollTo({top:e.ChatLogs.scrollHeight,behavior:"smooth"});else{e.last_message_viewer.is_me=!!e.info.local||i.sender_id==e.nakama.servers[e.isOfficial][e.target].session.user_id,e.last_message_viewer.user_id=i.sender_id;let l=JSON.parse(JSON.stringify(i.content.msg));i.content.filename&&(l.length?l[0][0].text=`(${e.lang.text.ChatRoom.attachments}) ${l[0][0].text}`:l=[[{text:`(${e.lang.text.ChatRoom.attachments})`}]]),e.last_message_viewer.message=l,e.last_message_viewer.color=i.color}},0),e.global.godot_window&&e.global.godot_window.received_msg&&e.global.godot_window.received_msg({sender_id:i.sender_id,user_display_name:i.user_display_name,content:i.content})}),(void 0===e.info.status||"missing"==e.info.status)&&(e.extended_buttons.forEach(i=>{i.isHide=!0}),e.extended_buttons[8].isHide=!1,e.extended_buttons[11].isHide=!1,3==e.info.redirect.type&&(e.extended_buttons[0].isHide=!1)),e.extended_buttons[9].isHide=A.O$||"missing"==e.info.status,e.pull_msg_history(),setTimeout(()=>{e.ChatLogs.scrollTo({top:e.ChatLogs.scrollHeight,behavior:"smooth"})},500)})()}init_last_message_viewer(){delete this.last_message_viewer.user_id,delete this.last_message_viewer.message,delete this.last_message_viewer.color,delete this.last_message_viewer.is_me}NeedScrollDown(){return this.ChatLogs.scrollHeight<this.ChatLogs.scrollTop+this.ChatLogs.clientHeight+200}scroll_down_logs(){this.ShowRecentMsg||this.init_last_message_viewer(),this.ChatLogs.scrollTo({top:this.ChatLogs.scrollHeight,behavior:"smooth"})}check_if_send_msg(e){for(let i=0,a=this.sending_msg.length;i<a;i++)if(e.sender_id==this.nakama.servers[this.isOfficial][this.target].session.user_id&&e.content.local_comp==this.sending_msg[i].content.local_comp){e.content.filename&&this.auto_open_thumbnail(e),this.sending_msg.splice(i,1);break}}auto_open_thumbnail(e){try{this.temporary_open_thumbnail[e.message_id]()}catch{this.temporary_open_thumbnail[e.message_id]=()=>{this.indexed.loadBlobFromUserPath(`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${e.message_id}.${e.content.file_ext}`,e.content.type,a=>{e.content.path=`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${e.message_id}.${e.content.file_ext}`;let l=URL.createObjectURL(a);this.global.modulate_thumbnail(e.content,l),this.NeedScrollDown()&&setTimeout(()=>{this.scroll_down_logs()},100),this.nakama.WriteStorage_From_channel(e,e.content.path,this.isOfficial,this.target)}),delete this.temporary_open_thumbnail[e.message_id]}}}removeAttach(){delete this.userInput.file,this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder}pull_msg_history(e=!0){var i=this;return(0,m.c)(function*(){if(i.pullable||!e)if(i.pullable=!1,e)try{if(i.info.local)throw"Local channel";if(void 0===i.info.status||"missing"==i.info.status)throw"Channel missing";if(0!=i.ViewMsgIndex){let a=Math.min(i.ViewMsgIndex,i.RefreshCount);i.ViewMsgIndex-=a,i.ViewableMessage=i.messages.slice(i.ViewMsgIndex,i.ViewMsgIndex+i.ViewCount);for(let l=0;l<a;l++)try{i.ViewableMessage[l].content.path=`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${i.ViewableMessage[l].message_id}.${i.ViewableMessage[l].content.file_ext}`;let c=yield i.indexed.loadBlobFromUserPath(i.ViewableMessage[l].content.path,i.ViewableMessage[l].content.file_ext),h=URL.createObjectURL(c);i.global.modulate_thumbnail(i.ViewableMessage[l].content,h)}catch{try{let h=yield i.indexed.loadBlobFromUserPath(`${i.ViewableMessage[l].content.path}_thumbnail.png`,"image/png"),d=URL.createObjectURL(h);i.global.modulate_thumbnail(i.ViewableMessage[l].content,d)}catch{}}return i.modulate_chatmsg(0,i.ViewableMessage.length),i.ShowRecentMsg=i.messages.length>i.ViewMsgIndex+i.ViewCount,void(i.pullable=!0)}yield i.nakama.servers[i.isOfficial][i.target].client.listChannelMessages(i.nakama.servers[i.isOfficial][i.target].session,i.info.id,i.RefreshCount,!1,i.next_cursor).then(a=>{i.info.is_new=!1,a.messages.forEach(l=>{l=i.nakama.modulation_channel_message(l,i.isOfficial,i.target),i.nakama.check_sender_and_show_name(l,i.isOfficial,i.target),i.info.last_comment||(i.info.last_comment=(l.content.filename?`(${i.lang.text.ChatRoom.attachments}) `:"")+(l.content.msg||l.content.noti||"")),!i.foundLastRead&&i.info.last_read_id?i.info.last_read_id==l.message_id&&(l.isLastRead=!0,i.foundLastRead=!0,i.info.last_read_id=i.info.last_comment_id,i.nakama.save_channels_with_less_info()):i.foundLastRead=!0,i.nakama.translate_updates(l),l.content.filename&&i.ModulateFileEmbedMessage(l),i.nakama.ModulateTimeDate(l),i.nakama.content_to_hyperlink(l),2!=l.code&&i.messages.unshift(l),i.ViewableMessage=i.messages.slice(i.ViewMsgIndex,i.ViewMsgIndex+i.ViewCount),i.modulate_chatmsg(0,i.ViewableMessage.length)}),i.ShowRecentMsg=i.messages.length>i.ViewMsgIndex+i.ViewCount,i.next_cursor=a.next_cursor,i.prev_cursor=a.prev_cursor,i.pullable=!0,i.nakama.saveListedMessage(i.messages,i.info,i.isOfficial,i.target)})}catch{if(3==i.info.redirect.type&&i.nakama.groups[i.isOfficial][i.target]&&i.nakama.groups[i.isOfficial][i.target][i.info.group_id]&&!i.nakama.groups[i.isOfficial][i.target][i.info.group_id].open)return i.isOfflineClosedGroup=!0,i.next_cursor=void 0,void(i.isHistoryLoaded=!0);i.LoadLocalChatHistory()}else{let a=i.messages.length-i.ViewMsgIndex-i.ViewCount;i.ShowRecentMsg=0!=a,i.ViewMsgIndex+=Math.min(i.RefreshCount,a),i.ViewableMessage=i.messages.slice(i.ViewMsgIndex,i.ViewMsgIndex+i.ViewCount);for(let l=i.ViewableMessage.length-1;l>=0;l--){try{i.ViewableMessage[l].content.path=`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${i.ViewableMessage[l].message_id}.${i.ViewableMessage[l].content.file_ext}`;let c=yield i.indexed.loadBlobFromUserPath(i.ViewableMessage[l].content.path,i.ViewableMessage[l].content.file_ext),h=URL.createObjectURL(c);i.global.modulate_thumbnail(i.ViewableMessage[l].content,h)}catch{}i.modulate_chatmsg(l,i.ViewableMessage.length)}i.pullable=!0}})()}SpeechReceivedMessage(e){let i=JSON.parse(JSON.stringify(e.content.msg)),a="";for(let l=0,c=i.length;l<c;l++)for(let h=0,d=i[l].length;h<d;h++)a+=i[l][h].text+" ";this.SpeechThese.push(a),this.isSpeeching||this.SpeechingTexts()}SpeechingTexts(){var e=this;return(0,m.c)(function*(){let i=e.SpeechThese.shift();e.isSpeeching=!0,yield y.speak({text:i,lang:e.lang.lang}),e.SpeechThese.length?e.SpeechingTexts():e.isSpeeching=!1})()}LoadLocalChatHistory(){var e=this;return(0,m.c)(function*(){if(e.ViewMsgIndex>0){let i=Math.min(e.ViewableMessage.length,Math.min(e.ViewMsgIndex,e.RefreshCount));e.ViewMsgIndex-=i,e.ViewableMessage=e.messages.slice(e.ViewMsgIndex,e.ViewMsgIndex+e.ViewCount);for(let a=i-1;a>=0;a--){try{e.ViewableMessage[a].content.path=`servers/${e.isOfficial}/${e.target}/channels/${e.info.id}/files/msg_${e.ViewableMessage[a].message_id}.${e.ViewableMessage[a].content.file_ext}`;let l=yield e.indexed.loadBlobFromUserPath(e.ViewableMessage[a].content.path,e.ViewableMessage[a].content.file_ext),c=URL.createObjectURL(l);e.global.modulate_thumbnail(e.ViewableMessage[a].content,c)}catch{try{let c=yield e.indexed.loadBlobFromUserPath(`${e.ViewableMessage[a].content.path}_thumbnail.png`,"image/png"),h=URL.createObjectURL(c);e.global.modulate_thumbnail(e.ViewableMessage[a].content,h)}catch{}}e.modulate_chatmsg(a,i+1)}return e.ShowRecentMsg=e.messages.length>e.ViewMsgIndex+e.ViewCount,e.pullable=0!=e.ViewMsgIndex||!!e.LocalHistoryList.length,void(e.ViewableMessage.length<e.RefreshCount&&e.LoadLocalChatHistory())}e.isHistoryLoaded?e.indexed.loadTextFromUserPath(e.LocalHistoryList.pop(),function(){var i=(0,m.c)(function*(a,l){if(a&&l){let c=JSON.parse(l.trim());for(let d=c.length-1;d>=0;d--)e.nakama.translate_updates(c[d]),c[d]=e.nakama.modulation_channel_message(c[d],e.isOfficial,e.target),e.nakama.ModulateTimeDate(c[d]),2!=c[d].code&&e.messages.unshift(c[d]);e.ViewMsgIndex=Math.max(0,c.length-e.RefreshCount),e.ViewableMessage=e.messages.slice(e.ViewMsgIndex,e.ViewMsgIndex+e.ViewCount);let h=Math.min(Math.min(c.length,e.RefreshCount),e.ViewableMessage.length);for(let d=h-1;d>=0;d--){try{e.ViewableMessage[d].content.path=`servers/${e.isOfficial}/${e.target}/channels/${e.info.id}/files/msg_${e.ViewableMessage[d].message_id}.${e.ViewableMessage[d].content.file_ext}`;let v=yield e.indexed.loadBlobFromUserPath(e.ViewableMessage[d].content.path,e.ViewableMessage[d].content.file_ext),g=URL.createObjectURL(v);e.global.modulate_thumbnail(e.ViewableMessage[d].content,g)}catch{try{let g=yield e.indexed.loadBlobFromUserPath(`${e.ViewableMessage[d].content.path}_thumbnail.png`,"image/png"),k=URL.createObjectURL(g);e.global.modulate_thumbnail(e.ViewableMessage[d].content,k)}catch{}}e.modulate_chatmsg(d,h)}e.ShowRecentMsg=e.messages.length>e.ViewMsgIndex+e.ViewCount}else a&&e.LoadLocalChatHistory();e.pullable=!!e.LocalHistoryList.length});return function(a,l){return i.apply(this,arguments)}}()):e.indexed.GetFileListFromDB(`servers/${e.isOfficial}/${e.target}/channels/${e.info.id}/chats/`,i=>{e.LocalHistoryList=i,e.isHistoryLoaded=!0,e.LocalHistoryList.length&&e.indexed.loadTextFromUserPath(e.LocalHistoryList.pop(),function(){var a=(0,m.c)(function*(l,c){if(l&&c){let h=JSON.parse(c.trim());for(let d=h.length-1;d>=0;d--)e.nakama.translate_updates(h[d]),e.info.local||(h[d]=e.nakama.modulation_channel_message(h[d],e.isOfficial,e.target)),e.nakama.ModulateTimeDate(h[d]),2!=h[d].code&&e.messages.unshift(h[d]);e.ViewMsgIndex=Math.max(0,e.messages.length-e.RefreshCount),e.ViewableMessage=e.messages.slice(e.ViewMsgIndex,e.ViewMsgIndex+e.RefreshCount),e.modulate_chatmsg(0,h.length);for(let d=e.ViewableMessage.length-1;d>=0;d--){try{e.ViewableMessage[d].content.path=`servers/${e.isOfficial}/${e.target}/channels/${e.info.id}/files/msg_${e.ViewableMessage[d].message_id}.${e.ViewableMessage[d].content.file_ext}`;let v=yield e.indexed.loadBlobFromUserPath(e.ViewableMessage[d].content.path,e.ViewableMessage[d].content.file_ext),g=URL.createObjectURL(v);e.global.modulate_thumbnail(e.ViewableMessage[d].content,g)}catch{try{let g=yield e.indexed.loadBlobFromUserPath(`${e.ViewableMessage[d].content.path}_thumbnail.png`,"image/png"),k=URL.createObjectURL(g);e.global.modulate_thumbnail(e.ViewableMessage[d].content,k)}catch{}}e.modulate_chatmsg(d,e.ViewableMessage.length)}e.ViewableMessage.length<e.RefreshCount&&e.LoadLocalChatHistory()}e.next_cursor=null,e.pullable=!0});return function(l,c){return a.apply(this,arguments)}}())})})()}open_ext_with_delay(){this.ScrollNearLogs(),this.isHidden=!this.isHidden}make_ext_hidden(){this.ScrollNearLogs(),"DesktopPWA"!=A.s1&&(this.isHidden=!0)}ScrollNearLogs(){this.NeedScrollDown()&&(this.ChatLogs.scrollTo({top:this.ChatLogs.scrollHeight,behavior:"smooth"}),setTimeout(()=>{this.ChatLogs.scrollTo({top:this.ChatLogs.scrollHeight,behavior:"smooth"})},150))}ResizeTextArea(){this.userInputTextArea.style.height=this.isIphone?"60px":"36px"}check_key(e){this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId)),"DesktopPWA"==A.s1?"Enter"!=e.key||e.shiftKey||"keydown"!=e.type?setTimeout(()=>{this.ResizeTextArea(),this.userInputTextArea.style.height=this.userInputTextArea.scrollHeight+"px"},0):this.send(!0):setTimeout(()=>{this.ResizeTextArea(),this.userInputTextArea.style.height=this.userInputTextArea.scrollHeight+"px"},0)}send(e=!1){var i=this;return(0,m.c)(function*(){if(e&&("Android"==A.s1||"iOS"==A.s1))return;if(i.userInputTextArea||(i.userInputTextArea=document.getElementById(i.ChannelUserInputId)),!i.userInput.text.trim()&&!i.userInput.file&&!i.userInput.quickShare)return void setTimeout(()=>{i.userInput.text="",i.ResizeTextArea()},0);i.userInputTextArea.focus(),i.isHidden=!0;let a={};a.msg=i.userInput.text;let l=!1,c=!1,h="";if(i.userInput.file){a.filename=i.userInput.file.filename,a.file_ext=i.userInput.file.file_ext,a.type=i.userInput.file.type;try{a.filesize=i.userInput.file.size||i.userInput.file.blob.size,a.partsize=Math.ceil(a.filesize/X.KY)}catch{a.url=i.userInput.file.url,c=!0}if(a.msg.length>800?(h=a.msg,delete a.msg):a.msg=a.msg,a.content_creator=i.userInput.file.content_creator,a.content_related_creator=i.userInput.file.content_related_creator,!c&&i.useCDN&&!i.info.local)try{let v=i.nakama.servers[i.isOfficial][i.target].info.address,g=i.nakama.servers[i.isOfficial][i.target].info.useSSL?"https:":"http:",k=yield i.global.upload_file_to_storage(i.userInput.file,i.nakama.servers[i.isOfficial][i.target].session.user_id,g,v);if(c=!!k,!c)throw"\ub9c1\ud06c \ub9cc\ub4e4\uae30 \uc2e4\ud328";delete a.partsize,a.url=k}catch(v){console.log("cdn \uc5c5\ub85c\ub4dc \ucc98\ub9ac \uc2e4\ud328: ",v)}l=!0;for(let v=0,g=a.content_related_creator.length;v<g;v++)delete a.content_related_creator[v].is_me,delete a.content_related_creator[v].timeDisplay,delete a.content_related_creator[v].various_display}else if(a.msg.length>800)return void i.LongTextMessageAsFile(a);i.userInput.quickShare&&(a.quickShare=i.userInput.quickShare),a.local_comp=Math.random();let d={content:JSON.parse(JSON.stringify(a))};if(i.nakama.content_to_hyperlink(d),i.info.local){let v=(new Date).getTime().toString();if(l&&!c){let w=`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${v}.${i.userInput.file.file_ext}`;yield i.indexed.saveBlobToUserPath(i.userInput.file.blob,w)}delete i.userInput.quickShare,delete i.userInput.file,h&&(a.msg=h,i.LongTextMessageAsFile(a));let g=(new Date).toISOString(),k={channel_id:i.info.id,code:0,color:"888",...d,create_time:g,update_time:g,sender_id:"local",message_id:v,user_display_name:i.nakama.users.self.display_name,is_me:!0};i.SendLocalMessage(k)}else{i.sending_msg.push(d);try{yield i.nakama.servers[i.isOfficial][i.target].socket.writeChatMessage(i.info.id,a).then(v=>{l&&!c&&i.indexed.saveBlobToUserPath(i.userInput.file.blob,`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${v.message_id}.${i.userInput.file.file_ext}`,()=>{i.auto_open_thumbnail({content:a,message_id:v.message_id})}),delete i.userInput.quickShare,delete i.userInput.file,i.userInput.text="",i.ResizeTextArea(),i.inputPlaceholder=i.lang.text.ChatRoom.input_placeholder,h&&(a.msg=h,i.LongTextMessageAsFile(a))})}catch(v){3===v.code?i.p5toast.show({text:i.lang.text.ChatRoom.FailedToJoinChannel}):(console.log("\uc624\ub958 \uac80\ud1a0 \ud544\uc694: ",v),i.p5toast.show({text:`${i.lang.text.ChatRoom.FailedToSend}: ${v.message}`})),setTimeout(()=>{i.userInput.text="",i.ResizeTextArea()},0),setTimeout(()=>{for(let g=i.sending_msg.length-1;g>=0;g--)i.sending_msg[g].content.local_comp==a.local_comp&&i.sending_msg.splice(g,1)},1500)}}})()}SendLocalMessage(e){let i=this.deserialize_text(e);this.nakama.ModulateTimeDate(e),this.nakama.channels_orig[this.isOfficial][this.target][e.channel_id].last_comment_time=e.update_time,this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].last_comment_id=e.message_id,this.nakama.rearrange_channels(),this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].update(e),this.nakama.saveListedMessage([e],this.info,this.isOfficial,this.target),this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].last_comment=(e.content.filename?`(${this.lang.text.ChatRoom.attachments}) `:"")+(i||e.content.noti||(e.content.match?this.lang.text.ChatRoom.JoinWebRTCMatch:void 0)||""),this.nakama.save_channels_with_less_info(),setTimeout(()=>{this.userInput.text="",this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId)),this.ResizeTextArea(),this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder},0)}LongTextMessageAsFile(e){var i=this;return(0,m.c)(function*(){let a=new Blob([e.msg]);yield i.indexed.saveBlobToUserPath(a,`tmp_files/chatroom/${i.lang.text.ChatRoom.LongText}_${e.msg.substring(0,10)}.txt`);let l={};l.blob=a,l.content_related_creator=[{user_id:i.info.local?"local":i.nakama.servers[i.isOfficial][i.target].session.user_id,timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"long_text"}],l.content_creator={user_id:i.info.local?"local":i.nakama.servers[i.isOfficial][i.target].session.user_id,timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"long_text"};let c=e.msg.substring(0,24);l.path=`tmp_files/chatroom/${i.lang.text.ChatRoom.LongText}_${c}~.txt`,l.file_ext="txt",l.filename=`[${i.lang.text.ChatRoom.LongText}] ${c}~.txt`,i.global.set_viewer_category_from_ext(l),l.type="text/plain",l.typeheader="text",delete e.msg,delete i.userInput.quickShare,delete i.userInput.file,i.userInput.text="",i.ResizeTextArea(),i.inputPlaceholder=i.lang.text.ChatRoom.input_placeholder,i.userInput.file=l,i.inputPlaceholder=`(${i.lang.text.ChatRoom.attachments}: ${i.userInput.file.filename})`,i.create_selected_thumbnail(),i.p5toast.show({text:i.lang.text.ChatRoom.CreateAsTextFile})})()}SetOtherAct(){this.isOtherAct=!0,setTimeout(()=>{this.isOtherAct=!1},0)}message_detail(e,i){var a=this;return(0,m.c)(function*(){if(a.isOtherAct||"offline"==a.info.status||"missing"==a.info.status||!e.is_me)return;let c,l=a.deserialize_text(e);if(e.content.viewer){try{if("image"!=e.content.viewer)throw"\uc774\ubbf8\uc9c0 \ud30c\uc77c\uc774 \uc544\ub2d8";let g=yield a.indexed.loadBlobFromUserPath(e.content.path,e.content.type);c=URL.createObjectURL(g)}catch{try{let k=yield a.indexed.loadBlobFromUserPath(`${e.content.path}_thumbnail.png`,e.content.type);c=URL.createObjectURL(k)}catch{}}l=`(${a.lang.text.ChatRoom.attachments}) ${l}`}e.content.url&&(c=e.content.thumbnail);let h=c?`<div style="text-align: center;">${l}</div>`:`<div>${l}</div>`;var g;a.alertCtrl.create({header:a.lang.text.ChatRoom.ManageChat,message:new L.AF(c?`<div style="width: 100%;"><img src="${c}" alt="${e.content.filename}" style="border-radius: 8px; max-height: 230px; position: relative; left: 50%; transform: translateX(-50%); ${a.info.HideAutoThumbnail?"filter: blur(6px);":""}"></div>`+h:h),buttons:[{text:a.lang.text.ChatRoom.EditChat,handler:()=>{var g;a.alertCtrl.create({header:a.lang.text.ChatRoom.EditChat,inputs:[{type:"textarea",value:l,placeholder:l}],buttons:[{text:a.lang.text.ChatRoom.EditChat,handler:(g=(0,m.c)(function*(k){let w=k[0]||l,j=!1,Y=JSON.parse(JSON.stringify(e));if(Y.content.msg=w,Y.content.edited=!0,Y.update_time=(new Date).toISOString(),a.info.local)j=!0;else try{yield a.nakama.servers[a.isOfficial][a.target].socket.updateChatMessage(a.info.id,e.message_id,Y.content),j=!0}catch(se){console.log("\uba54\uc2dc\uc9c0 \ud3b8\uc9d1 \uc694\uccad \uc624\ub958: ",se)}j&&(Y.code=1,a.info.local&&(a.nakama.content_to_hyperlink(Y),a.SendLocalMessage(Y)))}),function(w){return g.apply(this,arguments)})}]}).then(g=>{g.onWillDismiss().then(()=>{a.ionViewDidEnter()}),a.removeShortCutKey(),g.present()})}},{text:a.lang.text.UserFsDir.Delete,cssClass:"red_font",handler:(g=(0,m.c)(function*(){let k=!1;if(a.info.local){if(c)try{let w=`servers/${a.isOfficial}/${a.target}/channels/${a.info.id}/files/msg_${e.message_id}.${e.content.file_ext}`;yield a.indexed.removeFileFromUserPath(w),yield a.indexed.removeFileFromUserPath(`${w}_thumbnail.png`),k=!0}catch{}}else try{if(yield a.nakama.servers[a.isOfficial][a.target].socket.removeChatMessage(a.info.id,e.message_id),c){let w=yield a.loadingCtrl.create({message:a.lang.text.UserFsDir.DeleteFile});w.present();for(let Y=0;Y<e.content.partsize;Y++){try{yield a.nakama.servers[a.isOfficial][a.target].client.deleteStorageObjects(a.nakama.servers[a.isOfficial][a.target].session,{object_ids:[{collection:`file_${e.channel_id.replace(/[.]/g,"_")}`,key:`msg_${e.message_id}_${Y}`}]})}catch{}w.message=`${a.lang.text.UserFsDir.DeleteFile}: ${e.content.filename}_${e.content.partsize-Y}`}let j=`servers/${a.isOfficial}/${a.target}/channels/${a.info.id}/files/msg_${e.message_id}.${e.content.file_ext}`;yield a.indexed.removeFileFromUserPath(j),yield a.indexed.removeFileFromUserPath(`${j}_thumbnail.png`),w.dismiss()}k=!0}catch(w){console.error("\ucc44\ub110 \uba54\uc2dc\uc9c0 \uc0ad\uc81c \uc624\ub958: ",w)}if(k){a.ViewableMessage.splice(i,1);for(let w=0,j=a.messages.length;w<j;w++)if(a.messages[w].message_id==e.message_id){a.messages.splice(w,1);break}e.code=2,a.SendLocalMessage(e);for(let w=a.ViewableMessage.length-1;w>=0;w--)a.modulate_chatmsg(w,a.ViewableMessage.length);a.p5toast.show({text:a.lang.text.ChatRoom.MsgRemoved})}}),function(){return g.apply(this,arguments)})}]}).then(g=>{g.onDidDismiss().then(()=>{URL.revokeObjectURL(c),a.isOtherAct=!1}),g.present()})})()}deserialize_text(e){let i="";for(let a=0,l=e.content.msg.length;a<l;a++){for(let c=0,h=e.content.msg[a].length;c<h;c++)i+=e.content.msg[a][c].text;a+1<l&&(i+="\n")}return i}file_detail(e){var i=this;return(0,m.c)(function*(){if(i.isOtherAct=!0,e.content.url)return i.open_viewer(e,e.content.url),void setTimeout(()=>{i.isOtherAct=!1},0);let a=`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${e.message_id}.${e.content.file_ext}`;try{if(!(yield i.indexed.checkIfFileExist(`${a}.history`)))throw"\uc378\ub124\uc77c \uc5f4\uae30";e.content.text=[i.lang.text.TodoDetail.WIP];let c=yield i.indexed.loadTextFromUserPath(`${a}.history`),h=JSON.parse(c);switch(delete e.content.text,h.type){case"upload":if(e.content.text=[i.lang.text.ChatRoom.uploading],i.nakama.WriteStorage_From_channel(e,a,i.isOfficial,i.target,h.index),e.content.transfer_index&&i.nakama.OnTransfer[i.isOfficial][i.target][e.channel_id][e.message_id].OnTransfer)throw"\uc804\uc1a1\uc791\uc5c5 \uc911, \uc378\ub124\uc77c \uc5f4\uae30";break;case"download":e.content.text=[i.lang.text.TodoDetail.WIP],yield i.nakama.ReadStorage_From_channel(e,a,i.isOfficial,i.target,h.index),i.NeedScrollDown()&&setTimeout(()=>{i.scroll_down_logs()},100)}}catch{(yield i.indexed.checkIfFileExist(a))?(e.content.text||(e.content.text=[i.lang.text.ChatRoom.downloaded]),i.indexed.loadBlobFromUserPath(a,e.content.type,h=>{e.content.path=a;let d=URL.createObjectURL(h);i.global.modulate_thumbnail(e.content,d),i.NeedScrollDown()&&setTimeout(()=>{i.scroll_down_logs()},100)}),i.open_viewer(e,a)):i.isHistoryLoaded||(e.content.text=[i.lang.text.TodoDetail.WIP],yield i.nakama.ReadStorage_From_channel(e,a,i.isOfficial,i.target),i.NeedScrollDown()&&setTimeout(()=>{i.scroll_down_logs()},400))}i.isOtherAct=!1})()}quickShare_act(e){var i=this;return(0,m.c)(function*(){i.modalCtrl.create({component:U.i,componentProps:{data:e.content.quickShare}}).then(a=>a.present())})()}JoinWebRTCMatch(e){this.nakama.JoinWebRTCMatch(e,this.isOfficial,this.target,this.info)}modulate_chatmsg(e,i){if(0!=i){this.ViewableMessage[e].showInfo||(this.ViewableMessage[e].showInfo={}),this.ViewableMessage[e].showInfo.date=!!this.ViewableMessage[e].msgDate,this.ViewableMessage[e].showInfo.sender=!this.ViewableMessage[e].content.noti,e-1>=0&&(this.ViewableMessage[e].showInfo.date=!!this.ViewableMessage[e].msgDate&&this.ViewableMessage[e].msgDate!=this.ViewableMessage[e-1].msgDate,this.ViewableMessage[e].showInfo.sender=!this.ViewableMessage[e].content.noti&&(this.ViewableMessage[e-1].isLastRead||this.ViewableMessage[e].sender_id!=this.ViewableMessage[e-1].sender_id||this.ViewableMessage[e-1].content.noti||this.ViewableMessage[e].msgDate!=this.ViewableMessage[e-1].msgDate||this.ViewableMessage[e].msgTime!=this.ViewableMessage[e-1].msgTime)),this.ViewableMessage[e].content.url&&("image"==this.ViewableMessage[e].content.viewer?this.ViewableMessage[e].content.thumbnail=this.ViewableMessage[e].content.url:delete this.ViewableMessage[e].content.thumbnail);try{e+1<i&&(this.ViewableMessage[e+1].showInfo.date=!!this.ViewableMessage[e].msgDate&&this.ViewableMessage[e].msgDate!=this.ViewableMessage[e+1].msgDate,this.ViewableMessage[e+1].showInfo.sender=!this.ViewableMessage[e+1].content.noti&&(this.ViewableMessage[e].isLastRead||this.ViewableMessage[e].sender_id!=this.ViewableMessage[e+1].sender_id||this.ViewableMessage[e].content.noti||this.ViewableMessage[e].msgDate!=this.ViewableMessage[e+1].msgDate||this.ViewableMessage[e].msgTime!=this.ViewableMessage[e+1].msgTime))}catch{}}}ModulateFileEmbedMessage(e){var i=this;let a=`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${e.message_id}.${e.content.file_ext}`;e.content.path=a;try{e.content.transfer_index=this.nakama.OnTransfer[this.isOfficial][this.target][e.channel_id][e.message_id]}catch{}e.content.transfer_index||this.indexed.checkIfFileExist(`${a}.history`,l=>{l&&this.indexed.loadTextFromUserPath(`${a}.history`,(c,h)=>{if(c&&h){let d=JSON.parse(h);delete e.content.text,this.nakama.OnTransfer[this.isOfficial]||(this.nakama.OnTransfer[this.isOfficial]={}),this.nakama.OnTransfer[this.isOfficial][this.target]||(this.nakama.OnTransfer[this.isOfficial][this.target]={}),this.nakama.OnTransfer[this.isOfficial][this.target][e.channel_id]||(this.nakama.OnTransfer[this.isOfficial][this.target][e.channel_id]={}),this.nakama.OnTransfer[this.isOfficial][this.target][e.channel_id][e.message_id]||(this.nakama.OnTransfer[this.isOfficial][this.target][e.channel_id][e.message_id]={index:e.content.partsize-d.index}),e.content.transfer_index=this.nakama.OnTransfer[this.isOfficial][this.target][e.channel_id][e.message_id]}})}),this.global.set_viewer_category(e.content),this.indexed.checkIfFileExist(a,function(){var l=(0,m.c)(function*(c){if(c)e.content.text=[i.lang.text.ChatRoom.downloaded],i.indexed.loadBlobFromUserPath(a,e.content.type,h=>{e.content.path=a;let d=URL.createObjectURL(h);i.global.modulate_thumbnail(e.content,d),i.NeedScrollDown()&&setTimeout(()=>{i.scroll_down_logs()},100)});else try{let h=yield i.indexed.loadBlobFromUserPath(`${e.content.path}_thumbnail.png`,"image/png"),d=URL.createObjectURL(h);i.global.modulate_thumbnail(e.content,d)}catch{}});return function(c){return l.apply(this,arguments)}}())}toggle_thumbnail(){var e=this;return(0,m.c)(function*(){e.info.HideAutoThumbnail=!e.info.HideAutoThumbnail,e.nakama.save_channels_with_less_info()})()}open_viewer(e,i){var a=this;let l=[];for(let c=0,h=this.messages.length;c<h;c++)this.messages[c].content.filename&&l.push(this.messages[c]);this.lock_modal_open||(this.lock_modal_open=!0,this.removeShortCutKey(),this.modalCtrl.create({component:J.K,componentProps:{info:e,path:i,alt_path:i,isOfficial:this.isOfficial,target:this.target,targetDB:this.indexed.ionicDB,relevance:l,local:this.info.local},cssClass:"fullscreen"}).then(c=>{c.onDidDismiss().then(h=>{if(this.ionViewDidEnter(),h.data)switch(h.data.type){case"image":let d=[];if(h.data.msg.content.content_related_creator&&(d=[...h.data.msg.content.content_related_creator]),h.data.msg.content.content_creator){let v=!1;for(let g=0,k=d.length;g<k;g++)if(d[g].user_id==h.data.msg.content.content_creator.user_id){v=!0;break}v||d.push(h.data.msg.content.content_creator)}return void this.modalCtrl.create({component:z.S,componentProps:{path:h.data.path||i,width:h.data.width,height:h.data.height,text:h.data.text},cssClass:"fullscreen"}).then(v=>{v.onWillDismiss().then(function(){var g=(0,m.c)(function*(k){k.data&&(yield a.voidDraw_fileAct_callback(k,d))});return function(k){return g.apply(this,arguments)}}()),v.present()});case"text":this.selected_blobFile_callback_act(h.data.blob,h.data.contentRelated,"textedit")}this.noti.Current=this.info.cnoti_id,this.info.cnoti_id&&this.noti.ClearNoti(this.info.cnoti_id),this.noti.RemoveListener(`openchat${this.info.cnoti_id}`)}),this.noti.Current="IonicViewerPage",c.present(),this.nakama.removeBanner(),this.lock_modal_open=!1}))}voidDraw_fileAct_callback(e,i){var a=this;return(0,m.c)(function*(){try{a.userInput.file={},a.userInput.file.filename=e.data.name,a.userInput.file.file_ext="png",a.userInput.file.thumbnail=a.sanitizer.bypassSecurityTrustUrl(e.data.img),a.userInput.file.type="image/png",a.userInput.file.typeheader="image",i?(a.userInput.file.content_related_creator=i,a.userInput.file.content_creator={user_id:a.info.local?"local":a.nakama.servers[a.isOfficial][a.target].session.user_id,timestamp:(new Date).getTime(),display_name:a.nakama.users.self.display_name,various:"voidDraw"}):(a.userInput.file.content_related_creator=[{user_id:a.info.local?"local":a.nakama.servers[a.isOfficial][a.target].session.user_id,timestamp:(new Date).getTime(),display_name:a.nakama.users.self.display_name,various:"voidDraw"}],a.userInput.file.content_creator={user_id:a.info.local?"local":a.nakama.servers[a.isOfficial][a.target].session.user_id,timestamp:(new Date).getTime(),display_name:a.nakama.users.self.display_name,various:"voidDraw"}),yield a.indexed.saveBase64ToUserPath(e.data.img,`tmp_files/chatroom/${a.userInput.file.filename}`,l=>{a.userInput.file.blob=new Blob([l],{type:a.userInput.file.type})}),a.inputPlaceholder=`(${a.lang.text.ChatRoom.attachments}: ${a.userInput.file.filename})`}catch(l){console.error("godot-\uc774\ubbf8\uc9c0 \ud3b8\uc9d1 \uc0ac\uc6a9 \ubd88\uac00: ",l)}e.data.loadingCtrl.dismiss()})()}user_detail(e){this.lock_modal_open||(this.isOtherAct=!0,this.lock_modal_open=!0,e.is_me?this.modalCtrl.create({component:ie.w,componentProps:{isOfficial:this.info.server.isOfficial,target:this.info.server.target}}).then(i=>{i.onDidDismiss().then(a=>{this.isOtherAct=!1,this.ionViewDidEnter(),this.noti.Current=this.info.cnoti_id,this.info.cnoti_id&&this.noti.ClearNoti(this.info.cnoti_id),this.noti.RemoveListener(`openchat${this.info.cnoti_id}`)}),this.noti.Current="GroupServerPage",i.present(),this.lock_modal_open=!1}):this.modalCtrl.create({component:ee.y,componentProps:{info:{user:this.nakama.load_other_user(e.sender_id,this.isOfficial,this.target)},group:this.info,has_admin:!1}}).then(i=>{i.onDidDismiss().then(a=>{this.isOtherAct=!1,this.noti.Current=this.info.cnoti_id,this.info.cnoti_id&&this.noti.ClearNoti(this.info.cnoti_id),this.noti.RemoveListener(`openchat${this.info.cnoti_id}`)}),this.noti.Current="OthersProfilePage",i.present(),this.lock_modal_open=!1}))}ionViewWillLeave(){this.nakama.rearrange_channels(),this.nakama.channels_orig[this.isOfficial][this.target]&&this.nakama.channels_orig[this.isOfficial][this.target][this.info.id]&&delete this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].update,this.noti.Current=void 0,this.removeShortCutKey()}removeShortCutKey(){delete this.global.p5key.KeyShortCut.Escape,delete this.global.p5key.KeyShortCut.BottomTab,delete this.global.p5key.KeyShortCut.Digit,delete this.global.p5key.KeyShortCut.EnterAct}ngOnDestroy(){delete this.nakama.opened_page_info.channel,this.nakama.ChatroomLinkAct=void 0,this.p5canvas&&this.p5canvas.remove(),this.nakama.OnTransferMessage={}}}return(o=u).\u0275fac=function(e){return new(e||o)(t.GI1(G.qS),t.GI1(q.wX),t.GI1($.gV),t.GI1($.E5),t.GI1(C.h),t.GI1(S.s),t.GI1(p.Y),t.GI1(x.k),t.GI1(f.o),t.GI1(R.mI),t.GI1(X.A1),t.GI1(G.Kg),t.GI1(T.C),t.GI1(H.O),t.GI1(ne._),t.GI1(G.iW),t.GI1(q.WU))},o.\u0275cmp=t.In1({type:o,selectors:[["app-chat-room"]],decls:42,vars:20,consts:[[1,"ion-no-border"],["slot","start"],["defaultHref","portal/subscribes"],["class","top_icon","slot","end","name","eye-outline",3,"click",4,"ngIf"],["class","top_icon","slot","end","name","eye-off-outline",3,"click",4,"ngIf"],[1,"header_online_circle"],["id","p5Drop_chatroom",2,"position","absolute","width","100%","height","100%","display","flex","pointer-events","none"],["id","main_table",2,"width","100%","height","100%","background-color","var(--chatroom-background)"],[2,"height","100%"],[2,"vertical-align","top"],["id","chatroom_div",1,"main",2,"max-width","100vw"],[4,"ngIf"],["id","chatroom_div","class","main","style","max-width: 100vw;",4,"ngIf"],[1,"thumnails"],["class","thumnail_parts",3,"click",4,"ngIf"],["class","thumnail_parts",4,"ngIf"],["id","input_table",2,"width","100%","background-color","var(--chatroom-input-background)"],["fill","clear",1,"ion-text-center",3,"disabled","click"],["name","add"],[2,"width","100%","vertical-align","bottom"],[1,"TextAreaInput",3,"id","ngModel","placeholder","ngModelChange","keyup","keydown","click"],["fill","clear","expand","block",3,"disabled","click"],["name","send"],["id","ext_menu",3,"hidden"],[1,"expanded"],["hidden","","type","file","id","local_channel","accept","image/*",3,"change"],["hidden","","type","file","accept","*","multiple","",3,"id","change"],["style","display: inline-block;",4,"ngFor","ngForOf"],["slot","end","name","eye-outline",1,"top_icon",3,"click"],["slot","end","name","eye-off-outline",1,"top_icon",3,"click"],["button","",3,"disabled","click"],[3,"click",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[3,"click"],["style","text-align: center; font-size: 16px; padding-top: 8px;",4,"ngIf"],["class","message_form",4,"ngIf"],["class","quickShare_form",3,"click",4,"ngIf"],["class","file_message_form",4,"ngIf"],["class","notice_form",4,"ngIf"],["class","message_content_form",4,"ngIf"],["class","read_last_here",4,"ngIf"],[2,"text-align","center","font-size","16px","padding-top","8px"],["color","#888"],[1,"message_form"],[1,"message_span_form",3,"click"],[3,"color"],[1,"time_form"],[1,"quickShare_form",3,"click"],[1,"file_message_form"],["class","file_button",3,"style","click",4,"ngIf"],["class","file_name_form",3,"click",4,"ngIf"],["class","transfer_count",4,"ngIf"],[1,"file_button",3,"click"],[1,"file_info"],["class","text_seperator",4,"ngIf"],["class","file_info file_text_thumbnail",4,"ngFor","ngForOf"],[1,"text_seperator"],[1,"file_info","file_text_thumbnail"],[1,"file_name_form",3,"click"],[1,"file_thumbnail",3,"src","alt"],[1,"transfer_count"],[1,"notice_form"],[1,"notice"],[1,"message_content_form"],["style","color: #888; font-size: 12px;",4,"ngIf"],[3,"style","click",4,"ngIf"],["target","_system",3,"href","click",4,"ngIf"],["target","_system",3,"href","click"],[2,"color","#888","font-size","12px"],[1,"read_last_here"],["class","file_button",3,"style",4,"ngIf"],["class","file_name_form",4,"ngIf"],[1,"file_button"],[1,"file_name_form"],["class","comp_local_content",3,"click",4,"ngIf"],["class","comp_local_content","target","_system",3,"href","click",4,"ngIf"],[1,"comp_local_content",3,"click"],["target","_system",1,"comp_local_content",3,"href","click"],[1,"disconnect_info"],["color","medium","name","cloud-offline-outline",2,"width","60px","height","60px"],["color","medium"],[1,"thumnail_parts",3,"click"],[2,"padding","8px","text-align","center"],[1,"thumnail_parts"],[3,"click",4,"ngIf"],[2,"text-align","center","margin-top","4px","max-width","100vw"],["style","display: grid;","class","thumnail_parts",4,"ngIf"],["id","ChatroomSelectedImage","class","image_thumbnail",3,"src","alt",4,"ngIf"],["id","ChatroomSelectedImage",1,"image_thumbnail",3,"src","alt"],[1,"thumnail_parts",2,"display","grid"],[2,"text-align","center","padding","4px 0px"],[1,"bottom_thumbnail"],["fill","clear","expand","block",3,"click"],["name","mic-outline"],[2,"display","inline-block"],[1,"ext_button",3,"hidden","click"],["slot","icon-only","style","width: 36px; height: 36px;",3,"name",4,"ngIf"],["class","ext_icon_img",3,"src","alt",4,"ngIf"],["slot","icon-only",2,"width","36px","height","36px",3,"name"],[1,"ext_icon_img",3,"src","alt"]],template:function(e,i){1&e&&(t.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),t.OEk(3),t.C$Y(),t.I0R(4,"ion-buttons",1),t.wR5(5,"ion-back-button",2),t.C$Y(),t.yuY(6,oe,1,0,"ion-icon",3)(7,le,1,0,"ion-icon",4),t.wR5(8,"div",5),t.C$Y()(),t.I0R(9,"ion-content"),t.wR5(10,"div",6),t.I0R(11,"table",7)(12,"tr",8)(13,"td",9)(14,"div",10),t.yuY(15,Ae,6,4,"div",11)(16,Ue,6,1,"div",12),t.C$Y(),t.I0R(17,"table",13),t.yuY(18,Ye,4,1,"tr",14)(19,Ne,3,1,"tr",15)(20,We,3,1,"tr",14)(21,Ze,6,4,"tr",14),t.C$Y()()(),t.I0R(22,"tr")(23,"td")(24,"div")(25,"table",16)(26,"tr")(27,"td")(28,"ion-button",17),t.qCj("click",function(){return i.open_ext_with_delay()}),t.wR5(29,"ion-icon",18),t.C$Y()(),t.I0R(30,"td",19)(31,"textarea",20),t.iHE("ngModelChange",function(l){return t.kNx(i.userInput.text,l)||(i.userInput.text=l),l}),t.qCj("keyup",function(l){return i.check_key(l)})("keydown",function(l){return i.check_key(l)})("click",function(){return i.make_ext_hidden()}),t.C$Y()(),t.yuY(32,et,3,0,"td",11),t.I0R(33,"td")(34,"ion-button",21),t.qCj("click",function(){return i.send(!1)}),t.wR5(35,"ion-icon",22),t.C$Y()()()()()()(),t.I0R(36,"tr",23)(37,"td")(38,"div",24)(39,"input",25),t.qCj("change",function(l){return i.LocalChannelImageChanged(l)}),t.C$Y(),t.I0R(40,"input",26),t.qCj("change",function(l){return i.inputFileSelected(l)}),t.C$Y(),t.yuY(41,nt,4,5,"div",27),t.C$Y()()()()()),2&e&&(t.yG2(3),t.cNF(i.info.title||i.lang.text.ChatRoom.noname_chatroom),t.yG2(3),t.E7m("ngIf",!i.info.HideAutoThumbnail),t.yG2(),t.E7m("ngIf",i.info.HideAutoThumbnail),t.yG2(),t.m_g("background-color: "+i.statusBar.colors[i.info.status||"offline"]),t.yG2(7),t.E7m("ngIf",!i.isOfflineClosedGroup),t.yG2(),t.E7m("ngIf",i.isOfflineClosedGroup),t.yG2(2),t.E7m("ngIf",i.userInput.quickShare),t.yG2(),t.E7m("ngIf",i.userInput.file),t.yG2(),t.E7m("ngIf",i.ShowGoToBottom&&!i.last_message_viewer.user_id),t.yG2(),t.E7m("ngIf",i.last_message_viewer.user_id),t.yG2(7),t.E7m("disabled","offline"==((i.info.status?i.info.status:i.info.info.status)||"offline")),t.yG2(3),t.E7m("id",i.ChannelUserInputId),t.OKB("ngModel",i.userInput.text),t.E7m("placeholder",i.inputPlaceholder),t.yG2(),t.E7m("ngIf",i.isMobile),t.yG2(2),t.E7m("disabled",!i.info.status||"missing"==i.info.status||"offline"==i.info.status),t.yG2(2),t.E7m("hidden",i.isHidden),t.yG2(4),t.E7m("id",i.file_sel_id),t.yG2(),t.E7m("ngForOf",i.extended_buttons))},dependencies:[V.ay,V.u_,n.ot,n.ue,n._G,G.sn,G.GS,G._i,G.wB,G.Ko,G.Yb,G.QR,G.tM,G.Md,G.Im],styles:[".top_icon[_ngcontent-%COMP%]{width:28px;height:28px;padding-right:68px;cursor:pointer}.main[_ngcontent-%COMP%]{width:100%;height:100%;padding:8px;overflow-x:hidden;overflow-y:auto;scroll-behavior:smooth}.message_form[_ngcontent-%COMP%]{margin:8px 0 0}.message_span_form[_ngcontent-%COMP%]{margin-right:8px}.time_form[_ngcontent-%COMP%]{font-size:12px;color:#888}.file_message_form[_ngcontent-%COMP%]{display:flex}.file_name_form[_ngcontent-%COMP%]{margin-top:4px;max-width:192px;max-height:192px}.file_thumbnail[_ngcontent-%COMP%]{max-width:192px;max-height:192px;width:auto;height:auto;border-radius:8px}.file_info[_ngcontent-%COMP%]{margin:0 4px}.file_text_thumbnail[_ngcontent-%COMP%]{margin-top:2px;display:grid}.quickShare_form[_ngcontent-%COMP%]{border-radius:16px;max-width:156px;width:-moz-fit-content;width:fit-content;height:-moz-fit-content;height:fit-content;padding:8px;margin:8px 0;text-align:center;vertical-align:middle;word-break:keep-all;overflow:hidden;background-color:var(--chatroom-you-read-here-backgruond)}.message_content_form[_ngcontent-%COMP%]{margin:4px 0 0}.comp_local_content[_ngcontent-%COMP%]{color:#888}.text_seperator[_ngcontent-%COMP%]{background-color:#fff;margin-top:2px;position:relative;width:100%;height:2px}.expanded[_ngcontent-%COMP%]{height:240px;overflow-x:hidden;overflow-y:auto;scroll-behavior:smooth;text-align:center;background-color:var(--chatroom-input-background)}.ext_button[_ngcontent-%COMP%]{width:64px;height:48px;margin:24px 12px 0;text-align:center}.ext_button_icon[_ngcontent-%COMP%]{width:72px;height:72px}.file_button[_ngcontent-%COMP%]{width:160px;height:112px;overflow:hidden;background-color:gray;margin-top:4px;border-radius:8px}#send_thumbnail[_ngcontent-%COMP%]{width:100%;max-width:100vw;height:-moz-fit-content;height:fit-content;max-height:160px;transform:translateY(-100%);position:relative;background:#bbbb;padding:8px;overflow:hidden}.bottom_thumbnail[_ngcontent-%COMP%]{width:100%;max-width:100vw;max-height:96px;overflow:hidden;padding:8px}.image_thumbnail[_ngcontent-%COMP%]{width:auto;max-height:96px;height:auto;object-fit:contain;display:block;margin:auto;padding:8px}.thumnails[_ngcontent-%COMP%]{width:100%;height:-moz-fit-content;height:fit-content;position:relative;transform:translateY(-100%);background:var(--chatroom-last-msg-viewer-bg);padding:8px}.thumnail_parts[_ngcontent-%COMP%]{max-height:96px;overflow-y:scroll;max-width:100vw}.transfer_count[_ngcontent-%COMP%]{align-self:flex-end;margin-left:4px}.notice_form[_ngcontent-%COMP%]{text-align:center;margin:12px}.notice[_ngcontent-%COMP%]{font-size:12px;display:inline;background:#444;border-radius:8px;padding:4px 8px;color:#fff}.read_last_here[_ngcontent-%COMP%]{text-align:center;font-size:12px;display:inherit;background:var(--chatroom-you-read-here-backgruond);margin:4px 0;color:var(--chatroom-you-read-here-text)}.ext_icon_img[_ngcontent-%COMP%]{max-width:36px;max-height:36px}.md[_ngcontent-%COMP%]   .TextAreaInput[_ngcontent-%COMP%]{width:100%;height:36px;max-height:156px;resize:none;padding:6px;margin-top:5px;border:0;overflow:hidden;background-color:var(--chatroom-input-background)}.ios[_ngcontent-%COMP%]   .TextAreaInput[_ngcontent-%COMP%]{width:100%;height:60px;max-height:156px;resize:none;padding:6px;margin-top:5px;border:0;overflow:hidden;background-color:var(--chatroom-input-background)}"]}),u})()},{path:"ionic-viewer",loadChildren:()=>_.e(3136).then(_.bind(_,3136)).then(o=>o.IonicViewerPageModule)},{path:"void-draw",loadChildren:()=>_.e(2454).then(_.bind(_,2454)).then(o=>o.VoidDrawPageModule)},{path:"quick-share-review",loadChildren:()=>_.e(8812).then(_.bind(_,8812)).then(o=>o.QuickShareReviewPageModule)}];let st=(()=>{var o;class u{}return(o=u).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.a4G({type:o}),o.\u0275inj=t.s3X({imports:[$.qQ.forChild(at),$.qQ]}),u})(),ot=(()=>{var o;class u{}return(o=u).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.a4G({type:o}),o.\u0275inj=t.s3X({imports:[V.MD,n.y,G.wZ,st]}),u})()},192:(Z,B,_)=>{_.d(B,{i:()=>q});var V=_(1528),n=_(4496),G=_(4500),$=_(9240),m=_(5624),L=_(7136),W=_(3824),ee=_(5020),A=_(1368),J=_(4716);function z(C,S){1&C&&n.wR5(0,"ion-icon",16)}function X(C,S){1&C&&n.wR5(0,"ion-icon",17)}function te(C,S){if(1&C){const p=n.KQA();n.I0R(0,"ion-accordion",7)(1,"ion-item",8),n.yuY(2,z,1,0,"ion-icon",9)(3,X,1,0,"ion-icon",10),n.I0R(4,"ion-label"),n.OEk(5),n.C$Y()(),n.I0R(6,"div",11)(7,"ion-item",4),n.qCj("click",function(){const R=n.usT(p).$implicit;return n.CGJ(R.grant=!R.grant)}),n.I0R(8,"ion-toggle",12),n.iHE("ngModelChange",function(f){const T=n.usT(p).$implicit;return n.kNx(T.grant,f)||(T.grant=f),n.CGJ(f)}),n.OEk(9),n.C$Y()(),n.I0R(10,"ion-item",13)(11,"ion-label"),n.OEk(12),n.C$Y(),n.I0R(13,"ion-label",14),n.OEk(14),n.C$Y()(),n.I0R(15,"ion-item",13)(16,"ion-label"),n.OEk(17),n.C$Y(),n.I0R(18,"ion-label",14),n.OEk(19),n.C$Y()(),n.I0R(20,"ion-item",13)(21,"ion-label"),n.OEk(22),n.C$Y(),n.I0R(23,"ion-label",14),n.OEk(24),n.C$Y()(),n.I0R(25,"ion-item",13)(26,"ion-toggle",15),n.iHE("ngModelChange",function(f){const T=n.usT(p).$implicit;return n.kNx(T.value.isSSL,f)||(T.value.isSSL=f),n.CGJ(f)}),n.OEk(27),n.C$Y()()()()}if(2&C){const p=S.$implicit,x=S.index,f=n.GaO(2);n.E7m("value",x),n.yG2(2),n.E7m("ngIf",!p.grant),n.yG2(),n.E7m("ngIf",p.grant),n.yG2(2),n.cNF(p.value.name),n.yG2(3),n.OKB("ngModel",p.grant),n.yG2(),n.cNF(f.lang.text.QuickShareReview.QuickShareGrant),n.yG2(3),n.cNF(f.lang.text.GroupServer.Address),n.yG2(2),n.cNF(p.value.address),n.yG2(3),n.cNF(f.lang.text.GroupServer.Port),n.yG2(2),n.cNF(p.value.port||7350),n.yG2(3),n.cNF(f.lang.text.GroupServer.Key),n.yG2(2),n.cNF(p.value.key||"defaultkey"),n.yG2(2),n.OKB("ngModel",p.value.isSSL),n.yG2(),n.cNF(f.lang.text.GroupServer.isSSL)}}function N(C,S){if(1&C&&(n.I0R(0,"div")(1,"ion-item-divider")(2,"ion-label"),n.OEk(3),n.C$Y()(),n.I0R(4,"ion-accordion-group"),n.yuY(5,te,28,14,"ion-accordion",6),n.C$Y()()),2&C){const p=n.GaO();n.yG2(3),n.cNF(p.lang.text.QuickShareReview.Servers),n.yG2(2),n.E7m("ngForOf",p.servers)}}function ie(C,S){1&C&&n.wR5(0,"ion-icon",16)}function P(C,S){1&C&&n.wR5(0,"ion-icon",17)}function U(C,S){if(1&C){const p=n.KQA();n.I0R(0,"ion-accordion",7)(1,"ion-item",8),n.yuY(2,ie,1,0,"ion-icon",9)(3,P,1,0,"ion-icon",10),n.I0R(4,"ion-label"),n.OEk(5),n.C$Y()(),n.I0R(6,"div",11)(7,"ion-item",4),n.qCj("click",function(){const R=n.usT(p).$implicit;return n.CGJ(R.grant=!R.grant)}),n.I0R(8,"ion-toggle",12),n.iHE("ngModelChange",function(f){const T=n.usT(p).$implicit;return n.kNx(T.grant,f)||(T.grant=f),n.CGJ(f)}),n.OEk(9),n.C$Y()()()()}if(2&C){const p=S.$implicit,x=S.index,f=n.GaO(2);n.E7m("value",x),n.yG2(2),n.E7m("ngIf",!p.grant),n.yG2(),n.E7m("ngIf",p.grant),n.yG2(2),n.cNF(p.name),n.yG2(3),n.OKB("ngModel",p.grant),n.yG2(),n.cNF(f.lang.text.QuickShareReview.QuickShareGrant)}}function E(C,S){if(1&C&&(n.I0R(0,"div")(1,"ion-item-divider")(2,"ion-label"),n.OEk(3),n.C$Y()(),n.I0R(4,"ion-accordion-group"),n.yuY(5,U,10,6,"ion-accordion",6),n.C$Y()()),2&C){const p=n.GaO();n.yG2(3),n.cNF(p.lang.text.QuickShareReview.Channels),n.yG2(2),n.E7m("ngForOf",p.groups)}}function I(C,S){1&C&&n.wR5(0,"ion-icon",16)}function y(C,S){1&C&&n.wR5(0,"ion-icon",17)}function O(C,S){if(1&C&&(n.I0R(0,"ion-item")(1,"ion-label"),n.OEk(2),n.C$Y()()),2&C){const p=S.$implicit;n.yG2(2),n.cNF(p)}}function D(C,S){if(1&C){const p=n.KQA();n.I0R(0,"ion-accordion",7)(1,"ion-item",8),n.yuY(2,I,1,0,"ion-icon",9)(3,y,1,0,"ion-icon",10),n.I0R(4,"ion-label"),n.OEk(5),n.C$Y()(),n.I0R(6,"div",11),n.yuY(7,O,3,1,"ion-item",18),n.I0R(8,"ion-item",4),n.qCj("click",function(){const R=n.usT(p).$implicit;return n.CGJ(R.grant=!R.grant)}),n.I0R(9,"ion-toggle",12),n.iHE("ngModelChange",function(f){const T=n.usT(p).$implicit;return n.kNx(T.grant,f)||(T.grant=f),n.CGJ(f)}),n.OEk(10),n.C$Y()()()()}if(2&C){const p=S.$implicit,x=S.index,f=n.GaO(2);n.E7m("value",x),n.yG2(2),n.E7m("ngIf",!p.grant),n.yG2(),n.E7m("ngIf",p.grant),n.yG2(2),n.cNF(p.value.urls[0]),n.yG2(2),n.E7m("ngForOf",p.value.urls),n.yG2(2),n.OKB("ngModel",p.grant),n.yG2(),n.cNF(f.lang.text.QuickShareReview.QuickShareGrant)}}function t(C,S){if(1&C&&(n.I0R(0,"div")(1,"ion-item-divider")(2,"ion-label"),n.OEk(3),n.C$Y()(),n.I0R(4,"ion-accordion-group"),n.yuY(5,D,11,7,"ion-accordion",6),n.C$Y()()),2&C){const p=n.GaO();n.yG2(3),n.cNF(p.lang.text.QuickShareReview.Channels),n.yG2(2),n.E7m("ngForOf",p.rtcserver)}}let q=(()=>{var C;class S{constructor(x,f,R,T,H,ne){this.lang=x,this.navParams=f,this.modalCtrl=R,this.nakama=T,this.p5toast=H,this.global=ne,this.servers=[],this.groups=[],this.rtcserver=[]}ngOnInit(){var x=this;return(0,V.c)(function*(){let f=x.navParams.get("data"),R=x.global.CatchGETs(f),T=yield x.nakama.AddressToQRCodeAct(R,!0);for(let H=0,ne=T.length;H<ne;H++)switch(T[H].type){case"server":x.servers.push(T[H]);break;case"group":x.groups.push(T[H]);break;case"rtcserver":x.rtcserver.push(T[H])}})()}apply_selected(){var x=this;return(0,V.c)(function*(){let f=[];for(let R=0,T=x.servers.length;R<T;R++)x.servers[R].grant&&f.push(x.servers[R]);for(let R=0,T=x.groups.length;R<T;R++)x.groups[R].grant&&f.push(x.groups[R]);for(let R=0,T=x.rtcserver.length;R<T;R++)x.rtcserver[R].grant&&f.push(x.rtcserver[R]);yield x.nakama.act_from_QRInfo(f),x.p5toast.show({text:x.lang.text.QuickQRShare.success_received,lateable:!0}),x.modalCtrl.dismiss()})()}}return(C=S).\u0275fac=function(x){return new(x||C)(n.GI1(G.o),n.GI1($.a6),n.GI1(m.qS),n.GI1(L.h),n.GI1(W.O),n.GI1(ee.A1))},C.\u0275cmp=n.In1({type:C,selectors:[["app-quick-share-review"]],decls:14,vars:5,consts:[[1,"ion-no-border"],["slot","start",3,"click"],["defaultHref",""],[4,"ngIf"],["button","",3,"click"],[1,"ion-text-center"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["slot","header"],["color","danger","slot","start","name","close-outline",4,"ngIf"],["color","success","slot","start","name","checkmark-outline",4,"ngIf"],["slot","content"],[1,"ion_toggle_ignore",3,"ngModel","ngModelChange"],["button",""],[1,"ion-text-end"],["disabled","",1,"ion_toggle_ignore",3,"ngModel","ngModelChange"],["color","danger","slot","start","name","close-outline"],["color","success","slot","start","name","checkmark-outline"],[4,"ngFor","ngForOf"]],template:function(x,f){1&x&&(n.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),n.OEk(3),n.C$Y(),n.I0R(4,"ion-buttons",1),n.qCj("click",function(){return f.modalCtrl.dismiss()}),n.wR5(5,"ion-back-button",2),n.C$Y()()(),n.I0R(6,"ion-content"),n.yuY(7,N,6,2,"div",3)(8,E,6,2,"div",3)(9,t,6,2,"div",3),n.C$Y(),n.I0R(10,"ion-footer")(11,"ion-item",4),n.qCj("click",function(){return f.apply_selected()}),n.I0R(12,"ion-label",5),n.OEk(13),n.C$Y()()()),2&x&&(n.yG2(3),n.cNF(f.lang.text.QuickShareReview.Title),n.yG2(4),n.E7m("ngIf",f.servers.length),n.yG2(),n.E7m("ngIf",f.groups.length),n.yG2(),n.E7m("ngIf",f.rtcserver.length),n.yG2(4),n.cNF(f.lang.text.QuickShareReview.ApplyChecked))},dependencies:[A.ay,A.u_,J.ue,J._G,m.cm,m.qU,m.GS,m._i,m.eV,m.wB,m.Ko,m.Yb,m.S8,m.QR,m.tM,m.E$,m.Md,m.UJ,m.Im],styles:[".ion_toggle_ignore[_ngcontent-%COMP%]{pointer-events:none}"]}),S})()}}]);