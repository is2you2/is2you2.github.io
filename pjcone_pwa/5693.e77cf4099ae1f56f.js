"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5693],{5693:(Pe,U,c)=>{c.r(U),c.d(U,{MainPageModule:()=>ue});var G=c(6814),te=c(95),j=c(1325),H=c(5877),B=c(5861),Z=c(6052),V=c(2156),ie=c(3641),X=c(9868),o=c(9468),oe=c(3857),se=c(9080),ae=c(7488),le=c(797),ne=c(7429);function re(d,b){1&d&&o._UZ(0,"ion-icon",7)}function de(d,b){1&d&&o._UZ(0,"ion-icon",8)}function ce(d,b){if(1&d){const S=o.EpF();o.TgZ(0,"div")(1,"div",9),o.NdJ("click",function(){o.CHM(S);const h=o.oxw();return o.KtG(h.nakama.open_add_todo_page())}),o._UZ(2,"ion-icon",10),o.TgZ(3,"div")(4,"ion-label",11),o._uU(5),o.qZA()()()()}if(2&d){const S=o.oxw();o.xp6(5),o.Oqu(S.lang.text.Main.NoTodo)}}const he=[{path:"",component:(()=>{var d;class b{constructor(a,h,e,r,n,E){this.global=a,this.lang=h,this.nakama=e,this.statusBar=r,this.indexed=n,this._webrtc=E,this.isPlayingCanvas={loop:!0},this.isEmptyTodo=!1}ngOnInit(){this.add_admob_banner()}add_admob_banner(){var a=this;return(0,B.Z)(function*(){V.TQ.addListener(V.Wp.SizeChanged,e=>{a.nakama.appMargin=e.height;const r=document.querySelector("ion-router-outlet");0===a.nakama.appMargin?r.style.marginBottom="":a.nakama.appMargin>0&&(r.style.marginBottom=a.nakama.appMargin+"px")});const h={adId:"ca-app-pub-6577630868247944/4829889344",adSize:V.ci.ADAPTIVE_BANNER,position:V.N4.BOTTOM_CENTER};try{if(a.nakama.isBannerShowing=!1,!(yield fetch(`${ie.Oy}pjcone_ads/admob.txt`)).ok)throw"\uc900\ube44\ub41c \uad11\uace0\uac00 \uc5c6\uc2b5\ub2c8\ub2e4";V.TQ.showBanner(h).then(()=>{a.nakama.isBannerShowing=!0})}catch(e){console.log(e)}})()}ionViewWillEnter(){var a=this;return(0,B.Z)(function*(){a.global.p5todo?a.global.p5todo.PlayCanvas():a.CreateTodoManager(),a.indexed.GetFileListFromDB("acts_local",h=>{h.forEach(e=>a.indexed.removeFileFromUserPath(e,void 0,a.indexed.godotDB))},a.indexed.godotDB)})()}toggleCanvasPlaying(){this.isPlayingCanvas.loop=!this.isPlayingCanvas.loop,this.isPlayingCanvas.loop?this.global.p5todo.loop():this.global.p5todo.noLoop()}CreateTodoManager(){var a=this;setTimeout(()=>{this.toggleCanvasPlaying()},3e3);let h=document.getElementById("todo");this.global.p5todo=new X(e=>{let u,D,r={},n=[],E=[],w=[],k=e.createVector(0,0),m=e.createVector(0,0),v=1,A=e.createVector(0,0),_=this.nakama,me=this.indexed,C=[],T=!1;e.setup=(0,B.Z)(function*(){e.createCanvas(h.clientWidth,h.clientHeight).parent(h),v=Number(localStorage.getItem("p5todoScale")),e.smooth(),e.noStroke(),e.pixelDensity(1),e.ellipseMode(e.CENTER),e.rectMode(e.CENTER),e.textAlign(e.CENTER,e.CENTER),e.textSize(20),e.textLeading(32),e.textWrap(e.CHAR),e.imageMode(e.CENTER),N(),e.isPlayingCanvas=a.isPlayingCanvas,e.StopCanvas=()=>{T=!0,a.isPlayingCanvas.loop||e.noLoop()},e.PlayCanvas=()=>{T=!1,e.windowResized(),a.isPlayingCanvas.loop&&e.loop()},e.add_todo=t=>{let i=JSON.parse(t);if(i.done){for(let l=0,g=n.length;l<g;l++)if(r[n[l]].json.id==i.id)return void r[n[l]].makeDone()}else r[i.id]=new Q(i);e.isPlayingCanvas.loop||(D=r[i.id],e.loop()),e.count_todo()},e.count_todo=()=>{n=Object.keys(r),a.isEmptyTodo=!n.length,a.isEmptyTodo||(r.AddButton?1==n.length&&r.AddButton.makeDone():(r.AddButton=new Q("",!0),n=Object.keys(r)))},e.remove_todo=t=>{let i=JSON.parse(t);for(let l=0,g=n.length;l<g;l++)if(r[n[l]].json.id==i.id){r[n[l]].RemoveTodo();break}a.isEmptyTodo=!Object.keys(n).length},e.ListUpdate=(0,B.Z)(function*(){r={},n.length=0;let t=yield a.indexed.GetFileListFromDB("todo/",void 0,a.indexed.godotDB);for(let i=0,l=t.length;i<l;i++)if(t[i].indexOf("/info.todo")>=0){let g=yield a.indexed.loadTextFromUserPath(t[i],void 0,a.indexed.godotDB);e.add_todo(g)}a.isEmptyTodo=!Object.keys(n).length}),yield e.ListUpdate()});let N=()=>{A.x=e.width/2,A.y=e.height/2,m.x=0,m.y=0,v=1,localStorage.setItem("p5todoScale",`${v}`),this.isPlayingCanvas.loop||e.redraw()};e.draw=()=>{e.clear(255,255,255,255),e.push(),e.translate(A),e.scale(v),e.translate(m);for(let s=0,t=n.length;s<t;s++)r[n[s]].display();for(let s=w.length-1;s>=0;s--)w[s].display(),w[s].lifeTime<0&&w.splice(s,1);for(let s=E.length-1;s>=0;s--)E[s].DoneAnim();e.pop()},e.windowResized=()=>{T||setTimeout(()=>{let s=m.x/e.width,t=m.y/e.height;e.resizeCanvas(h.clientWidth,h.clientHeight),A.x=e.width/2,A.y=e.height/2,m.x=s*e.width,m.y=t*e.height},50)};let I=!0;class Q{constructor(t,i=!1){this.isAddButton=!1,this.EllipseSize=96,this.Velocity=e.createVector(0,0),this.Accel=e.createVector(0,0),this.isGrabbed=!1,this.TextColor=e.color(Z.Yc?255:0),this.ProgressWeight=8,this.LifeTime=1,this.json=t;let l=e.max(e.width,e.height),g=e.createVector(l/e.min(1,v),0).setHeading(e.random(0,e.PI));if(i)return this.isAddButton=i,this.position=k.copy(),this.defaultColor=e.color("#bbb"),void(this.json={id:"AddButton",written:0,limit:1,longSide:53,shortSide:11});if(this.position=g,!this.json.custom_color)switch(this.json.importance){case"0":this.defaultColor=e.color("#58a192");break;case"1":this.defaultColor=e.color("#ddbb41");break;case"2":this.defaultColor=e.color("#ff754e")}let f=Number(this.json.importance);switch(f){case 0:this.EllipseSize=96;break;case 1:this.EllipseSize=104;break;case 2:this.EllipseSize=112}if(!C[f]){C[f]=e.createImage(this.EllipseSize,this.EllipseSize),C[f].loadPixels();let L=e.createVector(C[f].width/2,C[f].height/2);for(let M=0,F=C[f].height;M<F;M++)for(let Y=0,ye=C[f].width;Y<ye;Y++){let ve=e.createVector(Y,M);L.dist(ve)<this.EllipseSize/2-1&&C[f].set(Y,M,e.color(255,80))}C[f].updatePixels()}me.loadBlobFromUserPath(`todo/${this.json.id}/thumbnail.png`,"").then(L=>{let M=URL.createObjectURL(L);e.loadImage(M,F=>{this.ThumbnailImage=F,this.ThumbnailImage.mask(C[f]),URL.revokeObjectURL(M)})}).catch(L=>{})}display(){e.push(),this.isGrabbed||(this.CalcPosition(),this.OnCollider(),this.position=this.position.add(this.Velocity)),e.translate(this.position);let t=e.map(Date.now(),this.json.startFrom||this.json.written,this.json.limit,0,1,!0);(this.isAddButton||this.json.written>this.json.limit)&&(t=1),e.fill((this.json.custom_color||this.defaultColor.toString("#rrggbb"))+e.hex(e.floor(e.lerp(34,180,t)),2)),e.ellipse(0,0,this.EllipseSize,this.EllipseSize),this.ThumbnailImage&&e.image(this.ThumbnailImage,0,0,this.EllipseSize,this.EllipseSize),e.push(),e.noFill(),this.isAddButton?(e.push(),e.noStroke(),e.fill(255),e.rect(0,0,this.json.shortSide,this.json.longSide),e.rect(0,0,this.json.longSide,this.json.shortSide),e.pop()):(e.stroke(this.json.custom_color||this.defaultColor),e.strokeWeight(this.ProgressWeight)),e.rotate(-e.PI/2);let i=this.EllipseSize-this.ProgressWeight;e.arc(0,0,i,i,0,t*e.TWO_PI),e.pop();let l=.9*this.EllipseSize;e.fill(this.TextColor),e.text(this.json.title,0,0,l,l),e.pop()}CalcPosition(){let t=this.position.dist(k),i=e.map(t,0,this.EllipseSize/8,0,1,!0),l=e.map(i,this.EllipseSize/4,0,1,.95,!0);this.Accel.x=i,this.Accel.y=0;let g=this.position.heading()-e.PI;this.Accel=this.Accel.setHeading(g),this.Velocity.add(this.Accel).mult(l)}OnCollider(){for(let t=0,i=n.length;t<i;t++)if(r[n[t]]!=this){let l=r[n[t]],g=this.position.dist(l.position),f=this.EllipseSize/2+l.EllipseSize/2;g<f&&(e.isPlayingCanvas.loop||D==this&&(D=void 0,e.noLoop()),this.ReflectBounce(l,g/f),l.ReflectBounce(this,g/f))}}ReflectBounce(t,i){let l=X.Vector.sub(this.position,t.position);this.Velocity.add(l.mult(1-i)).mult(.85)}makeDone(){var t=this;return(0,B.Z)(function*(){t.LifeTime=1,yield new Promise(g=>setTimeout(g,500)),t.Velocity=k.copy(),t.Accel=k.copy(),t.OriginalEllipseSize=t.EllipseSize,t.OriginalProgWeight=t.ProgressWeight,t.json.done=!0,E.push(t),e.isPlayingCanvas.loop||e.loop()})()}DoneAnim(){var t=this;return(0,B.Z)(function*(){if(e.isPlayingCanvas.loop||e.loop(),t.LifeTime-=.04,t.EllipseSize=t.OriginalEllipseSize*t.LifeTime,t.ProgressWeight=t.OriginalProgWeight*t.LifeTime,t.LifeTime<.5&&w.push(new $(t.position,t.json.custom_color||t.defaultColor)),t.TextColor=e.color(Z.Yc?255:0,255*t.LifeTime),t.isAddButton&&(t.json.longSide*=t.LifeTime,t.json.shortSide*=t.LifeTime),t.LifeTime<0){e.isPlayingCanvas.loop||e.noLoop(),t.RemoveTodo(),e.count_todo();for(let i=0;i<20;i++)w.push(new $(t.position,t.json.custom_color||t.defaultColor))}})()}Clicked(){I&&!T&&!this.json.done&&(this.isAddButton?_.open_add_todo_page():_.open_add_todo_page(JSON.stringify(this.json)))}RemoveTodo(){for(let t=0,i=n.length;t<i;t++)if(n[t]==this.json.id){n.splice(t,1);break}for(let t=0,i=E.length;t<i;t++)if(E[t]=this){E.splice(t,1);break}delete r[this.json.id]}}class ${constructor(t,i){this.RectSize=4,this.rotate=0,this.pos=t.copy(),e.randomSeed(e.random(-255,255)),this.lifeTime=e.random(180,255),this.vel=e.createVector(e.random(-75,75),e.random(-40,-80)),this.acc=e.createVector(0,e.random(-1,-3)),e.push(),e.colorMode(e.HSB);let l=e.hue(i),g=e.saturation(i),f=e.brightness(i);this.color=e.color(e.random(l-20,l+20),e.random(g-20,g+20),e.random(f-20,f+20),this.lifeTime/255),e.pop(),this.RectSize=e.random(3,4),this.rotate=e.random(-e.PI,e.PI)}display(){this.color.setAlpha(this.lifeTime/255),e.fill(this.color),this.CalcPhysics(),e.push(),e.translate(this.pos),e.rotate(this.rotate),e.rect(0,0,this.RectSize,this.RectSize),e.pop(),this.lifeTime--}CalcPhysics(){this.acc.y+=.07,this.vel.add(this.acc),this.pos.add(this.vel.copy().div(100))}}let O,P,K,x,W=0;e.mousePressed=s=>{if(!T)switch(I=!0,s.which){case 1:P=e.createVector(e.mouseX,e.mouseY),x=m.copy(),O=e.createVector(e.mouseX,e.mouseY);for(let t=0,i=n.length;t<i;t++)if(r[n[t]].position.dist(p())<r[n[t]].EllipseSize/2){r[n[t]].isGrabbed=!0,u=r[n[t]],P=p();break}break;case 2:N()}},e.mouseDragged=s=>{if(!T&&1===(this.isPlayingCanvas.loop||e.redraw(),s.which)){O=e.createVector(e.mouseX,e.mouseY);let t=0;u?(u.position=p(),t=P.dist(p())):(m=x.copy().add(O.sub(P).div(v)),t=x.dist(m)),t>15&&(I=!1)}},e.mouseReleased=s=>{T||1!==s.which||(O=void 0,ee())};let p=(s,t)=>{let i=e.createVector(s||e.mouseX,t||e.mouseY);return i.sub(A),i.div(v),i.sub(m),i};e.mouseWheel=s=>{T||(this.isPlayingCanvas.loop||e.redraw(),fe(p()),v*=s.deltaY<0?1.1:.9,localStorage.setItem("p5todoScale",`${v}`))};let fe=s=>{A=e.createVector(e.mouseX,e.mouseY),m=s.mult(-1)},y=[],z=!1;const R=56;e.touchStarted=s=>{if(!T)switch(y=s.touches,z=!0,y.length){case 1:q();break;case 2:let t=e.createVector(y[0].clientX,y[0].clientY-R),i=e.createVector(y[1].clientX,y[1].clientY-R);W=t.dist(i),P=t.copy().add(i).div(2),x=m.copy(),K=v,u&&(u.isGrabbed=!1,u.Velocity=k.copy(),u.Accel=k.copy(),u=void 0);break;default:z=!1,N()}},e.touchMoved=s=>{if(!T){switch(this.isPlayingCanvas.loop||e.redraw(),y=s.touches,y.length){case 1:{if(!z)return;let t=s.changedTouches[0],i=e.createVector(t.clientX,t.clientY-R),l=0;u?(u.position=p(),l=P.dist(p(i.x,i.y))):(m=x.copy().add(i.sub(P).div(v)),l=x.dist(m)),l>15&&(I=!1)}break;case 2:{if(!z)return;let t=e.createVector(y[0].clientX,y[0].clientY-R),i=e.createVector(y[1].clientX,y[1].clientY-R),l=t.copy().add(i).div(2);v=t.dist(i)/W*K,localStorage.setItem("p5todoScale",`${v}`),m=x.copy().add(l.sub(P).div(v))}}return!1}},e.touchEnded=s=>{if(!T)switch(y=s.touches,y.length){case 0:ee(),z=!1;break;case 1:if(!z)return;q(),W=0}};let q=()=>{P=e.createVector(y[0].clientX,y[0].clientY-R),x=m.copy();for(let s=0,t=n.length;s<t;s++)if(r[n[s]].position.dist(p(P.x,P.y))<r[n[s]].EllipseSize/2){r[n[s]].isGrabbed=!0,u=r[n[s]];break}},ee=()=>{if(u){let t=u.EllipseSize;u.isGrabbed=!1,u.Velocity=k.copy(),u.Accel=k.copy(),t=u.position.dist(P),u=void 0}if(P=void 0,x.dist(m)<15)for(let t=0,i=n.length;t<i;t++)if(r[n[t]].position.dist(p())<r[n[t]].EllipseSize/2){r[n[t]].Clicked();break}}})}ionViewDidEnter(){this.nakama.resumeBanner(),this.try_add_shortcut()}try_add_shortcut(){this.global.p5key&&this.global.p5key.KeyShortCut?this.global.p5key.KeyShortCut.AddAct=()=>{this.nakama.open_add_todo_page()}:setTimeout(()=>{this.try_add_shortcut()},100)}ionViewWillLeave(){this.global.p5todo.StopCanvas(),delete this.global.p5key.KeyShortCut.AddAct}}return(d=b).\u0275fac=function(a){return new(a||d)(o.Y36(Z.AN),o.Y36(oe.b),o.Y36(se.a),o.Y36(ae.g),o.Y36(le.H),o.Y36(ne.V))},d.\u0275cmp=o.Xpm({type:d,selectors:[["app-main"]],decls:11,vars:6,consts:[[1,"ion-no-border"],[2,"position","absolute","right","68px","top","16px",3,"click"],["button","","style","width: 24px; height: 24px; ","name","play-circle",4,"ngIf"],["button","","style","width: 24px; height: 24px; ","name","pause-circle",4,"ngIf"],[1,"header_online_circle",3,"click"],[4,"ngIf"],["id","todo",1,"full_screen",2,"display","flex"],["button","","name","play-circle",2,"width","24px","height","24px"],["button","","name","pause-circle",2,"width","24px","height","24px"],[1,"disconnect_info",3,"click"],["color","medium","name","create-outline",2,"width","60px","height","60px"],["color","medium"]],template:function(a,h){1&a&&(o.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),o._uU(3),o.qZA(),o.TgZ(4,"div",1),o.NdJ("click",function(){return h.toggleCanvasPlaying()}),o.YNc(5,re,1,0,"ion-icon",2),o.YNc(6,de,1,0,"ion-icon",3),o.qZA(),o.TgZ(7,"div",4),o.NdJ("click",function(){return h.nakama.toggle_all_session()}),o.qZA()()(),o.TgZ(8,"ion-content"),o.YNc(9,ce,6,1,"div",5),o._UZ(10,"div",6),o.qZA()),2&a&&(o.xp6(3),o.Oqu(h.lang.text.Main.Title),o.xp6(2),o.Q6J("ngIf",!h.isPlayingCanvas.loop),o.xp6(1),o.Q6J("ngIf",h.isPlayingCanvas.loop),o.xp6(1),o.Akn("background-color: "+h.statusBar.colors[h.statusBar.settings.groupServer]),o.xp6(2),o.Q6J("ngIf",h.isEmptyTodo))},dependencies:[G.O5,j.W2,j.Gu,j.gu,j.Q$,j.wd,j.sr],styles:[".disconnect_info[_ngcontent-%COMP%]{text-align:center;position:absolute;top:50%;left:50%;transform:translate(-50%) translateY(-50%)}"]}),b})()},{path:"add-todo-menu",loadChildren:()=>Promise.all([c.e(9745),c.e(542),c.e(2058)]).then(c.bind(c,2058)).then(d=>d.AddTodoMenuPageModule)}];let ge=(()=>{var d;class b{}return(d=b).\u0275fac=function(a){return new(a||d)},d.\u0275mod=o.oAB({type:d}),d.\u0275inj=o.cJS({imports:[H.Bz.forChild(he),H.Bz]}),b})(),ue=(()=>{var d;class b{}return(d=b).\u0275fac=function(a){return new(a||d)},d.\u0275mod=o.oAB({type:d}),d.\u0275inj=o.cJS({imports:[G.ez,te.u5,j.Pc,ge]}),b})()}}]);