"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5929],{9373:(j,A,h)=>{h.d(A,{I:()=>o});const o=(0,h(6400).C_)("SpeechRecognition",{web:()=>h.e(7384).then(h.bind(h,7384)).then(M=>new M.SpeechRecognitionWeb)})},8828:(j,A,h)=>{h.d(A,{_8:()=>S,on:()=>M,wd:()=>o});var S=function(P){return P.Prompt="PROMPT",P.Camera="CAMERA",P.Photos="PHOTOS",P}(S||{}),o=function(P){return P.Rear="REAR",P.Front="FRONT",P}(o||{}),M=function(P){return P.Uri="uri",P.Base64="base64",P.DataUrl="dataUrl",P}(M||{})},4120:(j,A,h)=>{h.d(A,{Ut:()=>M,_8:()=>o._8,on:()=>o.on});var S=h(6400),o=h(8828);const M=(0,S.C_)("Camera",{web:()=>h.e(9028).then(h.bind(h,9028)).then(P=>new P.CameraWeb)})},5929:(j,A,h)=>{h.r(A),h.d(A,{ChatRoomPageModule:()=>kt});var S=h(1368),o=h(4716),M=h(5624),P=h(3332),m=h(1528),q=h(4708),Q=h(9352),X=h(4428),E=h(5193),U=h(8744),N=h(1052),J=h(5020),Z=h(6756),H=h(4120),ee=h(340),te=h(192),z=h(2272);const W=(0,h(6400).C_)("TextToSpeech",{web:()=>h.e(2728).then(h.bind(h,2728)).then(s=>new s.TextToSpeechWeb)});"speechSynthesis"in window&&window;var ne=h(9373),Y=h(4712),e=h(4496),ae=h(9240),se=h(7136),y=h(6819),$=h(4180),v=h(4668),x=h(4500),p=h(4476),b=h(8696),k=h(3824),D=h(7756);function K(s,_){if(1&s){const a=e.KQA();e.I0R(0,"ion-icon",33),e.qCj("click",function(){e.usT(a);const t=e.GaO();return e.CGJ(t.toggle_thumbnail())}),e.C$Y()}}function le(s,_){if(1&s){const a=e.KQA();e.I0R(0,"ion-icon",34),e.qCj("click",function(){e.usT(a);const t=e.GaO();return e.CGJ(t.toggle_thumbnail())}),e.C$Y()}}function re(s,_){if(1&s){const a=e.KQA();e.I0R(0,"div",46),e.qCj("click",function(){e.usT(a);const t=e.GaO(3);return e.CGJ(t.SetOtherAct())}),e.I0R(1,"font",47),e.OEk(2),e.C$Y()()}if(2&s){const a=e.GaO(2).$implicit;e.yG2(2),e.oRS(" ",a.displayDate," ")}}function ce(s,_){if(1&s){const a=e.KQA();e.I0R(0,"div",48),e.qCj("click",function(){e.usT(a);const t=e.GaO(2).$implicit,n=e.GaO();return e.CGJ(n.user_detail(t))}),e.wR5(1,"img",49),e.C$Y()}if(2&s){const a=e.GaO(2).$implicit,i=e.GaO();e.yG2(),e.m_g(i.nakama.users[i.isOfficial][i.target][a.sender_id].online?"filter: grayscale(0) contrast(1);":"filter: grayscale(.9) contrast(1.4);"),e.E7m("src",i.users_image[a.sender_id]||"assets/data/avatar.svg",e.K6U)}}function _e(s,_){if(1&s){const a=e.KQA();e.I0R(0,"div",50)(1,"span",51),e.qCj("click",function(){e.usT(a);const t=e.GaO(2).$implicit,n=e.GaO();return e.CGJ(n.user_detail(t))}),e.I0R(2,"b")(3,"font",52),e.OEk(4),e.C$Y()()(),e.I0R(5,"span",53),e.qCj("click",function(){e.usT(a);const t=e.GaO(3);return e.CGJ(t.SetOtherAct())}),e.OEk(6),e.C$Y()()}if(2&s){const a=e.GaO(2).$implicit,i=e.GaO();e.yG2(3),e.CI5("color","#",i.nakama.users[i.isOfficial][i.target][a.sender_id].online?a.color:"888",""),e.yG2(),e.oRS(" ",a.user_display_name||i.lang.text.Profile.noname_user,""),e.yG2(2),e.cNF(a.msgTime)}}function de(s,_){if(1&s){const a=e.KQA();e.I0R(0,"div",54),e.qCj("click",function(){e.usT(a);const t=e.GaO(2).$implicit,n=e.GaO();return e.CGJ(n.quickShare_act(t))}),e.OEk(1),e.C$Y()}if(2&s){const a=e.GaO(3);e.yG2(),e.oRS(" ",a.lang.text.ChatRoom.QuickShare," ")}}function ue(s,_){if(1&s){const a=e.KQA();e.I0R(0,"div",54),e.qCj("click",function(){e.usT(a);const t=e.GaO(2).$implicit,n=e.GaO();return e.CGJ(n.JoinWebRTCMatch(t))}),e.OEk(1),e.C$Y()}if(2&s){const a=e.GaO(3);e.yG2(),e.oRS(" ",a.lang.text.ChatRoom.JoinWebRTCMatch," ")}}function he(s,_){1&s&&e.wR5(0,"div",63)}function me(s,_){if(1&s&&(e.I0R(0,"span",64),e.OEk(1),e.C$Y()),2&s){const a=_.$implicit;e.yG2(),e.oRS(" ",a," ")}}function ge(s,_){if(1&s){const a=e.KQA();e.I0R(0,"div",59),e.qCj("click",function(){e.usT(a);const t=e.GaO(3).$implicit,n=e.GaO();return e.CGJ(n.file_detail(t))}),e.I0R(1,"p",60),e.OEk(2),e.C$Y(),e.yuY(3,he,1,0,"div",61)(4,me,2,1,"span",62),e.C$Y()}if(2&s){const a=e.GaO(3).$implicit,i=e.GaO();e.m_g(i.info.HideAutoThumbnail?"filter: blur(6px);":""),e.yG2(2),e.oRS(" ",a.content.filename," "),e.yG2(),e.E7m("ngIf",a.content.text),e.yG2(),e.E7m("ngForOf",a.content.text)}}function fe(s,_){if(1&s){const a=e.KQA();e.I0R(0,"div",65),e.qCj("click",function(){e.usT(a);const t=e.GaO(3).$implicit,n=e.GaO();return e.CGJ(n.file_detail(t))}),e.wR5(1,"img",66),e.C$Y()}if(2&s){const a=e.GaO(3).$implicit,i=e.GaO();e.yG2(),e.m_g(i.info.HideAutoThumbnail?"filter: blur(6px);":""),e.E7m("src",a.content.thumbnail,e.K6U)("alt",a.content.filename)}}function pe(s,_){if(1&s&&(e.I0R(0,"div",67),e.OEk(1),e.C$Y()),2&s){const a=e.GaO(3).$implicit;e.yG2(),e.oRS(" ",a.content.transfer_index.index,"")}}function ve(s,_){if(1&s&&(e.I0R(0,"div",55),e.yuY(1,ge,5,5,"div",56)(2,fe,2,4,"div",57)(3,pe,2,1,"div",58),e.C$Y()),2&s){const a=e.GaO(2).$implicit;e.yG2(),e.E7m("ngIf",!a.content.thumbnail),e.yG2(),e.E7m("ngIf",a.content.thumbnail),e.yG2(),e.E7m("ngIf",a.content.transfer_index)}}function xe(s,_){if(1&s){const a=e.KQA();e.I0R(0,"span",76),e.qCj("click",function(){e.usT(a);const t=e.GaO(6);return e.CGJ(t.SetOtherAct())}),e.OEk(1),e.C$Y()}if(2&s){const a=e.GaO().$implicit;e.m_g("font-size: "+(a.size||16)+"px"),e.yG2(),e.oRS(" ",a.text," ")}}function Ce(s,_){if(1&s){const a=e.KQA();e.I0R(0,"a",77),e.qCj("click",function(){e.usT(a);const t=e.GaO().$implicit,n=e.GaO(5);return e.CGJ(n.open_url_link(t.text))}),e.OEk(1),e.C$Y()}if(2&s){const a=e.GaO().$implicit;e.E7m("href",a.text,e.K6U),e.yG2(),e.cNF(a.text)}}function ye(s,_){if(1&s&&(e.I0R(0,"span"),e.yuY(1,xe,2,3,"span",74)(2,Ce,2,2,"a",75),e.C$Y()),2&s){const a=_.$implicit;e.yG2(),e.E7m("ngIf",!a.href),e.yG2(),e.E7m("ngIf",a.href)}}function be(s,_){if(1&s&&(e.I0R(0,"div",72)(1,"span"),e.yuY(2,ye,3,2,"span",73),e.C$Y()()),2&s){const a=_.$implicit;e.yG2(2),e.E7m("ngForOf",a)}}function Ie(s,_){if(1&s&&(e.I0R(0,"div",78),e.OEk(1),e.C$Y()),2&s){const a=e.GaO(4);e.yG2(),e.oRS(" ","("+a.lang.text.ChatRoom.MsgEdited+")","")}}function Re(s,_){if(1&s&&(e.I0R(0,"div",68)(1,"div",69),e.yuY(2,be,3,1,"div",70),e.C$Y(),e.yuY(3,Ie,2,1,"div",71),e.C$Y()),2&s){const a=e.GaO(2).$implicit;e.yG2(),e.m_g("background-color: #"+a.color+"88"),e.yG2(),e.E7m("ngForOf",a.content.msg),e.yG2(),e.E7m("ngIf",a.content.edited)}}function ke(s,_){if(1&s&&(e.I0R(0,"div",79),e.OEk(1),e.C$Y()),2&s){const a=e.GaO(3);e.yG2(),e.oRS(" ",a.lang.text.ChatRoom.YouReadHereLast,"")}}function we(s,_){if(1&s&&(e.I0R(0,"div"),e.yuY(1,re,3,1,"div",38),e.I0R(2,"table")(3,"tr")(4,"td",39),e.yuY(5,ce,2,3,"div",40),e.C$Y(),e.I0R(6,"td"),e.yuY(7,_e,7,3,"div",41)(8,de,2,1,"div",42)(9,ue,2,1,"div",42)(10,ve,4,3,"div",43)(11,Re,4,4,"div",44),e.C$Y()()(),e.yuY(12,ke,2,1,"div",45),e.C$Y()),2&s){const a=e.GaO().$implicit;e.yG2(),e.E7m("ngIf",a.showInfo&&a.showInfo.date),e.yG2(4),e.E7m("ngIf",a.showInfo&&a.showInfo.sender),e.yG2(2),e.E7m("ngIf",a.showInfo&&a.showInfo.sender),e.yG2(),e.E7m("ngIf",a.content.quickShare),e.yG2(),e.E7m("ngIf",a.content.match),e.yG2(),e.E7m("ngIf",a.content.filename),e.yG2(),e.E7m("ngIf",a.content.msg),e.yG2(),e.E7m("ngIf",a.isLastRead)}}function Oe(s,_){if(1&s){const a=e.KQA();e.I0R(0,"div",46),e.qCj("click",function(){e.usT(a);const t=e.GaO(3);return e.CGJ(t.SetOtherAct())}),e.I0R(1,"font",47),e.OEk(2),e.C$Y()()}if(2&s){const a=e.GaO(2).$implicit;e.yG2(2),e.oRS(" ",a.displayDate," ")}}function Te(s,_){if(1&s){const a=e.KQA();e.I0R(0,"div",50)(1,"span",87),e.qCj("click",function(){e.usT(a);const t=e.GaO(3);return e.CGJ(t.SetOtherAct())}),e.OEk(2),e.C$Y(),e.I0R(3,"span",51),e.qCj("click",function(){e.usT(a);const t=e.GaO(2).$implicit,n=e.GaO();return e.CGJ(n.user_detail(t))}),e.I0R(4,"b")(5,"font",52),e.OEk(6),e.C$Y()()()()}if(2&s){const a=e.GaO(2).$implicit,i=e.GaO();e.yG2(2),e.cNF(a.msgTime),e.yG2(3),e.CI5("color","#",i.nakama.users.self.online?a.color:"888",""),e.yG2(),e.oRS(" ",a.user_display_name||i.lang.text.Profile.noname_user,"")}}function Ge(s,_){if(1&s){const a=e.KQA();e.I0R(0,"div",88),e.qCj("click",function(){e.usT(a);const t=e.GaO(2).$implicit,n=e.GaO();return e.CGJ(n.quickShare_act(t))}),e.I0R(1,"div",89),e.OEk(2),e.C$Y()()}if(2&s){const a=e.GaO(3);e.yG2(2),e.oRS(" ",a.lang.text.ChatRoom.QuickShare," ")}}function $e(s,_){if(1&s){const a=e.KQA();e.I0R(0,"div",88),e.qCj("click",function(){e.usT(a);const t=e.GaO(2).$implicit,n=e.GaO();return e.CGJ(n.JoinWebRTCMatch(t))}),e.I0R(1,"div",89),e.OEk(2),e.C$Y()()}if(2&s){const a=e.GaO(3);e.yG2(2),e.oRS(" ",a.lang.text.ChatRoom.JoinWebRTCMatch," ")}}function Me(s,_){1&s&&e.wR5(0,"div",63)}function Pe(s,_){if(1&s&&(e.I0R(0,"span",64),e.OEk(1),e.C$Y()),2&s){const a=_.$implicit;e.yG2(),e.oRS(" ",a," ")}}function Se(s,_){if(1&s){const a=e.KQA();e.I0R(0,"div",59),e.qCj("click",function(){e.usT(a);const t=e.GaO(3).$implicit,n=e.GaO();return e.CGJ(n.file_detail(t))}),e.I0R(1,"p",60),e.OEk(2),e.C$Y(),e.yuY(3,Me,1,0,"div",61)(4,Pe,2,1,"span",62),e.C$Y()}if(2&s){const a=e.GaO(3).$implicit,i=e.GaO();e.m_g(i.info.HideAutoThumbnail?"filter: blur(6px);":""),e.yG2(2),e.oRS(" ",a.content.filename," "),e.yG2(),e.E7m("ngIf",a.content.text),e.yG2(),e.E7m("ngForOf",a.content.text)}}function Ee(s,_){if(1&s){const a=e.KQA();e.I0R(0,"div",65),e.qCj("click",function(){e.usT(a);const t=e.GaO(3).$implicit,n=e.GaO();return e.CGJ(n.file_detail(t))}),e.wR5(1,"img",66),e.C$Y()}if(2&s){const a=e.GaO(3).$implicit,i=e.GaO();e.yG2(),e.m_g(i.info.HideAutoThumbnail?"filter: blur(6px);":""),e.E7m("src",a.content.thumbnail,e.K6U)("alt",a.content.filename)}}function Fe(s,_){if(1&s&&(e.I0R(0,"div",67),e.OEk(1),e.C$Y()),2&s){const a=e.GaO(3).$implicit;e.yG2(),e.oRS(" ",a.content.transfer_index.index,"")}}function Ve(s,_){if(1&s&&(e.I0R(0,"div",90),e.yuY(1,Se,5,5,"div",56)(2,Ee,2,4,"div",57)(3,Fe,2,1,"div",58),e.C$Y()),2&s){const a=e.GaO(2).$implicit;e.yG2(),e.E7m("ngIf",!a.content.thumbnail),e.yG2(),e.E7m("ngIf",a.content.thumbnail),e.yG2(),e.E7m("ngIf",a.content.transfer_index)}}function Ae(s,_){if(1&s&&(e.I0R(0,"div",78),e.OEk(1),e.C$Y()),2&s){const a=e.GaO(4);e.yG2(),e.oRS(" ","("+a.lang.text.ChatRoom.MsgEdited+")","")}}function De(s,_){if(1&s){const a=e.KQA();e.I0R(0,"span",76),e.qCj("click",function(){e.usT(a);const t=e.GaO(6);return e.CGJ(t.SetOtherAct())}),e.OEk(1),e.C$Y()}if(2&s){const a=e.GaO().$implicit;e.m_g("font-size: "+(a.size||16)+"px"),e.yG2(),e.oRS(" ",a.text," ")}}function Le(s,_){if(1&s){const a=e.KQA();e.I0R(0,"a",77),e.qCj("click",function(){e.usT(a);const t=e.GaO().$implicit,n=e.GaO(5);return e.CGJ(n.open_url_link(t.text))}),e.OEk(1),e.C$Y()}if(2&s){const a=e.GaO().$implicit;e.E7m("href",a.text,e.K6U),e.yG2(),e.cNF(a.text)}}function Ye(s,_){if(1&s&&(e.I0R(0,"span"),e.yuY(1,De,2,3,"span",74)(2,Le,2,2,"a",75),e.C$Y()),2&s){const a=_.$implicit;e.yG2(),e.E7m("ngIf",!a.href),e.yG2(),e.E7m("ngIf",a.href)}}function Be(s,_){if(1&s&&(e.I0R(0,"div",72)(1,"span"),e.yuY(2,Ye,3,2,"span",73),e.C$Y()()),2&s){const a=_.$implicit;e.yG2(2),e.E7m("ngForOf",a)}}function Ue(s,_){if(1&s&&(e.I0R(0,"div",91),e.yuY(1,Ae,2,1,"div",71),e.I0R(2,"div",69),e.yuY(3,Be,3,1,"div",70),e.C$Y()()),2&s){const a=e.GaO(2).$implicit;e.yG2(),e.E7m("ngIf",a.content.edited),e.yG2(),e.m_g("background-color: #"+a.color+"88"),e.yG2(),e.E7m("ngForOf",a.content.msg)}}function He(s,_){if(1&s){const a=e.KQA();e.I0R(0,"div",48),e.qCj("click",function(){e.usT(a);const t=e.GaO(2).$implicit,n=e.GaO();return e.CGJ(n.user_detail(t))}),e.wR5(1,"img",92),e.C$Y()}if(2&s){const a=e.GaO(3);e.yG2(),e.m_g(a.nakama.users.self.online?"filter: grayscale(0) contrast(1);":"filter: grayscale(.9) contrast(1.4);"),e.E7m("src",a.nakama.users.self.img||"assets/data/avatar.svg",e.K6U)}}function Ke(s,_){if(1&s){const a=e.KQA();e.I0R(0,"div",93),e.qCj("click",function(){e.usT(a);const t=e.GaO(3);return e.CGJ(t.SetOtherAct())}),e.OEk(1),e.C$Y()}if(2&s){const a=e.GaO(3);e.yG2(),e.oRS(" ",a.lang.text.ChatRoom.YouReadHereLast,"")}}function je(s,_){if(1&s&&(e.I0R(0,"div",80),e.yuY(1,Oe,3,1,"div",38),e.I0R(2,"table",81)(3,"tr")(4,"td"),e.yuY(5,Te,7,3,"div",41)(6,Ge,3,1,"div",82)(7,$e,3,1,"div",82)(8,Ve,4,3,"div",83)(9,Ue,4,4,"div",84),e.C$Y(),e.I0R(10,"td",85),e.yuY(11,He,2,3,"div",40),e.C$Y()()(),e.yuY(12,Ke,2,1,"div",86),e.C$Y()),2&s){const a=e.GaO().$implicit;e.yG2(),e.E7m("ngIf",a.showInfo&&a.showInfo.date),e.yG2(4),e.E7m("ngIf",a.showInfo&&a.showInfo.sender),e.yG2(),e.E7m("ngIf",a.content.quickShare),e.yG2(),e.E7m("ngIf",a.content.match),e.yG2(),e.E7m("ngIf",a.content.filename),e.yG2(),e.E7m("ngIf",a.content.msg),e.yG2(2),e.E7m("ngIf",a.showInfo&&a.showInfo.sender),e.yG2(),e.E7m("ngIf",a.isLastRead)}}function Qe(s,_){if(1&s){const a=e.KQA();e.I0R(0,"div",94),e.qCj("click",function(){e.usT(a);const t=e.GaO(2);return e.CGJ(t.SetOtherAct())}),e.I0R(1,"div",95),e.OEk(2),e.C$Y()()}if(2&s){const a=e.GaO().$implicit;e.yG2(2),e.oRS(" ",a.content.noti," ")}}function Ne(s,_){if(1&s&&(e.I0R(0,"div",35),e.yuY(1,we,13,8,"div",24)(2,je,13,8,"div",36)(3,Qe,3,1,"div",37),e.C$Y()),2&s){const a=_.$implicit;e.E7m("id",a.message_id),e.yG2(),e.E7m("ngIf",!a.is_me&&!a.content.noti),e.yG2(),e.E7m("ngIf",a.is_me&&!a.content.noti),e.yG2(),e.E7m("ngIf",a.content.noti)}}function Je(s,_){if(1&s){const a=e.KQA();e.I0R(0,"div",88),e.qCj("click",function(){e.usT(a);const t=e.GaO().$implicit,n=e.GaO();return e.CGJ(n.quickShare_act(t))}),e.I0R(1,"div",89),e.OEk(2),e.C$Y()()}if(2&s){const a=e.GaO(2);e.yG2(2),e.oRS(" ",a.lang.text.ChatRoom.QuickShare," ")}}function ze(s,_){1&s&&e.wR5(0,"div",63)}function We(s,_){if(1&s&&(e.I0R(0,"span",64),e.OEk(1),e.C$Y()),2&s){const a=_.$implicit;e.yG2(),e.oRS(" ",a," ")}}function qe(s,_){if(1&s&&(e.I0R(0,"div",99)(1,"p",60),e.OEk(2),e.C$Y(),e.yuY(3,ze,1,0,"div",61)(4,We,2,1,"span",62),e.C$Y()),2&s){const a=e.GaO(2).$implicit,i=e.GaO();e.m_g(i.info.HideAutoThumbnail?"filter: blur(6px);":""),e.yG2(2),e.oRS(" ",a.content.filename," "),e.yG2(),e.E7m("ngIf",a.content.text),e.yG2(),e.E7m("ngForOf",a.content.text)}}function Xe(s,_){if(1&s&&(e.I0R(0,"div",100),e.wR5(1,"img",66),e.C$Y()),2&s){const a=e.GaO(2).$implicit,i=e.GaO();e.yG2(),e.m_g(i.info.HideAutoThumbnail?"filter: blur(6px);":""),e.E7m("src",a.content.thumbnail,e.K6U)("alt",a.content.filename)}}function Ze(s,_){if(1&s&&(e.I0R(0,"div",90),e.yuY(1,qe,5,5,"div",97)(2,Xe,2,4,"div",98),e.C$Y()),2&s){const a=e.GaO().$implicit;e.yG2(),e.E7m("ngIf",!a.content.thumbnail),e.yG2(),e.E7m("ngIf",a.content.thumbnail)}}function et(s,_){if(1&s){const a=e.KQA();e.I0R(0,"span",104),e.qCj("click",function(){e.usT(a);const t=e.GaO(5);return e.CGJ(t.SetOtherAct())}),e.OEk(1),e.C$Y()}if(2&s){const a=e.GaO().$implicit;e.m_g("font-size: "+(a.size||16)+"px"),e.yG2(),e.oRS(" ",a.text," ")}}function tt(s,_){if(1&s){const a=e.KQA();e.I0R(0,"a",105),e.qCj("click",function(){e.usT(a);const t=e.GaO().$implicit,n=e.GaO(4);return e.CGJ(n.open_url_link(t.text))}),e.OEk(1),e.C$Y()}if(2&s){const a=e.GaO().$implicit;e.E7m("href",a.text,e.K6U),e.yG2(),e.cNF(a.text)}}function it(s,_){if(1&s&&(e.I0R(0,"span"),e.yuY(1,et,2,3,"span",102)(2,tt,2,2,"a",103),e.C$Y()),2&s){const a=_.$implicit;e.yG2(),e.E7m("ngIf",!a.href),e.yG2(),e.E7m("ngIf",a.href)}}function nt(s,_){if(1&s&&(e.I0R(0,"div",72)(1,"span"),e.yuY(2,it,3,2,"span",73),e.C$Y()()),2&s){const a=_.$implicit;e.yG2(2),e.E7m("ngForOf",a)}}function at(s,_){if(1&s&&(e.I0R(0,"div",91)(1,"div",101),e.yuY(2,nt,3,1,"div",70),e.C$Y()()),2&s){const a=e.GaO().$implicit;e.yG2(2),e.E7m("ngForOf",a.content.msg)}}function st(s,_){if(1&s&&(e.I0R(0,"div",96),e.yuY(1,Je,3,1,"div",82)(2,Ze,3,2,"div",83)(3,at,3,1,"div",84),e.C$Y()),2&s){const a=_.$implicit;e.yG2(),e.E7m("ngIf",a.content.quickShare),e.yG2(),e.E7m("ngIf",a.content.filename),e.yG2(),e.E7m("ngIf",a.content.msg)}}function ot(s,_){if(1&s){const a=e.KQA();e.I0R(0,"tr",106),e.qCj("click",function(){e.usT(a);const t=e.GaO();return e.CGJ(t.cancel_qrshare())}),e.I0R(1,"td",107)(2,"span"),e.OEk(3),e.C$Y()()()}if(2&s){const a=e.GaO();e.yG2(3),e.cNF(a.lang.text.Settings.quickQRshare)}}function lt(s,_){if(1&s&&e.wR5(0,"img",114),2&s){const a=e.GaO(4);e.E7m("src",a.userInput.file.thumbnail,e.K6U)("alt",a.userInput.file.name)}}function rt(s,_){if(1&s&&(e.I0R(0,"div"),e.yuY(1,lt,1,2,"img",113),e.C$Y()),2&s){const a=e.GaO(3);e.yG2(),e.E7m("ngIf","image"==a.userInput.file.typeheader)}}function ct(s,_){if(1&s&&(e.I0R(0,"span"),e.OEk(1),e.C$Y()),2&s){const a=_.$implicit;e.yG2(),e.oRS(" ",a," ")}}function _t(s,_){if(1&s&&(e.I0R(0,"div",115),e.yuY(1,ct,2,1,"span",73),e.C$Y()),2&s){const a=e.GaO(3);e.yG2(),e.E7m("ngForOf",a.userInput.file.thumbnail)}}function dt(s,_){if(1&s){const a=e.KQA();e.I0R(0,"div",110),e.qCj("click",function(){e.usT(a);const t=e.GaO(2);return e.CGJ(t.removeAttach())}),e.I0R(1,"div",111),e.OEk(2),e.C$Y(),e.yuY(3,rt,2,1,"div",24)(4,_t,2,1,"div",112),e.C$Y()}if(2&s){const a=e.GaO(2);e.yG2(2),e.oRS(" ",a.userInput.file.filename," "),e.yG2(),e.E7m("ngIf",a.userInput.file.thumbnail),e.yG2(),e.E7m("ngIf","text"==a.userInput.file.typeheader)}}function ut(s,_){if(1&s&&(e.I0R(0,"tr",108)(1,"td"),e.yuY(2,dt,5,3,"div",109),e.C$Y()()),2&s){const a=e.GaO();e.yG2(2),e.E7m("ngIf",a.userInput.file)}}function ht(s,_){if(1&s){const a=e.KQA();e.I0R(0,"tr",106),e.qCj("click",function(){e.usT(a);const t=e.GaO();return e.CGJ(t.init_chatroom())}),e.I0R(1,"td",116),e.OEk(2),e.C$Y()()}if(2&s){const a=e.GaO();e.yG2(2),e.cNF(a.lang.text.ChatRoom.GoToRecent)}}function mt(s,_){if(1&s){const a=e.KQA();e.I0R(0,"span",76),e.qCj("click",function(){e.usT(a);const t=e.GaO(4);return e.CGJ(t.SetOtherAct())}),e.OEk(1),e.C$Y()}if(2&s){const a=e.GaO().$implicit;e.yG2(),e.oRS(" ",a.text," ")}}function gt(s,_){if(1&s){const a=e.KQA();e.I0R(0,"a",77),e.qCj("click",function(){e.usT(a);const t=e.GaO().$implicit,n=e.GaO(3);return e.CGJ(n.open_url_link(t.text))}),e.OEk(1),e.C$Y()}if(2&s){const a=e.GaO().$implicit;e.E7m("href",a.text,e.K6U),e.yG2(),e.cNF(a.text)}}function ft(s,_){if(1&s&&(e.I0R(0,"span"),e.yuY(1,mt,2,1,"span",118)(2,gt,2,2,"a",75),e.C$Y()),2&s){const a=_.$implicit;e.yG2(),e.E7m("ngIf",!a.href),e.yG2(),e.E7m("ngIf",a.href)}}function pt(s,_){if(1&s&&(e.I0R(0,"span"),e.yuY(1,ft,3,2,"span",73),e.C$Y()),2&s){const a=_.$implicit;e.yG2(),e.E7m("ngForOf",a)}}function vt(s,_){if(1&s){const a=e.KQA();e.I0R(0,"tr",106),e.qCj("click",function(){e.usT(a);const t=e.GaO();return e.CGJ(t.init_chatroom())}),e.I0R(1,"td",117)(2,"span")(3,"b"),e.OEk(4),e.C$Y()(),e.yuY(5,pt,2,1,"span",73),e.C$Y()()}if(2&s){const a=e.GaO();e.yG2(2),e.m_g("margin-right: 8px; color: #"+a.last_message_viewer.color),e.yG2(2),e.cNF((a.last_message_viewer.is_me?a.nakama.users.self.display_name:a.nakama.users[a.isOfficial][a.target][a.last_message_viewer.user_id].display_name)||a.lang.text.Profile.noname_user),e.yG2(),e.E7m("ngForOf",a.last_message_viewer.message)}}function xt(s,_){if(1&s){const a=e.KQA();e.I0R(0,"td")(1,"ion-button",119),e.qCj("click",function(){e.usT(a);const t=e.GaO();return e.CGJ(t.GetSpeechToText())}),e.wR5(2,"ion-icon",120),e.C$Y()()}}function Ct(s,_){if(1&s&&e.wR5(0,"ion-icon",125),2&s){const a=e.GaO().$implicit;e.E7m("name",a.icon||"close-circle")}}function yt(s,_){if(1&s&&e.wR5(0,"img",126),2&s){const a=e.GaO().$implicit;e.E7m("src","assets/icon/"+a.icon_img,e.K6U)("alt",a.title)}}function bt(s,_){if(1&s){const a=e.KQA();e.I0R(0,"div",121)(1,"div",122),e.qCj("click",function(){const n=e.usT(a).$implicit;return e.CGJ(n.act())}),e.yuY(2,Ct,1,1,"ion-icon",123)(3,yt,1,2,"img",124),e.I0R(4,"div"),e.OEk(5),e.C$Y()()()}if(2&s){const a=_.$implicit;e.yG2(),e.m_g("cursor: "+(a.cursor||"pointer")+";"),e.E7m("hidden",a.isHide),e.yG2(),e.E7m("ngIf",a.icon),e.yG2(),e.E7m("ngIf",a.icon_img),e.yG2(2),e.cNF(a.name)}}const It=[{path:"",component:(()=>{var s;class _{constructor(i,t,n,l,r,d,u,g,I,R,C,F,L,V,oe,wt){var T,c=this;this.modalCtrl=i,this.navCtrl=t,this.route=n,this.router=l,this.nakama=r,this.noti=d,this.statusBar=u,this.indexed=g,this.lang=I,this.sanitizer=R,this.global=C,this.loadingCtrl=F,this.webrtc=L,this.p5toast=V,this.mClipboard=oe,this.alertCtrl=wt,this.info={},this.foundLastRead=!1,this.messages=[],this.sending_msg=[],this.temporary_open_thumbnail={},this.extended_buttons=[{icon:"settings-outline",name:this.lang.text.ChatRoom.ExtSettings,act:()=>{if(3!=this.info.redirect.type)this.extended_buttons[0].isHide=!0;else if(!this.lock_modal_open)try{this.lock_modal_open=!0,this.modalCtrl.create({component:Z.q,componentProps:{info:this.nakama.groups[this.isOfficial][this.target][this.info.group_id],server:{isOfficial:this.isOfficial,target:this.target}}}).then(T=>{T.onWillDismiss().then(f=>{f.data&&(this.extended_buttons.forEach(w=>{w.isHide=!0}),this.extended_buttons[0].isHide=!1,this.extended_buttons[12].isHide=!1)}),T.onDidDismiss().then(()=>{this.ionViewDidEnter()}),this.removeShortCutKey(),T.present(),this.lock_modal_open=!1})}catch{this.lock_modal_open=!1,this.p5toast.show({text:this.lang.text.ChatRoom.AlreadyRemoved})}}},{icon:"hammer-outline",name:this.lang.text.ChatRoom.ExtSoloImage,isHide:!0,act:()=>{this.info.info.img?(delete this.info.info.img,this.indexed.removeFileFromUserPath(`servers/${this.info.server.isOfficial}/${this.info.server.target}/groups/${this.info.id}.img`),this.p5toast.show({text:this.lang.text.ChatRoom.LocalImageRemoved})):document.getElementById("local_channel").click()}},{icon:"image-outline",name:this.lang.text.ChatRoom.BackgroundImage,act:()=>{this.HasBackgroundImage?this.RemoveChannelBackgroundImage():document.getElementById("backgroundImage_sel").click()}},{icon:"document-attach-outline",name:this.lang.text.ChatRoom.attachments,act:(T=(0,m.c)(function*(){c.userInputTextArea||(c.userInputTextArea=document.getElementById(c.ChannelUserInputId));try{return void(yield c.new_attach({detail:{value:"link"}}))}catch(f){"done"!=f&&c.new_attach({detail:{value:"load"}})}}),function(){return T.apply(this,arguments)})},{icon_img:"voidDraw.png",name:this.lang.text.ChatRoom.voidDraw,act:function(){var T=(0,m.c)(function*(){c.userInputTextArea||(c.userInputTextArea=document.getElementById(c.ChannelUserInputId));let w,f={};if(c.userInput.file)switch(c.userInput.file.typeheader){case"image":try{c.userInput.file.url&&(c.userInput.file.blob=yield fetch(c.userInput.file.url).then(B=>B.blob()));let O=`tmp_files/chatroom/attached.${c.userInput.file.file_ext}`;yield c.indexed.saveBlobToUserPath(c.userInput.file.blob,O);let G=document.getElementById("ChatroomSelectedImage");f.path=O,f.width=G.naturalWidth,f.height=G.naturalHeight,w=c.userInput.file.content_related_creator}catch(O){return void c.p5toast.show({text:`${c.lang.text.ContentViewer.CannotEditFile}: ${O}`})}break;case"text":f.text=c.userInput.file.thumbnail}c.modalCtrl.create({component:N.S,componentProps:f,cssClass:"fullscreen"}).then(O=>{O.onWillDismiss().then(function(){var G=(0,m.c)(function*(B){B.data&&(yield c.voidDraw_fileAct_callback(B,w))});return function(B){return G.apply(this,arguments)}}()),O.onDidDismiss().then(()=>{c.ionViewDidEnter()}),c.is_modal=!0,c.removeShortCutKey(),O.present()})});return function(){return T.apply(this,arguments)}}()},{icon:"reader-outline",name:this.lang.text.ChatRoom.newText,act:function(){var T=(0,m.c)(function*(){c.userInputTextArea||(c.userInputTextArea=document.getElementById(c.ChannelUserInputId));let f={info:{content:{is_new:void 0,type:"text/plain",viewer:"text",filename:void 0,path:void 0}},no_edit:void 0};if(c.userInput.file)switch(c.userInput.file.viewer){case"code":case"text":let w="tmp_files/chatroom/edit_text.txt";yield c.indexed.saveBlobToUserPath(c.userInput.file.blob,w),f.info.content.path=w,f.info.content.type=c.userInput.file.type,f.info.content.viewer=c.userInput.file.viewer,f.info.content.filename=c.userInput.file.filename||c.userInput.file.name}else{let w=new Date,O=w.getUTCFullYear(),G=("0"+(w.getMonth()+1)).slice(-2),B=("0"+w.getDate()).slice(-2),Ot=("0"+w.getHours()).slice(-2),Tt=("0"+w.getMinutes()).slice(-2),Gt=("0"+w.getSeconds()).slice(-2);f.info.content.is_new="text",f.info.content.filename=`texteditor_${O}-${G}-${B}_${Ot}-${Tt}-${Gt}.txt`,f.no_edit=!0}c.modalCtrl.create({component:U.K,componentProps:f}).then(w=>{w.onWillDismiss().then(O=>{if(O.data){let G={};G.content_creator={timestamp:(new Date).getTime(),display_name:c.nakama.users.self.display_name,various:"textedit"},G.content_related_creator=[],G.content_related_creator.push(G.content_creator),G.blob=O.data.blob,G.path=O.data.path,G.size=O.data.blob.size,G.filename=O.data.blob.name||f.info.content.filename,G.file_ext=G.filename.split(".").pop(),G.type="text/plain",G.viewer="text",c.userInput.file=G}}),w.present()})});return function(){return T.apply(this,arguments)}}()},{icon:"camera-outline",name:this.lang.text.ChatRoom.Camera,act:function(){var T=(0,m.c)(function*(){try{const f=yield H.Ut.getPhoto({quality:90,resultType:H.on.Base64,source:H._8.Camera});let w=yield c.loadingCtrl.create({message:c.lang.text.TodoDetail.WIP});w.present(),c.userInputTextArea||(c.userInputTextArea=document.getElementById(c.ChannelUserInputId)),c.userInput.file={},c.userInput.file.filename=`Camera_${(new Date).toLocaleString().replace(/:/g,"_")}.${f.format}`,c.userInput.file.file_ext=f.format,c.userInput.file.thumbnail=c.sanitizer.bypassSecurityTrustUrl("data:image/jpeg;base64,"+f.base64String),c.userInput.file.type=`image/${f.format}`,c.userInput.file.typeheader="image",c.userInput.file.content_related_creator=[{user_id:c.info.local?"local":c.nakama.servers[c.isOfficial][c.target].session.user_id,timestamp:(new Date).getTime(),display_name:c.nakama.users.self.display_name,various:"camera"}],c.userInput.file.content_creator={user_id:c.info.local?"local":c.nakama.servers[c.isOfficial][c.target].session.user_id,timestamp:(new Date).getTime(),display_name:c.nakama.users.self.display_name,various:"camera"},yield c.indexed.saveBase64ToUserPath("data:image/jpeg;base64,"+f.base64String,`tmp_files/chatroom/${c.userInput.file.filename}`,G=>{c.userInput.file.blob=new Blob([G],{type:c.userInput.file.type})}),w.dismiss()}catch{}});return function(){return T.apply(this,arguments)}}()},{icon:"mic-circle-outline",name:this.lang.text.ChatRoom.Voice,act:function(){var T=(0,m.c)(function*(){if(c.useVoiceRecording=!c.useVoiceRecording,c.useVoiceRecording)(yield Y.G.hasAudioRecordingPermission()).value?(c.extended_buttons[7].icon="stop-circle-outline",yield Y.G.startRecording(),c.p5toast.show({text:c.lang.text.ChatRoom.StartVRecord})):yield Y.G.requestAudioRecordingPermission();else{let f=yield Y.G.stopRecording(),w=c.global.Base64ToBlob(`${f.value.mimeType},${f.value.recordDataBase64}`);w.name=`${c.lang.text.ChatRoom.VoiceRecord}.${f.value.mimeType.split("/").pop().split(";")[0]}`,w.type_override=f.value.mimeType,c.selected_blobFile_callback_act(w),c.extended_buttons[7].icon="mic-circle-outline"}});return function(){return T.apply(this,arguments)}}()},{icon:"cloud-done-outline",name:this.lang.text.ChatRoom.Detour,act:()=>{this.toggle_custom_attach()}},{icon:"call-outline",name:this.lang.text.ChatRoom.VoiceChat,act:function(){var T=(0,m.c)(function*(){try{yield c.webrtc.initialize("audio",void 0,{isOfficial:c.isOfficial,target:c.target,channel_id:c.info.id,user_id:c.info.info.id||c.info.info.user_id}),c.webrtc.CurrentMatch=yield c.nakama.servers[c.isOfficial][c.target].socket.createMatch(),yield c.nakama.servers[c.isOfficial][c.target].socket.writeChatMessage(c.info.id,{match:c.webrtc.CurrentMatch.match_id}),c.scroll_down_logs(),c.webrtc.CreateOfffer()}catch(f){c.p5toast.show({text:`${c.lang.text.ChatRoom.JoinMatchFailed}: ${f}`})}});return function(){return T.apply(this,arguments)}}()},{icon:"volume-mute-outline",name:this.lang.text.ChatRoom.ReadText,act:function(){var T=(0,m.c)(function*(){c.toggle_speakermode()});return function(){return T.apply(this,arguments)}}()},{icon:"log-out-outline",name:this.lang.text.ChatRoom.LogOut,act:function(){var T=(0,m.c)(function*(){if(3!=c.info.redirect.type)try{yield c.nakama.servers[c.isOfficial][c.target].socket.leaveChat(c.info.id),c.nakama.channels_orig[c.isOfficial][c.target][c.info.id].status="missing",c.extended_buttons.forEach(f=>{f.isHide=!0}),c.extended_buttons[12].isHide=!1}catch(f){console.error("\ucc44\ub110\uc5d0\uc11c \ub098\uc624\uae30 \uc2e4\ud328: ",f)}else c.extended_buttons[11].isHide=!0;c.ionViewDidEnter()});return function(){return T.apply(this,arguments)}}()},{isHide:!0,name:this.lang.text.ChatRoom.RemoveHistory,icon:"close-circle-outline",act:()=>{this.alertCtrl.create({header:this.lang.text.ChatRoom.RemoveChannel,message:this.lang.text.ChatRoom.CannotUndone,buttons:[{text:this.lang.text.ChatRoom.Delete,handler:function(){var T=(0,m.c)(function*(){let f=yield c.loadingCtrl.create({message:c.lang.text.TodoDetail.WIP});f.present(),delete c.nakama.channels_orig[c.isOfficial][c.target][c.info.id];try{switch(c.info.redirect.type){case 3:yield c.nakama.remove_group_list(c.nakama.groups[c.isOfficial][c.target][c.info.group_id]||c.info.info,c.isOfficial,c.target);break;case 0:yield c.indexed.removeFileFromUserPath(`servers/${c.isOfficial}/${c.target}/groups/${c.info.id}.img`)}}catch(O){console.log("\uadf8\ub8f9 \uc774\ubbf8\uc9c0 \uc0ad\uc81c \uc624\ub958: ",O)}try{delete c.nakama.groups[c.isOfficial][c.target][c.info.group_id]}catch(O){console.log("DeleteGroupFailed: ",O)}c.nakama.save_groups_with_less_info();let w=yield c.indexed.GetFileListFromDB(`servers/${c.isOfficial}/${c.target}/channels/${c.info.id}`);for(let O=0,G=w.length;O<G;O++)f.message=`${c.lang.text.UserFsDir.DeleteFile}: ${G-O}`,yield c.indexed.removeFileFromUserPath(w[O]);f.dismiss(),c.navCtrl.pop()});return function(){return T.apply(this,arguments)}}(),cssClass:"redfont"}]}).then(T=>{this.global.p5key.KeyShortCut.Escape=()=>{T.dismiss()},T.onDidDismiss().then(()=>{this.global.p5key.KeyShortCut.Escape=()=>{this.navCtrl.pop()}}),T.present()})}}],this.useVoiceRecording=!1,this.is_modal=!1,this.useFirstCustomCDN=0,this.HasBackgroundImage=!1,this.next_cursor="",this.prev_cursor="",this.file_sel_id="file_sel_id",this.ShowGoToBottom=!1,this.isMobile=!1,this.BackButtonPressed=!1,this.last_message_viewer={user_id:void 0,message:void 0,color:void 0,is_me:void 0},this.users_image={},this.userInput={file:void 0,quickShare:void 0,text:""},this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder,this.pullable=!0,this.ViewableMessage=[],this.ViewMsgIndex=0,this.RefreshCount=15,this.ViewCount=45,this.ShowRecentMsg=!1,this.useSpeaker=!1,this.isSpeeching=!1,this.SpeechThese=[],this.isHistoryLoaded=!1,this.LocalHistoryList=[],this.isHidden=!0,this.ChannelUserInputId="ChannelUserInputId",this.block_send=!1,this.isOtherAct=!1,this.lock_modal_open=!1}add_shortcut(){this.is_modal||this.ionViewDidEnter()}ionViewDidEnter(){this.is_modal=!1,Y.G.getCurrentStatus().then(t=>{"RECORDING"==t.status&&(this.extended_buttons[7].isHide=!0)}),this.global.p5key.KeyShortCut.Escape=()=>{this.navCtrl.pop()},this.global.p5key.KeyShortCut.BottomTab=t=>{document.activeElement!=document.getElementById(this.ChannelUserInputId)&&"E"===t&&this.open_ext_with_delay()};let i=[];for(let t=0,n=this.extended_buttons.length;t<n;t++)this.extended_buttons[t].isHide||i.push(this.extended_buttons[t]);this.global.p5key.KeyShortCut.Digit=t=>{!this.isHidden&&document.activeElement!=document.getElementById(this.ChannelUserInputId)&&i.length>t&&i[t].act()},this.global.p5key.KeyShortCut.EnterAct=()=>{document.activeElement!=document.getElementById(this.ChannelUserInputId)&&setTimeout(()=>{this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId)),this.userInputTextArea.focus()},0)}}new_attach(i,t=void 0){var n=this;return(0,m.c)(function*(){switch(void 0===t&&(t={}),i.detail.value){case"load":n.userInputTextArea||(n.userInputTextArea=document.getElementById(n.ChannelUserInputId)),document.getElementById(n.file_sel_id).click();break;case"link":try{let l=t.url;if(!n.userInput.file&&void 0===l)try{l=yield n.mClipboard.paste()}catch{try{l=yield z.c.read()}catch(g){throw g}}try{let u=n.global.Base64ToBlob(l),g=l.split(";")[0].split(":")[1],I=new File([u],`${n.lang.text.ChatRoom.FileLink}.${g.split("/").pop()}`,{type:g});throw yield n.selected_blobFile_callback_act(I),"done"}catch(u){if("done"===u)throw u}try{if(n.userInput.file&&void 0===t.filename)throw"\uc774\ubbf8 \ud30c\uc77c\uc774 \ucca8\ubd80\ub428, \ud1a0\uae00\ub9cc \uc2dc\ub3c4";if(!(yield fetch(l)).ok)throw"URL \uad6c\uc870\uac00 \uc815\uc0c1\uc774 \uc544\ub2d8"}catch(u){throw u}let r={};r.url=l,r.content_related_creator=[],t&&t.content_related_creator&&(r.content_related_creator=[...t.content_related_creator]),r.content_related_creator.push({user_id:n.info.local?"local":n.nakama.servers[n.isOfficial][n.target].session.user_id,timestamp:(new Date).getTime(),display_name:n.nakama.users.self.display_name,various:t.url?"shared":"link"}),r.content_creator={user_id:n.info.local?"local":n.nakama.servers[n.isOfficial][n.target].session.user_id,timestamp:(new Date).getTime(),display_name:n.nakama.users.self.display_name,various:t.url?"shared":"link"};let d=r.url.split(".");r.file_ext=t.file_ext||d.pop().split("?").shift(),r.filename=t.filename||decodeURIComponent(`${d.pop().split("/").pop()||n.lang.text.ChatRoom.ExternalLinkFile}.${r.file_ext}`),n.global.set_viewer_category_from_ext(r),r.type=t.type||"",r.typeheader=t.typeheader||r.viewer,n.global.modulate_thumbnail(r,r.url),n.NeedScrollDown()&&setTimeout(()=>{n.scroll_down_logs()},100),n.userInput.file=r,n.inputPlaceholder=`(${n.lang.text.ChatRoom.FileLink}: ${n.userInput.file.filename})`}catch(l){throw"done"==l?l:`\uc778\uc2dd \ubd88\uac00\ub2a5\ud55c URL \uc815\ubcf4: ${l}`}}})()}toggle_custom_attach(i){var t=this;return(0,m.c)(function*(){switch(t.useFirstCustomCDN=null!=i?i:(t.useFirstCustomCDN+1)%(0==t.info.redirect.type?2:3),t.useFirstCustomCDN){case 0:t.extended_buttons[8].icon="cloud-offline-outline",t.extended_buttons[8].name=t.lang.text.ChatRoom.Detour;break;case 1:t.extended_buttons[8].icon="cloud-done-outline",t.extended_buttons[8].name=t.lang.text.ChatRoom.useFSS;break;case 2:t.extended_buttons[8].icon="server-outline",t.extended_buttons[8].name=t.lang.text.ChatRoom.forceSQL}localStorage.setItem("useFFSCDN",`${t.useFirstCustomCDN}`)})()}toggle_speakermode(i){var t=this;return(0,m.c)(function*(){if(t.useSpeaker=null!=i?i:!t.useSpeaker,t.extended_buttons[10].icon=t.useSpeaker?"volume-high-outline":"volume-mute-outline",t.useSpeaker?localStorage.setItem("useChannelSpeaker",`${t.useSpeaker}`):localStorage.removeItem("useChannelSpeaker"),!t.useSpeaker)try{yield W.stop()}catch{}})()}LoadChannelBackgroundImage(){var i=this;return(0,m.c)(function*(){try{let t=yield i.indexed.loadBlobFromUserPath(`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/backgroundImage.png`,"");i.ChangeBackgroundImage({target:{files:[t]}}),i.HasBackgroundImage=!0}catch{}})()}RemoveChannelBackgroundImage(){var i=this;return(0,m.c)(function*(){try{yield i.indexed.removeFileFromUserPath(`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/backgroundImage.png`),document.getElementById("main_table").style.backgroundImage='url("")'}catch{}i.HasBackgroundImage=!1})()}ChangeBackgroundImage(i){let t=document.getElementById("main_table"),n=i.target.files[0],l=URL.createObjectURL(n);t.style.backgroundImage=`url('${l}')`,this.indexed.saveBlobToUserPath(n,`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/backgroundImage.png`),this.HasBackgroundImage=!0,setTimeout(()=>{URL.revokeObjectURL(l)},100)}cancel_qrshare(){delete this.userInput.quickShare,this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder}inputFileSelected(i){var t=this;return(0,m.c)(function*(){if(i.target.files.length)if(1!=i.target.files.length){let l=yield t.alertCtrl.create({header:t.lang.text.ChatRoom.MultipleSend,message:`${t.lang.text.ChatRoom.CountFile}: ${i.target.files.length}`,buttons:[{text:t.lang.text.ChatRoom.Send,handler:(r=(0,m.c)(function*(){let d=yield t.loadingCtrl.create({message:t.lang.text.ChatRoom.MultipleSend});d.present(),t.noti.noti.schedule({id:7,title:t.lang.text.ChatRoom.MultipleSend,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://diychat",color:"b0b0b0"});for(let u=0,g=i.target.files.length;u<g;u++)d.message=`${g-u}: ${i.target.files[u].name}`,t.noti.noti.schedule({id:7,title:`${t.lang.text.ChatRoom.MultipleSend}: ${i.target.files[u].name}`,progressBar:{value:u,maxValue:g},sound:null,smallIcon:"res://diychat",color:"b0b0b0"}),yield t.selected_blobFile_callback_act(i.target.files[u]),yield t.send();t.noti.ClearNoti(7),d.dismiss(),setTimeout(()=>{t.scroll_down_logs(),document.getElementById(t.file_sel_id).value=""},300)}),function(){return r.apply(this,arguments)})}]});t.global.p5key.KeyShortCut.Escape=()=>{l.dismiss()},l.onDidDismiss().then(()=>{t.global.p5key.KeyShortCut.Escape=()=>{t.navCtrl.pop()}}),l.present()}else{let l=yield t.loadingCtrl.create({message:t.lang.text.TodoDetail.WIP});l.present(),yield t.selected_blobFile_callback_act(i.target.files[0]),l.dismiss(),document.getElementById(t.file_sel_id).value=""}else delete t.userInput.file,t.inputPlaceholder=t.lang.text.ChatRoom.input_placeholder,document.getElementById(t.file_sel_id).value="";var r})()}LocalChannelImageChanged(i){var t=this;return(0,m.c)(function*(){let n=yield t.global.GetBase64ThroughFileReader(i.target.files[0]);t.nakama.limit_image_size(n,l=>{t.info.info.img=l.canvas.toDataURL(),t.indexed.saveTextFileToUserPath(t.info.info.img,`servers/${t.info.server.isOfficial}/${t.info.server.target}/groups/${t.info.id}.img`),t.p5toast.show({text:t.lang.text.ChatRoom.LocalImageChanged})})})()}InitBrowserBackButtonOverride(){window.history.pushState(null,null,window.location.href),window.onpopstate=()=>{this.BackButtonPressed||(this.BackButtonPressed=!0,this.navCtrl.back())}}ngOnInit(){var i=this;this.InitBrowserBackButtonOverride(),this.useSpeaker=!!localStorage.getItem("useChannelSpeaker"),this.toggle_speakermode(this.useSpeaker),this.ChatLogs=document.getElementById("chatroom_div"),this.ChatLogs.onscroll=t=>{this.ChatLogs.scrollHeight-(this.ChatLogs.scrollTop+this.ChatLogs.clientHeight)<1&&(this.ShowGoToBottom||this.ShowRecentMsg||this.init_last_message_viewer(),this.ShowRecentMsg&&this.pull_msg_history(!1)),this.ShowGoToBottom=this.ChatLogs.scrollHeight-220>this.ChatLogs.scrollTop+this.ChatLogs.clientHeight||this.ShowRecentMsg},this.nakama.ChatroomLinkAct=function(){var t=(0,m.c)(function*(n,l){delete i.nakama.channels_orig[i.isOfficial][i.target][i.info.id].update,i.info=n,yield i.init_chatroom(),i.userInput.file=l,i.userInput.file&&i.create_thumbnail_imported(l)});return function(n,l){return t.apply(this,arguments)}}(),this.route.queryParams.subscribe(function(){var t=(0,m.c)(function*(n){const l=i.router.getCurrentNavigation().extras.state;l&&(i.info=l.info),yield new Promise(r=>setTimeout(r,100)),yield i.init_chatroom(),i.userInput.file=l.file,i.userInput.file&&i.create_thumbnail_imported(l.file)});return function(n){return t.apply(this,arguments)}}()),"DesktopPWA"==E.s1&&setTimeout(()=>{this.CreateDrop()},0),this.isMobile="Android"==E.s1||"iOS"==E.s1,this.nakama.StatusBarChangedCallback=(0,m.c)(function*(){yield i.SetExtensionButtons()}),this.useFirstCustomCDN=Number(localStorage.getItem("useFFSCDN"))||0,this.toggle_custom_attach(this.useFirstCustomCDN)}ionViewWillEnter(){this.ChatContDiv=document.getElementById("chatroom_content_div"),document.getElementById(this.ChannelUserInputId).onpaste=i=>{let t=[];for(const n of i.clipboardData.files)n.type.startsWith("image/")&&t.push({file:n});if(t.length)return 1==t.length?this.selected_blobFile_callback_act(t[0].file):this.alertCtrl.create({header:this.lang.text.ChatRoom.MultipleSend,message:`${this.lang.text.ChatRoom.CountFile}: ${t.length}`,buttons:[{text:this.lang.text.ChatRoom.Send,handler:()=>{this.DropSendAct(t)}}]}).then(n=>{this.global.p5key.KeyShortCut.Escape=()=>{n.dismiss()},n.onDidDismiss().then(()=>{this.global.p5key.KeyShortCut.Escape=()=>{this.navCtrl.pop()}}),n.present()}),!1}}GetSpeechToText(){var i=this;return(0,m.c)(function*(){yield Y.G.requestAudioRecordingPermission();let t=yield ne.I.start({language:i.lang.lang,maxResults:1,prompt:i.lang.text.ChatRoom.TalkMessage,partialResults:!0,popup:!0});i.userInput.text=t.matches[0]})()}CreateDrop(){var i=this;let t=document.getElementById("p5Drop_chatroom");this.p5canvas=new Q(n=>{n.setup=()=>{let g=n.createCanvas(t.clientWidth,t.clientHeight);g.parent(t),n.pixelDensity(.1),g.drop(I=>{let R=n.millis();d<R-400?(r=!1,u.length=0,u.push(I)):(r=!0,u.push(I)),d=R,clearTimeout(l),l=setTimeout((0,m.c)(function*(){if(r)i.alertCtrl.create({header:i.lang.text.ChatRoom.MultipleSend,message:`${i.lang.text.ChatRoom.CountFile}: ${u.length}`,buttons:[{text:i.lang.text.ChatRoom.Send,handler:()=>{i.DropSendAct(u)}}]}).then(C=>{i.global.p5key.KeyShortCut.Escape=()=>{C.dismiss()},C.onDidDismiss().then(()=>{i.global.p5key.KeyShortCut.Escape=()=>{i.navCtrl.pop()}}),C.present()});else{let C=yield i.loadingCtrl.create({message:i.lang.text.TodoDetail.WIP});C.present(),i.selected_blobFile_callback_act(I.file),C.dismiss()}}),400)})};let l,r=!1,d=0,u=[];n.mouseMoved=g=>{g.dataTransfer?(t.style.pointerEvents="all",t.style.backgroundColor="#0008"):(t.style.pointerEvents="none",t.style.backgroundColor="transparent")}})}DropSendAct(i){var t=this;return(0,m.c)(function*(){let n=yield t.loadingCtrl.create({message:t.lang.text.TodoDetail.WIP});n.present();for(let l=0,r=i.length;l<r;l++)yield t.selected_blobFile_callback_act(i[l].file),yield t.send();n.dismiss(),setTimeout(()=>{t.scroll_down_logs()},300)})()}selected_blobFile_callback_act(i,t=[],n="loaded",l){var r=this;return(0,m.c)(function*(){r.userInput.file={},r.userInput.file.filename=i.name,r.userInput.file.file_ext=i.name.split(".").pop()||i.type||r.lang.text.ChatRoom.unknown_ext,r.userInput.file.size=i.size,r.userInput.file.type=i.type||i.type_override,l&&(r.userInput.file.path=l),r.userInput.file.content_related_creator=[...t,{user_id:r.info.local?"local":r.nakama.servers[r.isOfficial][r.target].session.user_id,timestamp:(new Date).getTime(),display_name:r.nakama.users.self.display_name,various:n}],r.userInput.file.content_creator={user_id:r.info.local?"local":r.nakama.servers[r.isOfficial][r.target].session.user_id,timestamp:(new Date).getTime(),display_name:r.nakama.users.self.display_name,various:n},r.userInput.file.blob=i,r.create_selected_thumbnail(),r.inputPlaceholder=`(${r.lang.text.ChatRoom.attachments}: ${r.userInput.file.filename})`})()}create_thumbnail_imported(i){var t=this;return(0,m.c)(function*(){if(i.url)yield t.new_attach({detail:{value:"link"}},i);else{let n=yield t.indexed.loadBlobFromUserPath(i.path,i.type);n.name=i.filename||i.name,t.selected_blobFile_callback_act(n,i.content_related_creator,"shared",i.path)}})()}create_selected_thumbnail(){var i=this;return(0,m.c)(function*(){if(i.global.set_viewer_category_from_ext(i.userInput.file),i.userInput.file.url){try{(yield fetch(i.userInput.file.url)).ok&&(i.userInput.file.thumbnail=i.userInput.file.url)}catch{}return void(i.userInput.file.typeheader=i.userInput.file.viewer)}try{i.userInput.file.thumbnail=yield i.indexed.loadBlobFromUserPath(i.userInput.file.path,i.userInput.file.type)}catch{}let t=URL.createObjectURL(i.userInput.file.blob);switch(i.userInput.file.typeheader=i.userInput.file.blob.type.split("/")[0]||i.userInput.file.viewer,setTimeout(()=>{URL.revokeObjectURL(t)},0),i.userInput.file.thumbnail=void 0,i.userInput.file.typeheader){case"image":i.userInput.file.thumbnail=i.sanitizer.bypassSecurityTrustUrl(t);break;case"text":new Q(n=>{n.setup=()=>{n.noCanvas(),n.loadStrings(t,l=>{i.userInput.file.thumbnail=l,n.remove()},l=>{console.error("\ubb38\uc790\uc5f4 \ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",l),n.remove()})}})}})()}init_chatroom(){var i=this;return(0,m.c)(function*(){i.userInput.text="",delete i.userInput.quickShare,delete i.userInput.file,i.ResizeTextArea(),i.nakama.OnTransferMessage={},i.ViewableMessage.length=0,i.ViewMsgIndex=0,i.ShowGoToBottom=!1,i.ShowRecentMsg=!1,i.isHistoryLoaded=!1,i.LocalHistoryList.length=0,i.messages.length=0,i.prev_cursor="",i.next_cursor="",i.pullable=!0,i.init_last_message_viewer(),i.file_sel_id=`chatroom_${i.info.id}_${(new Date).getTime()}`,i.ChannelUserInputId=`chatroom_input_${i.info.id}_${(new Date).getTime()}`,i.noti.Current=i.info.cnoti_id,i.info.cnoti_id&&i.noti.ClearNoti(i.info.cnoti_id),i.noti.RemoveListener(`openchat${i.info.cnoti_id}`),i.isOfficial=i.info.server.isOfficial,i.target=i.info.server.target,i.info=i.nakama.channels_orig[i.isOfficial][i.target][i.info.id],i.users_image={};try{for(let t=0,n=i.info.info.users.length;t<n;t++)i.users_image[i.info.info.users[t].user.id]=i.info.info.users[t].user.img}catch{}try{i.users_image[i.info.info.id]=i.info.info.img}catch{}i.LoadChannelBackgroundImage(),i.nakama.opened_page_info.channel={isOfficial:i.isOfficial,target:i.target,id:i.info.id},i.foundLastRead=i.info.last_read_id==i.info.last_comment_id,yield i.SetExtensionButtons(),i.nakama.channels_orig[i.isOfficial][i.target]&&i.nakama.channels_orig[i.isOfficial][i.target][i.info.id]&&"missing"!=i.info.status&&(i.nakama.channels_orig[i.isOfficial][i.target][i.info.id].update=t=>{if(1==t.code){for(let l=0,r=i.messages.length;l<r;l++)if(i.messages[l].message_id==t.message_id){i.messages[l].content=t.content;break}return}let n="local"==t.sender_id;if(t.content.filename&&i.ModulateFileEmbedMessage(t),i.info.last_read_id=i.info.last_comment_id,n||i.check_if_send_msg(t),1==t.code||2==t.code||i.messages.push(t),2==t.code)for(let l=i.messages.length-1;l>=0;l--)if(i.messages[l].message_id==t.message_id){i.messages.splice(l,1);break}i.ViewMsgIndex+i.ViewCount==i.messages.length-1&&i.ViewMsgIndex++,i.ViewableMessage=i.messages.slice(i.ViewMsgIndex,i.ViewMsgIndex+i.ViewCount),i.modulate_chatmsg(0,i.ViewableMessage.length),i.modulate_chatmsg(i.ViewableMessage.length-1,i.ViewableMessage.length),i.ShowRecentMsg=i.messages.length>i.ViewMsgIndex+i.ViewCount,i.useSpeaker&&i.SpeechReceivedMessage(t),setTimeout(()=>{let l=document.getElementById(t.message_id);if(l&&null==l.oncontextmenu&&(l.oncontextmenu=()=>{try{let r;for(let d=0,u=i.ViewableMessage.length;d<u;d++)if(l.id==i.ViewableMessage[d].message_id){r=d;break}if(void 0===r)throw"\uba54\uc2dc\uc9c0\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc74c";i.CopyMessageText(i.ViewableMessage[r]),i.message_detail(t,r)}catch(r){console.log("\uba54\uc2dc\uc9c0 \uc0c1\uc138\ubcf4\uae30 \uc2e4\ud328: ",r)}return!1}),i.info.is_new=!1,i.nakama.has_new_channel_msg=!1,i.NeedScrollDown()&&!i.ShowRecentMsg)i.init_last_message_viewer(),i.ChatLogs.scrollTo({top:i.ChatLogs.scrollHeight,behavior:"smooth"});else if(2!=t.code){i.last_message_viewer.is_me=!!i.info.local||t.sender_id==i.nakama.servers[i.isOfficial][i.target].session.user_id,i.last_message_viewer.user_id=t.sender_id;let r=JSON.parse(JSON.stringify(t.content.msg));t.content.filename&&(r.length?r[0][0].text=`(${i.lang.text.ChatRoom.attachments}) ${r[0][0].text}`:r=[[{text:`(${i.lang.text.ChatRoom.attachments})`}]]),i.last_message_viewer.message=r,i.last_message_viewer.color=t.color}},0),i.global.godot_window&&i.global.godot_window.received_msg&&i.global.godot_window.received_msg({sender_id:t.sender_id,user_display_name:t.user_display_name,content:t.content})}),yield i.pull_msg_history(),setTimeout(()=>{i.ChatLogs.scrollTo({top:i.ChatLogs.scrollHeight,behavior:"smooth"})},500)})()}SetExtensionButtons(){var i=this;return(0,m.c)(function*(){switch(i.extended_buttons.forEach(t=>{t.isHide=!1}),i.info.redirect.type){case 2:"missing"!=i.info.status&&(i.info.redirect?"online"==i.statusBar.groupServer[i.isOfficial][i.target]&&(i.info.status=i.nakama.load_other_user(i.info.redirect.id,i.isOfficial,i.target).online?"online":"pending"):i.info.status=i.info.info.online?"online":"pending",i.extended_buttons[0].isHide=!0,i.extended_buttons[1].isHide=!0,i.extended_buttons[9].isHide=!1,i.extended_buttons[12].isHide=!0);break;case 3:"missing"!=i.info.status&&(yield i.nakama.load_groups(i.isOfficial,i.target,i.info.group_id)),i.extended_buttons[1].isHide=!0,i.extended_buttons[11].isHide=!0,delete i.extended_buttons[0].isHide,i.extended_buttons[9].isHide=!0,i.extended_buttons[12].isHide=!0;break;case 0:i.extended_buttons[0].isHide=!0,i.extended_buttons[9].isHide=!0,i.extended_buttons[11].isHide=!0}(void 0===i.info.status||"missing"==i.info.status)&&(i.extended_buttons.forEach(t=>{t.isHide=!0}),i.extended_buttons[12].isHide=!1,3==i.info.redirect.type&&(i.extended_buttons[0].isHide=!1)),i.extended_buttons[10].isHide=E.O$||"missing"==i.info.status})()}CopyMessageText(i){var t=this;return(0,m.c)(function*(){let n=t.deserialize_text(i),l=!1;if(!n)try{let r=i.content.path;n=yield t.indexed.loadBlobFromUserPath(r,i.content.type),l=!0}catch{i.content.url&&(n=i.content.url,l=!!n)}try{if(!l)throw"\ud14d\uc2a4\ud2b8 \ubcf5\uc0ac\ub85c \uc989\uc2dc \uc774\ub3d9";let r={};r[i.content.type]=n,yield navigator.clipboard.write([new ClipboardItem(r)]),"DesktopPWA"==E.s1&&t.p5toast.show({text:`${t.lang.text.GlobalAct.PCCopyImage}: ${i.content.filename}`})}catch{try{yield t.mClipboard.copy(n)}catch{try{yield z.c.write(n),"DesktopPWA"==E.s1&&t.p5toast.show({text:`${t.lang.text.GlobalAct.PCClipboard}: ${n}`})}catch(u){console.log("\ud074\ub9bd\ubcf4\ub4dc \ubcf5\uc0ac \uc2e4\ud328: ",u)}}}})()}init_last_message_viewer(){delete this.last_message_viewer.user_id,delete this.last_message_viewer.message,delete this.last_message_viewer.color,delete this.last_message_viewer.is_me}NeedScrollDown(){return this.ChatLogs.scrollHeight<this.ChatLogs.scrollTop+this.ChatLogs.clientHeight+200}scroll_down_logs(){this.ShowRecentMsg||this.init_last_message_viewer(),this.ChatLogs.scrollTo({top:this.ChatLogs.scrollHeight,behavior:"smooth"})}check_if_send_msg(i){for(let t=0,n=this.sending_msg.length;t<n;t++)if(i.sender_id==this.nakama.servers[this.isOfficial][this.target].session.user_id&&i.content.local_comp==this.sending_msg[t].content.local_comp){i.content.filename&&this.auto_open_thumbnail(i),this.sending_msg.splice(t,1);break}}auto_open_thumbnail(i){try{this.temporary_open_thumbnail[i.message_id]()}catch{this.temporary_open_thumbnail[i.message_id]=()=>{i.content.url?this.global.modulate_thumbnail(i.content,""):(this.indexed.loadBlobFromUserPath(`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${i.message_id}.${i.content.file_ext}`,i.content.type,n=>{i.content.path=`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${i.message_id}.${i.content.file_ext}`;let l=URL.createObjectURL(n);this.global.modulate_thumbnail(i.content,l),this.NeedScrollDown()&&setTimeout(()=>{this.scroll_down_logs()},100),this.nakama.WriteStorage_From_channel(i,i.content.path,this.isOfficial,this.target)}),delete this.temporary_open_thumbnail[i.message_id])}}}removeAttach(){delete this.userInput.file,this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder}pull_msg_history(i=!0){var t=this;return(0,m.c)(function*(){if(t.pullable||!i){if(t.pullable=!1,i){try{if(t.info.local)throw"Local channel";if(void 0===t.info.status||"missing"==t.info.status)throw"Channel missing";if(0!=t.ViewMsgIndex){let l=Math.min(t.ViewMsgIndex,t.RefreshCount);t.ViewMsgIndex-=l,t.ViewableMessage=t.messages.slice(t.ViewMsgIndex,t.ViewMsgIndex+t.ViewCount);for(let r=0;r<l;r++){let d;try{t.ViewableMessage[r].content.path=`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/files/msg_${t.ViewableMessage[r].message_id}.${t.ViewableMessage[r].content.file_ext}`;let u=yield t.indexed.loadBlobFromUserPath(t.ViewableMessage[r].content.path,t.ViewableMessage[r].content.file_ext);d=URL.createObjectURL(u)}catch{}t.global.modulate_thumbnail(t.ViewableMessage[r].content,d),t.modulate_chatmsg(r,l+1)}return t.modulate_chatmsg(0,t.ViewableMessage.length),t.ShowRecentMsg=t.messages.length>t.ViewMsgIndex+t.ViewCount,void(t.pullable=!0)}let n=yield t.nakama.servers[t.isOfficial][t.target].client.listChannelMessages(t.nakama.servers[t.isOfficial][t.target].session,t.info.id,t.RefreshCount,!1,t.next_cursor);t.info.is_new=!1,n.messages.forEach(l=>{l=t.nakama.modulation_channel_message(l,t.isOfficial,t.target),t.nakama.check_sender_and_show_name(l,t.isOfficial,t.target),t.info.last_comment||2!=l.code&&(t.info.last_comment=(l.content.filename?`(${t.lang.text.ChatRoom.attachments}) `:"")+(l.content.msg||l.content.noti||"")),!t.foundLastRead&&t.info.last_read_id?t.info.last_read_id==l.message_id&&(l.isLastRead=!0,t.foundLastRead=!0,t.info.last_read_id=t.info.last_comment_id,t.nakama.save_channels_with_less_info()):t.foundLastRead=!0,t.nakama.translate_updates(l),l.content.filename&&t.ModulateFileEmbedMessage(l),t.nakama.ModulateTimeDate(l),t.nakama.content_to_hyperlink(l),2!=l.code&&t.messages.unshift(l)}),t.ViewableMessage=t.messages.slice(t.ViewMsgIndex,t.ViewMsgIndex+t.ViewCount);for(let l=0,r=t.ViewableMessage.length;l<r;l++){let d;try{if(!t.ViewableMessage[l].content.file_ext)throw"\ud30c\uc77c\uc774 \uc5c6\ub294 \uba54\uc2dc\uc9c0";if(t.ViewableMessage[l].content.url)throw"\ub9c1\ud06c\ub41c \ud30c\uc77c";t.ViewableMessage[l].content.path=`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/files/msg_${t.ViewableMessage[l].message_id}.${t.ViewableMessage[l].content.file_ext}`,t.indexed.checkIfFileExist(t.ViewableMessage[l].content.path,u=>{u&&t.indexed.loadBlobFromUserPath(t.ViewableMessage[l].content.path,t.ViewableMessage[l].content.file_ext,g=>{d=URL.createObjectURL(g),t.global.modulate_thumbnail(t.ViewableMessage[l].content,d)})})}catch{t.global.modulate_thumbnail(t.ViewableMessage[l].content,"")}t.modulate_chatmsg(l,r+1)}t.modulate_chatmsg(0,t.ViewableMessage.length),t.ShowRecentMsg=t.messages.length>t.ViewMsgIndex+t.ViewCount,t.next_cursor=n.next_cursor,t.prev_cursor=n.prev_cursor,t.pullable=!0,t.nakama.saveListedMessage(t.messages,t.info,t.isOfficial,t.target)}catch{yield t.LoadLocalChatHistory()}setTimeout(()=>{void 0!==t.next_cursor&&t.ChatContDiv&&t.ChatContDiv.clientHeight<t.ChatLogs.clientHeight&&t.pull_msg_history()},0)}else{let n=t.messages.length-t.ViewMsgIndex-t.ViewCount;t.ShowRecentMsg=0!=n,t.ViewMsgIndex+=Math.min(t.RefreshCount,n),t.ViewableMessage=t.messages.slice(t.ViewMsgIndex,t.ViewMsgIndex+t.ViewCount);for(let l=t.ViewableMessage.length-1;l>=0;l--){let r;try{t.ViewableMessage[l].content.path=`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/files/msg_${t.ViewableMessage[l].message_id}.${t.ViewableMessage[l].content.file_ext}`;let d=yield t.indexed.loadBlobFromUserPath(t.ViewableMessage[l].content.path,t.ViewableMessage[l].content.file_ext);r=URL.createObjectURL(d)}catch{}t.global.modulate_thumbnail(t.ViewableMessage[l].content,r),t.modulate_chatmsg(l,t.ViewableMessage.length)}t.pullable=!0}t.MakeViewableMessagesHaveContextMenuAct()}})()}SpeechReceivedMessage(i){try{if(0!=i.code)throw"\uc77c\ubc18 \uc218\uc2e0 \uba54\uc2dc\uc9c0\uac00 \uc544\ub2d8";let t=JSON.parse(JSON.stringify(i.content.msg)),n="";for(let l=0,r=t.length;l<r;l++)for(let d=0,u=t[l].length;d<u;d++)n+=t[l][d].text+" ";n&&n.trim()&&this.SpeechThese.push(n),this.isSpeeching||this.SpeechingTexts()}catch{}}SpeechingTexts(){var i=this;return(0,m.c)(function*(){let t=i.SpeechThese.shift();i.isSpeeching=!0,t&&t.trim()&&(yield W.speak({text:t,lang:i.lang.lang})),i.SpeechThese.length?i.SpeechingTexts():i.isSpeeching=!1})()}LoadLocalChatHistory(){var i=this;return(0,m.c)(function*(){if(i.ViewMsgIndex>0){let t=Math.min(i.ViewableMessage.length,Math.min(i.ViewMsgIndex,i.RefreshCount));i.ViewMsgIndex-=t,i.ViewableMessage=i.messages.slice(i.ViewMsgIndex,i.ViewMsgIndex+i.ViewCount);for(let n=t-1;n>=0;n--){let l;try{i.ViewableMessage[n].content.path=`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${i.ViewableMessage[n].message_id}.${i.ViewableMessage[n].content.file_ext}`;let r=yield i.indexed.loadBlobFromUserPath(i.ViewableMessage[n].content.path,i.ViewableMessage[n].content.file_ext);l=URL.createObjectURL(r)}catch{}i.global.modulate_thumbnail(i.ViewableMessage[n].content,l),i.modulate_chatmsg(n,t+1)}return i.ShowRecentMsg=i.messages.length>i.ViewMsgIndex+i.ViewCount,i.pullable=0!=i.ViewMsgIndex||!!i.LocalHistoryList.length,i.pullable&&i.ViewableMessage.length&&i.ViewableMessage.length<i.RefreshCount&&(yield i.LoadLocalChatHistory()),void i.MakeViewableMessagesHaveContextMenuAct()}if(i.isHistoryLoaded){try{let t=i.LocalHistoryList.pop();if(!t)throw"\uae30\ub85d \uc5c6\uc74c";let n=yield i.indexed.loadTextFromUserPath(t);if(n){let l=JSON.parse(n.trim()),r=0;for(let u=l.length-1;u>=0;u--)i.nakama.translate_updates(l[u]),l[u]=i.nakama.modulation_channel_message(l[u],i.isOfficial,i.target),i.nakama.ModulateTimeDate(l[u]),l[u].content.path=`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${l[u].message_id}.${l[u].content.file_ext}`,2!=l[u].code&&(r++,i.messages.unshift(l[u]));i.ViewMsgIndex=Math.max(0,r-i.RefreshCount),i.ViewableMessage=i.messages.slice(i.ViewMsgIndex,i.ViewMsgIndex+i.ViewCount);let d=Math.min(Math.min(r,i.RefreshCount),i.ViewableMessage.length);for(let u=d-1;u>=0;u--){let g;try{let I=yield i.indexed.loadBlobFromUserPath(i.ViewableMessage[u].content.path,i.ViewableMessage[u].content.file_ext);g=URL.createObjectURL(I)}catch{}i.global.modulate_thumbnail(i.ViewableMessage[u].content,g),i.modulate_chatmsg(u,d)}i.ShowRecentMsg=i.messages.length>i.ViewMsgIndex+i.ViewCount}else yield i.LoadLocalChatHistory()}catch{}i.pullable=0!=i.ViewMsgIndex||!!i.LocalHistoryList.length,i.pullable&&i.ViewableMessage.length<i.RefreshCount&&i.LoadLocalChatHistory()}else{let t=yield i.indexed.GetFileListFromDB(`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/chats/`);i.LocalHistoryList=t;for(let n=t.length-1;n>=0;n--){let l=t[n].split("/");"chats"!=l[l.length-4]&&t.splice(n,1)}if(i.isHistoryLoaded=!0,!i.LocalHistoryList.length)return;i.LoadLocalChatHistory()}i.MakeViewableMessagesHaveContextMenuAct()})()}MakeViewableMessagesHaveContextMenuAct(){setTimeout(()=>{for(let i=0,t=this.ViewableMessage.length;i<t;i++){let n=document.getElementById(this.ViewableMessage[i].message_id);n&&null==n.oncontextmenu&&(n.oncontextmenu=()=>{try{let l;for(let r=0,d=this.ViewableMessage.length;r<d;r++)if(n.id==this.ViewableMessage[r].message_id){l=r;break}if(void 0===l)throw"\uba54\uc2dc\uc9c0\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc74c";this.CopyMessageText(this.ViewableMessage[l]),this.message_detail(this.ViewableMessage[l],l)}catch(l){console.log("\uba54\uc2dc\uc9c0 \uc0c1\uc138\ubcf4\uae30 \uc2e4\ud328: ",l)}return!1})}},100)}open_ext_with_delay(){this.ScrollNearLogs(),this.isHidden=!this.isHidden}make_ext_hidden(){this.ScrollNearLogs(),"DesktopPWA"!=E.s1&&(this.isHidden=!0)}ScrollNearLogs(){this.NeedScrollDown()&&(this.ChatLogs.scrollTo({top:this.ChatLogs.scrollHeight,behavior:"smooth"}),setTimeout(()=>{this.ChatLogs.scrollTo({top:this.ChatLogs.scrollHeight,behavior:"smooth"})},150))}ResizeTextArea(){this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId)),this.userInputTextArea.style.height="36px"}check_key(i){this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId)),"DesktopPWA"==E.s1?"Enter"!=i.key||i.shiftKey||"keydown"!=i.type?setTimeout(()=>{this.ResizeTextArea(),this.userInputTextArea.style.height=this.userInputTextArea.scrollHeight+"px"},0):this.send(!0):setTimeout(()=>{this.ResizeTextArea(),this.userInputTextArea.style.height=this.userInputTextArea.scrollHeight+"px"},0)}send(i=!1){var t=this;return(0,m.c)(function*(){if(i&&("Android"==E.s1||"iOS"==E.s1))return;if(t.userInputTextArea||(t.userInputTextArea=document.getElementById(t.ChannelUserInputId)),!t.userInput.text.trim()&&!t.userInput.file&&!t.userInput.quickShare)return void setTimeout(()=>{t.userInput.text="",t.ResizeTextArea()},0);if(t.block_send)return;t.block_send=!0,t.userInputTextArea.style.maxHeight=`${t.userInputTextArea.offsetHeight}px`,t.userInputTextArea.focus(),setTimeout(()=>{t.userInputTextArea.focus()},0),t.isHidden=!0;let n={};n.msg=t.userInput.text;let l=!1,r=!1,d="";if(t.userInput.file){n.filename=t.userInput.file.filename,n.file_ext=t.userInput.file.file_ext,n.type=t.userInput.file.type;try{n.filesize=t.userInput.file.size||t.userInput.file.blob.size,n.partsize=Math.ceil(n.filesize/J.KY)}catch{n.url=t.userInput.file.url,r=!0}if(n.msg.length>800?(d=n.msg,delete n.msg):n.msg=n.msg,n.content_creator=t.userInput.file.content_creator,n.content_related_creator=t.userInput.file.content_related_creator,!r&&!t.info.local&&2!=t.useFirstCustomCDN)try{let g=t.nakama.servers[t.isOfficial][t.target].info.address,I=t.nakama.servers[t.isOfficial][t.target].info.useSSL?"https:":"http:",R=`${t.info.group_id||(t.info.user_id_one==t.nakama.servers[t.isOfficial][t.target].session.user_id?t.info.user_id_two:t.info.user_id_one)}_${t.nakama.servers[t.isOfficial][t.target].session.user_id}`,C=yield t.global.upload_file_to_storage(t.userInput.file,R,I,g,1==t.useFirstCustomCDN);if(r=!!C,!r)throw"\ub9c1\ud06c \ub9cc\ub4e4\uae30 \uc2e4\ud328";delete n.partsize,n.url=C}catch(g){console.log("cdn \uc5c5\ub85c\ub4dc \ucc98\ub9ac \uc2e4\ud328: ",g)}l=!0;for(let g=0,I=n.content_related_creator.length;g<I;g++)delete n.content_related_creator[g].is_me,delete n.content_related_creator[g].timeDisplay,delete n.content_related_creator[g].various_display}else if(n.msg.length>800)return void t.LongTextMessageAsFile(n);t.userInput.quickShare&&(n.quickShare=t.userInput.quickShare),n.local_comp=Math.random();let u={content:JSON.parse(JSON.stringify(n))};if(t.nakama.content_to_hyperlink(u),t.info.local){let g=(new Date).getTime().toString();if(l&&!r)try{let C;if(t.useFirstCustomCDN&&(C=yield t.global.try_upload_to_user_custom_fs(t.userInput.file,t.nakama.users.self.display_name)),!C)throw"\uc5c5\ub85c\ub4dc \uc2e4\ud328";delete u.content.path,delete u.content.partsize,u.content.url=C}catch{let F=`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/files/msg_${g}.${t.userInput.file.file_ext}`;yield t.indexed.saveBlobToUserPath(t.userInput.file.blob,F)}delete t.userInput.quickShare,delete t.userInput.file,d&&(u.msg=d,t.LongTextMessageAsFile(u));let I=(new Date).toISOString(),R={channel_id:t.info.id,code:0,color:"888888",...u,create_time:I,update_time:I,sender_id:"local",message_id:g,user_display_name:t.nakama.users.self.display_name,is_me:!0};return t.SendLocalMessage(R),t.userInputTextArea.style.maxHeight=null,void(t.block_send=!1)}t.sending_msg.push(u),setTimeout(()=>{t.scroll_down_logs()},0);try{let g=yield t.nakama.servers[t.isOfficial][t.target].socket.writeChatMessage(t.info.id,n);l&&(r?t.auto_open_thumbnail({content:n,message_id:g.message_id}):t.indexed.saveBlobToUserPath(t.userInput.file.blob,`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/files/msg_${g.message_id}.${t.userInput.file.file_ext}`,()=>{t.auto_open_thumbnail({content:n,message_id:g.message_id})})),delete t.userInput.quickShare,delete t.userInput.file,t.userInput.text="",t.ResizeTextArea(),t.inputPlaceholder=t.lang.text.ChatRoom.input_placeholder,d&&(n.msg=d,t.LongTextMessageAsFile(n))}catch(g){3===g.code?t.p5toast.show({text:t.lang.text.ChatRoom.FailedToJoinChannel}):(console.log("\uc624\ub958 \uac80\ud1a0 \ud544\uc694: ",g),t.p5toast.show({text:`${t.lang.text.ChatRoom.FailedToSend}: ${"string"==typeof g?g:g.message}`})),setTimeout(()=>{t.userInput.text="",t.ResizeTextArea()},0),setTimeout(()=>{for(let I=t.sending_msg.length-1;I>=0;I--)t.sending_msg[I].content.local_comp==n.local_comp&&t.sending_msg.splice(I,1)},1500)}t.userInputTextArea.style.maxHeight=null,t.block_send=!1})()}open_url_link(i){var t=this;return(0,m.c)(function*(){if(0==i.indexOf("https://is2you2.github.io/pjcone_pwa/?")||0==i.indexOf("http://pjcone.ddns.net/?")){let n=t.global.CatchGETs(i)||{};t.global.initialize();try{yield t.nakama.AddressToQRCodeAct(n)}catch(l){t.p5toast.show({text:`${t.lang.text.ChatRoom.QRLinkFailed}: ${l}`})}}else window.open(i,"_system");t.userInputTextArea.focus(),t.SetOtherAct()})()}SendLocalMessage(i){let t=this.deserialize_text(i);this.nakama.ModulateTimeDate(i),this.nakama.channels_orig[this.isOfficial][this.target][i.channel_id].last_comment_time=i.update_time,this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].last_comment_id=i.message_id,this.nakama.rearrange_channels(),this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].update(i),this.nakama.saveListedMessage([i],this.info,this.isOfficial,this.target),2!=i.code&&(this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].last_comment=(i.content.filename?`(${this.lang.text.ChatRoom.attachments}) `:"")+(t||i.content.noti||(i.content.match?this.lang.text.ChatRoom.JoinWebRTCMatch:void 0)||"")),setTimeout(()=>{this.userInput.text="",this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId)),this.ResizeTextArea(),this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder},0)}LongTextMessageAsFile(i){var t=this;return(0,m.c)(function*(){let n=new Blob([i.msg]);yield t.indexed.saveBlobToUserPath(n,`tmp_files/chatroom/${t.lang.text.ChatRoom.LongText}_${i.msg.substring(0,10)}.txt`);let l={};l.blob=n,l.content_related_creator=[{user_id:t.info.local?"local":t.nakama.servers[t.isOfficial][t.target].session.user_id,timestamp:(new Date).getTime(),display_name:t.nakama.users.self.display_name,various:"long_text"}],l.content_creator={user_id:t.info.local?"local":t.nakama.servers[t.isOfficial][t.target].session.user_id,timestamp:(new Date).getTime(),display_name:t.nakama.users.self.display_name,various:"long_text"};let r=i.msg.substring(0,24);l.path=`tmp_files/chatroom/${t.lang.text.ChatRoom.LongText}_${r}~.txt`,l.file_ext="txt",l.filename=`[${t.lang.text.ChatRoom.LongText}] ${r}~.txt`,t.global.set_viewer_category_from_ext(l),l.type="text/plain",l.typeheader="text",delete i.msg,delete t.userInput.quickShare,delete t.userInput.file,t.userInput.text="",t.ResizeTextArea(),t.inputPlaceholder=t.lang.text.ChatRoom.input_placeholder,t.userInput.file=l,t.inputPlaceholder=`(${t.lang.text.ChatRoom.attachments}: ${t.userInput.file.filename})`,t.create_selected_thumbnail(),t.p5toast.show({text:t.lang.text.ChatRoom.CreateAsTextFile}),t.block_send=!1})()}SetOtherAct(){this.isOtherAct=!0,setTimeout(()=>{this.isOtherAct=!1},0)}message_detail(i,t){var n=this;return(0,m.c)(function*(){if(n.isOtherAct||"offline"==n.info.status||"missing"==n.info.status||i.content.user_update||i.content.gupdate||!i.is_me)return;let l=n.deserialize_text(i),r=l,d=i.content.url;if(i.content.viewer){try{if("image"!=i.content.viewer)throw"\uc774\ubbf8\uc9c0 \ud30c\uc77c\uc774 \uc544\ub2d8";let R=yield n.indexed.loadBlobFromUserPath(i.content.path,i.content.type);d=URL.createObjectURL(R)}catch{try{let C=yield n.indexed.loadBlobFromUserPath(`${i.content.path}_thumbnail.png`,i.content.type);d=URL.createObjectURL(C)}catch{}}r=`(${n.lang.text.ChatRoom.attachments}) ${r}`}let u=d?`<div style="text-align: center;">${r}</div>`:`<div>${r}</div>`;var R;n.alertCtrl.create({header:n.lang.text.ChatRoom.ManageChat,message:new q.AF(d?`<div style="width: 100%;"><img src="${d}" alt="${i.content.filename}" style="border-radius: 8px; max-height: 230px; position: relative; left: 50%; transform: translateX(-50%); ${n.info.HideAutoThumbnail?"filter: blur(6px);":""}"></div>`+u:u),buttons:[{text:n.lang.text.ChatRoom.EditChat,handler:()=>{var R;n.alertCtrl.create({header:n.lang.text.ChatRoom.EditChat,inputs:[{type:"textarea",value:l,placeholder:r}],buttons:[{text:n.lang.text.ChatRoom.EditChat,handler:(R=(0,m.c)(function*(C){let F=C[0]||r,L=!1,V=JSON.parse(JSON.stringify(i));if(V.content.msg=F,V.content.edited=!0,V.update_time=(new Date).toISOString(),n.info.local)L=!0;else try{yield n.nakama.servers[n.isOfficial][n.target].socket.updateChatMessage(n.info.id,i.message_id,V.content),L=!0}catch(oe){console.log("\uba54\uc2dc\uc9c0 \ud3b8\uc9d1 \uc694\uccad \uc624\ub958: ",oe)}L&&(V.code=1,n.info.local&&(n.nakama.content_to_hyperlink(V),V.update_time=Date.now(),n.SendLocalMessage(V)))}),function(F){return R.apply(this,arguments)})}]}).then(R=>{R.onWillDismiss().then(()=>{n.ionViewDidEnter()}),n.removeShortCutKey(),n.global.p5key.KeyShortCut.Escape=()=>{R.dismiss()},R.present()})}},{text:n.lang.text.UserFsDir.Delete,cssClass:"redfont",handler:(R=(0,m.c)(function*(){if(n.info.local){if(d)if(i.content.url)n.global.remove_file_from_storage(i.content.url);else{let C=`servers/${n.isOfficial}/${n.target}/channels/${n.info.id}/files/msg_${i.message_id}.${i.content.file_ext}`;try{yield n.indexed.removeFileFromUserPath(C)}catch{}try{yield n.indexed.removeFileFromUserPath(`${C}_thumbnail.png`)}catch{}}}else try{if(yield n.nakama.servers[n.isOfficial][n.target].socket.removeChatMessage(n.info.id,i.message_id),d)if(i.content.url)n.global.remove_file_from_storage(i.content.url);else{let C=yield n.loadingCtrl.create({message:n.lang.text.UserFsDir.DeleteFile});C.present();for(let L=0;L<i.content.partsize;L++){try{yield n.nakama.servers[n.isOfficial][n.target].client.deleteStorageObjects(n.nakama.servers[n.isOfficial][n.target].session,{object_ids:[{collection:`file_${i.channel_id.replace(/[.]/g,"_")}`,key:`msg_${i.message_id}_${L}`}]})}catch{}C.message=`${n.lang.text.UserFsDir.DeleteFile}: ${i.content.filename}_${i.content.partsize-L}`}let F=`servers/${n.isOfficial}/${n.target}/channels/${n.info.id}/files/msg_${i.message_id}.${i.content.file_ext}`;yield n.indexed.removeFileFromUserPath(F),yield n.indexed.removeFileFromUserPath(`${F}_thumbnail.png`),C.dismiss()}}catch(C){console.error("\ucc44\ub110 \uba54\uc2dc\uc9c0 \uc0ad\uc81c \uc624\ub958: ",C)}n.ViewableMessage.splice(t,1);for(let C=0,F=n.messages.length;C<F;C++)if(n.messages[C].message_id==i.message_id){n.messages.splice(C,1);break}i.update_time=Date.now(),i.code=2,n.SendLocalMessage(i);for(let C=n.ViewableMessage.length-1;C>=0;C--)n.modulate_chatmsg(C,n.ViewableMessage.length);n.p5toast.show({text:n.lang.text.ChatRoom.MsgRemoved})}),function(){return R.apply(this,arguments)})}]}).then(R=>{n.global.p5key.KeyShortCut.Escape=()=>{R.dismiss()},R.onDidDismiss().then(()=>{n.global.p5key.KeyShortCut.Escape=()=>{n.navCtrl.pop()},URL.revokeObjectURL(d),n.isOtherAct=!1}),R.present()})})()}deserialize_text(i){let t="";if(!i.content.msg)return t;for(let n=0,l=i.content.msg.length;n<l;n++){for(let r=0,d=i.content.msg[n].length;r<d;r++)t+=i.content.msg[n][r].text;n+1<l&&(t+="\n")}return t}file_detail(i){var t=this;return(0,m.c)(function*(){if(t.isOtherAct=!0,i.content.url)return t.open_viewer(i,i.content.url),void setTimeout(()=>{t.isOtherAct=!1},0);let n=`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/files/msg_${i.message_id}.${i.content.file_ext}`;try{if(!(yield t.indexed.checkIfFileExist(`${n}.history`)))throw"\uc378\ub124\uc77c \uc5f4\uae30";i.content.text=[t.lang.text.TodoDetail.WIP];let r=yield t.indexed.loadTextFromUserPath(`${n}.history`),d=JSON.parse(r);switch(delete i.content.text,d.type){case"upload":if(i.content.text=[t.lang.text.ChatRoom.uploading],t.nakama.WriteStorage_From_channel(i,n,t.isOfficial,t.target,d.index),i.content.transfer_index&&t.nakama.OnTransfer[t.isOfficial][t.target][i.channel_id][i.message_id].OnTransfer)throw"\uc804\uc1a1\uc791\uc5c5 \uc911, \uc378\ub124\uc77c \uc5f4\uae30";break;case"download":i.content.text=[t.lang.text.TodoDetail.WIP],yield t.nakama.ReadStorage_From_channel(i,n,t.isOfficial,t.target,d.index),t.NeedScrollDown()&&setTimeout(()=>{t.scroll_down_logs()},100)}}catch{(yield t.indexed.checkIfFileExist(n))?(i.content.text||(i.content.text=[t.lang.text.ChatRoom.downloaded]),t.indexed.loadBlobFromUserPath(n,i.content.type,d=>{i.content.path=n;let u=URL.createObjectURL(d);t.global.modulate_thumbnail(i.content,u),t.NeedScrollDown()&&setTimeout(()=>{t.scroll_down_logs()},100)}),t.open_viewer(i,n)):t.isHistoryLoaded||(i.content.text=[t.lang.text.TodoDetail.WIP],yield t.nakama.ReadStorage_From_channel(i,n,t.isOfficial,t.target),t.NeedScrollDown()&&setTimeout(()=>{t.scroll_down_logs()},400))}t.isOtherAct=!1})()}quickShare_act(i){var t=this;return(0,m.c)(function*(){t.SetOtherAct(),t.modalCtrl.create({component:te.i,componentProps:{data:i.content.quickShare}}).then(n=>{n.onDidDismiss().then(()=>{t.ionViewDidEnter()}),t.removeShortCutKey(),t.is_modal=!0,n.present()})})()}JoinWebRTCMatch(i){this.SetOtherAct(),this.nakama.JoinWebRTCMatch(i,this.isOfficial,this.target,this.info)}modulate_chatmsg(i,t){var n=this;return(0,m.c)(function*(){if(0!=t){if(n.ViewableMessage[i].showInfo||(n.ViewableMessage[i].showInfo={}),n.ViewableMessage[i].showInfo.date=!!n.ViewableMessage[i].msgDate,n.ViewableMessage[i].showInfo.sender=!n.ViewableMessage[i].content.noti,i-1>=0&&(n.ViewableMessage[i].showInfo.date=!!n.ViewableMessage[i].msgDate&&n.ViewableMessage[i].msgDate!=n.ViewableMessage[i-1].msgDate,n.ViewableMessage[i].showInfo.sender=!n.ViewableMessage[i].content.noti&&(n.ViewableMessage[i-1].isLastRead||n.ViewableMessage[i].sender_id!=n.ViewableMessage[i-1].sender_id||n.ViewableMessage[i-1].content.noti||n.ViewableMessage[i].msgDate!=n.ViewableMessage[i-1].msgDate||n.ViewableMessage[i].msgTime!=n.ViewableMessage[i-1].msgTime)),n.ViewableMessage[i].content.url)try{let l=yield n.indexed.loadBlobFromUserPath(`${n.ViewableMessage[i].content.path}_thumbnail.png`,"image/png"),r=URL.createObjectURL(l);return n.ViewableMessage[i].content.thumbnail=n.sanitizer.bypassSecurityTrustUrl(r),void setTimeout(()=>{URL.revokeObjectURL(r)},100)}catch{"image"==n.ViewableMessage[i].content.viewer&&n.ViewableMessage[i].content.url&&(n.ViewableMessage[i].content.thumbnail=n.ViewableMessage[i].content.url)}try{i+1<t&&(n.ViewableMessage[i+1].showInfo.date=!!n.ViewableMessage[i].msgDate&&n.ViewableMessage[i].msgDate!=n.ViewableMessage[i+1].msgDate,n.ViewableMessage[i+1].showInfo.sender=!n.ViewableMessage[i+1].content.noti&&(n.ViewableMessage[i].isLastRead||n.ViewableMessage[i].sender_id!=n.ViewableMessage[i+1].sender_id||n.ViewableMessage[i].content.noti||n.ViewableMessage[i].msgDate!=n.ViewableMessage[i+1].msgDate||n.ViewableMessage[i].msgTime!=n.ViewableMessage[i+1].msgTime))}catch{}}})()}ModulateFileEmbedMessage(i){var t=this;let n=`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${i.message_id}.${i.content.file_ext}`;i.content.path=n;try{i.content.transfer_index=this.nakama.OnTransfer[this.isOfficial][this.target][i.channel_id][i.message_id]}catch{}i.content.transfer_index||this.indexed.checkIfFileExist(`${n}.history`,l=>{l&&this.indexed.loadTextFromUserPath(`${n}.history`,(r,d)=>{if(r&&d){let u=JSON.parse(d);delete i.content.text,this.nakama.OnTransfer[this.isOfficial]||(this.nakama.OnTransfer[this.isOfficial]={}),this.nakama.OnTransfer[this.isOfficial][this.target]||(this.nakama.OnTransfer[this.isOfficial][this.target]={}),this.nakama.OnTransfer[this.isOfficial][this.target][i.channel_id]||(this.nakama.OnTransfer[this.isOfficial][this.target][i.channel_id]={}),this.nakama.OnTransfer[this.isOfficial][this.target][i.channel_id][i.message_id]||(this.nakama.OnTransfer[this.isOfficial][this.target][i.channel_id][i.message_id]={index:i.content.partsize-u.index}),i.content.transfer_index=this.nakama.OnTransfer[this.isOfficial][this.target][i.channel_id][i.message_id]}})}),this.global.set_viewer_category(i.content),this.indexed.checkIfFileExist(n,function(){var l=(0,m.c)(function*(r){if(r)i.content.text=[t.lang.text.ChatRoom.downloaded],t.indexed.loadBlobFromUserPath(n,i.content.type,d=>{i.content.path=n;let u=URL.createObjectURL(d);t.global.modulate_thumbnail(i.content,u),t.NeedScrollDown()&&setTimeout(()=>{t.scroll_down_logs()},100)});else try{let d=yield t.indexed.loadBlobFromUserPath(`${i.content.path}_thumbnail.png`,"image/png"),u=URL.createObjectURL(d);t.global.modulate_thumbnail(i.content,u)}catch{}});return function(r){return l.apply(this,arguments)}}())}toggle_thumbnail(){var i=this;return(0,m.c)(function*(){i.info.HideAutoThumbnail=!i.info.HideAutoThumbnail,i.nakama.save_channels_with_less_info()})()}open_viewer(i,t){var n=this;let l=[];for(let r=0,d=this.messages.length;r<d;r++)this.messages[r].content.filename&&l.push(this.messages[r]);this.lock_modal_open||(this.lock_modal_open=!0,this.removeShortCutKey(),this.modalCtrl.create({component:U.K,componentProps:{info:i,path:t,alt_path:t,isOfficial:this.isOfficial,target:this.target,relevance:l,local:this.info.local},cssClass:"fullscreen"}).then(r=>{r.onDidDismiss().then(d=>{if(this.lock_modal_open=!1,this.ionViewDidEnter(),d.data)switch(d.data.type){case"image":let u=[];if(d.data.msg.content.content_related_creator&&(u=[...d.data.msg.content.content_related_creator]),d.data.msg.content.content_creator){let g=!1;for(let I=0,R=u.length;I<R;I++)if(u[I].user_id==d.data.msg.content.content_creator.user_id){g=!0;break}g||u.push(d.data.msg.content.content_creator)}return void this.modalCtrl.create({component:N.S,componentProps:{path:d.data.path||t,width:d.data.width,height:d.data.height,isDarkMode:d.data.isDarkMode},cssClass:"fullscreen"}).then(g=>{g.onDidDismiss().then(()=>{this.ionViewDidEnter()}),g.onWillDismiss().then(function(){var I=(0,m.c)(function*(R){R.data&&(yield n.voidDraw_fileAct_callback(R,u))});return function(R){return I.apply(this,arguments)}}()),this.is_modal=!0,this.removeShortCutKey(),g.present()});case"text":this.selected_blobFile_callback_act(d.data.blob,d.data.contentRelated,"textedit")}this.noti.Current=this.info.cnoti_id,this.info.cnoti_id&&this.noti.ClearNoti(this.info.cnoti_id),this.noti.RemoveListener(`openchat${this.info.cnoti_id}`)}),this.removeShortCutKey(),this.noti.Current="IonicViewerPage",this.is_modal=!0,r.present()}))}voidDraw_fileAct_callback(i,t){var n=this;return(0,m.c)(function*(){try{n.userInput.file={},n.userInput.file.filename=i.data.name,n.userInput.file.file_ext="png",n.userInput.file.thumbnail=n.sanitizer.bypassSecurityTrustUrl(i.data.img),n.userInput.file.type="image/png",n.userInput.file.typeheader="image",t?(n.userInput.file.content_related_creator=t,n.userInput.file.content_creator={user_id:n.info.local?"local":n.nakama.servers[n.isOfficial][n.target].session.user_id,timestamp:(new Date).getTime(),display_name:n.nakama.users.self.display_name,various:"voidDraw"}):(n.userInput.file.content_related_creator=[{user_id:n.info.local?"local":n.nakama.servers[n.isOfficial][n.target].session.user_id,timestamp:(new Date).getTime(),display_name:n.nakama.users.self.display_name,various:"voidDraw"}],n.userInput.file.content_creator={user_id:n.info.local?"local":n.nakama.servers[n.isOfficial][n.target].session.user_id,timestamp:(new Date).getTime(),display_name:n.nakama.users.self.display_name,various:"voidDraw"}),yield n.indexed.saveBase64ToUserPath(i.data.img,`tmp_files/chatroom/${n.userInput.file.filename}`,l=>{n.userInput.file.blob=new Blob([l],{type:n.userInput.file.type})}),n.inputPlaceholder=`(${n.lang.text.ChatRoom.attachments}: ${n.userInput.file.filename})`}catch(l){console.error("godot-\uc774\ubbf8\uc9c0 \ud3b8\uc9d1 \uc0ac\uc6a9 \ubd88\uac00: ",l)}i.data.loadingCtrl.dismiss()})()}user_detail(i){this.lock_modal_open||(this.isOtherAct=!0,this.lock_modal_open=!0,i.is_me?this.modalCtrl.create({component:ee.w,componentProps:{isOfficial:this.info.server.isOfficial,target:this.info.server.target}}).then(t=>{t.onDidDismiss().then(n=>{this.isOtherAct=!1,this.ionViewDidEnter(),this.noti.Current=this.info.cnoti_id,this.info.cnoti_id&&this.noti.ClearNoti(this.info.cnoti_id),this.noti.RemoveListener(`openchat${this.info.cnoti_id}`)}),this.removeShortCutKey(),this.noti.Current="GroupServerPage",t.present(),this.lock_modal_open=!1}):this.modalCtrl.create({component:X.y,componentProps:{info:{user:this.nakama.load_other_user(i.sender_id,this.isOfficial,this.target)},group:this.info,has_admin:!1}}).then(t=>{t.onDidDismiss().then(n=>{this.ionViewDidEnter(),this.isOtherAct=!1,this.noti.Current=this.info.cnoti_id,this.info.cnoti_id&&this.noti.ClearNoti(this.info.cnoti_id),this.noti.RemoveListener(`openchat${this.info.cnoti_id}`)}),this.noti.Current="OthersProfilePage",this.removeShortCutKey(),t.present(),this.lock_modal_open=!1}))}ionViewWillLeave(){this.nakama.rearrange_channels(),this.nakama.channels_orig[this.isOfficial][this.target]&&this.nakama.channels_orig[this.isOfficial][this.target][this.info.id]&&delete this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].update,this.noti.Current=void 0,this.removeShortCutKey()}removeShortCutKey(){delete this.global.p5key.KeyShortCut.Escape,delete this.global.p5key.KeyShortCut.BottomTab,delete this.global.p5key.KeyShortCut.Digit,delete this.global.p5key.KeyShortCut.EnterAct}ngOnDestroy(){var i=this;return(0,m.c)(function*(){delete i.nakama.opened_page_info.channel,i.nakama.ChatroomLinkAct=void 0,i.p5canvas&&i.p5canvas.remove(),i.nakama.OnTransferMessage={};try{i.useVoiceRecording&&(yield Y.G.stopRecording())}catch{}delete i.nakama.StatusBarChangedCallback})()}}return(s=_).\u0275fac=function(i){return new(i||s)(e.GI1(M.qS),e.GI1(ae.wX),e.GI1(P.gV),e.GI1(P.E5),e.GI1(se.h),e.GI1(y.s),e.GI1($.Y),e.GI1(v.k),e.GI1(x.o),e.GI1(p.mI),e.GI1(J.A1),e.GI1(M.Kg),e.GI1(b.C),e.GI1(k.O),e.GI1(D._),e.GI1(M.iW))},s.\u0275cmp=e.In1({type:s,selectors:[["app-chat-room"]],decls:47,vars:21,consts:[[1,"ion-no-border"],["slot","start"],["defaultHref","portal/subscribes"],["class","top_icon","slot","end","name","eye-outline",3,"click",4,"ngIf"],["class","top_icon","slot","end","name","eye-off-outline",3,"click",4,"ngIf"],[1,"header_online_circle"],["scrollY","false"],["id","p5Drop_chatroom",2,"position","absolute","width","100%","height","100%","display","flex","pointer-events","none"],["id","main_table",1,"channel_bg",2,"width","100%","height","100%","background-color","var(--chatroom-background)"],[2,"height","100%"],[2,"vertical-align","top"],["id","chatroom_div",1,"main",2,"max-width","100vw"],["id","chatroom_content_div"],["button","",3,"disabled","click"],[3,"id",4,"ngFor","ngForOf"],["class","my_message_right my_sending_msg",4,"ngFor","ngForOf"],[1,"thumnails"],["class","thumnail_parts",3,"click",4,"ngIf"],["class","thumnail_parts","style","cursor: pointer;",4,"ngIf"],["id","input_table",2,"width","100%","background-color","var(--chatroom-input-background)"],["fill","clear","mode","md",1,"ion-text-center",3,"click"],["name","add"],[2,"width","100%","vertical-align","bottom"],[1,"TextAreaInput",3,"id","ngModel","placeholder","ngModelChange","keyup","keydown","click"],[4,"ngIf"],["fill","clear","mode","md","expand","block",3,"disabled","click"],["name","send"],["id","ext_menu",3,"hidden"],[1,"expanded"],["hidden","","type","file","id","local_channel","accept","image/*",3,"change"],["hidden","","type","file","id","backgroundImage_sel","accept","image/png",3,"change"],["hidden","","type","file","accept","*","multiple","",3,"id","change"],["style","display: inline-block;",4,"ngFor","ngForOf"],["slot","end","name","eye-outline",1,"top_icon",3,"click"],["slot","end","name","eye-off-outline",1,"top_icon",3,"click"],[3,"id"],["class","my_message_right",4,"ngIf"],["class","notice_form",3,"click",4,"ngIf"],["style","text-align: center; font-size: 16px; padding-top: 8px;",3,"click",4,"ngIf"],[1,"avatar_form"],["class","avatar_image",3,"click",4,"ngIf"],["class","message_form",4,"ngIf"],["class","quickShare_form",3,"click",4,"ngIf"],["class","file_message_form",4,"ngIf"],["class","message_content_form",4,"ngIf"],["class","read_last_here",4,"ngIf"],[2,"text-align","center","font-size","16px","padding-top","8px",3,"click"],["color","#888"],[1,"avatar_image",3,"click"],["alt","img",1,"avatar_image",3,"src"],[1,"message_form"],[2,"cursor","pointer",3,"click"],[3,"color"],[1,"time_form","message_span_form",3,"click"],[1,"quickShare_form",3,"click"],[1,"file_message_form"],["class","file_button",3,"style","click",4,"ngIf"],["class","file_name_form",3,"click",4,"ngIf"],["class","transfer_count",4,"ngIf"],[1,"file_button",3,"click"],[1,"file_info"],["class","text_seperator",4,"ngIf"],["class","file_info file_text_thumbnail",4,"ngFor","ngForOf"],[1,"text_seperator"],[1,"file_info","file_text_thumbnail"],[1,"file_name_form",3,"click"],[1,"file_thumbnail",3,"src","alt"],[1,"transfer_count"],[1,"message_content_form"],[1,"msg_balloon"],["class","msg_inside_balloon",4,"ngFor","ngForOf"],["class","edited_form",4,"ngIf"],[1,"msg_inside_balloon"],[4,"ngFor","ngForOf"],["class","text_span",3,"style","click",4,"ngIf"],["target","_system","onclick","return false;",3,"href","click",4,"ngIf"],[1,"text_span",3,"click"],["target","_system","onclick","return false;",3,"href","click"],[1,"edited_form"],[1,"read_last_here"],[1,"my_message_right"],[2,"display","inline-flex"],["class","my_file_message_form",3,"click",4,"ngIf"],["class","my_file_message_form",4,"ngIf"],["class","message_content_form my_file_message_form",4,"ngIf"],[1,"avatar_form","my_avatar_form"],["class","read_last_here",3,"click",4,"ngIf"],[1,"time_form","message_span_form_me",3,"click"],[1,"my_file_message_form",3,"click"],[1,"quickShare_form"],[1,"my_file_message_form"],[1,"message_content_form","my_file_message_form"],["alt","my_img",1,"avatar_image",3,"src"],[1,"read_last_here",3,"click"],[1,"notice_form",3,"click"],[1,"notice"],[1,"my_message_right","my_sending_msg"],["class","file_button",3,"style",4,"ngIf"],["class","file_name_form",4,"ngIf"],[1,"file_button"],[1,"file_name_form"],[1,"msg_balloon",2,"background-color","#8888"],["class","comp_local_content",3,"style","click",4,"ngIf"],["class","text_span","class","comp_local_content","onclick","return false;","target","_system",3,"href","click",4,"ngIf"],[1,"comp_local_content",3,"click"],["onclick","return false;","target","_system",1,"comp_local_content",3,"href","click"],[1,"thumnail_parts",3,"click"],[2,"padding","8px","text-align","center"],[1,"thumnail_parts",2,"cursor","pointer"],[3,"click",4,"ngIf"],[3,"click"],[2,"text-align","center","margin","4px","max-width","100vw"],["style","display: grid;","class","thumnail_parts",4,"ngIf"],["id","ChatroomSelectedImage","class","image_thumbnail",3,"src","alt",4,"ngIf"],["id","ChatroomSelectedImage",1,"image_thumbnail",3,"src","alt"],[1,"thumnail_parts",2,"display","grid"],[2,"text-align","center","padding","4px 0px"],[1,"bottom_thumbnail"],["class","text_span",3,"click",4,"ngIf"],["fill","clear","expand","block",3,"click"],["name","mic-outline"],[2,"display","inline-block"],[1,"ext_button",3,"hidden","click"],["slot","icon-only","style","width: 36px; height: 36px;",3,"name",4,"ngIf"],["class","ext_icon_img",3,"src","alt",4,"ngIf"],["slot","icon-only",2,"width","36px","height","36px",3,"name"],[1,"ext_icon_img",3,"src","alt"]],template:function(i,t){1&i&&(e.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),e.OEk(3),e.C$Y(),e.I0R(4,"ion-buttons",1),e.wR5(5,"ion-back-button",2),e.C$Y(),e.yuY(6,K,1,0,"ion-icon",3)(7,le,1,0,"ion-icon",4),e.wR5(8,"div",5),e.C$Y()(),e.I0R(9,"ion-content",6),e.wR5(10,"div",7),e.I0R(11,"table",8)(12,"tr",9)(13,"td",10)(14,"div",11)(15,"div",12)(16,"ion-item",13),e.qCj("click",function(){return t.pull_msg_history()}),e.I0R(17,"ion-label"),e.OEk(18),e.C$Y()(),e.yuY(19,Ne,4,4,"div",14)(20,st,4,3,"div",15),e.C$Y()(),e.I0R(21,"table",16),e.yuY(22,ot,4,1,"tr",17)(23,ut,3,1,"tr",18)(24,ht,3,1,"tr",17)(25,vt,6,4,"tr",17),e.C$Y()()(),e.I0R(26,"tr")(27,"td")(28,"div")(29,"table",19)(30,"tr")(31,"td")(32,"ion-button",20),e.qCj("click",function(){return t.open_ext_with_delay()}),e.wR5(33,"ion-icon",21),e.C$Y()(),e.I0R(34,"td",22)(35,"textarea",23),e.iHE("ngModelChange",function(l){return e.kNx(t.userInput.text,l)||(t.userInput.text=l),l}),e.qCj("keyup",function(l){return t.check_key(l)})("keydown",function(l){return t.check_key(l)})("click",function(){return t.make_ext_hidden()}),e.C$Y()(),e.yuY(36,xt,3,0,"td",24),e.I0R(37,"td")(38,"ion-button",25),e.qCj("click",function(){return t.send(!1)}),e.wR5(39,"ion-icon",26),e.C$Y()()()()()()(),e.I0R(40,"tr",27)(41,"td")(42,"div",28)(43,"input",29),e.qCj("change",function(l){return t.LocalChannelImageChanged(l)}),e.C$Y(),e.I0R(44,"input",30),e.qCj("change",function(l){return t.ChangeBackgroundImage(l)}),e.C$Y(),e.I0R(45,"input",31),e.qCj("change",function(l){return t.inputFileSelected(l)}),e.C$Y(),e.yuY(46,bt,6,6,"div",32),e.C$Y()()()()()),2&i&&(e.yG2(3),e.cNF(t.info.title||t.lang.text.ChatRoom.noname_chatroom),e.yG2(3),e.E7m("ngIf",!t.info.HideAutoThumbnail),e.yG2(),e.E7m("ngIf",t.info.HideAutoThumbnail),e.yG2(),e.m_g("background-color: "+t.statusBar.colors[t.info.status||"offline"]),e.yG2(8),e.E7m("disabled",void 0===t.next_cursor&&!t.ViewMsgIndex||!t.pullable),e.yG2(2),e.cNF(t.lang.text.ChatRoom.fetch_previous_chat),e.yG2(),e.E7m("ngForOf",t.ViewableMessage),e.yG2(),e.E7m("ngForOf",t.sending_msg),e.yG2(2),e.E7m("ngIf",t.userInput.quickShare),e.yG2(),e.E7m("ngIf",t.userInput.file),e.yG2(),e.E7m("ngIf",t.ShowGoToBottom&&!t.last_message_viewer.user_id),e.yG2(),e.E7m("ngIf",t.last_message_viewer.user_id),e.yG2(10),e.E7m("id",t.ChannelUserInputId),e.OKB("ngModel",t.userInput.text),e.E7m("placeholder",t.inputPlaceholder),e.yG2(),e.E7m("ngIf",t.isMobile),e.yG2(2),e.E7m("disabled",t.block_send||!t.info.status||"missing"==t.info.status||"offline"==t.info.status),e.yG2(2),e.E7m("hidden",t.isHidden),e.yG2(5),e.E7m("id",t.file_sel_id),e.yG2(),e.E7m("ngForOf",t.extended_buttons))},dependencies:[S.ay,S.u_,o.ot,o.ue,o._G,M.sn,M.GS,M._i,M.wB,M.Ko,M.Yb,M.QR,M.tM,M.Md,M.Im],styles:[".top_icon[_ngcontent-%COMP%]{width:28px;height:28px;padding-right:68px;cursor:pointer}.main[_ngcontent-%COMP%]{width:100%;height:100%;padding:8px;overflow-x:hidden;overflow-y:auto;scroll-behavior:smooth}.message_form[_ngcontent-%COMP%]{margin-top:8px;text-shadow:0px 0px 4px var(--chatroom-background),0px 0px 4px var(--chatroom-background),0px 0px 4px var(--chatroom-background)}.channel_bg[_ngcontent-%COMP%]{background-position:center;background-repeat:no-repeat;background-size:cover}.message_span_form[_ngcontent-%COMP%]{margin-left:8px}.message_span_form_me[_ngcontent-%COMP%]{margin-right:4px}.my_message_right[_ngcontent-%COMP%]{text-align:end;margin-bottom:-4px}.my_sending_msg[_ngcontent-%COMP%]{margin-bottom:0;padding-right:56px}.msg_balloon[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;border:16px;border-radius:16px;padding:5px 8px 8px;max-width:65vw}.msg_inside_balloon[_ngcontent-%COMP%]{text-align:start}.time_form[_ngcontent-%COMP%]{font-size:12px;color:#888}.file_message_form[_ngcontent-%COMP%]{display:flex;flex-direction:column}.my_file_message_form[_ngcontent-%COMP%]{text-align:right;text-align:-webkit-right}.file_name_form[_ngcontent-%COMP%]{margin-top:4px;max-width:192px;max-height:192px}.file_thumbnail[_ngcontent-%COMP%]{max-width:192px;max-height:192px;width:auto;height:auto;border-radius:8px;cursor:pointer}.file_info[_ngcontent-%COMP%]{margin:0 4px;text-align:start}.file_text_thumbnail[_ngcontent-%COMP%]{margin-top:2px;display:grid}.quickShare_form[_ngcontent-%COMP%]{border-radius:16px;max-width:156px;width:-moz-fit-content;width:fit-content;height:-moz-fit-content;height:fit-content;padding:8px 12px;margin:4px 0 0;text-align:center;vertical-align:middle;word-break:keep-all;overflow:hidden;background-color:var(--chatroom-you-read-here-backgruond)}.message_content_form[_ngcontent-%COMP%]{display:inline-flex;margin:4px 0 0;place-self:flex-end}.edited_form[_ngcontent-%COMP%]{color:#888;font-size:12px;margin:0 8px;align-self:flex-end;padding-bottom:2px}.avatar_form[_ngcontent-%COMP%]{width:56px;vertical-align:top;padding:12px 8px 0 0;max-width:56px}.my_avatar_form[_ngcontent-%COMP%]{padding:12px 0 0 8px}.avatar_image[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:64px;object-fit:cover;cursor:pointer}.comp_local_content[_ngcontent-%COMP%]{color:#888}.text_seperator[_ngcontent-%COMP%]{background-color:#fff;margin-top:2px;position:relative;width:100%;height:2px}.file_button[_ngcontent-%COMP%]{width:160px;height:112px;overflow:hidden;background-color:gray;margin-top:4px;border-radius:8px;cursor:pointer}#send_thumbnail[_ngcontent-%COMP%]{width:100%;max-width:100vw;height:-moz-fit-content;height:fit-content;max-height:160px;transform:translateY(-100%);position:relative;background:#bbbb;padding:8px;overflow:hidden}.bottom_thumbnail[_ngcontent-%COMP%]{width:100%;max-width:100vw;max-height:96px;overflow:hidden;padding:8px}.image_thumbnail[_ngcontent-%COMP%]{width:auto;max-height:96px;height:auto;object-fit:contain;display:block;margin:auto;padding:8px}.thumnails[_ngcontent-%COMP%]{width:100%;height:-moz-fit-content;height:fit-content;position:relative;transform:translateY(-100%);background:var(--chatroom-last-msg-viewer-bg);padding:8px}.thumnail_parts[_ngcontent-%COMP%]{max-height:96px;overflow-y:scroll;max-width:100vw}.transfer_count[_ngcontent-%COMP%]{align-self:flex-end;margin-left:4px}.notice_form[_ngcontent-%COMP%]{text-align:center;margin:12px}.notice[_ngcontent-%COMP%]{font-size:12px;display:inline;background:#444;border-radius:8px;padding:4px 8px;color:#fff}.read_last_here[_ngcontent-%COMP%]{text-align:center;font-size:12px;display:inherit;background:var(--chatroom-you-read-here-backgruond);margin:4px 0;color:var(--chatroom-you-read-here-text)}.text_span[_ngcontent-%COMP%]{white-space:break-spaces}.ext_icon_img[_ngcontent-%COMP%]{max-width:36px;max-height:36px}.md[_ngcontent-%COMP%]   .TextAreaInput[_ngcontent-%COMP%]{width:100%;height:36px;max-height:156px;resize:none;padding:6px;margin-top:5px;border:0;overflow:hidden;background-color:var(--chatroom-input-background)}.ios[_ngcontent-%COMP%]   .TextAreaInput[_ngcontent-%COMP%]{width:100%;height:60px;max-height:156px;resize:none;padding:6px;margin-top:5px;border:0;overflow:hidden;background-color:var(--chatroom-input-background)}.expanded[_ngcontent-%COMP%]{height:240px;overflow-x:hidden;overflow-y:auto;scroll-behavior:smooth;text-align:center;background-color:var(--chatroom-input-background)}ion-button[_ngcontent-%COMP%]{--padding-start: 12px;--padding-end: 12px}"]}),_})()},{path:"ionic-viewer",loadChildren:()=>h.e(3136).then(h.bind(h,3136)).then(s=>s.IonicViewerPageModule)},{path:"void-draw",loadChildren:()=>h.e(2454).then(h.bind(h,2454)).then(s=>s.VoidDrawPageModule)},{path:"quick-share-review",loadChildren:()=>h.e(8812).then(h.bind(h,8812)).then(s=>s.QuickShareReviewPageModule)}];let Rt=(()=>{var s;class _{}return(s=_).\u0275fac=function(i){return new(i||s)},s.\u0275mod=e.a4G({type:s}),s.\u0275inj=e.s3X({imports:[P.qQ.forChild(It),P.qQ]}),_})(),kt=(()=>{var s;class _{}return(s=_).\u0275fac=function(i){return new(i||s)},s.\u0275mod=e.a4G({type:s}),s.\u0275inj=e.s3X({imports:[S.MD,o.y,M.wZ,Rt]}),_})()},192:(j,A,h)=>{h.d(A,{i:()=>se});var S=h(1528),o=h(4496),M=h(4500),P=h(9240),m=h(5624),q=h(7136),Q=h(3824),X=h(5020),E=h(1368),U=h(4716);function N(y,$){1&y&&o.wR5(0,"ion-icon",16)}function J(y,$){1&y&&o.wR5(0,"ion-icon",17)}function Z(y,$){if(1&y){const v=o.KQA();o.I0R(0,"ion-accordion",7)(1,"ion-item",8),o.yuY(2,N,1,0,"ion-icon",9)(3,J,1,0,"ion-icon",10),o.I0R(4,"ion-label"),o.OEk(5),o.C$Y()(),o.I0R(6,"div",11)(7,"ion-item",4),o.qCj("click",function(){const b=o.usT(v).$implicit;return o.CGJ(b.grant=!b.grant)}),o.I0R(8,"ion-toggle",12),o.iHE("ngModelChange",function(p){const k=o.usT(v).$implicit;return o.kNx(k.grant,p)||(k.grant=p),o.CGJ(p)}),o.OEk(9),o.C$Y()(),o.I0R(10,"ion-item",13)(11,"ion-label"),o.OEk(12),o.C$Y(),o.I0R(13,"ion-label",14),o.OEk(14),o.C$Y()(),o.I0R(15,"ion-item",13)(16,"ion-label"),o.OEk(17),o.C$Y(),o.I0R(18,"ion-label",14),o.OEk(19),o.C$Y()(),o.I0R(20,"ion-item",13)(21,"ion-label"),o.OEk(22),o.C$Y(),o.I0R(23,"ion-label",14),o.OEk(24),o.C$Y()(),o.I0R(25,"ion-item",13)(26,"ion-toggle",15),o.iHE("ngModelChange",function(p){const k=o.usT(v).$implicit;return o.kNx(k.value.isSSL,p)||(k.value.isSSL=p),o.CGJ(p)}),o.OEk(27),o.C$Y()()()()}if(2&y){const v=$.$implicit,x=$.index,p=o.GaO(2);o.E7m("value",x),o.yG2(2),o.E7m("ngIf",!v.grant),o.yG2(),o.E7m("ngIf",v.grant),o.yG2(2),o.cNF(v.value.name),o.yG2(3),o.OKB("ngModel",v.grant),o.yG2(),o.cNF(p.lang.text.QuickShareReview.QuickShareGrant),o.yG2(3),o.cNF(p.lang.text.GroupServer.Address),o.yG2(2),o.cNF(v.value.address),o.yG2(3),o.cNF(p.lang.text.GroupServer.Port),o.yG2(2),o.cNF(v.value.port||7350),o.yG2(3),o.cNF(p.lang.text.GroupServer.Key),o.yG2(2),o.cNF(v.value.key||"defaultkey"),o.yG2(2),o.OKB("ngModel",v.value.isSSL),o.yG2(),o.cNF(p.lang.text.GroupServer.isSSL)}}function H(y,$){if(1&y&&(o.I0R(0,"div")(1,"ion-item-divider")(2,"ion-label"),o.OEk(3),o.C$Y()(),o.I0R(4,"ion-accordion-group"),o.yuY(5,Z,28,14,"ion-accordion",6),o.C$Y()()),2&y){const v=o.GaO();o.yG2(3),o.cNF(v.lang.text.QuickShareReview.Servers),o.yG2(2),o.E7m("ngForOf",v.servers)}}function ee(y,$){1&y&&o.wR5(0,"ion-icon",16)}function te(y,$){1&y&&o.wR5(0,"ion-icon",17)}function z(y,$){if(1&y){const v=o.KQA();o.I0R(0,"ion-accordion",7)(1,"ion-item",8),o.yuY(2,ee,1,0,"ion-icon",9)(3,te,1,0,"ion-icon",10),o.I0R(4,"ion-label"),o.OEk(5),o.C$Y()(),o.I0R(6,"div",11)(7,"ion-item",4),o.qCj("click",function(){const b=o.usT(v).$implicit;return o.CGJ(b.grant=!b.grant)}),o.I0R(8,"ion-toggle",12),o.iHE("ngModelChange",function(p){const k=o.usT(v).$implicit;return o.kNx(k.grant,p)||(k.grant=p),o.CGJ(p)}),o.OEk(9),o.C$Y()()()()}if(2&y){const v=$.$implicit,x=$.index,p=o.GaO(2);o.E7m("value",x),o.yG2(2),o.E7m("ngIf",!v.grant),o.yG2(),o.E7m("ngIf",v.grant),o.yG2(2),o.cNF(v.name),o.yG2(3),o.OKB("ngModel",v.grant),o.yG2(),o.cNF(p.lang.text.QuickShareReview.QuickShareGrant)}}function ie(y,$){if(1&y&&(o.I0R(0,"div")(1,"ion-item-divider")(2,"ion-label"),o.OEk(3),o.C$Y()(),o.I0R(4,"ion-accordion-group"),o.yuY(5,z,10,6,"ion-accordion",6),o.C$Y()()),2&y){const v=o.GaO();o.yG2(3),o.cNF(v.lang.text.QuickShareReview.Channels),o.yG2(2),o.E7m("ngForOf",v.groups)}}function W(y,$){1&y&&o.wR5(0,"ion-icon",16)}function ne(y,$){1&y&&o.wR5(0,"ion-icon",17)}function Y(y,$){if(1&y&&(o.I0R(0,"ion-item")(1,"ion-label"),o.OEk(2),o.C$Y()()),2&y){const v=$.$implicit;o.yG2(2),o.cNF(v)}}function e(y,$){if(1&y){const v=o.KQA();o.I0R(0,"ion-accordion",7)(1,"ion-item",8),o.yuY(2,W,1,0,"ion-icon",9)(3,ne,1,0,"ion-icon",10),o.I0R(4,"ion-label"),o.OEk(5),o.C$Y()(),o.I0R(6,"div",11),o.yuY(7,Y,3,1,"ion-item",18),o.I0R(8,"ion-item",4),o.qCj("click",function(){const b=o.usT(v).$implicit;return o.CGJ(b.grant=!b.grant)}),o.I0R(9,"ion-toggle",12),o.iHE("ngModelChange",function(p){const k=o.usT(v).$implicit;return o.kNx(k.grant,p)||(k.grant=p),o.CGJ(p)}),o.OEk(10),o.C$Y()()()()}if(2&y){const v=$.$implicit,x=$.index,p=o.GaO(2);o.E7m("value",x),o.yG2(2),o.E7m("ngIf",!v.grant),o.yG2(),o.E7m("ngIf",v.grant),o.yG2(2),o.cNF(v.value.urls[0]),o.yG2(2),o.E7m("ngForOf",v.value.urls),o.yG2(2),o.OKB("ngModel",v.grant),o.yG2(),o.cNF(p.lang.text.QuickShareReview.QuickShareGrant)}}function ae(y,$){if(1&y&&(o.I0R(0,"div")(1,"ion-item-divider")(2,"ion-label"),o.OEk(3),o.C$Y()(),o.I0R(4,"ion-accordion-group"),o.yuY(5,e,11,7,"ion-accordion",6),o.C$Y()()),2&y){const v=o.GaO();o.yG2(3),o.cNF(v.lang.text.QuickShareReview.Channels),o.yG2(2),o.E7m("ngForOf",v.rtcserver)}}let se=(()=>{var y;class ${constructor(x,p,b,k,D,K){this.lang=x,this.navParams=p,this.modalCtrl=b,this.nakama=k,this.p5toast=D,this.global=K,this.servers=[],this.groups=[],this.rtcserver=[],this.BackButtonPressed=!1}InitBrowserBackButtonOverride(){window.history.replaceState(null,null,window.location.href),window.onpopstate=()=>{this.BackButtonPressed||(this.BackButtonPressed=!0,this.modalCtrl.dismiss())}}ngOnInit(){var x=this;return(0,S.c)(function*(){x.InitBrowserBackButtonOverride();let p=x.navParams.get("data"),b=x.global.CatchGETs(p),k=yield x.nakama.AddressToQRCodeAct(b,!0);for(let D=0,K=k.length;D<K;D++)switch(k[D].type){case"server":x.servers.push(k[D]);break;case"group":x.groups.push(k[D]);break;case"rtcserver":x.rtcserver.push(k[D])}})()}apply_selected(){var x=this;return(0,S.c)(function*(){let p=[];for(let b=0,k=x.servers.length;b<k;b++)x.servers[b].grant&&p.push(x.servers[b]);for(let b=0,k=x.groups.length;b<k;b++)x.groups[b].grant&&p.push(x.groups[b]);for(let b=0,k=x.rtcserver.length;b<k;b++)x.rtcserver[b].grant&&p.push(x.rtcserver[b]);yield x.nakama.act_from_QRInfo(p),x.p5toast.show({text:x.lang.text.QuickQRShare.success_received,lateable:!0}),x.modalCtrl.dismiss()})()}}return(y=$).\u0275fac=function(x){return new(x||y)(o.GI1(M.o),o.GI1(P.a6),o.GI1(m.qS),o.GI1(q.h),o.GI1(Q.O),o.GI1(X.A1))},y.\u0275cmp=o.In1({type:y,selectors:[["app-quick-share-review"]],decls:14,vars:5,consts:[[1,"ion-no-border"],["slot","start",3,"click"],["defaultHref",""],[4,"ngIf"],["button","",3,"click"],[1,"ion-text-center"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["slot","header"],["color","danger","slot","start","name","close-outline",4,"ngIf"],["color","success","slot","start","name","checkmark-outline",4,"ngIf"],["slot","content"],[1,"ion_toggle_ignore",3,"ngModel","ngModelChange"],["button",""],[1,"ion-text-end"],["disabled","",1,"ion_toggle_ignore",3,"ngModel","ngModelChange"],["color","danger","slot","start","name","close-outline"],["color","success","slot","start","name","checkmark-outline"],[4,"ngFor","ngForOf"]],template:function(x,p){1&x&&(o.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),o.OEk(3),o.C$Y(),o.I0R(4,"ion-buttons",1),o.qCj("click",function(){return p.modalCtrl.dismiss()}),o.wR5(5,"ion-back-button",2),o.C$Y()()(),o.I0R(6,"ion-content"),o.yuY(7,H,6,2,"div",3)(8,ie,6,2,"div",3)(9,ae,6,2,"div",3),o.C$Y(),o.I0R(10,"ion-footer")(11,"ion-item",4),o.qCj("click",function(){return p.apply_selected()}),o.I0R(12,"ion-label",5),o.OEk(13),o.C$Y()()()),2&x&&(o.yG2(3),o.cNF(p.lang.text.QuickShareReview.Title),o.yG2(4),o.E7m("ngIf",p.servers.length),o.yG2(),o.E7m("ngIf",p.groups.length),o.yG2(),o.E7m("ngIf",p.rtcserver.length),o.yG2(4),o.cNF(p.lang.text.QuickShareReview.ApplyChecked))},dependencies:[E.ay,E.u_,U.ue,U._G,m.cm,m.qU,m.GS,m._i,m.eV,m.wB,m.Ko,m.Yb,m.S8,m.QR,m.tM,m.E$,m.Md,m.UJ,m.Im],styles:[".ion_toggle_ignore[_ngcontent-%COMP%]{pointer-events:none}"]}),$})()}}]);