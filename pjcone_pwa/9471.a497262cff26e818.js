"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9471],{9471:(M,h,u)=>{u.r(h),u.d(h,{AdminToolsPageModule:()=>G});var g=u(9808),c=u(4182),_=u(3996),p=u(9705),d=u(655),m=u(3260),i=u(9863),f=u(5742),T=u(9912),x=u(3336),A=u(4606),Z=u(4299);const v=["UserSel"],k=["GroupSel"];function O(r,l){if(1&r){const t=i.EpF();i.TgZ(0,"ion-item",21),i.NdJ("click",function(){const n=i.CHM(t).index;return i.oxw(2).select_server(n)}),i.TgZ(1,"ion-label"),i._uU(2),i.qZA()()}if(2&r){const t=l.$implicit;i.xp6(2),i.Oqu(t.name)}}function q(r,l){if(1&r){const t=i.EpF();i.TgZ(0,"ion-accordion-group",14,15),i.NdJ("click",function(){return i.CHM(t),i.oxw().isExpanded=!0}),i.TgZ(2,"ion-accordion",16)(3,"ion-item",17)(4,"ion-label"),i._uU(5),i.qZA(),i.TgZ(6,"ion-label",18),i._uU(7),i.qZA()(),i.TgZ(8,"ion-list",19),i.YNc(9,O,3,1,"ion-item",20),i.qZA()()()}if(2&r){const t=i.oxw();i.Q6J("value",t.isExpanded),i.xp6(5),i.Oqu(t.lang.text.AddGroup.SelectServer),i.xp6(2),i.Oqu(t.servers[t.index].name),i.xp6(2),i.Q6J("ngForOf",t.servers)}}function P(r,l){if(1&r&&i._UZ(0,"img",32),2&r){const t=i.oxw().$implicit,e=i.oxw();i.Q6J("src",e.all_users[t].img,i.LSH)}}function U(r,l){if(1&r){const t=i.EpF();i.TgZ(0,"div")(1,"ion-accordion",22)(2,"ion-item",23)(3,"div",24),i.YNc(4,P,1,1,"img",25),i.qZA(),i._UZ(5,"div",26),i.TgZ(6,"ion-label",27),i._uU(7),i.qZA()(),i.TgZ(8,"ion-list",19)(9,"ion-item",8),i.NdJ("click",function(){const n=i.CHM(t).$implicit,o=i.oxw();return o.copy_id(o.all_users[n].id)}),i.TgZ(10,"ion-label",28),i._uU(11),i.qZA()(),i.TgZ(12,"ion-item",29)(13,"ion-label"),i._uU(14),i.qZA(),i.TgZ(15,"ion-label",30),i._uU(16),i.qZA()(),i.TgZ(17,"ion-item",21),i.NdJ("click",function(){const n=i.CHM(t).$implicit,o=i.oxw();return o.start_private_chat(o.all_users[n])}),i.TgZ(18,"ion-label"),i._uU(19),i.qZA()(),i.TgZ(20,"ion-item",21),i.NdJ("click",function(){const n=i.CHM(t).$implicit,o=i.oxw();return o.remove_user(o.all_users[n])}),i.TgZ(21,"ion-label",31),i._uU(22),i.qZA()()()()()}if(2&r){const t=l.$implicit,e=i.oxw();i.xp6(1),i.Q6J("value",e.all_users[t].id),i.xp6(3),i.Q6J("ngIf",e.all_users[t].img),i.xp6(1),i.Akn("background-color: "+e.statusBar.colors[void 0===e.all_users[t].online?"pending":e.all_users[t].online?"online":"offline"]),i.xp6(2),i.Oqu(e.all_users[t].display_name||e.lang.text.Profile.noname_user),i.xp6(4),i.Oqu(e.all_users[t].id),i.xp6(3),i.Oqu(e.lang.text.AddGroup.LanguageTag),i.xp6(2),i.Oqu(e.all_users[t].lang_tag),i.xp6(3),i.Oqu(e.lang.text.OtherProfile.privacy_chat),i.xp6(3),i.Oqu(e.lang.text.AdminTools.ForceLeave)}}function C(r,l){if(1&r&&i._UZ(0,"img",32),2&r){const t=i.oxw().$implicit,e=i.oxw();i.Q6J("src",e.all_groups[t].img,i.LSH)}}function S(r,l){if(1&r&&i._UZ(0,"img",32),2&r){const t=i.oxw().$implicit,e=i.oxw(2);i.Q6J("src",t.is_me?e.nakama.users.self.img:e.nakama.users[e.isOfficial][e.target][t.user.id].img,i.LSH)}}function b(r,l){if(1&r){const t=i.EpF();i.TgZ(0,"div")(1,"ion-item",21),i.NdJ("click",function(){const n=i.CHM(t).$implicit,o=i.oxw(2);return o.copy_id(n.user.id),o.find_current_user_id(n.user.id)}),i.TgZ(2,"div",24),i.YNc(3,S,1,1,"img",25),i.qZA(),i.TgZ(4,"ion-label"),i._uU(5),i.qZA()()()}if(2&r){const t=l.$implicit,e=i.oxw(2);i.xp6(3),i.Q6J("ngIf",t.is_me?e.nakama.users.self.img:e.nakama.users[e.isOfficial][e.target][t.user.id].img),i.xp6(2),i.Oqu((t.is_me?e.nakama.users.self.display_name:t.user.display_name)||e.lang.text.Profile.noname_user)}}function I(r,l){if(1&r){const t=i.EpF();i.TgZ(0,"div")(1,"ion-accordion",22)(2,"ion-item",23)(3,"div",24),i.YNc(4,C,1,1,"img",25),i.qZA(),i._UZ(5,"div",26),i.TgZ(6,"ion-label",27),i._uU(7),i.qZA()(),i.TgZ(8,"ion-list",19)(9,"ion-item",8),i.NdJ("click",function(){const n=i.CHM(t).$implicit,o=i.oxw();return o.copy_id(o.all_groups[n].id)}),i.TgZ(10,"ion-label",28),i._uU(11),i.qZA()(),i.TgZ(12,"ion-item",29)(13,"ion-label"),i._uU(14),i.qZA(),i.TgZ(15,"ion-label",30),i._uU(16),i.qZA()(),i.TgZ(17,"ion-item",8),i.NdJ("click",function(){const n=i.CHM(t).$implicit,o=i.oxw();return o.copy_id(o.all_groups[n].creator_id),o.find_current_user_id(o.all_groups[n].creator_id)}),i.TgZ(18,"ion-label",33),i._uU(19),i.qZA(),i.TgZ(20,"ion-label",34),i._uU(21),i.qZA()(),i.TgZ(22,"ion-accordion-group",null,35)(24,"ion-accordion",22)(25,"ion-item",23)(26,"ion-label"),i._uU(27),i.qZA(),i.TgZ(28,"ion-label",30),i._uU(29),i.qZA()(),i.TgZ(30,"ion-list",19),i.YNc(31,b,6,2,"div",12),i.qZA()()(),i.TgZ(32,"ion-item-divider")(33,"ion-label"),i._uU(34),i.qZA()(),i.TgZ(35,"textarea",36),i.NdJ("ngModelChange",function(s){const o=i.CHM(t).$implicit;return i.oxw().all_groups[o].description=s}),i.qZA(),i.TgZ(36,"ion-item",21),i.NdJ("click",function(){const n=i.CHM(t).$implicit,o=i.oxw();return o.force_breakup_group(o.all_groups[n])}),i.TgZ(37,"ion-label",31),i._uU(38),i.qZA()()()()()}if(2&r){const t=l.$implicit,e=i.oxw();i.xp6(1),i.Q6J("value",e.all_groups[t].name),i.xp6(3),i.Q6J("ngIf",e.all_groups[t].img),i.xp6(1),i.Akn("background-color: "+e.statusBar.colors[e.all_groups[t].open?"online":"pending"]),i.xp6(2),i.Oqu(e.all_groups[t].name),i.xp6(4),i.Oqu(e.all_groups[t].id),i.xp6(3),i.Oqu(e.lang.text.AddGroup.LanguageTag),i.xp6(2),i.Oqu(e.all_groups[t].lang_tag),i.xp6(3),i.Oqu(e.lang.text.AdminTools.GroupCreator),i.xp6(2),i.hij(" ",e.nakama.users[e.isOfficial][e.target][e.all_groups[t].creator_id]?e.nakama.users[e.isOfficial][e.target][e.all_groups[t].creator_id].display_name:e.nakama.users.self.display_name," "),i.xp6(3),i.Q6J("value",e.all_groups[t].name+"_user"),i.xp6(3),i.Oqu(e.lang.text.AdminTools.GroupUserCounter),i.xp6(2),i.Oqu(e.all_groups[t].edge_count+" / "+e.all_groups[t].max_count),i.xp6(2),i.Q6J("ngForOf",e.all_groups[t].users),i.xp6(3),i.Oqu(e.lang.text.AddGroup.GroupDetail_placeholder),i.xp6(1),i.Q6J("ngModel",e.all_groups[t].description),i.xp6(3),i.Oqu(e.lang.text.AdminTools.ForceBreakUp)}}const E=[{path:"",component:(()=>{class r{constructor(t,e,s,n,o,a){this.lang=t,this.nakama=e,this.p5toast=s,this.alertCtrl=n,this.statusBar=o,this.mClipboard=a,this.servers=[],this.index=0,this.isExpanded=!0,this.notification={uri:"",msg:""},this.is_sending=!1,this.all_users=[],this.current_user_page=1,this.all_user_page=1,this.current_user_size=[],this.all_groups=[],this.current_group_page=1,this.all_group_page=1,this.current_group_size=[],this.LIST_PAGE_SIZE=5}select_server(t){this.index=t,this.isOfficial=this.servers[t].isOfficial,this.target=this.servers[t].target,this.isExpanded=!1,this.refresh_all_user(),this.refresh_all_groups()}ngOnInit(){this.servers=this.nakama.get_all_server_info(!0,!0);for(let t=this.servers.length-1;t>=0;t--)this.servers[t].is_admin||this.servers.splice(t,1);this.select_server(0)}send_noti_to_server(){return(0,d.mG)(this,void 0,void 0,function*(){if(this.notification.msg||this.notification.uri){this.is_sending=!0,this.notification.msg=encodeURIComponent(this.notification.msg),this.notification.uri=encodeURIComponent(this.notification.uri);try{yield this.nakama.servers[this.isOfficial][this.target].client.rpc(this.nakama.servers[this.isOfficial][this.target].session,"send_noti_all_fn",this.notification)}catch(t){}this.notification.msg="",this.notification.uri="",this.is_sending=!1}else this.p5toast.show({text:this.lang.text.AdminTools.NoNotiMsg})})}refresh_all_user(){this.all_users.length=0,this.current_user_size.length=0,this.nakama.servers[this.isOfficial][this.target].client.rpc(this.nakama.servers[this.isOfficial][this.target].session,"query_all_users",{}).then(t=>{this.all_users=t.payload;for(let e=0,s=this.all_users.length;e<s;e++)this.nakama.save_other_user(this.all_users[e],this.isOfficial,this.target),this.all_users[e]=this.nakama.load_other_user(this.all_users[e].user_id||this.all_users[e].id,this.isOfficial,this.target);this.all_user_page=Math.ceil(this.all_users.length/this.LIST_PAGE_SIZE),this.current_user_page=0,this.change_user_list_page(1)}).catch(t=>{console.error("\uc0ac\uc6a9\uc790 \ub9ac\uc2a4\ud2b8 \ub3cc\ub824\ubc1b\uae30 \uc624\ub958: ",t)})}refresh_all_groups(){this.all_groups.length=0,this.current_group_size.length=0,this.nakama.servers[this.isOfficial][this.target].client.rpc(this.nakama.servers[this.isOfficial][this.target].session,"query_all_groups",{}).then(t=>{let e=t.payload;for(let s=0,n=e.length;s<n;s++){let o=Object.keys(e[s]);this.nakama.groups[this.isOfficial][this.target][e[s].id]||(this.nakama.groups[this.isOfficial][this.target][e[s].id]={}),o.forEach(a=>this.nakama.groups[this.isOfficial][this.target][e[s].id][a]=e[s][a]);for(let a=0,J=this.nakama.groups[this.isOfficial][this.target][e[a].id].users.length;a<J;a++)this.nakama.groups[this.isOfficial][this.target][e[a].id].users[a].user.user_id==this.nakama.servers[this.isOfficial][this.target].session.user_id?(this.nakama.groups[this.isOfficial][this.target][e[a].id].users[a].is_me=!0,this.nakama.groups[this.isOfficial][this.target][e[a].id].users[a].user=this.nakama.users.self):this.nakama.groups[this.isOfficial][this.target][e[a].id].users[a].user=this.nakama.load_other_user(this.nakama.groups[this.isOfficial][this.target][e[a].id].users[a].user.user_id,this.isOfficial,this.target);this.all_groups.push(this.nakama.groups[this.isOfficial][this.target][e[s].id])}this.all_group_page=Math.ceil(this.all_groups.length/this.LIST_PAGE_SIZE),this.current_group_page=0,this.change_group_list_page(1)}).catch(t=>{console.error("\uadf8\ub8f9 \ub9ac\uc2a4\ud2b8 \ub3cc\ub824\ubc1b\uae30 \uc624\ub958: ",t)})}find_current_user_id(t){for(let e=0,s=this.all_users.length;e<s;e++)if(this.all_users[e].id==t){this.current_user_page=Math.floor(e/5),this.change_user_list_page(1);break}this.UserSel.value=t}force_breakup_group(t){this.alertCtrl.create({header:t.name,message:this.lang.text.AdminTools.ForceBreakUp,buttons:[{text:this.lang.text.GroupDetail.BreakupGroup,cssClass:"danger",handler:()=>(0,d.mG)(this,void 0,void 0,function*(){try{yield this.nakama.servers[this.isOfficial][this.target].client.rpc(this.nakama.servers[this.isOfficial][this.target].session,"force_remove_group",{group_id:t.id}),this.p5toast.show({text:`${this.lang.text.AdminTools.ForceBreaked}: ${t.name}`}),this.refresh_all_user(),this.refresh_all_groups()}catch(e){this.p5toast.show({text:`${this.lang.text.AdminTools.ForceBreakedFailed}: ${e.statusText}`})}})}]}).then(e=>e.present())}change_user_list_page(t){switch(t){case 1:if(this.current_user_page<this.all_user_page){this.current_user_page+=1,this.current_user_size=Array(this.current_user_page==this.all_user_page?this.all_users.length%this.LIST_PAGE_SIZE==0?this.LIST_PAGE_SIZE:this.all_users.length%this.LIST_PAGE_SIZE:this.LIST_PAGE_SIZE);for(let e=0,s=this.current_user_size.length;e<s;e++)this.current_user_size[e]=(this.current_user_page-1)*this.LIST_PAGE_SIZE+e}break;case-1:if(this.current_user_page-1>0){this.current_user_page-=1,this.current_user_size=Array(this.LIST_PAGE_SIZE);for(let e=0,s=this.current_user_size.length;e<s;e++)this.current_user_size[e]=(this.current_user_page-1)*this.LIST_PAGE_SIZE+e}}this.UserSel.value=void 0}change_group_list_page(t){switch(t){case 1:if(this.current_group_page<this.all_group_page){this.current_group_page+=1,this.current_group_size=Array(this.current_group_page==this.all_group_page?this.all_groups.length%this.LIST_PAGE_SIZE==0?this.LIST_PAGE_SIZE:this.all_groups.length%this.LIST_PAGE_SIZE:this.LIST_PAGE_SIZE);for(let e=0,s=this.current_group_size.length;e<s;e++)this.current_group_size[e]=(this.current_group_page-1)*this.LIST_PAGE_SIZE+e}break;case-1:if(this.current_group_page-1>0){this.current_group_page-=1,this.current_group_size=Array(this.LIST_PAGE_SIZE);for(let e=0,s=this.current_group_size.length;e<s;e++)this.current_group_size[e]=(this.current_group_page-1)*this.LIST_PAGE_SIZE+e}}this.GroupSel.value=void 0}start_private_chat(t){this.nakama.join_chat_with_modulation(t.user_id||t.id,2,this.isOfficial,this.target,e=>{e&&this.nakama.go_to_chatroom_without_admob_act(e)},!0)}copy_id(t){this.mClipboard.copy(t).catch(e=>m.Z.write(t))}remove_user(t){this.alertCtrl.create({header:t.display_name||this.lang.text.Profile.noname_user,message:this.lang.text.AdminTools.ForceLeave,buttons:[{text:this.lang.text.AdminTools.ApplyLeave,cssClass:"danger",handler:()=>(0,d.mG)(this,void 0,void 0,function*(){try{yield this.nakama.servers[this.isOfficial][this.target].client.rpc(this.nakama.servers[this.isOfficial][this.target].session,"remove_account_fn",{user_id:t.user_id||t.id}),this.p5toast.show({text:`${this.lang.text.AdminTools.UserLeaved}: ${t.display_name||this.lang.text.Profile.noname_user}`}),this.refresh_all_user(),this.refresh_all_groups()}catch(e){this.p5toast.show({text:`${this.lang.text.AdminTools.UserLeavedFailed}: ${e.statusText}`})}})}]}).then(e=>e.present())}}return r.\u0275fac=function(t){return new(t||r)(i.Y36(f.b),i.Y36(T.a),i.Y36(x.F),i.Y36(_.Br),i.Y36(A.g),i.Y36(Z.T))},r.\u0275cmp=i.Xpm({type:r,selectors:[["app-admin-tools"]],viewQuery:function(t,e){if(1&t&&(i.Gf(v,5),i.Gf(k,5)),2&t){let s;i.iGM(s=i.CRH())&&(e.UserSel=s.first),i.iGM(s=i.CRH())&&(e.GroupSel=s.first)}},decls:55,vars:18,consts:[["slot","start"],["defaultHref","portal/settings"],["value","colors","expand","inset",3,"value","click",4,"ngIf"],[1,"ion-text-end",3,"ngModel","placeholder","ngModelChange"],[1,"infobox","content_size",3,"ngModel","placeholder","ngModelChange"],["button","",3,"disabled"],[1,"ion-text-center",3,"click"],["slot","end",2,"margin-right","8px"],[3,"click"],["slot","start","name","arrow-back-circle-outline",1,"icon_style"],["slot","start","name","arrow-forward-circle-outline",1,"icon_style"],["UserSel",""],[4,"ngFor","ngForOf"],["GroupSel",""],["value","colors","expand","inset",3,"value","click"],["accordionGroup",""],["value","colors"],["slot","header"],[1,"ion-text-right"],["slot","content"],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"],[3,"value"],["button","","slot","header"],[1,"additional_form","bg_img_form"],["class","profile_img",3,"src",4,"ngIf"],[1,"additional_form","status_bar_single"],[1,"form_margin"],["color","medium","text-wrap","",1,"ion-text-center"],["disabled",""],[1,"ion-text-end"],["color","danger",1,"ion-text-center"],[1,"profile_img",3,"src"],["color","medium"],["color","medium",1,"ion-text-end"],["GroupUserSel",""],["disabled","",1,"infobox",3,"ngModel","ngModelChange"]],template:function(t,e){1&t&&(i.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),i._uU(3),i.qZA(),i.TgZ(4,"ion-buttons",0),i._UZ(5,"ion-back-button",1),i.qZA()()(),i.TgZ(6,"ion-content"),i.YNc(7,q,10,4,"ion-accordion-group",2),i.TgZ(8,"ion-item-divider")(9,"ion-label"),i._uU(10),i.qZA()(),i.TgZ(11,"ion-item")(12,"ion-label"),i._uU(13),i.qZA(),i.TgZ(14,"ion-input",3),i.NdJ("ngModelChange",function(n){return e.notification.uri=n}),i.qZA()(),i.TgZ(15,"textarea",4),i.NdJ("ngModelChange",function(n){return e.notification.msg=n}),i.qZA(),i.TgZ(16,"ion-item",5)(17,"ion-label",6),i.NdJ("click",function(){return e.send_noti_to_server()}),i._uU(18),i.qZA()(),i.TgZ(19,"ion-item-divider")(20,"ion-label"),i._uU(21),i.qZA(),i.TgZ(22,"table",7)(23,"tr")(24,"td",8),i.NdJ("click",function(){return e.change_user_list_page(-1)}),i._UZ(25,"ion-icon",9),i.qZA(),i.TgZ(26,"td"),i._uU(27),i.qZA(),i.TgZ(28,"td"),i._uU(29,"/"),i.qZA(),i.TgZ(30,"td"),i._uU(31),i.qZA(),i.TgZ(32,"td",8),i.NdJ("click",function(){return e.change_user_list_page(1)}),i._UZ(33,"ion-icon",10),i.qZA()()()(),i.TgZ(34,"ion-accordion-group",null,11),i.YNc(36,U,23,10,"div",12),i.qZA(),i.TgZ(37,"ion-item-divider")(38,"ion-label"),i._uU(39),i.qZA(),i.TgZ(40,"table",7)(41,"tr")(42,"td",8),i.NdJ("click",function(){return e.change_group_list_page(-1)}),i._UZ(43,"ion-icon",9),i.qZA(),i.TgZ(44,"td"),i._uU(45),i.qZA(),i.TgZ(46,"td"),i._uU(47,"/"),i.qZA(),i.TgZ(48,"td"),i._uU(49),i.qZA(),i.TgZ(50,"td",8),i.NdJ("click",function(){return e.change_group_list_page(1)}),i._UZ(51,"ion-icon",10),i.qZA()()()(),i.TgZ(52,"ion-accordion-group",null,13),i.YNc(54,I,39,17,"div",12),i.qZA()()),2&t&&(i.xp6(3),i.Oqu(e.lang.text.Settings.admin_tools),i.xp6(4),i.Q6J("ngIf",e.servers.length),i.xp6(3),i.Oqu(e.lang.text.AdminTools.GlobalNoti),i.xp6(3),i.Oqu(e.lang.text.AdminTools.ImageURL),i.xp6(1),i.Q6J("ngModel",e.notification.uri)("placeholder",e.lang.text.AdminTools.EnterURI),i.xp6(1),i.Q6J("ngModel",e.notification.msg)("placeholder",e.lang.text.AdminTools.NoNotiMsg),i.xp6(1),i.Q6J("disabled",e.is_sending),i.xp6(2),i.Oqu(e.lang.text.AdminTools.Send),i.xp6(3),i.Oqu(e.lang.text.AdminTools.UserList),i.xp6(6),i.Oqu(e.current_user_page),i.xp6(4),i.Oqu(e.all_user_page),i.xp6(5),i.Q6J("ngForOf",e.current_user_size),i.xp6(3),i.Oqu(e.lang.text.AdminTools.GroupList),i.xp6(6),i.Oqu(e.current_group_page),i.xp6(4),i.Oqu(e.all_group_page),i.xp6(5),i.Q6J("ngForOf",e.current_group_size))},directives:[_.Gu,_.sr,_.wd,_.Sm,_.oU,_.cs,_.W2,g.O5,_.eh,_.We,_.Ie,_.Q$,_.q_,g.sg,_.rH,_.pK,_.j9,c.JJ,c.On,c.Fj,_.gu],styles:[".icon_style[_ngcontent-%COMP%]{width:22px;height:22px;transform:translateY(2px);margin-left:4px;margin-right:4px}"]}),r})()}];let y=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=i.oAB({type:r}),r.\u0275inj=i.cJS({imports:[[p.Bz.forChild(E)],p.Bz]}),r})(),G=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=i.oAB({type:r}),r.\u0275inj=i.cJS({imports:[[g.ez,c.u5,_.Pc,y]]}),r})()}}]);