"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2058],{2058:(_e,A,h)=>{h.r(A),h.d(A,{AddTodoMenuPageModule:()=>pe});var b=h(6814),k=h(95),_=h(1325),x=h(5877),I=h(5861),y=h(9868),M=h(9745),v=h(9080),w=h(3641),O=h(477),D=h(8162),C=h(1186),t=h(9468),S=h(3857),P=h(9376),U=h(6593),J=h(797),F=h(4093),B=h(7488),N=h(6052);const j=["StartCalendar"],q=["Calendar"],$=["NewAttach"],W=["StoreAt"],L=["ImporantSel"];function R(d,p){if(1&d&&(t.TgZ(0,"ion-select-option",42),t._uU(1),t.qZA()),2&d){const s=p.$implicit;t.Q6J("value",s),t.xp6(1),t.hij("",s.name," ")}}function Q(d,p){if(1&d){const s=t.EpF();t.TgZ(0,"ion-item",37),t.NdJ("click",function(){t.CHM(s);const i=t.oxw();return t.KtG(i.StoreAtSelClicked())}),t.TgZ(1,"ion-select",38,39),t.NdJ("ionChange",function(i){t.CHM(s);const r=t.oxw();return t.KtG(r.StoreAtSelChanged(i))}),t.TgZ(3,"ion-select-option",40),t._uU(4),t.qZA(),t.YNc(5,R,2,2,"ion-select-option",41),t.qZA()()}if(2&d){const s=t.oxw();t.xp6(1),t.Q6J("label",s.lang.text.TodoDetail.StoreAt),t.xp6(3),t.Oqu(s.lang.text.TodoDetail.OnThisDevice),t.xp6(1),t.Q6J("ngForOf",s.AvailableStorageList)}}function H(d,p){if(1&d){const s=t.EpF();t.TgZ(0,"div")(1,"ion-item")(2,"ion-label",43),t._uU(3),t.qZA(),t.TgZ(4,"ion-label",44),t._uU(5),t.qZA()(),t.TgZ(6,"ion-grid",45)(7,"ion-row")(8,"ion-col",46)(9,"ion-item",47),t.NdJ("click",function(){t.CHM(s);const i=t.oxw();return t.KtG(i.doneTodo())}),t.TgZ(10,"ion-label",48),t._uU(11),t.qZA()()()()()()}if(2&d){const s=t.oxw();t.xp6(3),t.Oqu(s.userInput.display_store||s.lang.text.TodoDetail.WIP),t.xp6(2),t.Oqu(s.userInput.display_creator),t.xp6(4),t.Q6J("disabled",!s.isModifiable||s.isButtonClicked),t.xp6(2),t.Oqu(s.lang.text.TodoDetail.TodoComplete)}}function Y(d,p){if(1&d){const s=t.EpF();t.TgZ(0,"ion-icon",49),t.NdJ("click",function(){t.CHM(s);const i=t.oxw();return t.KtG(i.SpeechToTitleText())}),t.qZA()}}function G(d,p){if(1&d){const s=t.EpF();t.TgZ(0,"ion-item")(1,"ion-checkbox",54),t.NdJ("ngModelChange",function(i){const a=t.CHM(s).$implicit;return t.KtG(a.todo_checked=i)}),t._uU(2),t.qZA()()}if(2&d){const s=p.$implicit;t.xp6(1),t.Q6J("ngModel",s.todo_checked),t.xp6(1),t.Oqu(s.display_name)}}function E(d,p){if(1&d){const s=t.EpF();t.TgZ(0,"ion-accordion",42)(1,"ion-item",51)(2,"ion-label"),t._uU(3),t.qZA()(),t.TgZ(4,"ion-list",52)(5,"ion-item",12),t.NdJ("click",function(){const r=t.CHM(s).$implicit,a=t.oxw(2);return t.KtG(a.toggle_all_user(r.id))}),t.TgZ(6,"ion-label"),t._uU(7),t.qZA()(),t.YNc(8,G,3,2,"ion-item",25),t.qZA()()}if(2&d){const s=p.$implicit,e=t.oxw(2);t.Q6J("value",s.id),t.xp6(3),t.Oqu(s.name),t.xp6(4),t.Oqu(e.lang.text.TodoDetail.ToggleWorkers),t.xp6(1),t.Q6J("ngForOf",e.AvailableWorker[s.id])}}function z(d,p){if(1&d&&(t.TgZ(0,"div")(1,"ion-accordion-group",null,50)(3,"ion-accordion")(4,"ion-item",51)(5,"ion-label"),t._uU(6),t.qZA()(),t.TgZ(7,"ion-list",52)(8,"ion-accordion-group",null,53),t.YNc(10,E,9,4,"ion-accordion",41),t.qZA()()()()()),2&d){const s=t.oxw();t.xp6(6),t.Oqu(s.lang.text.TodoDetail.ManageWorker),t.xp6(4),t.Q6J("ngForOf",s.WorkerGroups)}}function K(d,p){if(1&d&&(t.TgZ(0,"div",62),t._uU(1),t.qZA()),2&d){const s=t.oxw().$implicit;t.xp6(1),t.Oqu(s.displayTime)}}function V(d,p){1&d&&t._UZ(0,"ion-icon",63)}function X(d,p){1&d&&t._UZ(0,"ion-icon",64)}function ee(d,p){1&d&&t._UZ(0,"ion-icon",65)}function te(d,p){if(1&d&&(t.TgZ(0,"ion-item",57)(1,"ion-label"),t._uU(2),t.qZA(),t.YNc(3,K,2,1,"div",58),t.YNc(4,V,1,0,"ion-icon",59),t.YNc(5,X,1,0,"ion-icon",60),t.YNc(6,ee,1,0,"ion-icon",61),t.qZA()),2&d){const s=p.$implicit;t.xp6(2),t.Oqu(s.name),t.xp6(1),t.Q6J("ngIf",s.displayTime),t.xp6(1),t.Q6J("ngIf",void 0===s.isDelete),t.xp6(1),t.Q6J("ngIf",1==s.isDelete),t.xp6(1),t.Q6J("ngIf",0==s.isDelete)}}function ie(d,p){if(1&d&&(t.TgZ(0,"div")(1,"ion-accordion-group",null,50)(3,"ion-accordion")(4,"ion-item",51)(5,"ion-label"),t._uU(6),t.qZA(),t.TgZ(7,"ion-label",55),t._uU(8),t.qZA()(),t.TgZ(9,"ion-list",52),t.YNc(10,te,7,5,"ion-item",56),t.qZA()()()()),2&d){const s=t.oxw();t.xp6(6),t.Oqu(s.lang.text.TodoDetail.ManageWorker),t.xp6(2),t.Oqu(s.worker_done+" / "+s.userInput.workers.length),t.xp6(2),t.Q6J("ngForOf",s.userInput.workers)}}function ae(d,p){if(1&d){const s=t.EpF();t.TgZ(0,"ion-label",66),t.NdJ("click",function(){t.CHM(s);const i=t.oxw();return t.KtG(i.toggle_custom_color())}),t._uU(1),t.qZA()}if(2&d){const s=t.oxw();t.xp6(1),t.Oqu(s.lang.text.TodoDetail.SetCustomColor)}}function ne(d,p){if(1&d){const s=t.EpF();t.TgZ(0,"div")(1,"button",67),t.NdJ("click",function(){t.CHM(s);const i=t.oxw();return t.KtG(i.toggle_custom_color())}),t._uU(2),t.qZA(),t.TgZ(3,"input",68),t.NdJ("ngModelChange",function(i){t.CHM(s);const r=t.oxw();return t.KtG(r.userInput.custom_color=i)}),t.qZA()()}if(2&d){const s=t.oxw();t.xp6(2),t.hij(" ",s.lang.text.TodoDetail.remove," "),t.xp6(1),t.Q6J("ngModel",s.userInput.custom_color)}}function oe(d,p){if(1&d){const s=t.EpF();t.TgZ(0,"ion-item-divider")(1,"ion-label"),t._uU(2),t.qZA(),t.TgZ(3,"ion-icon",49),t.NdJ("click",function(){t.CHM(s);const i=t.oxw();return t.KtG(i.SpeechToDetailText())}),t.qZA()()}if(2&d){const s=t.oxw();t.xp6(2),t.Oqu(s.lang.text.TodoDetail.description)}}function re(d,p){if(1&d&&t._UZ(0,"img",72),2&d){const s=t.oxw(2).$implicit;t.Q6J("src",s.thumbnail,t.LSH)("alt",s.filename)}}function se(d,p){if(1&d&&(t.TgZ(0,"ion-item",18)(1,"ion-label",43),t._uU(2),t.qZA()()),2&d){const s=t.oxw(3);t.xp6(2),t.Oqu(s.lang.text.TodoDetail.open_content_viewer)}}function le(d,p){if(1&d){const s=t.EpF();t.TgZ(0,"div",37),t.NdJ("click",function(){t.CHM(s);const i=t.oxw().index,r=t.oxw();return t.KtG(r.open_content_viewer(i))}),t.YNc(1,re,1,2,"img",70),t.YNc(2,se,3,1,"ion-item",71),t.qZA()}if(2&d){const s=t.oxw().$implicit;t.xp6(1),t.Q6J("ngIf",s.thumbnail),t.xp6(1),t.Q6J("ngIf",!s.thumbnail)}}function de(d,p){if(1&d){const s=t.EpF();t.TgZ(0,"div")(1,"ion-item")(2,"ion-label",69),t._uU(3),t.qZA(),t.TgZ(4,"ion-button",37),t.NdJ("click",function(){const r=t.CHM(s).index,a=t.oxw();return t.KtG(a.remove_attach(r))}),t._uU(5),t.qZA()(),t.YNc(6,le,3,2,"div",8),t.qZA()}if(2&d){const s=p.$implicit,e=t.oxw();t.xp6(3),t.Oqu(s.filename),t.xp6(2),t.hij(" ",e.lang.text.TodoDetail.delete_attach," "),t.xp6(1),t.Q6J("ngIf",s.viewer)}}function ue(d,p){if(1&d){const s=t.EpF();t.TgZ(0,"td")(1,"ion-button",73),t.NdJ("click",function(){t.CHM(s);const i=t.oxw();return t.KtG(i.deleteData())}),t._uU(2),t.qZA()()}if(2&d){const s=t.oxw();t.xp6(1),t.Q6J("disabled",!s.isModifiable||s.isButtonClicked),t.xp6(1),t.hij(" ",s.lang.text.TodoDetail.remove," ")}}const ce=[{path:"",component:(()=>{var d;class p{constructor(e,i,r,a,l,o,n,u,c,m,g,T,f,Z){this.route=e,this.router=i,this.modalCtrl=r,this.lang=a,this.p5toast=l,this.sanitizer=o,this.indexed=n,this.nakama=u,this.alertCtrl=c,this.noti=m,this.statusBar=g,this.loadingCtrl=T,this.global=f,this.navCtrl=Z,this.userInput={id:void 0,storeAt:"local",display_store:"",title:void 0,create_at:void 0,written:void 0,startFrom:void 0,limit:void 0,custom_color:void 0,workers:void 0,importance:"0",description:void 0,remote:void 0,display_creator:void 0,attach:[],done:void 0,is_focus:void 0,noti_id:void 0},this.isMobile=!1,this.buttonDisplay={saveTodo:this.lang.text.TodoDetail.buttonDisplay_add},this.AmICreator=!0,this.isModify=!1,this.isModifiable=!1,this.isStartCalendarHidden=!0,this.isCalendarHidden=!0,this.isLimitChangable=!1,this.normal_color="#888b",this.alert_color="#0bbb",this.AlertLerpStartFrom=.8,this.file_sel_id="",this.AvailableStorageList=[],this.isManager=!1,this.AvailableWorker={},this.WorkerGroups=[],this.toggle_logs={},this.worker_done=0,this.isButtonClicked=!1}ngOnInit(){var e=this;if(this.MainDiv=document.getElementById("main_div"),this.isMobile="Android"==w.n$||"iOS"==w.n$,this.nakama.removeBanner(),this.route.queryParams.subscribe(i=>{const r=this.router.getCurrentNavigation().extras.state;r&&(this.received_data=r.data),this.received_data&&(this.userInput={...this.userInput,...JSON.parse(this.received_data)})}),this.nakama.AddTodoLinkAct=function(){var i=(0,I.Z)(function*(r){e.nakama.removeBanner(),e.p5timer.remove(),e.received_data=r,e.userInput=JSON.parse(e.received_data),yield e.ionViewWillEnter(),e.show_count_timer()});return function(r){return i.apply(this,arguments)}}(),this.nakama.AddTodoManageUpdateAct=(i,r,a,l)=>{if(this.userInput.id==i)for(let o=0,n=this.userInput.workers.length;o<n;o++)if((this.userInput.workers[o].user_id||this.userInput.workers[o].id)==r){this.userInput.workers[o].isDelete=a,this.userInput.workers[o].timestamp=l,this.userInput.workers[o].displayTime=new Date(l).toLocaleString(),this.worker_done++;break}},"DesktopPWA"==w.n$&&setTimeout(()=>{this.CreateDrop()},0),this.userInput.workers)for(let i=0,r=this.userInput.workers.length;i<r;i++)this.userInput.workers[i].timestamp&&(this.userInput.workers[i].displayTime=new Date(this.userInput.workers[i].timestamp).toLocaleString(),this.worker_done++)}CreateDrop(){var e=this;let i=document.getElementById("p5Drop_todo");this.p5canvas=new y(r=>{r.setup=()=>{let a=r.createCanvas(i.clientWidth,i.clientHeight);a.parent(i),r.pixelDensity(1),a.drop(function(){var l=(0,I.Z)(function*(o){yield e.selected_blobFile_callback_act(o.file)});return function(o){return l.apply(this,arguments)}}())},r.mouseMoved=a=>{a.dataTransfer?(i.style.pointerEvents="all",i.style.backgroundColor="#0008"):(i.style.pointerEvents="none",i.style.backgroundColor="transparent")}})}selected_blobFile_callback_act(e){var i=this;return(0,I.Z)(function*(){let r=yield i.loadingCtrl.create({message:i.lang.text.TodoDetail.WIP});r.present();let a={};a.filename=e.name,a.file_ext=e.name.substring(e.name.lastIndexOf(".")+1),a.size=e.size,a.type=e.type,a.path=`tmp_files/todo/${a.filename}`,a.blob=e,a.content_related_creator=[{timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"loaded"}],a.content_creator={timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"loaded"};let l=!1;l=yield i.indexed.checkIfFileExist(a.path,void 0,i.indexed.godotDB),i.userInput.id&&!l&&(l=yield i.indexed.checkIfFileExist(`todo/${i.userInput.id}/${a.filename}`,void 0,i.indexed.godotDB)),l&&(a.filename=`${a.filename.substring(0,a.filename.lastIndexOf("."))}_.${a.file_ext}`),i.global.set_viewer_category(a);let o=URL.createObjectURL(e);"image"==a.viewer&&(a.thumbnail=i.sanitizer.bypassSecurityTrustUrl(o));try{yield i.indexed.saveBlobToUserPath(e,a.path,void 0,i.indexed.godotDB),i.userInput.attach.push(a),setTimeout(()=>{URL.revokeObjectURL(o)},0),r.dismiss()}catch(n){console.error("\ud30c\uc77c \uc62c\ub9ac\uae30 \uc2e4\ud328: ",n),i.p5toast.show({text:i.lang.text.TodoDetail.load_failed}),r.dismiss()}i.auto_scroll_down()})()}ionViewWillEnter(){var e=this;return(0,I.Z)(function*(){let l,i=[];if(Object.keys(e.nakama.servers).forEach(n=>{Object.keys(e.nakama.servers[n]).forEach(c=>{"online"==e.statusBar.groupServer[n][c]&&i.push({name:`${e.nakama.servers[n][c].info.name}`,isOfficial:n,target:c,type:`${n}/${c}`})})}),[...i].forEach(n=>{e.AvailableStorageList.push(n)}),e.received_data)e.buttonDisplay.saveTodo=e.lang.text.TodoDetail.buttonDisplay_modify,l=JSON.parse(e.received_data),e.userInput={...e.userInput,...l},e.isModify=!0;else{let n=new Date((new Date).getTime()+864e5);e.userInput.limit=n.getTime()}if(e.file_sel_id=`todo_${e.userInput.id||"new_todo_id"}_${(new Date).getTime()}`,e.userInput.attach.length)for(let n=0,u=e.userInput.attach.length;n<u;n++){try{let c;if(e.userInput.remote){let g=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});g.present(),c=yield e.nakama.sync_load_file(e.userInput.attach[n],e.userInput.remote.isOfficial,e.userInput.remote.target,"todo_attach",e.userInput.remote.creator_id,void 0,e.indexed.godotDB),g.dismiss()}else{if("image"!=e.userInput.attach[n].viewer&&"text"!=e.userInput.attach[n].viewer)throw"\ubc88\uc678 \uc378\ub124\uc77c \ud544\uc694";c=yield e.indexed.loadBlobFromUserPath(e.userInput.attach[n].path,e.userInput.attach[n].type,void 0,e.indexed.godotDB)}if(!c)continue;let m=URL.createObjectURL(c);e.global.modulate_thumbnail(e.userInput.attach[n],m,e.indexed.godotDB)}catch{e.global.modulate_thumbnail(e.userInput.attach[n],"",e.indexed.godotDB)}e.userInput.attach[n].exist=!0}try{if("local"==e.userInput.storeAt)e.isModify||(e.StoreAt.value=e.userInput.storeAt),e.userInput.display_store=e.lang.text.TodoDetail.OnThisDevice,e.userInput.display_creator=e.lang.text.TodoDetail.WrittenByMe,e.isModifiable=!0;else if(e.userInput.remote){if(e.isModify||(e.StoreAt.value=e.userInput.remote),e.userInput.display_store=e.userInput.remote.name,e.userInput.display_creator=e.lang.text.TodoDetail.Disconnected,!e.nakama.servers[e.userInput.remote.isOfficial]||!e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target])throw e.userInput.display_creator=e.lang.text.TodoDetail.DeletedServer,{text:"Server Deleted",isModifiable:!0};if(e.statusBar.groupServer[e.userInput.remote.isOfficial]&&"online"!=e.statusBar.groupServer[e.userInput.remote.isOfficial][e.userInput.remote.target])throw{text:"Server disconnected",isModifiable:!1};"online"==e.statusBar.groupServer[e.userInput.remote.isOfficial][e.userInput.remote.target]&&(e.isModifiable=!0),e.AmICreator=e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session.user_id==e.userInput.remote.creator_id,e.userInput.display_creator=e.AmICreator?e.lang.text.TodoDetail.WrittenByMe:e.nakama.load_other_user(e.userInput.remote.creator_id,e.userInput.remote.isOfficial,e.userInput.remote.target).display_name,e.userInput.remote.group_id&&(e.isModifiable="online"==e.nakama.groups[e.userInput.remote.isOfficial][e.userInput.remote.target][e.userInput.remote.group_id].status)}}catch(n){e.isModifiable=n.isModifiable,console.log("Server issue: ",n)}e.noti.Current=e.userInput.id;let o=new Date(e.userInput.limit);if(e.Calendar.value=new Date(o.getTime()-60*o.getTimezoneOffset()*1e3).toISOString(),l&&(e.limitTimeP5Display=new Date(l.limit).getTime()),e.userInput.startFrom){let n=new Date(e.userInput.startFrom);e.startDisplay=n.toLocaleString(e.lang.lang),e.startDisplay=e.startDisplay.substring(0,e.startDisplay.lastIndexOf(":"))}if(e.limitDisplay=o.toLocaleString(e.lang.lang),e.limitDisplay=e.limitDisplay.substring(0,e.limitDisplay.lastIndexOf(":")),e.isLimitChangable=!0,e.userInput.workers)for(let n=0,u=e.userInput.workers.length;n<u;n++)try{e.userInput.workers[n].name=e.nakama.load_other_user(e.userInput.workers[n].id,e.userInput.remote.isOfficial,e.userInput.remote.target).display_name}catch{}})()}ionViewDidEnter(){this.show_count_timer()}toggle_start_calendar(){this.isStartCalendarHidden=!this.isStartCalendarHidden,this.isCalendarHidden=!0}toggle_calendar(){this.isCalendarHidden=!this.isCalendarHidden,this.isStartCalendarHidden=!0}start_change(e){this.isLimitChangable&&(this.userInput.startFrom=e.detail.value,this.startDisplay=new Date(e.detail.value).toLocaleString(this.lang.lang),this.startDisplay=this.startDisplay.substring(0,this.startDisplay.lastIndexOf(":")),this.startTimeP5Display=new Date(this.userInput.startFrom).getTime())}limit_change(e){this.isLimitChangable&&(this.userInput.limit=e.detail.value,this.limitDisplay=new Date(e.detail.value).toLocaleString(this.lang.lang),this.limitDisplay=this.limitDisplay.substring(0,this.limitDisplay.lastIndexOf(":")),this.limitTimeP5Display=new Date(this.userInput.limit).getTime())}remove_attach(e){this.userInput.attach.splice(e,1)}show_count_timer(){this.p5timer=new y(e=>{let i=0;this.startTimeP5Display=new Date(this.userInput.startFrom||this.userInput.written).getTime();let r,a=e.color(this.normal_color);e.setup=()=>{let c=document.getElementById("p5timer"),m=e.createCanvas(c.clientWidth,c.clientHeight);m.id("timer"),m.style("position","inherit"),m.style("width","100%"),m.style("height","100%"),m.parent(c),e.noStroke()};let l=0,o=()=>{r=(new Date).getTime(),l=this.limitTimeP5Display<r?1:e.map(r,this.startTimeP5Display,this.limitTimeP5Display,0,1,!0),l<=this.AlertLerpStartFrom?a=e.color(this.userInput.custom_color||this.normal_color):l>this.AlertLerpStartFrom&&(a=this.userInput.custom_color?e.color(this.userInput.custom_color):e.lerpColor(e.color(this.normal_color),e.color(this.alert_color),e.map(l,this.AlertLerpStartFrom,1,0,1)*i))};e.draw=()=>{o(),e.clear(255,255,255,255),e.push(),e.fill(a),i<1?(i+=.04,i>=1&&(i=1),e.rect(0,0,e.lerp(0,e.width,l*n(i)),e.height)):e.rect(0,0,e.lerp(0,e.width,l),e.height),e.pop()};let n=c=>u(e.sq(u(c))),u=c=>1-c})}from_camera(){var e=this;return(0,I.Z)(function*(){try{const i=yield D.V1.getPhoto({quality:90,resultType:D.dk.Base64,source:D.oK.Camera});let r=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});r.present();let a={};a.filename=`Camera_${(new Date).toLocaleString().replace(/[:|.|\/]/g,"_")}.${i.format}`,a.file_ext=i.format,a.base64="data:image/jpeg;base64,"+i.base64String,a.thumbnail=e.sanitizer.bypassSecurityTrustUrl(a.base64),a.type=`image/${i.format}`,a.typeheader="image",a.content_related_creator=[{timestamp:(new Date).getTime(),display_name:e.nakama.users.self.display_name,various:"camera"}],a.content_creator={timestamp:(new Date).getTime(),display_name:e.nakama.users.self.display_name,various:"camera"},a.path=`tmp_files/todo/${a.filename}`,a.viewer="image";let o=yield e.indexed.saveBase64ToUserPath(a.base64,a.path,void 0,e.indexed.godotDB);a.blob=new Blob([o],{type:a.type}),a.size=a.blob.size,r.dismiss(),e.userInput.attach.push(a)}catch{}})()}open_select_new(){this.NewAttach.open()}new_attach(e){var i=this;return(0,I.Z)(function*(){switch(e.detail.value){case"camera":yield i.from_camera(),i.auto_scroll_down(100);break;case"text":let r=new Date,m=`texteditor_${r.getUTCFullYear()}-${("0"+(r.getMonth()+1)).slice(-2)}-${("0"+r.getDate()).slice(-2)}_${("0"+r.getHours()).slice(-2)}-${("0"+r.getMinutes()).slice(-2)}-${("0"+r.getSeconds()).slice(-2)}.txt`;i.modalCtrl.create({component:M.B,componentProps:{info:{content:{is_new:"text",type:"text/plain",viewer:"text",filename:m},targetDB:i.indexed.godotDB},no_edit:!0}}).then(g=>{g.onWillDismiss().then(T=>{if(T.data){let f={};f.content_creator={timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"textedit"},f.content_related_creator=[],f.content_related_creator.push(f.content_creator),f.blob=T.data.blob,f.path=T.data.path,f.size=T.data.blob.size,f.filename=m,f.type="text/plain",f.viewer="text",i.userInput.attach.push(f),i.auto_scroll_down()}}),g.present()});break;case"image":i.modalCtrl.create({component:O.$}).then(g=>{g.onWillDismiss().then(function(){var T=(0,I.Z)(function*(f){f.data&&i.voidDraw_fileAct_callback(f)});return function(f){return T.apply(this,arguments)}}()),g.present()})}i.NewAttach.value=""})()}select_attach(){document.getElementById(this.file_sel_id).click()}inputImageSelected(e){var i=this;return(0,I.Z)(function*(){if(e.target.files.length)for(let r=0,a=e.target.files.length;r<a;r++)yield i.selected_blobFile_callback_act(e.target.files[r])})()}StoreAtSelClicked(){this.StoreAt.open()}StoreAtSelChanged(e){let i=e.detail.value;"local"==i?(this.userInput.storeAt="local",this.userInput.remote=void 0,this.isManager=!1,this.userInput.workers=void 0):(this.userInput.storeAt=i.type,this.userInput.remote=i,this.userInput.workers=[],this.nakama.servers[i.isOfficial][i.target].client.getAccount(this.nakama.servers[i.isOfficial][i.target].session).then(r=>{let a=JSON.parse(r.user.metadata);if(this.WorkerGroups.length=0,this.AvailableWorker={},a.is_admin)this.nakama.servers[i.isOfficial][i.target].client.rpc(this.nakama.servers[i.isOfficial][i.target].session,"query_all_groups",{}).then(l=>{let o=l.payload;for(let n=0,u=o.length;n<u;n++){this.AvailableWorker[o[n].id]||(this.AvailableWorker[o[n].id]=[]);for(let c=0,m=o[n].users.length;c<m;c++){let g=this.nakama.load_other_user(o[n].users[c].user.user_id,i.isOfficial,i.target);delete g.todo_checked,g.email||this.AvailableWorker[o[n].id].push(g)}this.AvailableWorker[o[n].id].length?this.WorkerGroups.push({id:o[n].id,name:o[n].name}):delete this.AvailableWorker[o[n].id]}this.isManager=!0});else if(a.is_manager){for(let l=a.is_manager.length-1;l>=0;l--)try{let o=this.nakama.groups[i.isOfficial][i.target][a.is_manager[l]];this.AvailableWorker[o.id]||(this.AvailableWorker[o.id]=[]);for(let n=0,u=o.users.length;n<u;n++){let c=this.nakama.load_other_user(o.users[n].user.user_id||o.users[n].user.id,i.isOfficial,i.target);delete c.todo_checked,(c.id||c.user_id)!=this.nakama.servers[i.isOfficial][i.target].session.user_id&&this.AvailableWorker[o.id].push(c)}this.AvailableWorker[o.id].length?this.WorkerGroups.push({id:o.id,name:o.name}):delete this.AvailableWorker[o.id]}catch{a.is_manager.splice(l,1)}this.isManager=a.is_manager.length,this.isManager||delete a.is_manager,this.nakama.servers[i.isOfficial][i.target].client.rpc(this.nakama.servers[i.isOfficial][i.target].session,"update_user_metadata_fn",{user_id:this.nakama.servers[i.isOfficial][i.target].session.user_id,metadata:a}).catch(l=>{})}}))}toggle_all_user(e){this.toggle_logs[e]=!this.toggle_logs[e];for(let i=0,r=this.AvailableWorker[e].length;i<r;i++)this.AvailableWorker[e][i].todo_checked=this.toggle_logs[e]}ImporantSelClicked(){this.ImporantSel.open()}ImporantSelChanged(e){switch(this.userInput.importance=e.detail.value,this.userInput.importance){case"0":this.normal_color="#888b",this.alert_color="#0bbb",this.AlertLerpStartFrom=.8;break;case"1":this.normal_color="#888b",this.alert_color="#dddd0cbb",this.AlertLerpStartFrom=.5;break;case"2":this.normal_color="#dddd0cbb",this.alert_color="#800b",this.AlertLerpStartFrom=.4}}SpeechToTitleText(){var e=this;return(0,I.Z)(function*(){let i=yield C.M.start({language:e.lang.lang,maxResults:1,prompt:e.lang.text.ChatRoom.TalkMessage,partialResults:!0,popup:!0});e.userInput.title=i.matches[0]})()}SpeechToDetailText(){var e=this;return(0,I.Z)(function*(){let i=yield C.M.start({language:e.lang.lang,maxResults:1,prompt:e.lang.text.ChatRoom.TalkMessage,partialResults:!0,popup:!0});e.userInput.description?e.userInput.description+="\n":e.userInput.description="",e.userInput.description+=i.matches[0]})()}toggle_custom_color(){this.userInput.custom_color=this.userInput.custom_color?void 0:"#000000"}open_content_viewer(e){let i=[];for(let r=0,a=this.userInput.attach.length;r<a;r++)i.push({content:this.userInput.attach[r]});this.modalCtrl.create({component:M.B,componentProps:{info:{content:this.userInput.attach[e]},path:this.userInput.attach[e].path,relevance:i,targetDB:this.indexed.godotDB}}).then(r=>{r.onDidDismiss().then(a=>{if(a.data)switch(a.data.type){case"image":let l=[];if(this.userInput.attach[a.data.index].content_related_creator&&(l=[...this.userInput.attach[a.data.index].content_related_creator]),this.userInput.attach[a.data.index].content_creator){let o=!1;for(let n=0,u=l.length;n<u;n++)if(void 0!==l[n].user_id&&void 0!==this.userInput.attach[a.data.index].content_creator.user_id&&l[n].user_id==this.userInput.attach[a.data.index].content_creator.user_id){o=!0;break}o||l.push(this.userInput.attach[a.data.index].content_creator)}return delete this.userInput.attach[a.data.index].exist,void this.modalCtrl.create({component:O.$,componentProps:{path:a.data.path||this.userInput.attach[a.data.index].path,width:a.data.width,height:a.data.height}}).then(o=>{o.onWillDismiss().then(n=>{n.data&&("image"===a.data.msg.content.viewer?this.voidDraw_fileAct_callback(n,l,a.data.index,!0):this.voidDraw_fileAct_callback(n,l,a.data.index))}),o.present()});case"text":this.userInput.attach[e].content_related_creator.push(this.userInput.attach[e].content_creator),this.userInput.attach[e].content_creator={timestamp:(new Date).getTime(),display_name:this.nakama.users.self.display_name,various:"textedit"},this.userInput.attach[e].blob=a.data.blob,this.userInput.attach[e].path=a.data.path,this.userInput.attach[e].size=a.data.blob.size,this.userInput.attach[e].filename=`[${this.lang.text.TodoDetail.EditText}] ${this.userInput.attach[e].filename}`,delete this.userInput.attach[e].exist}}),this.noti.Current="IonicViewerPage",r.present()})}auto_scroll_down(e=0){setTimeout(()=>{this.MainDiv.scrollTo({top:this.MainDiv.scrollHeight,behavior:"smooth"})},e)}voidDraw_fileAct_callback(e,i,r,a=!1){let l;try{if(!a)throw"not overwrite";l={},this.userInput.attach[r]=l}catch{l={},void 0===r?this.userInput.attach.push(l):this.userInput.attach.splice(r+1,0,l)}l.filename=e.data.name,l.file_ext="png",l.type="image/png",l.viewer="image",i?(l.content_related_creator=i,l.content_creator={timestamp:(new Date).getTime(),display_name:this.nakama.users.self.display_name,various:"voidDraw"}):(l.content_related_creator=[{timestamp:(new Date).getTime(),display_name:this.nakama.users.self.display_name,various:"voidDraw"}],l.content_creator={timestamp:(new Date).getTime(),display_name:this.nakama.users.self.display_name,various:"voidDraw"}),l.thumbnail=this.sanitizer.bypassSecurityTrustUrl(e.data.img),l.path=`tmp_files/todo/${l.filename}`,this.indexed.saveBase64ToUserPath(e.data.img,"tmp_files/todo/attach.jpeg",o=>{l.blob=new Blob([o],{type:l.type}),l.size=l.blob.size},this.indexed.godotDB),this.indexed.saveBase64ToUserPath(e.data.img,l.path,o=>{e.data.loadingCtrl.dismiss()},this.indexed.godotDB),this.auto_scroll_down()}doneTodo(){var e=this;return(0,I.Z)(function*(){if(e.isButtonClicked=!0,e.userInput.done=!0,e.global.godot_window.add_todo&&e.global.godot_window.add_todo(JSON.stringify(e.userInput)),e.userInput.remote){let i=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});i.present(),e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target]&&(yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].socket.sendMatchState(e.nakama.self_match[e.userInput.remote.isOfficial][e.userInput.remote.target].match_id,v.B.ADD_TODO,encodeURIComponent(`done,${e.userInput.id}`))),i.dismiss()}e.deleteFromStorage(!1)})()}saveData(){var e=this;return(0,I.Z)(function*(){if(!e.userInput.title)return void e.p5toast.show({text:e.lang.text.TodoDetail.needDisplayName});e.isButtonClicked=!0;let i=!!e.userInput.attach.length;if(delete e.userInput.display_store,delete e.userInput.display_creator,JSON.stringify(e.userInput)==e.received_data)return void e.navCtrl.back();if(e.userInput.create_at||(e.userInput.create_at=(new Date).getTime()),!e.userInput.id||!e.isModify)if(e.userInput.remote){let o=yield e.nakama.getRemoteTodoCounter(e.userInput.remote.isOfficial,e.userInput.remote.target);e.userInput.id=`RemoteTodo_${o+1}`}else e.userInput.id=new Date(e.userInput.create_at).toISOString().replace(/[:|.|\/]/g,"_");e.userInput.noti_id&&(e.isMobile||(clearTimeout(e.nakama.web_noti_id[e.userInput.noti_id]),delete e.nakama.web_noti_id[e.userInput.noti_id]),e.noti.ClearNoti(e.userInput.noti_id)),e.userInput.noti_id=e.nakama.get_noti_id(),e.nakama.set_todo_notification(e.userInput);let a=e.received_data?JSON.parse(e.received_data):void 0,l=!1;if(e.userInput.workers){e.userInput.workers.length=0;let o=Object.keys(e.AvailableWorker),n=[];for(let u=0,c=o.length;u<c;u++)for(let m=0,g=e.AvailableWorker[o[u]].length;m<g;m++){let T=e.AvailableWorker[o[u]][m].id||e.AvailableWorker[o[u]][m].user_id;e.AvailableWorker[o[u]][m].todo_checked&&!n.includes(T)&&(e.userInput.workers.push({id:T,name:e.nakama.load_other_user(T,e.userInput.remote.isOfficial,e.userInput.remote.target).display_name}),n.push(T))}e.userInput.workers.length||(e.userInput.workers=void 0)}try{a.attach.forEach(u=>{delete u.exist,delete u.thumbnail,delete u.base64,delete u.blob});let o=JSON.stringify(a.attach),n=JSON.parse(JSON.stringify(e.userInput.attach));n.forEach(u=>{delete u.exist,delete u.thumbnail,delete u.base64,delete u.blob}),n=JSON.stringify(n),l=o!=n}catch{l=!0}if(i&&l){let n,o=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});if(o.present(),a){yield e.indexed.removeFileFromUserPath(`todo/${e.userInput.id}/thumbnail.png`,void 0,e.indexed.godotDB);for(let u=0,c=a.attach.length;u<c;u++){for(let m=0,g=e.userInput.attach.length;m<g;m++)if(e.userInput.attach[m].path==a.attach[u].path){a.attach[u].exist=!0,a.attach[u].index=m;break}(!a.attach[u].exist||a.attach[u].exist&&!e.userInput.attach[a.attach[u].index])&&(yield e.indexed.removeFileFromUserPath(a.attach[u].path,void 0,e.indexed.godotDB))}}for(let u=0,c=e.userInput.attach.length;u<c;u++){let m;!e.userInput.attach[u].exist||!n&&"image"==e.userInput.attach[u].viewer?(m=yield e.indexed.loadBlobFromUserPath(e.userInput.attach[u].path,e.userInput.attach[u].type,void 0,e.indexed.godotDB),e.userInput.attach[u].path=`todo/${e.userInput.id}/${e.userInput.attach[u].filename}`,yield e.indexed.saveBlobToUserPath(m,e.userInput.attach[u].path,void 0,e.indexed.godotDB)):delete e.userInput.attach[u].exist,!n&&"image"==e.userInput.attach[u].viewer&&(n=URL.createObjectURL(m))}n&&(yield new Promise(u=>{new y(c=>{c.setup=()=>{c.noCanvas(),c.loadImage(n,m=>{m.width>m.height?m.resize(m.width/m.height*128,128):m.resize(128,m.height/m.width*128),c.createCanvas(128,128).hide(),c.smooth(),c.image(m,-(m.width-128)/2,-(m.height-128)/2),c.saveFrames("","png",1,1,f=>{e.indexed.saveBase64ToUserPath(f[0].imageData.replace(/"|=|\\/g,""),`todo/${e.userInput.id}/thumbnail.png`,Z=>{u()},e.indexed.godotDB),URL.revokeObjectURL(n),c.remove()})},m=>{console.error("Todo-\ub4f1\ub85d\ub41c \uc774\ubbf8\uc9c0 \ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",m),u(),URL.revokeObjectURL(n),c.remove()})}})}),e.global.last_frame_name=""),o.dismiss()}if(!i&&l&&a){yield e.indexed.removeFileFromUserPath(`todo/${e.userInput.id}/thumbnail.png`,void 0,e.indexed.godotDB);for(let o=0,n=a.attach.length;o<n;o++)yield e.indexed.removeFileFromUserPath(a.attach[o].path,void 0,e.indexed.godotDB);e.global.last_frame_name=""}if(e.userInput.attach.forEach(o=>{URL.revokeObjectURL(o.thumbnail),delete o.thumbnail,delete o.exist,delete o.base64}),e.userInput.written=(new Date).getTime(),e.userInput.startFrom){let o=new Date(e.userInput.startFrom).getTime();(new Date).getTime()>o?delete e.userInput.startFrom:e.userInput.startFrom=o}if(e.userInput.limit=new Date(e.userInput.limit).getTime(),e.isModify||e.userInput.remote&&!e.userInput.remote.creator_id&&(e.userInput.remote.creator_id=e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session.user_id),e.userInput.remote){let o=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});o.present();try{if(e.userInput.attach.forEach(n=>{URL.revokeObjectURL(n.thumbnail),delete n.thumbnail,delete n.exist,delete n.base64}),e.userInput.workers){let n=yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].client.rpc(e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session,"manage_todo_add_fn",e.userInput);e.userInput.id=`RemoteTodo_${n.payload.value}`;for(let u=0,c=e.userInput.workers.length;u<c;u++)try{let m=yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].client.readStorageObjects(e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session,{object_ids:[{collection:"self_share",key:"private_match",user_id:e.userInput.workers[u].id}]});m.objects.length&&(yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].socket.joinMatch(m.objects[0].value.match_id),yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].socket.sendMatchState(m.objects[0].value.match_id,v.B.ADD_TODO,encodeURIComponent(`add,server_todo,${e.userInput.id}`)),yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].socket.leaveMatch(m.objects[0].value.match_id))}catch{}}else yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].client.writeStorageObjects(e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session,[{collection:"server_todo",key:e.userInput.id,permission_read:2,permission_write:1,value:e.userInput}]).then(function(){var n=(0,I.Z)(function*(u){yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].socket.sendMatchState(e.nakama.self_match[e.userInput.remote.isOfficial][e.userInput.remote.target].match_id,v.B.ADD_TODO,encodeURIComponent(`add,${u.acks[0].collection},${u.acks[0].key}`))});return function(u){return n.apply(this,arguments)}}());if(i&&l&&a)for(let n=0,u=a.attach.length;n<u;n++){for(let c=0,m=e.userInput.attach.length;c<m;c++)if(e.userInput.attach[c].path==a.attach[n].path){a.attach[n].exist=!0,a.attach[n].index=c;break}(!a.attach[n].exist||a.attach[n].exist&&!e.userInput.attach[a.attach[n].index])&&(yield e.nakama.sync_remove_file(a.attach[n].path,e.userInput.remote.isOfficial,e.userInput.remote.target,"todo_attach",void 0,e.indexed.godotDB))}for(let n=0,u=e.userInput.attach.length;n<u;n++)yield e.nakama.sync_save_file(e.userInput.attach[n],e.userInput.remote.isOfficial,e.userInput.remote.target,"todo_attach",void 0,e.indexed.godotDB);e.isModify||e.nakama.addRemoteTodoCounter(e.userInput.remote.isOfficial,e.userInput.remote.target,Number(e.userInput.id.split("_")[1])),o.dismiss()}catch(n){return console.error("\ud574\uc57c\ud560 \uc77c\uc774 \uc11c\ubc84\uc5d0 \uc804\uc1a1\ub418\uc9c0 \uc54a\uc74c: ",n),e.p5toast.show({text:e.lang.text.TodoDetail.CanAddToServer}),e.isButtonClicked=!1,void o.dismiss()}}e.global.godot_window.add_todo&&e.global.godot_window.add_todo(JSON.stringify(e.userInput)),yield e.indexed.saveTextFileToUserPath(JSON.stringify(e.userInput),`todo/${e.userInput.id}/info.todo`,void 0,e.indexed.godotDB),e.navCtrl.back()})()}deleteData(){this.alertCtrl.create({header:this.lang.text.TodoDetail.remove,message:this.lang.text.TodoDetail.terminateTodo,buttons:[{text:this.lang.text.TodoDetail.remove,handler:()=>{this.deleteFromStorage()}}]}).then(e=>e.present())}deleteFromStorage(e=!0){var i=this;return(0,I.Z)(function*(){i.isButtonClicked=!0;let r=yield i.loadingCtrl.create({message:i.lang.text.TodoDetail.WIP});if(r.present(),i.userInput.remote){try{if(!i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target])throw"Server deleted.";let a=i.userInput.remote.isOfficial,l=i.userInput.remote.target;yield i.nakama.servers[a][l].client.deleteStorageObjects(i.nakama.servers[a][l].session,{object_ids:[{collection:"server_todo",key:i.userInput.id}]});for(let o=0,n=i.userInput.attach.length;o<n;o++)yield i.nakama.sync_remove_file(i.userInput.attach[o].path,a,l,"todo_attach",void 0,i.indexed.godotDB);e&&(yield i.nakama.servers[a][l].socket.sendMatchState(i.nakama.self_match[a][l].match_id,v.B.ADD_TODO,encodeURIComponent(`delete,${i.userInput.id}`)))}catch(a){console.error("\ud574\uc57c\ud560 \uc77c \uc0ad\uc81c \uc694\uccad\uc774 \uc11c\ubc84\uc5d0 \uc804\uc1a1\ub418\uc9c0 \uc54a\uc74c: ",a)}try{if(i.userInput.remote.creator_id!=i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].session.user_id){let a=(new Date).getTime();try{yield i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].client.rpc(i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].session,"manage_todo_done_fn",{id:i.userInput.id,creator_id:i.userInput.remote.creator_id,user_id:i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].session.user_id,timestamp:a,isDelete:e})}catch{}try{let l=yield i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].client.readStorageObjects(i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].session,{object_ids:[{collection:"self_share",key:"private_match",user_id:i.userInput.remote.creator_id}]});l.objects.length&&(yield i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].socket.joinMatch(l.objects[0].value.match_id),yield i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].socket.sendMatchState(l.objects[0].value.match_id,v.B.ADD_TODO,encodeURIComponent(`worker,${i.userInput.id},${i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].session.user_id},${e},${a}`)),yield i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].socket.leaveMatch(l.objects[0].value.match_id))}catch{}}}catch{}if(i.userInput.workers){try{yield i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].client.rpc(i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].session,"manage_todo_delete_fn",{id:i.userInput.id,workers:i.userInput.workers})}catch{}for(let a=0,l=i.userInput.workers.length;a<l;a++)try{let o=yield i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].client.readStorageObjects(i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].session,{object_ids:[{collection:"self_share",key:"private_match",user_id:i.userInput.workers[a].id}]});o.objects.length&&(yield i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].socket.joinMatch(o.objects[0].value.match_id),yield i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].socket.sendMatchState(o.objects[0].value.match_id,v.B.ADD_TODO,encodeURIComponent(e?`delete,${i.userInput.id}`:`done,${i.userInput.id}`)),yield i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].socket.leaveMatch(o.objects[0].value.match_id))}catch{}}i.nakama.removeRemoteTodoCounter(i.userInput.remote.isOfficial,i.userInput.remote.target,Number(i.userInput.id.split("_")[1]))}i.indexed.GetFileListFromDB(`todo/${i.userInput.id}`,function(){var a=(0,I.Z)(function*(l){l.forEach(o=>i.indexed.removeFileFromUserPath(o,void 0,i.indexed.godotDB)),i.userInput.noti_id&&(i.isMobile||(clearTimeout(i.nakama.web_noti_id[i.userInput.noti_id]),delete i.nakama.web_noti_id[i.userInput.noti_id])),i.noti.ClearNoti(i.userInput.noti_id),e&&i.global.godot_window.remove_todo&&i.global.godot_window.remove_todo(JSON.stringify(i.userInput)),r.dismiss(),i.navCtrl.back()});return function(l){return a.apply(this,arguments)}}(),i.indexed.godotDB)})()}ionViewWillLeave(){var e=this;return(0,I.Z)(function*(){e.indexed.GetFileListFromDB("tmp_files",i=>{i.forEach(r=>e.indexed.removeFileFromUserPath(r,void 0,e.indexed.godotDB))},e.indexed.godotDB),e.noti.Current="",e.p5timer&&e.p5timer.remove(),e.global.CreateGodotIFrame("todo",{local_url:"assets/data/godot/todo.pck",title:"Todo",add_todo_menu:i=>{e.nakama.open_add_todo_page(i)}})})()}ngOnDestroy(){this.nakama.AddTodoLinkAct=void 0,this.nakama.AddTodoManageUpdateAct=void 0,this.p5canvas&&this.p5canvas.remove()}}return(d=p).\u0275fac=function(e){return new(e||d)(t.Y36(x.gz),t.Y36(x.F0),t.Y36(_.IN),t.Y36(S.b),t.Y36(P.F),t.Y36(U.H7),t.Y36(J.H),t.Y36(v.a),t.Y36(_.Br),t.Y36(F.J),t.Y36(B.g),t.Y36(_.HT),t.Y36(N.AN),t.Y36(_.SH))},d.\u0275cmp=t.Xpm({type:d,selectors:[["app-add-todo-menu"]],viewQuery:function(e,i){if(1&e&&(t.Gf(j,5),t.Gf(q,5),t.Gf($,5),t.Gf(W,5),t.Gf(L,5)),2&e){let r;t.iGM(r=t.CRH())&&(i.StartCalendar=r.first),t.iGM(r=t.CRH())&&(i.Calendar=r.first),t.iGM(r=t.CRH())&&(i.NewAttach=r.first),t.iGM(r=t.CRH())&&(i.StoreAt=r.first),t.iGM(r=t.CRH())&&(i.ImporantSel=r.first)}},decls:77,vars:42,consts:[["slot","start"],["defaultHref","main"],["id","p5Drop_todo",2,"position","absolute","width","100%","height","100%","display","flex","pointer-events","none","z-index","500"],["id","main_table",2,"width","100%","height","100%"],[2,"height","100%"],[2,"vertical-align","top"],["id","p5timer",2,"position","absolute","width","100%","height","8px","z-index","2"],["id","main_div",1,"main",2,"max-width","100vw"],[3,"click",4,"ngIf"],[4,"ngIf"],[1,"ion-text-right",3,"label","ngModel","placeholder","ngModelChange"],["slot","end","name","mic-outline",3,"click",4,"ngIf"],["button","",3,"click"],[2,"pointer-events","none",3,"label","value","ionChange"],["ImporantSel",""],["value","2"],["value","1"],["value","0"],["button",""],["button","","color","medium","class","ion-text-end",3,"click",4,"ngIf"],[1,"ion-text-right","uneditable_data"],[2,"display","inline",3,"locale","ionChange"],["StartCalendar",""],["Calendar",""],[1,"infobox",3,"ngModel","placeholder","ngModelChange"],[4,"ngFor","ngForOf"],[1,"ion-text-right",3,"click"],[2,"display","none"],["interface","action-sheet",3,"label","ionChange"],["NewAttach",""],["value","text"],["value","image"],["value","camera"],["hidden","","type","file","accept","*","multiple","",3,"id","change"],[2,"width","100%"],["id","bottom_buttons",2,"width","100%","background-color","black"],["expand","block",3,"disabled","click"],[3,"click"],[2,"pointer-events","none",3,"label","ionChange"],["StoreAt",""],["value","local"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["color","medium"],["color","medium",1,"ion-text-right"],["fixed",""],["col-33",""],["button","","color","success",3,"disabled","click"],[1,"ion-text-center"],["slot","end","name","mic-outline",3,"click"],["ManageWorker",""],["button","","slot","header"],["slot","content"],["Groups",""],[3,"ngModel","ngModelChange"],[1,"ion-text-end"],["class","ignore_check",4,"ngFor","ngForOf"],[1,"ignore_check"],["style","color: var(--ion-color-medium);",4,"ngIf"],["slot","end","color","medium","name","ellipsis-horizontal-circle-outline",4,"ngIf"],["slot","end","color","danger","name","close-circle-outline",4,"ngIf"],["slot","end","color","success","name","checkmark-circle-outline",4,"ngIf"],[2,"color","var(--ion-color-medium)"],["slot","end","color","medium","name","ellipsis-horizontal-circle-outline"],["slot","end","color","danger","name","close-circle-outline"],["slot","end","color","success","name","checkmark-circle-outline"],["button","","color","medium",1,"ion-text-end",3,"click"],[2,"height","27px","transform","translateY(-3px)","padding","0px 8px",3,"click"],["type","color",2,"margin-right","8px","height","27px",3,"ngModel","ngModelChange"],["text-wrap",""],["class","image_thumbnail",3,"src","alt",4,"ngIf"],["button","",4,"ngIf"],[1,"image_thumbnail",3,"src","alt"],["color","danger","expand","block",3,"disabled","click"]],template:function(e,i){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t._uU(3),t.qZA(),t.TgZ(4,"ion-buttons",0),t._UZ(5,"ion-back-button",1),t.qZA()()(),t.TgZ(6,"ion-content"),t._UZ(7,"div",2),t.TgZ(8,"table",3)(9,"tr",4)(10,"td",5),t._UZ(11,"div",6),t.TgZ(12,"div",7),t.YNc(13,Q,6,3,"ion-item",8),t.YNc(14,H,12,4,"div",9),t.TgZ(15,"ion-item")(16,"ion-input",10),t.NdJ("ngModelChange",function(a){return i.userInput.title=a}),t.qZA(),t.YNc(17,Y,1,0,"ion-icon",11),t.qZA(),t.YNc(18,z,11,2,"div",9),t.TgZ(19,"ion-item",12),t.NdJ("click",function(){return i.ImporantSelClicked()}),t.TgZ(20,"ion-select",13,14),t.NdJ("ionChange",function(a){return i.ImporantSelChanged(a)}),t.TgZ(22,"ion-select-option",15),t._uU(23),t.qZA(),t.TgZ(24,"ion-select-option",16),t._uU(25),t.qZA(),t.TgZ(26,"ion-select-option",17),t._uU(27),t.qZA()()(),t.YNc(28,ie,11,3,"div",9),t.TgZ(29,"ion-item",18)(30,"ion-label"),t._uU(31),t.qZA(),t.YNc(32,ae,2,1,"ion-label",19),t.YNc(33,ne,4,2,"div",9),t.qZA(),t.TgZ(34,"ion-item",12),t.NdJ("click",function(){return i.toggle_start_calendar()}),t.TgZ(35,"ion-label"),t._uU(36),t.qZA(),t.TgZ(37,"ion-label",20),t._uU(38),t.qZA()(),t.TgZ(39,"ion-datetime",21,22),t.NdJ("ionChange",function(a){return i.start_change(a)}),t.qZA(),t.TgZ(41,"ion-item",12),t.NdJ("click",function(){return i.toggle_calendar()}),t.TgZ(42,"ion-label"),t._uU(43),t.qZA(),t.TgZ(44,"ion-label",20),t._uU(45),t.qZA()(),t.TgZ(46,"ion-datetime",21,23),t.NdJ("ionChange",function(a){return i.limit_change(a)}),t.qZA(),t.YNc(48,oe,4,1,"ion-item-divider",9),t.TgZ(49,"textarea",24),t.NdJ("ngModelChange",function(a){return i.userInput.description=a}),t.qZA(),t.YNc(50,de,7,3,"div",25),t.TgZ(51,"ion-item")(52,"ion-label"),t._uU(53),t.qZA(),t.TgZ(54,"ion-button",26),t.NdJ("click",function(){return i.open_select_new()}),t._uU(55),t.qZA(),t.TgZ(56,"ion-item",27)(57,"ion-select",28,29),t.NdJ("ionChange",function(a){return i.new_attach(a)}),t.TgZ(59,"ion-select-option",30),t._uU(60),t.qZA(),t.TgZ(61,"ion-select-option",31),t._uU(62),t.qZA(),t.TgZ(63,"ion-select-option",32),t._uU(64),t.qZA()()(),t.TgZ(65,"ion-button",26),t.NdJ("click",function(){return i.select_attach()}),t._uU(66),t.qZA()(),t.TgZ(67,"input",33),t.NdJ("change",function(a){return i.inputImageSelected(a)}),t.qZA()()()(),t.TgZ(68,"tr")(69,"td")(70,"div",34)(71,"table",35)(72,"tr")(73,"td")(74,"ion-button",36),t.NdJ("click",function(){return i.saveData()}),t._uU(75),t.qZA()(),t.YNc(76,ue,3,2,"td",9),t.qZA()()()()()()()),2&e&&(t.xp6(3),t.Oqu(i.lang.text.TodoDetail.Title),t.xp6(10),t.Q6J("ngIf",!i.isModify),t.xp6(1),t.Q6J("ngIf",i.isModify),t.xp6(2),t.Q6J("label",i.lang.text.TodoDetail.DisplayName)("ngModel",i.userInput.title)("placeholder",i.lang.text.TodoDetail.DisplayName_placeholder),t.xp6(1),t.Q6J("ngIf",i.isMobile),t.xp6(1),t.Q6J("ngIf","local"!=i.userInput.storeAt&&i.isManager),t.xp6(2),t.Q6J("label",i.lang.text.TodoDetail.Importance)("value",i.userInput.importance),t.xp6(3),t.Oqu(i.lang.text.TodoDetail.Importance_2),t.xp6(2),t.Oqu(i.lang.text.TodoDetail.Importance_1),t.xp6(2),t.Oqu(i.lang.text.TodoDetail.Importance_0),t.xp6(1),t.Q6J("ngIf",i.isModify&&i.userInput.workers),t.xp6(3),t.Oqu(i.lang.text.TodoDetail.CustomColor),t.xp6(1),t.Q6J("ngIf",!i.userInput.custom_color),t.xp6(1),t.Q6J("ngIf",i.userInput.custom_color),t.xp6(3),t.Oqu(i.lang.text.TodoDetail.startFrom),t.xp6(2),t.Oqu(i.startDisplay||i.lang.text.TodoDetail.startImmediatly),t.xp6(1),t.Akn(i.isStartCalendarHidden?"display: none;":""),t.Q6J("locale",i.lang.lang),t.xp6(4),t.Oqu(i.lang.text.TodoDetail.limit),t.xp6(2),t.Oqu(i.limitDisplay),t.xp6(1),t.Akn(i.isCalendarHidden?"display: none;":""),t.Q6J("locale",i.lang.lang),t.xp6(2),t.Q6J("ngIf",i.isMobile),t.xp6(1),t.Q6J("ngModel",i.userInput.description)("placeholder",i.lang.text.TodoDetail.description),t.xp6(1),t.Q6J("ngForOf",i.userInput.attach),t.xp6(3),t.Oqu(i.lang.text.TodoDetail.attachments),t.xp6(2),t.hij(" ",i.lang.text.TodoDetail.new_attach," "),t.xp6(2),t.Q6J("label",i.lang.text.TodoDetail.new_attach),t.xp6(3),t.Oqu(i.lang.text.TodoDetail.new_text),t.xp6(2),t.Oqu(i.lang.text.TodoDetail.new_draw),t.xp6(2),t.Oqu(i.lang.text.GlobalAct.FromCamera),t.xp6(2),t.hij(" ",i.lang.text.TodoDetail.add_attach," "),t.xp6(1),t.Q6J("id",i.file_sel_id),t.xp6(7),t.Q6J("disabled",!i.isModifiable||i.isButtonClicked),t.xp6(1),t.hij(" ",i.buttonDisplay.saveTodo," "),t.xp6(1),t.Q6J("ngIf",i.isModify))},dependencies:[b.sg,b.O5,k.Fj,k.JJ,k.On,_.We,_.eh,_.oU,_.YG,_.Sm,_.nz,_.wI,_.W2,_.x4,_.jY,_.Gu,_.gu,_.pK,_.Ie,_.rH,_.Q$,_.q_,_.Nd,_.t9,_.n0,_.wd,_.sr,_.w,_.QI,_.j9,_.cs],styles:[".uneditable_data[_ngcontent-%COMP%]{color:#888}.main[_ngcontent-%COMP%]{width:100%;height:100%;padding:8px;overflow-x:hidden;overflow-y:auto;scroll-behavior:smooth}.logs[_ngcontent-%COMP%]{background:var(--voidDraw-menu-background);border-radius:8px;margin:8px;padding:4px 8px;text-align:center}.image_thumbnail[_ngcontent-%COMP%]{width:auto;height:auto;object-fit:contain;display:block;margin:auto}.ignore_check[_ngcontent-%COMP%]{pointer-events:none}"]}),p})()}];let me=(()=>{var d;class p{}return(d=p).\u0275fac=function(e){return new(e||d)},d.\u0275mod=t.oAB({type:d}),d.\u0275inj=t.cJS({imports:[x.Bz.forChild(ce),x.Bz]}),p})(),pe=(()=>{var d;class p{}return(d=p).\u0275fac=function(e){return new(e||d)},d.\u0275mod=t.oAB({type:d}),d.\u0275inj=t.cJS({imports:[b.ez,k.u5,_.Pc,me]}),p})()}}]);