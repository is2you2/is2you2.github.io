"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6146],{6146:(S,m,l)=>{l.d(m,{B:()=>E});var _=l(5861),g=l(6845),f=l(9761),e=l(9468),s=l(1325),v=l(9376),x=l(9080),I=l(7488),A=l(3857),C=l(6052),T=l(4663),G=l(797),h=l(6814),c=l(95);const b=["AddGroupPublic"];function M(o,u){if(1&o){const n=e.EpF();e.TgZ(0,"ion-item",22),e.NdJ("click",function(){const a=e.CHM(n).index,r=e.oxw(2);return e.KtG(r.select_server(a))}),e.TgZ(1,"ion-label"),e._uU(2),e.qZA()()}if(2&o){const n=u.$implicit;e.xp6(2),e.Oqu(n.name)}}function k(o,u){if(1&o){const n=e.EpF();e.TgZ(0,"ion-accordion-group",14,15),e.NdJ("click",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.isExpanded=!0)}),e.TgZ(2,"ion-accordion",16)(3,"ion-item",17)(4,"ion-label"),e._uU(5),e.qZA(),e.TgZ(6,"ion-label",18),e._uU(7),e.qZA(),e._UZ(8,"ion-icon",19),e.qZA(),e.TgZ(9,"div",20),e.YNc(10,M,3,1,"ion-item",21),e.qZA()()()}if(2&o){const n=e.oxw();e.Q6J("disabled",n.isSaveClicked)("value",n.isExpanded),e.xp6(5),e.Oqu(n.lang.text.AddGroup.SelectServer),e.xp6(2),e.Oqu(n.servers[n.index].name),e.xp6(3),e.Q6J("ngForOf",n.servers)}}function P(o,u){if(1&o){const n=e.EpF();e.TgZ(0,"div")(1,"ion-item-divider")(2,"ion-label"),e._uU(3),e.qZA()(),e.TgZ(4,"ion-item",5)(5,"ion-input",23),e.NdJ("ngModelChange",function(i){e.CHM(n);const a=e.oxw();return e.KtG(a.userInput.id=i)}),e.qZA()()()}if(2&o){const n=e.oxw();e.xp6(3),e.Oqu(n.lang.text.AddGroup.JoinGroupWithId),e.xp6(1),e.Q6J("disabled",n.isSaveClicked),e.xp6(1),e.Q6J("label",n.lang.text.AddGroup.InputGroupId)("ngModel",n.userInput.id)}}function O(o,u){if(1&o){const n=e.EpF();e.TgZ(0,"div")(1,"ion-item-divider")(2,"ion-label"),e._uU(3),e.qZA()(),e.TgZ(4,"textarea",24),e.NdJ("ngModelChange",function(i){e.CHM(n);const a=e.oxw();return e.KtG(a.userInput.description=i)}),e.qZA(),e.TgZ(5,"ion-item",25)(6,"ion-input",26),e.NdJ("ngModelChange",function(i){e.CHM(n);const a=e.oxw();return e.KtG(a.userInput.max_count=i)}),e.qZA()(),e.TgZ(7,"ion-item",5,27)(9,"ion-toggle",28),e.NdJ("ngModelChange",function(i){e.CHM(n);const a=e.oxw();return e.KtG(a.userInput.open=i)})("ionChange",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.isPublicToggle())}),e._uU(10),e.qZA()()()}if(2&o){const n=e.oxw();e.xp6(3),e.Oqu(n.lang.text.AddGroup.GroupDetail),e.xp6(1),e.Q6J("disabled",n.isSaveClicked||""!=n.userInput.id)("ngModel",n.userInput.description)("placeholder",n.lang.text.AddGroup.GroupDetail_placeholder),e.xp6(1),e.Q6J("disabled",n.isSaveClicked||""!=n.userInput.id),e.xp6(1),e.Q6J("label",n.lang.text.AddGroup.MemberMaxLimit)("ngModel",n.userInput.max_count),e.xp6(1),e.Q6J("disabled",n.isSaveClicked||""!=n.userInput.id),e.xp6(2),e.Q6J("ngModel",n.userInput.open),e.xp6(1),e.hij(" ",n.lang.text.AddGroup.IsOpen,"")}}let E=(()=>{var o;class u{constructor(t,i,a,r,d,p,Z,U){this.modalCtrl=t,this.p5toast=i,this.nakama=a,this.statusBar=r,this.lang=d,this.global=p,this.mClipboard=Z,this.indexed=U,this.userInput={server:void 0,id:"",name:void 0,description:void 0,max_count:void 0,lang_tag:void 0,open:!0,creator_id:void 0,img:void 0},this.servers=[],this.index=0,this.isExpanded=!0,this.imageURL_disabled=!1,this.imageURL_placeholder=this.lang.text.Profile.pasteURI,this.isSaveClicked=!1,this.isSavedWell=!1,this.file_sel_id=""}ngOnInit(){let t=JSON.parse(localStorage.getItem("add-group"));t&&(this.userInput=t),this.servers=this.nakama.get_all_server_info(!0,!0),this.servers.push({name:this.lang.text.AddGroup.UseLocalStorage,isOfficial:"local",target:"channels",local:!0}),this.userInput.server=this.servers[this.index],this.file_sel_id=`add_group_${(new Date).getTime()}`}select_server(t){this.index=t,this.userInput.server=this.servers[t],this.servers[t].local&&(this.userInput.id=""),this.isExpanded=!1}imageURLPasted(){this.imageURL_disabled=!0,"DesktopPWA"==g.n$||"MobilePWA"==g.n$?f.Z.read().then(t=>{this.check_if_clipboard_available(t)}):this.mClipboard.paste().then(t=>{this.check_if_clipboard_available(t)},t=>{console.log("\ud074\ub9bd\ubcf4\ub4dc \uc790\ub8cc\ubc1b\uae30 \uc624\ub958: ",t)}),setTimeout(()=>{this.imageURL_disabled=!1},1500)}check_if_clipboard_available(t){0==t.indexOf("http")?(this.userInput.img=t,this.imageURL_placeholder=t):0==t.indexOf("data:image")?this.nakama.limit_image_size(t,i=>this.userInput.img=i.canvas.toDataURL()):this.p5toast.show({text:this.lang.text.Profile.copyURIFirst})}isPublicToggle(){this.userInput.open=this.GroupIsPublic.checked}save(){var t=this;return(0,_.Z)(function*(){if(t.isSaveClicked=!0,t.servers[t.index].local)return void t.SaveLocalAct();if(t.userInput.id)return void(yield t.JoinWithSpecificId());if("online"!=t.statusBar.groupServer[t.servers[t.index].isOfficial][t.servers[t.index].target])return void t.p5toast.show({text:t.lang.text.AddGroup.cannot_use_selected_server});let i=t.nakama.servers[t.servers[t.index].isOfficial][t.servers[t.index].target].client,a=t.nakama.servers[t.servers[t.index].isOfficial][t.servers[t.index].target].session;t.userInput.owner=a.user_id,t.userInput.status="online",t.userInput.lang_tag=t.userInput.lang_tag||navigator.language.split("-")[0]||t.lang.lang,t.userInput.max_count=t.userInput.max_count||2,i.createGroup(a,{name:t.userInput.name,lang_tag:t.userInput.lang_tag,description:t.userInput.description,max_count:t.userInput.max_count,open:t.userInput.open}).then(function(){var r=(0,_.Z)(function*(d){t.userInput.id=d.id,t.userInput.creator_id=t.nakama.servers[t.servers[t.index].isOfficial][t.servers[t.index].target].session.user_id,t.nakama.save_group_info(t.userInput,t.servers[t.index].isOfficial,t.servers[t.index].target);try{yield t.nakama.join_chat_with_modulation(d.id,3,t.servers[t.index].isOfficial,t.servers[t.index].target),t.isSavedWell=!0,t.p5toast.show({text:t.lang.text.AddGroup.group_created})}catch(p){console.error(p)}setTimeout(()=>{t.modalCtrl.dismiss()},500)});return function(d){return r.apply(this,arguments)}}()).catch(r=>{switch(console.error("\uadf8\ub8f9 \uc0dd\uc131 \uc2e4\ud328: ",r),r.status){case 400:setTimeout(()=>{t.p5toast.show({text:t.lang.text.AddGroup.NeedSetGroupName}),t.isSaveClicked=!1},500);break;case 409:setTimeout(()=>{t.p5toast.show({text:t.lang.text.AddGroup.AlreadyExist}),t.isSaveClicked=!1},500);break;default:setTimeout(()=>{t.p5toast.show({text:`${t.lang.text.AddGroup.UnexpectedErr}: ${r}`}),t.isSaveClicked=!1},500)}})})()}SaveLocalAct(){if(this.nakama.channels_orig.local||(this.nakama.channels_orig.local={}),this.nakama.channels_orig.local.channels||(this.nakama.channels_orig.local.channels={}),this.nakama.channels_orig.local.channels[this.userInput.name])return this.p5toast.show({text:this.lang.text.AddGroup.AlreadyExist}),void(this.isSaveClicked=!1);let t=this.CreateRandomLocalId();this.nakama.channels_orig.local.channels[t]={id:t,local:!0,title:this.userInput.name,redirect:{type:0},status:"online",HideAutoThumbnail:!1,info:{...this.userInput,status:"online"}},this.isSavedWell=!0,this.userInput.img&&this.indexed.saveTextFileToUserPath(this.userInput.img,`servers/local/channels/groups/${t}.img`),this.nakama.rearrange_channels(),setTimeout(()=>{this.modalCtrl.dismiss()},500)}CreateRandomLocalId(){let t="";for(let a=0,r=16;a<r;a++){let d=Math.floor(62*Math.random());t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(d)}return this.nakama.channels_orig.local.channels[t]?this.CreateRandomLocalId():t}JoinWithSpecificId(){var t=this;return(0,_.Z)(function*(){let i=!1,a=t.nakama.servers[t.servers[t.index].isOfficial][t.servers[t.index].target];try{yield a.client.joinGroup(a.session,t.userInput.id),yield t.nakama.get_group_list_from_server(t.servers[t.index].isOfficial,t.servers[t.index].target),i=!0}catch{try{yield t.nakama.join_chat_with_modulation(t.userInput.id,2,t.servers[t.index].isOfficial,t.servers[t.index].target),i=!0}catch{t.p5toast.show({text:t.lang.text.AddGroup.check_group_id}),t.isSaveClicked=!1}}i&&(t.isSavedWell=!0,t.p5toast.show({text:t.lang.text.AddGroup.join_group_succ}),setTimeout(()=>{t.modalCtrl.dismiss()},500))})()}ionViewWillLeave(){this.isSavedWell?localStorage.removeItem("add-group"):localStorage.setItem("add-group",JSON.stringify(this.userInput))}buttonClickLinkInputFile(){document.getElementById(this.file_sel_id).click()}inputImageSelected(t){var i=this;return(0,_.Z)(function*(){let a=yield i.global.GetBase64ThroughFileReader(t.target.files[0]);i.nakama.limit_image_size(a,r=>i.userInput.img=r.canvas.toDataURL())})()}}return(o=u).\u0275fac=function(t){return new(t||o)(e.Y36(s.IN),e.Y36(v.F),e.Y36(x.a),e.Y36(I.g),e.Y36(A.b),e.Y36(C.AN),e.Y36(T.T),e.Y36(G.H))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-add-group"]],viewQuery:function(t,i){if(1&t&&e.Gf(b,5),2&t){let a;e.iGM(a=e.CRH())&&(i.GroupIsPublic=a.first)}},decls:30,vars:18,consts:[[1,"ion-no-border"],["slot","start",3,"click"],["defaultHref",""],["value","colors","expand","inset",3,"disabled","value","click",4,"ngIf"],[4,"ngIf"],["button","",3,"disabled"],[1,"ion-text-right",3,"label","ngModel","placeholder","ngModelChange"],["button","",3,"disabled","click"],[1,"additional_form","bg_img_form"],[1,"profile_img",2,"filter","grayscale(0) contrast(1)",3,"src"],[3,"disabled","click"],["color","medium"],["hidden","","type","file","accept","image/*",3,"id","change"],[1,"ion-text-center"],["value","colors","expand","inset",3,"disabled","value","click"],["accordionGroup",""],["value","colors"],["slot","header"],[1,"ion-text-right"],[1,"ion-accordion-toggle-icon","hide_accordion_icon"],["slot","content"],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"],["placeholder","00000000-0000-0000-0000-000000000000",1,"ion-text-right",3,"label","ngModel","ngModelChange"],[1,"infobox",3,"disabled","ngModel","placeholder","ngModelChange"],[3,"disabled"],["type","number","min","2","placeholder","2",1,"ion-text-right",3,"label","ngModel","ngModelChange"],["AddGroupPublic",""],[2,"pointer-events","none",3,"ngModel","ngModelChange","ionChange"]],template:function(t,i){1&t&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),e._uU(3),e.qZA(),e.TgZ(4,"ion-buttons",1),e.NdJ("click",function(){return i.modalCtrl.dismiss()}),e._UZ(5,"ion-back-button",2),e.qZA()()(),e.TgZ(6,"ion-content"),e.YNc(7,k,11,5,"ion-accordion-group",3),e.YNc(8,P,6,4,"div",4),e.TgZ(9,"ion-item-divider")(10,"ion-label"),e._uU(11),e.qZA()(),e.TgZ(12,"ion-item",5)(13,"ion-input",6),e.NdJ("ngModelChange",function(r){return i.userInput.name=r}),e.qZA()(),e.TgZ(14,"ion-item",7),e.NdJ("click",function(){return i.buttonClickLinkInputFile()}),e.TgZ(15,"div",8),e._UZ(16,"img",9),e.qZA(),e.TgZ(17,"ion-label")(18,"p"),e._uU(19),e.qZA(),e.TgZ(20,"h2"),e._uU(21),e.qZA()()(),e.TgZ(22,"ion-item",10),e.NdJ("click",function(){return i.imageURLPasted()}),e.TgZ(23,"ion-label",11),e._uU(24),e.qZA()(),e.TgZ(25,"input",12),e.NdJ("change",function(r){return i.inputImageSelected(r)}),e.qZA(),e.YNc(26,O,11,10,"div",4),e.TgZ(27,"ion-item",7),e.NdJ("click",function(){return i.save()}),e.TgZ(28,"ion-label",13),e._uU(29),e.qZA()()()),2&t&&(e.xp6(3),e.Oqu(i.lang.text.AddGroup.Title),e.xp6(4),e.Q6J("ngIf",i.servers.length),e.xp6(1),e.Q6J("ngIf",!i.userInput.server.local),e.xp6(3),e.Oqu(i.lang.text.AddGroup.GroupInfo),e.xp6(1),e.Q6J("disabled",i.isSaveClicked||""!=i.userInput.id),e.xp6(1),e.Q6J("label",i.lang.text.AddGroup.DisplayName)("ngModel",i.userInput.name)("placeholder",i.lang.text.AddGroup.DisplayName_placeholder),e.xp6(1),e.Q6J("disabled",i.isSaveClicked||""!=i.userInput.id),e.xp6(2),e.Q6J("src",i.userInput.img,e.LSH),e.xp6(3),e.hij("",(i.userInput.name||i.lang.text.AddGroup.DisplayName_placeholder)+" ("+(i.userInput.server.name||i.userInput.server.target)+")"," "),e.xp6(2),e.Oqu(i.lang.text.AddGroup.ClicktoChangeGroupImg),e.xp6(1),e.Q6J("disabled",i.isSaveClicked||i.imageURL_disabled||""!=i.userInput.id),e.xp6(2),e.Oqu(i.imageURL_placeholder),e.xp6(1),e.Q6J("id",i.file_sel_id),e.xp6(1),e.Q6J("ngIf",!i.userInput.server.local),e.xp6(1),e.Q6J("disabled",i.isSaveClicked),e.xp6(2),e.Oqu(i.lang.text.AddGroup.submit))},dependencies:[h.sg,h.O5,c.Fj,c.JJ,c.On,s.We,s.eh,s.oU,s.Sm,s.W2,s.Gu,s.gu,s.pK,s.Ie,s.rH,s.Q$,s.wd,s.ho,s.sr,s.w,s.as,s.j9,s.cs,s.yf]}),u})()}}]);