"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4032],{4032:(Pe,N,u)=>{u.r(N),u.d(N,{MainPageModule:()=>ue});var H=u(1368),te=u(4716),x=u(5624),U=u(3332),w=u(1528),L=u(5020),ie=u(5193),$=u(9352),o=u(4496),oe=u(4500),se=u(7136),le=u(4180),ne=u(4668);function ae(r,b){1&r&&o.wR5(0,"ion-icon",8)}function re(r,b){1&r&&o.wR5(0,"ion-icon",9)}function de(r,b){if(1&r){const p=o.KQA();o.I0R(0,"div")(1,"div",10),o.qCj("click",function(){o.usT(p);const g=o.GaO();return o.CGJ(g.nakama.open_add_todo_page())}),o.wR5(2,"ion-icon",11),o.I0R(3,"div")(4,"ion-label",12),o.OEk(5),o.C$Y()()()()}if(2&r){const p=o.GaO();o.yG2(5),o.cNF(p.lang.text.Main.NoTodo)}}const ce=[{path:"",component:(()=>{var r;class b{constructor(d,g,e,a,n,k){this.global=d,this.lang=g,this.nakama=e,this.statusBar=a,this.indexed=n,this.alertCtrl=k,this.isPlayingCanvas={loop:!0},this.isEmptyTodo=!1}ngOnInit(){}toggleCanvasPlaying(){this.isPlayingCanvas.loop=!this.isPlayingCanvas.loop,this.isPlayingCanvas.loop?this.global.p5todo.loop():this.global.p5todo.noLoop()}CreateTodoManager(){var d=this;setTimeout(()=>{"DesktopPWA"!=ie.s1&&this.toggleCanvasPlaying()},8e3);let g=document.getElementById("todo");this.global.p5todo&&this.global.p5todo.remove(),this.global.p5todo=new $(e=>{let m,Y,a={},n=[],k=[],A=[],I=e.createVector(0,0),W=e.createVector(0,0),f=e.createVector(0,0),y=1,R=e.createVector(0,0),B=this.nakama,ge=this.indexed,M=[],v=!1;e.setup=(0,w.c)(function*(){let s=e.createCanvas(g.clientWidth,g.clientHeight);s.parent(g),s.id("p5todo"),s.elt.oncontextmenu=i=>{for(let l=0,c=n.length;l<c;l++)if("AddButton"!=a[n[l]].json.id&&a[n[l]].position.dist(j(i.offsetX,i.offsetY))<a[n[l]].EllipseSize/2){d.alertCtrl.create({header:a[n[l]].json.title,message:a[n[l]].json.description,buttons:[{text:d.lang.text.TodoDetail.TodoComplete,handler:function(){var T=(0,w.c)(function*(){try{yield B.doneTodo(a[n[l]].json)}catch{}});return function(){return T.apply(this,arguments)}}()},{text:d.lang.text.TodoDetail.remove,cssClass:"red_font",handler:function(){var T=(0,w.c)(function*(){try{yield B.deleteTodoFromStorage(!0,a[n[l]].json)}catch{}});return function(){return T.apply(this,arguments)}}()}]}).then(T=>{T.onDidDismiss().then(()=>{v=!1}),v=!0,T.present()});break}},e.smooth(),e.noStroke(),e.pixelDensity(1),e.ellipseMode(e.CENTER),e.rectMode(e.CENTER),e.textAlign(e.CENTER,e.CENTER),e.textSize(20),e.textLeading(28),e.textWrap(e.CHAR),e.imageMode(e.CENTER);let t=Number(localStorage.getItem("p5todoScale")||1);X(),y=t,localStorage.setItem("p5todoScale",`${y}`),e.isPlayingCanvas=d.isPlayingCanvas,e.StopCanvas=()=>{v=!0,d.isPlayingCanvas.loop||e.noLoop()},e.PlayCanvas=()=>{v=!1,e.windowResized(),d.isPlayingCanvas.loop&&e.loop()},e.add_todo=i=>{let l=JSON.parse(i);if(l.done){for(let c=0,h=n.length;c<h;c++)if(a[n[c]].json.id==l.id)return void a[n[c]].makeDone()}else a[l.id]=new J(l);e.isPlayingCanvas.loop||(Y=a[l.id],e.loop()),e.count_todo()},e.count_todo=()=>{n=Object.keys(a),d.isEmptyTodo=!n.length,d.isEmptyTodo||(a.AddButton?1==n.length&&a.AddButton.makeDone():(a.AddButton=new J("",!0),n=Object.keys(a)))},e.remove_todo=i=>{let l=JSON.parse(i);for(let c=0,h=n.length;c<h;c++)if(a[n[c]].json.id==l.id){a[n[c]].RemoveTodo();break}d.isEmptyTodo=!Object.keys(n).length,e.count_todo(),e.redraw()},e.ListUpdate=(0,w.c)(function*(){a={},n.length=0;let i=yield d.indexed.GetFileListFromDB("todo/");for(let l=0,c=i.length;l<c;l++)if(i[l].indexOf("/info.todo")>=0){let h=yield d.indexed.loadTextFromUserPath(i[l]);e.add_todo(h)}d.isEmptyTodo=!Object.keys(n).length}),yield e.ListUpdate()});let X=()=>{R.x=e.width/2,R.y=e.height/2,f.x=0,f.y=0,y=1,localStorage.setItem("p5todoScale",`${y}`),this.isPlayingCanvas.loop||e.redraw()};e.draw=()=>{e.clear(255,255,255,255),e.push(),e.translate(R),e.scale(y),e.translate(f);for(let s=0,t=n.length;s<t;s++)a[n[s]].display();for(let s=A.length-1;s>=0;s--)A[s].display(),A[s].lifeTime<0&&A.splice(s,1);for(let s=k.length-1;s>=0;s--)k[s].DoneAnim();e.pop(),this.isPlayingCanvas.loop&&(W.x=40*-e.accelerationX,W.y=40*e.accelerationY)},e.windowResized=()=>{v||setTimeout(()=>{let s=f.x/e.width,t=f.y/e.height;e.resizeCanvas(g.clientWidth,g.clientHeight),R.x=e.width/2,R.y=e.height/2,f.x=s*e.width,f.y=t*e.height},50)};let O=!0;class J{constructor(t,i=!1){this.isAddButton=!1,this.EllipseSize=96,this.Velocity=e.createVector(0,0),this.Accel=e.createVector(0,0),this.isGrabbed=!1,this.TextColor=e.color(L.Mp?255:0),this.ProgressWeight=8,this.LerpProgress=0,this.LifeTime=1,this.json=t;let l=e.max(e.width,e.height),c=e.createVector(l/e.min(1,y),0).setHeading(e.random(-e.PI,e.PI));if(i)return this.isAddButton=i,this.position=I.copy(),this.defaultColor=e.color("#bbb"),void(this.json={id:"AddButton",written:0,limit:1,longSide:53,shortSide:11});if(this.position=c,!this.json.custom_color)switch(this.json.importance){case"0":this.defaultColor=e.color("#58a192");break;case"1":this.defaultColor=e.color("#ddbb41");break;case"2":this.defaultColor=e.color("#ff754e")}let h=Number(this.json.importance);switch(h){case 0:this.EllipseSize=96;break;case 1:this.EllipseSize=104;break;case 2:this.EllipseSize=112}if(!M[h]){M[h]=e.createImage(this.EllipseSize,this.EllipseSize),M[h].loadPixels();let T=e.createVector(M[h].width/2,M[h].height/2);for(let S=0,_=M[h].height;S<_;S++)for(let D=0,me=M[h].width;D<me;D++){let ye=e.createVector(D,S);T.dist(ye)<this.EllipseSize/2-1&&M[h].set(D,S,e.color(255,80))}M[h].updatePixels()}ge.loadBlobFromUserPath(`todo/${this.json.id}/thumbnail.png`,"").then(T=>{let S=URL.createObjectURL(T);e.loadImage(S,_=>{this.ThumbnailImage=_,this.ThumbnailImage.mask(M[h]),URL.revokeObjectURL(S)})}).catch(T=>{})}display(){e.push(),this.isGrabbed||(this.CalcPosition(),this.OnCollider(),this.position=this.position.add(this.Velocity)),e.translate(this.position),this.LerpProgress=e.map(Date.now(),this.json.startFrom||this.json.written,this.json.limit,0,1,!0),(this.isAddButton||this.json.written>this.json.limit)&&(this.LerpProgress=1),e.fill((this.json.custom_color||this.defaultColor.toString("#rrggbb"))+e.hex(e.floor(e.lerp(34,96,this.LerpProgress)),2)),e.ellipse(0,0,this.EllipseSize,this.EllipseSize),this.ThumbnailImage&&e.image(this.ThumbnailImage,0,0,this.EllipseSize,this.EllipseSize),e.push(),e.noFill(),this.isAddButton?(e.push(),e.noStroke(),e.fill(255),e.rect(0,0,this.json.shortSide,this.json.longSide),e.rect(0,0,this.json.longSide,this.json.shortSide),e.pop()):(e.stroke(this.json.custom_color||this.defaultColor),e.strokeWeight(this.ProgressWeight)),e.rotate(-e.PI/2);let t=this.EllipseSize-this.ProgressWeight;e.arc(0,0,t,t,0,this.LerpProgress*e.TWO_PI),e.pop();let i=.9*this.EllipseSize;this.TextColor=e.color(L.Mp?255:0,0==this.LerpProgress?128:255),e.fill(this.TextColor),e.text(this.json.title,0,0,i,i),e.pop()}CalcPosition(){let t=this.position.dist(I),i=e.map(t,0,this.EllipseSize/8,0,1,!0),l=e.map(i,this.EllipseSize/4,0,1,.95,!0);this.Accel.x=i,this.Accel.y=0;let c=this.position.copy().sub(W).heading()-e.PI;this.Accel=this.Accel.setHeading(c),this.Velocity.add(this.Accel).mult(l)}OnCollider(){for(let t=0,i=n.length;t<i;t++)if(a[n[t]]!=this){let l=a[n[t]],c=this.position.dist(l.position),h=this.EllipseSize/2+l.EllipseSize/2;c<h&&(e.isPlayingCanvas.loop||Y==this&&(Y=void 0,e.noLoop()),this.ReflectBounce(l,c/h),l.ReflectBounce(this,c/h))}}ReflectBounce(t,i){let l=$.Vector.sub(this.position,t.position);this.Velocity.add(l.mult(1-i)).mult(.85)}makeDone(){var t=this;return(0,w.c)(function*(){t.LifeTime=1,yield new Promise(c=>setTimeout(c,500)),t.Velocity=I.copy(),t.Accel=I.copy(),t.OriginalEllipseSize=t.EllipseSize,t.OriginalProgWeight=t.ProgressWeight,t.json.done=!0,k.push(t),e.isPlayingCanvas.loop||e.loop()})()}DoneAnim(){var t=this;return(0,w.c)(function*(){if(e.isPlayingCanvas.loop||e.loop(),t.LifeTime-=.04,t.EllipseSize=t.OriginalEllipseSize*t.LifeTime,t.ProgressWeight=t.OriginalProgWeight*t.LifeTime,t.LifeTime<.5&&A.push(new Q(t.position,t.json.custom_color||t.defaultColor)),t.TextColor=e.color(L.Mp?255:0,(0==t.LerpProgress?128:255)*t.LifeTime),t.isAddButton&&(t.json.longSide*=t.LifeTime,t.json.shortSide*=t.LifeTime),t.LifeTime<0){e.isPlayingCanvas.loop||setTimeout(()=>e.noLoop(),1e3),t.RemoveTodo(),e.count_todo();for(let i=0;i<20;i++)A.push(new Q(t.position,t.json.custom_color||t.defaultColor))}})()}Clicked(){O&&!v&&!this.json.done&&(this.isAddButton?B.open_add_todo_page():B.open_add_todo_page(JSON.stringify(this.json)))}RemoveTodo(){for(let t=0,i=n.length;t<i;t++)if(n[t]==this.json.id){n.splice(t,1);break}for(let t=0,i=k.length;t<i;t++)if(k[t]=this){k.splice(t,1);break}delete a[this.json.id]}}class Q{constructor(t,i){this.RectSize=4,this.rotate=0,this.pos=t.copy(),e.randomSeed(e.random(-255,255)),this.lifeTime=e.random(180,255),this.vel=e.createVector(e.random(-75,75),e.random(-40,-80)),this.acc=e.createVector(0,e.random(-1,-3)),e.push(),e.colorMode(e.HSB);let l=e.hue(i),c=e.saturation(i),h=e.brightness(i);this.color=e.color(e.random(l-20,l+20),e.random(c-20,c+20),e.random(h-20,h+20),this.lifeTime/255),e.pop(),this.RectSize=e.random(3,4),this.rotate=e.random(-e.PI,e.PI)}display(){this.color.setAlpha(this.lifeTime/255),e.fill(this.color),this.CalcPhysics(),e.push(),e.translate(this.pos),e.rotate(this.rotate),e.rect(0,0,this.RectSize,this.RectSize),e.pop(),this.lifeTime--}CalcPhysics(){this.acc.y+=.07,this.vel.add(this.acc),this.pos.add(this.vel.copy().div(100))}}let G,C,Z,E,F=0;e.mousePressed=s=>{if(!v)switch(O=!0,s.which){case 1:C=e.createVector(e.mouseX,e.mouseY),E=f.copy(),G=e.createVector(e.mouseX,e.mouseY);for(let t=0,i=n.length;t<i;t++)if(a[n[t]].position.dist(j())<a[n[t]].EllipseSize/2){a[n[t]].isGrabbed=!0,m=a[n[t]],C=j();break}break;case 2:X()}},e.mouseDragged=s=>{if(!v&&1===(this.isPlayingCanvas.loop||e.redraw(),s.which)){G=e.createVector(e.mouseX,e.mouseY);let t=0;m?(m.position=j(),t=C.dist(j())):(f=E.copy().add(G.sub(C).div(y)),t=E.dist(f)),t>15&&(O=!1)}},e.mouseReleased=s=>{v||1!==s.which||(G=void 0,ee())};let j=(s,t)=>{let i=e.createVector(s||e.mouseX,t||e.mouseY);return i.sub(R),i.div(y),i.sub(f),i};e.mouseWheel=s=>{v||(this.isPlayingCanvas.loop||e.redraw(),fe(j()),y*=s.deltaY<0?1.1:.9,localStorage.setItem("p5todoScale",`${y}`))};let fe=s=>{R=e.createVector(e.mouseX,e.mouseY),f=s.mult(-1)},P=[],z=!1;const V=56;e.touchStarted=s=>{if(!v)switch(O=!0,P=s.touches,z=!0,P.length){case 1:q();break;case 2:let t=e.createVector(P[0].clientX,P[0].clientY-V),i=e.createVector(P[1].clientX,P[1].clientY-V);F=t.dist(i),C=t.copy().add(i).div(2),E=f.copy(),Z=y,m&&(m.isGrabbed=!1,m.Velocity=I.copy(),m.Accel=I.copy(),m=void 0);break;default:z=!1,X()}},e.touchMoved=s=>{if(!v){switch(this.isPlayingCanvas.loop||e.redraw(),P=s.touches,P.length){case 1:{if(!z)return;let t=s.changedTouches[0],i=e.createVector(t.clientX,t.clientY-V),l=0;m?(m.position=j(),l=C.dist(j(i.x,i.y))):(f=E.copy().add(i.sub(C).div(y)),l=E.dist(f)),l>15&&(O=!1)}break;case 2:{if(!z)return;let t=e.createVector(P[0].clientX,P[0].clientY-V),i=e.createVector(P[1].clientX,P[1].clientY-V),l=t.copy().add(i).div(2);y=t.dist(i)/F*Z,localStorage.setItem("p5todoScale",`${y}`),f=E.copy().add(l.sub(C).div(y))}}return!1}},e.touchEnded=s=>{if(!v)switch(P=s.touches,P.length){case 0:ee(),z=!1;break;case 1:if(!z)return;q(),F=0}};let q=()=>{C=e.createVector(P[0].clientX,P[0].clientY-V),E=f.copy();for(let s=0,t=n.length;s<t;s++)if(a[n[s]].position.dist(j(C.x,C.y))<a[n[s]].EllipseSize/2){a[n[s]].isGrabbed=!0,m=a[n[s]];break}},ee=()=>{if(m&&(m.isGrabbed=!1,m.Velocity=I.copy(),m.Accel=I.copy(),m=void 0),C=void 0,E.dist(f)<15)for(let t=0,i=n.length;t<i;t++)if(a[n[t]].position.dist(j())<a[n[t]].EllipseSize/2){a[n[t]].Clicked();break}}})}ionViewDidEnter(){let d=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;L.Mp!=d&&this.global.UpdateIsDarkMode(d),document.getElementById("p5todo")?this.global.p5todo.PlayCanvas():this.CreateTodoManager(),this.nakama.resumeBanner(),this.try_add_shortcut()}try_add_shortcut(){this.global.p5key&&this.global.p5key.KeyShortCut?this.global.p5key.KeyShortCut.AddAct=()=>{this.nakama.open_add_todo_page()}:setTimeout(()=>{this.try_add_shortcut()},100)}ionViewWillLeave(){this.global.p5todo&&this.global.p5todo.StopCanvas(),delete this.global.p5key.KeyShortCut.AddAct}}return(r=b).\u0275fac=function(d){return new(d||r)(o.GI1(L.A1),o.GI1(oe.o),o.GI1(se.h),o.GI1(le.Y),o.GI1(ne.k),o.GI1(x.iW))},r.\u0275cmp=o.In1({type:r,selectors:[["app-main"]],decls:11,vars:6,consts:[[1,"ion-no-border"],[1,"play_button",3,"click"],["button","","style","width: 24px; height: 24px;","name","play-circle",4,"ngIf"],["button","","style","width: 24px; height: 24px;","name","pause-circle",4,"ngIf"],[1,"header_online_circle",3,"click"],["oncontextmenu","return false;"],[4,"ngIf"],["id","todo",1,"full_screen",2,"display","flex"],["button","","name","play-circle",2,"width","24px","height","24px"],["button","","name","pause-circle",2,"width","24px","height","24px"],[1,"disconnect_info",3,"click"],["color","medium","name","create-outline",2,"width","60px","height","60px"],["color","medium"]],template:function(d,g){1&d&&(o.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),o.OEk(3),o.C$Y(),o.I0R(4,"div",1),o.qCj("click",function(){return g.toggleCanvasPlaying()}),o.yuY(5,ae,1,0,"ion-icon",2)(6,re,1,0,"ion-icon",3),o.C$Y(),o.I0R(7,"div",4),o.qCj("click",function(){return g.nakama.toggle_all_session(!0)}),o.C$Y()()(),o.I0R(8,"ion-content",5),o.yuY(9,de,6,1,"div",6),o.wR5(10,"div",7),o.C$Y()),2&d&&(o.yG2(3),o.cNF(g.lang.text.Main.Title),o.yG2(2),o.E7m("ngIf",!g.isPlayingCanvas.loop),o.yG2(),o.E7m("ngIf",g.isPlayingCanvas.loop),o.yG2(),o.m_g("background-color: "+g.statusBar.colors[g.statusBar.settings.groupServer]+"; cursor: pointer;"),o.yG2(2),o.E7m("ngIf",g.isEmptyTodo))},dependencies:[H.u_,x._i,x.wB,x.Ko,x.QR,x.tM,x.Md],styles:[".md[_ngcontent-%COMP%]   .play_button[_ngcontent-%COMP%]{position:absolute;right:68px;top:16px;cursor:pointer}.ios[_ngcontent-%COMP%]   .play_button[_ngcontent-%COMP%]{position:absolute;right:68px;top:10px;cursor:pointer}"]}),b})()},{path:"add-todo-menu",loadChildren:()=>Promise.all([u.e(8744),u.e(7048),u.e(3872)]).then(u.bind(u,3872)).then(r=>r.AddTodoMenuPageModule)}];let he=(()=>{var r;class b{}return(r=b).\u0275fac=function(d){return new(d||r)},r.\u0275mod=o.a4G({type:r}),r.\u0275inj=o.s3X({imports:[U.qQ.forChild(ce),U.qQ]}),b})(),ue=(()=>{var r;class b{}return(r=b).\u0275fac=function(d){return new(d||r)},r.\u0275mod=o.a4G({type:r}),r.\u0275inj=o.s3X({imports:[H.MD,te.y,x.wZ,he]}),b})()}}]);