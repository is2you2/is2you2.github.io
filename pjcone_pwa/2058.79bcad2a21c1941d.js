"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2058],{2058:(ge,D,g)=>{g.r(D),g.d(D,{AddTodoMenuPageModule:()=>_e});var x=g(6814),k=g(95),h=g(1325),b=g(5877),I=g(5861),y=g(9868),C=g(9745),T=g(9080),A=g(3641),M=g(477),w=g(8162),O=g(1186),S=g(3832),e=g(9468),P=g(3857),U=g(9376),J=g(6593),F=g(797),N=g(4093),q=g(7488),j=g(6052);const $=["StartCalendar"],B=["Calendar"],W=["NewAttach"],L=["StoreAt"],R=["ImporantSel"];function Q(u,m){if(1&u&&(e.TgZ(0,"ion-select-option",50),e._uU(1),e.qZA()),2&u){const r=m.$implicit;e.Q6J("value",r),e.xp6(1),e.hij("",r.name," ")}}function Y(u,m){if(1&u){const r=e.EpF();e.TgZ(0,"ion-item",45),e.NdJ("click",function(){e.CHM(r);const i=e.oxw();return e.KtG(i.StoreAtSelClicked())}),e.TgZ(1,"ion-select",46,47),e.NdJ("ionChange",function(i){e.CHM(r);const s=e.oxw();return e.KtG(s.StoreAtSelChanged(i))}),e.TgZ(3,"ion-select-option",48),e._uU(4),e.qZA(),e.YNc(5,Q,2,2,"ion-select-option",49),e.qZA()()}if(2&u){const r=e.oxw();e.xp6(1),e.Q6J("label",r.lang.text.TodoDetail.StoreAt),e.xp6(3),e.Oqu(r.lang.text.TodoDetail.OnThisDevice),e.xp6(1),e.Q6J("ngForOf",r.AvailableStorageList)}}function E(u,m){if(1&u){const r=e.EpF();e.TgZ(0,"div")(1,"ion-item")(2,"ion-label",51),e._uU(3),e.qZA(),e.TgZ(4,"ion-label",52),e._uU(5),e.qZA()(),e.TgZ(6,"ion-grid",53)(7,"ion-row")(8,"ion-col",54)(9,"ion-item",55),e.NdJ("click",function(){e.CHM(r);const i=e.oxw();return e.KtG(i.doneTodo())}),e.TgZ(10,"ion-label",56),e._uU(11),e.qZA()()()()()()}if(2&u){const r=e.oxw();e.xp6(3),e.Oqu(r.userInput.display_store||r.lang.text.TodoDetail.WIP),e.xp6(2),e.Oqu(r.userInput.display_creator),e.xp6(4),e.Q6J("disabled",!r.isModifiable||r.isButtonClicked),e.xp6(2),e.Oqu(r.lang.text.TodoDetail.TodoComplete)}}function G(u,m){if(1&u){const r=e.EpF();e.TgZ(0,"ion-icon",57),e.NdJ("click",function(){e.CHM(r);const i=e.oxw();return e.KtG(i.SpeechToTitleText())}),e.qZA()}}function H(u,m){if(1&u){const r=e.EpF();e.TgZ(0,"ion-item")(1,"ion-checkbox",60),e.NdJ("ngModelChange",function(i){const a=e.CHM(r).$implicit;return e.KtG(a.todo_checked=i)}),e._uU(2),e.qZA()()}if(2&u){const r=m.$implicit;e.xp6(1),e.Q6J("ngModel",r.todo_checked),e.xp6(1),e.Oqu(r.display_name)}}function K(u,m){if(1&u){const r=e.EpF();e.TgZ(0,"ion-accordion",50)(1,"ion-item",23)(2,"ion-label"),e._uU(3),e.qZA()(),e.TgZ(4,"div",26)(5,"ion-item",13),e.NdJ("click",function(){const s=e.CHM(r).$implicit,a=e.oxw(2);return e.KtG(a.toggle_all_user(s.id))}),e.TgZ(6,"ion-label"),e._uU(7),e.qZA()(),e.YNc(8,H,3,2,"ion-item",32),e.qZA()()}if(2&u){const r=m.$implicit,t=e.oxw(2);e.Q6J("value",r.id),e.xp6(3),e.Oqu(r.name),e.xp6(4),e.Oqu(t.lang.text.TodoDetail.ToggleWorkers),e.xp6(1),e.Q6J("ngForOf",t.AvailableWorker[r.id])}}function z(u,m){if(1&u&&(e.TgZ(0,"div")(1,"ion-accordion-group",null,58)(3,"ion-accordion")(4,"ion-item",23)(5,"ion-label"),e._uU(6),e.qZA()(),e.TgZ(7,"div",26)(8,"ion-accordion-group",null,59),e.YNc(10,K,9,4,"ion-accordion",49),e.qZA()()()()()),2&u){const r=e.oxw();e.xp6(6),e.Oqu(r.lang.text.TodoDetail.ManageWorker),e.xp6(4),e.Q6J("ngForOf",r.WorkerGroups)}}function V(u,m){if(1&u&&(e.TgZ(0,"div",68),e._uU(1),e.qZA()),2&u){const r=e.oxw().$implicit;e.xp6(1),e.Oqu(r.displayTime)}}function X(u,m){1&u&&e._UZ(0,"ion-icon",69)}function ee(u,m){1&u&&e._UZ(0,"ion-icon",70)}function te(u,m){1&u&&e._UZ(0,"ion-icon",71)}function ie(u,m){if(1&u&&(e.TgZ(0,"ion-item",63)(1,"ion-label"),e._uU(2),e.qZA(),e.YNc(3,V,2,1,"div",64),e.YNc(4,X,1,0,"ion-icon",65),e.YNc(5,ee,1,0,"ion-icon",66),e.YNc(6,te,1,0,"ion-icon",67),e.qZA()),2&u){const r=m.$implicit;e.xp6(2),e.Oqu(r.name),e.xp6(1),e.Q6J("ngIf",r.displayTime),e.xp6(1),e.Q6J("ngIf",void 0===r.isDelete),e.xp6(1),e.Q6J("ngIf",1==r.isDelete),e.xp6(1),e.Q6J("ngIf",0==r.isDelete)}}function ae(u,m){if(1&u&&(e.TgZ(0,"div")(1,"ion-accordion-group",null,58)(3,"ion-accordion")(4,"ion-item",23)(5,"ion-label"),e._uU(6),e.qZA(),e.TgZ(7,"ion-label",61),e._uU(8),e.qZA()(),e.TgZ(9,"div",26),e.YNc(10,ie,7,5,"ion-item",62),e.qZA()()()()),2&u){const r=e.oxw();e.xp6(6),e.Oqu(r.lang.text.TodoDetail.ManageWorker),e.xp6(2),e.Oqu(r.worker_done+" / "+r.userInput.workers.length),e.xp6(2),e.Q6J("ngForOf",r.userInput.workers)}}function ne(u,m){if(1&u){const r=e.EpF();e.TgZ(0,"ion-label",72),e.NdJ("click",function(){e.CHM(r);const i=e.oxw();return e.KtG(i.toggle_custom_color())}),e._uU(1),e.qZA()}if(2&u){const r=e.oxw();e.xp6(1),e.Oqu(r.lang.text.TodoDetail.SetCustomColor)}}function oe(u,m){if(1&u){const r=e.EpF();e.TgZ(0,"div")(1,"button",73),e.NdJ("click",function(){e.CHM(r);const i=e.oxw();return e.KtG(i.toggle_custom_color())}),e._uU(2),e.qZA(),e.TgZ(3,"input",74),e.NdJ("ngModelChange",function(i){e.CHM(r);const s=e.oxw();return e.KtG(s.userInput.custom_color=i)}),e.qZA()()}if(2&u){const r=e.oxw();e.xp6(2),e.hij(" ",r.lang.text.TodoDetail.remove," "),e.xp6(1),e.Q6J("ngModel",r.userInput.custom_color)}}function re(u,m){if(1&u){const r=e.EpF();e.TgZ(0,"ion-item-divider")(1,"ion-label"),e._uU(2),e.qZA(),e.TgZ(3,"ion-icon",57),e.NdJ("click",function(){e.CHM(r);const i=e.oxw();return e.KtG(i.SpeechToDetailText())}),e.qZA()()}if(2&u){const r=e.oxw();e.xp6(2),e.Oqu(r.lang.text.TodoDetail.description)}}function se(u,m){if(1&u&&e._UZ(0,"img",78),2&u){const r=e.oxw(2).$implicit;e.Q6J("src",r.thumbnail,e.LSH)("alt",r.filename)}}function le(u,m){if(1&u&&(e.TgZ(0,"ion-item",19)(1,"ion-label",51),e._uU(2),e.qZA()()),2&u){const r=e.oxw(3);e.xp6(2),e.Oqu(r.lang.text.TodoDetail.open_content_viewer)}}function ue(u,m){if(1&u){const r=e.EpF();e.TgZ(0,"div",45),e.NdJ("click",function(){e.CHM(r);const i=e.oxw().index,s=e.oxw();return e.KtG(s.open_content_viewer(i))}),e.YNc(1,se,1,2,"img",76),e.YNc(2,le,3,1,"ion-item",77),e.qZA()}if(2&u){const r=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf",r.thumbnail),e.xp6(1),e.Q6J("ngIf",!r.thumbnail)}}function de(u,m){if(1&u){const r=e.EpF();e.TgZ(0,"div")(1,"ion-item")(2,"ion-label",75),e._uU(3),e.qZA(),e.TgZ(4,"ion-button",45),e.NdJ("click",function(){const s=e.CHM(r).index,a=e.oxw();return e.KtG(a.remove_attach(s))}),e._uU(5),e.qZA()(),e.YNc(6,ue,3,2,"div",9),e.qZA()}if(2&u){const r=m.$implicit,t=e.oxw();e.xp6(3),e.Oqu(r.filename),e.xp6(2),e.hij(" ",t.lang.text.TodoDetail.delete_attach," "),e.xp6(1),e.Q6J("ngIf",r.viewer)}}function ce(u,m){if(1&u&&(e.TgZ(0,"ion-select-option",79),e._uU(1),e.qZA()),2&u){const r=e.oxw();e.xp6(1),e.Oqu(r.lang.text.GlobalAct.FromCamera)}}function pe(u,m){if(1&u){const r=e.EpF();e.TgZ(0,"td")(1,"ion-button",80),e.NdJ("click",function(){e.CHM(r);const i=e.oxw();return e.KtG(i.deleteData())}),e._uU(2),e.qZA()()}if(2&u){const r=e.oxw();e.xp6(1),e.Q6J("disabled",!r.isModifiable||r.isButtonClicked),e.xp6(1),e.hij(" ",r.lang.text.TodoDetail.remove," ")}}const me=[{path:"",component:(()=>{var u;class m{constructor(t,i,s,a,l,o,n,d,c,p,_,v,f,Z){this.route=t,this.router=i,this.modalCtrl=s,this.lang=a,this.p5toast=l,this.sanitizer=o,this.indexed=n,this.nakama=d,this.alertCtrl=c,this.noti=p,this.statusBar=_,this.loadingCtrl=v,this.global=f,this.navCtrl=Z,this.userInput={id:void 0,storeAt:"local",display_store:"",title:void 0,create_at:void 0,written:void 0,startFrom:void 0,limit:void 0,custom_color:void 0,workers:void 0,importance:"0",description:void 0,remote:void 0,display_creator:void 0,attach:[],done:void 0,is_focus:void 0,noti_id:void 0},this.isMobile=!1,this.buttonDisplay={saveTodo:this.lang.text.TodoDetail.buttonDisplay_add},this.AmICreator=!0,this.isModify=!1,this.isModifiable=!1,this.isLimitChangable=!1,this.normal_color="#888b",this.alert_color="#0bbb",this.AlertLerpStartFrom=.8,this.input_ele_ids=[],this.file_sel_id="",this.AvailableStorageList=[],this.isManager=!1,this.AvailableWorker={},this.WorkerGroups=[],this.toggle_logs={},this.worker_done=0,this.isButtonClicked=!1}ngOnInit(){var t=this;if(this.MainDiv=document.getElementById("main_div"),this.isMobile="Android"==A.n$||"iOS"==A.n$,this.nakama.removeBanner(),this.route.queryParams.subscribe(i=>{const s=this.router.getCurrentNavigation().extras.state;s&&(this.received_data=s.data),this.received_data&&(this.userInput={...this.userInput,...JSON.parse(this.received_data)})}),this.nakama.AddTodoLinkAct=function(){var i=(0,I.Z)(function*(s){t.nakama.removeBanner(),t.p5timer&&t.p5timer.remove(),t.received_data=s,t.userInput=JSON.parse(t.received_data),yield t.ionViewWillEnter(),t.show_count_timer()});return function(s){return i.apply(this,arguments)}}(),this.nakama.AddTodoManageUpdateAct=(i,s,a,l)=>{if(this.userInput.id==i)for(let o=0,n=this.userInput.workers.length;o<n;o++)if((this.userInput.workers[o].user_id||this.userInput.workers[o].id)==s){this.userInput.workers[o].isDelete=a,this.userInput.workers[o].timestamp=l,this.userInput.workers[o].displayTime=new Date(l).toLocaleString(),this.worker_done++;break}},"DesktopPWA"==A.n$&&setTimeout(()=>{this.CreateDrop()},0),this.userInput.workers)for(let i=0,s=this.userInput.workers.length;i<s;i++)this.userInput.workers[i].timestamp&&(this.userInput.workers[i].displayTime=new Date(this.userInput.workers[i].timestamp).toLocaleString(),this.worker_done++)}CreateDrop(){var t=this;let i=document.getElementById("p5Drop_todo");this.p5canvas=new y(s=>{s.setup=()=>{let a=s.createCanvas(i.clientWidth,i.clientHeight);a.parent(i),s.pixelDensity(1),a.drop(function(){var l=(0,I.Z)(function*(o){yield t.selected_blobFile_callback_act(o.file)});return function(o){return l.apply(this,arguments)}}())},s.mouseMoved=a=>{a.dataTransfer?(i.style.pointerEvents="all",i.style.backgroundColor="#0008"):(i.style.pointerEvents="none",i.style.backgroundColor="transparent")}})}selected_blobFile_callback_act(t){var i=this;return(0,I.Z)(function*(){let s=yield i.loadingCtrl.create({message:i.lang.text.TodoDetail.WIP});s.present();let a={};a.filename=t.name,a.file_ext=t.name.substring(t.name.lastIndexOf(".")+1),a.size=t.size,a.type=t.type,a.path=`tmp_files/todo/${a.filename}`,a.blob=t,a.content_related_creator=[{timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"loaded"}],a.content_creator={timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"loaded"};let l=!1;l=yield i.indexed.checkIfFileExist(a.path),i.userInput.id&&!l&&(l=yield i.indexed.checkIfFileExist(`todo/${i.userInput.id}/${a.filename}`)),l&&(a.filename=`${a.filename.substring(0,a.filename.lastIndexOf("."))}_.${a.file_ext}`),i.global.set_viewer_category(a);let o=URL.createObjectURL(t);"image"==a.viewer&&(a.thumbnail=i.sanitizer.bypassSecurityTrustUrl(o));try{yield i.indexed.saveBlobToUserPath(t,a.path),i.userInput.attach.push(a),setTimeout(()=>{URL.revokeObjectURL(o)},0),s.dismiss()}catch(n){console.error("\ud30c\uc77c \uc62c\ub9ac\uae30 \uc2e4\ud328: ",n),i.p5toast.show({text:i.lang.text.TodoDetail.load_failed}),s.dismiss()}i.auto_scroll_down()})()}ionViewWillEnter(){var t=this;return(0,I.Z)(function*(){let l,i=[];if(Object.keys(t.nakama.servers).forEach(n=>{Object.keys(t.nakama.servers[n]).forEach(c=>{"online"==t.statusBar.groupServer[n][c]&&i.push({name:`${t.nakama.servers[n][c].info.name}`,isOfficial:n,target:c,type:`${n}/${c}`})})}),[...i].forEach(n=>{t.AvailableStorageList.push(n)}),t.received_data)t.buttonDisplay.saveTodo=t.lang.text.TodoDetail.buttonDisplay_modify,l=JSON.parse(t.received_data),t.userInput={...t.userInput,...l},t.isModify=!0;else{let n=new Date((new Date).getTime()+432e5);t.userInput.limit=n.getTime()}if(t.file_sel_id=`todo_${t.userInput.id||"new_todo_id"}_${(new Date).getTime()}`,t.userInput.attach.length)for(let n=0,d=t.userInput.attach.length;n<d;n++){try{let c;if(t.userInput.remote){let _=yield t.loadingCtrl.create({message:t.lang.text.TodoDetail.WIP});_.present(),c=yield t.nakama.sync_load_file(t.userInput.attach[n],t.userInput.remote.isOfficial,t.userInput.remote.target,"todo_attach",t.userInput.remote.creator_id),_.dismiss()}else{if("image"!=t.userInput.attach[n].viewer&&"text"!=t.userInput.attach[n].viewer)throw"\ubc88\uc678 \uc378\ub124\uc77c \ud544\uc694";c=yield t.indexed.loadBlobFromUserPath(t.userInput.attach[n].path,t.userInput.attach[n].type)}if(!c)continue;let p=URL.createObjectURL(c);t.global.modulate_thumbnail(t.userInput.attach[n],p)}catch{t.global.modulate_thumbnail(t.userInput.attach[n],"")}t.userInput.attach[n].exist=!0}try{if("local"==t.userInput.storeAt)t.isModify||(t.StoreAt.value=t.userInput.storeAt),t.userInput.display_store=t.lang.text.TodoDetail.OnThisDevice,t.userInput.display_creator=t.lang.text.TodoDetail.WrittenByMe,t.isModifiable=!0;else if(t.userInput.remote){if(t.isModify||(t.StoreAt.value=t.userInput.remote),t.userInput.display_store=t.userInput.remote.name,t.userInput.display_creator=t.lang.text.TodoDetail.Disconnected,!t.nakama.servers[t.userInput.remote.isOfficial]||!t.nakama.servers[t.userInput.remote.isOfficial][t.userInput.remote.target])throw t.userInput.display_creator=t.lang.text.TodoDetail.DeletedServer,{text:"Server Deleted",isModifiable:!0};if(t.statusBar.groupServer[t.userInput.remote.isOfficial]&&"online"!=t.statusBar.groupServer[t.userInput.remote.isOfficial][t.userInput.remote.target])throw{text:"Server disconnected",isModifiable:!1};"online"==t.statusBar.groupServer[t.userInput.remote.isOfficial][t.userInput.remote.target]&&(t.isModifiable=!0),t.AmICreator=t.nakama.servers[t.userInput.remote.isOfficial][t.userInput.remote.target].session.user_id==t.userInput.remote.creator_id,t.userInput.display_creator=t.AmICreator?t.lang.text.TodoDetail.WrittenByMe:t.nakama.load_other_user(t.userInput.remote.creator_id,t.userInput.remote.isOfficial,t.userInput.remote.target).display_name,t.userInput.remote.group_id&&(t.isModifiable="online"==t.nakama.groups[t.userInput.remote.isOfficial][t.userInput.remote.target][t.userInput.remote.group_id].status)}}catch(n){t.isModifiable=n.isModifiable,console.log("Server issue: ",n)}t.noti.Current=t.userInput.id;let o=new Date(t.userInput.limit);if(t.Calendar.value=new Date(o.getTime()-60*o.getTimezoneOffset()*1e3).toISOString(),l&&(t.limitTimeP5Display=new Date(l.limit).getTime()),t.userInput.startFrom){let n=new Date(t.userInput.startFrom);t.startDisplay=n.toLocaleString(t.lang.lang),t.startDisplay=t.startDisplay.substring(0,t.startDisplay.lastIndexOf(":"))}if(t.limitDisplay=o.toLocaleString(t.lang.lang),t.limitDisplay=t.limitDisplay.substring(0,t.limitDisplay.lastIndexOf(":")),t.isLimitChangable=!0,t.userInput.workers)for(let n=0,d=t.userInput.workers.length;n<d;n++)try{t.userInput.workers[n].name=t.nakama.load_other_user(t.userInput.workers[n].id,t.userInput.remote.isOfficial,t.userInput.remote.target).display_name}catch{}})()}ionViewDidEnter(){this.show_count_timer(),this.AddShortCut()}AddShortCut(){this.NewAttach.value||setTimeout(()=>{delete this.global.p5key.KeyShortCut.Digit,this.global.p5key.KeyShortCut.Escape=()=>{this.navCtrl.pop()},this.global.p5key.KeyShortCut.AddAct=()=>{this.checkIfInputFocus()||this.open_select_new()}},0),this.NewAttach.value=""}removeShortCut(){delete this.global.p5key.KeyShortCut.Escape,delete this.global.p5key.KeyShortCut.AddAct,delete this.global.p5key.KeyShortCut.Digit}start_change(t){this.isLimitChangable&&(this.userInput.startFrom=t.detail.value,this.startDisplay=new Date(t.detail.value).toLocaleString(this.lang.lang),this.startDisplay=this.startDisplay.substring(0,this.startDisplay.lastIndexOf(":")),this.startTimeP5Display=new Date(this.userInput.startFrom).getTime())}limit_change(t){this.isLimitChangable&&(this.userInput.limit=t.detail.value,this.limitDisplay=new Date(t.detail.value).toLocaleString(this.lang.lang),this.limitDisplay=this.limitDisplay.substring(0,this.limitDisplay.lastIndexOf(":")),this.limitTimeP5Display=new Date(this.userInput.limit).getTime())}remove_attach(t){this.userInput.attach.splice(t,1)}show_count_timer(){this.p5timer=new y(t=>{let i=0;this.startTimeP5Display=new Date(this.userInput.startFrom||this.userInput.written).getTime();let s,a=t.color(this.normal_color);t.setup=()=>{let c=document.getElementById("p5timer"),p=t.createCanvas(c.clientWidth,c.clientHeight);p.id("timer"),p.style("position","inherit"),p.style("width","100%"),p.style("height","100%"),p.parent(c),t.noStroke()};let l=0,o=()=>{s=(new Date).getTime(),l=this.limitTimeP5Display<s?1:t.map(s,this.startTimeP5Display,this.limitTimeP5Display,0,1,!0),l<=this.AlertLerpStartFrom?a=t.color(this.userInput.custom_color?this.userInput.custom_color+"bb":this.normal_color):l>this.AlertLerpStartFrom&&(a=this.userInput.custom_color?t.color(this.userInput.custom_color+"bb"):t.lerpColor(t.color(this.normal_color),t.color(this.alert_color),t.map(l,this.AlertLerpStartFrom,1,0,1)*i))};t.draw=()=>{o(),t.clear(255,255,255,255),t.push(),t.fill(a),i<1?(i+=.04,i>=1&&(i=1),t.rect(0,0,t.lerp(0,t.width,l*n(i)),t.height)):t.rect(0,0,t.lerp(0,t.width,l),t.height),t.pop()};let n=c=>d(t.sq(d(c))),d=c=>1-c})}from_camera(){var t=this;return(0,I.Z)(function*(){try{const i=yield w.V1.getPhoto({quality:90,resultType:w.dk.Base64,source:w.oK.Camera});let s=yield t.loadingCtrl.create({message:t.lang.text.TodoDetail.WIP});s.present();let a={};a.filename=`Camera_${(new Date).toLocaleString().replace(/[:|.|\/]/g,"_")}.${i.format}`,a.file_ext=i.format,a.base64="data:image/jpeg;base64,"+i.base64String,a.thumbnail=t.sanitizer.bypassSecurityTrustUrl(a.base64),a.type=`image/${i.format}`,a.typeheader="image",a.content_related_creator=[{timestamp:(new Date).getTime(),display_name:t.nakama.users.self.display_name,various:"camera"}],a.content_creator={timestamp:(new Date).getTime(),display_name:t.nakama.users.self.display_name,various:"camera"},a.path=`tmp_files/todo/${a.filename}`,a.viewer="image";let o=yield t.indexed.saveBase64ToUserPath(a.base64,a.path);a.blob=new Blob([o],{type:a.type}),a.size=a.blob.size,s.dismiss(),t.userInput.attach.push(a)}catch{}})()}open_select_new(){delete this.global.p5key.KeyShortCut.Escape,delete this.global.p5key.KeyShortCut.AddAct;let t=["text","image","camera","inapp","load"];this.isMobile||t.splice(2,1),this.global.p5key.KeyShortCut.Digit=i=>{this.checkIfInputFocus()||(delete this.global.p5key.KeyShortCut.Digit,t.length>i&&this.new_attach({detail:{value:t[i]}}))},this.NewAttach.open()}checkIfInputFocus(){if(!this.input_ele_ids.length){let i=document.getElementById("titleInput");this.input_ele_ids.push(i.children[0].children[1].children[0]),this.input_ele_ids.push(document.getElementById("descInput"))}let t=!1;for(let i=0,s=this.input_ele_ids.length;i<s;i++)if(document.activeElement==this.input_ele_ids[i]){t=!0;break}return t}new_attach(t){var i=this;return(0,I.Z)(function*(){switch(t.detail.value){case"camera":yield i.from_camera(),i.AddShortCut(),i.auto_scroll_down(100);break;case"text":let s=new Date,p=`texteditor_${s.getUTCFullYear()}-${("0"+(s.getMonth()+1)).slice(-2)}-${("0"+s.getDate()).slice(-2)}_${("0"+s.getHours()).slice(-2)}-${("0"+s.getMinutes()).slice(-2)}-${("0"+s.getSeconds()).slice(-2)}.txt`;i.modalCtrl.create({component:C.B,componentProps:{info:{content:{is_new:"text",type:"text/plain",viewer:"text",filename:p}},targetDB:i.indexed.ionicDB,no_edit:!0}}).then(_=>{i.removeShortCut(),_.onWillDismiss().then(v=>{if(i.AddShortCut(),v.data){let f={};f.content_creator={timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"textedit"},f.content_related_creator=[],f.content_related_creator.push(f.content_creator),f.blob=v.data.blob,f.path=v.data.path,f.size=v.data.blob.size,f.filename=v.data.blob.name||p,f.type="text/plain",f.viewer="text",i.userInput.attach.push(f),i.auto_scroll_down()}}),_.present()});break;case"image":i.modalCtrl.create({component:M.$}).then(_=>{i.removeShortCut(),_.onWillDismiss().then(function(){var v=(0,I.Z)(function*(f){f.data&&i.voidDraw_fileAct_callback(f)});return function(f){return v.apply(this,arguments)}}()),_.onDidDismiss().then(()=>{i.AddShortCut()}),_.present()});break;case"inapp":i.modalCtrl.create({component:S.P,componentProps:{only_files:!0}}).then(_=>{_.onWillDismiss().then(function(){var v=(0,I.Z)(function*(f){f.data&&i.selected_blobFile_callback_act(f.data)});return function(f){return v.apply(this,arguments)}}()),_.onDidDismiss().then(()=>{i.AddShortCut()}),_.present()});break;case"load":i.select_attach(),i.AddShortCut()}})()}select_attach(){document.getElementById(this.file_sel_id).click()}inputImageSelected(t){var i=this;return(0,I.Z)(function*(){if(t.target.files.length)for(let s=0,a=t.target.files.length;s<a;s++)yield i.selected_blobFile_callback_act(t.target.files[s])})()}StoreAtSelClicked(){this.StoreAt.open()}StoreAtSelChanged(t){let i=t.detail.value;"local"==i?(this.userInput.storeAt="local",this.userInput.remote=void 0,this.isManager=!1,this.userInput.workers=void 0):(this.userInput.storeAt=i.type,this.userInput.remote=i,this.userInput.workers=[],this.nakama.servers[i.isOfficial][i.target].client.getAccount(this.nakama.servers[i.isOfficial][i.target].session).then(s=>{let a=JSON.parse(s.user.metadata);if(this.WorkerGroups.length=0,this.AvailableWorker={},a.is_admin)this.nakama.servers[i.isOfficial][i.target].client.rpc(this.nakama.servers[i.isOfficial][i.target].session,"query_all_groups",{}).then(l=>{let o=l.payload;for(let n=0,d=o.length;n<d;n++){this.AvailableWorker[o[n].id]||(this.AvailableWorker[o[n].id]=[]);for(let c=0,p=o[n].users.length;c<p;c++){let _=this.nakama.load_other_user(o[n].users[c].user.user_id,i.isOfficial,i.target);delete _.todo_checked,_.email||this.AvailableWorker[o[n].id].push(_)}this.AvailableWorker[o[n].id].length?this.WorkerGroups.push({id:o[n].id,name:o[n].name}):delete this.AvailableWorker[o[n].id]}this.isManager=!0});else if(a.is_manager){for(let l=a.is_manager.length-1;l>=0;l--)try{let o=this.nakama.groups[i.isOfficial][i.target][a.is_manager[l]];this.AvailableWorker[o.id]||(this.AvailableWorker[o.id]=[]);for(let n=0,d=o.users.length;n<d;n++){let c=this.nakama.load_other_user(o.users[n].user.user_id||o.users[n].user.id,i.isOfficial,i.target);delete c.todo_checked,(c.id||c.user_id)!=this.nakama.servers[i.isOfficial][i.target].session.user_id&&this.AvailableWorker[o.id].push(c)}this.AvailableWorker[o.id].length?this.WorkerGroups.push({id:o.id,name:o.name}):delete this.AvailableWorker[o.id]}catch{a.is_manager.splice(l,1)}this.isManager=a.is_manager.length,this.isManager||delete a.is_manager,this.nakama.servers[i.isOfficial][i.target].client.rpc(this.nakama.servers[i.isOfficial][i.target].session,"update_user_metadata_fn",{user_id:this.nakama.servers[i.isOfficial][i.target].session.user_id,metadata:a}).catch(l=>{})}}))}toggle_all_user(t){this.toggle_logs[t]=!this.toggle_logs[t];for(let i=0,s=this.AvailableWorker[t].length;i<s;i++)this.AvailableWorker[t][i].todo_checked=this.toggle_logs[t]}ImporantSelClicked(){this.ImporantSel.open()}ImporantSelChanged(t){switch(this.userInput.importance=t.detail.value,this.userInput.importance){case"0":this.normal_color="#888b",this.alert_color="#0bbb",this.AlertLerpStartFrom=.8;break;case"1":this.normal_color="#888b",this.alert_color="#dddd0cbb",this.AlertLerpStartFrom=.5;break;case"2":this.normal_color="#dddd0cbb",this.alert_color="#800b",this.AlertLerpStartFrom=.4}}SpeechToTitleText(){var t=this;return(0,I.Z)(function*(){let i=yield O.M.start({language:t.lang.lang,maxResults:1,prompt:t.lang.text.ChatRoom.TalkMessage,partialResults:!0,popup:!0});t.userInput.title=i.matches[0]})()}SpeechToDetailText(){var t=this;return(0,I.Z)(function*(){let i=yield O.M.start({language:t.lang.lang,maxResults:1,prompt:t.lang.text.ChatRoom.TalkMessage,partialResults:!0,popup:!0});t.userInput.description?t.userInput.description+="\n":t.userInput.description="",t.userInput.description+=i.matches[0]})()}toggle_custom_color(){this.userInput.custom_color=this.userInput.custom_color?void 0:"#000000"}open_content_viewer(t){let i=[];for(let s=0,a=this.userInput.attach.length;s<a;s++)i.push({content:this.userInput.attach[s]});this.modalCtrl.create({component:C.B,componentProps:{info:{content:this.userInput.attach[t]},path:this.userInput.attach[t].path,relevance:i,targetDB:this.indexed.ionicDB},cssClass:"fullscreen"}).then(s=>{this.removeShortCut(),s.onDidDismiss().then(a=>{if(this.AddShortCut(),a.data)switch(a.data.type){case"image":let l=[];if(this.userInput.attach[a.data.index].content_related_creator&&(l=[...this.userInput.attach[a.data.index].content_related_creator]),this.userInput.attach[a.data.index].content_creator){let o=!1;for(let n=0,d=l.length;n<d;n++)if(void 0!==l[n].user_id&&void 0!==this.userInput.attach[a.data.index].content_creator.user_id&&l[n].user_id==this.userInput.attach[a.data.index].content_creator.user_id){o=!0;break}o||l.push(this.userInput.attach[a.data.index].content_creator)}return delete this.userInput.attach[a.data.index].exist,void this.modalCtrl.create({component:M.$,componentProps:{path:a.data.path||this.userInput.attach[a.data.index].path,width:a.data.width,height:a.data.height}}).then(o=>{this.removeShortCut(),o.onWillDismiss().then(n=>{n.data&&("image"===a.data.msg.content.viewer?this.voidDraw_fileAct_callback(n,l,a.data.index,!0):this.voidDraw_fileAct_callback(n,l,a.data.index))}),o.onDidDismiss().then(n=>{this.AddShortCut()}),o.present()});case"text":this.userInput.attach[a.data.index].content_related_creator.push(this.userInput.attach[a.data.index].content_creator),this.userInput.attach[a.data.index].content_creator={timestamp:(new Date).getTime(),display_name:this.nakama.users.self.display_name,various:"textedit"},this.userInput.attach[a.data.index].blob=a.data.blob,this.userInput.attach[a.data.index].path=a.data.path,this.userInput.attach[a.data.index].size=a.data.blob.size,this.userInput.attach[a.data.index].filename=a.data.blob.name||this.userInput.attach[a.data.index].filename,delete this.userInput.attach[a.data.index].exist}}),this.noti.Current="IonicViewerPage",s.present()})}auto_scroll_down(t=0){setTimeout(()=>{this.MainDiv.scrollTo({top:this.MainDiv.scrollHeight,behavior:"smooth"})},t)}voidDraw_fileAct_callback(t,i,s,a=!1){let l;try{if(!a)throw"not overwrite";l={},this.userInput.attach[s]=l}catch{l={},this.userInput.attach.push(l)}l.filename=t.data.name,l.file_ext="png",l.type="image/png",l.viewer="image",i?(l.content_related_creator=i,l.content_creator={timestamp:(new Date).getTime(),display_name:this.nakama.users.self.display_name,various:"voidDraw"}):(l.content_related_creator=[{timestamp:(new Date).getTime(),display_name:this.nakama.users.self.display_name,various:"voidDraw"}],l.content_creator={timestamp:(new Date).getTime(),display_name:this.nakama.users.self.display_name,various:"voidDraw"}),l.thumbnail=this.sanitizer.bypassSecurityTrustUrl(t.data.img),l.path=`tmp_files/todo/${l.filename}`,this.indexed.saveBase64ToUserPath(t.data.img,"tmp_files/todo/attach.jpeg",o=>{l.blob=new Blob([o],{type:l.type}),l.size=l.blob.size}),this.indexed.saveBase64ToUserPath(t.data.img,l.path,o=>{t.data.loadingCtrl.dismiss()}),this.auto_scroll_down(100)}doneTodo(){var t=this;return(0,I.Z)(function*(){if(t.isButtonClicked=!0,t.userInput.done=!0,t.global.p5todo.add_todo&&t.global.p5todo.add_todo(JSON.stringify(t.userInput)),t.userInput.remote){let i=yield t.loadingCtrl.create({message:t.lang.text.TodoDetail.WIP});i.present(),t.nakama.servers[t.userInput.remote.isOfficial][t.userInput.remote.target]&&(yield t.nakama.servers[t.userInput.remote.isOfficial][t.userInput.remote.target].socket.sendMatchState(t.nakama.self_match[t.userInput.remote.isOfficial][t.userInput.remote.target].match_id,T.B.ADD_TODO,encodeURIComponent(`done,${t.userInput.id}`))),i.dismiss()}t.deleteFromStorage(!1)})()}saveData(){var t=this;return(0,I.Z)(function*(){if(!t.userInput.title)return void t.p5toast.show({text:t.lang.text.TodoDetail.needDisplayName});t.isButtonClicked=!0;let i=!!t.userInput.attach.length;if(delete t.userInput.display_store,delete t.userInput.display_creator,JSON.stringify(t.userInput)==t.received_data)return void t.navCtrl.pop();if(t.userInput.create_at||(t.userInput.create_at=(new Date).getTime()),!t.userInput.id||!t.isModify)if(t.userInput.remote){let o=yield t.nakama.getRemoteTodoCounter(t.userInput.remote.isOfficial,t.userInput.remote.target);t.userInput.id=`RemoteTodo_${o+1}`}else t.userInput.id=new Date(t.userInput.create_at).toISOString().replace(/[:|.|\/]/g,"_");t.userInput.noti_id&&(t.isMobile||(clearTimeout(t.nakama.web_noti_id[t.userInput.noti_id]),delete t.nakama.web_noti_id[t.userInput.noti_id]),t.noti.ClearNoti(t.userInput.noti_id)),t.userInput.noti_id=t.nakama.get_noti_id(),t.nakama.set_todo_notification(t.userInput);let a=t.received_data?JSON.parse(t.received_data):void 0,l=!1;if(t.userInput.workers){t.userInput.workers.length=0;let o=Object.keys(t.AvailableWorker),n=[];for(let d=0,c=o.length;d<c;d++)for(let p=0,_=t.AvailableWorker[o[d]].length;p<_;p++){let v=t.AvailableWorker[o[d]][p].id||t.AvailableWorker[o[d]][p].user_id;t.AvailableWorker[o[d]][p].todo_checked&&!n.includes(v)&&(t.userInput.workers.push({id:v,name:t.nakama.load_other_user(v,t.userInput.remote.isOfficial,t.userInput.remote.target).display_name}),n.push(v))}t.userInput.workers.length||(t.userInput.workers=void 0)}try{a.attach.forEach(d=>{delete d.exist,delete d.thumbnail,delete d.base64,delete d.blob});let o=JSON.stringify(a.attach),n=JSON.parse(JSON.stringify(t.userInput.attach));n.forEach(d=>{delete d.exist,delete d.thumbnail,delete d.base64,delete d.blob}),n=JSON.stringify(n),l=o!=n}catch{l=!0}if(i&&l){let n,o=yield t.loadingCtrl.create({message:t.lang.text.TodoDetail.WIP});if(o.present(),a){yield t.indexed.removeFileFromUserPath(`todo/${t.userInput.id}/thumbnail.png`);for(let d=0,c=a.attach.length;d<c;d++){for(let p=0,_=t.userInput.attach.length;p<_;p++)if(t.userInput.attach[p].path==a.attach[d].path){a.attach[d].exist=!0,a.attach[d].index=p;break}(!a.attach[d].exist||a.attach[d].exist&&!t.userInput.attach[a.attach[d].index])&&(yield t.indexed.removeFileFromUserPath(a.attach[d].path))}}for(let d=0,c=t.userInput.attach.length;d<c;d++){let p;!t.userInput.attach[d].exist||!n&&"image"==t.userInput.attach[d].viewer?(p=yield t.indexed.loadBlobFromUserPath(t.userInput.attach[d].path,t.userInput.attach[d].type),t.userInput.attach[d].path=`todo/${t.userInput.id}/${t.userInput.attach[d].filename}`,yield t.indexed.saveBlobToUserPath(p,t.userInput.attach[d].path)):delete t.userInput.attach[d].exist,!n&&"image"==t.userInput.attach[d].viewer&&(n=URL.createObjectURL(p))}n&&(yield new Promise(d=>{new y(c=>{c.setup=()=>{c.noCanvas(),c.loadImage(n,p=>{p.width>p.height?p.resize(p.width/p.height*128,128):p.resize(128,p.height/p.width*128),c.createCanvas(128,128).hide(),c.smooth(),c.pixelDensity(1),c.image(p,-(p.width-128)/2,-(p.height-128)/2),c.saveFrames("","png",1,1,f=>{t.indexed.saveBase64ToUserPath(f[0].imageData.replace(/"|=|\\/g,""),`todo/${t.userInput.id}/thumbnail.png`,Z=>{d()}),URL.revokeObjectURL(n),c.remove()})},p=>{console.error("Todo-\ub4f1\ub85d\ub41c \uc774\ubbf8\uc9c0 \ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",p),d(),URL.revokeObjectURL(n),c.remove()})}})})),o.dismiss()}if(!i&&l&&a){yield t.indexed.removeFileFromUserPath(`todo/${t.userInput.id}/thumbnail.png`);for(let o=0,n=a.attach.length;o<n;o++)yield t.indexed.removeFileFromUserPath(a.attach[o].path)}if(t.userInput.attach.forEach(o=>{URL.revokeObjectURL(o.thumbnail),delete o.thumbnail,delete o.exist,delete o.base64}),t.userInput.written=(new Date).getTime(),t.userInput.startFrom){let o=new Date(t.userInput.startFrom).getTime();(new Date).getTime()>o?delete t.userInput.startFrom:t.userInput.startFrom=o}if(t.userInput.limit=new Date(t.userInput.limit).getTime(),t.isModify||t.userInput.remote&&!t.userInput.remote.creator_id&&(t.userInput.remote.creator_id=t.nakama.servers[t.userInput.remote.isOfficial][t.userInput.remote.target].session.user_id),t.userInput.remote){let o=yield t.loadingCtrl.create({message:t.lang.text.TodoDetail.WIP});o.present();try{if(t.userInput.attach.forEach(n=>{URL.revokeObjectURL(n.thumbnail),delete n.thumbnail,delete n.exist,delete n.base64}),t.userInput.workers){let n=yield t.nakama.servers[t.userInput.remote.isOfficial][t.userInput.remote.target].client.rpc(t.nakama.servers[t.userInput.remote.isOfficial][t.userInput.remote.target].session,"manage_todo_add_fn",t.userInput);t.userInput.id=`RemoteTodo_${n.payload.value}`;for(let d=0,c=t.userInput.workers.length;d<c;d++)try{let p=yield t.nakama.servers[t.userInput.remote.isOfficial][t.userInput.remote.target].client.readStorageObjects(t.nakama.servers[t.userInput.remote.isOfficial][t.userInput.remote.target].session,{object_ids:[{collection:"self_share",key:"private_match",user_id:t.userInput.workers[d].id}]});p.objects.length&&(yield t.nakama.servers[t.userInput.remote.isOfficial][t.userInput.remote.target].socket.joinMatch(p.objects[0].value.match_id),yield t.nakama.servers[t.userInput.remote.isOfficial][t.userInput.remote.target].socket.sendMatchState(p.objects[0].value.match_id,T.B.ADD_TODO,encodeURIComponent(`add,server_todo,${t.userInput.id}`)),yield t.nakama.servers[t.userInput.remote.isOfficial][t.userInput.remote.target].socket.leaveMatch(p.objects[0].value.match_id))}catch{}}else yield t.nakama.servers[t.userInput.remote.isOfficial][t.userInput.remote.target].client.writeStorageObjects(t.nakama.servers[t.userInput.remote.isOfficial][t.userInput.remote.target].session,[{collection:"server_todo",key:t.userInput.id,permission_read:2,permission_write:1,value:t.userInput}]).then(function(){var n=(0,I.Z)(function*(d){yield t.nakama.servers[t.userInput.remote.isOfficial][t.userInput.remote.target].socket.sendMatchState(t.nakama.self_match[t.userInput.remote.isOfficial][t.userInput.remote.target].match_id,T.B.ADD_TODO,encodeURIComponent(`add,${d.acks[0].collection},${d.acks[0].key}`))});return function(d){return n.apply(this,arguments)}}());if(i&&l&&a)for(let n=0,d=a.attach.length;n<d;n++){for(let c=0,p=t.userInput.attach.length;c<p;c++)if(t.userInput.attach[c].path==a.attach[n].path){a.attach[n].exist=!0,a.attach[n].index=c;break}(!a.attach[n].exist||a.attach[n].exist&&!t.userInput.attach[a.attach[n].index])&&(yield t.nakama.sync_remove_file(a.attach[n].path,t.userInput.remote.isOfficial,t.userInput.remote.target,"todo_attach"))}for(let n=0,d=t.userInput.attach.length;n<d;n++)yield t.nakama.sync_save_file(t.userInput.attach[n],t.userInput.remote.isOfficial,t.userInput.remote.target,"todo_attach");t.isModify||t.nakama.addRemoteTodoCounter(t.userInput.remote.isOfficial,t.userInput.remote.target,Number(t.userInput.id.split("_")[1])),o.dismiss()}catch(n){return console.error("\ud574\uc57c\ud560 \uc77c\uc774 \uc11c\ubc84\uc5d0 \uc804\uc1a1\ub418\uc9c0 \uc54a\uc74c: ",n),t.p5toast.show({text:t.lang.text.TodoDetail.CanAddToServer}),t.isButtonClicked=!1,void o.dismiss()}}t.global.p5todo.add_todo&&t.global.p5todo.add_todo(JSON.stringify(t.userInput)),yield t.indexed.saveTextFileToUserPath(JSON.stringify(t.userInput),`todo/${t.userInput.id}/info.todo`),t.navCtrl.pop()})()}deleteData(){this.alertCtrl.create({header:this.lang.text.TodoDetail.remove,message:this.lang.text.TodoDetail.terminateTodo,buttons:[{text:this.lang.text.TodoDetail.remove,handler:()=>{this.deleteFromStorage()}}]}).then(t=>t.present())}deleteFromStorage(t=!0){var i=this;return(0,I.Z)(function*(){i.isButtonClicked=!0;let s=yield i.loadingCtrl.create({message:i.lang.text.TodoDetail.WIP});if(s.present(),i.userInput.remote){try{if(!i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target])throw"Server deleted.";let a=i.userInput.remote.isOfficial,l=i.userInput.remote.target;yield i.nakama.servers[a][l].client.deleteStorageObjects(i.nakama.servers[a][l].session,{object_ids:[{collection:"server_todo",key:i.userInput.id}]});for(let o=0,n=i.userInput.attach.length;o<n;o++)yield i.nakama.sync_remove_file(i.userInput.attach[o].path,a,l,"todo_attach");t&&(yield i.nakama.servers[a][l].socket.sendMatchState(i.nakama.self_match[a][l].match_id,T.B.ADD_TODO,encodeURIComponent(`delete,${i.userInput.id}`)))}catch(a){console.error("\ud574\uc57c\ud560 \uc77c \uc0ad\uc81c \uc694\uccad\uc774 \uc11c\ubc84\uc5d0 \uc804\uc1a1\ub418\uc9c0 \uc54a\uc74c: ",a)}try{if(i.userInput.remote.creator_id!=i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].session.user_id){let a=(new Date).getTime();try{yield i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].client.rpc(i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].session,"manage_todo_done_fn",{id:i.userInput.id,creator_id:i.userInput.remote.creator_id,user_id:i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].session.user_id,timestamp:a,isDelete:t})}catch{}try{let l=yield i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].client.readStorageObjects(i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].session,{object_ids:[{collection:"self_share",key:"private_match",user_id:i.userInput.remote.creator_id}]});l.objects.length&&(yield i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].socket.joinMatch(l.objects[0].value.match_id),yield i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].socket.sendMatchState(l.objects[0].value.match_id,T.B.ADD_TODO,encodeURIComponent(`worker,${i.userInput.id},${i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].session.user_id},${t},${a}`)),yield i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].socket.leaveMatch(l.objects[0].value.match_id))}catch{}}}catch{}if(i.userInput.workers){try{yield i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].client.rpc(i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].session,"manage_todo_delete_fn",{id:i.userInput.id,workers:i.userInput.workers})}catch{}for(let a=0,l=i.userInput.workers.length;a<l;a++)try{let o=yield i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].client.readStorageObjects(i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].session,{object_ids:[{collection:"self_share",key:"private_match",user_id:i.userInput.workers[a].id}]});o.objects.length&&(yield i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].socket.joinMatch(o.objects[0].value.match_id),yield i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].socket.sendMatchState(o.objects[0].value.match_id,T.B.ADD_TODO,encodeURIComponent(t?`delete,${i.userInput.id}`:`done,${i.userInput.id}`)),yield i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].socket.leaveMatch(o.objects[0].value.match_id))}catch{}}i.nakama.removeRemoteTodoCounter(i.userInput.remote.isOfficial,i.userInput.remote.target,Number(i.userInput.id.split("_")[1]))}i.indexed.GetFileListFromDB(`todo/${i.userInput.id}`,function(){var a=(0,I.Z)(function*(l){l.forEach(o=>i.indexed.removeFileFromUserPath(o)),i.userInput.noti_id&&(i.isMobile||(clearTimeout(i.nakama.web_noti_id[i.userInput.noti_id]),delete i.nakama.web_noti_id[i.userInput.noti_id])),i.noti.ClearNoti(i.userInput.noti_id),t&&i.global.p5todo.remove_todo(JSON.stringify(i.userInput)),s.dismiss(),i.navCtrl.pop()});return function(l){return a.apply(this,arguments)}}())})()}ionViewWillLeave(){var t=this;return(0,I.Z)(function*(){delete t.global.p5key.KeyShortCut.Escape,delete t.global.p5key.KeyShortCut.AddAct,delete t.global.p5key.KeyShortCut.Digit,t.noti.Current="",t.p5timer&&t.p5timer.remove()})()}ngOnDestroy(){this.nakama.AddTodoLinkAct=void 0,this.nakama.AddTodoManageUpdateAct=void 0,this.p5canvas&&this.p5canvas.remove()}}return(u=m).\u0275fac=function(t){return new(t||u)(e.Y36(b.gz),e.Y36(b.F0),e.Y36(h.IN),e.Y36(P.b),e.Y36(U.F),e.Y36(J.H7),e.Y36(F.H),e.Y36(T.a),e.Y36(h.Br),e.Y36(N.J),e.Y36(q.g),e.Y36(h.HT),e.Y36(j.AN),e.Y36(h.SH))},u.\u0275cmp=e.Xpm({type:u,selectors:[["app-add-todo-menu"]],viewQuery:function(t,i){if(1&t&&(e.Gf($,5),e.Gf(B,5),e.Gf(W,5),e.Gf(L,5),e.Gf(R,5)),2&t){let s;e.iGM(s=e.CRH())&&(i.StartCalendar=s.first),e.iGM(s=e.CRH())&&(i.Calendar=s.first),e.iGM(s=e.CRH())&&(i.NewAttach=s.first),e.iGM(s=e.CRH())&&(i.StoreAt=s.first),e.iGM(s=e.CRH())&&(i.ImporantSel=s.first)}},decls:84,vars:38,consts:[[1,"ion-no-border"],["slot","start"],["defaultHref","main"],["id","p5Drop_todo",2,"position","absolute","width","100%","height","100%","display","flex","pointer-events","none","z-index","500"],["id","main_table",2,"width","100%","height","100%"],[2,"height","100%"],[2,"vertical-align","top"],["id","p5timer",2,"position","absolute","width","100%","height","8px","z-index","2"],["id","main_div",1,"main",2,"max-width","100vw"],[3,"click",4,"ngIf"],[4,"ngIf"],["id","titleInput",1,"ion-text-right",3,"label","ngModel","placeholder","ngModelChange"],["slot","end","name","mic-outline",3,"click",4,"ngIf"],["button","",3,"click"],[2,"pointer-events","none",3,"label","value","ionChange"],["ImporantSel",""],["value","2"],["value","1"],["value","0"],["button",""],["button","","color","medium","class","ion-text-end",3,"click",4,"ngIf"],["DateTime",""],["value","Start"],["button","","slot","header"],[1,"ion-text-right","uneditable_data"],[1,"ion-accordion-toggle-icon","hide_accordion_icon"],["slot","content"],[2,"display","inline",3,"locale","ionChange"],["StartCalendar",""],["value","Limit"],["Calendar",""],["id","descInput",1,"infobox",3,"ngModel","placeholder","ngModelChange"],[4,"ngFor","ngForOf"],[2,"display","none"],["interface","action-sheet",3,"label","ionChange","ionDismiss"],["NewAttach",""],["value","camera",4,"ngIf"],["value","text"],["value","image"],["value","inapp"],["value","load"],["hidden","","type","file","accept","*","multiple","",3,"id","change"],[2,"width","100%"],["id","bottom_buttons",2,"width","100%","background-color","black"],["expand","block",3,"disabled","click"],[3,"click"],[2,"pointer-events","none",3,"label","ionChange"],["StoreAt",""],["value","local"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["color","medium"],["color","medium",1,"ion-text-right"],["fixed",""],["col-33",""],["button","","color","success",3,"disabled","click"],[1,"ion-text-center"],["slot","end","name","mic-outline",3,"click"],["ManageWorker",""],["Groups",""],[3,"ngModel","ngModelChange"],[1,"ion-text-end"],["class","ignore_check",4,"ngFor","ngForOf"],[1,"ignore_check"],["style","color: var(--ion-color-medium);",4,"ngIf"],["slot","end","color","medium","name","ellipsis-horizontal-circle-outline",4,"ngIf"],["slot","end","color","danger","name","close-circle-outline",4,"ngIf"],["slot","end","color","success","name","checkmark-circle-outline",4,"ngIf"],[2,"color","var(--ion-color-medium)"],["slot","end","color","medium","name","ellipsis-horizontal-circle-outline"],["slot","end","color","danger","name","close-circle-outline"],["slot","end","color","success","name","checkmark-circle-outline"],["button","","color","medium",1,"ion-text-end",3,"click"],[2,"height","27px","transform","translateY(-3px)","padding","0px 8px",3,"click"],["type","color",2,"margin-right","8px","height","27px",3,"ngModel","ngModelChange"],["text-wrap",""],["class","image_thumbnail",3,"src","alt",4,"ngIf"],["button","",4,"ngIf"],[1,"image_thumbnail",3,"src","alt"],["value","camera"],["color","danger","expand","block",3,"disabled","click"]],template:function(t,i){1&t&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),e._uU(3),e.qZA(),e.TgZ(4,"ion-buttons",1),e._UZ(5,"ion-back-button",2),e.qZA()()(),e.TgZ(6,"ion-content"),e._UZ(7,"div",3),e.TgZ(8,"table",4)(9,"tr",5)(10,"td",6),e._UZ(11,"div",7),e.TgZ(12,"div",8),e.YNc(13,Y,6,3,"ion-item",9),e.YNc(14,E,12,4,"div",10),e.TgZ(15,"ion-item")(16,"ion-input",11),e.NdJ("ngModelChange",function(a){return i.userInput.title=a}),e.qZA(),e.YNc(17,G,1,0,"ion-icon",12),e.qZA(),e.YNc(18,z,11,2,"div",10),e.TgZ(19,"ion-item",13),e.NdJ("click",function(){return i.ImporantSelClicked()}),e.TgZ(20,"ion-select",14,15),e.NdJ("ionChange",function(a){return i.ImporantSelChanged(a)}),e.TgZ(22,"ion-select-option",16),e._uU(23),e.qZA(),e.TgZ(24,"ion-select-option",17),e._uU(25),e.qZA(),e.TgZ(26,"ion-select-option",18),e._uU(27),e.qZA()()(),e.YNc(28,ae,11,3,"div",10),e.TgZ(29,"ion-item",19)(30,"ion-label"),e._uU(31),e.qZA(),e.YNc(32,ne,2,1,"ion-label",20),e.YNc(33,oe,4,2,"div",10),e.qZA(),e.TgZ(34,"ion-accordion-group",null,21)(36,"ion-accordion",22)(37,"ion-item",23)(38,"ion-label"),e._uU(39),e.qZA(),e.TgZ(40,"ion-label",24),e._uU(41),e.qZA(),e._UZ(42,"ion-icon",25),e.qZA(),e.TgZ(43,"div",26)(44,"ion-datetime",27,28),e.NdJ("ionChange",function(a){return i.start_change(a)}),e.qZA()()(),e.TgZ(46,"ion-accordion",29)(47,"ion-item",23)(48,"ion-label"),e._uU(49),e.qZA(),e.TgZ(50,"ion-label",24),e._uU(51),e.qZA(),e._UZ(52,"ion-icon",25),e.qZA(),e.TgZ(53,"div",26)(54,"ion-datetime",27,30),e.NdJ("ionChange",function(a){return i.limit_change(a)}),e.qZA()()()(),e.YNc(56,re,4,1,"ion-item-divider",10),e.TgZ(57,"textarea",31),e.NdJ("ngModelChange",function(a){return i.userInput.description=a}),e.qZA(),e.YNc(58,de,7,3,"div",32),e.TgZ(59,"ion-item",13),e.NdJ("click",function(){return i.open_select_new()}),e.TgZ(60,"ion-label"),e._uU(61),e.qZA(),e.TgZ(62,"ion-item",33)(63,"ion-select",34,35),e.NdJ("ionChange",function(a){return i.new_attach(a)})("ionDismiss",function(){return i.AddShortCut()}),e.YNc(65,ce,2,1,"ion-select-option",36),e.TgZ(66,"ion-select-option",37),e._uU(67),e.qZA(),e.TgZ(68,"ion-select-option",38),e._uU(69),e.qZA(),e.TgZ(70,"ion-select-option",39),e._uU(71),e.qZA(),e.TgZ(72,"ion-select-option",40),e._uU(73),e.qZA()()()(),e.TgZ(74,"input",41),e.NdJ("change",function(a){return i.inputImageSelected(a)}),e.qZA()()()(),e.TgZ(75,"tr")(76,"td")(77,"div",42)(78,"table",43)(79,"tr")(80,"td")(81,"ion-button",44),e.NdJ("click",function(){return i.saveData()}),e._uU(82),e.qZA()(),e.YNc(83,pe,3,2,"td",10),e.qZA()()()()()()()),2&t&&(e.xp6(3),e.Oqu(i.lang.text.TodoDetail.Title),e.xp6(10),e.Q6J("ngIf",!i.isModify),e.xp6(1),e.Q6J("ngIf",i.isModify),e.xp6(2),e.Q6J("label",i.lang.text.TodoDetail.DisplayName)("ngModel",i.userInput.title)("placeholder",i.lang.text.TodoDetail.DisplayName_placeholder),e.xp6(1),e.Q6J("ngIf",i.isMobile),e.xp6(1),e.Q6J("ngIf","local"!=i.userInput.storeAt&&i.isManager),e.xp6(2),e.Q6J("label",i.lang.text.TodoDetail.Importance)("value",i.userInput.importance),e.xp6(3),e.Oqu(i.lang.text.TodoDetail.Importance_2),e.xp6(2),e.Oqu(i.lang.text.TodoDetail.Importance_1),e.xp6(2),e.Oqu(i.lang.text.TodoDetail.Importance_0),e.xp6(1),e.Q6J("ngIf",i.isModify&&i.userInput.workers),e.xp6(3),e.Oqu(i.lang.text.TodoDetail.CustomColor),e.xp6(1),e.Q6J("ngIf",!i.userInput.custom_color),e.xp6(1),e.Q6J("ngIf",i.userInput.custom_color),e.xp6(6),e.Oqu(i.lang.text.TodoDetail.startFrom),e.xp6(2),e.Oqu(i.startDisplay||i.lang.text.TodoDetail.startImmediatly),e.xp6(3),e.Q6J("locale",i.lang.lang),e.xp6(5),e.Oqu(i.lang.text.TodoDetail.limit),e.xp6(2),e.Oqu(i.limitDisplay),e.xp6(3),e.Q6J("locale",i.lang.lang),e.xp6(2),e.Q6J("ngIf",i.isMobile),e.xp6(1),e.Q6J("ngModel",i.userInput.description)("placeholder",i.lang.text.TodoDetail.description),e.xp6(1),e.Q6J("ngForOf",i.userInput.attach),e.xp6(3),e.Oqu(i.lang.text.TodoDetail.attachments),e.xp6(2),e.Q6J("label",i.lang.text.TodoDetail.new_attach),e.xp6(2),e.Q6J("ngIf",i.isMobile),e.xp6(2),e.Oqu(i.lang.text.TodoDetail.new_text),e.xp6(2),e.Oqu(i.lang.text.TodoDetail.new_draw),e.xp6(2),e.Oqu(i.lang.text.TodoDetail.user_fs),e.xp6(2),e.Oqu(i.lang.text.TodoDetail.add_attach),e.xp6(1),e.Q6J("id",i.file_sel_id),e.xp6(7),e.Q6J("disabled",!i.isModifiable||i.isButtonClicked),e.xp6(1),e.hij(" ",i.buttonDisplay.saveTodo," "),e.xp6(1),e.Q6J("ngIf",i.isModify))},dependencies:[x.sg,x.O5,k.Fj,k.JJ,k.On,h.We,h.eh,h.oU,h.YG,h.Sm,h.nz,h.wI,h.W2,h.x4,h.jY,h.Gu,h.gu,h.pK,h.Ie,h.rH,h.Q$,h.Nd,h.t9,h.n0,h.wd,h.sr,h.w,h.QI,h.j9,h.cs],styles:[".uneditable_data[_ngcontent-%COMP%]{color:#888}.main[_ngcontent-%COMP%]{width:100%;height:100%;padding:8px;overflow-x:hidden;overflow-y:auto;scroll-behavior:smooth}.logs[_ngcontent-%COMP%]{background:var(--voidDraw-menu-background);border-radius:8px;margin:8px;padding:4px 8px;text-align:center}.image_thumbnail[_ngcontent-%COMP%]{width:auto;height:auto;object-fit:contain;display:block;margin:auto}.ignore_check[_ngcontent-%COMP%]{pointer-events:none}"]}),m})()}];let he=(()=>{var u;class m{}return(u=m).\u0275fac=function(t){return new(t||u)},u.\u0275mod=e.oAB({type:u}),u.\u0275inj=e.cJS({imports:[b.Bz.forChild(me),b.Bz]}),m})(),_e=(()=>{var u;class m{}return(u=m).\u0275fac=function(t){return new(t||u)},u.\u0275mod=e.oAB({type:u}),u.\u0275inj=e.cJS({imports:[x.ez,k.u5,h.Pc,he]}),m})()}}]);