"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4722],{4722:(W,E,c)=>{c.r(E),c.d(E,{OthersProfilePageModule:()=>z});var I=c(177),R=c(4341),p=c(5374),O=c(9858),w=c(467),V=c(8326),e=c(3953),j=c(4237),G=c(8065),S=c(9900),N=c(4234),X=c(482),L=c(3656);function M(i,f){if(1&i){const s=e.RV6();e.j41(0,"td")(1,"ion-button",9),e.bIt("click",function(){e.eBV(s);const o=e.XpG(2);return e.Njj(o.notification_react(-5))}),e.EFF(2),e.k0s()()}if(2&i){const s=e.XpG(2);e.R7$(2),e.SpI(" ",s.lang.text.OtherProfile.add_to_group," ")}}function T(i,f){if(1&i){const s=e.RV6();e.j41(0,"td")(1,"ion-button",9),e.bIt("click",function(){e.eBV(s);const o=e.XpG(2);return e.Njj(o.notification_react(-2))}),e.EFF(2),e.k0s()()}if(2&i){const s=e.XpG(2);e.R7$(2),e.SpI(" ",s.lang.text.OtherProfile.add_friend," ")}}function U(i,f){if(1&i){const s=e.RV6();e.j41(0,"td")(1,"ion-button",10),e.bIt("click",function(){e.eBV(s);const o=e.XpG(2);return e.Njj(o.kick_user_from_group())}),e.EFF(2),e.k0s()()}if(2&i){const s=e.XpG(2);e.R7$(2),e.SpI(" ",s.lang.text.OtherProfile.kick_from_group," ")}}function F(i,f){if(1&i){const s=e.RV6();e.j41(0,"div",5)(1,"table",6)(2,"tr"),e.DNE(3,M,3,1,"td",7)(4,T,3,1,"td",7),e.j41(5,"td")(6,"ion-button",8),e.bIt("click",function(){e.eBV(s);const o=e.XpG();return e.Njj(o.create_chat())}),e.EFF(7),e.k0s()(),e.DNE(8,U,3,1,"td",7),e.k0s()()()}if(2&i){const s=e.XpG();e.R7$(3),e.Y8G("ngIf",s.has_admin&&s.additional_buttons[-5]),e.R7$(),e.Y8G("ngIf",s.additional_buttons[-2]),e.R7$(2),e.Y8G("disabled",s.lock_create_chat),e.R7$(),e.SpI(" ",s.lang.text.OtherProfile.privacy_chat," "),e.R7$(),e.Y8G("ngIf",s.has_admin)}}const B=[{path:"",component:(()=>{var i;class f{constructor(t,o,a,r,l,h,m,v){this.nakama=t,this.statusBar=o,this.p5toast=a,this.lang=r,this.global=l,this.route=h,this.router=m,this.navCtrl=v,this.info={},this.group_info={},this.additional_buttons={},this.has_admin=!1,this.isClickDisplayNameEdit=!1,this.lock_create_chat=!1}ngOnInit(){var t=this;return(0,w.A)(function*(){t.route.queryParams.subscribe(o=>{try{const a=t.router.getCurrentNavigation().extras.state;t.info=a.info,t.has_admin=a.has_admin,t.group_info=a.group,t.isOfficial=t.group_info.server.isOfficial,t.target=t.group_info.server.target,t.nakama.load_other_user(t.info.user.id,t.isOfficial,t.target),t.nakama.socket_reactive["others-profile"]=r=>{t.p5canvas.ChangeImageSmooth(r)},t.nakama.socket_reactive["others-online"]=()=>{t.p5canvas.loop()},t.catch_user_noties()}catch(a){console.log("\ub2e4\ub978 \uc0ac\ub78c\uc758 \ud504\ub85c\ud544 \uc5f4\uae30 \uc2e4\ud328: ",a)}})})()}ionViewWillEnter(){this.OtherCanvasDiv=document.getElementById("OtherUserCanvasDiv"),this.p5canvas=new V(t=>{let a,r,l,h,v,n,m=1,b="0, 0, 0",P=0;t.setup=()=>{let x=t.color(`#${(this.info.user.id.replace(/[^5-79a-b]/g,"")+"abcdef").substring(0,6)}`);b=`${t.red(x)}, ${t.green(x)}, ${t.blue(x)}`,v=t.createDiv(),v.style("width","100%"),v.style("height","100%"),v.style("background-image",`linear-gradient(to top, rgba(${b}, 0), rgba(${b}, 0))`),v.parent(this.OtherCanvasDiv),t.noCanvas(),t.pixelDensity(1),n=t.createDiv();const u="156px";n.style("width",u),n.style("height",u),n.style("position","absolute"),n.style("top","120px"),n.style("left","50%"),n.style("transform","translateX(-50%)"),n.style("border-radius",u),n.style("background-image","url(assets/data/avatar.svg)"),n.style("background-position","center"),n.style("background-repeat","no-repeat"),n.style("background-size","cover"),n.parent(this.OtherCanvasDiv);let g=t.createDiv();const $="36px";g.style("background-color",this.info.user.online?this.statusBar.colors.online:this.statusBar.colors.offline),g.style("width",$),g.style("height",$),g.style("position","absolute"),g.style("top","128px"),g.style("left",this.OtherCanvasDiv.clientWidth/2+38+"px"),g.style("border-radius",$),g.parent(this.OtherCanvasDiv),t.OnlineLamp=g,l=t.createImg(this.info.user.img,"profile_img"),l.style("width",u),l.style("height",u),l.style("border-radius",u),l.style("position","absolute"),l.style("object-fit","cover"),this.info.user.img||l.hide(),l.parent(n),h=t.createImg(void 0,"before_img"),h.style("width",u),h.style("height",u),h.style("border-radius",u),h.style("position","absolute"),h.style("object-fit","cover"),h.hide(),h.parent(n),t.ChangeImageSmooth=k=>{n.style("background-image","url(assets/data/avatar.svg)"),k?(h.elt.src=void 0,h.hide()):(h.elt.src=l.elt.src,h.show()),l.elt.src=k,m=1,t.loop(),this.info.user.img=k,k?l.show():l.hide()};const C="36px";let d=t.createDiv();d.style("width","100%"),d.style("position","absolute"),d.style("top","330px"),d.style("display","flex"),d.style("flex-direction","column"),d.parent(this.OtherCanvasDiv);let D=this.nakama.GetOverrideName(this.info.user.id,this.isOfficial,this.target);a=t.createDiv(D||this.info.user.display_name||this.lang.text.Profile.noname_user),a.style("font-size",C),a.style("font-weight","bold"),a.style("align-self","center"),a.style("width","80%"),a.style("text-align","center"),a.elt.onclick=()=>{r.value(""),r.attribute("placeholder",this.info.user.display_name||this.lang.text.Profile.noname_user),r.show(),a.hide(),r.elt.focus(),this.isClickDisplayNameEdit=!0},a.parent(d),r=t.createInput(),r.style("font-size",C),r.style("font-weight","bold"),r.style("align-self","center"),r.style("width","80%"),r.style("text-align","center"),r.attribute("placeholder",this.lang.text.Profile.name_placeholder),a.style("text-align","center"),r.parent(d),r.hide(),r.elt.addEventListener("focusout",()=>{let k=`${r.value()}`;this.nakama.SaveOverrideName(this.info.user.id,k,this.isOfficial,this.target),k?_.removeAttribute("hidden"):_.attribute("hidden","true"),a.html(`${k||this.info.user.display_name||this.lang.text.Profile.noname_user}`),r.hide(),a.show()});let _=t.createDiv(this.info.user.display_name||this.lang.text.Profile.noname_user);_.style("color","var(--ion-color-medium)"),_.style("align-self","center"),_.style("margin-top","36px"),_.style("width","80%"),_.style("text-align","center"),D||_.attribute("hidden","true"),_.parent(d);let y=t.createDiv(this.info.user.id);y.style("color","var(--ion-color-medium)"),y.style("align-self","center"),y.style("margin-top","36px"),y.style("width","80%"),y.style("text-align","center"),y.style("cursor","copy"),y.parent(d),y.elt.onclick=()=>{this.copy_id()},setTimeout(()=>{t.windowResized()},0)},t.draw=()=>{m>0&&(m-=.025,h.style("opacity",`${m}`),l.style("opacity",""+(1-m))),this.info.user.online?this.lerpVal<1?this.lerpVal+=.025:this.lerpVal=1:this.lerpVal>0?this.lerpVal-=.025:this.lerpVal=0,P<1&&(P+=.025),l.style("filter",`grayscale(${t.lerp(.9,0,this.lerpVal)}) contrast(${t.lerp(1.4,1,this.lerpVal)})`),h.style("filter",`grayscale(${t.lerp(.9,0,this.lerpVal)}) contrast(${t.lerp(1.4,1,this.lerpVal)})`),v.style("background-image",`linear-gradient(to top, rgba(${b}, ${t.min(1,P)/2}), rgba(${b}, 0))`),m<=0&&(this.lerpVal>=1||this.lerpVal<=0)&&P>=1&&(this.info.user.img&&n.style("background-image",""),this.p5canvas.OnlineLamp.style("background-color",this.info.user.online?this.statusBar.colors.online:this.statusBar.colors.offline),t.noLoop())},t.windowResized=()=>{t.OnlineLamp.style("left",this.OtherCanvasDiv.clientWidth/2+38+"px")}})}ionViewDidEnter(){this.global.p5key.KeyShortCut.Escape=()=>{this.navCtrl.pop()}}catch_user_noties(){this.nakama.noti_origin[this.isOfficial]&&this.nakama.noti_origin[this.isOfficial][this.target]&&Object.keys(this.nakama.noti_origin[this.isOfficial][this.target]).forEach(a=>{this.nakama.noti_origin[this.isOfficial][this.target][a].sender_id==this.info.user.id&&(this.additional_buttons[this.nakama.noti_origin[this.isOfficial][this.target][a].code.toString()]=a)})}notification_react(t){switch(t){case 0:case-1:case-2:break;case-5:this.nakama.servers[this.isOfficial][this.target].client.addGroupUsers(this.nakama.servers[this.isOfficial][this.target].session,this.group_info.group_id||this.group_info.id,[this.info.user.id]).then(o=>{o||console.warn("\ubc34 \uc720\uc800\uc5d0 \ub300\ud55c\uac83 \uac19\uc74c, \ud655\uc778 \ud544\uc694"),this.p5toast.show({text:`${this.lang.text.OtherProfile.added_to_group}: ${this.info.user.display_name||this.lang.text.Profile.noname_user}`}),this.nakama.servers[this.isOfficial][this.target].client.deleteNotifications(this.nakama.servers[this.isOfficial][this.target].session,[this.additional_buttons[t.toString()]]).then(a=>{a||console.warn("\uc54c\ub9bc \ubd80\uc815 \uac80\ud1a0 \ud544\uc694"),delete this.additional_buttons[t.toString()],this.nakama.update_notifications(this.isOfficial,this.target),this.info.status="online",this.p5canvas.loop()})});break;default:console.warn("\uc608\uc0c1\ud558\uc9c0 \ubabb\ud55c \uc54c\ub9bc \ubc18\uc751: ",t)}}create_chat(){var t=this;return(0,w.A)(function*(){if(!t.lock_create_chat){t.lock_create_chat=!0;try{let o=yield t.nakama.join_chat_with_modulation(t.info.user.id,2,t.isOfficial,t.target,!0);t.nakama.go_to_chatroom_without_admob_act(o),t.lock_create_chat=!1,t.navCtrl.pop()}catch(o){t.lock_create_chat=!1,console.error(o)}}})()}kick_user_from_group(){switch(this.info.state){case 0:case 1:case 2:this.after_announce_kick();break;case 3:this.nakama.servers[this.isOfficial][this.target].client.deleteNotifications(this.nakama.servers[this.isOfficial][this.target].session,[this.additional_buttons[-5]]).then(t=>{t||console.warn("\uc54c\ub9bc \ubd80\uc815 \uac80\ud1a0 \ud544\uc694"),this.after_announce_kick(),delete this.additional_buttons[-5],this.nakama.update_notifications(this.isOfficial,this.target),this.info.status="missing",this.p5canvas.loop()});break;default:console.warn("\uc608\uc0c1\ud558\uc9c0 \ubabb\ud55c \uadf8\ub8f9 \uc0ac\uc6a9\uc790 \uc0c1\ud0dc: ",this.info)}}after_announce_kick(){this.nakama.servers[this.isOfficial][this.target].client.kickGroupUsers(this.nakama.servers[this.isOfficial][this.target].session,this.group_info.group_id||this.group_info.id,[this.info.user.id]).then(t=>{this.p5toast.show({text:`${this.lang.text.OtherProfile.kicked_from_group}: ${this.info.user.display_name||this.lang.text.Profile.noname_user}`}),this.navCtrl.pop()})}copy_id(){this.global.WriteValueToClipboard("text/plain",this.info.user.id)}ionViewWillLeave(){delete this.global.p5key.KeyShortCut.Escape}ngOnDestroy(){this.route.queryParams.unsubscribe(),delete this.nakama.socket_reactive["others-profile"],delete this.nakama.socket_reactive["others-online"],this.p5canvas.remove()}}return(i=f).\u0275fac=function(t){return new(t||i)(e.rXU(j.X),e.rXU(G.j),e.rXU(S.G),e.rXU(N.y),e.rXU(X.z3),e.rXU(O.nX),e.rXU(O.Ix),e.rXU(L.q9))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-others-profile"]],decls:9,vars:2,consts:[[1,"ion-no-border"],["slot","start"],["defaultHref",""],["id","OtherUserCanvasDiv",2,"position","absolute","width","100%","height","100%","display","flex"],["style","width: 100%; position: absolute; bottom: 0;",4,"ngIf"],[2,"width","100%","position","absolute","bottom","0"],["id","input_table",2,"width","100%","background-color","black"],[4,"ngIf"],["expand","block",3,"click","disabled"],["expand","block",3,"click"],["color","danger","expand","block",3,"click"]],template:function(t,o){1&t&&(e.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),e.EFF(3),e.k0s(),e.j41(4,"ion-buttons",1),e.nrm(5,"ion-back-button",2),e.k0s()()(),e.j41(6,"ion-content"),e.nrm(7,"div",3),e.DNE(8,F,9,5,"div",4),e.k0s()),2&t&&(e.R7$(3),e.JRh(o.lang.text.OtherProfile.Title),e.R7$(5),e.Y8G("ngIf","online"==o.statusBar.groupServer[o.isOfficial][o.target]))},dependencies:[I.bT,p.Jm,p.QW,p.W9,p.eU,p.BC,p.ai,p.el],styles:[".fore-gradient[_ngcontent-%COMP%]{position:relative;background-image:linear-gradient(to top,#000,#0000);width:100%;height:100%}.content_size[_ngcontent-%COMP%]{height:360px}"]}),f})()}];let Z=(()=>{var i;class f{}return(i=f).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[O.iI.forChild(B),O.iI]}),f})(),z=(()=>{var i;class f{}return(i=f).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[I.MD,R.YN,p.bv,Z]}),f})()}}]);