"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7602],{3805:(Y,U,l)=>{l.d(U,{z:()=>I});var t=l(9863),A=l(5742),d=l(3996),k=l(9912),o=l(9808);function v(_,b){if(1&_&&(t.TgZ(0,"ion-label",2),t._uU(1),t.qZA()),2&_){const s=t.oxw(2);t.xp6(1),t.Oqu(s.lang.text.GlobalAct.variousCreator)}}function e(_,b){if(1&_&&(t.TgZ(0,"ion-label",2),t._uU(1),t.qZA()),2&_){const s=t.oxw(2);t.xp6(1),t.Oqu(s.lang.text.GlobalAct.FromCamera)}}function P(_,b){if(1&_&&(t.TgZ(0,"ion-label",2),t._uU(1),t.qZA()),2&_){const s=t.oxw(2);t.xp6(1),t.Oqu(s.lang.text.GlobalAct.FromVoidDraw)}}function M(_,b){if(1&_&&(t.TgZ(0,"ion-item")(1,"ion-label"),t._uU(2),t.qZA(),t.YNc(3,v,2,1,"ion-label",5),t.YNc(4,e,2,1,"ion-label",5),t.YNc(5,P,2,1,"ion-label",5),t.qZA()),2&_){const s=t.oxw();t.xp6(2),t.Oqu(s.lang.text.ContentInfo.SourceFrom),t.xp6(1),t.Q6J("ngIf","loaded"==s.content_creator.various),t.xp6(1),t.Q6J("ngIf","camera"==s.content_creator.various),t.xp6(1),t.Q6J("ngIf","voidDraw"==s.content_creator.various)}}function F(_,b){if(1&_&&(t.TgZ(0,"ion-label",2),t._uU(1),t.qZA()),2&_){const s=t.oxw(2);t.xp6(1),t.Oqu(s.lang.text.GlobalAct.variousCreator)}}function C(_,b){if(1&_&&(t.TgZ(0,"ion-label",2),t._uU(1),t.qZA()),2&_){const s=t.oxw(2);t.xp6(1),t.Oqu(s.lang.text.GlobalAct.FromCamera)}}function y(_,b){if(1&_&&(t.TgZ(0,"ion-label",2),t._uU(1),t.qZA()),2&_){const s=t.oxw(2);t.xp6(1),t.Oqu(s.lang.text.GlobalAct.FromVoidDraw)}}function g(_,b){if(1&_&&(t.TgZ(0,"div")(1,"ion-item-divider")(2,"div",6),t._uU(3),t.qZA()(),t.TgZ(4,"ion-item")(5,"ion-label"),t._uU(6),t.qZA(),t.TgZ(7,"ion-label",2),t._uU(8),t.qZA()(),t.TgZ(9,"ion-item")(10,"ion-label"),t._uU(11),t.qZA(),t.YNc(12,F,2,1,"ion-label",5),t.YNc(13,C,2,1,"ion-label",5),t.YNc(14,y,2,1,"ion-label",5),t.qZA()()),2&_){const s=b.$implicit,c=t.oxw();t.xp6(3),t.Oqu(s.timeDisplay),t.xp6(3),t.Oqu(c.lang.text.ContentInfo.Publisher),t.xp6(2),t.Oqu(s.publisher||s.display_name),t.xp6(3),t.Oqu(c.lang.text.ContentInfo.SourceFrom),t.xp6(1),t.Q6J("ngIf","loaded"==s.various),t.xp6(1),t.Q6J("ngIf","camera"==s.various),t.xp6(1),t.Q6J("ngIf","voidDraw"==s.various)}}let I=(()=>{class _{constructor(s,c,r,u){this.lang=s,this.modalCtrl=c,this.navParams=r,this.nakama=u}ngOnInit(){let s=this.navParams.get("info");this.isOfficial=this.navParams.get("isOfficial"),this.target=this.navParams.get("target"),this.content_creator=s.content_creator,this.content_creator.timeDisplay=new Date(this.content_creator.timestamp).toLocaleString(),this.content_related_creator=s.content_related_creator;try{this.content_related_creator[0].timestamp==this.content_related_creator[1].timestamp&&(this.content_related_creator[0].various&&(this.content_related_creator[0].publisher=this.content_related_creator[1].display_name),this.content_related_creator.splice(1,1))}catch(c){}this.content_related_creator.reverse(),this.content_creator.user_id&&(this.content_creator.is_me=this.nakama.servers[this.isOfficial][this.target].session.user_id==this.content_creator.user_id);for(let c=0,r=this.content_related_creator.length;c<r;c++)this.content_related_creator[c].user_id&&(this.content_related_creator[c].is_me=this.nakama.servers[this.isOfficial][this.target].session.user_id==this.content_related_creator[c].user_id),this.content_related_creator[c].timeDisplay=new Date(this.content_related_creator[c].timestamp).toLocaleString()}}return _.\u0275fac=function(s){return new(s||_)(t.Y36(A.b),t.Y36(d.IN),t.Y36(d.X1),t.Y36(k.a))},_.\u0275cmp=t.Xpm({type:_,selectors:[["app-content-info"]],decls:22,vars:8,consts:[["slot","start",3,"click"],["defaultHref",""],[1,"ion-text-end"],[4,"ngIf"],[4,"ngFor","ngForOf"],["class","ion-text-end",4,"ngIf"],[2,"width","100%","text-align","center"]],template:function(s,c){1&s&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t._uU(3),t.qZA(),t.TgZ(4,"ion-buttons",0),t.NdJ("click",function(){return c.modalCtrl.dismiss()}),t._UZ(5,"ion-back-button",1),t.qZA()()(),t.TgZ(6,"ion-content")(7,"ion-item-divider")(8,"ion-label"),t._uU(9),t.qZA()(),t.TgZ(10,"ion-item")(11,"ion-label"),t._uU(12),t.qZA(),t.TgZ(13,"ion-label",2),t._uU(14),t.qZA()(),t.YNc(15,M,6,4,"ion-item",3),t.TgZ(16,"ion-item")(17,"ion-label"),t._uU(18),t.qZA(),t.TgZ(19,"ion-label",2),t._uU(20),t.qZA()(),t.YNc(21,g,15,7,"div",4),t.qZA()),2&s&&(t.xp6(3),t.Oqu(c.lang.text.ContentViewer.ContentInfo),t.xp6(6),t.Oqu(c.lang.text.ContentInfo.WorkLogs),t.xp6(3),t.Oqu(c.lang.text.ContentInfo.LastPost),t.xp6(2),t.hij(" ",c.content_creator.user_id?c.content_creator.is_me?c.nakama.users.self.display_name:c.nakama.users[c.isOfficial][c.target][c.content_creator.user_id].display_name:c.content_creator.display_name,""),t.xp6(1),t.Q6J("ngIf",c.content_creator.various),t.xp6(3),t.Oqu(c.lang.text.ContentInfo.TimeAt),t.xp6(2),t.Oqu(c.content_creator.timeDisplay),t.xp6(1),t.Q6J("ngForOf",c.content_related_creator))},directives:[d.Gu,d.sr,d.wd,d.Sm,d.oU,d.cs,d.W2,d.rH,d.Q$,d.Ie,o.O5,o.sg],styles:[""]}),_})()},5087:(Y,U,l)=>{l.d(U,{r:()=>b});var t=l(655),A=l(5016),d=l(3805),k=l(549),o=l(9863),v=l(3996),e=l(1282),P=l(3496),M=l(5742),F=l(4433),C=l(3336),y=l(9912),g=l(9808);function I(s,c){if(1&s){const r=o.EpF();o.TgZ(0,"ion-item",9),o.NdJ("click",function(){return o.CHM(r),o.oxw(2).open_content_info()}),o.TgZ(1,"ion-label"),o._uU(2),o.qZA()()}if(2&s){const r=o.oxw(2);o.xp6(2),o.Oqu(r.lang.text.ContentViewer.ContentInfo)}}function _(s,c){if(1&s){const r=o.EpF();o.TgZ(0,"ion-content")(1,"ion-list")(2,"ion-item",9),o.NdJ("click",function(){return o.CHM(r),o.oxw().snapshot_modify()}),o.TgZ(3,"ion-label"),o._uU(4),o.qZA()(),o.YNc(5,I,3,1,"ion-item",10),o.TgZ(6,"ion-item",9),o.NdJ("click",function(){return o.CHM(r),o.oxw().ShareContent()}),o.TgZ(7,"ion-label"),o._uU(8),o.qZA()(),o.TgZ(9,"ion-item",9),o.NdJ("click",function(){return o.CHM(r),o.oxw().download_file()}),o.TgZ(10,"ion-label"),o._uU(11),o.qZA()()()()}if(2&s){const r=o.oxw();o.xp6(4),o.Oqu(r.lang.text.ContentViewer.Edit),o.xp6(1),o.Q6J("ngIf",r.FileInfo.content_creator),o.xp6(3),o.Oqu(r.lang.text.ContentViewer.ShareContent),o.xp6(3),o.Oqu(r.lang.text.ContentViewer.Download)}}let b=(()=>{class s{constructor(r,u,p,Z,n,i,a,m,f,w){this.modalCtrl=r,this.navParams=u,this.global=p,this.indexed=Z,this.lang=n,this.file=i,this.alertCtrl=a,this.loadingCtrl=m,this.p5toast=f,this.nakama=w,this.EventListenerAct=T=>{T.detail.register(120,O=>{})}}ngOnInit(){this.FileInfo=this.navParams.get("info")}ionViewDidEnter(){return(0,t.mG)(this,void 0,void 0,function*(){document.addEventListener("ionBackButton",this.EventListenerAct),yield this.global.CreateGodotIFrame("viewer",{local_url:"assets/data/godot/viewer.pck",title:"ViewerEx",path:this.navParams.get("path"),ext:this.FileInfo.file_ext,force_logo:!0,receive_image:(r,u,p)=>{this.modalCtrl.dismiss({base64:","+r,width:u,height:p})}},"create_thumbnail")})}snapshot_modify(){this.global.godot_window.modify_image()}download_file(){"DesktopPWA"==A.n$||"MobilePWA"==A.n$?this.indexed.DownloadFileFromUserPath(this.navParams.get("path"),this.FileInfo.type,this.FileInfo.filename):this.alertCtrl.create({header:this.lang.text.ContentViewer.Filename,inputs:[{name:"filename",placeholder:this.FileInfo.filename,type:"text"}],buttons:[{text:this.lang.text.ContentViewer.saveFile,handler:r=>(0,t.mG)(this,void 0,void 0,function*(){let u=yield this.loadingCtrl.create({message:this.lang.text.TodoDetail.WIP});u.present();let p=r.filename?`${r.filename.replace(/:|\?|\/|\\|<|>/g,"")}.${this.FileInfo.file_ext}`:this.FileInfo.filename,Z=yield this.indexed.loadBlobFromUserPath(this.navParams.get("path"),this.FileInfo.type);this.file.writeFile(this.file.externalDataDirectory,p,Z).then(n=>{u.dismiss(),this.p5toast.show({text:this.lang.text.ContentViewer.fileSaved})}).catch(n=>{12===(u.dismiss(),n.code)?(this.p5toast.show({text:this.lang.text.ContentViewer.AlreadyExist}),this.download_file()):console.log("\uc900\ube44\ub418\uc9c0 \uc54a\uc740 \uc624\ub958 \ubc18\ud658: ",n)})})}]}).then(r=>r.present())}ShareContent(){let r=this.nakama.rearrange_channels();for(let u=r.length-1;u>=0;u--)("missing"==r[u].status||"offline"==r[u].status)&&r.splice(u,1);r.length?this.modalCtrl.create({component:k.D,componentProps:{file:this.FileInfo,channels:r}}).then(u=>{u.onDidDismiss().then(p=>this.modalCtrl.dismiss()),u.present()}):this.p5toast.show({text:this.lang.text.ShareContentToOther.NoChannelToShare})}open_content_info(){this.modalCtrl.create({component:d.z,componentProps:{info:this.FileInfo,isOfficial:this.navParams.get("isOfficial"),target:this.navParams.get("target")}}).then(r=>r.present())}ionViewWillLeave(){document.removeEventListener("ionBackButton",this.EventListenerAct),this.global.godot_window.filename=this.FileInfo.filename,this.global.godot_window.create_thumbnail(this.FileInfo)}}return s.\u0275fac=function(r){return new(r||s)(o.Y36(v.IN),o.Y36(v.X1),o.Y36(e.A),o.Y36(P.H),o.Y36(M.b),o.Y36(F.$),o.Y36(v.Br),o.Y36(v.HT),o.Y36(C.F),o.Y36(y.a))},s.\u0275cmp=o.Xpm({type:s,selectors:[["app-godot-viewer"]],decls:20,vars:2,consts:[["slot","start",3,"click"],["defaultHref",""],[1,"main_table",2,"width","100%","height","100%","margin","0"],[2,"height","0"],["text-wrap",""],["id","menu_trigger"],["slot","start","name","ellipsis-vertical",2,"transform","translateX(25%)"],["trigger","menu_trigger","dismissOnSelect",""],["id","viewer",1,"full_screen",2,"display","flex"],["button","",3,"click"],["button","",3,"click",4,"ngIf"]],template:function(r,u){1&r&&(o.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),o._uU(3),o.qZA(),o.TgZ(4,"ion-buttons",0),o.NdJ("click",function(){return u.modalCtrl.dismiss()}),o._UZ(5,"ion-back-button",1),o.qZA()()(),o.TgZ(6,"ion-content")(7,"table",2)(8,"tr",3)(9,"td")(10,"ion-list-header")(11,"ion-label",4),o._uU(12),o.qZA(),o.TgZ(13,"ion-button",5),o._UZ(14,"ion-icon",6),o.qZA(),o.TgZ(15,"ion-popover",7),o.YNc(16,_,12,4,"ng-template"),o.qZA()()()(),o.TgZ(17,"tr")(18,"td"),o._UZ(19,"div",8),o.qZA()()()()),2&r&&(o.xp6(3),o.Oqu(u.lang.text.ContentViewer.Title),o.xp6(9),o.Oqu(u.FileInfo.filename))},directives:[v.Gu,v.sr,v.wd,v.Sm,v.oU,v.cs,v.W2,v.yh,v.Q$,v.YG,v.gu,v.d8,v.q_,v.Ie,g.O5],styles:[""]}),s})()},774:(Y,U,l)=>{l.d(U,{B:()=>u});var t=l(655),A=l(5016),d=l(6505),o=l(549),v=l(3805),e=l(9863),P=l(3996),M=l(3496),F=l(5742),C=l(4433),y=l(3336),g=l(6690),I=l(1282),_=l(9912),b=l(9808);function s(p,Z){if(1&p){const n=e.EpF();e.TgZ(0,"ion-item",13),e.NdJ("click",function(){return e.CHM(n),e.oxw(2).modify_image()}),e.TgZ(1,"ion-label"),e._uU(2),e.qZA()()}if(2&p){const n=e.oxw(2);e.xp6(2),e.Oqu(n.lang.text.ContentViewer.Edit)}}function c(p,Z){if(1&p){const n=e.EpF();e.TgZ(0,"ion-item",13),e.NdJ("click",function(){return e.CHM(n),e.oxw(2).open_content_info()}),e.TgZ(1,"ion-label"),e._uU(2),e.qZA()()}if(2&p){const n=e.oxw(2);e.xp6(2),e.Oqu(n.lang.text.ContentViewer.ContentInfo)}}function r(p,Z){if(1&p){const n=e.EpF();e.TgZ(0,"ion-content")(1,"ion-list"),e.YNc(2,s,3,1,"ion-item",12),e.YNc(3,c,3,1,"ion-item",12),e.TgZ(4,"ion-item",13),e.NdJ("click",function(){return e.CHM(n),e.oxw().ShareContent()}),e.TgZ(5,"ion-label"),e._uU(6),e.qZA()(),e.TgZ(7,"ion-item",13),e.NdJ("click",function(){return e.CHM(n),e.oxw().download_file()}),e.TgZ(8,"ion-label"),e._uU(9),e.qZA()()()()}if(2&p){const n=e.oxw();e.xp6(2),e.Q6J("ngIf","image"==n.FileInfo.viewer&&!n.HasNoEditButton),e.xp6(1),e.Q6J("ngIf",n.FileInfo.content_creator),e.xp6(3),e.Oqu(n.lang.text.ContentViewer.ShareContent),e.xp6(3),e.Oqu(n.lang.text.ContentViewer.Download)}}let u=(()=>{class p{constructor(n,i,a,m,f,w,T,O,L,R,V){this.modalCtrl=n,this.navParams=i,this.indexed=a,this.lang=m,this.file=f,this.p5toast=w,this.alertCtrl=T,this.loadingCtrl=O,this.fileOpener=L,this.global=R,this.nakama=V,this.image_info={}}ngOnInit(){return(0,t.mG)(this,void 0,void 0,function*(){this.FileInfo=this.navParams.get("info"),this.ContentBox=document.getElementById("ContentBox"),this.FileHeader=document.getElementById("FileHeader"),this.HasNoEditButton=this.navParams.get("no_edit")||!1,this.blob=yield this.indexed.loadBlobFromUserPath(this.navParams.get("path"),this.FileInfo.type),this.FileURL=URL.createObjectURL(this.blob)})}ionViewDidEnter(){return(0,t.mG)(this,void 0,void 0,function*(){let n=document.getElementById("p5canvas");switch(this.FileInfo.viewer){case"image":this.p5canvas=new d(i=>{let a;i.setup=()=>(0,t.mG)(this,void 0,void 0,function*(){n.style.maxWidth="100%",n.style.overflow="hidden",this.ContentBox.style.overflow="hidden",i.noCanvas();let h=document.createElement("img");h.hidden=!0,h.src=this.FileURL,h.onload=()=>{n.style.backgroundImage=`url(${this.FileURL})`,n.style.backgroundRepeat="no-repeat",n.style.pointerEvents="none",this.image_info.width=h.naturalWidth,this.image_info.height=h.naturalHeight,f=i.createVector(h.naturalWidth,h.naturalHeight),m(),h.remove()},("Android"==A.n$||"iOS"==A.n$)&&(a=document.createElement("iframe"),a.setAttribute("src",this.FileURL),a.setAttribute("frameborder","0"),a.setAttribute("class","full_screen"),a.setAttribute("style","position: relative; pointer-events: all"),a.hidden=!0,n.appendChild(a)),i.noLoop()});let m=()=>{if(this.image_info.width>this.image_info.height)n.style.backgroundSize=`${n.clientWidth}px`,n.style.backgroundPositionX="0px",n.style.backgroundPositionY=n.clientHeight/2-f.y*(n.clientWidth/f.x)/2+"px";else{let h=this.image_info.width*n.clientHeight/this.image_info.height;n.style.backgroundSize=`${h}px`,n.style.backgroundPositionX=(n.clientWidth-h)/2+"px",n.style.backgroundPositionY="0px"}};i.windowResized=()=>{setTimeout(()=>{m()},50)};let f,w=i.createVector(),T=i.createVector(),O=i.createVector(),L=1,R=()=>{n.style.backgroundPositionX=`${w.x+O.x}px`,n.style.backgroundPositionY=`${w.y+O.y}px`},V=(h,W)=>{let x=L,D=L*W,B=Number(n.style.backgroundPositionX.split("px")[0]),S=Number(n.style.backgroundPositionY.split("px")[0]),H=(x-D)*i.map(h.x,B,B+x,0,1),K=(x-D)/f.x*f.y*i.map(h.y,S,S+x/f.x*f.y,0,1);n.style.backgroundPositionX=`${B+H}px`,n.style.backgroundPositionY=`${S+K}px`,n.style.backgroundSize=`${D}px`};i.mousePressed=()=>{i.mouseButton==i.CENTER&&m(),"DesktopPWA"==A.n$&&(w=i.createVector(Number(n.style.backgroundPositionX.split("px")[0]),Number(n.style.backgroundPositionY.split("px")[0])),T=i.createVector(i.mouseX,i.mouseY))},i.mouseWheel=h=>{L=Number(n.style.backgroundSize.split("px")[0]),V(i.createVector(n.clientWidth/2,n.clientHeight/2),1-h.delta/1e3)},i.mouseDragged=()=>{"DesktopPWA"==A.n$&&(O=i.createVector(i.mouseX,i.mouseY),O.sub(T),R())};let q,E={},N=!1;i.touchStarted=h=>{for(let x=0,D=h.changedTouches.length;x<D;x++)E[h.changedTouches[x].identifier]=i.createVector(h.changedTouches[x].clientX,h.changedTouches[x].clientY);switch(Object.keys(E).length){case 1:w=i.createVector(Number(n.style.backgroundPositionX.split("px")[0]),Number(n.style.backgroundPositionY.split("px")[0])),T=E[h.changedTouches[0].identifier].copy();break;case 2:w=i.createVector(Number(n.style.backgroundPositionX.split("px")[0]),Number(n.style.backgroundPositionY.split("px")[0]));let x=E[0].copy();q=x.dist(E[1]),T=x.add(E[1]).div(2).copy(),L=Number(n.style.backgroundSize.split("px")[0]),R();break;default:N=!0,m()}},i.touchMoved=h=>{if(!N){for(let x=0,D=h.changedTouches.length;x<D;x++)E[h.changedTouches[x].identifier]=i.createVector(h.changedTouches[x].clientX,h.changedTouches[x].clientY);switch(Object.keys(E).length){case 1:O=E[h.changedTouches[0].identifier].copy(),O.sub(T),R();break;case 2:let x=E[0].copy(),D=x.dist(E[1]);O=x.add(E[1]).div(2).copy();let B=O.copy();O.sub(T),R(),V(B,D/q)}}},i.touchEnded=h=>{if("changedTouches"in h){for(let x=0,D=h.changedTouches.length;x<D;x++)delete E[h.changedTouches[x].identifier];switch(Object.keys(E).length){case 1:w=i.createVector(Number(n.style.backgroundPositionX.split("px")[0]),Number(n.style.backgroundPositionY.split("px")[0])),T=E[Object.keys(E)[0]].copy();break;case 0:N=!1}}}});break;case"audio":this.p5canvas=new d(i=>{var a;i.setup=()=>{i.noCanvas(),i.noLoop(),a=i.createAudio([this.FileURL],()=>{n.appendChild(a.elt),a.elt.hidden=!0,setTimeout(()=>{m(),a.elt.hidden=!1},50),a.showControls(),a.play()})};let m=()=>{let f=this.ContentBox.offsetWidth;a.elt.setAttribute("style","position: relative; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%);"),a.size(f,25)};i.windowResized=()=>{setTimeout(()=>{m()},50)}});break;case"video":this.p5canvas=new d(i=>{var a;i.setup=()=>{i.noCanvas(),i.noLoop(),a=i.createVideo([this.FileURL],()=>{n.appendChild(a.elt),a.elt.hidden=!0,setTimeout(()=>{m(),a.elt.hidden=!1},50),a.showControls(),a.play()}),i.VideoMedia=a};let m=()=>{let f=this.ContentBox.offsetWidth,w=this.ContentBox.offsetHeight-this.FileHeader.offsetHeight,T=a.width,O=a.height;a.elt.setAttribute("style","position: relative; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%);"),T<O?(O=w,T=T/a.height*O):(T=f,O=O/a.width*T||w/2),a.size(T,O)};i.windowResized=()=>{setTimeout(()=>{m()},50)}});break;case"text":this.p5canvas=new d(i=>{i.setup=()=>{i.noCanvas(),i.noLoop(),i.loadStrings(this.FileURL,a=>{let m=document.createElement("textarea");m.disabled=!0,m.className="infobox",m.setAttribute("style","height: 100%; display: block;"),m.textContent=a.join("\n"),n.appendChild(m)},a=>{console.error("\uc5f4\ub78c\ud560 \uc218 \uc5c6\ub294 \ud30c\uc77c: ",a),n.textContent="\uc5f4\ub78c\ud560 \uc218 \uc5c6\ub294 \ud30c\uc77c\uc785\ub2c8\ub2e4.",this.FileInfo.else=!0})}});break;case"disabled":try{yield this.file.writeFile(this.file.externalDataDirectory,`viewer_tmp.${this.FileInfo.file_ext}`,this.blob),this.fileOpener.open(this.file.externalDataDirectory+`viewer_tmp.${this.FileInfo.file_ext}`,this.FileInfo.type||`application/${this.FileInfo.file_ext}`)}catch(i){console.log("open file failed: ",i),this.p5toast.show({text:`${this.lang.text.ChatRoom.cannot_open_file}: ${i.message}`})}}})}modify_image(){this.modalCtrl.dismiss(this.image_info)}download_file(){"DesktopPWA"==A.n$||"MobilePWA"==A.n$?this.indexed.DownloadFileFromUserPath(this.navParams.get("path"),this.FileInfo.type,this.FileInfo.filename):this.alertCtrl.create({header:this.lang.text.ContentViewer.Filename,inputs:[{name:"filename",placeholder:this.FileInfo.filename,type:"text"}],buttons:[{text:this.lang.text.ContentViewer.saveFile,handler:n=>(0,t.mG)(this,void 0,void 0,function*(){let i=yield this.loadingCtrl.create({message:this.lang.text.TodoDetail.WIP});i.present();let a=n.filename?`${n.filename.replace(/:|\?|\/|\\|<|>/g,"")}.${this.FileInfo.file_ext}`:this.FileInfo.filename,m=yield this.indexed.loadBlobFromUserPath(this.navParams.get("path"),this.FileInfo.type);this.file.writeFile(this.file.externalDataDirectory,a,m).then(f=>{i.dismiss(),this.p5toast.show({text:this.lang.text.ContentViewer.fileSaved})}).catch(f=>{12===(i.dismiss(),f.code)?(this.p5toast.show({text:this.lang.text.ContentViewer.AlreadyExist}),this.download_file()):console.log("\uc900\ube44\ub418\uc9c0 \uc54a\uc740 \uc624\ub958 \ubc18\ud658: ",f)})})}]}).then(n=>n.present())}ShareContent(){let n=this.nakama.rearrange_channels();for(let i=n.length-1;i>=0;i--)("missing"==n[i].status||"offline"==n[i].status)&&n.splice(i,1);n.length?this.modalCtrl.create({component:o.D,componentProps:{file:this.FileInfo,channels:n}}).then(i=>{i.onDidDismiss().then(a=>this.modalCtrl.dismiss()),i.present()}):this.p5toast.show({text:this.lang.text.ShareContentToOther.NoChannelToShare})}open_content_info(){this.modalCtrl.create({component:v.z,componentProps:{info:this.FileInfo,isOfficial:this.navParams.get("isOfficial"),target:this.navParams.get("target")}}).then(n=>n.present())}ionViewWillLeave(){return(0,t.mG)(this,void 0,void 0,function*(){if("video"==this.FileInfo.viewer)try{let a,m,i=this.p5canvas.VideoMedia.size();i.width>i.height?(a=192,m=i.height/i.width*192):(a=i.width/i.height*192,m=192),this.p5canvas.createCanvas(a,m),this.p5canvas.image(this.p5canvas.VideoMedia,0,0,a,m),this.p5canvas.fill(255,128),this.p5canvas.rect(0,0,a,m),this.p5canvas.textWrap(this.p5canvas.CHAR),this.p5canvas.textSize(16);let f=m/16;this.p5canvas.push(),this.p5canvas.translate(f/6,f/6),this.p5canvas.fill(0),this.p5canvas.text(this.FileInfo.filename,f,f,a-2*f,m-2*f),this.p5canvas.filter(this.p5canvas.BLUR,3),this.p5canvas.pop(),this.p5canvas.fill(255),this.p5canvas.text(this.FileInfo.filename,f,f,a-2*f,m-2*f),this.p5canvas.saveFrames("","png",1,1,w=>(0,t.mG)(this,void 0,void 0,function*(){try{yield this.indexed.saveBase64ToUserPath(w[0].imageData.replace(/"|=|\\/g,""),`${this.FileInfo.path}_thumbnail.png`),this.global.modulate_thumbnail(this.FileInfo,"")}catch(T){}}))}catch(i){console.log("\uc791\uc5c5\uc911 \uc624\ub958\ubcf4\uae30: ",i)}this.p5canvas&&this.p5canvas.remove(),this.FileURL&&URL.revokeObjectURL(this.FileURL),this.file.checkFile(this.file.externalDataDirectory,`viewer_tmp.${this.FileInfo.file_ext}`)&&this.file.removeFile(this.file.externalDataDirectory,`viewer_tmp.${this.FileInfo.file_ext}`)})}}return p.\u0275fac=function(n){return new(n||p)(e.Y36(P.IN),e.Y36(P.X1),e.Y36(M.H),e.Y36(F.b),e.Y36(C.$),e.Y36(y.F),e.Y36(P.Br),e.Y36(P.HT),e.Y36(g.u),e.Y36(I.A),e.Y36(_.a))},p.\u0275cmp=e.Xpm({type:p,selectors:[["app-ionic-viewer"]],decls:20,vars:2,consts:[["id","Toolbar"],["slot","start",3,"click"],["defaultHref",""],["id","ContentBox"],[1,"main_table_elt"],[2,"height","0"],["id","FileHeader"],["text-wrap",""],["id","menu_trigger"],["slot","start","name","ellipsis-vertical",2,"transform","translateX(25%)"],["trigger","menu_trigger","dismissOnSelect",""],["id","p5canvas",1,"full_screen",2,"overflow-y","scroll"],["button","",3,"click",4,"ngIf"],["button","",3,"click"]],template:function(n,i){1&n&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),e._uU(3),e.qZA(),e.TgZ(4,"ion-buttons",1),e.NdJ("click",function(){return i.modalCtrl.dismiss()}),e._UZ(5,"ion-back-button",2),e.qZA()()(),e.TgZ(6,"ion-content",3)(7,"table",4)(8,"tr",5)(9,"td")(10,"ion-list-header",6)(11,"ion-label",7),e._uU(12),e.qZA(),e.TgZ(13,"ion-button",8),e._UZ(14,"ion-icon",9),e.qZA(),e.TgZ(15,"ion-popover",10),e.YNc(16,r,10,4,"ng-template"),e.qZA()()()(),e.TgZ(17,"tr")(18,"td"),e._UZ(19,"div",11),e.qZA()()()()),2&n&&(e.xp6(3),e.Oqu(i.lang.text.ContentViewer.Title),e.xp6(9),e.Oqu(i.FileInfo.filename))},directives:[P.Gu,P.sr,P.wd,P.Sm,P.oU,P.cs,P.W2,P.yh,P.Q$,P.YG,P.gu,P.d8,P.q_,b.O5,P.Ie],styles:[".main_table_elt[_ngcontent-%COMP%]{width:100%;height:100%;border:0;margin:0}"]}),p})()},549:(Y,U,l)=>{l.d(U,{D:()=>F});var t=l(9863),A=l(5742),d=l(3996),k=l(4606),o=l(9912),v=l(9808);function e(C,y){1&C&&t._UZ(0,"div",11)}function P(C,y){if(1&C&&t._UZ(0,"img",12),2&C){const g=t.oxw().$implicit;t.Akn("online"==g.status||3==g.redirect.type&&"pending"==g.status?"filter: grayscale(0) contrast(1)":"filter: grayscale(.9) contrast(1.4)"),t.Q6J("src",g.info.img,t.LSH)}}function M(C,y){if(1&C){const g=t.EpF();t.TgZ(0,"ion-item",3),t.NdJ("click",function(){const b=t.CHM(g).$implicit;return t.oxw().go_to_chatroom(b)}),t.TgZ(1,"div",4),t.YNc(2,e,1,0,"div",5),t.qZA(),t.TgZ(3,"div",6),t.YNc(4,P,1,3,"img",7),t.qZA(),t.TgZ(5,"ion-label")(6,"div",8)(7,"table")(8,"tr")(9,"td"),t._uU(10),t.qZA(),t.TgZ(11,"td",9),t._uU(12),t.qZA()()()(),t.TgZ(13,"div",10),t._uU(14),t.qZA()()()}if(2&C){const g=y.$implicit,I=t.oxw();t.xp6(1),t.Akn("background-color: "+I.statusBar.colors[g.status||"offline"]),t.xp6(1),t.Q6J("ngIf",g.is_new),t.xp6(2),t.Q6J("ngIf",g.info),t.xp6(6),t.hij(" ",g.info?g.info.name||g.info.display_name||I.lang.text.ChatRoom.noname_chatroom:g.title||I.lang.text.ChatRoom.noname_chatroom," "),t.xp6(2),t.hij(" ","("+g.server.target+")"," "),t.xp6(2),t.hij(" ",g.last_comment||g.noti||I.lang.text.Subscribes.noMessageHistory," ")}}let F=(()=>{class C{constructor(g,I,_,b,s){this.lang=g,this.navParams=I,this.modalCtrl=_,this.statusBar=b,this.nakama=s}ngOnInit(){this.channels=this.navParams.get("channels")}go_to_chatroom(g){this.nakama.go_to_chatroom_without_admob_act(g,this.navParams.get("file")),this.modalCtrl.dismiss()}}return C.\u0275fac=function(g){return new(g||C)(t.Y36(A.b),t.Y36(d.X1),t.Y36(d.IN),t.Y36(k.g),t.Y36(o.a))},C.\u0275cmp=t.Xpm({type:C,selectors:[["app-share-content-to-other"]],decls:11,vars:3,consts:[["slot","start",3,"click"],["defaultHref",""],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"],[1,"additional_form","status_bar_double"],["class","new_circle",4,"ngIf"],[1,"additional_form","bg_img_form"],["class","profile_img",3,"style","src",4,"ngIf"],[1,"form_margin","header"],[1,"server_target"],[1,"form_margin","content"],[1,"new_circle"],[1,"profile_img",3,"src"]],template:function(g,I){1&g&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t._uU(3),t.qZA(),t.TgZ(4,"ion-buttons",0),t.NdJ("click",function(){return I.modalCtrl.dismiss()}),t._UZ(5,"ion-back-button",1),t.qZA()()(),t.TgZ(6,"ion-content")(7,"ion-item-divider")(8,"ion-label"),t._uU(9),t.qZA()(),t.YNc(10,M,15,7,"ion-item",2),t.qZA()),2&g&&(t.xp6(3),t.Oqu(I.lang.text.ShareContentToOther.Title),t.xp6(6),t.Oqu(I.lang.text.ShareContentToOther.AvailableChannels),t.xp6(1),t.Q6J("ngForOf",I.channels))},directives:[d.Gu,d.sr,d.wd,d.Sm,d.oU,d.cs,d.W2,d.rH,d.Q$,v.sg,d.Ie,v.O5],styles:[".server_target[_ngcontent-%COMP%]{color:#888;padding-left:4px}.content[_ngcontent-%COMP%]{color:#888;height:24px;display:table-cell;vertical-align:middle;padding:0 16px}"]}),C})()}}]);