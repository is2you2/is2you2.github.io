"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9471],{9471:(b,d,a)=>{a.r(d),a.d(d,{AdminToolsPageModule:()=>y});var u=a(9808),c=a(4182),r=a(3996),g=a(9705),h=a(655),m=a(3260),e=a(9863),p=a(5742),f=a(9912),T=a(3336),x=a(4606),v=a(4299);const A=["UserSel"];function Z(s,l){if(1&s){const i=e.EpF();e.TgZ(0,"ion-item",20),e.NdJ("click",function(){const o=e.CHM(i).index;return e.oxw(2).select_server(o)}),e.TgZ(1,"ion-label"),e._uU(2),e.qZA()()}if(2&s){const i=l.$implicit;e.xp6(2),e.Oqu(i.name)}}function P(s,l){if(1&s){const i=e.EpF();e.TgZ(0,"ion-accordion-group",13,14),e.NdJ("click",function(){return e.CHM(i),e.oxw().isExpanded=!0}),e.TgZ(2,"ion-accordion",15)(3,"ion-item",16)(4,"ion-label"),e._uU(5),e.qZA(),e.TgZ(6,"ion-label",17),e._uU(7),e.qZA()(),e.TgZ(8,"ion-list",18),e.YNc(9,Z,3,1,"ion-item",19),e.qZA()()()}if(2&s){const i=e.oxw();e.Q6J("value",i.isExpanded),e.xp6(5),e.Oqu(i.lang.text.AddGroup.SelectServer),e.xp6(2),e.Oqu(i.servers[i.index].name),e.xp6(2),e.Q6J("ngForOf",i.servers)}}function k(s,l){if(1&s&&e._UZ(0,"img",29),2&s){const i=e.oxw().$implicit,t=e.oxw();e.Q6J("src",t.all_users[i].img,e.LSH)}}function U(s,l){if(1&s){const i=e.EpF();e.TgZ(0,"div")(1,"ion-accordion",21)(2,"ion-item",22)(3,"div",23),e.YNc(4,k,1,1,"img",24),e.qZA(),e._UZ(5,"div",25),e.TgZ(6,"ion-label",26),e._uU(7),e.qZA()(),e.TgZ(8,"ion-list",18)(9,"ion-item",8),e.NdJ("click",function(){const o=e.CHM(i).$implicit,_=e.oxw();return _.copy_id(_.all_users[o].id)}),e.TgZ(10,"ion-label",27),e._uU(11),e.qZA()(),e.TgZ(12,"ion-item",20),e.NdJ("click",function(){const o=e.CHM(i).$implicit,_=e.oxw();return _.start_private_chat(_.all_users[o])}),e.TgZ(13,"ion-label"),e._uU(14),e.qZA()(),e.TgZ(15,"ion-item",20),e.NdJ("click",function(){const o=e.CHM(i).$implicit,_=e.oxw();return _.remove_user(_.all_users[o])}),e.TgZ(16,"ion-label",28),e._uU(17),e.qZA()()()()()}if(2&s){const i=l.$implicit,t=e.oxw();e.xp6(1),e.Q6J("value",t.all_users[i].username),e.xp6(3),e.Q6J("ngIf",t.all_users[i].img),e.xp6(1),e.Akn("background-color: "+t.statusBar.colors[void 0===t.all_users[i].online?"pending":t.all_users[i].online?"online":"offline"]),e.xp6(2),e.Oqu(t.all_users[i].display_name||t.lang.text.Profile.noname_user),e.xp6(4),e.Oqu(t.all_users[i].id),e.xp6(3),e.Oqu(t.lang.text.OtherProfile.privacy_chat),e.xp6(3),e.Oqu(t.lang.text.AdminTools.ForceLeave)}}const C=[{path:"",component:(()=>{class s{constructor(i,t,n,o,_,I){this.lang=i,this.nakama=t,this.p5toast=n,this.alertCtrl=o,this.statusBar=_,this.mClipboard=I,this.servers=[],this.index=0,this.isExpanded=!0,this.notification={uri:"",msg:""},this.is_sending=!1,this.all_users=[],this.current_user_page=1,this.all_user_page=1,this.LIST_PAGE_SIZE=5,this.current_size=[]}select_server(i){this.index=i,this.isExpanded=!1,this.refresh_all_user()}ngOnInit(){this.servers=this.nakama.get_all_server_info(!0,!0);for(let i=this.servers.length-1;i>=0;i--)this.servers[i].is_admin||this.servers.splice(i,1);this.refresh_all_user()}send_noti_to_server(){return(0,h.mG)(this,void 0,void 0,function*(){if(!this.notification.msg&&!this.notification.uri)return void this.p5toast.show({text:this.lang.text.AdminTools.NoNotiMsg});this.is_sending=!0;let i=this.servers[this.index].isOfficial,t=this.servers[this.index].target;this.notification.msg=encodeURIComponent(this.notification.msg),this.notification.uri=encodeURIComponent(this.notification.uri);try{yield this.nakama.servers[i][t].client.rpc(this.nakama.servers[i][t].session,"send_noti_all_fn",this.notification)}catch(n){}this.notification.msg="",this.notification.uri="",this.is_sending=!1})}refresh_all_user(){this.all_users.length=0,this.current_size.length=0;let i=this.servers[this.index].isOfficial,t=this.servers[this.index].target;this.nakama.servers[i][t].client.rpc(this.nakama.servers[i][t].session,"query_all_users",{}).then(n=>{this.all_users=n.payload;for(let o=0,_=this.all_users.length;o<_;o++)this.nakama.save_other_user(this.all_users[o],i,t),this.all_users[o]=this.nakama.load_other_user(this.all_users[o].user_id||this.all_users[o].id,i,t);this.all_user_page=Math.ceil(this.all_users.length/this.LIST_PAGE_SIZE),this.current_user_page=0,this.change_user_list_page(1)}).catch(n=>{console.error("\uc0ac\uc6a9\uc790 \ub9ac\uc2a4\ud2b8 \ub3cc\ub824\ubc1b\uae30 \uc624\ub958: ",n)})}change_user_list_page(i){switch(i){case 1:if(this.current_user_page<this.all_user_page){this.current_user_page+=1,this.current_size=Array(this.current_user_page==this.all_user_page?this.all_users.length%this.LIST_PAGE_SIZE==0?this.LIST_PAGE_SIZE:this.all_users.length%this.LIST_PAGE_SIZE:this.LIST_PAGE_SIZE);for(let t=0,n=this.current_size.length;t<n;t++)this.current_size[t]=(this.current_user_page-1)*this.LIST_PAGE_SIZE+t}break;case-1:if(this.current_user_page-1>0){this.current_user_page-=1,this.current_size=Array(this.LIST_PAGE_SIZE);for(let t=0,n=this.current_size.length;t<n;t++)this.current_size[t]=(this.current_user_page-1)*this.LIST_PAGE_SIZE+t}}this.UserSel.value=void 0}start_private_chat(i){this.nakama.join_chat_with_modulation(i.user_id||i.id,2,this.servers[this.index].isOfficial,this.servers[this.index].target,o=>{o&&this.nakama.go_to_chatroom_without_admob_act(o)},!0)}copy_id(i){this.mClipboard.copy(i).catch(t=>m.Z.write(i))}remove_user(i){let t=this.servers[this.index].isOfficial,n=this.servers[this.index].target;this.alertCtrl.create({header:i.display_name,message:this.lang.text.AdminTools.ForceLeave,buttons:[{text:this.lang.text.AdminTools.ApplyLeave,cssClass:"danger",handler:()=>(0,h.mG)(this,void 0,void 0,function*(){try{yield this.nakama.servers[t][n].client.rpc(this.nakama.servers[t][n].session,"remove_account_fn",{user_id:i.user_id||i.id}),this.p5toast.show({text:`${this.lang.text.AdminTools.UserLeaved}: ${i.display_name}`}),this.refresh_all_user()}catch(o){this.p5toast.show({text:`${this.lang.text.AdminTools.UserLeavedFailed}: ${o.statusText}`})}})}]}).then(o=>o.present())}}return s.\u0275fac=function(i){return new(i||s)(e.Y36(p.b),e.Y36(f.a),e.Y36(T.F),e.Y36(r.Br),e.Y36(x.g),e.Y36(v.T))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-admin-tools"]],viewQuery:function(i,t){if(1&i&&e.Gf(A,5),2&i){let n;e.iGM(n=e.CRH())&&(t.UserSel=n.first)}},decls:37,vars:14,consts:[["slot","start"],["defaultHref","portal/settings"],["value","colors","expand","inset",3,"value","click",4,"ngIf"],[1,"ion-text-end",3,"ngModel","placeholder","ngModelChange"],[1,"infobox","content_size",3,"ngModel","placeholder","ngModelChange"],["button","",3,"disabled"],[1,"ion-text-center",3,"click"],["slot","end",2,"margin-right","8px"],[3,"click"],["slot","start","name","arrow-back-circle-outline",1,"icon_style"],["slot","start","name","arrow-forward-circle-outline",1,"icon_style"],["UserSel",""],[4,"ngFor","ngForOf"],["value","colors","expand","inset",3,"value","click"],["accordionGroup",""],["value","colors"],["slot","header"],[1,"ion-text-right"],["slot","content"],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"],[3,"value"],["button","","slot","header"],[1,"additional_form","bg_img_form"],["class","profile_img",3,"src",4,"ngIf"],[1,"additional_form","status_bar_single"],[1,"form_margin"],["color","medium","text-wrap","",1,"ion-text-center"],["color","danger"],[1,"profile_img",3,"src"]],template:function(i,t){1&i&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e._uU(3),e.qZA(),e.TgZ(4,"ion-buttons",0),e._UZ(5,"ion-back-button",1),e.qZA()()(),e.TgZ(6,"ion-content"),e.YNc(7,P,10,4,"ion-accordion-group",2),e.TgZ(8,"ion-item-divider")(9,"ion-label"),e._uU(10),e.qZA()(),e.TgZ(11,"ion-item")(12,"ion-label"),e._uU(13),e.qZA(),e.TgZ(14,"ion-input",3),e.NdJ("ngModelChange",function(o){return t.notification.uri=o}),e.qZA()(),e.TgZ(15,"textarea",4),e.NdJ("ngModelChange",function(o){return t.notification.msg=o}),e.qZA(),e.TgZ(16,"ion-item",5)(17,"ion-label",6),e.NdJ("click",function(){return t.send_noti_to_server()}),e._uU(18),e.qZA()(),e.TgZ(19,"ion-item-divider")(20,"ion-label"),e._uU(21),e.qZA(),e.TgZ(22,"table",7)(23,"tr")(24,"td",8),e.NdJ("click",function(){return t.change_user_list_page(-1)}),e._UZ(25,"ion-icon",9),e.qZA(),e.TgZ(26,"td"),e._uU(27),e.qZA(),e.TgZ(28,"td"),e._uU(29,"/"),e.qZA(),e.TgZ(30,"td"),e._uU(31),e.qZA(),e.TgZ(32,"td",8),e.NdJ("click",function(){return t.change_user_list_page(1)}),e._UZ(33,"ion-icon",10),e.qZA()()()(),e.TgZ(34,"ion-accordion-group",null,11),e.YNc(36,U,18,8,"div",12),e.qZA()()),2&i&&(e.xp6(3),e.Oqu(t.lang.text.Settings.admin_tools),e.xp6(4),e.Q6J("ngIf",t.servers.length),e.xp6(3),e.Oqu(t.lang.text.AdminTools.GlobalNoti),e.xp6(3),e.Oqu(t.lang.text.AdminTools.ImageURL),e.xp6(1),e.Q6J("ngModel",t.notification.uri)("placeholder",t.lang.text.AdminTools.EnterURI),e.xp6(1),e.Q6J("ngModel",t.notification.msg)("placeholder",t.lang.text.AdminTools.NoNotiMsg),e.xp6(1),e.Q6J("disabled",t.is_sending),e.xp6(2),e.Oqu(t.lang.text.AdminTools.Send),e.xp6(3),e.Oqu(t.lang.text.AdminTools.UserList),e.xp6(6),e.Oqu(t.current_user_page),e.xp6(4),e.Oqu(t.all_user_page),e.xp6(5),e.Q6J("ngForOf",t.current_size))},directives:[r.Gu,r.sr,r.wd,r.Sm,r.oU,r.cs,r.W2,u.O5,r.eh,r.We,r.Ie,r.Q$,r.q_,u.sg,r.rH,r.pK,r.j9,c.JJ,c.On,c.Fj,r.gu],styles:[".icon_style[_ngcontent-%COMP%]{width:22px;height:22px;transform:translateY(2px);margin-left:4px;margin-right:4px}"]}),s})()}];let S=(()=>{class s{}return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[[g.Bz.forChild(C)],g.Bz]}),s})(),y=(()=>{class s{}return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[[u.ez,c.u5,r.Pc,S]]}),s})()}}]);