"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7048],{5404:(G,x,_)=>{_.d(x,{Gq:()=>F});var F=function(D){return D.UTF8="utf8",D.ASCII="ascii",D.UTF16="utf16",D}(F||{})},7048:(G,x,_)=>{_.d(x,{w:()=>_e});var m=_(1528),F=_(5193),C=_(8744),v=_(6400);_(5404);const U=(0,v.C_)("Filesystem",{web:()=>_.e(7688).then(_.bind(_,7688)).then(o=>new o.FilesystemWeb)});var E=_(9352),T=_(1052),e=_(4496),f=_(5624),I=_(9240),R=_(4668),O=_(4500),k=_(5020),P=_(3824),S=_(4476),w=_(544),$=_(6819),L=_(7136),b=_(1368);const A=["FileSel"];function B(o,d){if(1&o){const s=e.KQA();e.I0R(0,"ion-icon",9),e.qCj("click",function(){e.usT(s);const i=e.GaO();return e.CGJ(i.toggle_thumbnail())}),e.C$Y()}}function Y(o,d){if(1&o){const s=e.KQA();e.I0R(0,"ion-icon",10),e.qCj("click",function(){e.usT(s);const i=e.GaO();return e.CGJ(i.toggle_thumbnail())}),e.C$Y()}}function j(o,d){if(1&o){const s=e.KQA();e.I0R(0,"div")(1,"ion-item",19),e.qCj("click",function(){e.usT(s);const i=e.GaO(2);return e.CGJ(i.SelectImportFolder())}),e.wR5(2,"ion-icon",20),e.I0R(3,"ion-label"),e.OEk(4),e.C$Y()(),e.I0R(5,"input",21),e.qCj("change",function(i){e.usT(s);const n=e.GaO(2);return e.CGJ(n.inputImageSelected(i))}),e.C$Y()()}if(2&o){const s=e.GaO(2);e.yG2(4),e.oRS(" ",s.lang.text.UserFsDir.ImportFolder," ")}}function N(o,d){if(1&o){const s=e.KQA();e.I0R(0,"ion-button",14),e.qCj("click",function(){e.usT(s);const i=e.GaO(2);return e.CGJ(i.ExportDirectoryRecursive())}),e.OEk(1),e.C$Y()}if(2&o){const s=e.GaO(2);e.yG2(),e.oRS(" ",s.lang.text.UserFsDir.ExportDir," ")}}function M(o,d){if(1&o){const s=e.KQA();e.I0R(0,"ion-item",19),e.qCj("click",function(){e.usT(s);const i=e.GaO(2);return e.CGJ(i.MoveToUpDir())}),e.wR5(1,"ion-icon",12),e.I0R(2,"ion-label"),e.OEk(3,".."),e.C$Y()()}}function K(o,d){if(1&o){const s=e.KQA();e.I0R(0,"ion-item",19),e.qCj("click",function(){e.usT(s);const i=e.GaO().$implicit,n=e.GaO(2);return e.CGJ(n.SelectFolder(i))}),e.wR5(1,"ion-icon",12),e.I0R(2,"ion-label"),e.OEk(3),e.C$Y()()}if(2&o){const s=e.GaO().$implicit;e.yG2(3),e.cNF(s.name)}}function J(o,d){if(1&o&&(e.I0R(0,"div"),e.yuY(1,K,4,1,"ion-item",16),e.C$Y()),2&o){const s=d.$implicit,t=e.GaO(2);e.yG2(),e.E7m("ngIf",t.CurrentDir==s.dir)}}function Q(o,d){1&o&&e.wR5(0,"ion-icon",37)}function V(o,d){1&o&&e.wR5(0,"ion-icon",38)}function W(o,d){1&o&&e.wR5(0,"ion-icon",39)}function H(o,d){1&o&&e.wR5(0,"ion-icon",40)}function z(o,d){1&o&&e.wR5(0,"ion-icon",41)}function X(o,d){1&o&&e.wR5(0,"ion-icon",42)}function q(o,d){if(1&o&&(e.I0R(0,"ion-label",43),e.OEk(1),e.C$Y()),2&o){const s=e.GaO(2).$implicit;e.yG2(),e.cNF(s.name)}}function Z(o,d){if(1&o&&(e.I0R(0,"ion-label"),e.OEk(1),e.C$Y()),2&o){const s=e.GaO(2).$implicit;e.yG2(),e.cNF(s.name)}}function ee(o,d){if(1&o){const s=e.KQA();e.I0R(0,"ion-button",44),e.qCj("click",function(){e.usT(s);const i=e.GaO(2).$implicit,n=e.GaO(2);return e.CGJ(n.OpenFile(i))}),e.OEk(1),e.C$Y()}if(2&o){const s=e.GaO(4);e.yG2(),e.oRS(" ",s.lang.text.UserFsDir.Open," ")}}function te(o,d){if(1&o){const s=e.KQA();e.I0R(0,"ion-button",44),e.qCj("click",function(){e.usT(s);const i=e.GaO(2).$implicit,n=e.GaO(2);return e.CGJ(n.dismiss_page(i))}),e.OEk(1),e.C$Y()}if(2&o){const s=e.GaO(4);e.yG2(),e.oRS(" ",s.lang.text.UserFsDir.Select," ")}}function ie(o,d){if(1&o){const s=e.KQA();e.I0R(0,"ion-button",44),e.qCj("click",function(){e.usT(s);const i=e.GaO(2).$implicit,n=e.GaO(2);return e.CGJ(n.DownloadFile(i))}),e.OEk(1),e.C$Y()}if(2&o){const s=e.GaO(4);e.yG2(),e.oRS(" ",s.lang.text.UserFsDir.Download," ")}}function ne(o,d){if(1&o){const s=e.KQA();e.I0R(0,"div",45),e.qCj("click",function(){e.usT(s);const i=e.GaO(2).$implicit,n=e.GaO(2);return e.CGJ(n.OpenFile(i))}),e.wR5(1,"img",46),e.C$Y()}if(2&o){const s=e.GaO(2).$implicit,t=e.GaO(2);e.yG2(),e.m_g(t.HideThumbnail?"filter: blur(6px);":""),e.E7m("src",s.thumbnail,e.K6U)("alt",s.name)}}function se(o,d){if(1&o){const s=e.KQA();e.I0R(0,"ion-accordion",23)(1,"ion-item",24),e.yuY(2,Q,1,0,"ion-icon",25)(3,V,1,0,"ion-icon",26)(4,W,1,0,"ion-icon",27)(5,H,1,0,"ion-icon",28)(6,z,1,0,"ion-icon",29)(7,X,1,0,"ion-icon",30)(8,q,2,1,"ion-label",31)(9,Z,2,1,"ion-label",8),e.wR5(10,"ion-icon",32),e.C$Y(),e.I0R(11,"div",33)(12,"ion-item",11)(13,"ion-label"),e.OEk(14),e.C$Y(),e.yuY(15,ee,2,1,"ion-button",34)(16,te,2,1,"ion-button",34)(17,ie,2,1,"ion-button",34),e.I0R(18,"ion-button",35),e.qCj("click",function(){e.usT(s);const i=e.GaO(),n=i.$implicit,r=i.index,l=e.GaO(2);return e.CGJ(l.RemoveFile(n,r))}),e.OEk(19),e.C$Y()(),e.yuY(20,ne,2,4,"div",36),e.C$Y()()}if(2&o){const s=e.GaO().$implicit;e.GaO();const t=e.Gew(17),i=e.GaO();e.E7m("value",s.path),e.yG2(2),e.E7m("ngIf","image"==s.viewer),e.yG2(),e.E7m("ngIf","audio"==s.viewer),e.yG2(),e.E7m("ngIf","video"==s.viewer),e.yG2(),e.E7m("ngIf","text"==s.viewer),e.yG2(),e.E7m("ngIf","godot"==s.viewer),e.yG2(),e.E7m("ngIf","disabled"==s.viewer),e.yG2(),e.E7m("ngIf",t.value==s.path),e.yG2(),e.E7m("ngIf",t.value!=s.path),e.yG2(5),e.cNF(i.lang.text.UserFsDir.Action),e.yG2(),e.E7m("ngIf","image"!=s.viewer),e.yG2(),e.E7m("ngIf",i.is_file_selector),e.yG2(),e.E7m("ngIf",i.cant_dedicated&&!i.is_file_selector),e.yG2(2),e.oRS(" ",i.lang.text.UserFsDir.Delete," "),e.yG2(),e.E7m("ngIf","image"==s.viewer)}}function re(o,d){if(1&o&&(e.I0R(0,"div"),e.yuY(1,se,21,15,"ion-accordion",22),e.C$Y()),2&o){const s=d.$implicit,t=e.GaO(2);e.yG2(),e.E7m("ngIf",t.CurrentDir==s.dir||t.is_file_selector)}}function oe(o,d){if(1&o){const s=e.KQA();e.I0R(0,"ion-list"),e.yuY(1,j,6,1,"div",8),e.I0R(2,"div")(3,"ion-item",11),e.wR5(4,"ion-icon",12),e.I0R(5,"ion-label"),e.OEk(6,"."),e.C$Y(),e.yuY(7,N,2,1,"ion-button",13),e.I0R(8,"ion-button",14),e.qCj("click",function(){e.usT(s);const i=e.GaO();return e.CGJ(i.CreateNewFolder())}),e.OEk(9),e.C$Y(),e.I0R(10,"ion-button",14),e.qCj("click",function(){e.usT(s);const i=e.GaO();return e.CGJ(i.SelectFiles())}),e.OEk(11),e.C$Y(),e.I0R(12,"ion-button",15),e.qCj("click",function(){e.usT(s);const i=e.GaO();return e.CGJ(i.RemoveDirectoryRecursive())}),e.OEk(13),e.C$Y()(),e.yuY(14,M,4,0,"ion-item",16),e.C$Y(),e.yuY(15,J,2,1,"div",17),e.I0R(16,"ion-accordion-group",null,18),e.yuY(18,re,2,1,"div",17),e.C$Y()()}if(2&o){const s=e.GaO();e.yG2(),e.E7m("ngIf",""==s.CurrentDir&&!s.is_file_selector&&s.CanImportFolder),e.yG2(6),e.E7m("ngIf",!s.cant_dedicated),e.yG2(2),e.oRS(" ",s.lang.text.UserFsDir.NewFolder," "),e.yG2(2),e.oRS(" ",s.lang.text.UserFsDir.AddFile," "),e.yG2(2),e.oRS(" ",s.lang.text.UserFsDir.RemoveCurrentDir," "),e.yG2(),e.E7m("ngIf",""!=s.CurrentDir),e.yG2(),e.E7m("ngForOf",s.DirList),e.yG2(3),e.E7m("ngForOf",s.FileList)}}function le(o,d){if(1&o){const s=e.KQA();e.I0R(0,"ion-item",19),e.qCj("click",function(){e.usT(s);const i=e.GaO().$implicit,n=e.GaO(2);return e.CGJ(n.importFolderMiddleAct(i))}),e.wR5(1,"ion-icon",12),e.I0R(2,"ion-label"),e.OEk(3),e.C$Y()()}if(2&o){const s=e.GaO().$implicit;e.yG2(3),e.cNF(s.name)}}function ae(o,d){if(1&o&&(e.I0R(0,"ion-item",49),e.wR5(1,"ion-icon",42),e.I0R(2,"ion-label"),e.OEk(3),e.C$Y()()),2&o){const s=e.GaO().$implicit;e.yG2(3),e.cNF(s.name)}}function ce(o,d){if(1&o&&(e.I0R(0,"div"),e.yuY(1,le,4,1,"ion-item",16)(2,ae,4,1,"ion-item",48),e.C$Y()),2&o){const s=d.$implicit;e.yG2(),e.E7m("ngIf",s.isDirectory),e.yG2(),e.E7m("ngIf",s.isFile)}}function de(o,d){if(1&o){const s=e.KQA();e.I0R(0,"ion-list")(1,"ion-item",19),e.qCj("click",function(){e.usT(s);const i=e.GaO();return e.CGJ(i.InAppBrowser=!0)}),e.wR5(2,"ion-icon",12),e.I0R(3,"ion-label",47),e.OEk(4,"/sdcard/Android/data/org.pjcone.portal/files"),e.C$Y()(),e.yuY(5,ce,3,2,"div",17),e.C$Y()}if(2&o){const s=e.GaO();e.yG2(5),e.E7m("ngForOf",s.ExternalFolder)}}let _e=(()=>{var o;class d{constructor(t,i,n,r,l,a,u,c,h,p,g,y,ue){this.modalCtrl=t,this.indexed=i,this.loadingCtrl=n,this.lang=r,this.global=l,this.p5toast=a,this.alertCtrl=u,this.sanitizer=c,this.file=h,this.navCtrl=p,this.noti=g,this.navParams=y,this.nakama=ue,this.DirList=[],this.FileList=[],this.cant_dedicated=!1,this.InAppBrowser=!0,this.is_ready=!1,this.is_file_selector=!1,this.HideThumbnail=!1,this.CanImportFolder=!0,this.BackButtonPressed=!1,this.StopIndexing=!1,this.EventListenerAct=me=>{me.detail.register(110,pe=>{this.is_ready?""==this.CurrentDir?pe():this.MoveToUpDir():(this.initLoadingElement.dismiss(),this.is_ready=!0)})},this.isCreateFolderRecursive=!1,this.ExternalFolder=[]}toggle_thumbnail(){this.HideThumbnail=!this.HideThumbnail,localStorage.setItem("user-fs-thumbnail",this.HideThumbnail?"1":"0")}InitBrowserBackButtonOverride(){window.history.pushState(null,null,window.location.href),window.onpopstate=()=>{this.BackButtonPressed||(this.BackButtonPressed=!0,this.navCtrl.back())}}ngOnInit(){this.InitBrowserBackButtonOverride(),"DesktopPWA"==F.s1&&setTimeout(()=>{this.CreateDrop()},0),this.CanImportFolder="MobilePWA"!=F.s1}ionViewDidEnter(){this.global.p5key.KeyShortCut.Escape=()=>{this.is_ready?""==this.CurrentDir?this.navCtrl.pop():this.MoveToUpDir():(this.initLoadingElement.dismiss(),this.is_ready=!0)}}CreateDrop(){var t=this;let i=document.getElementById("p5Drop_userfs");this.p5canvas=new E(n=>{n.setup=()=>{let c=n.createCanvas(i.clientWidth,i.clientHeight);c.parent(i),n.pixelDensity(1),c.drop(h=>{let p=n.millis();a<p-400?(l=!1,u.length=0,u.push(h)):(l=!0,u.push(h)),a=p,clearTimeout(r),r=setTimeout((0,m.c)(function*(){if(l)t.MultipleDrops(u);else{let g=yield t.loadingCtrl.create({message:t.lang.text.TodoDetail.WIP});g.present(),t.importSelected(h.file),g.dismiss()}}),400)})};let r,l=!1,a=0,u=[];n.mouseMoved=c=>{c.dataTransfer?(i.style.pointerEvents="all",i.style.backgroundColor="#0008"):(i.style.pointerEvents="none",i.style.backgroundColor="transparent")}})}CreateNewFolder(){var i,t=this;this.alertCtrl.create({header:this.lang.text.UserFsDir.CreateFolder,inputs:[{type:"text",placeholder:this.lang.text.UserFsDir.FolderName}],buttons:[{text:this.lang.text.UserFsDir.Create,handler:(i=(0,m.c)(function*(n){if(n[0])try{let r=`${t.CurrentDir}/${n[0]}`;yield t.indexed.createDirectory(r);let l=yield t.indexed.GetFileInfoFromDB(r),a={path:r,mode:l.mode,timestamp:l.timestamp,db:t.indexed.ionicDB};a.name=n[0],a.dir=t.CurrentDir,t.DirList.push(a)}catch(r){console.error("\ud3f4\ub354 \uc0dd\uc131 \uc2e4\ud328: ",r),t.p5toast.show({text:`${t.lang.text.UserFsDir.FailedToCreateFolder}: ${r}`})}else t.p5toast.show({text:t.lang.text.UserFsDir.NeedFolderName})}),function(r){return i.apply(this,arguments)})}]}).then(i=>{this.global.p5key.KeyShortCut.Escape=()=>{i.dismiss()},i.onDidDismiss().then(()=>{this.ionViewDidEnter()}),i.present()})}SelectFiles(){document.getElementById("import_file").click()}MultipleDrops(t){var i=this;return(0,m.c)(function*(){let n=yield i.loadingCtrl.create({message:i.lang.text.TodoDetail.WIP});n.present();for(let r=0,l=t.length;r<l;r++)yield i.importSelected(t[r].file);n.dismiss()})()}inputFileSelected(t){var i=this;return(0,m.c)(function*(){if(t.target.files.length)if(1!=t.target.files.length){let r=yield i.loadingCtrl.create({message:i.lang.text.UserFsDir.MultipleSave});r.present(),i.noti.noti.schedule({id:4,title:i.lang.text.UserFsDir.MultipleSave,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://diychat",color:"b0b0b0"});for(let l=0,a=t.target.files.length;l<a&&!i.StopIndexing;l++)r.message=`${i.lang.text.UserFsDir.MultipleSave}: ${a-l}`,i.noti.noti.schedule({id:4,title:i.lang.text.UserFsDir.MultipleSave,progressBar:{value:l,maxValue:a},sound:null,smallIcon:"res://diychat",color:"b0b0b0"}),yield i.importSelected(t.target.files[l]);setTimeout(()=>{i.noti.ClearNoti(4)},1e3),r.dismiss()}else{let r=yield i.loadingCtrl.create({message:i.lang.text.TodoDetail.WIP});r.present(),yield i.importSelected(t.target.files[0]),r.dismiss()}})()}importSelected(t){var i=this;return(0,m.c)(function*(){try{let n=`${i.CurrentDir}/${t.name}`;yield i.indexed.saveBlobToUserPath(t,n);let r=yield i.indexed.GetFileInfoFromDB(n),l={path:n,mode:r.mode,timestamp:r.timestamp,db:i.indexed.ionicDB};l.name=t.name,l.dir=i.CurrentDir,l.file_ext=l.name.split(".").pop(),i.global.set_viewer_category_from_ext(l),"image"==l.viewer&&i.indexed.loadBlobFromUserPath(l.path,"",a=>{let u=URL.createObjectURL(a);l.thumbnail=i.sanitizer.bypassSecurityTrustUrl(u)});try{let a=l.path.split("/");if(5!=a.length||"groups"!=a[3])throw"\uadf8\ub8f9 \uc774\ubbf8\uc9c0 \ud30c\uc77c\uc774 \uc544\ub2d8";i.SetDisplayGroupImageName(l,a)}catch{}for(let a=0,u=i.FileList.length;a<u;a++)if(i.FileList[a].path==n){i.FileList.splice(a,1);break}i.FileList.push(l)}catch(n){console.log("importSelected error: ",n)}})()}ionViewWillEnter(){this.HideThumbnail="1"==localStorage.getItem("user-fs-thumbnail"),this.CurrentDir="",this.is_file_selector=!!this.navParams.data.modal,this.LoadAllIndexedFiles(),("DesktopPWA"==F.s1||"MobilePWA"==F.s1)&&(this.cant_dedicated=!0),document.addEventListener("ionBackButton",this.EventListenerAct)}dismiss_page(t){var i=this;return(0,m.c)(function*(){if(i.is_file_selector){let n;t&&(n=yield i.indexed.loadBlobFromUserPath(t.path,""),n.name=t.name,n.file_ext=t.file_ext),i.modalCtrl.dismiss(n)}})()}LoadAllIndexedFiles(){var t=this;return(0,m.c)(function*(){if(t.initLoadingElement=yield t.loadingCtrl.create({message:t.lang.text.UserFsDir.LoadingExplorer}),t.initLoadingElement.present(),t.DirList.length=0,t.FileList.length=0,("Android"==F.s1||"iOS"==F.s1)&&t.noti.noti.schedule({id:5,title:t.lang.text.UserFsDir.LoadingExplorer,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"}),t.is_file_selector)if(t.navParams.get("path")){let i=yield t.indexed.GetFileListFromDB(t.navParams.get("path"));yield t.ModulateIndexedFile(i)}else{let i=yield t.indexed.GetFileListFromDB("/files/"),n=yield t.indexed.GetFileListFromDB("/todo/");i.push.apply(i,n),yield t.ModulateIndexedFile(i)}else{let i=yield t.indexed.GetFileListFromDB("/");yield t.ModulateIndexedFile(i)}t.FileList.sort((i,n)=>i.path>n.path?1:i.path<n.path?-1:0),t.DirList.sort((i,n)=>i.path>n.path?1:i.path<n.path?-1:0),setTimeout(()=>{t.noti.ClearNoti(5)},1e3),t.initLoadingElement.dismiss(),t.is_ready=!0})()}ModulateIndexedFile(t,i=this.indexed.ionicDB){var n=this;return(0,m.c)(function*(){for(let r=0,l=t.length;r<l;r++){if(n.StopIndexing)return;let a=`${n.lang.text.UserFsDir.LoadingExplorer}: ${t.length-r}`;("Android"==F.s1||"iOS"==F.s1)&&n.noti.noti.schedule({id:5,title:a,progressBar:{value:r,maxValue:t.length},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"}),n.initLoadingElement.message=a,yield n.indexed.GetFileInfoFromDB(t[r],u=>{let c={path:t[r],mode:u.mode,timestamp:u.timestamp,db:i};switch(c.name=c.path.substring(c.path.lastIndexOf("/")+1),c.dir=t[r].substring(0,t[r].lastIndexOf("/")),c.mode){case 33206:c.file_ext=c.name.split(".").pop(),n.global.set_viewer_category_from_ext(c),"image"==c.viewer&&n.indexed.loadBlobFromUserPath(c.path,"",g=>{let y=URL.createObjectURL(g);c.thumbnail=n.sanitizer.bypassSecurityTrustUrl(y)},i);try{let g=c.path.split("/");if(5!=g.length||"groups"!=g[3])throw"\uadf8\ub8f9 \uc774\ubbf8\uc9c0 \ud30c\uc77c\uc774 \uc544\ub2d8";n.SetDisplayGroupImageName(c,g)}catch{}n.FileList.push(c);break;case 16893:0==c.path.indexOf("todo/")&&n.SetDisplayTodoName(c);let h=!1,p=c.path.split("/");try{if(5!=p.length||"channels"!=p[3])throw"\ucc44\ub110 \ud3f4\ub354\uac00 \uc544\ub2d8";n.SetDisplayChannelName(c,p),h=!0}catch{}try{if(h||5!=p.length||"users"!=p[3])throw"\uc0ac\uc6a9\uc790 \ud3f4\ub354\uac00 \uc544\ub2d8";n.SetDisplayUserName(c,p),h=!0}catch{}n.DirList.push(c);break;default:console.log("\uc608\uc0c1\ud558\uc9c0 \ubabb\ud55c \ud30c\uc77c \ubaa8\ub4dc: ",c)}},i)}setTimeout(()=>{n.noti.ClearNoti(5)},1e3)})()}SetDisplayTodoName(t){var i=this;return(0,m.c)(function*(){try{let n=yield i.indexed.loadTextFromUserPath(`${t.path}/info.todo`),r=JSON.parse(n);t.name=r.title}catch(n){console.error("SetDisplayTodoName error: ",n)}})()}SetDisplayUserName(t,i){try{t.name=this.nakama.users[i[1]][i[2]][i[4]].display_name}catch{}}SetDisplayChannelName(t,i){try{t.name=this.nakama.channels_orig[i[1]][i[2]][t.name].title}catch{}}SetDisplayGroupImageName(t,i){try{t.name=`${this.nakama.groups[i[1]][i[2]][i[4].split(".").shift()].name}.img`}catch(n){console.error("SetDisplayGroupImageName error: ",n)}}MoveToUpDir(){this.CurrentDir=this.CurrentDir.substring(0,this.CurrentDir.lastIndexOf("/")),this.FileSel.value=void 0}SelectFolder(t){this.CurrentDir=t.path,this.FileSel.value=void 0}OpenFile(t){var i=this;return(0,m.c)(function*(){if(!i.CheckIfAccessable(t.path))return;document.removeEventListener("ionBackButton",i.EventListenerAct);let n=[];if(i.is_file_selector){if(i.navParams.data.path)for(let r=0,l=i.FileList.length;r<l;r++)n.push({content:i.FileList[r]})}else for(let r=0,l=i.FileList.length;r<l;r++)i.FileList[r].dir==i.CurrentDir&&n.push({content:i.FileList[r]});{let r=yield i.indexed.loadBlobFromUserPath(t.path,"");t.size=r.size}i.modalCtrl.create({component:C.K,componentProps:{info:{content:t},no_edit:!0,path:t.path,relevance:n},cssClass:"fullscreen"}).then(r=>{delete i.global.p5key.KeyShortCut.Escape,delete i.global.p5key.KeyShortCut.Digit,r.onDidDismiss().then(l=>{if(l.data)switch(l.data.type){case"image":return void i.modalCtrl.create({component:T.S,componentProps:{path:l.data.path,width:l.data.width,height:l.data.height,text:l.data.text},cssClass:"fullscreen"}).then(a=>{a.onWillDismiss().then(function(){var u=(0,m.c)(function*(c){let h=i.global.Base64ToBlob(c.data.img,"image/png");h.name=c.data.name,yield i.importSelected(h),c.data.loadingCtrl.dismiss(),document.addEventListener("ionBackButton",i.EventListenerAct),i.ionViewDidEnter()});return function(c){return u.apply(this,arguments)}}()),a.present()});case"text":console.log(l),i.importSelected(l.data.blob)}else document.addEventListener("ionBackButton",i.EventListenerAct),i.ionViewDidEnter()}),r.present()})})()}CheckIfAccessable(t){switch(t){case"servers/webrtc_server.json":case"servers/self/profile.json":return this.p5toast.show({text:this.lang.text.UserFsDir.PrivateAccessDenied}),!1}return!0}DownloadFile(t){this.CheckIfAccessable(t.path)&&this.indexed.DownloadFileFromUserPath(t.path,"",t.name)}ExportDirectoryRecursive(){this.alertCtrl.create({header:this.lang.text.UserFsDir.ExportDirTitle,message:this.lang.text.UserFsDir.ExportDirMsg,buttons:[{text:this.lang.text.UserFsDir.ExportConfirm,handler:()=>{this.ExportDirectoryRecursiveAct()}}]}).then(t=>{this.global.p5key.KeyShortCut.Escape=()=>{t.dismiss()},t.onDidDismiss().then(()=>{this.ionViewDidEnter()}),t.present()})}ExportDirectoryRecursiveAct(){var t=this;return(0,m.c)(function*(){let i=yield t.loadingCtrl.create({message:t.lang.text.UserFsDir.ExportDirTitle});i.present();let n=yield t.indexed.GetFileListFromDB(t.CurrentDir);for(let r=0,l=n.length;r<l;r++){if(t.StopIndexing)return void i.dismiss();let a=yield t.indexed.GetFileInfoFromDB(n[r]),u=yield t.indexed.loadBlobFromUserPath(n[r],""),c=n[r].lastIndexOf("/"),h=n[r].substring(0,c),p=n[r].substring(c+1);t.isCreateFolderRecursive||(t.isCreateFolderRecursive=!0,yield t.CreateFolderRecursive(h));try{if(16893==a.mode)throw yield t.file.createDir(t.file.externalDataDirectory+h,p,!0),i.message=`${t.lang.text.UserFsDir.ExportDirTitle}: ${p}`,"\uc774\uac70 \ud3f4\ub354\uc784";if(!t.CheckIfAccessable(n[r]))throw"\uc5f4\ub78c \ubd88\uac00 \ud30c\uc77c \uc81c\uc678";i.message=`${t.lang.text.UserFsDir.ExportDirTitle}: ${p}`,yield t.file.writeFile(t.file.externalDataDirectory+h+"/",p,u,{replace:!0})}catch(g){console.error(n[r],": \ud30c\uc77c \uc800\uc7a5 \uc2e4\ud328: ",g)}}t.isCreateFolderRecursive=!1,i.dismiss()})()}CreateFolderRecursive(t){var i=this;return(0,m.c)(function*(){let n=t.lastIndexOf("/")+1,r=t.substring(0,n),l=t.substring(n);r&&(yield i.CreateFolderRecursive(t.substring(0,n-1)));try{yield i.file.createDir(i.file.externalDataDirectory+r,l,!0)}catch{}})()}BrowseExternalFiles(){var t=this;return(0,m.c)(function*(){t.ExternalFolder.length=0,t.InAppBrowser=!1,t.ExternalFolder=yield t.file.listDir(t.file.externalApplicationStorageDirectory,"files"),t.ExternalFolder.sort(),t.ExternalFolder.sort((i,n)=>i.isDirectory?-1:1)})()}importFolderMiddleAct(t){var i=this;return(0,m.c)(function*(){let n=yield i.loadingCtrl.create({message:i.lang.text.UserFsDir.Import});n.present(),yield i.importThisFolder(t,n),i.InAppBrowser=!0,n.dismiss(),i.p5toast.show({text:i.lang.text.UserFsDir.NeedResetToApply})})()}importThisFolder(t,i){var n=this;return(0,m.c)(function*(){let r=t.nativeURL.substring(0,t.nativeURL.length-1),l=r.lastIndexOf("/"),a=yield n.file.listDir(r.substring(0,l)+"/",r.substring(l+1));for(let u=0,c=a.length;u<c;u++){if(n.StopIndexing)return void i.dismiss();if(a[u].isDirectory)yield n.importThisFolder(a[u],i);else{let h=a[u].nativeURL.split("org.pjcone.portal/files/")[1];try{let g=(yield U.readFile({path:a[u].nativeURL})).data.replace(/"|\\|=/g,"");yield n.indexed.saveBase64ToUserPath(","+g,decodeURIComponent(h)),i.message=`${n.lang.text.UserFsDir.Import}: ${a[u].name}`}catch(p){console.log("\ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",p),n.p5toast.show({text:`${n.lang.text.UserFsDir.ImportFailed}: ${p}`})}}}})()}SelectImportFolder(){this.cant_dedicated?document.getElementById("folder_sel_id").click():this.BrowseExternalFiles()}inputImageSelected(t){var i=this;return(0,m.c)(function*(){let n=yield i.loadingCtrl.create({message:i.lang.text.UserFsDir.LoadingExplorer});n.present();for(let r=0,l=t.target.files.length;r<l;r++){if(i.StopIndexing)return void n.dismiss();yield i.indexed.saveBlobToUserPath(t.target.files[r],t.target.files[r].webkitRelativePath)}i.LoadAllIndexedFiles(),n.dismiss(),i.p5toast.show({text:i.lang.text.UserFsDir.NeedResetToApply})})()}RemoveDirectoryRecursive(){var i,t=this;this.alertCtrl.create({header:this.CurrentDir.substring(this.CurrentDir.lastIndexOf("/")+1)||this.lang.text.UserFsDir.ResetDB,message:this.lang.text.UserFsDir.RemoveThisFolder,buttons:[{text:this.lang.text.UserFsDir.RemoveApply,handler:(i=(0,m.c)(function*(){let n=yield t.loadingCtrl.create({message:t.lang.text.UserFsDir.DeleteFile});n.present(),("Android"==F.s1||"iOS"==F.s1)&&t.noti.noti.schedule({id:4,title:t.lang.text.UserFsDir.DeleteFile,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"});let r=yield t.indexed.GetFileListFromDB(t.CurrentDir);for(let l=0,a=r.length;l<a;l++){if(t.StopIndexing)return void n.dismiss();("Android"==F.s1||"iOS"==F.s1)&&t.noti.noti.schedule({id:4,title:`${t.lang.text.UserFsDir.DeleteFile}: ${a-l}`,progressBar:{value:l,maxValue:a},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"}),n.message=`${t.lang.text.UserFsDir.DeleteFile}: ${a-l}`,yield t.indexed.removeFileFromUserPath(r[l])}for(let l=t.DirList.length-1;l>=0;l--)0==t.DirList[l].path.indexOf(t.CurrentDir)&&t.DirList.splice(l,1);for(let l=t.FileList.length-1;l>=0;l--)0==t.FileList[l].path.indexOf(t.CurrentDir)&&t.FileList.splice(l,1);t.MoveToUpDir(),n.dismiss(),setTimeout(()=>{t.noti.ClearNoti(4)},1e3)}),function(){return i.apply(this,arguments)}),cssClass:"red_font"}]}).then(i=>{this.global.p5key.KeyShortCut.Escape=()=>{i.dismiss()},i.onDidDismiss().then(()=>{this.ionViewDidEnter()}),i.present()})}RemoveFile(t,i){this.alertCtrl.create({header:this.lang.text.UserFsDir.DeleteFile,message:this.lang.text.UserFsDir.CannotBeUndo,buttons:[{text:this.lang.text.UserFsDir.DeleteAccept,handler:()=>{this.indexed.removeFileFromUserPath(t.path,()=>{this.FileList.splice(i,1)})},cssClass:"red_font"}]}).then(n=>{this.global.p5key.KeyShortCut.Escape=()=>{n.dismiss()},n.onDidDismiss().then(()=>{this.ionViewDidEnter()}),n.present()})}ionViewDidLeave(){this.StopIndexing=!0,this.FileList.forEach(t=>{URL.revokeObjectURL(t.thumbnail)}),setTimeout(()=>{this.noti.ClearNoti(4),this.noti.ClearNoti(5)},1e3)}ionViewWillLeave(){document.removeEventListener("ionBackButton",this.EventListenerAct),delete this.global.p5key.KeyShortCut.Escape,delete this.global.p5key.KeyShortCut.Digit}}return(o=d).\u0275fac=function(t){return new(t||o)(e.GI1(f.qS),e.GI1(R.k),e.GI1(f.Kg),e.GI1(O.o),e.GI1(k.A1),e.GI1(P.O),e.GI1(f.iW),e.GI1(S.mI),e.GI1(w.S),e.GI1(I.wX),e.GI1($.s),e.GI1(I.a6),e.GI1(L.h))},o.\u0275cmp=e.In1({type:o,selectors:[["app-user-fs-dir"]],viewQuery:function(t,i){if(1&t&&e.CC$(A,5),2&t){let n;e.wto(n=e.Gqi())&&(i.FileSel=n.first)}},decls:13,vars:5,consts:[[1,"ion-no-border"],["slot","start",3,"click"],["defaultHref",""],["class","top_icon","slot","end","name","eye-outline",3,"click",4,"ngIf"],["class","top_icon","slot","end","name","eye-off-outline",3,"click",4,"ngIf"],["oncontextmenu","return false;"],["id","p5Drop_userfs",2,"position","absolute","width","100%","height","100%","display","flex","pointer-events","none"],["hidden","","type","file","id","import_file","accept","*","multiple","",3,"change"],[4,"ngIf"],["slot","end","name","eye-outline",1,"top_icon",3,"click"],["slot","end","name","eye-off-outline",1,"top_icon",3,"click"],["button",""],["slot","start","name","folder"],["class","folder_button",3,"click",4,"ngIf"],[1,"folder_button",3,"click"],[3,"click"],["button","",3,"click",4,"ngIf"],[4,"ngFor","ngForOf"],["FileSel",""],["button","",3,"click"],["slot","start","name","arrow-down-circle"],["hidden","","type","file","id","folder_sel_id","webkitdirectory","",3,"change"],[3,"value",4,"ngIf"],[3,"value"],["slot","header"],["slot","start","name","image",4,"ngIf"],["slot","start","name","musical-notes",4,"ngIf"],["slot","start","name","play-circle",4,"ngIf"],["slot","start","name","reader",4,"ngIf"],["slot","start","name","extension-puzzle",4,"ngIf"],["slot","start","name","document",4,"ngIf"],["text-wrap","",4,"ngIf"],[1,"ion-accordion-toggle-icon","hide_accordion_icon"],["slot","content"],["class","ion-text-right button_dist",3,"click",4,"ngIf"],[1,"ion-text-end","button_dist",3,"click"],["class","image_front_form",3,"click",4,"ngIf"],["slot","start","name","image"],["slot","start","name","musical-notes"],["slot","start","name","play-circle"],["slot","start","name","reader"],["slot","start","name","extension-puzzle"],["slot","start","name","document"],["text-wrap",""],[1,"ion-text-right","button_dist",3,"click"],[1,"image_front_form",3,"click"],[1,"image_front_view",3,"src","alt"],["color","medium"],["button","","disabled","",4,"ngIf"],["button","","disabled",""]],template:function(t,i){1&t&&(e.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),e.OEk(3),e.C$Y(),e.I0R(4,"ion-buttons",1),e.qCj("click",function(){return i.dismiss_page()}),e.wR5(5,"ion-back-button",2),e.C$Y(),e.yuY(6,B,1,0,"ion-icon",3)(7,Y,1,0,"ion-icon",4),e.C$Y()(),e.I0R(8,"ion-content",5)(9,"div",6)(10,"input",7),e.qCj("change",function(r){return i.inputFileSelected(r)}),e.C$Y()(),e.yuY(11,oe,19,8,"ion-list",8)(12,de,6,1,"ion-list",8),e.C$Y()),2&t&&(e.yG2(3),e.cNF(i.lang.text.Settings.InAppExplorer),e.yG2(3),e.E7m("ngIf",!i.HideThumbnail),e.yG2(),e.E7m("ngIf",i.HideThumbnail),e.yG2(4),e.E7m("ngIf",i.InAppBrowser),e.yG2(),e.E7m("ngIf",!i.InAppBrowser))},dependencies:[b.ay,b.u_,f.cm,f.qU,f.sn,f.GS,f._i,f.wB,f.Ko,f.Yb,f.QR,f.OC,f.tM,f.Md,f.Im],styles:[".item.sc-ion-label-md-h[_ngcontent-%COMP%], .item[_ngcontent-%COMP%]   .sc-ion-label-md-h[_ngcontent-%COMP%]{overflow:unset}.image_front_form[_ngcontent-%COMP%]{display:flex;justify-content:center;text-align:center}.image_front_view[_ngcontent-%COMP%]{max-height:233px}.top_icon[_ngcontent-%COMP%]{width:28px;height:28px;padding-right:28px;cursor:pointer}.button_dist[_ngcontent-%COMP%]{padding-left:2px}.folder_button[_ngcontent-%COMP%]{padding-right:4px}"]}),d})()}}]);