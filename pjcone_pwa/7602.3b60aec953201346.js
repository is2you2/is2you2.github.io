"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7602],{5087:(J,M,_)=>{_.d(M,{r:()=>H});var a=_(655),r=_(3996),f=_(3260),O=_(5016),R=_(549),e=_(9863),V=_(1282),t=_(3496),L=_(5742),W=_(4433),C=_(3336),E=_(9912),g=_(4299),P=_(9808);function A(u,y){if(1&u){const o=e.EpF();e.TgZ(0,"ion-item",13),e.NdJ("click",function(){return e.CHM(o),e.oxw(2).ShowContentInfoGodot.present()}),e.TgZ(1,"ion-label"),e._uU(2),e.qZA()()}if(2&u){const o=e.oxw(2);e.xp6(2),e.Oqu(o.lang.text.ContentViewer.ContentInfo)}}function Z(u,y){if(1&u){const o=e.EpF();e.TgZ(0,"ion-item",10),e.NdJ("click",function(){return e.CHM(o),e.oxw(2).download_file()}),e.TgZ(1,"ion-label"),e._uU(2),e.qZA()()}if(2&u){const o=e.oxw(2);e.xp6(2),e.Oqu(o.lang.text.ContentViewer.Download)}}function k(u,y){if(1&u){const o=e.EpF();e.TgZ(0,"ion-content")(1,"ion-list")(2,"ion-item",10),e.NdJ("click",function(){return e.CHM(o),e.oxw().snapshot_modify()}),e.TgZ(3,"ion-label"),e._uU(4),e.qZA()(),e.YNc(5,A,3,1,"ion-item",11),e.TgZ(6,"ion-item",10),e.NdJ("click",function(){return e.CHM(o),e.oxw().ShareContent()}),e.TgZ(7,"ion-label"),e._uU(8),e.qZA()(),e.YNc(9,Z,3,1,"ion-item",12),e.qZA()()}if(2&u){const o=e.oxw();e.xp6(4),e.Oqu(o.lang.text.ContentViewer.Edit),e.xp6(1),e.Q6J("ngIf",o.FileInfo.content_creator),e.xp6(3),e.Oqu(o.lang.text.ContentViewer.ShareContent),e.xp6(1),e.Q6J("ngIf",!o.FileInfo.url)}}function S(u,y){if(1&u){const o=e.EpF();e.TgZ(0,"ion-item",10),e.NdJ("click",function(){return e.CHM(o),e.oxw(2).copy_url()}),e.TgZ(1,"ion-label"),e._uU(2),e.qZA(),e.TgZ(3,"ion-label",14),e._uU(4),e.qZA()()}if(2&u){const o=e.oxw(2);e.xp6(2),e.Oqu(o.lang.text.ContentInfo.SourceFrom),e.xp6(2),e.Oqu(o.content_creator.various_display)}}function q(u,y){if(1&u){const o=e.EpF();e.TgZ(0,"div")(1,"ion-item-divider")(2,"div",17),e._uU(3),e.qZA()(),e.TgZ(4,"ion-item")(5,"ion-label"),e._uU(6),e.qZA(),e.TgZ(7,"ion-label",14),e._uU(8),e.qZA()(),e.TgZ(9,"ion-item",10),e.NdJ("click",function(){return e.CHM(o),e.oxw(2).copy_url()}),e.TgZ(10,"ion-label"),e._uU(11),e.qZA(),e.TgZ(12,"ion-label",14),e._uU(13),e.qZA()()()}if(2&u){const o=y.$implicit,c=e.oxw(2);e.xp6(3),e.Oqu(o.timeDisplay),e.xp6(3),e.Oqu(c.lang.text.ContentInfo.Publisher),e.xp6(2),e.Oqu(o.publisher||o.display_name||c.lang.text.Profile.noname_user),e.xp6(3),e.Oqu(c.lang.text.ContentInfo.SourceFrom),e.xp6(2),e.Oqu(o.various_display)}}function Y(u,y){if(1&u){const o=e.EpF();e.TgZ(0,"ion-content")(1,"ion-item-divider")(2,"ion-label"),e._uU(3),e.qZA()(),e.TgZ(4,"ion-item")(5,"ion-label"),e._uU(6),e.qZA(),e.TgZ(7,"ion-label",14),e._uU(8),e.qZA()(),e.YNc(9,S,5,2,"ion-item",12),e.TgZ(10,"ion-item")(11,"ion-label"),e._uU(12),e.qZA(),e.TgZ(13,"ion-label",14),e._uU(14),e.qZA()(),e.YNc(15,q,14,5,"div",15),e.TgZ(16,"ion-item",10),e.NdJ("click",function(){return e.CHM(o),e.oxw().ShowContentInfoGodot.dismiss()}),e.TgZ(17,"ion-label",16),e._uU(18),e.qZA()()()}if(2&u){const o=e.oxw();e.xp6(3),e.Oqu(o.lang.text.ContentInfo.WorkLogs),e.xp6(3),e.Oqu(o.lang.text.ContentInfo.LastPost),e.xp6(2),e.hij(" ",(o.content_creator.user_id?o.content_creator.is_me?o.nakama.users.self.display_name:o.nakama.users[o.isOfficial][o.target][o.content_creator.user_id].display_name:o.content_creator.display_name)||o.lang.text.Profile.noname_user,""),e.xp6(1),e.Q6J("ngIf",o.content_creator.various),e.xp6(3),e.Oqu(o.lang.text.ContentInfo.TimeAt),e.xp6(2),e.Oqu(o.content_creator.timeDisplay),e.xp6(1),e.Q6J("ngForOf",o.content_related_creator),e.xp6(3),e.Oqu(o.lang.text.ContentInfo.CloseModal)}}const G=function(){return[.5,1]};let H=(()=>{class u{constructor(o,c,l,T,i,n,s,h,d,w,x){this.modalCtrl=o,this.navParams=c,this.global=l,this.indexed=T,this.lang=i,this.file=n,this.alertCtrl=s,this.loadingCtrl=h,this.p5toast=d,this.nakama=w,this.mClipboard=x,this.EventListenerAct=v=>{v.detail.register(120,D=>{})}}ngOnInit(){this.FileInfo=this.navParams.get("info"),this.CreateContentInfo()}CreateContentInfo(){this.isOfficial=this.navParams.get("isOfficial"),this.target=this.navParams.get("target");try{this.content_creator=this.FileInfo.content_creator,this.content_creator.timeDisplay=new Date(this.content_creator.timestamp).toLocaleString(),this.content_related_creator=this.FileInfo.content_related_creator,this.content_creator.user_id&&(this.content_creator.is_me=this.nakama.servers[this.isOfficial][this.target].session.user_id==this.content_creator.user_id),this.set_various_display(this.content_creator);for(let o=0,c=this.content_related_creator.length;o<c;o++)this.content_related_creator[o].user_id&&(this.content_related_creator[o].is_me=this.nakama.servers[this.isOfficial][this.target].session.user_id==this.content_related_creator[o].user_id),this.content_related_creator[o].timeDisplay=new Date(this.content_related_creator[o].timestamp).toLocaleString(),this.set_various_display(this.content_related_creator[o])}catch(o){}try{this.content_related_creator[0].publisher=this.content_related_creator[0].is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_related_creator[0].user_id].display_name,this.content_related_creator[0].timestamp==this.content_related_creator[1].timestamp&&(this.content_related_creator[0].publisher=this.content_related_creator[1].is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_related_creator[1].user_id].display_name,this.content_related_creator.splice(1,1))}catch(o){try{this.content_related_creator[0].publisher||(this.content_related_creator[0].publisher=this.content_related_creator[0].display_name)}catch(c){}}try{this.content_related_creator.sort((o,c)=>o.timestamp>c.timestamp?-1:o.timestamp<c.timestamp?1:0)}catch(o){}}set_various_display(o){switch(o.various_display=this.lang.text.GlobalAct.UnknownSource,o.various){case"camera":o.various_display=this.lang.text.GlobalAct.FromCamera;break;case"link":o.various_display=this.FileInfo.url;break;case"loaded":o.various_display=this.lang.text.GlobalAct.variousCreator;break;case"voidDraw":o.various_display=this.lang.text.GlobalAct.FromVoidDraw;break;case"long_text":o.various_display=this.lang.text.GlobalAct.FromAutoLongText}}ionViewDidEnter(){return(0,a.mG)(this,void 0,void 0,function*(){document.addEventListener("ionBackButton",this.EventListenerAct),yield this.global.CreateGodotIFrame("viewer",{local_url:"assets/data/godot/viewer.pck",title:"ViewerEx",path:this.navParams.get("path"),ext:this.FileInfo.file_ext,force_logo:!0,receive_image:(o,c,l)=>{this.modalCtrl.dismiss({base64:","+o,width:c,height:l})}},"create_thumbnail")})}snapshot_modify(){this.global.godot_window.modify_image()}download_file(){"DesktopPWA"==O.n$||"MobilePWA"==O.n$?this.indexed.DownloadFileFromUserPath(this.navParams.get("path"),this.FileInfo.type,this.FileInfo.filename):this.alertCtrl.create({header:this.lang.text.ContentViewer.Filename,inputs:[{name:"filename",placeholder:this.FileInfo.filename,type:"text"}],buttons:[{text:this.lang.text.ContentViewer.saveFile,handler:o=>(0,a.mG)(this,void 0,void 0,function*(){let c=yield this.loadingCtrl.create({message:this.lang.text.TodoDetail.WIP});c.present();let l=o.filename?`${o.filename.replace(/:|\?|\/|\\|<|>/g,"")}.${this.FileInfo.file_ext}`:this.FileInfo.filename,T=yield this.indexed.loadBlobFromUserPath(this.navParams.get("path"),this.FileInfo.type);this.file.writeFile(this.file.externalDataDirectory,l,T).then(i=>{c.dismiss(),this.p5toast.show({text:this.lang.text.ContentViewer.fileSaved})}).catch(i=>{12===(c.dismiss(),i.code)?(this.p5toast.show({text:this.lang.text.ContentViewer.AlreadyExist}),this.download_file()):console.log("\uc900\ube44\ub418\uc9c0 \uc54a\uc740 \uc624\ub958 \ubc18\ud658: ",i)})})}]}).then(o=>o.present())}ShareContent(){let o=this.nakama.rearrange_channels();for(let c=o.length-1;c>=0;c--)("missing"==o[c].status||"offline"==o[c].status)&&o.splice(c,1);o.length?this.modalCtrl.create({component:R.D,componentProps:{file:this.FileInfo,channels:o}}).then(c=>{c.onDidDismiss().then(l=>this.modalCtrl.dismiss()),c.present()}):this.p5toast.show({text:this.lang.text.ShareContentToOther.NoChannelToShare})}ionViewWillLeave(){document.removeEventListener("ionBackButton",this.EventListenerAct),this.global.godot_window.filename=this.FileInfo.filename,this.global.godot_window.create_thumbnail(this.FileInfo)}copy_url(){this.mClipboard.copy(this.FileInfo.url).catch(o=>f.Z.write(this.FileInfo.url))}}return u.\u0275fac=function(o){return new(o||u)(e.Y36(r.IN),e.Y36(r.X1),e.Y36(V.AN),e.Y36(t.H),e.Y36(L.b),e.Y36(W.$),e.Y36(r.Br),e.Y36(r.HT),e.Y36(C.F),e.Y36(E.a),e.Y36(g.T))},u.\u0275cmp=e.Xpm({type:u,selectors:[["app-godot-viewer"]],viewQuery:function(o,c){if(1&o&&e.Gf(r.ki,5),2&o){let l;e.iGM(l=e.CRH())&&(c.ShowContentInfoGodot=l.first)}},decls:22,vars:5,consts:[["slot","start",3,"click"],["defaultHref",""],[1,"main_table",2,"width","100%","height","100%","margin","0"],[2,"height","0"],["text-wrap",""],["id","menu_trigger"],["name","ellipsis-vertical"],["trigger","menu_trigger","dismissOnSelect",""],["id","viewer",1,"full_screen",2,"display","flex"],["trigger","ShowContentInfoGodot",3,"initialBreakpoint","breakpoints"],["button","",3,"click"],["button","","id","ShowContentInfoGodot",3,"click",4,"ngIf"],["button","",3,"click",4,"ngIf"],["button","","id","ShowContentInfoGodot",3,"click"],[1,"ion-text-end"],[4,"ngFor","ngForOf"],[1,"ion-text-center"],[2,"width","100%","text-align","center"]],template:function(o,c){1&o&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e._uU(3),e.qZA(),e.TgZ(4,"ion-buttons",0),e.NdJ("click",function(){return c.modalCtrl.dismiss()}),e._UZ(5,"ion-back-button",1),e.qZA()()(),e.TgZ(6,"ion-content")(7,"table",2)(8,"tr",3)(9,"td")(10,"ion-list-header")(11,"ion-label",4),e._uU(12),e.qZA(),e.TgZ(13,"ion-button",5),e._UZ(14,"ion-icon",6),e.qZA(),e.TgZ(15,"ion-popover",7),e.YNc(16,k,10,4,"ng-template"),e.qZA()()()(),e.TgZ(17,"tr")(18,"td"),e._UZ(19,"div",8),e.qZA()()(),e.TgZ(20,"ion-modal",9),e.YNc(21,Y,19,8,"ng-template"),e.qZA()()),2&o&&(e.xp6(3),e.Oqu(c.lang.text.ContentViewer.Title),e.xp6(9),e.Oqu(c.FileInfo.filename),e.xp6(8),e.Q6J("initialBreakpoint",.5)("breakpoints",e.DdM(4,G)))},directives:[r.Gu,r.sr,r.wd,r.Sm,r.oU,r.cs,r.W2,r.yh,r.Q$,r.YG,r.gu,r.d8,r.q_,r.Ie,P.O5,r.ki,r.rH,P.sg],styles:[""]}),u})()},774:(J,M,_)=>{_.d(M,{B:()=>c});var a=_(655),r=_(3996),f=_(5016),O=_(6505),e=_(549),V=_(3260),t=_(9863),L=_(3496),W=_(5742),C=_(4433),E=_(3336),g=_(6690),P=_(1282),A=_(9912),Z=_(4299),k=_(9808);function S(l,T){if(1&l){const i=t.EpF();t.TgZ(0,"ion-item",15),t.NdJ("click",function(){return t.CHM(i),t.oxw(2).modify_image()}),t.TgZ(1,"ion-label"),t._uU(2),t.qZA()()}if(2&l){const i=t.oxw(2);t.xp6(2),t.Oqu(i.lang.text.ContentViewer.Edit)}}function q(l,T){if(1&l){const i=t.EpF();t.TgZ(0,"ion-item",16),t.NdJ("click",function(){return t.CHM(i),t.oxw(2).open_bottom_modal()}),t.TgZ(1,"ion-label"),t._uU(2),t.qZA()()}if(2&l){const i=t.oxw(2);t.xp6(2),t.Oqu(i.lang.text.ContentViewer.ContentInfo)}}function Y(l,T){if(1&l){const i=t.EpF();t.TgZ(0,"ion-item",15),t.NdJ("click",function(){return t.CHM(i),t.oxw(2).download_file()}),t.TgZ(1,"ion-label"),t._uU(2),t.qZA()()}if(2&l){const i=t.oxw(2);t.xp6(2),t.Oqu(i.lang.text.ContentViewer.Download)}}function G(l,T){if(1&l){const i=t.EpF();t.TgZ(0,"ion-content")(1,"ion-list"),t.YNc(2,S,3,1,"ion-item",13),t.YNc(3,q,3,1,"ion-item",14),t.TgZ(4,"ion-item",15),t.NdJ("click",function(){return t.CHM(i),t.oxw().ShareContent()}),t.TgZ(5,"ion-label"),t._uU(6),t.qZA()(),t.YNc(7,Y,3,1,"ion-item",13),t.qZA()()}if(2&l){const i=t.oxw();t.xp6(2),t.Q6J("ngIf","audio"!=i.FileInfo.viewer&&!i.HasNoEditButton),t.xp6(1),t.Q6J("ngIf",i.FileInfo.content_creator),t.xp6(3),t.Oqu(i.lang.text.ContentViewer.ShareContent),t.xp6(1),t.Q6J("ngIf",!i.FileInfo.url)}}function H(l,T){if(1&l){const i=t.EpF();t.TgZ(0,"ion-item",15),t.NdJ("click",function(){return t.CHM(i),t.oxw(2).copy_url()}),t.TgZ(1,"ion-label"),t._uU(2),t.qZA(),t.TgZ(3,"ion-label",17),t._uU(4),t.qZA()()}if(2&l){const i=t.oxw(2);t.xp6(2),t.Oqu(i.lang.text.ContentInfo.SourceFrom),t.xp6(2),t.Oqu(i.content_creator.various_display)}}function u(l,T){if(1&l){const i=t.EpF();t.TgZ(0,"div")(1,"ion-item-divider")(2,"div",20),t._uU(3),t.qZA()(),t.TgZ(4,"ion-item")(5,"ion-label"),t._uU(6),t.qZA(),t.TgZ(7,"ion-label",17),t._uU(8),t.qZA()(),t.TgZ(9,"ion-item",15),t.NdJ("click",function(){return t.CHM(i),t.oxw(2).copy_url()}),t.TgZ(10,"ion-label"),t._uU(11),t.qZA(),t.TgZ(12,"ion-label",17),t._uU(13),t.qZA()()()}if(2&l){const i=T.$implicit,n=t.oxw(2);t.xp6(3),t.Oqu(i.timeDisplay),t.xp6(3),t.Oqu(n.lang.text.ContentInfo.Publisher),t.xp6(2),t.Oqu(i.publisher||i.display_name||n.lang.text.Profile.noname_user),t.xp6(3),t.Oqu(n.lang.text.ContentInfo.SourceFrom),t.xp6(2),t.Oqu(i.various_display)}}function y(l,T){if(1&l){const i=t.EpF();t.TgZ(0,"ion-content")(1,"ion-item-divider")(2,"ion-label"),t._uU(3),t.qZA()(),t.TgZ(4,"ion-item")(5,"ion-label"),t._uU(6),t.qZA(),t.TgZ(7,"ion-label",17),t._uU(8),t.qZA()(),t.YNc(9,H,5,2,"ion-item",13),t.TgZ(10,"ion-item")(11,"ion-label"),t._uU(12),t.qZA(),t.TgZ(13,"ion-label",17),t._uU(14),t.qZA()(),t.YNc(15,u,14,5,"div",18),t.TgZ(16,"ion-item",15),t.NdJ("click",function(){return t.CHM(i),t.oxw().ShowContentInfoIonic.dismiss()}),t.TgZ(17,"ion-label",19),t._uU(18),t.qZA()()()}if(2&l){const i=t.oxw();t.xp6(3),t.Oqu(i.lang.text.ContentInfo.WorkLogs),t.xp6(3),t.Oqu(i.lang.text.ContentInfo.LastPost),t.xp6(2),t.hij(" ",(i.content_creator.user_id?i.content_creator.is_me?i.nakama.users.self.display_name:i.nakama.users[i.isOfficial][i.target][i.content_creator.user_id].display_name:i.content_creator.display_name)||i.lang.text.Profile.noname_user,""),t.xp6(1),t.Q6J("ngIf",i.content_creator.various),t.xp6(3),t.Oqu(i.lang.text.ContentInfo.TimeAt),t.xp6(2),t.Oqu(i.content_creator.timeDisplay),t.xp6(1),t.Q6J("ngForOf",i.content_related_creator),t.xp6(3),t.Oqu(i.lang.text.ContentInfo.CloseModal)}}const o=function(){return[.5,1]};let c=(()=>{class l{constructor(i,n,s,h,d,w,x,v,D,F,N,b){this.modalCtrl=i,this.navParams=n,this.indexed=s,this.lang=h,this.file=d,this.p5toast=w,this.alertCtrl=x,this.loadingCtrl=v,this.fileOpener=D,this.global=F,this.nakama=N,this.mClipboard=b,this.useP5Navigator=!0,this.image_info={}}ngOnInit(){return(0,a.mG)(this,void 0,void 0,function*(){this.FileInfo=this.navParams.get("info"),this.ContentBox=document.getElementById("ContentBox"),this.FileHeader=document.getElementById("FileHeader"),this.HasNoEditButton=this.navParams.get("no_edit")||!1,this.navParams.get("isURL")?this.FileURL=this.FileInfo.url:(this.blob=yield this.indexed.loadBlobFromUserPath(this.navParams.get("path"),this.FileInfo.type),this.FileURL=URL.createObjectURL(this.blob)),this.CreateContentInfo()})}CreateContentInfo(){this.isOfficial=this.navParams.get("isOfficial"),this.target=this.navParams.get("target");try{this.content_creator=this.FileInfo.content_creator,this.content_creator.timeDisplay=new Date(this.content_creator.timestamp).toLocaleString(),this.content_related_creator=this.FileInfo.content_related_creator,this.content_creator.user_id&&(this.content_creator.is_me=this.nakama.servers[this.isOfficial][this.target].session.user_id==this.content_creator.user_id),this.set_various_display(this.content_creator);for(let i=0,n=this.content_related_creator.length;i<n;i++)this.content_related_creator[i].user_id&&(this.content_related_creator[i].is_me=this.nakama.servers[this.isOfficial][this.target].session.user_id==this.content_related_creator[i].user_id),this.content_related_creator[i].timeDisplay=new Date(this.content_related_creator[i].timestamp).toLocaleString(),this.set_various_display(this.content_related_creator[i])}catch(i){}try{this.content_related_creator[0].publisher=this.content_related_creator[0].is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_related_creator[0].user_id].display_name,this.content_related_creator[0].timestamp==this.content_related_creator[1].timestamp&&(this.content_related_creator[0].publisher=this.content_related_creator[1].is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_related_creator[1].user_id].display_name,this.content_related_creator.splice(1,1))}catch(i){try{this.content_related_creator[0].publisher=this.content_related_creator[1].display_name,this.content_related_creator[0].timestamp==this.content_related_creator[1].timestamp&&(this.content_related_creator[0].publisher=this.content_related_creator[1].display_name,this.content_related_creator.splice(1,1))}catch(n){}try{this.content_related_creator[0].publisher||(this.content_related_creator[0].publisher=this.content_related_creator[0].display_name)}catch(n){}}try{this.content_related_creator.sort((i,n)=>i.timestamp>n.timestamp?-1:i.timestamp<n.timestamp?1:0)}catch(i){}}set_various_display(i){switch(i.various_display=this.lang.text.GlobalAct.UnknownSource,i.various){case"camera":i.various_display=this.lang.text.GlobalAct.FromCamera;break;case"link":i.various_display=this.FileInfo.url;break;case"loaded":i.various_display=this.lang.text.GlobalAct.variousCreator;break;case"voidDraw":i.various_display=this.lang.text.GlobalAct.FromVoidDraw;break;case"long_text":i.various_display=this.lang.text.GlobalAct.FromAutoLongText}}ionViewDidEnter(){return(0,a.mG)(this,void 0,void 0,function*(){let i=document.getElementById("p5canvas");switch(this.FileInfo.viewer){case"image":this.p5canvas=new O(n=>{let s;n.setup=()=>(0,a.mG)(this,void 0,void 0,function*(){i.style.maxWidth="100%",i.style.overflow="hidden",this.ContentBox.style.overflow="hidden",n.noCanvas();let m=document.createElement("img");m.hidden=!0,m.src=this.FileURL,m.onload=()=>{i.style.backgroundImage=`url(${this.FileURL})`,i.style.backgroundRepeat="no-repeat",i.style.pointerEvents="none",this.image_info.width=m.naturalWidth,this.image_info.height=m.naturalHeight,d=n.createVector(m.naturalWidth,m.naturalHeight),h(),m.remove()},("Android"==f.n$||"iOS"==f.n$)&&(s=document.createElement("iframe"),s.setAttribute("src",this.FileURL),s.setAttribute("frameborder","0"),s.setAttribute("class","full_screen"),s.setAttribute("style","position: relative; pointer-events: all"),s.hidden=!0,i.appendChild(s)),n.noLoop()});let h=()=>{if(this.image_info.width/this.image_info.height<i.clientWidth/i.clientHeight){let m=this.image_info.width*i.clientHeight/this.image_info.height;i.style.backgroundSize=`${m}px`,i.style.backgroundPositionX=(i.clientWidth-m)/2+"px",i.style.backgroundPositionY="0px"}else i.style.backgroundSize=`${i.clientWidth}px`,i.style.backgroundPositionX="0px",i.style.backgroundPositionY=i.clientHeight/2-d.y*(i.clientWidth/d.x)/2+"px"};n.windowResized=()=>{setTimeout(()=>{h()},50)};let d,w=n.createVector(),x=n.createVector(),v=n.createVector(),D=1,F=()=>{i.style.backgroundPositionX=`${w.x+v.x}px`,i.style.backgroundPositionY=`${w.y+v.y}px`},N=(m,U)=>{let p=D,I=D*U,B=Number(i.style.backgroundPositionX.split("px")[0]),K=Number(i.style.backgroundPositionY.split("px")[0]),Q=(p-I)*n.map(m.x,B,B+p,0,1),X=(p-I)/d.x*d.y*n.map(m.y,K,K+p/d.x*d.y,0,1);i.style.backgroundPositionX=`${B+Q}px`,i.style.backgroundPositionY=`${K+X}px`,i.style.backgroundSize=`${I}px`};n.mousePressed=()=>{!this.useP5Navigator||(n.mouseButton==n.CENTER&&h(),"DesktopPWA"==f.n$&&(w=n.createVector(Number(i.style.backgroundPositionX.split("px")[0]),Number(i.style.backgroundPositionY.split("px")[0])),x=n.createVector(n.mouseX,n.mouseY)))},n.mouseWheel=m=>{!this.useP5Navigator||(D=Number(i.style.backgroundSize.split("px")[0]),N(n.createVector(i.clientWidth/2,i.clientHeight/2),1-m.delta/1e3))},n.mouseDragged=()=>{!this.useP5Navigator||"DesktopPWA"==f.n$&&(v=n.createVector(n.mouseX,n.mouseY),v.sub(x),F())};let z,b={},$=!1;n.touchStarted=m=>{if(this.useP5Navigator){for(let p=0,I=m.changedTouches.length;p<I;p++)b[m.changedTouches[p].identifier]=n.createVector(m.changedTouches[p].clientX,m.changedTouches[p].clientY);switch(Object.keys(b).length){case 1:w=n.createVector(Number(i.style.backgroundPositionX.split("px")[0]),Number(i.style.backgroundPositionY.split("px")[0])),x=b[m.changedTouches[0].identifier].copy();break;case 2:w=n.createVector(Number(i.style.backgroundPositionX.split("px")[0]),Number(i.style.backgroundPositionY.split("px")[0]));let p=b[0].copy();z=p.dist(b[1]),x=p.add(b[1]).div(2).copy(),D=Number(i.style.backgroundSize.split("px")[0]),F();break;default:$=!0,h()}}},n.touchMoved=m=>{if(this.useP5Navigator&&!$){for(let p=0,I=m.changedTouches.length;p<I;p++)b[m.changedTouches[p].identifier]=n.createVector(m.changedTouches[p].clientX,m.changedTouches[p].clientY);switch(Object.keys(b).length){case 1:v=b[m.changedTouches[0].identifier].copy(),v.sub(x),F();break;case 2:let p=b[0].copy(),I=p.dist(b[1]);v=p.add(b[1]).div(2).copy();let B=v.copy();v.sub(x),F(),N(B,I/z)}}},n.touchEnded=m=>{if(this.useP5Navigator&&"changedTouches"in m){for(let p=0,I=m.changedTouches.length;p<I;p++)delete b[m.changedTouches[p].identifier];switch(Object.keys(b).length){case 1:w=n.createVector(Number(i.style.backgroundPositionX.split("px")[0]),Number(i.style.backgroundPositionY.split("px")[0])),x=b[Object.keys(b)[0]].copy();break;case 0:$=!1}}}});break;case"audio":this.p5canvas=new O(n=>{var s;n.setup=()=>{n.noCanvas(),n.noLoop(),s=n.createAudio([this.FileURL],()=>{i.appendChild(s.elt),s.elt.hidden=!0,setTimeout(()=>{h(),s.elt.hidden=!1},50),s.showControls(),s.play()})};let h=()=>{let d=this.ContentBox.offsetWidth;s.elt.setAttribute("style","position: relative; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%);"),s.size(d,25)};n.windowResized=()=>{setTimeout(()=>{h()},50)}});break;case"video":this.p5canvas=new O(n=>{var s;n.setup=()=>{n.noCanvas(),n.noLoop(),s=n.createVideo([this.FileURL],()=>{i.appendChild(s.elt),s.elt.hidden=!0,setTimeout(()=>{this.image_info.width=s.elt.videoWidth,this.image_info.height=s.elt.videoHeight,h(),s.elt.hidden=!1},50),s.showControls(),s.play()}),n.VideoMedia=s};let h=()=>{let d=this.ContentBox.offsetWidth,w=this.ContentBox.offsetHeight-this.FileHeader.offsetHeight,x=s.width,v=s.height;s.elt.setAttribute("style","position: relative; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%);"),x<v?(v=w,x=x/s.height*v):(x=d,v=v/s.width*x||w/2),s.size(x,v)};n.windowResized=()=>{setTimeout(()=>{h()},50)}});break;case"text":this.p5canvas=new O(n=>{n.setup=()=>{n.noCanvas(),n.noLoop(),n.loadStrings(this.FileURL,s=>{let h=document.createElement("textarea");h.disabled=!0,h.className="infobox",h.setAttribute("style","height: 100%; display: block;"),h.textContent=s.join("\n"),i.appendChild(h),n.TextArea=h},s=>{console.error("\uc5f4\ub78c\ud560 \uc218 \uc5c6\ub294 \ud30c\uc77c: ",s),i.textContent="\uc5f4\ub78c\ud560 \uc218 \uc5c6\ub294 \ud30c\uc77c\uc785\ub2c8\ub2e4.",this.FileInfo.else=!0})}});break;case"disabled":try{yield this.file.writeFile(this.file.externalDataDirectory,`viewer_tmp.${this.FileInfo.file_ext}`,this.blob),this.fileOpener.open(this.file.externalDataDirectory+`viewer_tmp.${this.FileInfo.file_ext}`,this.FileInfo.type||`application/${this.FileInfo.file_ext}`)}catch(n){console.log("open file failed: ",n),this.p5toast.show({text:`${this.lang.text.ChatRoom.cannot_open_file}: ${n.message}`})}}})}open_bottom_modal(){this.ShowContentInfoIonic.onDidDismiss().then(i=>{this.useP5Navigator=!0}),this.useP5Navigator=!1,this.ShowContentInfoIonic.present()}modify_image(){return(0,a.mG)(this,void 0,void 0,function*(){switch(this.FileInfo.viewer){case"image":if(this.FileInfo.url){let s=yield this.loadingCtrl.create({message:this.lang.text.TodoDetail.WIP});s.present();try{let h=yield fetch(this.FileInfo.url).then(d=>d.blob());yield this.indexed.saveBlobToUserPath(h,`tmp_files/external_image_edit/image_download.${this.FileInfo.file_ext}`),this.image_info.path=`tmp_files/external_image_edit/image_download.${this.FileInfo.file_ext}`,this.modalCtrl.dismiss(this.image_info)}catch(h){this.p5toast.show({text:`${this.lang.text.ContentViewer.CannotEditFile}: ${h}`})}s.dismiss()}else this.modalCtrl.dismiss(this.image_info);break;case"text":let i=yield this.loadingCtrl.create({message:this.lang.text.TodoDetail.WIP});i.present(),this.image_info.width=this.p5canvas.TextArea.clientWidth,this.image_info.height=this.p5canvas.TextArea.scrollHeight,this.p5canvas.createCanvas(this.image_info.width,this.image_info.height),this.p5canvas.textSize(16),this.p5canvas.textWrap(this.p5canvas.WORD);let n=.05*this.p5canvas.width;this.p5canvas.text(this.p5canvas.TextArea.textContent,n,n,this.p5canvas.width-2*n),this.p5canvas.saveFrames("","png",1,1,s=>(0,a.mG)(this,void 0,void 0,function*(){try{i.dismiss(),yield this.indexed.saveBase64ToUserPath(s[0].imageData.replace(/"|=|\\/g,""),"tmp_files/text_edit/text_copy.png"),this.image_info.path="tmp_files/text_edit/text_copy.png",this.modalCtrl.dismiss(this.image_info)}catch(h){console.log("\ud30c\uc77c \uc800\uc7a5 \uc624\ub958: ",h)}}));break;case"video":try{let s=yield this.loadingCtrl.create({message:this.lang.text.TodoDetail.WIP});s.present(),this.p5canvas.VideoMedia.pause(),this.p5canvas.createCanvas(this.image_info.width,this.image_info.height),this.p5canvas.image(this.p5canvas.VideoMedia,0,0,this.image_info.width,this.image_info.height),this.p5canvas.saveFrames("","png",1,1,h=>(0,a.mG)(this,void 0,void 0,function*(){try{s.dismiss(),yield this.indexed.saveBase64ToUserPath(h[0].imageData.replace(/"|=|\\/g,""),"tmp_files/video_edit/frame.png"),this.image_info.path="tmp_files/video_edit/frame.png",this.modalCtrl.dismiss(this.image_info)}catch(d){console.log("\ud30c\uc77c \uc800\uc7a5 \uc624\ub958: ",d)}}))}catch(s){console.log("\uc7ac\uc0dd\uc911\uc778 \ube44\ub514\uc624 \uc774\ubbf8\uc9c0 \ucd94\ucd9c \uc624\ub958: ",s)}break;default:console.log("\ud3b8\uc9d1 \ubd88\uac00 \ud30c\uc77c \uc815\ubcf4: ",this.FileInfo)}})}download_file(){"DesktopPWA"==f.n$||"MobilePWA"==f.n$?this.indexed.DownloadFileFromUserPath(this.navParams.get("path"),this.FileInfo.type,this.FileInfo.filename):this.alertCtrl.create({header:this.lang.text.ContentViewer.Filename,inputs:[{name:"filename",placeholder:this.FileInfo.filename,type:"text"}],buttons:[{text:this.lang.text.ContentViewer.saveFile,handler:i=>(0,a.mG)(this,void 0,void 0,function*(){let n=yield this.loadingCtrl.create({message:this.lang.text.TodoDetail.WIP});n.present();let s=i.filename?`${i.filename.replace(/:|\?|\/|\\|<|>/g,"")}.${this.FileInfo.file_ext}`:this.FileInfo.filename,h=yield this.indexed.loadBlobFromUserPath(this.navParams.get("path"),this.FileInfo.type);this.file.writeFile(this.file.externalDataDirectory,s,h).then(d=>{n.dismiss(),this.p5toast.show({text:this.lang.text.ContentViewer.fileSaved})}).catch(d=>{12===(n.dismiss(),d.code)?(this.p5toast.show({text:this.lang.text.ContentViewer.AlreadyExist}),this.download_file()):console.log("\uc900\ube44\ub418\uc9c0 \uc54a\uc740 \uc624\ub958 \ubc18\ud658: ",d)})})}]}).then(i=>i.present())}ShareContent(){let i=this.nakama.rearrange_channels();for(let n=i.length-1;n>=0;n--)("missing"==i[n].status||"offline"==i[n].status)&&i.splice(n,1);i.length?this.modalCtrl.create({component:e.D,componentProps:{file:this.FileInfo,channels:i}}).then(n=>{n.onDidDismiss().then(s=>{s.data&&this.modalCtrl.dismiss()}),n.present()}):this.p5toast.show({text:this.lang.text.ShareContentToOther.NoChannelToShare})}ionViewWillLeave(){return(0,a.mG)(this,void 0,void 0,function*(){if("video"==this.FileInfo.viewer)try{let s,h,n=this.p5canvas.VideoMedia.size();n.width>n.height?(s=192,h=n.height/n.width*192):(s=n.width/n.height*192,h=192),this.p5canvas.createCanvas(s,h),this.p5canvas.image(this.p5canvas.VideoMedia,0,0,s,h),this.p5canvas.fill(255,128),this.p5canvas.rect(0,0,s,h),this.p5canvas.textWrap(this.p5canvas.CHAR),this.p5canvas.textSize(16);let d=h/16;this.p5canvas.push(),this.p5canvas.translate(d/6,d/6),this.p5canvas.fill(0),this.p5canvas.text(this.FileInfo.filename,d,d,s-2*d,h-2*d),this.p5canvas.filter(this.p5canvas.BLUR,3),this.p5canvas.pop(),this.p5canvas.fill(255),this.p5canvas.text(this.FileInfo.filename,d,d,s-2*d,h-2*d),this.p5canvas.saveFrames("","png",1,1,w=>(0,a.mG)(this,void 0,void 0,function*(){try{yield this.indexed.saveBase64ToUserPath(w[0].imageData.replace(/"|=|\\/g,""),`${this.FileInfo.path}_thumbnail.png`),this.global.modulate_thumbnail(this.FileInfo,"")}catch(x){console.log("\uc378\ub124\uc77c \uc800\uc7a5 \uc624\ub958: ",x)}}))}catch(n){console.log("\uc791\uc5c5\uc911 \uc624\ub958\ubcf4\uae30: ",n)}this.p5canvas&&this.p5canvas.remove(),this.FileURL&&URL.revokeObjectURL(this.FileURL),this.file.checkFile(this.file.externalDataDirectory,`viewer_tmp.${this.FileInfo.file_ext}`)&&this.file.removeFile(this.file.externalDataDirectory,`viewer_tmp.${this.FileInfo.file_ext}`)})}copy_url(){this.mClipboard.copy(this.FileInfo.url).catch(i=>V.Z.write(this.FileInfo.url))}}return l.\u0275fac=function(i){return new(i||l)(t.Y36(r.IN),t.Y36(r.X1),t.Y36(L.H),t.Y36(W.b),t.Y36(C.$),t.Y36(E.F),t.Y36(r.Br),t.Y36(r.HT),t.Y36(g.u),t.Y36(P.AN),t.Y36(A.a),t.Y36(Z.T))},l.\u0275cmp=t.Xpm({type:l,selectors:[["app-ionic-viewer"]],viewQuery:function(i,n){if(1&i&&t.Gf(r.ki,5),2&i){let s;t.iGM(s=t.CRH())&&(n.ShowContentInfoIonic=s.first)}},decls:22,vars:5,consts:[["id","Toolbar"],["slot","start",3,"click"],["defaultHref",""],["id","ContentBox"],[1,"main_table_elt"],[2,"height","0"],["id","FileHeader"],["text-wrap",""],["id","menu_trigger"],["name","ellipsis-vertical"],["trigger","menu_trigger","dismissOnSelect",""],["id","p5canvas",1,"full_screen"],["trigger","ShowContentInfoIonic",3,"initialBreakpoint","breakpoints"],["button","",3,"click",4,"ngIf"],["button","","id","ShowContentInfoIonic",3,"click",4,"ngIf"],["button","",3,"click"],["button","","id","ShowContentInfoIonic",3,"click"],[1,"ion-text-end"],[4,"ngFor","ngForOf"],[1,"ion-text-center"],[2,"width","100%","text-align","center"]],template:function(i,n){1&i&&(t.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),t._uU(3),t.qZA(),t.TgZ(4,"ion-buttons",1),t.NdJ("click",function(){return n.modalCtrl.dismiss()}),t._UZ(5,"ion-back-button",2),t.qZA()()(),t.TgZ(6,"ion-content",3)(7,"table",4)(8,"tr",5)(9,"td")(10,"ion-list-header",6)(11,"ion-label",7),t._uU(12),t.qZA(),t.TgZ(13,"ion-button",8),t._UZ(14,"ion-icon",9),t.qZA(),t.TgZ(15,"ion-popover",10),t.YNc(16,G,8,4,"ng-template"),t.qZA()()()(),t.TgZ(17,"tr")(18,"td"),t._UZ(19,"div",11),t.qZA()()(),t.TgZ(20,"ion-modal",12),t.YNc(21,y,19,8,"ng-template"),t.qZA()()),2&i&&(t.xp6(3),t.Oqu(n.lang.text.ContentViewer.Title),t.xp6(9),t.Oqu(n.FileInfo.filename),t.xp6(8),t.Q6J("initialBreakpoint",.5)("breakpoints",t.DdM(4,o)))},directives:[r.Gu,r.sr,r.wd,r.Sm,r.oU,r.cs,r.W2,r.yh,r.Q$,r.YG,r.gu,r.d8,r.q_,k.O5,r.Ie,r.ki,r.rH,k.sg],styles:[".main_table_elt[_ngcontent-%COMP%]{width:100%;height:100%;border:0;margin:0}"]}),l})()},549:(J,M,_)=>{_.d(M,{D:()=>W});var a=_(9863),r=_(5742),f=_(3996),O=_(4606),R=_(9912),e=_(9808);function V(C,E){1&C&&a._UZ(0,"div",11)}function t(C,E){if(1&C&&a._UZ(0,"img",12),2&C){const g=a.oxw().$implicit;a.Akn("online"==g.status||3==g.redirect.type&&"pending"==g.status?"filter: grayscale(0) contrast(1)":"filter: grayscale(.9) contrast(1.4)"),a.Q6J("src",g.info.img,a.LSH)}}function L(C,E){if(1&C){const g=a.EpF();a.TgZ(0,"ion-item",3),a.NdJ("click",function(){const Z=a.CHM(g).$implicit;return a.oxw().go_to_chatroom(Z)}),a.TgZ(1,"div",4),a.YNc(2,V,1,0,"div",5),a.qZA(),a.TgZ(3,"div",6),a.YNc(4,t,1,3,"img",7),a.qZA(),a.TgZ(5,"ion-label")(6,"div",8)(7,"table")(8,"tr")(9,"td"),a._uU(10),a.qZA(),a.TgZ(11,"td",9),a._uU(12),a.qZA()()()(),a.TgZ(13,"div",10),a._uU(14),a.qZA()()()}if(2&C){const g=E.$implicit,P=a.oxw();a.xp6(1),a.Akn("background-color: "+P.statusBar.colors[g.status||"offline"]),a.xp6(1),a.Q6J("ngIf",g.is_new),a.xp6(2),a.Q6J("ngIf",g.info),a.xp6(6),a.hij(" ",g.info?g.info.name||g.info.display_name||P.lang.text.ChatRoom.noname_chatroom:g.title||P.lang.text.ChatRoom.noname_chatroom," "),a.xp6(2),a.hij(" ","("+g.server.target+")"," "),a.xp6(2),a.hij(" ",g.last_comment||g.noti||P.lang.text.Subscribes.noMessageHistory," ")}}let W=(()=>{class C{constructor(g,P,A,Z,k){this.lang=g,this.navParams=P,this.modalCtrl=A,this.statusBar=Z,this.nakama=k}ngOnInit(){this.channels=this.navParams.get("channels")}go_to_chatroom(g){this.nakama.go_to_chatroom_without_admob_act(g,this.navParams.get("file")),this.modalCtrl.dismiss(!0)}}return C.\u0275fac=function(g){return new(g||C)(a.Y36(r.b),a.Y36(f.X1),a.Y36(f.IN),a.Y36(O.g),a.Y36(R.a))},C.\u0275cmp=a.Xpm({type:C,selectors:[["app-share-content-to-other"]],decls:11,vars:3,consts:[["slot","start",3,"click"],["defaultHref",""],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"],[1,"additional_form","status_bar_double"],["class","new_circle",4,"ngIf"],[1,"additional_form","bg_img_form"],["class","profile_img",3,"style","src",4,"ngIf"],[1,"form_margin","header"],[1,"server_target"],[1,"form_margin","content"],[1,"new_circle"],[1,"profile_img",3,"src"]],template:function(g,P){1&g&&(a.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),a._uU(3),a.qZA(),a.TgZ(4,"ion-buttons",0),a.NdJ("click",function(){return P.modalCtrl.dismiss()}),a._UZ(5,"ion-back-button",1),a.qZA()()(),a.TgZ(6,"ion-content")(7,"ion-item-divider")(8,"ion-label"),a._uU(9),a.qZA()(),a.YNc(10,L,15,7,"ion-item",2),a.qZA()),2&g&&(a.xp6(3),a.Oqu(P.lang.text.ShareContentToOther.Title),a.xp6(6),a.Oqu(P.lang.text.ShareContentToOther.AvailableChannels),a.xp6(1),a.Q6J("ngForOf",P.channels))},directives:[f.Gu,f.sr,f.wd,f.Sm,f.oU,f.cs,f.W2,f.rH,f.Q$,e.sg,f.Ie,e.O5],styles:[".server_target[_ngcontent-%COMP%]{color:#888;padding-left:4px}.content[_ngcontent-%COMP%]{color:#888;height:24px;display:table-cell;vertical-align:middle;padding:0 16px}"]}),C})()}}]);