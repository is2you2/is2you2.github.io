"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7749],{7749:(si,h,_)=>{_.r(h),_.d(h,{UserFsDirPageModule:()=>ni});var x=_(9808),F=_(4182),c=_(3996),f=_(9705),a=_(655),v=_(5016),D=_(5087),U=_(774),i=_(9863),T=_(3496),b=_(5742),Z=_(1282),w=_(3336),P=_(2313),I=_(4433);const A=["FileSel"];function C(e,r){if(1&e){const t=i.EpF();i.TgZ(0,"ion-button",10),i.NdJ("click",function(){return i.CHM(t),i.oxw(3).ExportDirectoryRecursive()}),i._uU(1),i.qZA()}if(2&e){const t=i.oxw(3);i.xp6(1),i.hij(" ",t.lang.text.UserFsDir.ExportDir," ")}}function L(e,r){if(1&e){const t=i.EpF();i.TgZ(0,"div")(1,"ion-item",5),i._UZ(2,"ion-icon",6),i.TgZ(3,"ion-label"),i._uU(4,"."),i.qZA(),i.YNc(5,C,2,1,"ion-button",7),i.TgZ(6,"ion-button",8),i.NdJ("click",function(){return i.CHM(t),i.oxw(2).RemoveDirectoryRecursive()}),i._uU(7),i.qZA()(),i.TgZ(8,"ion-item",9),i.NdJ("click",function(){return i.CHM(t),i.oxw(2).MoveToUpDir()}),i._UZ(9,"ion-icon",6),i.TgZ(10,"ion-label"),i._uU(11,".."),i.qZA()()()}if(2&e){const t=i.oxw(2);i.xp6(5),i.Q6J("ngIf",!t.cant_dedicated),i.xp6(2),i.hij(" ",t.lang.text.UserFsDir.RemoveCurrentDir," ")}}function y(e,r){if(1&e){const t=i.EpF();i.TgZ(0,"div")(1,"ion-item",9),i.NdJ("click",function(){return i.CHM(t),i.oxw(3).SelectImportFolder()}),i._UZ(2,"ion-icon",11),i.TgZ(3,"ion-label"),i._uU(4),i.qZA()(),i.TgZ(5,"input",12),i.NdJ("change",function(o){return i.CHM(t),i.oxw(3).inputImageSelected(o)}),i.qZA()()}if(2&e){const t=i.oxw(3);i.xp6(4),i.hij(" ",t.lang.text.UserFsDir.ImportFolder," ")}}function E(e,r){if(1&e){const t=i.EpF();i.TgZ(0,"div")(1,"ion-item",9),i.NdJ("click",function(){return i.CHM(t),i.oxw(3).BrowseExternalFiles()}),i._UZ(2,"ion-icon",11),i.TgZ(3,"ion-label"),i._uU(4),i.qZA()()()}if(2&e){const t=i.oxw(3);i.xp6(4),i.Oqu(t.lang.text.UserFsDir.OpenExtFolder)}}function k(e,r){if(1&e&&(i.TgZ(0,"div"),i.YNc(1,y,6,1,"div",2),i.YNc(2,E,5,1,"div",2),i.qZA()),2&e){const t=i.oxw(2);i.xp6(1),i.Q6J("ngIf",t.cant_dedicated),i.xp6(1),i.Q6J("ngIf",!t.cant_dedicated)}}function J(e,r){if(1&e){const t=i.EpF();i.TgZ(0,"ion-item",9),i.NdJ("click",function(){i.CHM(t);const o=i.oxw().$implicit;return i.oxw(2).SelectFolder(o)}),i._UZ(1,"ion-icon",6),i.TgZ(2,"ion-label"),i._uU(3),i.qZA()()}if(2&e){const t=i.oxw().$implicit;i.xp6(3),i.Oqu(t.name)}}function N(e,r){if(1&e&&(i.TgZ(0,"div"),i.YNc(1,J,4,1,"ion-item",13),i.qZA()),2&e){const t=r.$implicit,n=i.oxw(2);i.xp6(1),i.Q6J("ngIf",n.CurrentDir==t.dir)}}function O(e,r){1&e&&i._UZ(0,"ion-icon",29)}function B(e,r){1&e&&i._UZ(0,"ion-icon",30)}function M(e,r){1&e&&i._UZ(0,"ion-icon",31)}function Y(e,r){1&e&&i._UZ(0,"ion-icon",32)}function Q(e,r){1&e&&i._UZ(0,"ion-icon",33)}function R(e,r){1&e&&i._UZ(0,"ion-icon",34)}function q(e,r){if(1&e&&(i.TgZ(0,"ion-label",35),i._uU(1),i.qZA()),2&e){const t=i.oxw(2).$implicit;i.xp6(1),i.Oqu(t.name)}}function H(e,r){if(1&e&&(i.TgZ(0,"ion-label"),i._uU(1),i.qZA()),2&e){const t=i.oxw(2).$implicit;i.xp6(1),i.Oqu(t.name)}}function S(e,r){if(1&e){const t=i.EpF();i.TgZ(0,"ion-button",36),i.NdJ("click",function(){i.CHM(t);const o=i.oxw(2).$implicit;return i.oxw(2).OpenFile(o)}),i._uU(1),i.qZA()}if(2&e){const t=i.oxw(4);i.xp6(1),i.hij(" ",t.lang.text.UserFsDir.Open," ")}}function $(e,r){if(1&e){const t=i.EpF();i.TgZ(0,"ion-button",36),i.NdJ("click",function(){i.CHM(t);const o=i.oxw(2).$implicit;return i.oxw(2).DownloadFile(o)}),i._uU(1),i.qZA()}if(2&e){const t=i.oxw(4);i.xp6(1),i.hij(" ",t.lang.text.UserFsDir.Download," ")}}function G(e,r){if(1&e){const t=i.EpF();i.TgZ(0,"div",37),i.NdJ("click",function(){i.CHM(t);const o=i.oxw(2).$implicit;return i.oxw(2).OpenFile(o)}),i._UZ(1,"img",38),i.qZA()}if(2&e){const t=i.oxw(2).$implicit;i.xp6(1),i.Q6J("src",t.thumbnail,i.LSH)("alt",t.name)}}function j(e,r){if(1&e){const t=i.EpF();i.TgZ(0,"ion-accordion",15)(1,"ion-item",16),i.YNc(2,O,1,0,"ion-icon",17),i.YNc(3,B,1,0,"ion-icon",18),i.YNc(4,M,1,0,"ion-icon",19),i.YNc(5,Y,1,0,"ion-icon",20),i.YNc(6,Q,1,0,"ion-icon",21),i.YNc(7,R,1,0,"ion-icon",22),i.YNc(8,q,2,1,"ion-label",23),i.YNc(9,H,2,1,"ion-label",2),i.qZA(),i.TgZ(10,"ion-list",24)(11,"ion-item",5)(12,"ion-label"),i._uU(13),i.qZA(),i.YNc(14,S,2,1,"ion-button",25),i.YNc(15,$,2,1,"ion-button",25),i.TgZ(16,"ion-button",26),i.NdJ("click",function(){i.CHM(t);const o=i.oxw(),l=o.$implicit,s=o.index;return i.oxw(2).RemoveFile(l,s)}),i._uU(17),i.qZA()(),i.YNc(18,G,2,2,"div",27),i.TgZ(19,"ion-item",5)(20,"ion-label"),i._uU(21),i.qZA(),i.TgZ(22,"ion-label",28),i._uU(23),i.qZA()()()()}if(2&e){const t=i.oxw().$implicit;i.oxw();const n=i.MAs(5),o=i.oxw();i.Q6J("value",t.path),i.xp6(2),i.Q6J("ngIf","image"==t.viewer),i.xp6(1),i.Q6J("ngIf","audio"==t.viewer),i.xp6(1),i.Q6J("ngIf","video"==t.viewer),i.xp6(1),i.Q6J("ngIf","text"==t.viewer),i.xp6(1),i.Q6J("ngIf","godot"==t.viewer),i.xp6(1),i.Q6J("ngIf","disabled"==t.viewer),i.xp6(1),i.Q6J("ngIf",n.value==t.path),i.xp6(1),i.Q6J("ngIf",n.value!=t.path),i.xp6(4),i.Oqu(o.lang.text.UserFsDir.Action),i.xp6(1),i.Q6J("ngIf","disabled"!=t.viewer&&"image"!=t.viewer),i.xp6(1),i.Q6J("ngIf",o.cant_dedicated),i.xp6(2),i.hij(" ",o.lang.text.UserFsDir.Delete," "),i.xp6(1),i.Q6J("ngIf","image"==t.viewer),i.xp6(3),i.Oqu(o.lang.text.UserFsDir.CreateAt),i.xp6(2),i.Oqu(t.timestamp)}}function z(e,r){if(1&e&&(i.TgZ(0,"div"),i.YNc(1,j,24,16,"ion-accordion",14),i.qZA()),2&e){const t=r.$implicit,n=i.oxw(2);i.xp6(1),i.Q6J("ngIf",n.CurrentDir==t.dir)}}function W(e,r){if(1&e&&(i.TgZ(0,"ion-list"),i.YNc(1,L,12,2,"div",2),i.YNc(2,k,3,2,"div",2),i.YNc(3,N,2,1,"div",3),i.TgZ(4,"ion-accordion-group",null,4),i.YNc(6,z,2,1,"div",3),i.qZA()()),2&e){const t=i.oxw();i.xp6(1),i.Q6J("ngIf",""!=t.CurrentDir),i.xp6(1),i.Q6J("ngIf",""==t.CurrentDir),i.xp6(1),i.Q6J("ngForOf",t.DirList),i.xp6(3),i.Q6J("ngForOf",t.FileList)}}function V(e,r){if(1&e){const t=i.EpF();i.TgZ(0,"ion-item",42),i.NdJ("click",function(){i.CHM(t);const o=i.oxw().$implicit;return i.oxw(2).importFolderMiddleAct(o)}),i._UZ(1,"ion-icon",6),i.TgZ(2,"ion-label"),i._uU(3),i.qZA()()}if(2&e){const t=i.oxw().$implicit;i.xp6(3),i.Oqu(t.name)}}function X(e,r){if(1&e&&(i.TgZ(0,"ion-item",43),i._UZ(1,"ion-icon",34),i.TgZ(2,"ion-label"),i._uU(3),i.qZA()()),2&e){const t=i.oxw().$implicit;i.xp6(3),i.Oqu(t.name)}}function K(e,r){if(1&e&&(i.TgZ(0,"div"),i.YNc(1,V,4,1,"ion-item",40),i.YNc(2,X,4,1,"ion-item",41),i.qZA()),2&e){const t=r.$implicit;i.xp6(1),i.Q6J("ngIf",t.isDirectory),i.xp6(1),i.Q6J("ngIf",t.isFile)}}function ii(e,r){if(1&e){const t=i.EpF();i.TgZ(0,"ion-list")(1,"ion-item",9),i.NdJ("click",function(){return i.CHM(t),i.oxw().InAppBrowser=!0}),i._UZ(2,"ion-icon",6),i.TgZ(3,"ion-label",39),i._uU(4,"/sdcard/Android/data/org.pjcone.portal/files"),i.qZA()(),i.YNc(5,K,3,2,"div",3),i.qZA()}if(2&e){const t=i.oxw();i.xp6(5),i.Q6J("ngForOf",t.ExternalFolder)}}const ti=[{path:"",component:(()=>{class e{constructor(t,n,o,l,s,d,g,p,u,m){this.modalCtrl=t,this.indexed=n,this.loadingCtrl=o,this.lang=l,this.global=s,this.p5toast=d,this.alertCtrl=g,this.sanitizer=p,this.file=u,this.navCtrl=m,this.DirList=[],this.FileList=[],this.cant_dedicated=!1,this.InAppBrowser=!0,this.is_ready=!1,this.EventListenerAct=oi=>{oi.detail.register(110,ri=>{this.is_ready?""==this.CurrentDir?ri():this.MoveToUpDir():(this.initLoadingElement.dismiss(),"UserFsDirPageModule"!=this.modalCtrl.injector.source?this.modalCtrl.dismiss():this.navCtrl.back())})},this.ExternalFolder=[]}ngOnInit(){}ionViewWillEnter(){this.CurrentDir="",this.LoadAllIndexedFiles(),("DesktopPWA"==v.n$||"MobilePWA"==v.n$)&&(this.cant_dedicated=!0),document.addEventListener("ionBackButton",this.EventListenerAct)}LoadAllIndexedFiles(){return(0,a.mG)(this,void 0,void 0,function*(){this.initLoadingElement=yield this.loadingCtrl.create({message:this.lang.text.UserFsDir.LoadingExplorer}),this.initLoadingElement.present(),this.DirList.length=0,this.FileList.length=0,yield this.indexed.GetFileListFromDB("/",t=>(0,a.mG)(this,void 0,void 0,function*(){for(let n=0,o=t.length;n<o;n++)yield this.indexed.GetFileInfoFromDB(t[n],l=>{let s={path:t[n],mode:l.mode,timestamp:new Date(l.timestamp).toLocaleString()};switch(s.name=s.path.substring(s.path.lastIndexOf("/")+1),s.dir=t[n].substring(0,t[n].lastIndexOf("/")),s.mode){case 33206:s.file_ext=s.name.split(".").pop(),this.global.set_viewer_category_from_ext(s),"image"==s.viewer&&this.indexed.loadBlobFromUserPath(s.path,"",d=>{let g=URL.createObjectURL(d);s.thumbnail=this.sanitizer.bypassSecurityTrustUrl(g)}),this.FileList.push(s);break;case 16893:this.DirList.push(s);break;default:console.log("\uc608\uc0c1\ud558\uc9c0 \ubabb\ud55c \ud30c\uc77c \ubaa8\ub4dc: ",s)}});this.FileList.sort((n,o)=>n.path>o.path?1:n.path<o.path?-1:0),this.DirList.sort((n,o)=>n.path>o.path?1:n.path<o.path?-1:0),this.initLoadingElement.dismiss(),this.is_ready=!0}))})}MoveToUpDir(){this.CurrentDir=this.CurrentDir.substring(0,this.CurrentDir.lastIndexOf("/")),this.FileSel.value=void 0}SelectFolder(t){this.CurrentDir=t.path,this.FileSel.value=void 0}OpenFile(t){switch(t.viewer){case"godot":document.removeEventListener("ionBackButton",this.EventListenerAct),this.modalCtrl.create({component:D.r,componentProps:{info:{filename:t.name,file_ext:t.file_ext,type:"",viewer:t.viewer,path:t.path},path:t.path}}).then(n=>{n.onDidDismiss().then(o=>document.addEventListener("ionBackButton",this.EventListenerAct)),n.present()});break;case"disabled":this.p5toast.show({text:this.lang.text.UserFsDir.CannotOpenFile});break;default:document.removeEventListener("ionBackButton",this.EventListenerAct),this.modalCtrl.create({component:U.B,componentProps:{info:{filename:t.name,file_ext:t.file_ext,type:"",viewer:t.viewer,path:t.path},no_edit:!0,path:t.path}}).then(n=>{n.onDidDismiss().then(o=>document.addEventListener("ionBackButton",this.EventListenerAct)),n.present()})}}DownloadFile(t){this.indexed.DownloadFileFromUserPath(t.path,"",t.name)}ExportDirectoryRecursive(){this.alertCtrl.create({header:this.lang.text.UserFsDir.ExportDirTitle,message:this.lang.text.UserFsDir.ExportDirMsg,buttons:[{text:this.lang.text.UserFsDir.ExportConfirm,handler:()=>(0,a.mG)(this,void 0,void 0,function*(){let t=yield this.loadingCtrl.create({message:this.lang.text.UserFsDir.LoadingExplorer});t.present(),this.indexed.GetFileListFromDB(this.CurrentDir,n=>{n.forEach(o=>(0,a.mG)(this,void 0,void 0,function*(){let l=yield this.indexed.GetFileInfoFromDB(o),s=yield this.indexed.loadBlobFromUserPath(o,""),d=o.lastIndexOf("/"),g=o.substring(0,d),p=o.substring(d+1);yield this.CreateFolderRecursive(g);try{if(16893==l.mode)throw"\uc774\uac70 \ud3f4\ub354\uc784";yield this.file.writeFile(this.file.externalDataDirectory+g+"/",p,s,{replace:!0})}catch(u){console.error(o,": \ud30c\uc77c \uc800\uc7a5 \uc2e4\ud328: ",u)}}))}),t.dismiss()})}]}).then(t=>t.present())}CreateFolderRecursive(t){return(0,a.mG)(this,void 0,void 0,function*(){let n=t.lastIndexOf("/")+1,o=t.substring(0,n),l=t.substring(n);yield this.file.createDir(this.file.externalDataDirectory+o,l,!0)})}BrowseExternalFiles(){return(0,a.mG)(this,void 0,void 0,function*(){this.ExternalFolder.length=0,this.InAppBrowser=!1,this.ExternalFolder=yield this.file.listDir(this.file.externalApplicationStorageDirectory,"files"),this.ExternalFolder.sort(),this.ExternalFolder.sort((t,n)=>t.isDirectory?-1:1)})}importFolderMiddleAct(t){return(0,a.mG)(this,void 0,void 0,function*(){let n=yield this.loadingCtrl.create({message:this.lang.text.UserFsDir.LoadingExplorer});n.present(),yield this.importThisFolder(t),this.InAppBrowser=!0,n.dismiss()})}importThisFolder(t){return(0,a.mG)(this,void 0,void 0,function*(){let n=t.nativeURL.substring(0,t.nativeURL.length-1),o=n.lastIndexOf("/"),l=yield this.file.listDir(n.substring(0,o)+"/",n.substring(o+1));for(let s=0,d=l.length;s<d;s++)if(l[s].isDirectory)yield this.importThisFolder(l[s]);else{let g=l[s].nativeURL.split("org.pjcone.portal/files/")[1],p=l[s].nativeURL.lastIndexOf("/")+1,u=l[s].nativeURL.substring(0,p);console.log(g),console.log(u),console.log(l[s].name);try{let m=yield this.file.readAsDataURL(u,l[s].name);console.log("\ubd88\ub7ec\uc624\uae30 \uc131\uacf5: ",m)}catch(m){console.log("\ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",m)}}})}SelectImportFolder(){this.cant_dedicated?document.getElementById("folder_sel_id").click():this.BrowseExternalFiles()}inputImageSelected(t){return(0,a.mG)(this,void 0,void 0,function*(){let n=yield this.loadingCtrl.create({message:this.lang.text.UserFsDir.LoadingExplorer});n.present();for(let o=0,l=t.target.files.length;o<l;o++)yield this.indexed.saveBlobToUserPath(t.target.files[o],t.target.files[o].webkitRelativePath);this.LoadAllIndexedFiles(),n.dismiss()})}RemoveDirectoryRecursive(){this.alertCtrl.create({header:this.CurrentDir.substring(this.CurrentDir.lastIndexOf("/")+1),message:this.lang.text.UserFsDir.RemoveThisFolder,buttons:[{text:this.lang.text.UserFsDir.RemoveApply,handler:()=>{this.indexed.GetFileListFromDB(this.CurrentDir,t=>{t.forEach(n=>(0,a.mG)(this,void 0,void 0,function*(){return yield this.indexed.removeFileFromUserPath(n)}));for(let n=this.DirList.length-1;n>=0;n--)0==this.DirList[n].path.indexOf(this.CurrentDir)&&this.DirList.splice(n,1);for(let n=this.FileList.length-1;n>=0;n--)0==this.FileList[n].path.indexOf(this.CurrentDir)&&this.FileList.splice(n,1);this.MoveToUpDir()})}}]}).then(t=>t.present())}RemoveFile(t,n){this.alertCtrl.create({header:this.lang.text.UserFsDir.DeleteFile,message:this.lang.text.UserFsDir.CannotBeUndo,buttons:[{text:this.lang.text.UserFsDir.DeleteAccept,handler:()=>{this.indexed.removeFileFromUserPath(t.path,()=>{this.FileList.splice(n,1)})}}]}).then(o=>o.present())}ionViewDidLeave(){this.FileList.forEach(t=>{t.thumbnail&&URL.revokeObjectURL(t.thumbnail)})}ionViewWillLeave(){document.removeEventListener("ionBackButton",this.EventListenerAct)}}return e.\u0275fac=function(t){return new(t||e)(i.Y36(c.IN),i.Y36(T.H),i.Y36(c.HT),i.Y36(b.b),i.Y36(Z.AN),i.Y36(w.F),i.Y36(c.Br),i.Y36(P.H7),i.Y36(I.$),i.Y36(c.SH))},e.\u0275cmp=i.Xpm({type:e,selectors:[["app-user-fs-dir"]],viewQuery:function(t,n){if(1&t&&i.Gf(A,5),2&t){let o;i.iGM(o=i.CRH())&&(n.FileSel=o.first)}},decls:9,vars:3,consts:[["slot","start"],["defaultHref","portal/settings"],[4,"ngIf"],[4,"ngFor","ngForOf"],["FileSel",""],["button",""],["slot","start","name","folder"],["style","padding-right: 4px;",3,"click",4,"ngIf"],[3,"click"],["button","",3,"click"],[2,"padding-right","4px",3,"click"],["slot","start","name","arrow-down-circle"],["hidden","","type","file","id","folder_sel_id","webkitdirectory","",3,"change"],["button","",3,"click",4,"ngIf"],[3,"value",4,"ngIf"],[3,"value"],["slot","header"],["slot","start","name","image",4,"ngIf"],["slot","start","name","musical-notes",4,"ngIf"],["slot","start","name","play-circle",4,"ngIf"],["slot","start","name","reader",4,"ngIf"],["slot","start","name","extension-puzzle",4,"ngIf"],["slot","start","name","document",4,"ngIf"],["text-wrap","",4,"ngIf"],["slot","content"],["class","ion-text-right",3,"click",4,"ngIf"],[1,"ion-text-end",3,"click"],["class","image_front_form",3,"click",4,"ngIf"],[1,"ion-text-end"],["slot","start","name","image"],["slot","start","name","musical-notes"],["slot","start","name","play-circle"],["slot","start","name","reader"],["slot","start","name","extension-puzzle"],["slot","start","name","document"],["text-wrap",""],[1,"ion-text-right",3,"click"],[1,"image_front_form",3,"click"],[1,"image_front_view",3,"src","alt"],["color","medium"],["button","","disabled","",3,"click",4,"ngIf"],["button","","disabled","",4,"ngIf"],["button","","disabled","",3,"click"],["button","","disabled",""]],template:function(t,n){1&t&&(i.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),i._uU(3),i.qZA(),i.TgZ(4,"ion-buttons",0),i._UZ(5,"ion-back-button",1),i.qZA()()(),i.TgZ(6,"ion-content"),i.YNc(7,W,7,4,"ion-list",2),i.YNc(8,ii,6,1,"ion-list",2),i.qZA()),2&t&&(i.xp6(3),i.Oqu(n.lang.text.Settings.InAppExplorer),i.xp6(4),i.Q6J("ngIf",n.InAppBrowser),i.xp6(1),i.Q6J("ngIf",!n.InAppBrowser))},directives:[c.Gu,c.sr,c.wd,c.Sm,c.oU,c.cs,c.W2,x.O5,c.q_,c.Ie,c.gu,c.Q$,c.YG,x.sg,c.eh,c.We],styles:[".item.sc-ion-label-md-h[_ngcontent-%COMP%], .item[_ngcontent-%COMP%]   .sc-ion-label-md-h[_ngcontent-%COMP%]{overflow:unset}.image_front_form[_ngcontent-%COMP%]{text-align:center}.image_front_view[_ngcontent-%COMP%]{max-height:233px}"]}),e})()}];let ei=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=i.oAB({type:e}),e.\u0275inj=i.cJS({imports:[[f.Bz.forChild(ti)],f.Bz]}),e})(),ni=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=i.oAB({type:e}),e.\u0275inj=i.cJS({imports:[[x.ez,F.u5,c.Pc,ei]]}),e})()}}]);