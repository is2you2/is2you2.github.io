"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4048],{4048:(H,G,m)=>{m.r(G),m.d(G,{CommunityPageModule:()=>l});var T=m(1368),S=m(4716),I=m(5624),M=m(3332),E=m(1528),A=m(340),n=m(416),b=m(4428),e=m(4496),$=m(4180),U=m(7136),L=m(4500),j=m(5020),K=m(9240),B=m(4668);function V(a,g){if(1&a&&e.wR5(0,"img",18),2&a){const d=e.GaO().$implicit;e.m_g(d.isNSFW?"filter: blur(16px);":""),e.E7m("src",d.mainImage.thumbnail,e.K6U)}}function Y(a,g){if(1&a&&(e.I0R(0,"span",19),e.OEk(1),e.C$Y()),2&a){const d=e.GaO().$implicit,o=e.GaO(2);e.yG2(),e.oRS(" ","("+(d.server?d.server.name||d.server.target:o.lang.text.AddGroup.UseLocalStorage)+")"," ")}}function F(a,g){if(1&a){const d=e.KQA();e.I0R(0,"ion-card",11),e.qCj("click",function(){const s=e.usT(d),c=s.$implicit,i=s.index,P=e.GaO(2);return e.CGJ(P.open_post(c,i))})("contextmenu",function(){const c=e.usT(d).$implicit,i=e.GaO(2);return e.CGJ(i.PostContextMenu(c))}),e.yuY(1,V,1,3,"img",12),e.I0R(2,"ion-card-header")(3,"ion-card-subtitle",13)(4,"span",14),e.qCj("click",function(){const c=e.usT(d).$implicit,i=e.GaO(2);return e.CGJ(i.open_profile(c))}),e.OEk(5),e.C$Y(),e.yuY(6,Y,2,1,"span",15),e.C$Y(),e.I0R(7,"ion-card-title",16),e.OEk(8),e.C$Y()(),e.I0R(9,"ion-card-content",17),e.OEk(10),e.C$Y()()}if(2&a){const d=g.$implicit,o=e.GaO(2);e.yG2(),e.E7m("ngIf",d.mainImage),e.yG2(3),e.m_g("color: #"+d.UserColor),e.yG2(),e.oRS(" ",d.creator_name," "),e.yG2(),e.E7m("ngIf",o.nakama.showServer),e.yG2(2),e.cNF(d.title),e.yG2(2),e.oRS(" ",d.content," ")}}function W(a,g){1&a&&e.wR5(0,"div",20)}function N(a,g){if(1&a&&(e.I0R(0,"div",8),e.yuY(1,F,11,7,"ion-card",9)(2,W,1,0,"div",10),e.C$Y()),2&a){const d=e.GaO();e.yG2(),e.E7m("ngForOf",d.nakama.posts),e.yG2(),e.E7m("ngIf",d.is_auto_load_end&&d.is_loadable)}}function C(a,g){if(1&a){const d=e.KQA();e.I0R(0,"div")(1,"div",21),e.qCj("click",function(){e.usT(d);const s=e.GaO();return e.CGJ(s.add_post())}),e.wR5(2,"ion-icon",22),e.I0R(3,"div")(4,"ion-label",23),e.OEk(5),e.C$Y()()()()}if(2&a){const d=e.GaO();e.yG2(5),e.cNF(d.lang.text.Community.NoPosts)}}const v=[{path:"",component:(()=>{var a;class g{constructor(o,s,c,i,P,p,y,R){this.statusBar=o,this.nakama=s,this.lang=c,this.global=i,this.navCtrl=P,this.indexed=p,this.modalCtrl=y,this.alertCtrl=R,this.is_loadable=!0,this.is_auto_load_end=!1,this.isOpenProfile=!1}ngOnInit(){this.nakama.is_post_lock=!0,this.nakama.CommunityGoToEditPost=this.add_post}add_post(o){this.navCtrl.navigateForward("portal/community/add-post",{state:{data:o,act:!0}})}ionViewDidEnter(){var o=this;return(0,E.c)(function*(){o.is_loadable=!0,yield o.nakama.load_posts_counter(),o.nakama.has_new_post=!1,yield o.load_post_cycles(),o.is_auto_load_end=!0,o.try_add_shortcut(),o.ContentDiv&&o.ContentScroll&&o.ContentDiv.clientHeight-(o.ContentScroll.scrollTop+o.ContentScroll.clientHeight)<1&&o.load_post_cycles(),o.nakama.socket_reactive.try_load_post=()=>{setTimeout(()=>{o.ContentDiv&&o.ContentScroll&&o.ContentDiv.clientHeight-(o.ContentScroll.scrollTop+o.ContentScroll.clientHeight)<1&&o.load_post_cycles()},0)}})()}load_post_cycles(){var o=this;return(0,E.c)(function*(){o.is_loadable&&(yield o.load_posts()),o.is_loadable&&(yield o.load_posts()),setTimeout(()=>{o.ContentDiv||(o.ContentDiv=document.getElementById("CommunityMainContent")),o.ContentScroll||(o.ContentScroll=document.getElementById("CommunityScrollDiv"),o.ContentScroll.onscroll=s=>{o.ContentDiv.clientHeight-(o.ContentScroll.scrollTop+o.ContentScroll.clientHeight)<1&&o.load_post_cycles()}),o.is_loadable&&o.ContentDiv.clientHeight-(o.ContentScroll.scrollTop+o.ContentScroll.clientHeight)<1&&o.load_post_cycles()},100)})()}PostContextMenu(o){let s;for(let c=0,i=this.nakama.posts.length;c<i;c++)if(this.nakama.posts[c].id==o.id){s=c;break}try{(this.nakama.posts[s].server.local||this.nakama.posts[s].creator_id==this.nakama.servers[this.nakama.posts[s].server.isOfficial][this.nakama.posts[s].server.target].session.user_id)&&this.alertCtrl.create({header:this.nakama.posts[s].title,message:this.nakama.posts[s].content,buttons:[{text:this.lang.text.ChatRoom.EditChat,handler:()=>{this.nakama.EditPost(this.nakama.posts[s])}},{text:this.lang.text.ChatRoom.Delete,handler:()=>{this.nakama.RemovePost(this.nakama.posts[s])},cssClass:"redfont"}]}).then(c=>c.present())}catch{}return!1}try_add_shortcut(){this.global.p5key&&this.global.p5key.KeyShortCut?this.AddShortcut():setTimeout(()=>{this.try_add_shortcut()},100)}load_posts(){var o=this;return(0,E.c)(function*(){let s=!1,c=Object.keys(o.nakama.post_counter);for(let i=0,P=c.length;i<P;i++){let p=Object.keys(o.nakama.post_counter[c[i]]);for(let y=0,R=p.length;y<R;y++){let O=Object.keys(o.nakama.post_counter[c[i]][p[y]]);for(let _=0,r=O.length;_<r;_++){let h="me"==O[_];try{"me"!=O[_]&&(h=O[_]==o.nakama.servers[c[i]][p[y]].session.user_id)}catch{}let f=o.nakama.post_counter[c[i]][p[y]][O[_]];yield o.load_post_step_by_step(f,c[i],p[y],O[_],h),!s&&o.nakama.post_counter[c[i]][p[y]][O[_]]>=0&&(s=!0)}}}o.is_loadable=s,o.nakama.rearrange_posts()})()}load_post_step_by_step(o,s,c,i,P){var p=this;return(0,E.c)(function*(){if(o<0)return;let y=yield p.nakama.load_local_post_with_id(`LocalPost_${o}`,s,c,i);if(!y&&"me"!=i)try{y=yield p.nakama.load_server_post_with_id(`ServerPost_${o}`,s,c,i,P)}catch{}p.nakama.post_counter[s][c][i]--,y||(yield p.load_post_step_by_step(p.nakama.post_counter[s][c][i],s,c,i,P))})()}open_profile(o){if(this.isOpenProfile=!0,"me"==o.creator_id)this.modalCtrl.create({component:A.w}).then(s=>s.present());else{let s=o.server.isOfficial,c=o.server.target,i=o.creator_id;o.is_me?this.modalCtrl.create({component:A.w,componentProps:{isOfficial:s,target:c}}).then(P=>P.present()):this.modalCtrl.create({component:b.y,componentProps:{info:{user:this.nakama.load_other_user(i,s,c)},group:{server:{isOfficial:s,target:c}}}}).then(P=>P.present())}setTimeout(()=>{this.isOpenProfile=!1},0)}open_post(o,s){this.isOpenProfile||(this.isOpenProfile=!0,this.modalCtrl.create({component:n.S,componentProps:{data:o,index:s+1}}).then(c=>{delete this.global.p5key.KeyShortCut.Digit,delete this.global.p5key.KeyShortCut.AddAct,c.onDidDismiss().then(i=>{i.data||this.AddShortcut()}),c.present()}),setTimeout(()=>{this.isOpenProfile=!1},0))}AddShortcut(){this.global.p5key&&this.global.p5key.KeyShortCut&&(this.global.p5key.KeyShortCut.Digit=o=>{this.nakama.posts.length>o?this.open_post(this.nakama.posts[o],o):this.add_post()}),this.global.p5key&&this.global.p5key.KeyShortCut&&!this.global.p5key.KeyShortCut.AddAct&&(this.global.p5key.KeyShortCut.AddAct=()=>{this.add_post()})}ionViewWillLeave(){delete this.global.p5key.KeyShortCut.Digit,delete this.global.p5key.KeyShortCut.AddAct,delete this.nakama.socket_reactive.try_load_post,this.nakama.is_post_lock=!1}}return(a=g).\u0275fac=function(o){return new(o||a)(e.GI1($.Y),e.GI1(U.h),e.GI1(L.o),e.GI1(j.A1),e.GI1(K.wX),e.GI1(B.k),e.GI1(I.qS),e.GI1(I.iW))},a.\u0275cmp=e.In1({type:a,selectors:[["app-community"]],decls:12,vars:5,consts:[[1,"ion-no-border"],[1,"add_post",3,"click"],["button","","name","add-circle-outline",2,"width","24px","height","24px"],[1,"header_online_circle",3,"click"],["id","CommunityScrollDiv",2,"height","100%","overflow-y","auto"],["id","CommunityMainContent"],["style","display: ruby-text","class","CardContainerDiv",4,"ngIf"],[4,"ngIf"],[1,"CardContainerDiv",2,"display","ruby-text"],["button","","class","card_style",3,"click","contextmenu",4,"ngFor","ngForOf"],["style","width:100%; height: 72px;",4,"ngIf"],["button","",1,"card_style",3,"click","contextmenu"],["class","thumbnail_image","alt","",3,"src","style",4,"ngIf"],[1,"cardCreator"],[3,"click"],["style","color: #888; font-weight: normal;",4,"ngIf"],[1,"cardTitle"],[1,"cardContent"],["alt","",1,"thumbnail_image",3,"src"],[2,"color","#888","font-weight","normal"],[2,"width","100%","height","72px"],[1,"disconnect_info",3,"click"],["color","medium","name","document-text-outline",2,"width","60px","height","60px"],["color","medium"]],template:function(o,s){1&o&&(e.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),e.OEk(3),e.C$Y(),e.I0R(4,"div",1),e.qCj("click",function(){return s.add_post()}),e.wR5(5,"ion-icon",2),e.C$Y(),e.I0R(6,"div",3),e.qCj("click",function(){return s.nakama.toggle_all_session(!0)}),e.C$Y()()(),e.I0R(7,"ion-content")(8,"div",4)(9,"div",5),e.yuY(10,N,3,2,"div",6)(11,C,6,1,"div",7),e.C$Y()()()),2&o&&(e.yG2(3),e.cNF(s.lang.text.Community.Title),e.yG2(3),e.m_g("background-color: "+s.statusBar.colors[s.statusBar.settings.groupServer]+"; cursor: pointer;"),e.yG2(4),e.E7m("ngIf",s.nakama.posts.length),e.yG2(),e.E7m("ngIf",!s.nakama.posts.length))},dependencies:[T.ay,T.u_,I.KC,I.Gg,I.YY,I.MN,I.I7,I._i,I.wB,I.Ko,I.QR,I.tM,I.Md],styles:[".md[_ngcontent-%COMP%]   .add_post[_ngcontent-%COMP%]{position:absolute;right:68px;top:16px;cursor:pointer}.ios[_ngcontent-%COMP%]   .add_post[_ngcontent-%COMP%]{position:absolute;right:68px;top:10px;cursor:pointer}.md[_ngcontent-%COMP%]   .CardContainerDiv[_ngcontent-%COMP%]{padding-top:14px}.ios[_ngcontent-%COMP%]   .CardContainerDiv[_ngcontent-%COMP%]{padding-top:20px}.card_style[_ngcontent-%COMP%]{width:90%;max-width:400px;margin-top:0}.md[_ngcontent-%COMP%]   .cardCreator[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;font-weight:700;max-height:20px;overflow-y:hidden}.md[_ngcontent-%COMP%]   .cardTitle[_ngcontent-%COMP%]{max-height:24px;overflow-y:hidden}.md[_ngcontent-%COMP%]   .cardContent[_ngcontent-%COMP%]{max-height:40px;overflow-y:hidden;padding-bottom:0;margin-bottom:13px}.ios[_ngcontent-%COMP%]   .cardCreator[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;font-weight:700;max-height:20px;overflow-y:hidden}.ios[_ngcontent-%COMP%]   .cardTitle[_ngcontent-%COMP%]{max-height:34px;overflow-y:hidden}.ios[_ngcontent-%COMP%]   .cardContent[_ngcontent-%COMP%]{max-height:40px;overflow-y:hidden;padding-bottom:0;margin-bottom:13px}.thumbnail_image[_ngcontent-%COMP%]{width:100%;max-height:240px;object-fit:cover}"]}),g})()},{path:"add-post",loadChildren:()=>Promise.all([m.e(1052),m.e(1592)]).then(m.bind(m,1592)).then(a=>a.AddPostPageModule)},{path:"post-viewer",loadChildren:()=>m.e(9368).then(m.bind(m,9368)).then(a=>a.PostViewerPageModule)}];let t=(()=>{var a;class g{}return(a=g).\u0275fac=function(o){return new(o||a)},a.\u0275mod=e.a4G({type:a}),a.\u0275inj=e.s3X({imports:[M.qQ.forChild(v),M.qQ]}),g})(),l=(()=>{var a;class g{}return(a=g).\u0275fac=function(o){return new(o||a)},a.\u0275mod=e.a4G({type:a}),a.\u0275inj=e.s3X({imports:[T.MD,S.y,I.wZ,t]}),g})()},416:(H,G,m)=>{m.d(G,{S:()=>N});var T=m(1528),S=m(9352),M=m(3664),E=m(340),A=m(4428),n=m(4496),b=m(5624),e=m(9240),$=m(4500),U=m(4668),L=m(7136),j=m(5020),K=m(1368);function B(C,w){if(1&C){const v=n.KQA();n.I0R(0,"ion-icon",10),n.qCj("click",function(){n.usT(v);const l=n.GaO();return n.CGJ(l.ChangeToAnother(-1))}),n.C$Y()}}function V(C,w){if(1&C&&(n.I0R(0,"ion-label",11),n.OEk(1),n.C$Y()),2&C){const v=n.GaO();n.yG2(),n.cNF(v.CurrentIndex+" / "+v.nakama.posts.length)}}function Y(C,w){if(1&C){const v=n.KQA();n.I0R(0,"ion-icon",12),n.qCj("click",function(){n.usT(v);const l=n.GaO();return n.CGJ(l.ChangeToAnother(1))}),n.C$Y()}}function F(C,w){if(1&C&&n.wR5(0,"img",13),2&C){const v=n.GaO();n.E7m("src",v.PostInfo.mainImage.MainThumbnail,n.K6U)}}function W(C,w){if(1&C){const v=n.KQA();n.I0R(0,"ion-footer")(1,"table",14)(2,"tr")(3,"td")(4,"ion-button",15),n.qCj("click",function(){n.usT(v);const l=n.GaO();return n.CGJ(l.EditPost())}),n.OEk(5),n.C$Y()(),n.I0R(6,"td")(7,"ion-button",16),n.qCj("click",function(){n.usT(v);const l=n.GaO();return n.CGJ(l.RemovePost())}),n.OEk(8),n.C$Y()()()()()}if(2&C){const v=n.GaO();n.yG2(5),n.oRS(" ",v.lang.text.AddPost.EditTitle," "),n.yG2(3),n.oRS(" ",v.lang.text.PostViewer.RemovePost," ")}}let N=(()=>{var C;class w{constructor(t,l,a,g,d,o,s){this.modalCtrl=t,this.navParam=l,this.lang=a,this.indexed=g,this.nakama=d,this.alertCtrl=o,this.global=s,this.isOwner=!1,this.HavePosts=!1,this.CurrentIndex=1,this.BackButtonPressed=!1,this.blenderViewers=[],this.FileURLs=[],this.PlayableElements=[],this.blockShortcut=!1,this.ContentChanging=!1}ngOnInit(){this.PostInfo=this.navParam.get("data"),this.CurrentIndex=this.navParam.get("index"),this.initialize()}ionViewWillEnter(){window.history.pushState(null,null,window.location.href),window.onpopstate=()=>{this.BackButtonPressed||(this.BackButtonPressed=!0,this.modalCtrl.dismiss())}}ChangeContentWithKeyInput(){if(this.p5canvas){this.p5canvas.keyPressed=g=>{if(!this.blockShortcut)switch(g.code){case"KeyA":case"ArrowLeft":this.ChangeToAnother(-1);break;case"KeyD":case"ArrowRight":this.ChangeToAnother(1)}};let t=this.p5canvas.createVector(),l={};this.p5canvas.touchStarted=g=>{if("changedTouches"in g){for(let o=0,s=g.changedTouches.length;o<s;o++)l[g.changedTouches[o].identifier]=this.p5canvas.createVector(g.changedTouches[o].clientX,g.changedTouches[o].clientY);1===Object.keys(l).length&&(t=l[g.changedTouches[0].identifier].copy())}};const a=100;this.p5canvas.touchEnded=g=>{if("changedTouches"in g){let d;for(let s=0,c=g.changedTouches.length;s<c;s++)d=this.p5canvas.createVector(g.changedTouches[s].clientX,g.changedTouches[s].clientY),delete l[g.changedTouches[s].identifier];0===Object.keys(l).length&&(d.sub(t),d.x>a?this.ChangeToAnother(-1):d.x<-a&&this.ChangeToAnother(1))}}}}initialize(){if(this.PostInfo.mainImage)try{let t=this.PostInfo.mainImage.url;t||(t=URL.createObjectURL(this.PostInfo.mainImage.blob),setTimeout(()=>{URL.revokeObjectURL(t)},100)),this.PostInfo.mainImage.MainThumbnail=t}catch{}this.create_content();try{this.isOwner="me"==this.PostInfo.creator_id||this.PostInfo.creator_id==this.nakama.servers[this.PostInfo.server.isOfficial][this.PostInfo.server.target].session.user_id}catch{this.isOwner=!1}this.HavePosts=this.nakama.posts.length>1,this.ChangeContentWithKeyInput()}ChangeToAnother(t){if(this.ContentChanging)return;this.ContentChanging=!0;let l=this.CurrentIndex+t;l<=0||l>this.nakama.posts.length||(this.p5canvas&&this.p5canvas.remove(),this.CurrentIndex=l,this.PostInfo=this.nakama.posts[this.CurrentIndex-1],this.initialize()),this.ContentChanging=!1}create_content(){var t=this;let l=document.getElementById("PostContent");this.p5canvas=new S(a=>{a.setup=(0,T.c)(function*(){a.noCanvas();let g=a.createDiv(t.PostInfo.title);g.style("font-size","32px"),g.style("font-weight","bold"),g.parent(l);let d=a.createDiv();d.style("color","#888"),d.parent(l),a.createDiv(`${t.lang.text.PostViewer.CreateTime}: ${new Date(t.PostInfo.create_time).toLocaleString()}`).parent(d),t.PostInfo.create_time!=t.PostInfo.modify_time&&a.createDiv(`${t.lang.text.PostViewer.ModifyTime}: ${new Date(t.PostInfo.modify_time).toLocaleString()}`).parent(d);let s=a.createDiv();s.style("padding-bottom","8px"),s.parent(l);let c=a.createSpan(t.PostInfo.creator_name);if(c.style("color",`#${t.PostInfo.UserColor}`),c.style("font-weight","bold"),c.style("font-size","17px"),c.style("cursor","pointer"),c.elt.onclick=()=>{if("me"==t.PostInfo.creator_id)t.modalCtrl.create({component:E.w}).then(i=>i.present());else{let i=t.PostInfo.server.isOfficial,P=t.PostInfo.server.target,p=t.PostInfo.creator_id;p==t.nakama.servers[i][P].session.user_id?t.modalCtrl.create({component:E.w,componentProps:{isOfficial:i,target:P}}).then(y=>y.present()):t.modalCtrl.create({component:A.y,componentProps:{info:{user:t.nakama.load_other_user(p,i,P)},group:{server:{isOfficial:i,target:P}}}}).then(y=>y.present())}},c.parent(s),t.PostInfo.server.local)for(let i=0,P=t.PostInfo.attachments.length;i<P;i++)try{let p=yield t.indexed.loadBlobFromUserPath(t.PostInfo.attachments[i].path,t.PostInfo.attachments[i].type);t.PostInfo.attachments[i].blob=p}catch{}else for(let i=0,P=t.PostInfo.attachments.length;i<P;i++)try{t.PostInfo.attachments[i].alt_path=`servers/${t.PostInfo.server.isOfficial}/${t.PostInfo.server.target}/posts/${t.PostInfo.creator_id}/${t.PostInfo.id}/[${i}]${t.PostInfo.attachments[i].filename}`;let p=yield t.nakama.sync_load_file(t.PostInfo.attachments[i],t.PostInfo.server.isOfficial,t.PostInfo.server.target,"server_post",t.PostInfo.creator_id,`${t.PostInfo.id}_attach_${i}`,!1);t.PostInfo.attachments[i].blob=p.value}catch{}if(t.PostInfo.content){let i=t.PostInfo.content.split("\n"),P=[];for(let p=0,y=i.length;p<y;p++){let R=!1,O=i[p].length-1,_=0;try{_=Number(i[p].substring(1,O)),R="["==i[p].charAt(0)&&"]"==i[p].charAt(O)&&!isNaN(_)}catch{}if(R)switch(t.PostInfo.attachments[_].viewer){case"image":{let r=t.PostInfo.attachments[_].url;if(!r)try{r=URL.createObjectURL(t.PostInfo.attachments[_].blob),setTimeout(()=>{URL.revokeObjectURL(r)},100)}catch(f){console.log("\uac8c\uc2dc\ubb3c image \ucca8\ubd80\ud30c\uc77c \ubd88\ub7ec\uc624\uae30 \uc624\ub958: ",f)}let h=a.createImg(r,`${_}`);h.style("cursor","pointer"),h.elt.onclick=()=>{let f=[];for(let u=0,k=t.PostInfo.attachments.length;u<k;u++)f.push({content:t.PostInfo.attachments[u]});t.modalCtrl.create({component:M.K,componentProps:{info:{content:t.PostInfo.attachments[_]},path:t.PostInfo.attachments[_].path,relevance:f,noEdit:!0},cssClass:"fullscreen"}).then(u=>{u.onDidDismiss().then(k=>{t.blockShortcut=!1,k.data&&k.data.share&&t.modalCtrl.dismiss()}),t.blockShortcut=!0,u.present()})},h.parent(l)}break;case"audio":{let r=t.PostInfo.attachments[_].url;if(!r)try{r=URL.createObjectURL(t.PostInfo.attachments[_].blob),t.FileURLs.push(r)}catch(f){console.log("\uac8c\uc2dc\ubb3c audio \ucca8\ubd80\ud30c\uc77c \ubd88\ub7ec\uc624\uae30 \uc624\ub958: ",f)}let h=a.createAudio([r]);h.showControls(),h.elt.onplay=()=>{for(let f=0,u=t.PlayableElements.length;f<u;f++)try{f!=_&&t.PlayableElements[f].pause()}catch{}},h.parent(l),t.PlayableElements[_]=h.elt}break;case"video":{let r=t.PostInfo.attachments[_].url;if(!r)try{r=URL.createObjectURL(t.PostInfo.attachments[_].blob),t.FileURLs.push(r)}catch(f){console.log("\uac8c\uc2dc\ubb3c video \ucca8\ubd80\ud30c\uc77c \ubd88\ub7ec\uc624\uae30 \uc624\ub958: ",f)}let h=a.createVideo([r]);h.style("width","100%"),h.style("height","auto"),h.showControls(),h.parent(l),t.PlayableElements[_]=h.elt}break;case"godot":{let r=`PostViewer_godot_pck_${_}`,h=a.createDiv();h.id(r),h.style("width","100%"),h.style("height","432px"),h.parent(l),setTimeout((0,T.c)(function*(){let f=!1;if(t.indexed.godotDB)try{yield t.indexed.GetGodotIndexedDB(),yield t.indexed.saveBlobToUserPath(t.PostInfo.attachments[_].blob,`tmp_files/duplicate/${t.PostInfo.attachments[_].filename}`,void 0,t.indexed.godotDB),f=!0}catch(u){console.log("\ub0b4\ubd80 \ud30c\uc77c \uc5c6\uc74c: ",u)}if(yield t.global.CreateGodotIFrame(r,{path:`tmp_files/duplicate/${t.PostInfo.attachments[_].filename}`,url:t.PostInfo.attachments[_].url},"start_load_pck",!0),!f){try{let u=yield t.indexed.loadBlobFromUserPath(t.PostInfo.attachments[_].path,"",void 0,t.indexed.ionicDB);yield t.indexed.GetGodotIndexedDB(),yield t.indexed.saveBlobToUserPath(u,`tmp_files/duplicate/${t.PostInfo.attachments[_].filename}`,void 0,t.indexed.godotDB)}catch{}yield t.global.CreateGodotIFrame(r,{path:`tmp_files/duplicate/${t.PostInfo.attachments[_].filename}`,url:t.PostInfo.attachments[_].url},"start_load_pck",!0)}t.PostInfo.attachments[_].url?t.global.godot_window.download_url():t.global.godot_window.start_load_pck()}),100)}break;case"blender":{let r=a.createDiv();r.style("position","relative"),r.style("width","100%"),r.style("height","432px"),r.elt.onwheel=()=>!1,r.elt.oncontextmenu=()=>!1,r.parent(l);let h=t.global.load_blender_file(r.elt,t.PostInfo.attachments[_],void 0,()=>{},()=>{});t.blenderViewers.push(h)}break;default:{let r=a.createDiv();r.style("width","160px"),r.style("height","112px"),r.style("overflow","hidden"),r.style("background-color","grey"),r.style("margin-top","4px"),r.style("border-radius","8px"),r.style("cursor","pointer"),r.parent(l);let h=a.createP(t.PostInfo.attachments[_].filename);h.style("margin","0px 4px"),h.style("text-align","start"),h.parent(r);let f=a.createDiv();f.style("background-color","white"),f.style("margin-top","2px"),f.style("position","relative"),f.style("width","100%"),f.style("height","2px"),f.parent(r);let u=a.createSpan(t.lang.text.PostViewer.OpenFromViewer);u.style("margin","2px 4px 0px 4px"),u.style("text-align","start"),u.style("display","grid"),u.parent(r),r.elt.onclick=()=>{let k=[];for(let x=0,D=t.PostInfo.attachments.length;x<D;x++)k.push({content:t.PostInfo.attachments[x]});t.modalCtrl.create({component:M.K,componentProps:{info:{content:t.PostInfo.attachments[_]},path:t.PostInfo.attachments[_].path,relevance:k,noEdit:!0},cssClass:"fullscreen"}).then(x=>{x.onDidDismiss().then(()=>{t.blockShortcut=!1}),t.blockShortcut=!0,x.present()})}}}else try{let r=JSON.parse(i[p]),h=a.createDiv(`[${r.i}] ${t.PostInfo.attachments[r.i].filename} (${r.t})`);h.style("background-color","#8888"),h.style("width","fit-content"),h.style("height","fit-content"),h.style("border-radius","16px"),h.style("padding","8px 16px"),h.style("cursor","pointer"),h.parent(l),P.push(()=>{let f=t.PlayableElements[r.i],u=r.t.split(":"),k=0,x=1;for(let D=u.length-1;D>=0;D--){let z=Number(u.pop());k+=z*x,x*=60}h.elt.onclick=()=>{try{f.currentTime=k,f.play()}catch{}}})}catch{let h=a.createDiv();h.parent(l);let f=i[p].split(" ");for(let u=0,k=f.length;u<k;u++)if(0==f[u].indexOf("http:")||0==f[u].indexOf("https:")){let x=a.createA(f[u],f[u]);x.attribute("target","_system"),x.parent(h),a.createSpan("&nbsp").parent(h)}else a.createSpan(f[u]+"&nbsp").parent(h)}}for(let p=0,y=P.length;p<y;p++)P[p]()}})})}EditPost(){this.modalCtrl.dismiss({edit:!0}),this.nakama.EditPost(this.PostInfo)}RemovePost(){var l,t=this;this.alertCtrl.create({header:this.lang.text.PostViewer.RemovePost,message:this.lang.text.ChatRoom.CannotUndone,buttons:[{text:this.lang.text.ChatRoom.Delete,cssClass:"redfont",handler:(l=(0,T.c)(function*(){yield t.nakama.RemovePost(t.PostInfo),t.modalCtrl.dismiss()}),function(){return l.apply(this,arguments)})}]}).then(l=>l.present())}ngOnDestroy(){for(let t=0,l=this.FileURLs.length;t<l;t++)URL.revokeObjectURL(this.FileURLs[t]);for(let t=0,l=this.blenderViewers.length;t<l;t++)this.blenderViewers[t].remove();this.p5canvas&&this.p5canvas.remove()}}return(C=w).\u0275fac=function(t){return new(t||C)(n.GI1(b.qS),n.GI1(e.a6),n.GI1($.o),n.GI1(U.k),n.GI1(L.h),n.GI1(b.iW),n.GI1(j.A1))},C.\u0275cmp=n.In1({type:C,selectors:[["app-post-viewer"]],decls:13,vars:7,consts:[[1,"ion-no-border"],["slot","start",3,"click"],["defaultHref",""],["class","relevance_change","style","padding-right: 4px;","slot","end","name","arrow-back-circle-outline",3,"click",4,"ngIf"],["slot","end",4,"ngIf"],["class","relevance_change","style","padding-right: 16px; padding-left: 4px;","slot","end","name","arrow-forward-circle-outline",3,"click",4,"ngIf"],[3,"fullscreen"],["style","width: 100%; height: auto;","alt","MainImage",3,"src",4,"ngIf"],["id","PostContent",2,"padding","16px"],[4,"ngIf"],["slot","end","name","arrow-back-circle-outline",1,"relevance_change",2,"padding-right","4px",3,"click"],["slot","end"],["slot","end","name","arrow-forward-circle-outline",1,"relevance_change",2,"padding-right","16px","padding-left","4px",3,"click"],["alt","MainImage",2,"width","100%","height","auto",3,"src"],[2,"width","100%","background-color","black"],["expand","block",3,"click"],["color","danger","expand","block",3,"click"]],template:function(t,l){1&t&&(n.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),n.OEk(3),n.C$Y(),n.I0R(4,"ion-buttons",1),n.qCj("click",function(){return l.modalCtrl.dismiss()}),n.wR5(5,"ion-back-button",2),n.C$Y(),n.yuY(6,B,1,0,"ion-icon",3)(7,V,2,1,"ion-label",4)(8,Y,1,0,"ion-icon",5),n.C$Y()(),n.I0R(9,"ion-content",6),n.yuY(10,F,1,1,"img",7),n.wR5(11,"div",8),n.C$Y(),n.yuY(12,W,9,2,"ion-footer",9)),2&t&&(n.yG2(3),n.cNF(l.lang.text.PostViewer.Title),n.yG2(3),n.E7m("ngIf",l.HavePosts),n.yG2(),n.E7m("ngIf",l.HavePosts),n.yG2(),n.E7m("ngIf",l.HavePosts),n.yG2(),n.E7m("fullscreen",!0),n.yG2(),n.E7m("ngIf",l.PostInfo.mainImage&&l.PostInfo.mainImage.MainThumbnail),n.yG2(2),n.E7m("ngIf",l.isOwner))},dependencies:[K.u_,b.sn,b.GS,b._i,b.eV,b.wB,b.Ko,b.QR,b.tM,b.Md,b.Im],styles:[".relevance_change[_ngcontent-%COMP%]{width:25px;height:25px}"]}),w})()}}]);