"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5966],{5966:(y,u,a)=>{a.r(u),a.d(u,{DedicatedSettingsPageModule:()=>k});var f=a(9808),c=a(4182),o=a(3996),g=a(501),p=a(6505),e=a(2096),l=a(5016);let v=(()=>{class i{constructor(){this.users={},this.funcs={onStart:s=>console.warn("onStart \ud568\uc218 \uc5c6\uc74c: ",s),onCheck:s=>console.warn("onCheck \ud568\uc218 \uc5c6\uc74c: ",s),onFailed:s=>console.error("onFailed \ud568\uc218 \uc5c6\uc74c: ",s)}}initialize(){"DesktopPWA"!=l.n$&&"MobilePWA"!=l.n$?(this.server||(this.server=cordova.plugins.wsserver),this.server.start(12011,{onFailure:(t,n,r)=>{this.funcs.onFailed(`Stopped listening on ${t}:${n}. Reason: ${r}`)},onOpen:t=>{this.users[t.uuid]={address:this.users[t.remoteAddr]},Object.keys(this.users).forEach(n=>{this.send_to(n,`Counter:${Object.keys(this.users).length}`)})},onMessage:(t,n)=>{try{let r=JSON.parse(n);"join"==r.type&&(this.users[t.uuid].uid=r.uid,this.users[t.uuid].name=r.name)}catch(r){console.error(`json \ubcc0\ud658 \uc624\ub958_${n}: ${r}`)}Object.keys(this.users).forEach(r=>{this.send_to(r,n)})},onClose:(t,n,r,h)=>{let P=this.users[t.uuid].uid,D=this.users[t.uuid].name;delete this.users[t.uuid];let M={uid:P,name:D,type:"leave",count:Object.keys(this.users).length},T=JSON.stringify(M);Object.keys(this.users).forEach(Z=>{this.send_to(Z,T)})},origins:[],protocols:[],tcpNoDelay:!0},(t,n)=>{this.funcs.onStart("")},t=>{this.funcs.onFailed(`Did not start. Reason: ${t}`)})):this.funcs.onFailed("Did not start. Reason: \ud50c\ub7ab\ud3fc \ubd88\uc77c\uce58: \uc0ac\uc124 \uc11c\ubc84 \uad6c\ucd95 \ucde8\uc18c")}check_addresses(){"DesktopPWA"!=l.n$&&"MobilePWA"!=l.n$&&(this.server||(this.server=cordova.plugins.wsserver),this.server.getInterfaces(s=>{this.funcs.onCheck(s)}))}disconnect_peer(s,t=4e3,n="EMPTY"){this.server.close({uuid:s},t,n)}stop(){"DesktopPWA"!=l.n$&&"MobilePWA"!=l.n$&&this.server.stop((s,t)=>{this.funcs.onFailed(`Stopped listening on ${t}`)})}send_to(s,t){this.server.send({uuid:s},t)}}return i.\u0275fac=function(s){return new(s||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var m=a(4606),S=a(5742);const A=[{path:"",component:(()=>{class i{constructor(s,t,n){this.server=s,this.statusBar=t,this.lang=n,this.addresses=this.lang.text.UseAsServer.LoadingAddresses,this.block={groupchat:!1,webremote:!1}}ngOnInit(){new p(s=>{s.setup=()=>{s.loadStrings(`assets/data/infos/${this.lang.lang}/dedicated.txt`,t=>{this.info=t.join("\n"),s.remove()},t=>{console.error("\uc0ac\uc124\uc11c\ubc84 \uc124\uc815 \ud30c\uc77c \ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",t),s.remove()})}}),this.server.funcs.onCheck=s=>{let t=Object.keys(s),n=[];t.forEach(r=>{s[r].ipv4Addresses.length&&s[r].ipv4Addresses.forEach(h=>{n.push(`${h} (${r})`)})}),this.addresses=n.length?n.join("\n"):this.lang.text.UseAsServer.NoAddress},this.server.check_addresses()}block_button(s){this.block[s]=!0,setTimeout(()=>{this.block[s]=!1},2e3)}start_minimalserver(){"offline"==this.statusBar.dedicated.official.groupchat?(this.block_button("groupchat"),this.statusBar.settings.dedicatedServer="pending",this.statusBar.dedicated.official.groupchat="pending",this.server.funcs.onStart=()=>{this.statusBar.settings.dedicatedServer="online",this.statusBar.dedicated.official.groupchat="online"},this.server.funcs.onFailed=()=>{this.statusBar.settings.dedicatedServer="missing",this.statusBar.dedicated.official.groupchat="missing",setTimeout(()=>{this.statusBar.settings.dedicatedServer="offline",this.statusBar.dedicated.official.groupchat="offline"},1500)},this.server.initialize()):(this.block_button("groupchat"),this.server.stop())}}return i.\u0275fac=function(s){return new(s||i)(e.Y36(v),e.Y36(m.g),e.Y36(S.b))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-dedicated-settings"]],decls:24,vars:11,consts:[["slot","start"],["defaultHref","settings"],["disabled","",1,"infobox",2,"height","250px",3,"ngModel","ngModelChange"],["color","medium"],[3,"click"],["disabled","",1,"infobox",2,"height","80px",3,"ngModel","ngModelChange"],["button","",3,"disabled","click"],[1,"additional_form","status_bar_single"],[1,"form_margin"]],template:function(s,t){1&s&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e._uU(3),e.qZA(),e.TgZ(4,"ion-buttons",0),e._UZ(5,"ion-back-button",1),e.qZA()()(),e.TgZ(6,"ion-content")(7,"ion-item-divider")(8,"ion-label"),e._uU(9),e.qZA()(),e.TgZ(10,"textarea",2),e.NdJ("ngModelChange",function(r){return t.info=r}),e.qZA(),e.TgZ(11,"ion-list-header")(12,"ion-label",3),e._uU(13),e.qZA(),e.TgZ(14,"ion-button",4),e.NdJ("click",function(){return t.server.check_addresses()}),e._uU(15),e.qZA()(),e.TgZ(16,"textarea",5),e.NdJ("ngModelChange",function(r){return t.addresses=r}),e.qZA(),e.TgZ(17,"ion-item-divider")(18,"ion-label"),e._uU(19),e.qZA()(),e.TgZ(20,"ion-item",6),e.NdJ("click",function(){return t.start_minimalserver()}),e._UZ(21,"div",7),e.TgZ(22,"ion-label",8),e._uU(23),e.qZA()()()),2&s&&(e.xp6(3),e.Oqu(t.lang.text.UseAsServer.Title),e.xp6(6),e.Oqu(t.lang.text.UseAsServer.UserNotice),e.xp6(1),e.Q6J("ngModel",t.info),e.xp6(3),e.Oqu(t.lang.text.UseAsServer.ThisDeviceAddress),e.xp6(2),e.Oqu(t.lang.text.UseAsServer.RefreshAddress),e.xp6(1),e.Q6J("ngModel",t.addresses),e.xp6(3),e.Oqu(t.lang.text.UseAsServer.DedicatedServer),e.xp6(1),e.Q6J("disabled",t.block.groupchat),e.xp6(1),e.Akn("background-color: "+t.statusBar.colors[t.statusBar.dedicated.official.groupchat]),e.xp6(2),e.Oqu(t.lang.text.UseAsServer.CustomGroupChat))},directives:[o.Gu,o.sr,o.wd,o.Sm,o.oU,o.cs,o.W2,o.rH,o.Q$,c.Fj,c.JJ,c.On,o.yh,o.YG,o.Ie],styles:[""]}),i})()}];let b=(()=>{class i{}return i.\u0275fac=function(s){return new(s||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[g.Bz.forChild(A)],g.Bz]}),i})(),k=(()=>{class i{}return i.\u0275fac=function(s){return new(s||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[f.ez,c.u5,o.Pc,b]]}),i})()}}]);