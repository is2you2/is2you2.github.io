"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4403],{4403:(ie,Q,u)=>{u.r(Q),u.d(Q,{ChatRoomPageModule:()=>je});var V=u(6814),n=u(95),y=u(1325),T=u(5877),w=u(5861),L=u(9868),H=u(9461),P=u(3641),F=u(9745),N=u(477),D=u(2854),q=u(196),Y=u(4688),E=u(5470),B=u(9761),e=u(9468),j=u(9080),G=u(4093),W=u(7488),K=u(797),z=u(3857),X=u(6593),ee=u(6052),m=u(1048),k=u(7429),g=u(9376),f=u(4663);function p(o,c){if(1&o){const a=e.EpF();e.TgZ(0,"ion-icon",27),e.NdJ("click",function(){e.CHM(a);const i=e.oxw();return e.KtG(i.toggle_thumbnail())}),e.qZA()}}function x(o,c){if(1&o){const a=e.EpF();e.TgZ(0,"ion-icon",28),e.NdJ("click",function(){e.CHM(a);const i=e.oxw();return e.KtG(i.toggle_thumbnail())}),e.qZA()}}function I(o,c){if(1&o&&(e.TgZ(0,"div",37)(1,"font",38),e._uU(2),e.qZA()()),2&o){const a=e.oxw().$implicit;e.xp6(2),e.hij(" ",a.msgDate," ")}}function Z(o,c){if(1&o){const a=e.EpF();e.TgZ(0,"div",39)(1,"span",40),e.NdJ("click",function(){e.CHM(a);const i=e.oxw().$implicit,s=e.oxw();return e.KtG(s.user_detail(i))}),e.TgZ(2,"b")(3,"font",41),e._uU(4),e.qZA()()(),e.TgZ(5,"span",42),e._uU(6),e.qZA()()}if(2&o){const a=e.oxw().$implicit,t=e.oxw();e.xp6(3),e.MGl("color","#",a.is_me&&t.nakama.users.self.online||!a.is_me&&t.nakama.users[t.isOfficial][t.target][a.sender_id].online?a.color:"888",""),e.xp6(1),e.hij(" ",a.user_display_name,""),e.xp6(2),e.Oqu(a.msgTime)}}function U(o,c){if(1&o){const a=e.EpF();e.TgZ(0,"div",43),e.NdJ("click",function(){e.CHM(a);const i=e.oxw().$implicit,s=e.oxw();return e.KtG(s.quickShare_act(i))}),e._uU(1),e.qZA()}if(2&o){const a=e.oxw(2);e.xp6(1),e.hij(" ",a.lang.text.ChatRoom.QuickShare," ")}}function te(o,c){if(1&o){const a=e.EpF();e.TgZ(0,"div",43),e.NdJ("click",function(){e.CHM(a);const i=e.oxw().$implicit,s=e.oxw();return e.KtG(s.JoinWebRTCMatch(i))}),e._uU(1),e.qZA()}if(2&o){const a=e.oxw(2);e.xp6(1),e.hij(" ",a.lang.text.ChatRoom.JoinWebRTCMatch," ")}}function ne(o,c){1&o&&e._UZ(0,"div",52)}function ae(o,c){if(1&o&&(e.TgZ(0,"span",53),e._uU(1),e.qZA()),2&o){const a=c.$implicit;e.xp6(1),e.hij(" ",a," ")}}function oe(o,c){if(1&o&&(e.TgZ(0,"div",48)(1,"p",49),e._uU(2),e.qZA(),e.YNc(3,ne,1,0,"div",50),e.YNc(4,ae,2,1,"span",51),e.qZA()),2&o){const a=e.oxw(2).$implicit;e.xp6(2),e.hij(" ",a.content.filename," "),e.xp6(1),e.Q6J("ngIf",a.content.text),e.xp6(1),e.Q6J("ngForOf",a.content.text)}}function se(o,c){if(1&o&&(e.TgZ(0,"div",54),e._UZ(1,"img",55),e.qZA()),2&o){const a=e.oxw(2).$implicit;e.xp6(1),e.Q6J("src",a.content.thumbnail,e.LSH)("alt",a.content.filename)}}function le(o,c){if(1&o&&(e.TgZ(0,"div",56),e._uU(1),e.qZA()),2&o){const a=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",a.content.transfer_index.index,"")}}function re(o,c){if(1&o){const a=e.EpF();e.TgZ(0,"div",44),e.NdJ("click",function(){e.CHM(a);const i=e.oxw().$implicit,s=e.oxw();return e.KtG(s.file_detail(i))}),e.YNc(1,oe,5,3,"div",45),e.YNc(2,se,2,2,"div",46),e.YNc(3,le,2,1,"div",47),e.qZA()}if(2&o){const a=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf",!a.content.thumbnail),e.xp6(1),e.Q6J("ngIf",a.content.thumbnail),e.xp6(1),e.Q6J("ngIf",a.content.transfer_index)}}function ce(o,c){if(1&o&&(e.TgZ(0,"div",57)(1,"div",58),e._uU(2),e.qZA()()),2&o){const a=e.oxw().$implicit;e.xp6(2),e.hij(" ",a.content.noti," ")}}function _e(o,c){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const a=e.oxw().$implicit;e.Akn("font-size: "+(a.size||16)+"px"),e.xp6(1),e.hij(" ",a.text," ")}}function de(o,c){if(1&o&&(e.TgZ(0,"a",63),e._uU(1),e.qZA()),2&o){const a=e.oxw().$implicit;e.Q6J("href",a.text,e.LSH),e.xp6(1),e.Oqu(a.text)}}function he(o,c){if(1&o&&(e.TgZ(0,"span"),e.YNc(1,_e,2,3,"span",61),e.YNc(2,de,2,2,"a",62),e.qZA()),2&o){const a=c.$implicit;e.xp6(1),e.Q6J("ngIf",!a.href),e.xp6(1),e.Q6J("ngIf",a.href)}}function ue(o,c){if(1&o&&(e.TgZ(0,"div"),e.YNc(1,he,3,2,"span",60),e.qZA()),2&o){const a=c.$implicit;e.xp6(1),e.Q6J("ngForOf",a)}}function ge(o,c){if(1&o&&(e.TgZ(0,"div",59),e.YNc(1,ue,2,1,"div",60),e.qZA()),2&o){const a=e.oxw().$implicit;e.xp6(1),e.Q6J("ngForOf",a.content.msg)}}function fe(o,c){if(1&o&&(e.TgZ(0,"div",64),e._uU(1),e.qZA()),2&o){const a=e.oxw(2);e.xp6(1),e.hij(" ",a.lang.text.ChatRoom.YouReadHereLast,"")}}function me(o,c){if(1&o){const a=e.EpF();e.TgZ(0,"div",29),e.NdJ("click",function(){const s=e.CHM(a).$implicit,r=e.oxw();return e.KtG(r.message_detail(s))}),e.YNc(1,I,3,1,"div",30),e.YNc(2,Z,7,3,"div",31),e.YNc(3,U,2,1,"div",32),e.YNc(4,te,2,1,"div",32),e.YNc(5,re,4,3,"div",33),e.YNc(6,ce,3,1,"div",34),e.YNc(7,ge,2,1,"div",35),e.YNc(8,fe,2,1,"div",36),e.qZA()}if(2&o){const a=c.$implicit;e.xp6(1),e.Q6J("ngIf",a.showInfo&&a.showInfo.date),e.xp6(1),e.Q6J("ngIf",a.showInfo&&a.showInfo.sender),e.xp6(1),e.Q6J("ngIf",a.content.quickShare),e.xp6(1),e.Q6J("ngIf",a.content.match),e.xp6(1),e.Q6J("ngIf",a.content.filename),e.xp6(1),e.Q6J("ngIf",a.content.noti),e.xp6(1),e.Q6J("ngIf",a.content.msg),e.xp6(1),e.Q6J("ngIf",a.isLastRead)}}function pe(o,c){if(1&o){const a=e.EpF();e.TgZ(0,"div",43),e.NdJ("click",function(){e.CHM(a);const i=e.oxw().$implicit,s=e.oxw();return e.KtG(s.quickShare_act(i))}),e._uU(1),e.qZA()}if(2&o){const a=e.oxw(2);e.xp6(1),e.hij(" ",a.lang.text.ChatRoom.QuickShare," ")}}function xe(o,c){1&o&&e._UZ(0,"div",52)}function ve(o,c){if(1&o&&(e.TgZ(0,"span",53),e._uU(1),e.qZA()),2&o){const a=c.$implicit;e.xp6(1),e.hij(" ",a," ")}}function we(o,c){if(1&o&&(e.TgZ(0,"div",48)(1,"p",49),e._uU(2),e.qZA(),e.YNc(3,xe,1,0,"div",50),e.YNc(4,ve,2,1,"span",51),e.qZA()),2&o){const a=e.oxw(2).$implicit;e.xp6(2),e.hij(" ",a.content.filename," "),e.xp6(1),e.Q6J("ngIf",a.content.text),e.xp6(1),e.Q6J("ngForOf",a.content.text)}}function be(o,c){if(1&o&&(e.TgZ(0,"div",54),e._UZ(1,"img",55),e.qZA()),2&o){const a=e.oxw(2).$implicit;e.xp6(1),e.Q6J("src",a.content.thumbnail,e.LSH)("alt",a.content.filename)}}function Ce(o,c){if(1&o){const a=e.EpF();e.TgZ(0,"div",44),e.NdJ("click",function(){e.CHM(a);const i=e.oxw().$implicit,s=e.oxw();return e.KtG(s.file_detail(i))}),e.YNc(1,we,5,3,"div",45),e.YNc(2,be,2,2,"div",46),e.qZA()}if(2&o){const a=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf",!a.content.thumbnail),e.xp6(1),e.Q6J("ngIf",a.content.thumbnail)}}function Te(o,c){if(1&o&&(e.TgZ(0,"span",67),e._uU(1),e.qZA()),2&o){const a=e.oxw().$implicit;e.xp6(1),e.hij(" ",a.text," ")}}function ke(o,c){if(1&o&&(e.TgZ(0,"a",68),e._uU(1),e.qZA()),2&o){const a=e.oxw().$implicit;e.Q6J("href",a.text,e.LSH),e.xp6(1),e.Oqu(a.text)}}function Ie(o,c){if(1&o&&(e.TgZ(0,"span"),e.YNc(1,Te,2,1,"span",65),e.YNc(2,ke,2,2,"a",66),e.qZA()),2&o){const a=c.$implicit;e.xp6(1),e.Q6J("ngIf",!a.href),e.xp6(1),e.Q6J("ngIf",a.href)}}function Me(o,c){if(1&o&&(e.TgZ(0,"div"),e.YNc(1,Ie,3,2,"span",60),e.qZA()),2&o){const a=c.$implicit;e.xp6(1),e.Q6J("ngForOf",a)}}function ye(o,c){if(1&o&&(e.TgZ(0,"div",59),e.YNc(1,Me,2,1,"div",60),e.qZA()),2&o){const a=e.oxw().$implicit;e.xp6(1),e.Q6J("ngForOf",a.content.msg)}}function Re(o,c){if(1&o){const a=e.EpF();e.TgZ(0,"div",29),e.NdJ("click",function(){const s=e.CHM(a).$implicit,r=e.oxw();return e.KtG(r.message_detail(s))}),e.YNc(1,pe,2,1,"div",32),e.YNc(2,Ce,3,2,"div",33),e.YNc(3,ye,2,1,"div",35),e.qZA()}if(2&o){const a=c.$implicit;e.xp6(1),e.Q6J("ngIf",a.content.quickShare),e.xp6(1),e.Q6J("ngIf",a.content.filename),e.xp6(1),e.Q6J("ngIf",a.content.msg)}}function Oe(o,c){if(1&o){const a=e.EpF();e.TgZ(0,"ion-item",69),e.NdJ("click",function(){e.CHM(a);const i=e.oxw();return e.KtG(i.pull_msg_history(!1))}),e.TgZ(1,"ion-label"),e._uU(2),e.qZA()()}if(2&o){const a=e.oxw();e.xp6(2),e.Oqu(a.lang.text.ChatRoom.fetch_next_chat)}}function Pe(o,c){if(1&o){const a=e.EpF();e.TgZ(0,"tr",70),e.NdJ("click",function(){e.CHM(a);const i=e.oxw();return e.KtG(i.cancel_qrshare())}),e.TgZ(1,"td",71)(2,"span"),e._uU(3),e.qZA()()()}if(2&o){const a=e.oxw();e.xp6(3),e.Oqu(a.lang.text.Settings.quickQRshare)}}function Ze(o,c){if(1&o&&e._UZ(0,"img",78),2&o){const a=e.oxw(4);e.Q6J("src",a.userInput.file.thumbnail,e.LSH)("alt",a.userInput.file.name)}}function Ae(o,c){if(1&o&&(e.TgZ(0,"div"),e.YNc(1,Ze,1,2,"img",77),e.qZA()),2&o){const a=e.oxw(3);e.xp6(1),e.Q6J("ngIf","image"==a.userInput.file.typeheader)}}function Se(o,c){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const a=c.$implicit;e.xp6(1),e.hij(" ",a," ")}}function Ve(o,c){if(1&o&&(e.TgZ(0,"div",79),e.YNc(1,Se,2,1,"span",60),e.qZA()),2&o){const a=e.oxw(3);e.xp6(1),e.Q6J("ngForOf",a.userInput.file.thumbnail)}}function $e(o,c){if(1&o){const a=e.EpF();e.TgZ(0,"div",29),e.NdJ("click",function(){e.CHM(a);const i=e.oxw(2);return e.KtG(i.removeAttach())}),e.TgZ(1,"div",74),e._uU(2),e.qZA(),e.YNc(3,Ae,2,1,"div",75),e.YNc(4,Ve,2,1,"div",76),e.qZA()}if(2&o){const a=e.oxw(2);e.xp6(2),e.hij(" ",a.userInput.file.filename," "),e.xp6(1),e.Q6J("ngIf",a.userInput.file.thumbnail),e.xp6(1),e.Q6J("ngIf","text"==a.userInput.file.typeheader)}}function Ue(o,c){if(1&o&&(e.TgZ(0,"tr",72)(1,"td"),e.YNc(2,$e,5,3,"div",73),e.qZA()()),2&o){const a=e.oxw();e.xp6(2),e.Q6J("ngIf",a.userInput.file)}}function Je(o,c){if(1&o){const a=e.EpF();e.TgZ(0,"tr",70),e.NdJ("click",function(){e.CHM(a);const i=e.oxw();return e.KtG(i.scroll_down_logs())}),e.TgZ(1,"td",80),e._uU(2),e.qZA()()}if(2&o){const a=e.oxw();e.xp6(2),e.Oqu(a.lang.text.ChatRoom.GoToRecent)}}function Qe(o,c){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const a=e.oxw().$implicit;e.xp6(1),e.hij(" ",a.text," ")}}function Le(o,c){if(1&o&&(e.TgZ(0,"a",63),e._uU(1),e.qZA()),2&o){const a=e.oxw().$implicit;e.Q6J("href",a.text,e.LSH),e.xp6(1),e.Oqu(a.text)}}function Fe(o,c){if(1&o&&(e.TgZ(0,"span"),e.YNc(1,Qe,2,1,"span",75),e.YNc(2,Le,2,2,"a",62),e.qZA()),2&o){const a=c.$implicit;e.xp6(1),e.Q6J("ngIf",!a.href),e.xp6(1),e.Q6J("ngIf",a.href)}}function Ne(o,c){if(1&o&&(e.TgZ(0,"span"),e.YNc(1,Fe,3,2,"span",60),e.qZA()),2&o){const a=c.$implicit;e.xp6(1),e.Q6J("ngForOf",a)}}function He(o,c){if(1&o){const a=e.EpF();e.TgZ(0,"tr",70),e.NdJ("click",function(){e.CHM(a);const i=e.oxw();return e.KtG(i.init_chatroom())}),e.TgZ(1,"td",81)(2,"span")(3,"b"),e._uU(4),e.qZA()(),e.YNc(5,Ne,2,1,"span",60),e.qZA()()}if(2&o){const a=e.oxw();e.xp6(2),e.Akn("margin-right: 8px; color: #"+a.last_message_viewer.color),e.xp6(2),e.Oqu((a.last_message_viewer.is_me?a.nakama.users.self.display_name:a.nakama.users[a.isOfficial][a.target][a.last_message_viewer.user_id].display_name)||a.lang.text.Profile.noname_user),e.xp6(1),e.Q6J("ngForOf",a.last_message_viewer.message)}}function De(o,c){if(1&o&&e._UZ(0,"ion-icon",86),2&o){const a=e.oxw().$implicit;e.Q6J("name",a.icon||"close-circle")}}function qe(o,c){if(1&o&&e._UZ(0,"img",87),2&o){const a=e.oxw().$implicit;e.Q6J("src","assets/icon/"+a.icon_img,e.LSH)("alt",a.title)}}function Ye(o,c){if(1&o){const a=e.EpF();e.TgZ(0,"div",82)(1,"div",83),e.NdJ("click",function(){const s=e.CHM(a).$implicit;return e.KtG(s.act())}),e.YNc(2,De,1,1,"ion-icon",84),e.YNc(3,qe,1,2,"img",85),e.qZA()()}if(2&o){const a=c.$implicit;e.xp6(1),e.Akn("cursor: "+(a.cursor||"pointer")+";"),e.Q6J("hidden",a.isHide),e.xp6(1),e.Q6J("ngIf",a.icon),e.xp6(1),e.Q6J("ngIf",a.icon_img)}}const Ee=[{path:"",component:(()=>{var o;class c{constructor(t,i,s,r,_,h,d,b,M,A,$,Ge,We,Ke,ze,Xe,et){var R,l=this;this.modalCtrl=t,this.navCtrl=i,this.route=s,this.router=r,this.nakama=_,this.noti=h,this.statusBar=d,this.indexed=b,this.lang=M,this.sanitizer=A,this.global=$,this.loadingCtrl=Ge,this.camera=We,this.webrtc=Ke,this.p5toast=ze,this.mClipboard=Xe,this.alertCtrl=et,this.info={},this.foundLastRead=!1,this.messages=[],this.sending_msg=[],this.temporary_open_thumbnail={},this.extended_buttons=[{isHide:!0,icon:"close-circle-outline",act:(R=(0,w.Z)(function*(){let v=yield l.loadingCtrl.create({message:l.lang.text.TodoDetail.WIP});v.present(),delete l.nakama.channels_orig[l.isOfficial][l.target][l.info.id],3==l.info.redirect.type&&(yield l.nakama.remove_group_list(l.nakama.groups[l.isOfficial][l.target][l.info.group_id]||l.info.info,l.isOfficial,l.target));try{delete l.nakama.groups[l.isOfficial][l.target][l.info.group_id]}catch(C){console.log("DeleteGroupFailed: ",C)}l.nakama.remove_channel_files(l.isOfficial,l.target,l.info.id),l.nakama.save_groups_with_less_info(),l.indexed.GetFileListFromDB(`servers/${l.isOfficial}/${l.target}/channels/${l.info.id}`,C=>{C.forEach(O=>l.indexed.removeFileFromUserPath(O)),v.dismiss(),l.navCtrl.back()})}),function(){return R.apply(this,arguments)})},{icon:"log-out-outline",act:function(){var R=(0,w.Z)(function*(){if(3!=l.info.redirect.type)try{yield l.nakama.remove_group_list(l.nakama.groups[l.isOfficial][l.target][l.info.group_id]||l.info.info,l.isOfficial,l.target,!1),yield l.nakama.servers[l.isOfficial][l.target].socket.leaveChat(l.info.id),l.nakama.channels_orig[l.isOfficial][l.target][l.info.id].status="missing",l.extended_buttons.forEach(v=>{v.isHide=!0}),l.extended_buttons[0].isHide=!1}catch(v){console.error("\ucc44\ub110\uc5d0\uc11c \ub098\uc624\uae30 \uc2e4\ud328: ",v)}else l.extended_buttons[1].isHide=!0});return function(){return R.apply(this,arguments)}}()},{icon:"settings-outline",act:()=>{3!=this.info.redirect.type?this.extended_buttons[2].isHide=!0:this.lock_modal_open||(this.lock_modal_open=!0,this.modalCtrl.create({component:D.x,componentProps:{info:this.nakama.groups[this.isOfficial][this.target][this.info.group_id],server:{isOfficial:this.isOfficial,target:this.target}}}).then(R=>{R.onWillDismiss().then(v=>{v.data&&(this.extended_buttons.forEach(C=>{C.isHide=!0}),this.extended_buttons[0].isHide=!1,this.extended_buttons[2].isHide=!1)}),R.present(),this.lock_modal_open=!1}))}},{icon:"camera-outline",act:()=>{this.camera.getPicture({destinationType:0,correctOrientation:!0}).then(function(){var R=(0,w.Z)(function*(v){let C=yield l.loadingCtrl.create({message:l.lang.text.TodoDetail.WIP});C.present(),l.userInputTextArea||(l.userInputTextArea=document.getElementById(l.ChannelUserInputId)),l.userInput.file={},l.userInput.file.filename=`Camera_${(new Date).toLocaleString().replace(/:/g,"_")}.jpeg`,l.userInput.file.file_ext="jpeg",l.userInput.file.thumbnail=l.sanitizer.bypassSecurityTrustUrl("data:image/jpeg;base64,"+v),l.userInput.file.type="image/jpeg",l.userInput.file.typeheader="image",l.userInput.file.content_related_creator=[{user_id:l.nakama.servers[l.isOfficial][l.target].session.user_id,timestamp:(new Date).getTime(),display_name:l.nakama.users.self.display_name,various:"camera"}],l.userInput.file.content_creator={user_id:l.nakama.servers[l.isOfficial][l.target].session.user_id,timestamp:(new Date).getTime(),display_name:l.nakama.users.self.display_name,various:"camera"},yield l.indexed.saveBase64ToUserPath("data:image/jpeg;base64,"+v,`tmp_files/chatroom/${l.userInput.file.filename}`,S=>{l.userInput.file.blob=new Blob([S],{type:l.userInput.file.type})}),C.dismiss()});return function(v){return R.apply(this,arguments)}}())}},{icon:"document-outline",act:()=>{this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId)),document.getElementById(this.file_sel_id).click()}},{icon:"document-attach-outline",act:function(){var R=(0,w.Z)(function*(){try{let v;try{v=yield l.mClipboard.paste()}catch{try{v=yield B.Z.read()}catch(S){throw S}}let C={};C.url=v,C.content_related_creator=[{user_id:l.nakama.servers[l.isOfficial][l.target].session.user_id,timestamp:(new Date).getTime(),display_name:l.nakama.users.self.display_name,various:"link"}],C.content_creator={user_id:l.nakama.servers[l.isOfficial][l.target].session.user_id,timestamp:(new Date).getTime(),display_name:l.nakama.users.self.display_name,various:"link"},C.file_ext=C.url.split(".").pop().split("?").shift(),C.filename=`${l.lang.text.ChatRoom.ExternalLinkFile}.${C.file_ext}`,l.global.set_viewer_category_from_ext(C),C.type="",C.typeheader=C.viewer,l.info.HideAutoThumbnail||l.global.modulate_thumbnail(C,C.url),l.NeedScrollDown()&&setTimeout(()=>{l.scroll_down_logs()},100),l.userInput.file=C,l.inputPlaceholder=`(${l.lang.text.ChatRoom.FileLink}: ${l.userInput.file.filename})`}catch(v){l.p5toast.show({text:`${l.lang.text.ChatRoom.FailedToPasteData}: ${v}`})}});return function(){return R.apply(this,arguments)}}()},{icon_img:"voidDraw.png",act:function(){var R=(0,w.Z)(function*(){l.userInputTextArea||(l.userInputTextArea=document.getElementById(l.ChannelUserInputId));let C,v={};if(l.userInput.file&&"image"==l.userInput.file.typeheader)try{l.userInput.file.url&&(l.userInput.file.blob=yield fetch(l.userInput.file.url).then(J=>J.blob()));let O=`tmp_files/chatroom/attached.${l.userInput.file.file_ext}`;yield l.indexed.saveBlobToUserPath(l.userInput.file.blob,O,void 0,l.indexed.godotDB);let S=document.getElementById("ChatroomSelectedImage");v.path=O,v.width=S.naturalWidth,v.height=S.naturalHeight,C=l.userInput.file.content_related_creator}catch(O){return void l.p5toast.show({text:`${l.lang.text.ContentViewer.CannotEditFile}: ${O}`})}l.modalCtrl.create({component:N.$,componentProps:v}).then(O=>{O.onWillDismiss().then(function(){var S=(0,w.Z)(function*(J){J.data&&(yield l.voidDraw_fileAct_callback(J,C))});return function(J){return S.apply(this,arguments)}}()),O.present()})});return function(){return R.apply(this,arguments)}}()},{icon:"qr-code-outline",act:()=>{this.modalCtrl.create({component:Y.b}).then(R=>{R.onDidDismiss().then(v=>{v.data?(this.userInput.quickShare=v.data,this.inputPlaceholder=this.lang.text.ChatRoom.QuickShare_placeholder):this.cancel_qrshare()}),R.present()})}},{icon:"call-outline",act:function(){var R=(0,w.Z)(function*(){try{yield l.webrtc.initialize("audio",void 0,{isOfficial:l.isOfficial,target:l.target,channel_id:l.info.id,user_id:l.info.info.id||l.info.info.user_id}),l.webrtc.CurrentMatch=yield l.nakama.servers[l.isOfficial][l.target].socket.createMatch(),yield l.nakama.servers[l.isOfficial][l.target].socket.writeChatMessage(l.info.id,{match:l.webrtc.CurrentMatch.match_id}),l.scroll_down_logs(),l.webrtc.CreateOfffer()}catch(v){console.log("webrtc \uc2dc\uc791\ub2e8\uacc4 \uc624\ub958: ",v)}});return function(){return R.apply(this,arguments)}}()}],this.next_cursor="",this.prev_cursor="",this.file_sel_id="file_sel_id",this.ShowGoToBottom=!1,this.last_message_viewer={user_id:void 0,message:void 0,color:void 0,is_me:void 0},this.userInput={file:void 0,quickShare:void 0,text:""},this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder,this.pullable=!0,this.ViewableMessage=[],this.ViewMsgIndex=0,this.RefreshCount=15,this.ViewCount=45,this.ShowRecentMsg=!1,this.isHistoryLoaded=!1,this.LocalHistoryList=[],this.isHidden=!0,this.ChannelUserInputId="ChannelUserInputId",this.lock_modal_open=!1}cancel_qrshare(){delete this.userInput.quickShare,this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder}inputFileSelected(t){var i=this;return(0,w.Z)(function*(){if(t.target.files.length)if(1!=t.target.files.length)(yield i.alertCtrl.create({header:i.lang.text.ChatRoom.MultipleSend,message:`${i.lang.text.ChatRoom.CountFile}: ${t.target.files.length}`,buttons:[{text:i.lang.text.ChatRoom.Send,handler:(_=(0,w.Z)(function*(){let h=yield i.loadingCtrl.create({message:i.lang.text.TodoDetail.WIP});h.present();for(let d=0,b=t.target.files.length;d<b;d++)yield i.selected_blobFile_callback_act(t.target.files[d]),yield i.send();h.dismiss(),setTimeout(()=>{i.scroll_down_logs()},300)}),function(){return _.apply(this,arguments)})}]})).present();else{let r=yield i.loadingCtrl.create({message:i.lang.text.TodoDetail.WIP});r.present(),yield i.selected_blobFile_callback_act(t.target.files[0]),r.dismiss()}else delete i.userInput.file,i.inputPlaceholder=i.lang.text.ChatRoom.input_placeholder;var _})()}ngOnInit(){var t=this;this.nakama.removeBanner(),this.ChatLogs=document.getElementById("chatroom_div"),this.ChatLogs.onscroll=i=>{this.ChatLogs.scrollHeight==this.ChatLogs.scrollTop+this.ChatLogs.clientHeight&&(this.ShowGoToBottom||this.ShowRecentMsg||this.init_last_message_viewer()),this.ShowGoToBottom=this.ChatLogs.scrollHeight-220>this.ChatLogs.scrollTop+this.ChatLogs.clientHeight},this.nakama.ChatroomLinkAct=function(){var i=(0,w.Z)(function*(s,r){delete t.nakama.channels_orig[t.isOfficial][t.target][t.info.id].update,t.info=s,yield t.init_chatroom(),t.userInput.file=r,t.userInput.file&&t.create_selected_thumbnail()});return function(s,r){return i.apply(this,arguments)}}(),this.route.queryParams.subscribe(function(){var i=(0,w.Z)(function*(s){const r=t.router.getCurrentNavigation().extras.state;r&&(t.info=r.info),yield t.init_chatroom(),t.userInput.file=r.file,t.userInput.file&&t.create_selected_thumbnail()});return function(s){return i.apply(this,arguments)}}()),"DesktopPWA"==P.n$&&setTimeout(()=>{this.CreateDrop()},0)}CreateDrop(){var t=this;let i=document.getElementById("p5Drop_chatroom");this.p5canvas=new L(s=>{s.setup=()=>{let b=s.createCanvas(i.clientWidth,i.clientHeight);b.parent(i),s.pixelDensity(1),b.drop(M=>{let A=s.millis();h<A-400?(_=!1,d.length=0,d.push(M)):(_=!0,d.push(M)),h=A,clearTimeout(r),r=setTimeout((0,w.Z)(function*(){if(_)t.alertCtrl.create({header:t.lang.text.ChatRoom.MultipleSend,message:`${t.lang.text.ChatRoom.CountFile}: ${d.length}`,buttons:[{text:t.lang.text.ChatRoom.Send,handler:()=>{t.DropSendAct(d)}}]}).then($=>$.present());else{let $=yield t.loadingCtrl.create({message:t.lang.text.TodoDetail.WIP});$.present(),t.selected_blobFile_callback_act(M.file),$.dismiss()}}),400)})};let r,_=!1,h=0,d=[];s.mouseMoved=b=>{b.dataTransfer?(i.style.pointerEvents="all",i.style.backgroundColor="#0008"):(i.style.pointerEvents="none",i.style.backgroundColor="transparent")}})}DropSendAct(t){var i=this;return(0,w.Z)(function*(){let s=yield i.loadingCtrl.create({message:i.lang.text.TodoDetail.WIP});s.present();for(let r=0,_=t.length;r<_;r++)yield i.selected_blobFile_callback_act(t[r].file),yield i.send();s.dismiss(),setTimeout(()=>{i.scroll_down_logs()},300)})()}selected_blobFile_callback_act(t,i=[],s="loaded"){var r=this;return(0,w.Z)(function*(){r.userInput.file={},r.userInput.file.filename=t.name,r.userInput.file.file_ext=t.name.split(".").pop()||t.type||r.lang.text.ChatRoom.unknown_ext,r.userInput.file.size=t.size,r.userInput.file.type=t.type,r.userInput.file.content_related_creator=[...i,{user_id:r.nakama.servers[r.isOfficial][r.target].session.user_id,timestamp:(new Date).getTime(),display_name:r.nakama.users.self.display_name,various:s}],r.userInput.file.content_creator={user_id:r.nakama.servers[r.isOfficial][r.target].session.user_id,timestamp:(new Date).getTime(),display_name:r.nakama.users.self.display_name,various:s},r.userInput.file.blob=t,r.create_selected_thumbnail(),r.inputPlaceholder=`(${r.lang.text.ChatRoom.attachments}: ${r.userInput.file.filename})`})()}create_selected_thumbnail(){var t=this;return(0,w.Z)(function*(){if(!t.userInput.file.blob||void 0===t.userInput.file.blob.size){if(t.global.set_viewer_category_from_ext(t.userInput.file),t.userInput.file.url)return t.userInput.file.thumbnail=t.userInput.file.url,void(t.userInput.file.typeheader=t.userInput.file.viewer);t.userInput.file.blob=yield t.indexed.loadBlobFromUserPath(t.userInput.file.path,t.userInput.file.type)}let i=URL.createObjectURL(t.userInput.file.blob);switch(t.userInput.file.typeheader=t.userInput.file.blob.type.split("/")[0]||t.userInput.file.viewer,setTimeout(()=>{URL.revokeObjectURL(i)},0),t.userInput.file.thumbnail=void 0,t.userInput.file.typeheader){case"image":t.userInput.file.thumbnail=t.sanitizer.bypassSecurityTrustUrl(i);break;case"text":new L(s=>{s.setup=()=>{s.noCanvas(),s.loadStrings(i,r=>{t.userInput.file.thumbnail=r,s.remove()},r=>{console.error("\ubb38\uc790\uc5f4 \ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",r),s.remove()})}})}})()}init_chatroom(){var t=this;return(0,w.Z)(function*(){switch(t.nakama.OnTransferMessage={},t.ViewableMessage.length=0,t.ViewMsgIndex=0,t.ShowGoToBottom=!1,t.ShowRecentMsg=!1,t.messages.length=0,t.prev_cursor=void 0,t.next_cursor=void 0,t.init_last_message_viewer(),t.file_sel_id=`chatroom_${t.info.id}_${(new Date).getTime()}`,t.ChannelUserInputId=`chatroom_input_${t.info.id}_${(new Date).getTime()}`,t.noti.Current=t.info.cnoti_id,t.info.cnoti_id&&t.noti.ClearNoti(t.info.cnoti_id),t.noti.RemoveListener(`openchat${t.info.cnoti_id}`),t.isOfficial=t.info.server.isOfficial,t.target=t.info.server.target,t.info=t.nakama.channels_orig[t.isOfficial][t.target][t.info.id],t.nakama.opened_page_info.channel={isOfficial:t.isOfficial,target:t.target,id:t.info.id},t.foundLastRead=t.info.last_read_id==t.info.last_comment_id,t.extended_buttons[3].isHide="Android"!=P.n$&&"iOS"!=P.n$,t.info.redirect.type){case 2:"missing"!=t.info.status&&(t.info.redirect?"online"==t.statusBar.groupServer[t.isOfficial][t.target]&&(t.info.status=t.nakama.load_other_user(t.info.redirect.id,t.isOfficial,t.target).online?"online":"pending"):t.info.status=t.info.info.online?"online":"pending",delete t.extended_buttons[1].isHide,t.extended_buttons[2].isHide=!0,t.extended_buttons[8].isHide="http:"==window.location.protocol&&0!=window.location.host.indexOf("localhost")||!1);break;case 3:"missing"!=t.info.status&&(yield t.nakama.load_groups(t.isOfficial,t.target,t.info.group_id)),t.extended_buttons[1].isHide=!0,delete t.extended_buttons[2].isHide,t.extended_buttons[8].isHide=!0}t.nakama.channels_orig[t.isOfficial][t.target]&&t.nakama.channels_orig[t.isOfficial][t.target][t.info.id]&&(t.nakama.channels_orig[t.isOfficial][t.target][t.info.id].update=i=>{t.nakama.check_sender_and_show_name(i,t.isOfficial,t.target),i.content.filename&&t.ModulateFileEmbedMessage(i),t.info.last_read_id=t.info.last_comment_id,t.nakama.save_channels_with_less_info(),t.check_if_send_msg(i),t.messages.push(i),t.ViewMsgIndex+t.ViewCount==t.messages.length-1&&t.ViewMsgIndex++,t.ViewableMessage=t.messages.slice(t.ViewMsgIndex,t.ViewMsgIndex+t.ViewCount),t.modulate_chatmsg(0,t.ViewableMessage.length),t.ShowRecentMsg=t.messages.length>t.ViewMsgIndex+t.ViewCount,setTimeout(()=>{t.info.is_new=!1,t.nakama.has_new_channel_msg=!1,t.NeedScrollDown()&&!t.ShowRecentMsg?(t.init_last_message_viewer(),t.ChatLogs.scrollTo({top:t.ChatLogs.scrollHeight,behavior:"smooth"})):(t.last_message_viewer.is_me=i.sender_id==t.nakama.servers[t.isOfficial][t.target].session.user_id,t.last_message_viewer.user_id=i.sender_id,t.last_message_viewer.message=i.content.msg,t.last_message_viewer.color=i.color)},0)}),(void 0===t.info.status||"missing"==t.info.status)&&(t.extended_buttons.forEach(i=>{i.isHide=!0}),t.extended_buttons[0].isHide=!1,3==t.info.redirect.type&&(t.extended_buttons[2].isHide=!1)),t.pull_msg_history(),setTimeout(()=>{t.ChatLogs.scrollTo({top:t.ChatLogs.scrollHeight,behavior:"smooth"})},500)})()}init_last_message_viewer(){delete this.last_message_viewer.user_id,delete this.last_message_viewer.message,delete this.last_message_viewer.color,delete this.last_message_viewer.is_me}NeedScrollDown(){return this.ChatLogs.scrollHeight<this.ChatLogs.scrollTop+this.ChatLogs.clientHeight+200}scroll_down_logs(){this.ShowRecentMsg||this.init_last_message_viewer(),this.ChatLogs.scrollTo({top:this.ChatLogs.scrollHeight,behavior:"smooth"})}check_if_send_msg(t){for(let i=0,s=this.sending_msg.length;i<s;i++)if(t.sender_id==this.nakama.servers[this.isOfficial][this.target].session.user_id&&t.content.local_comp==this.sending_msg[i].content.local_comp){t.content.filename&&this.auto_open_thumbnail(t),this.sending_msg.splice(i,1);break}}auto_open_thumbnail(t){try{this.temporary_open_thumbnail[t.message_id]()}catch{this.temporary_open_thumbnail[t.message_id]=()=>{this.indexed.loadBlobFromUserPath(`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${t.message_id}.${t.content.file_ext}`,t.content.type,s=>{if(t.content.path=`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${t.message_id}.${t.content.file_ext}`,!this.info.HideAutoThumbnail){let r=URL.createObjectURL(s);this.global.modulate_thumbnail(t.content,r)}this.NeedScrollDown()&&setTimeout(()=>{this.scroll_down_logs()},100),this.nakama.WriteStorage_From_channel(t,t.content.path,this.isOfficial,this.target)}),delete this.temporary_open_thumbnail[t.message_id]}}}removeAttach(){delete this.userInput.file,this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder}pull_msg_history(t=!0){var i=this;return(0,w.Z)(function*(){if(i.pullable||!t)if(i.pullable=!1,t)try{if(void 0===i.info.status||"missing"==i.info.status)throw"Channel missing";if(0!=i.ViewMsgIndex){let s=Math.min(i.ViewMsgIndex,i.RefreshCount);i.ViewMsgIndex-=s,i.ViewableMessage=i.messages.slice(i.ViewMsgIndex,i.ViewMsgIndex+i.ViewCount);for(let r=0;r<s;r++)try{if(i.info.HideAutoThumbnail)throw"\uc378\ub124\uc77c \ubcf4\uc9c0 \uc54a\uae30";let _=yield i.indexed.loadBlobFromUserPath(i.ViewableMessage[r].content.path,i.ViewableMessage[r].content.file_ext);if(i.info.HideAutoThumbnail)throw"\uc378\ub124\uc77c \ubcf4\uc9c0 \uc54a\uae30";let h=URL.createObjectURL(_);i.global.modulate_thumbnail(i.ViewableMessage[r].content,h)}catch{}return i.modulate_chatmsg(0,i.ViewableMessage.length),i.ShowRecentMsg=i.messages.length>i.ViewMsgIndex+i.ViewCount,void(i.pullable=!0)}yield i.nakama.servers[i.isOfficial][i.target].client.listChannelMessages(i.nakama.servers[i.isOfficial][i.target].session,i.info.id,i.RefreshCount,!1,i.next_cursor).then(s=>{i.info.is_new=!1,s.messages.forEach(r=>{r=i.nakama.modulation_channel_message(r,i.isOfficial,i.target),i.nakama.check_sender_and_show_name(r,i.isOfficial,i.target),i.info.last_comment||(i.info.last_comment=(r.content.filename?`(${i.lang.text.ChatRoom.attachments}) `:"")+(r.content.msg||r.content.noti||"")),!i.foundLastRead&&i.info.last_read_id?i.info.last_read_id==r.message_id&&(r.isLastRead=!0,i.foundLastRead=!0,i.info.last_read_id=i.info.last_comment_id,i.nakama.save_channels_with_less_info()):i.foundLastRead=!0,i.nakama.translate_updates(r),r.content.filename&&i.ModulateFileEmbedMessage(r),i.nakama.ModulateTimeDate(r),i.nakama.content_to_hyperlink(r),i.messages.unshift(r),i.ViewableMessage=i.messages.slice(i.ViewMsgIndex,i.ViewMsgIndex+i.ViewCount),i.modulate_chatmsg(0,i.ViewableMessage.length)}),i.ShowRecentMsg=i.messages.length>i.ViewMsgIndex+i.ViewCount,i.next_cursor=s.next_cursor,i.prev_cursor=s.prev_cursor,i.pullable=!0,i.nakama.saveListedMessage(i.messages,i.info,i.isOfficial,i.target)})}catch{if(3==i.info.redirect.type&&i.nakama.groups[i.isOfficial][i.target]&&i.nakama.groups[i.isOfficial][i.target][i.info.group_id]&&!i.nakama.groups[i.isOfficial][i.target][i.info.group_id].open){let r=[{content:{msg:[{text:i.lang.text.ChatRoom.closed_group_must_online}]}},{content:{msg:[{text:i.lang.text.ChatRoom.closed_group_not_allow}]}}];return i.next_cursor=void 0,i.isHistoryLoaded=!0,void r.forEach(_=>i.messages.push(_))}i.LoadLocalChatHistory()}else{let s=i.messages.length-i.ViewMsgIndex-i.ViewCount;i.ShowRecentMsg=0!=s,i.ViewMsgIndex+=Math.min(i.RefreshCount,s),i.ViewableMessage=i.messages.slice(i.ViewMsgIndex,i.ViewMsgIndex+i.ViewCount);for(let r=i.ViewableMessage.length-1;r>=0;r--){try{if(i.info.HideAutoThumbnail)throw"\uc378\ub124\uc77c \ubcf4\uc9c0 \uc54a\uae30";let _=yield i.indexed.loadBlobFromUserPath(i.ViewableMessage[r].content.path,i.ViewableMessage[r].content.file_ext);if(i.info.HideAutoThumbnail)throw"\uc378\ub124\uc77c \ubcf4\uc9c0 \uc54a\uae30";let h=URL.createObjectURL(_);i.global.modulate_thumbnail(i.ViewableMessage[r].content,h)}catch{}i.modulate_chatmsg(r,i.ViewableMessage.length)}i.pullable=!0}})()}LoadLocalChatHistory(){var t=this;return(0,w.Z)(function*(){if(0!=t.ViewMsgIndex){let i=Math.min(t.ViewMsgIndex,t.RefreshCount);t.ViewMsgIndex-=i,t.ViewableMessage=t.messages.slice(t.ViewMsgIndex,t.ViewMsgIndex+t.ViewCount);for(let s=i-1;s>=0;s--){try{if(t.info.HideAutoThumbnail)throw delete t.ViewableMessage[s].content.thumbnail,"\uc378\ub124\uc77c \ubcf4\uc9c0 \uc54a\uae30";let r=yield t.indexed.loadBlobFromUserPath(t.ViewableMessage[s].content.path,t.ViewableMessage[s].content.file_ext),_=URL.createObjectURL(r);t.global.modulate_thumbnail(t.ViewableMessage[s].content,_)}catch{}t.modulate_chatmsg(s,t.ViewableMessage.length)}return t.ShowRecentMsg=t.messages.length>t.ViewMsgIndex+t.ViewCount,void(t.pullable=0!=t.ViewMsgIndex||!!t.LocalHistoryList.length)}t.isHistoryLoaded?t.indexed.loadTextFromUserPath(t.LocalHistoryList.pop(),function(){var i=(0,w.Z)(function*(s,r){if(s&&r){let _=JSON.parse(r.trim());for(let d=_.length-1;d>=0;d--)t.ModulateFileEmbedMessage(_[d]),t.nakama.translate_updates(_[d]),_[d]=t.nakama.modulation_channel_message(_[d],t.isOfficial,t.target),t.nakama.ModulateTimeDate(_[d]),t.messages.unshift(_[d]);let h=Math.min(_.length,t.ViewCount);t.ViewMsgIndex=Math.max(0,_.length-t.RefreshCount),t.ViewableMessage=t.messages.slice(t.ViewMsgIndex,t.ViewMsgIndex+t.ViewCount);for(let d=h-1;d>=0;d--){try{if(t.info.HideAutoThumbnail)throw delete t.ViewableMessage[d].content.thumbnail,"\uc378\ub124\uc77c \ubcf4\uc9c0 \uc54a\uae30";let b=yield t.indexed.loadBlobFromUserPath(t.ViewableMessage[d].content.path,t.ViewableMessage[d].content.file_ext),M=URL.createObjectURL(b);t.global.modulate_thumbnail(t.ViewableMessage[d].content,M)}catch{}t.modulate_chatmsg(d,t.ViewableMessage.length)}t.ShowRecentMsg=t.messages.length>t.ViewMsgIndex+t.ViewCount}t.pullable=!!t.LocalHistoryList.length});return function(s,r){return i.apply(this,arguments)}}()):t.indexed.GetFileListFromDB(`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/chats/`,i=>{t.LocalHistoryList=i,t.isHistoryLoaded=!0,t.LocalHistoryList.length&&t.indexed.loadTextFromUserPath(t.LocalHistoryList.pop(),function(){var s=(0,w.Z)(function*(r,_){if(r&&_){let h=JSON.parse(_.trim());for(let d=h.length-1;d>=0;d--)t.ModulateFileEmbedMessage(h[d]),t.nakama.translate_updates(h[d]),h[d]=t.nakama.modulation_channel_message(h[d],t.isOfficial,t.target),t.nakama.ModulateTimeDate(h[d]),t.messages.unshift(h[d]),t.ViewMsgIndex=Math.max(0,t.messages.length-t.RefreshCount),t.ViewableMessage=t.messages.slice(t.ViewMsgIndex,t.ViewMsgIndex+t.RefreshCount),t.modulate_chatmsg(0,t.ViewableMessage.length);for(let d=t.ViewableMessage.length-1;d>=0;d--){try{if(t.info.HideAutoThumbnail)throw delete t.ViewableMessage[d].content.thumbnail,"\uc378\ub124\uc77c \ubcf4\uc9c0 \uc54a\uae30";let b=yield t.indexed.loadBlobFromUserPath(t.ViewableMessage[d].content.path,t.ViewableMessage[d].content.file_ext),M=URL.createObjectURL(b);t.global.modulate_thumbnail(t.ViewableMessage[d].content,M)}catch{}t.modulate_chatmsg(d,t.ViewableMessage.length)}}t.next_cursor=null,t.pullable=!0});return function(r,_){return s.apply(this,arguments)}}())})})()}open_ext_with_delay(){this.isHidden=!this.isHidden}make_ext_hidden(){this.NeedScrollDown()&&(this.ChatLogs.scrollTo({top:this.ChatLogs.scrollHeight,behavior:"smooth"}),setTimeout(()=>{this.ChatLogs.scrollTo({top:this.ChatLogs.scrollHeight,behavior:"smooth"})},150)),"DesktopPWA"!=P.n$&&(this.isHidden=!0)}check_key(t){this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId)),"DesktopPWA"==P.n$?"Enter"!=t.key||t.shiftKey||"keydown"!=t.type?setTimeout(()=>{this.userInputTextArea.style.height="36px",this.userInputTextArea.style.height=this.userInputTextArea.scrollHeight+"px"},0):this.send(!0):setTimeout(()=>{this.userInputTextArea.style.height="36px",this.userInputTextArea.style.height=this.userInputTextArea.scrollHeight+"px"},0)}send(t=!1){var i=this;return(0,w.Z)(function*(){if(t&&("Android"==P.n$||"iOS"==P.n$))return;if(i.userInputTextArea||(i.userInputTextArea=document.getElementById(i.ChannelUserInputId)),!i.userInput.text.trim()&&!i.userInput.file&&!i.userInput.quickShare)return void setTimeout(()=>{i.userInput.text="",i.userInputTextArea.style.height="36px"},0);i.userInputTextArea.focus(),i.isHidden=!0;let s={};s.msg=i.userInput.text;let r=!1,_=!1,h="";if(i.userInput.file){s.filename=i.userInput.file.filename,s.file_ext=i.userInput.file.file_ext,s.type=i.userInput.file.type;try{s.filesize=i.userInput.file.size||i.userInput.file.blob.size,s.partsize=Math.ceil(s.filesize/12e4)}catch{s.url=i.userInput.file.url,_=!0}s.msg.length>800?(h=s.msg,delete s.msg):s.msg=s.msg,s.content_creator=i.userInput.file.content_creator,s.content_related_creator=i.userInput.file.content_related_creator,r=!0}else if(s.msg.length>800)return void i.LongTextMessageAsFile(s);i.userInput.quickShare&&(s.quickShare=i.userInput.quickShare),s.local_comp=Math.random();let d={content:JSON.parse(JSON.stringify(s))};i.nakama.content_to_hyperlink(d),i.sending_msg.push(d);try{yield i.nakama.servers[i.isOfficial][i.target].socket.writeChatMessage(i.info.id,s).then(b=>{r&&!_&&i.indexed.saveBlobToUserPath(i.userInput.file.blob,`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${b.message_id}.${i.userInput.file.file_ext}`,()=>{i.auto_open_thumbnail({content:s,message_id:b.message_id})}),delete i.userInput.quickShare,delete i.userInput.file,i.userInput.text="",i.userInputTextArea.style.height="36px",i.inputPlaceholder=i.lang.text.ChatRoom.input_placeholder,h&&(s.msg=h,i.LongTextMessageAsFile(s))})}catch(b){3===b.code?i.p5toast.show({text:i.lang.text.ChatRoom.FailedToJoinChannel}):(console.log("\uc624\ub958 \uac80\ud1a0 \ud544\uc694: ",b),i.p5toast.show({text:`${i.lang.text.ChatRoom.FailedToSend}: ${b.message}`})),setTimeout(()=>{i.userInput.text="",i.userInputTextArea.style.height="36px"},0),setTimeout(()=>{for(let M=i.sending_msg.length-1;M>=0;M--)i.sending_msg[M].content.local_comp==s.local_comp&&i.sending_msg.splice(M,1)},1500)}})()}LongTextMessageAsFile(t){var i=this;return(0,w.Z)(function*(){let s=new Blob([t.msg]);yield i.indexed.saveBlobToUserPath(s,`tmp_files/chatroom/${i.lang.text.ChatRoom.LongText}_${t.msg.substring(0,10)}.txt`);let r={};r.blob=s,r.content_related_creator=[{user_id:i.nakama.servers[i.isOfficial][i.target].session.user_id,timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"long_text"}],r.content_creator={user_id:i.nakama.servers[i.isOfficial][i.target].session.user_id,timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"long_text"};let _=t.msg.substring(0,24);r.path=`tmp_files/chatroom/${i.lang.text.ChatRoom.LongText}_${_}~.txt`,r.file_ext="txt",r.filename=`[${i.lang.text.ChatRoom.LongText}] ${_}~.txt`,i.global.set_viewer_category_from_ext(r),r.type="text/plain",r.typeheader="text",delete t.msg,delete i.userInput.quickShare,delete i.userInput.file,i.userInput.text="",i.userInputTextArea.style.height="36px",i.inputPlaceholder=i.lang.text.ChatRoom.input_placeholder,i.userInput.file=r,i.inputPlaceholder=`(${i.lang.text.ChatRoom.attachments}: ${i.userInput.file.filename})`,i.create_selected_thumbnail(),i.p5toast.show({text:i.lang.text.ChatRoom.CreateAsTextFile})})()}message_detail(t){}file_detail(t){var i=this;return(0,w.Z)(function*(){if(t.content.url)return i.info.HideAutoThumbnail||(t.content.thumbnail=t.content.url),void i.open_viewer(t,t.content.url);let s=`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${t.message_id}.${t.content.file_ext}`;try{if(!(yield i.indexed.checkIfFileExist(`${s}.history`)))throw"\uc378\ub124\uc77c \uc5f4\uae30";t.content.text=[i.lang.text.TodoDetail.WIP];let _=yield i.indexed.loadTextFromUserPath(`${s}.history`),h=JSON.parse(_);switch(delete t.content.text,h.type){case"upload":if(t.content.text=[i.lang.text.ChatRoom.uploading],i.nakama.WriteStorage_From_channel(t,s,i.isOfficial,i.target,h.index),t.content.transfer_index&&i.nakama.OnTransfer[i.isOfficial][i.target][t.channel_id][t.message_id].OnTransfer)throw"\uc804\uc1a1\uc791\uc5c5 \uc911, \uc378\ub124\uc77c \uc5f4\uae30";break;case"download":t.content.text=[i.lang.text.TodoDetail.WIP],yield i.nakama.ReadStorage_From_channel(t,s,i.isOfficial,i.target,h.index),i.NeedScrollDown()&&setTimeout(()=>{i.scroll_down_logs()},100)}}catch{(yield i.indexed.checkIfFileExist(s))?(t.content.text||(t.content.text=[i.lang.text.ChatRoom.downloaded]),i.indexed.loadBlobFromUserPath(s,t.content.type,h=>{if(t.content.path=s,!i.info.HideAutoThumbnail){let d=URL.createObjectURL(h);i.global.modulate_thumbnail(t.content,d)}i.NeedScrollDown()&&setTimeout(()=>{i.scroll_down_logs()},100)}),i.open_viewer(t,s)):i.isHistoryLoaded||(t.content.text=[i.lang.text.TodoDetail.WIP],yield i.nakama.ReadStorage_From_channel(t,s,i.isOfficial,i.target),i.NeedScrollDown()&&setTimeout(()=>{i.scroll_down_logs()},400))}})()}quickShare_act(t){var i=this;return(0,w.Z)(function*(){i.modalCtrl.create({component:E.y,componentProps:{data:t.content.quickShare}}).then(s=>s.present())})()}JoinWebRTCMatch(t){this.nakama.JoinWebRTCMatch(t,this.isOfficial,this.target,this.info)}modulate_chatmsg(t,i){this.ViewableMessage[t].showInfo||(this.ViewableMessage[t].showInfo={}),this.ViewableMessage[t].showInfo.date=!!this.ViewableMessage[t].msgDate,this.ViewableMessage[t].showInfo.sender=!this.ViewableMessage[t].content.noti&&this.ViewableMessage[t].user_display_name,t-1>=0&&(this.ViewableMessage[t].showInfo.date=!!this.ViewableMessage[t].msgDate&&this.ViewableMessage[t].msgDate!=this.ViewableMessage[t-1].msgDate,this.ViewableMessage[t].showInfo.sender=!this.ViewableMessage[t].content.noti&&this.ViewableMessage[t].user_display_name&&(this.ViewableMessage[t-1].isLastRead||this.ViewableMessage[t].sender_id!=this.ViewableMessage[t-1].sender_id||this.ViewableMessage[t-1].content.noti||this.ViewableMessage[t].msgDate!=this.ViewableMessage[t-1].msgDate||this.ViewableMessage[t].msgTime!=this.ViewableMessage[t-1].msgTime)),this.ViewableMessage[t].content.url&&!this.info.HideAutoThumbnail&&(this.ViewableMessage[t].content.thumbnail=this.ViewableMessage[t].content.url);try{t+1<i&&(this.ViewableMessage[t+1].showInfo.date=!!this.ViewableMessage[t].msgDate&&this.ViewableMessage[t].msgDate!=this.ViewableMessage[t+1].msgDate,this.ViewableMessage[t+1].showInfo.sender=!this.ViewableMessage[t+1].content.noti&&this.ViewableMessage[t+1].user_display_name&&(this.ViewableMessage[t].isLastRead||this.ViewableMessage[t].sender_id!=this.ViewableMessage[t+1].sender_id||this.ViewableMessage[t].content.noti||this.ViewableMessage[t].msgDate!=this.ViewableMessage[t+1].msgDate||this.ViewableMessage[t].msgTime!=this.ViewableMessage[t+1].msgTime))}catch{}}ModulateFileEmbedMessage(t){let i=`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${t.message_id}.${t.content.file_ext}`;t.content.path=i;try{t.content.transfer_index=this.nakama.OnTransfer[this.isOfficial][this.target][t.channel_id][t.message_id]}catch{}t.content.transfer_index||this.indexed.checkIfFileExist(`${i}.history`,s=>{s&&this.indexed.loadTextFromUserPath(`${i}.history`,(r,_)=>{if(r&&_){let h=JSON.parse(_);delete t.content.text,this.nakama.OnTransfer[this.isOfficial]||(this.nakama.OnTransfer[this.isOfficial]={}),this.nakama.OnTransfer[this.isOfficial][this.target]||(this.nakama.OnTransfer[this.isOfficial][this.target]={}),this.nakama.OnTransfer[this.isOfficial][this.target][t.channel_id]||(this.nakama.OnTransfer[this.isOfficial][this.target][t.channel_id]={}),this.nakama.OnTransfer[this.isOfficial][this.target][t.channel_id][t.message_id]||(this.nakama.OnTransfer[this.isOfficial][this.target][t.channel_id][t.message_id]={index:t.content.partsize-h.index}),t.content.transfer_index=this.nakama.OnTransfer[this.isOfficial][this.target][t.channel_id][t.message_id]}})}),this.global.set_viewer_category(t.content),this.indexed.checkIfFileExist(i,s=>{s&&(t.content.text=[this.lang.text.ChatRoom.downloaded],this.indexed.loadBlobFromUserPath(i,t.content.type,r=>{if(t.content.path=i,!this.info.HideAutoThumbnail){let _=URL.createObjectURL(r);this.global.modulate_thumbnail(t.content,_)}this.NeedScrollDown()&&setTimeout(()=>{this.scroll_down_logs()},100)}))})}toggle_thumbnail(){var t=this;return(0,w.Z)(function*(){if(t.info.HideAutoThumbnail=!t.info.HideAutoThumbnail,t.info.HideAutoThumbnail)for(let i=0,s=t.ViewableMessage.length;i<s;i++)delete t.ViewableMessage[i].content.thumbnail;else for(let i=0,s=t.ViewableMessage.length;i<s;i++)if(t.ViewableMessage[i].content.url)t.ViewableMessage[i].content.thumbnail=t.ViewableMessage[i].content.url;else{let r=`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/files/msg_${t.ViewableMessage[i].message_id}.${t.ViewableMessage[i].content.file_ext}`;t.ViewableMessage[i].content.path=r;try{if(t.info.HideAutoThumbnail)throw"\uc0c1\ud0dc \ubcc0\uacbd\ub428";let _=yield t.indexed.loadBlobFromUserPath(r,t.ViewableMessage[i].content.file_ext);if(t.info.HideAutoThumbnail)throw"\uc0c1\ud0dc \ubcc0\uacbd\ub428";let h=URL.createObjectURL(_);t.global.modulate_thumbnail(t.ViewableMessage[i].content,h)}catch{}}t.nakama.save_channels_with_less_info()})()}open_viewer(t,i){var s=this;let r=[];for(let _=0,h=this.messages.length;_<h;_++)this.messages[_].content.filename&&r.push(this.messages[_]);this.lock_modal_open||(this.lock_modal_open=!0,this.modalCtrl.create({component:F.B,componentProps:{info:t,path:i,isOfficial:this.isOfficial,target:this.target,relevance:r}}).then(_=>{_.onDidDismiss().then(h=>{if(h.data)switch(h.data.type){case"image":let d=[];if(h.data.msg.content.content_related_creator&&(d=[...h.data.msg.content.content_related_creator]),h.data.msg.content.content_creator){let b=!1;for(let M=0,A=d.length;M<A;M++)if(d[M].user_id==h.data.msg.content.content_creator.user_id){b=!0;break}b||d.push(h.data.msg.content.content_creator)}return void this.modalCtrl.create({component:N.$,componentProps:{path:h.data.path||i,width:h.data.width,height:h.data.height}}).then(b=>{b.onWillDismiss().then(function(){var M=(0,w.Z)(function*(A){A.data&&(yield s.voidDraw_fileAct_callback(A,d))});return function(A){return M.apply(this,arguments)}}()),b.present()});case"text":this.selected_blobFile_callback_act(h.data.blob,h.data.contentRelated,"textedit")}this.noti.Current=this.info.cnoti_id,this.info.cnoti_id&&this.noti.ClearNoti(this.info.cnoti_id),this.noti.RemoveListener(`openchat${this.info.cnoti_id}`)}),this.noti.Current="IonicViewerPage",_.present(),this.lock_modal_open=!1}))}voidDraw_fileAct_callback(t,i){var s=this;return(0,w.Z)(function*(){try{s.userInput.file={},s.userInput.file.filename=t.data.name,s.userInput.file.file_ext="png",s.userInput.file.thumbnail=s.sanitizer.bypassSecurityTrustUrl(t.data.img),s.userInput.file.type="image/png",s.userInput.file.typeheader="image",i?(s.userInput.file.content_related_creator=i,s.userInput.file.content_creator={user_id:s.nakama.servers[s.isOfficial][s.target].session.user_id,timestamp:(new Date).getTime(),display_name:s.nakama.users.self.display_name,various:"voidDraw"}):(s.userInput.file.content_related_creator=[{user_id:s.nakama.servers[s.isOfficial][s.target].session.user_id,timestamp:(new Date).getTime(),display_name:s.nakama.users.self.display_name,various:"voidDraw"}],s.userInput.file.content_creator={user_id:s.nakama.servers[s.isOfficial][s.target].session.user_id,timestamp:(new Date).getTime(),display_name:s.nakama.users.self.display_name,various:"voidDraw"}),yield s.indexed.saveBase64ToUserPath(t.data.img,`tmp_files/chatroom/${s.userInput.file.filename}`,r=>{s.userInput.file.blob=new Blob([r],{type:s.userInput.file.type})}),s.inputPlaceholder=`(${s.lang.text.ChatRoom.attachments}: ${s.userInput.file.filename})`}catch(r){console.error("godot-\uc774\ubbf8\uc9c0 \ud3b8\uc9d1 \uc0ac\uc6a9 \ubd88\uac00: ",r)}t.data.loadingCtrl.dismiss()})()}user_detail(t){this.lock_modal_open||(this.lock_modal_open=!0,t.is_me?this.modalCtrl.create({component:q.Y}).then(i=>{i.onDidDismiss().then(s=>{this.noti.Current=this.info.cnoti_id,this.info.cnoti_id&&this.noti.ClearNoti(this.info.cnoti_id),this.noti.RemoveListener(`openchat${this.info.cnoti_id}`)}),this.noti.Current="GroupServerPage",i.present(),this.lock_modal_open=!1}):this.modalCtrl.create({component:H.r,componentProps:{info:{user:this.nakama.load_other_user(t.sender_id,this.isOfficial,this.target)},group:this.info,has_admin:!1}}).then(i=>{i.onDidDismiss().then(s=>{this.noti.Current=this.info.cnoti_id,this.info.cnoti_id&&this.noti.ClearNoti(this.info.cnoti_id),this.noti.RemoveListener(`openchat${this.info.cnoti_id}`)}),this.noti.Current="OthersProfilePage",i.present(),this.lock_modal_open=!1}))}ionViewWillLeave(){this.nakama.rearrange_channels(),this.nakama.channels_orig[this.isOfficial][this.target]&&this.nakama.channels_orig[this.isOfficial][this.target][this.info.id]&&delete this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].update,this.noti.Current=void 0}ngOnDestroy(){this.indexed.GetFileListFromDB("tmp_files",t=>{t.forEach(i=>this.indexed.removeFileFromUserPath(i))}),delete this.nakama.opened_page_info.channel,this.nakama.ChatroomLinkAct=void 0,this.p5canvas&&this.p5canvas.remove(),this.nakama.OnTransferMessage={}}}return(o=c).\u0275fac=function(t){return new(t||o)(e.Y36(y.IN),e.Y36(y.SH),e.Y36(T.gz),e.Y36(T.F0),e.Y36(j.a),e.Y36(G.J),e.Y36(W.g),e.Y36(K.H),e.Y36(z.b),e.Y36(X.H7),e.Y36(ee.AN),e.Y36(y.HT),e.Y36(m.V1),e.Y36(k.V),e.Y36(g.F),e.Y36(f.T),e.Y36(y.Br))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-chat-room"]],decls:44,vars:22,consts:[["slot","start"],["defaultHref","subscribes"],["class","top_icon","slot","end","name","eye-outline",3,"click",4,"ngIf"],["class","top_icon","slot","end","name","eye-off-outline",3,"click",4,"ngIf"],[1,"header_online_circle"],["id","p5Drop_chatroom",2,"position","absolute","width","100%","height","100%","display","flex","pointer-events","none"],["id","main_table",2,"width","100%","height","100%","background-color","var(--chatroom-background)"],[2,"height","100%"],[2,"vertical-align","top"],["id","chatroom_div",1,"main",2,"max-width","100vw"],["button","",3,"disabled","click"],[3,"click",4,"ngFor","ngForOf"],["style","padding-top: 8px; z-index: 0;","button","",3,"click",4,"ngIf"],[1,"thumnails"],["class","thumnail_parts",3,"click",4,"ngIf"],["class","thumnail_parts",4,"ngIf"],["id","input_table",2,"width","100%","background-color","var(--chatroom-input-background)"],["fill","clear",1,"ion-text-center",3,"disabled","click"],["name","add"],[2,"width","100%","vertical-align","bottom"],[1,"TextAreaInput",3,"id","ngModel","placeholder","ngModelChange","keyup","keydown","click"],["fill","clear","expand","block",3,"disabled","click"],["name","send"],["id","ext_menu",3,"hidden"],[1,"expanded"],["hidden","","type","file","accept","*","multiple","",3,"id","change"],["style","display: inline-block;",4,"ngFor","ngForOf"],["slot","end","name","eye-outline",1,"top_icon",3,"click"],["slot","end","name","eye-off-outline",1,"top_icon",3,"click"],[3,"click"],["style","text-align: center; font-size: 16px; padding-top: 8px;",4,"ngIf"],["class","message_form",4,"ngIf"],["class","quickShare_form",3,"click",4,"ngIf"],["class","file_message_form",3,"click",4,"ngIf"],["class","notice_form",4,"ngIf"],["class","message_content_form",4,"ngIf"],["class","read_last_here",4,"ngIf"],[2,"text-align","center","font-size","16px","padding-top","8px"],["color","#888"],[1,"message_form"],[1,"message_span_form",3,"click"],[3,"color"],[1,"time_form"],[1,"quickShare_form",3,"click"],[1,"file_message_form",3,"click"],["class","file_button",4,"ngIf"],["class","file_name_form",4,"ngIf"],["class","transfer_count",4,"ngIf"],[1,"file_button"],[1,"file_info"],["class","text_seperator",4,"ngIf"],["class","file_text_thumbnail",4,"ngFor","ngForOf"],[1,"text_seperator"],[1,"file_text_thumbnail"],[1,"file_name_form"],[1,"file_thumbnail",3,"src","alt"],[1,"transfer_count"],[1,"notice_form"],[1,"notice"],[1,"message_content_form"],[4,"ngFor","ngForOf"],[3,"style",4,"ngIf"],["target","_system",3,"href",4,"ngIf"],["target","_system",3,"href"],[1,"read_last_here"],["class","comp_local_content",4,"ngIf"],["class","comp_local_content","target","_system",3,"href",4,"ngIf"],[1,"comp_local_content"],["target","_system",1,"comp_local_content",3,"href"],["button","",2,"padding-top","8px","z-index","0",3,"click"],[1,"thumnail_parts",3,"click"],[2,"padding","8px","text-align","center"],[1,"thumnail_parts"],[3,"click",4,"ngIf"],[2,"text-align","center","margin-top","4px"],[4,"ngIf"],["style","display: grid;","class","thumnail_parts",4,"ngIf"],["id","ChatroomSelectedImage","class","image_thumbnail",3,"src","alt",4,"ngIf"],["id","ChatroomSelectedImage",1,"image_thumbnail",3,"src","alt"],[1,"thumnail_parts",2,"display","grid"],[2,"text-align","center","padding","4px 0px"],[1,"bottom_thumbnail"],[2,"display","inline-block"],[1,"ext_button",3,"hidden","click"],["slot","icon-only","style","width: 36px; height: 36px;",3,"name",4,"ngIf"],["class","ext_icon_img",3,"src","alt",4,"ngIf"],["slot","icon-only",2,"width","36px","height","36px",3,"name"],[1,"ext_icon_img",3,"src","alt"]],template:function(t,i){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e._uU(3),e.qZA(),e.TgZ(4,"ion-buttons",0),e._UZ(5,"ion-back-button",1),e.qZA(),e.YNc(6,p,1,0,"ion-icon",2),e.YNc(7,x,1,0,"ion-icon",3),e._UZ(8,"div",4),e.qZA()(),e.TgZ(9,"ion-content"),e._UZ(10,"div",5),e.TgZ(11,"table",6)(12,"tr",7)(13,"td",8)(14,"div",9)(15,"ion-item",10),e.NdJ("click",function(){return i.pull_msg_history()}),e.TgZ(16,"ion-label"),e._uU(17),e.qZA()(),e.YNc(18,me,9,8,"div",11),e.YNc(19,Re,4,3,"div",11),e.YNc(20,Oe,3,1,"ion-item",12),e.qZA(),e.TgZ(21,"table",13),e.YNc(22,Pe,4,1,"tr",14),e.YNc(23,Ue,3,1,"tr",15),e.YNc(24,Je,3,1,"tr",14),e.YNc(25,He,6,4,"tr",14),e.qZA()()(),e.TgZ(26,"tr")(27,"td")(28,"div")(29,"table",16)(30,"tr")(31,"td")(32,"ion-button",17),e.NdJ("click",function(){return i.open_ext_with_delay()}),e._UZ(33,"ion-icon",18),e.qZA()(),e.TgZ(34,"td",19)(35,"textarea",20),e.NdJ("ngModelChange",function(r){return i.userInput.text=r})("keyup",function(r){return i.check_key(r)})("keydown",function(r){return i.check_key(r)})("click",function(){return i.make_ext_hidden()}),e.qZA()(),e.TgZ(36,"td")(37,"ion-button",21),e.NdJ("click",function(){return i.send(!1)}),e._UZ(38,"ion-icon",22),e.qZA()()()()()()(),e.TgZ(39,"tr",23)(40,"td")(41,"div",24)(42,"input",25),e.NdJ("change",function(r){return i.inputFileSelected(r)}),e.qZA(),e.YNc(43,Ye,4,5,"div",26),e.qZA()()()()()),2&t&&(e.xp6(3),e.Oqu(i.info.title||i.lang.text.ChatRoom.noname_chatroom),e.xp6(3),e.Q6J("ngIf",!i.info.HideAutoThumbnail),e.xp6(1),e.Q6J("ngIf",i.info.HideAutoThumbnail),e.xp6(1),e.Akn("background-color: "+i.statusBar.colors[i.info.status||"offline"]),e.xp6(7),e.Q6J("disabled",void 0===i.next_cursor&&!i.ViewMsgIndex||!i.pullable),e.xp6(2),e.Oqu(i.lang.text.ChatRoom.fetch_previous_chat),e.xp6(1),e.Q6J("ngForOf",i.ViewableMessage),e.xp6(1),e.Q6J("ngForOf",i.sending_msg),e.xp6(1),e.Q6J("ngIf",i.ShowRecentMsg),e.xp6(2),e.Q6J("ngIf",i.userInput.quickShare),e.xp6(1),e.Q6J("ngIf",i.userInput.file),e.xp6(1),e.Q6J("ngIf",i.ShowGoToBottom&&!i.last_message_viewer.user_id),e.xp6(1),e.Q6J("ngIf",i.last_message_viewer.user_id),e.xp6(7),e.Q6J("disabled","offline"==((i.info.status?i.info.status:i.info.info.status)||"offline")),e.xp6(3),e.Q6J("id",i.ChannelUserInputId)("ngModel",i.userInput.text)("placeholder",i.inputPlaceholder),e.xp6(2),e.Q6J("disabled",!i.info.status||"missing"==i.info.status||"offline"==i.info.status),e.xp6(2),e.Q6J("hidden",i.isHidden),e.xp6(3),e.Q6J("id",i.file_sel_id),e.xp6(1),e.Q6J("ngForOf",i.extended_buttons))},dependencies:[V.sg,V.O5,n.Fj,n.JJ,n.On,y.oU,y.YG,y.Sm,y.W2,y.Gu,y.gu,y.Ie,y.Q$,y.wd,y.sr,y.cs],styles:[".top_icon[_ngcontent-%COMP%]{width:28px;height:28px;padding-right:60px}.main[_ngcontent-%COMP%]{width:100%;height:100%;padding:8px;overflow-x:hidden;overflow-y:auto;scroll-behavior:smooth}.message_form[_ngcontent-%COMP%]{margin:8px 0 0}.message_span_form[_ngcontent-%COMP%]{margin-right:8px}.time_form[_ngcontent-%COMP%]{font-size:12px;color:#888}.file_message_form[_ngcontent-%COMP%]{display:flex}.file_name_form[_ngcontent-%COMP%]{margin-top:4px;max-width:192px;max-height:192px}.file_thumbnail[_ngcontent-%COMP%]{max-width:192px;max-height:192px;width:auto;height:auto}.file_info[_ngcontent-%COMP%]{margin:0}.file_text_thumbnail[_ngcontent-%COMP%]{margin-top:2px;display:grid}.quickShare_form[_ngcontent-%COMP%]{border-radius:16px;max-width:156px;width:-moz-fit-content;width:fit-content;height:-moz-fit-content;height:fit-content;padding:8px;margin:8px 0;text-align:center;vertical-align:middle;word-break:keep-all;overflow:hidden;background-color:var(--chatroom-you-read-here-backgruond)}.message_content_form[_ngcontent-%COMP%]{margin:4px 0 0}.comp_local_content[_ngcontent-%COMP%]{color:#888}.text_seperator[_ngcontent-%COMP%]{background-color:#fff;margin-top:2px;position:relative;width:100%;height:2px}.expanded[_ngcontent-%COMP%]{height:240px;overflow-x:hidden;overflow-y:auto;scroll-behavior:smooth;text-align:center;background-color:var(--chatroom-input-background)}.ext_button[_ngcontent-%COMP%]{width:64px;height:48px;margin:24px 12px 0;text-align:center}.ext_button_icon[_ngcontent-%COMP%]{width:72px;height:72px}.file_button[_ngcontent-%COMP%]{width:160px;height:112px;overflow:hidden;background-color:gray;margin-top:4px}#send_thumbnail[_ngcontent-%COMP%]{width:100%;max-width:100vw;height:-moz-fit-content;height:fit-content;max-height:160px;transform:translateY(-100%);position:relative;background:rgba(187,187,187,.7333333333);padding:8px;overflow:hidden}.bottom_thumbnail[_ngcontent-%COMP%]{width:100%;max-width:100vw;max-height:96px;overflow:hidden;padding:8px}.image_thumbnail[_ngcontent-%COMP%]{width:auto;max-height:96px;height:auto;object-fit:contain;display:block;margin:auto;padding:8px}.thumnails[_ngcontent-%COMP%]{width:100%;height:-moz-fit-content;height:fit-content;position:relative;transform:translateY(-100%);background:var(--chatroom-last-msg-viewer-bg);padding:8px}.thumnail_parts[_ngcontent-%COMP%]{max-height:96px;overflow-y:scroll}.transfer_count[_ngcontent-%COMP%]{align-self:flex-end;margin-left:4px}.notice_form[_ngcontent-%COMP%]{text-align:center;margin:12px}.notice[_ngcontent-%COMP%]{font-size:12px;display:inline;background:#444;border-radius:8px;padding:4px 8px;color:#fff}.read_last_here[_ngcontent-%COMP%]{text-align:center;font-size:12px;display:inherit;background:var(--chatroom-you-read-here-backgruond);margin:4px 0;color:var(--chatroom-you-read-here-text)}.ext_icon_img[_ngcontent-%COMP%]{max-width:36px;max-height:36px}.TextAreaInput[_ngcontent-%COMP%]{width:100%;height:36px;max-height:156px;resize:none;padding:6px;margin-top:5px;border:0;overflow:hidden;background-color:var(--chatroom-input-background)}"]}),c})()},{path:"ionic-viewer",loadChildren:()=>u.e(1277).then(u.bind(u,1277)).then(o=>o.IonicViewerPageModule)},{path:"void-draw",loadChildren:()=>u.e(4139).then(u.bind(u,4139)).then(o=>o.VoidDrawPageModule)},{path:"quick-share-review",loadChildren:()=>u.e(3556).then(u.bind(u,3556)).then(o=>o.QuickShareReviewPageModule)}];let Be=(()=>{var o;class c{}return(o=c).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[T.Bz.forChild(Ee),T.Bz]}),c})(),je=(()=>{var o;class c{}return(o=c).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[V.ez,n.u5,y.Pc,Be]}),c})()},5470:(ie,Q,u)=>{u.d(Q,{y:()=>ee});var V=u(5861),n=u(9468),y=u(3857),T=u(1325),w=u(9080),L=u(9376),H=u(6052),P=u(6814),F=u(95);function N(m,k){1&m&&n._UZ(0,"ion-icon",14)}function D(m,k){1&m&&n._UZ(0,"ion-icon",15)}function q(m,k){if(1&m){const g=n.EpF();n.TgZ(0,"ion-accordion",6)(1,"ion-item",7),n.YNc(2,N,1,0,"ion-icon",8),n.YNc(3,D,1,0,"ion-icon",9),n.TgZ(4,"ion-label"),n._uU(5),n.qZA()(),n.TgZ(6,"ion-list",10)(7,"ion-item",3),n.NdJ("click",function(){const x=n.CHM(g).$implicit;return n.KtG(x.grant=!x.grant)}),n.TgZ(8,"ion-toggle",11),n.NdJ("ngModelChange",function(p){const I=n.CHM(g).$implicit;return n.KtG(I.grant=p)}),n._uU(9),n.qZA()(),n.TgZ(10,"ion-item",12)(11,"ion-label"),n._uU(12),n.qZA(),n.TgZ(13,"ion-label",13),n._uU(14),n.qZA()(),n.TgZ(15,"ion-item",12)(16,"ion-label"),n._uU(17),n.qZA(),n.TgZ(18,"ion-label",13),n._uU(19),n.qZA()(),n.TgZ(20,"ion-item",12)(21,"ion-label"),n._uU(22),n.qZA(),n.TgZ(23,"ion-label",13),n._uU(24),n.qZA()(),n.TgZ(25,"ion-item",12)(26,"ion-toggle",11),n.NdJ("ngModelChange",function(p){const I=n.CHM(g).$implicit;return n.KtG(I.value.isSSL=p)}),n._uU(27),n.qZA()()()()}if(2&m){const g=k.$implicit,f=k.index,p=n.oxw(2);n.Q6J("value",f),n.xp6(2),n.Q6J("ngIf",!g.grant),n.xp6(1),n.Q6J("ngIf",g.grant),n.xp6(2),n.Oqu(g.value.name),n.xp6(3),n.Q6J("ngModel",g.grant),n.xp6(1),n.Oqu(p.lang.text.QuickShareReview.QuickShareGrant),n.xp6(3),n.Oqu(p.lang.text.GroupServer.Address),n.xp6(2),n.Oqu(g.value.address),n.xp6(3),n.Oqu(p.lang.text.GroupServer.Port),n.xp6(2),n.Oqu(g.value.port||7350),n.xp6(3),n.Oqu(p.lang.text.GroupServer.Key),n.xp6(2),n.Oqu(g.value.key||"defaultkey"),n.xp6(2),n.Q6J("ngModel",g.value.isSSL),n.xp6(1),n.Oqu(p.lang.text.GroupServer.isSSL)}}function Y(m,k){if(1&m&&(n.TgZ(0,"div")(1,"ion-item-divider")(2,"ion-label"),n._uU(3),n.qZA()(),n.TgZ(4,"ion-accordion-group"),n.YNc(5,q,28,14,"ion-accordion",5),n.qZA()()),2&m){const g=n.oxw();n.xp6(3),n.Oqu(g.lang.text.QuickShareReview.Servers),n.xp6(2),n.Q6J("ngForOf",g.servers)}}function E(m,k){1&m&&n._UZ(0,"ion-icon",14)}function B(m,k){1&m&&n._UZ(0,"ion-icon",15)}function e(m,k){if(1&m){const g=n.EpF();n.TgZ(0,"ion-accordion",6)(1,"ion-item",7),n.YNc(2,E,1,0,"ion-icon",8),n.YNc(3,B,1,0,"ion-icon",9),n.TgZ(4,"ion-label"),n._uU(5),n.qZA()(),n.TgZ(6,"ion-list",10)(7,"ion-item",3),n.NdJ("click",function(){const x=n.CHM(g).$implicit;return n.KtG(x.grant=!x.grant)}),n.TgZ(8,"ion-toggle",11),n.NdJ("ngModelChange",function(p){const I=n.CHM(g).$implicit;return n.KtG(I.grant=p)}),n._uU(9),n.qZA()()()()}if(2&m){const g=k.$implicit,f=k.index,p=n.oxw(2);n.Q6J("value",f),n.xp6(2),n.Q6J("ngIf",!g.grant),n.xp6(1),n.Q6J("ngIf",g.grant),n.xp6(2),n.Oqu(g.name),n.xp6(3),n.Q6J("ngModel",g.grant),n.xp6(1),n.Oqu(p.lang.text.QuickShareReview.QuickShareGrant)}}function j(m,k){if(1&m&&(n.TgZ(0,"div")(1,"ion-item-divider")(2,"ion-label"),n._uU(3),n.qZA()(),n.TgZ(4,"ion-accordion-group"),n.YNc(5,e,10,6,"ion-accordion",5),n.qZA()()),2&m){const g=n.oxw();n.xp6(3),n.Oqu(g.lang.text.QuickShareReview.Channels),n.xp6(2),n.Q6J("ngForOf",g.groups)}}function G(m,k){1&m&&n._UZ(0,"ion-icon",14)}function W(m,k){1&m&&n._UZ(0,"ion-icon",15)}function K(m,k){if(1&m&&(n.TgZ(0,"ion-item")(1,"ion-label"),n._uU(2),n.qZA()()),2&m){const g=k.$implicit;n.xp6(2),n.Oqu(g)}}function z(m,k){if(1&m){const g=n.EpF();n.TgZ(0,"ion-accordion",6)(1,"ion-item",7),n.YNc(2,G,1,0,"ion-icon",8),n.YNc(3,W,1,0,"ion-icon",9),n.TgZ(4,"ion-label"),n._uU(5),n.qZA()(),n.TgZ(6,"ion-list",10),n.YNc(7,K,3,1,"ion-item",16),n.TgZ(8,"ion-item",3),n.NdJ("click",function(){const x=n.CHM(g).$implicit;return n.KtG(x.grant=!x.grant)}),n.TgZ(9,"ion-toggle",11),n.NdJ("ngModelChange",function(p){const I=n.CHM(g).$implicit;return n.KtG(I.grant=p)}),n._uU(10),n.qZA()()()()}if(2&m){const g=k.$implicit,f=k.index,p=n.oxw(2);n.Q6J("value",f),n.xp6(2),n.Q6J("ngIf",!g.grant),n.xp6(1),n.Q6J("ngIf",g.grant),n.xp6(2),n.Oqu(g.value.urls[0]),n.xp6(2),n.Q6J("ngForOf",g.value.urls),n.xp6(2),n.Q6J("ngModel",g.grant),n.xp6(1),n.Oqu(p.lang.text.QuickShareReview.QuickShareGrant)}}function X(m,k){if(1&m&&(n.TgZ(0,"div")(1,"ion-item-divider")(2,"ion-label"),n._uU(3),n.qZA()(),n.TgZ(4,"ion-accordion-group"),n.YNc(5,z,11,7,"ion-accordion",5),n.qZA()()),2&m){const g=n.oxw();n.xp6(3),n.Oqu(g.lang.text.QuickShareReview.Channels),n.xp6(2),n.Q6J("ngForOf",g.rtcserver)}}let ee=(()=>{var m;class k{constructor(f,p,x,I,Z,U){this.lang=f,this.navParams=p,this.modalCtrl=x,this.nakama=I,this.p5toast=Z,this.global=U,this.servers=[],this.groups=[],this.rtcserver=[]}ngOnInit(){var f=this;return(0,V.Z)(function*(){let p=f.navParams.get("data"),x=f.global.CatchGETs(p),I=yield f.nakama.AddressToQRCodeAct(x,!0);for(let Z=0,U=I.length;Z<U;Z++)switch(I[Z].type){case"server":f.servers.push(I[Z]);break;case"group":f.groups.push(I[Z]);break;case"rtcserver":f.rtcserver.push(I[Z])}})()}apply_selected(){var f=this;return(0,V.Z)(function*(){let p=[];for(let x=0,I=f.servers.length;x<I;x++)f.servers[x].grant&&p.push(f.servers[x]);for(let x=0,I=f.groups.length;x<I;x++)f.groups[x].grant&&p.push(f.groups[x]);for(let x=0,I=f.rtcserver.length;x<I;x++)f.rtcserver[x].grant&&p.push(f.rtcserver[x]);yield f.nakama.act_from_QRInfo(p),f.p5toast.show({text:f.lang.text.QuickQRShare.success_received,lateable:!0}),f.modalCtrl.dismiss()})()}}return(m=k).\u0275fac=function(f){return new(f||m)(n.Y36(y.b),n.Y36(T.X1),n.Y36(T.IN),n.Y36(w.a),n.Y36(L.F),n.Y36(H.AN))},m.\u0275cmp=n.Xpm({type:m,selectors:[["app-quick-share-review"]],decls:14,vars:5,consts:[["slot","start",3,"click"],["defaultHref",""],[4,"ngIf"],["button","",3,"click"],[1,"ion-text-center"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["slot","header"],["color","danger","slot","start","name","close-outline",4,"ngIf"],["color","success","slot","start","name","checkmark-outline",4,"ngIf"],["slot","content"],[1,"ion_toggle_ignore",3,"ngModel","ngModelChange"],["button",""],[1,"ion-text-end"],["color","danger","slot","start","name","close-outline"],["color","success","slot","start","name","checkmark-outline"],[4,"ngFor","ngForOf"]],template:function(f,p){1&f&&(n.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),n._uU(3),n.qZA(),n.TgZ(4,"ion-buttons",0),n.NdJ("click",function(){return p.modalCtrl.dismiss()}),n._UZ(5,"ion-back-button",1),n.qZA()()(),n.TgZ(6,"ion-content"),n.YNc(7,Y,6,2,"div",2),n.YNc(8,j,6,2,"div",2),n.YNc(9,X,6,2,"div",2),n.qZA(),n.TgZ(10,"ion-footer")(11,"ion-item",3),n.NdJ("click",function(){return p.apply_selected()}),n.TgZ(12,"ion-label",4),n._uU(13),n.qZA()()()),2&f&&(n.xp6(3),n.Oqu(p.lang.text.QuickShareReview.Title),n.xp6(4),n.Q6J("ngIf",p.servers.length),n.xp6(1),n.Q6J("ngIf",p.groups.length),n.xp6(1),n.Q6J("ngIf",p.rtcserver.length),n.xp6(4),n.Oqu(p.lang.text.QuickShareReview.ApplyChecked))},dependencies:[P.sg,P.O5,F.JJ,F.On,T.We,T.eh,T.oU,T.Sm,T.W2,T.fr,T.Gu,T.gu,T.Ie,T.rH,T.Q$,T.q_,T.wd,T.ho,T.sr,T.w,T.cs],styles:[".ion_toggle_ignore[_ngcontent-%COMP%]{pointer-events:none}"]}),k})()}}]);