"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2655],{2655:(U,y,l)=>{l.r(y),l.d(y,{CommunityPageModule:()=>E});var C=l(177),P=l(4341),c=l(5374),f=l(9858),u=l(467),v=l(7447),x=l(5071),b=l(4164),t=l(3953),S=l(8065),M=l(4237),O=l(4234),T=l(3295),j=l(3656),D=l(755);function I(n,r){if(1&n&&t.nrm(0,"img",18),2&n){const a=t.XpG().$implicit;t.Aen(a.isNSFW?"filter: blur(16px);":""),t.Y8G("src",a.mainImage.thumbnail,t.B4B)}}function R(n,r){if(1&n&&(t.j41(0,"span",19),t.EFF(1),t.k0s()),2&n){const a=t.XpG().$implicit,e=t.XpG(2);t.R7$(),t.SpI(" ","("+(a.server?a.server.name||a.server.target:e.lang.text.AddGroup.UseLocalStorage)+")"," ")}}function $(n,r){if(1&n){const a=t.RV6();t.j41(0,"ion-card",11),t.bIt("click",function(){const o=t.eBV(a),i=o.$implicit,s=o.index,h=t.XpG(2);return t.Njj(h.open_post(i,s))})("contextmenu",function(){const o=t.eBV(a).$implicit,i=t.XpG(2);return t.Njj(i.PostContextMenu(o))}),t.DNE(1,I,1,3,"img",12),t.j41(2,"ion-card-header")(3,"ion-card-subtitle",13)(4,"span",14),t.bIt("click",function(){const o=t.eBV(a).$implicit,i=t.XpG(2);return t.Njj(i.open_profile(o))}),t.EFF(5),t.k0s(),t.DNE(6,R,2,1,"span",15),t.k0s(),t.j41(7,"ion-card-title",16),t.EFF(8),t.k0s()(),t.j41(9,"ion-card-content",17),t.EFF(10),t.k0s()()}if(2&n){const a=r.$implicit,e=t.XpG(2);t.R7$(),t.Y8G("ngIf",a.mainImage),t.R7$(3),t.Aen("color: #"+a.UserColor),t.R7$(),t.SpI(" ",a.creator_name," "),t.R7$(),t.Y8G("ngIf",e.nakama.showServer),t.R7$(2),t.JRh(a.title),t.R7$(2),t.SpI(" ",a.content," ")}}function G(n,r){1&n&&t.nrm(0,"div",20)}function A(n,r){if(1&n&&(t.j41(0,"div",8),t.DNE(1,$,11,7,"ion-card",9)(2,G,1,0,"div",10),t.k0s()),2&n){const a=t.XpG();t.R7$(),t.Y8G("ngForOf",a.nakama.posts),t.R7$(),t.Y8G("ngIf",a.is_auto_load_end&&a.is_loadable)}}function B(n,r){if(1&n){const a=t.RV6();t.j41(0,"div")(1,"div",21),t.bIt("click",function(){t.eBV(a);const o=t.XpG();return t.Njj(o.add_post())}),t.nrm(2,"ion-icon",22),t.j41(3,"div")(4,"ion-label",23),t.EFF(5),t.k0s()()()()}if(2&n){const a=t.XpG();t.R7$(5),t.JRh(a.lang.text.Community.NoPosts)}}const F=[{path:"",component:(()=>{var n;class r{constructor(e,o,i,s,h,d,m,_){this.statusBar=e,this.nakama=o,this.lang=i,this.global=s,this.navCtrl=h,this.indexed=d,this.modalCtrl=m,this.alertCtrl=_,this.is_loadable=!0,this.is_auto_load_end=!1,this.isOpenProfile=!1}ngOnInit(){this.nakama.is_post_lock=!0,this.nakama.CommunityGoToEditPost=this.add_post}add_post(e){this.navCtrl.navigateForward("portal/community/add-post",{state:{data:e,act:!0}})}ionViewDidEnter(){var e=this;return(0,u.A)(function*(){e.is_loadable=!0,yield e.nakama.load_posts_counter(),e.nakama.has_new_post=!1,yield e.load_post_cycles(),e.is_auto_load_end=!0,e.try_add_shortcut(),e.ContentDiv&&e.ContentScroll&&e.ContentDiv.clientHeight-(e.ContentScroll.scrollTop+e.ContentScroll.clientHeight)<1&&e.load_post_cycles(),e.nakama.socket_reactive.try_load_post=()=>{setTimeout(()=>{e.ContentDiv&&e.ContentScroll&&e.ContentDiv.clientHeight-(e.ContentScroll.scrollTop+e.ContentScroll.clientHeight)<1&&e.load_post_cycles()},0)}})()}load_post_cycles(){var e=this;return(0,u.A)(function*(){e.is_loadable&&(yield e.load_posts()),e.is_loadable&&(yield e.load_posts()),setTimeout(()=>{e.ContentDiv||(e.ContentDiv=document.getElementById("CommunityMainContent")),e.ContentScroll||(e.ContentScroll=document.getElementById("CommunityScrollDiv"),e.ContentScroll.onscroll=o=>{e.ContentDiv.clientHeight-(e.ContentScroll.scrollTop+e.ContentScroll.clientHeight)<1&&e.load_post_cycles()}),e.is_loadable&&e.ContentDiv.clientHeight-(e.ContentScroll.scrollTop+e.ContentScroll.clientHeight)<1&&e.load_post_cycles()},100)})()}PostContextMenu(e){let o;for(let i=0,s=this.nakama.posts.length;i<s;i++)if(this.nakama.posts[i].id==e.id){o=i;break}try{(this.nakama.posts[o].server.local||this.nakama.posts[o].creator_id==this.nakama.servers[this.nakama.posts[o].server.isOfficial][this.nakama.posts[o].server.target].session.user_id)&&this.alertCtrl.create({header:this.nakama.posts[o].title,message:this.nakama.posts[o].content,buttons:[{text:this.lang.text.ChatRoom.EditChat,handler:()=>{this.nakama.EditPost(this.nakama.posts[o])}},{text:this.lang.text.ChatRoom.Delete,handler:()=>{this.nakama.RemovePost(this.nakama.posts[o])},cssClass:"redfont"}]}).then(i=>i.present())}catch{}return!1}try_add_shortcut(){this.global.p5key&&this.global.p5key.KeyShortCut?this.AddShortcut():setTimeout(()=>{this.try_add_shortcut()},100)}load_posts(){var e=this;return(0,u.A)(function*(){let o=!1,i=Object.keys(e.nakama.post_counter);for(let s=0,h=i.length;s<h;s++){let d=Object.keys(e.nakama.post_counter[i[s]]);for(let m=0,_=d.length;m<_;m++){let g=Object.keys(e.nakama.post_counter[i[s]][d[m]]);for(let p=0,w=g.length;p<w;p++){let k="me"==g[p];try{"me"!=g[p]&&(k=g[p]==e.nakama.servers[i[s]][d[m]].session.user_id)}catch{}let K=e.nakama.post_counter[i[s]][d[m]][g[p]];yield e.load_post_step_by_step(K,i[s],d[m],g[p],k),!o&&e.nakama.post_counter[i[s]][d[m]][g[p]]>=0&&(o=!0)}}}e.is_loadable=o,e.nakama.rearrange_posts()})()}load_post_step_by_step(e,o,i,s,h){var d=this;return(0,u.A)(function*(){if(e<0)return;let m=yield d.nakama.load_local_post_with_id(`LocalPost_${e}`,o,i,s);if(!m&&"me"!=s)try{m=yield d.nakama.load_server_post_with_id(`ServerPost_${e}`,o,i,s,h)}catch{}d.nakama.post_counter[o][i][s]--,m||(yield d.load_post_step_by_step(d.nakama.post_counter[o][i][s],o,i,s,h))})()}open_profile(e){if(this.isOpenProfile=!0,"me"==e.creator_id)this.modalCtrl.create({component:v.Q}).then(o=>o.present());else{let o=e.server.isOfficial,i=e.server.target,s=e.creator_id;e.is_me?this.modalCtrl.create({component:v.Q,componentProps:{isOfficial:o,target:i}}).then(h=>h.present()):this.modalCtrl.create({component:b.C,componentProps:{info:{user:this.nakama.load_other_user(s,o,i)},group:{server:{isOfficial:o,target:i}}}}).then(h=>h.present())}setTimeout(()=>{this.isOpenProfile=!1},0)}catchBottomTabShortCut(){this.BottomTabShortcut=this.global.p5key.KeyShortCut.BottomTab,delete this.global.p5key.KeyShortCut.BottomTab}open_post(e,o){this.isOpenProfile||(this.isOpenProfile=!0,this.modalCtrl.create({component:x.Y,componentProps:{data:e,index:o+1}}).then(i=>{delete this.global.p5key.KeyShortCut.Digit,delete this.global.p5key.KeyShortCut.AddAct,this.catchBottomTabShortCut(),i.onWillDismiss().then(()=>{this.global.p5key.KeyShortCut.BottomTab=this.BottomTabShortcut}),i.onDidDismiss().then(s=>{s.data||this.AddShortcut()}),i.present()}),setTimeout(()=>{this.isOpenProfile=!1},0))}AddShortcut(){this.global.p5key&&this.global.p5key.KeyShortCut&&(this.global.p5key.KeyShortCut.Digit=e=>{this.nakama.posts.length>e?this.open_post(this.nakama.posts[e],e):this.add_post()}),this.global.p5key&&this.global.p5key.KeyShortCut&&!this.global.p5key.KeyShortCut.AddAct&&(this.global.p5key.KeyShortCut.AddAct=()=>{this.add_post()})}ionViewWillLeave(){delete this.global.p5key.KeyShortCut.Digit,delete this.global.p5key.KeyShortCut.AddAct,delete this.nakama.socket_reactive.try_load_post,this.nakama.is_post_lock=!1}}return(n=r).\u0275fac=function(e){return new(e||n)(t.rXU(S.j),t.rXU(M.X),t.rXU(O.y),t.rXU(T.z3),t.rXU(j.q9),t.rXU(D.n),t.rXU(c.W3),t.rXU(c.hG))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-community"]],decls:12,vars:5,consts:[[1,"ion-no-border"],[1,"add_post",3,"click"],["button","","name","add-circle-outline",2,"width","24px","height","24px"],[1,"header_online_circle",3,"click"],["id","CommunityScrollDiv",2,"height","100%","overflow-y","auto"],["id","CommunityMainContent"],["style","display: ruby-text","class","CardContainerDiv",4,"ngIf"],[4,"ngIf"],[1,"CardContainerDiv",2,"display","ruby-text"],["button","","class","card_style",3,"click","contextmenu",4,"ngFor","ngForOf"],["style","width:100%; height: 72px;",4,"ngIf"],["button","",1,"card_style",3,"click","contextmenu"],["class","thumbnail_image","alt","",3,"src","style",4,"ngIf"],[1,"cardCreator"],[3,"click"],["style","color: #888; font-weight: normal;",4,"ngIf"],[1,"cardTitle"],[1,"cardContent"],["alt","",1,"thumbnail_image",3,"src"],[2,"color","#888","font-weight","normal"],[2,"width","100%","height","72px"],[1,"disconnect_info",3,"click"],["color","medium","name","document-text-outline",2,"width","60px","height","60px"],["color","medium"]],template:function(e,o){1&e&&(t.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),t.EFF(3),t.k0s(),t.j41(4,"div",1),t.bIt("click",function(){return o.add_post()}),t.nrm(5,"ion-icon",2),t.k0s(),t.j41(6,"div",3),t.bIt("click",function(){return o.nakama.toggle_all_session(!0)}),t.k0s()()(),t.j41(7,"ion-content")(8,"div",4)(9,"div",5),t.DNE(10,A,3,2,"div",6)(11,B,6,1,"div",7),t.k0s()()()),2&e&&(t.R7$(3),t.JRh(o.lang.text.Community.Title),t.R7$(3),t.Aen("background-color: "+o.statusBar.colors[o.statusBar.settings.groupServer]+"; cursor: pointer;"),t.R7$(4),t.Y8G("ngIf",o.nakama.posts.length),t.R7$(),t.Y8G("ngIf",!o.nakama.posts.length))},dependencies:[C.Sq,C.bT,c.b_,c.I9,c.ME,c.HW,c.tN,c.W9,c.eU,c.iq,c.he,c.BC,c.ai],styles:[".md[_ngcontent-%COMP%]   .add_post[_ngcontent-%COMP%]{position:absolute;right:68px;top:16px;cursor:pointer}.ios[_ngcontent-%COMP%]   .add_post[_ngcontent-%COMP%]{position:absolute;right:68px;top:10px;cursor:pointer}.md[_ngcontent-%COMP%]   .CardContainerDiv[_ngcontent-%COMP%]{padding-top:14px}.ios[_ngcontent-%COMP%]   .CardContainerDiv[_ngcontent-%COMP%]{padding-top:20px}.card_style[_ngcontent-%COMP%]{width:90%;max-width:400px;margin-top:0}.md[_ngcontent-%COMP%]   .cardCreator[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;font-weight:700;max-height:20px;overflow-y:hidden}.md[_ngcontent-%COMP%]   .cardTitle[_ngcontent-%COMP%]{max-height:24px;overflow-y:hidden}.md[_ngcontent-%COMP%]   .cardContent[_ngcontent-%COMP%]{max-height:40px;overflow-y:hidden;padding-bottom:0;margin-bottom:13px}.ios[_ngcontent-%COMP%]   .cardCreator[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;font-weight:700;max-height:20px;overflow-y:hidden}.ios[_ngcontent-%COMP%]   .cardTitle[_ngcontent-%COMP%]{max-height:34px;overflow-y:hidden}.ios[_ngcontent-%COMP%]   .cardContent[_ngcontent-%COMP%]{max-height:40px;overflow-y:hidden;padding-bottom:0;margin-bottom:13px}.thumbnail_image[_ngcontent-%COMP%]{width:100%;max-height:240px;object-fit:cover}"]}),r})()},{path:"add-post",loadChildren:()=>Promise.all([l.e(2076),l.e(7759)]).then(l.bind(l,7759)).then(n=>n.AddPostPageModule)},{path:"post-viewer",loadChildren:()=>l.e(7230).then(l.bind(l,7230)).then(n=>n.PostViewerPageModule)}];let X=(()=>{var n;class r{}return(n=r).\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[f.iI.forChild(F),f.iI]}),r})(),E=(()=>{var n;class r{}return(n=r).\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[C.MD,P.YN,c.bv,X]}),r})()}}]);