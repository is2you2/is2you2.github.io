"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3872],{9373:(C,b,p)=>{p.d(b,{I:()=>k});const k=(0,p(6400).C_)("SpeechRecognition",{web:()=>p.e(7384).then(p.bind(p,7384)).then(h=>new h.SpeechRecognitionWeb)})},8828:(C,b,p)=>{p.d(b,{_8:()=>v,on:()=>h,wd:()=>k});var v=function(g){return g.Prompt="PROMPT",g.Camera="CAMERA",g.Photos="PHOTOS",g}(v||{}),k=function(g){return g.Rear="REAR",g.Front="FRONT",g}(k||{}),h=function(g){return g.Uri="uri",g.Base64="base64",g.DataUrl="dataUrl",g}(h||{})},4120:(C,b,p)=>{p.d(b,{Ut:()=>h,_8:()=>k._8,on:()=>k.on});var v=p(6400),k=p(8828);const h=(0,v.C_)("Camera",{web:()=>p.e(9028).then(p.bind(p,9028)).then(g=>new g.CameraWeb)})},3872:(C,b,p)=>{p.r(b),p.d(b,{AddTodoMenuPageModule:()=>ge});var v=p(1368),k=p(4716),h=p(5624),g=p(3332),I=p(1528),O=p(9352),S=p(8744),T=p(7136),w=p(5193),x=p(1052),A=p(4120),M=p(9373),R=p(7048),t=p(4496),P=p(9240),E=p(4500),$=p(3824),F=p(4476),j=p(4668),Y=p(6819),N=p(4180),W=p(5020);const U=["StartCalendar"],B=["Calendar"],L=["NewAttach"],K=["StoreAt"],J=["ImporantSel"];function z(d,_){if(1&d&&(t.I0R(0,"ion-select-option",49),t.OEk(1),t.C$Y()),2&d){const u=_.$implicit;t.E7m("value",u),t.yG2(),t.oRS("",u.name," ")}}function Q(d,_){if(1&d){const u=t.KQA();t.I0R(0,"ion-item",44),t.qCj("click",function(){t.usT(u);const i=t.GaO();return t.CGJ(i.StoreAtSelClicked())}),t.I0R(1,"ion-select",45,46),t.qCj("ionChange",function(i){t.usT(u);const s=t.GaO();return t.CGJ(s.StoreAtSelChanged(i))}),t.I0R(3,"ion-select-option",47),t.OEk(4),t.C$Y(),t.yuY(5,z,2,2,"ion-select-option",48),t.C$Y()()}if(2&d){const u=t.GaO();t.yG2(),t.E7m("label",u.lang.text.TodoDetail.StoreAt),t.yG2(3),t.cNF(u.lang.text.TodoDetail.OnThisDevice),t.yG2(),t.E7m("ngForOf",u.AvailableStorageList)}}function H(d,_){if(1&d){const u=t.KQA();t.I0R(0,"div")(1,"ion-item")(2,"ion-label",50),t.OEk(3),t.C$Y(),t.I0R(4,"ion-label",51),t.OEk(5),t.C$Y()(),t.I0R(6,"ion-grid",52)(7,"ion-row")(8,"ion-col",53)(9,"ion-item",54),t.qCj("click",function(){t.usT(u);const i=t.GaO();return t.CGJ(i.doneTodo())}),t.I0R(10,"ion-label",55),t.OEk(11),t.C$Y()()()()()()}if(2&d){const u=t.GaO();t.yG2(3),t.cNF(u.userInput.display_store||u.lang.text.TodoDetail.WIP),t.yG2(2),t.cNF(u.userInput.display_creator),t.yG2(4),t.E7m("disabled",!u.isModifiable||u.isButtonClicked),t.yG2(2),t.cNF(u.lang.text.TodoDetail.TodoComplete)}}function V(d,_){if(1&d){const u=t.KQA();t.I0R(0,"ion-icon",56),t.qCj("click",function(){t.usT(u);const i=t.GaO();return t.CGJ(i.SpeechToTitleText())}),t.C$Y()}}function X(d,_){if(1&d){const u=t.KQA();t.I0R(0,"ion-item")(1,"ion-checkbox",59),t.iHE("ngModelChange",function(i){const a=t.usT(u).$implicit;return t.kNx(a.todo_checked,i)||(a.todo_checked=i),t.CGJ(i)}),t.OEk(2),t.C$Y()()}if(2&d){const u=_.$implicit;t.yG2(),t.OKB("ngModel",u.todo_checked),t.yG2(),t.cNF(u.display_name)}}function q(d,_){if(1&d){const u=t.KQA();t.I0R(0,"ion-accordion",49)(1,"ion-item",23)(2,"ion-label"),t.OEk(3),t.C$Y()(),t.I0R(4,"div",26)(5,"ion-item",13),t.qCj("click",function(){const s=t.usT(u).$implicit,a=t.GaO(2);return t.CGJ(a.toggle_all_user(s.id))}),t.I0R(6,"ion-label"),t.OEk(7),t.C$Y()(),t.yuY(8,X,3,2,"ion-item",32),t.C$Y()()}if(2&d){const u=_.$implicit,e=t.GaO(2);t.E7m("value",u.id),t.yG2(3),t.cNF(u.name),t.yG2(4),t.cNF(e.lang.text.TodoDetail.ToggleWorkers),t.yG2(),t.E7m("ngForOf",e.AvailableWorker[u.id])}}function Z(d,_){if(1&d&&(t.I0R(0,"div")(1,"ion-accordion-group",null,57)(3,"ion-accordion")(4,"ion-item",23)(5,"ion-label"),t.OEk(6),t.C$Y()(),t.I0R(7,"div",26)(8,"ion-accordion-group",null,58),t.yuY(10,q,9,4,"ion-accordion",48),t.C$Y()()()()()),2&d){const u=t.GaO();t.yG2(6),t.cNF(u.lang.text.TodoDetail.ManageWorker),t.yG2(4),t.E7m("ngForOf",u.WorkerGroups)}}function ee(d,_){if(1&d&&(t.I0R(0,"div",67),t.OEk(1),t.C$Y()),2&d){const u=t.GaO().$implicit;t.yG2(),t.cNF(u.displayTime)}}function te(d,_){1&d&&t.wR5(0,"ion-icon",68)}function ie(d,_){1&d&&t.wR5(0,"ion-icon",69)}function ae(d,_){1&d&&t.wR5(0,"ion-icon",70)}function ne(d,_){if(1&d&&(t.I0R(0,"ion-item",62)(1,"ion-label"),t.OEk(2),t.C$Y(),t.yuY(3,ee,2,1,"div",63)(4,te,1,0,"ion-icon",64)(5,ie,1,0,"ion-icon",65)(6,ae,1,0,"ion-icon",66),t.C$Y()),2&d){const u=_.$implicit;t.yG2(2),t.cNF(u.name),t.yG2(),t.E7m("ngIf",u.displayTime),t.yG2(),t.E7m("ngIf",void 0===u.isDelete),t.yG2(),t.E7m("ngIf",1==u.isDelete),t.yG2(),t.E7m("ngIf",0==u.isDelete)}}function oe(d,_){if(1&d&&(t.I0R(0,"div")(1,"ion-accordion-group",null,57)(3,"ion-accordion")(4,"ion-item",23)(5,"ion-label"),t.OEk(6),t.C$Y(),t.I0R(7,"ion-label",60),t.OEk(8),t.C$Y()(),t.I0R(9,"div",26),t.yuY(10,ne,7,5,"ion-item",61),t.C$Y()()()()),2&d){const u=t.GaO();t.yG2(6),t.cNF(u.lang.text.TodoDetail.ManageWorker),t.yG2(2),t.cNF(u.worker_done+" / "+u.userInput.workers.length),t.yG2(2),t.E7m("ngForOf",u.userInput.workers)}}function re(d,_){if(1&d){const u=t.KQA();t.I0R(0,"ion-label",71),t.qCj("click",function(){t.usT(u);const i=t.GaO();return t.CGJ(i.toggle_custom_color())}),t.OEk(1),t.C$Y()}if(2&d){const u=t.GaO();t.yG2(),t.cNF(u.lang.text.TodoDetail.SetCustomColor)}}function se(d,_){if(1&d){const u=t.KQA();t.I0R(0,"div")(1,"button",72),t.qCj("click",function(){t.usT(u);const i=t.GaO();return t.CGJ(i.toggle_custom_color())}),t.OEk(2),t.C$Y(),t.I0R(3,"input",73),t.iHE("ngModelChange",function(i){t.usT(u);const s=t.GaO();return t.kNx(s.userInput.custom_color,i)||(s.userInput.custom_color=i),t.CGJ(i)}),t.C$Y()()}if(2&d){const u=t.GaO();t.yG2(2),t.oRS(" ",u.lang.text.TodoDetail.remove," "),t.yG2(),t.OKB("ngModel",u.userInput.custom_color)}}function le(d,_){if(1&d){const u=t.KQA();t.I0R(0,"ion-item-divider")(1,"ion-label"),t.OEk(2),t.C$Y(),t.I0R(3,"ion-icon",56),t.qCj("click",function(){t.usT(u);const i=t.GaO();return t.CGJ(i.SpeechToDetailText())}),t.C$Y()()}if(2&d){const u=t.GaO();t.yG2(2),t.cNF(u.lang.text.TodoDetail.description)}}function ue(d,_){if(1&d&&t.wR5(0,"img",77),2&d){const u=t.GaO(2).$implicit;t.E7m("src",u.thumbnail,t.K6U)("alt",u.filename)}}function de(d,_){if(1&d&&(t.I0R(0,"ion-item",19)(1,"ion-label",50),t.OEk(2),t.C$Y()()),2&d){const u=t.GaO(3);t.yG2(2),t.cNF(u.lang.text.TodoDetail.open_content_viewer)}}function ce(d,_){if(1&d){const u=t.KQA();t.I0R(0,"div",44),t.qCj("click",function(){t.usT(u);const i=t.GaO().index,s=t.GaO();return t.CGJ(s.open_content_viewer(i))}),t.yuY(1,ue,1,2,"img",75)(2,de,3,1,"ion-item",76),t.C$Y()}if(2&d){const u=t.GaO().$implicit;t.yG2(),t.E7m("ngIf",u.thumbnail),t.yG2(),t.E7m("ngIf",!u.thumbnail)}}function me(d,_){if(1&d){const u=t.KQA();t.I0R(0,"div")(1,"ion-item")(2,"ion-label",74),t.OEk(3),t.C$Y(),t.I0R(4,"ion-button",44),t.qCj("click",function(){const s=t.usT(u).index,a=t.GaO();return t.CGJ(a.remove_attach(s))}),t.OEk(5),t.C$Y()(),t.yuY(6,ce,3,2,"div",9),t.C$Y()}if(2&d){const u=_.$implicit,e=t.GaO();t.yG2(3),t.cNF(u.filename),t.yG2(2),t.oRS(" ",e.lang.text.TodoDetail.delete_attach," "),t.yG2(),t.E7m("ngIf",u.viewer)}}function pe(d,_){if(1&d){const u=t.KQA();t.I0R(0,"td")(1,"ion-button",78),t.qCj("click",function(){t.usT(u);const i=t.GaO();return t.CGJ(i.deleteData())}),t.OEk(2),t.C$Y()()}if(2&d){const u=t.GaO();t.yG2(),t.E7m("disabled",!u.isModifiable||u.isButtonClicked),t.yG2(),t.oRS(" ",u.lang.text.TodoDetail.remove," ")}}const he=[{path:"",component:(()=>{var d;class _{constructor(e,i,s,a,r,n,l,o,m,c,f,y,D,G){this.route=e,this.router=i,this.modalCtrl=s,this.lang=a,this.p5toast=r,this.sanitizer=n,this.indexed=l,this.nakama=o,this.alertCtrl=m,this.noti=c,this.statusBar=f,this.loadingCtrl=y,this.global=D,this.navCtrl=G,this.userInput={id:void 0,storeAt:"local",display_store:"",title:void 0,create_at:void 0,written:void 0,startFrom:void 0,limit:void 0,custom_color:void 0,workers:void 0,importance:"0",description:void 0,remote:void 0,display_creator:void 0,attach:[],done:void 0,noti_id:void 0},this.isMobile=!1,this.BackButtonPressed=!1,this.buttonDisplay={saveTodo:this.lang.text.TodoDetail.buttonDisplay_add},this.AmICreator=!0,this.isModify=!1,this.isModifiable=!1,this.isLimitChangable=!1,this.normal_color="#888b",this.alert_color="#0bbb",this.AlertLerpStartFrom=.8,this.input_ele_ids=[],this.file_sel_id="",this.AvailableStorageList=[],this.isManager=!1,this.AvailableWorker={},this.WorkerGroups=[],this.toggle_logs={},this.worker_done=0,this.isButtonClicked=!1,this.WillLeavePage=!1}ngOnInit(){var e=this;if(window.history.pushState(null,null,window.location.href),window.onpopstate=()=>{this.BackButtonPressed||(this.BackButtonPressed=!0,this.navCtrl.back())},this.MainDiv=document.getElementById("main_div"),this.isMobile="Android"==w.s1||"iOS"==w.s1,this.nakama.removeBanner(),this.route.queryParams.subscribe(i=>{const s=this.router.getCurrentNavigation().extras.state;s&&(this.received_data=s.data),this.received_data&&(this.userInput={...this.userInput,...JSON.parse(this.received_data)})}),this.nakama.AddTodoLinkAct=function(){var i=(0,I.c)(function*(s){e.nakama.removeBanner(),e.p5timer&&e.p5timer.remove(),e.received_data=s,e.userInput=JSON.parse(e.received_data),yield e.ionViewWillEnter(),e.show_count_timer()});return function(s){return i.apply(this,arguments)}}(),this.nakama.AddTodoManageUpdateAct=(i,s,a,r)=>{if(this.userInput.id==i)for(let n=0,l=this.userInput.workers.length;n<l;n++)if((this.userInput.workers[n].user_id||this.userInput.workers[n].id)==s){this.userInput.workers[n].isDelete=a,this.userInput.workers[n].timestamp=r,this.userInput.workers[n].displayTime=new Date(r).toLocaleString(),this.worker_done++;break}},"DesktopPWA"==w.s1&&setTimeout(()=>{this.CreateDrop()},0),this.userInput.workers)for(let i=0,s=this.userInput.workers.length;i<s;i++)this.userInput.workers[i].timestamp&&(this.userInput.workers[i].displayTime=new Date(this.userInput.workers[i].timestamp).toLocaleString(),this.worker_done++)}CreateDrop(){var e=this;let i=document.getElementById("p5Drop_todo");this.p5canvas=new O(s=>{s.setup=()=>{let a=s.createCanvas(i.clientWidth,i.clientHeight);a.parent(i),s.pixelDensity(1),a.drop(function(){var r=(0,I.c)(function*(n){yield e.selected_blobFile_callback_act(n.file)});return function(n){return r.apply(this,arguments)}}())},s.mouseMoved=a=>{a.dataTransfer?(i.style.pointerEvents="all",i.style.backgroundColor="#0008"):(i.style.pointerEvents="none",i.style.backgroundColor="transparent")}})}selected_blobFile_callback_act(e){var i=this;return(0,I.c)(function*(){let s=yield i.loadingCtrl.create({message:i.lang.text.TodoDetail.WIP});s.present();let a={};a.filename=e.name,a.file_ext=e.name.substring(e.name.lastIndexOf(".")+1),a.size=e.size,a.type=e.type,a.path=`tmp_files/todo/${a.filename}`,a.blob=e,a.content_related_creator=[{timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"loaded"}],a.content_creator={timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"loaded"};let r=!1;r=yield i.indexed.checkIfFileExist(a.path),i.userInput.id&&!r&&(r=yield i.indexed.checkIfFileExist(`todo/${i.userInput.id}/${a.filename}`)),r&&(a.filename=`${a.filename.substring(0,a.filename.lastIndexOf("."))}_.${a.file_ext}`),i.global.set_viewer_category(a);let n=URL.createObjectURL(e);"image"==a.viewer&&(a.thumbnail=i.sanitizer.bypassSecurityTrustUrl(n));try{yield i.indexed.saveBlobToUserPath(e,a.path),i.userInput.attach.push(a),setTimeout(()=>{URL.revokeObjectURL(n)},0),s.dismiss()}catch(l){console.error("\ud30c\uc77c \uc62c\ub9ac\uae30 \uc2e4\ud328: ",l),i.p5toast.show({text:i.lang.text.TodoDetail.load_failed}),s.dismiss()}i.auto_scroll_down()})()}ionViewWillEnter(){var e=this;return(0,I.c)(function*(){let r,i=[];if(Object.keys(e.nakama.servers).forEach(o=>{Object.keys(e.nakama.servers[o]).forEach(c=>{"online"==e.statusBar.groupServer[o][c]&&i.push({name:`${e.nakama.servers[o][c].info.name}`,isOfficial:o,target:c,type:`${o}/${c}`})})}),[...i].forEach(o=>{e.AvailableStorageList.push(o)}),e.received_data)e.buttonDisplay.saveTodo=e.lang.text.TodoDetail.buttonDisplay_modify,r=JSON.parse(e.received_data),e.userInput={...e.userInput,...r},e.isModify=!0;else{let o=new Date((new Date).getTime()+432e5);e.userInput.limit=o.getTime()}let n=document.getElementById("titleInput");if(e.titleIonInput=n.children[0].children[1].children[0],setTimeout(()=>{e.isModify||e.titleIonInput.focus()},0),e.ImporantSelChanged({detail:{value:e.userInput.importance}}),e.file_sel_id=`todo_${e.userInput.id||"new_todo_id"}_${(new Date).getTime()}`,e.userInput.attach.length)for(let o=0,m=e.userInput.attach.length;o<m;o++){try{let c;if(e.userInput.remote){let y=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});y.present(),c=yield e.nakama.sync_load_file(e.userInput.attach[o],e.userInput.remote.isOfficial,e.userInput.remote.target,"todo_attach",e.userInput.remote.creator_id),y.dismiss()}else{if("image"!=e.userInput.attach[o].viewer&&"text"!=e.userInput.attach[o].viewer)throw"\ubc88\uc678 \uc378\ub124\uc77c \ud544\uc694";c=yield e.indexed.loadBlobFromUserPath(e.userInput.attach[o].path,e.userInput.attach[o].type)}if(!c)continue;let f=URL.createObjectURL(c);e.global.modulate_thumbnail(e.userInput.attach[o],f)}catch{e.global.modulate_thumbnail(e.userInput.attach[o],"")}e.userInput.attach[o].exist=!0}try{if("local"==e.userInput.storeAt)e.isModify||(e.StoreAt.value=e.userInput.storeAt),e.userInput.display_store=e.lang.text.TodoDetail.OnThisDevice,e.userInput.display_creator=e.lang.text.TodoDetail.WrittenByMe,e.isModifiable=!0;else if(e.userInput.remote){if(e.isModify||(e.StoreAt.value=e.userInput.remote),e.userInput.display_store=e.userInput.remote.name,e.userInput.display_creator=e.lang.text.TodoDetail.Disconnected,!e.nakama.servers[e.userInput.remote.isOfficial]||!e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target])throw e.userInput.display_creator=e.lang.text.TodoDetail.DeletedServer,{text:"Server Deleted",isModifiable:!0};if(e.statusBar.groupServer[e.userInput.remote.isOfficial]&&"online"!=e.statusBar.groupServer[e.userInput.remote.isOfficial][e.userInput.remote.target])throw{text:"Server disconnected",isModifiable:!1};"online"==e.statusBar.groupServer[e.userInput.remote.isOfficial][e.userInput.remote.target]&&(e.isModifiable=!0),e.AmICreator=e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session.user_id==e.userInput.remote.creator_id,e.userInput.display_creator=e.AmICreator?e.lang.text.TodoDetail.WrittenByMe:e.nakama.load_other_user(e.userInput.remote.creator_id,e.userInput.remote.isOfficial,e.userInput.remote.target).display_name,e.userInput.remote.group_id&&(e.isModifiable="online"==e.nakama.groups[e.userInput.remote.isOfficial][e.userInput.remote.target][e.userInput.remote.group_id].status)}}catch(o){e.isModifiable=o.isModifiable,console.log("Server issue: ",o)}e.noti.Current=e.userInput.id;let l=new Date(e.userInput.limit);if(e.Calendar.value=new Date(l.getTime()-60*l.getTimezoneOffset()*1e3).toISOString(),r&&(e.limitTimeP5Display=new Date(r.limit).getTime()),e.userInput.startFrom){let o=new Date(e.userInput.startFrom);e.startDisplay=o.toLocaleString(e.lang.lang),e.startDisplay=e.startDisplay.substring(0,e.startDisplay.lastIndexOf(":"))}if(e.limitDisplay=l.toLocaleString(e.lang.lang),e.limitDisplay=e.limitDisplay.substring(0,e.limitDisplay.lastIndexOf(":")),e.isLimitChangable=!0,e.userInput.workers)for(let o=0,m=e.userInput.workers.length;o<m;o++)try{e.userInput.workers[o].name=e.nakama.load_other_user(e.userInput.workers[o].id,e.userInput.remote.isOfficial,e.userInput.remote.target).display_name}catch{}})()}ionViewDidEnter(){this.show_count_timer(),this.AddShortCut()}AddShortCut(){!this.NewAttach.value&&!this.WillLeavePage&&setTimeout(()=>{delete this.global.p5key.KeyShortCut.Digit,this.global.p5key.KeyShortCut.Escape=()=>{this.navCtrl.pop()},this.global.p5key.KeyShortCut.AddAct=()=>{this.checkIfInputFocus()||this.open_select_new()}},0),this.NewAttach.value=""}removeShortCut(){delete this.global.p5key.KeyShortCut.Escape,delete this.global.p5key.KeyShortCut.AddAct,delete this.global.p5key.KeyShortCut.Digit}start_change(e){this.isLimitChangable&&(this.userInput.startFrom=e.detail.value,this.startDisplay=new Date(e.detail.value).toLocaleString(this.lang.lang),this.startDisplay=this.startDisplay.substring(0,this.startDisplay.lastIndexOf(":")),this.startTimeP5Display=new Date(this.userInput.startFrom).getTime())}limit_change(e){this.isLimitChangable&&(this.userInput.limit=e.detail.value,this.limitDisplay=new Date(e.detail.value).toLocaleString(this.lang.lang),this.limitDisplay=this.limitDisplay.substring(0,this.limitDisplay.lastIndexOf(":")),this.limitTimeP5Display=new Date(this.userInput.limit).getTime())}remove_attach(e){this.userInput.attach.splice(e,1)}show_count_timer(){this.p5timer=new O(e=>{let i=0;this.startTimeP5Display=new Date(this.userInput.startFrom||this.userInput.written).getTime();let s,a=e.color(this.normal_color);e.setup=()=>{let m=document.getElementById("p5timer"),c=e.createCanvas(m.clientWidth,m.clientHeight);c.id("timer"),c.style("position","inherit"),c.style("width","100%"),c.style("height","100%"),c.parent(m),e.noStroke()};let r=0,n=()=>{s=(new Date).getTime(),r=this.limitTimeP5Display<s?1:e.map(s,this.startTimeP5Display,this.limitTimeP5Display,0,1,!0),r<=this.AlertLerpStartFrom?a=e.color(this.userInput.custom_color?this.userInput.custom_color+"bb":this.normal_color):r>this.AlertLerpStartFrom&&(a=this.userInput.custom_color?e.color(this.userInput.custom_color+"bb"):e.lerpColor(e.color(this.normal_color),e.color(this.alert_color),e.map(r,this.AlertLerpStartFrom,1,0,1)*i))};e.draw=()=>{n(),e.clear(255,255,255,255),e.push(),e.fill(a),i<1?(i+=.04,i>=1&&(i=1),e.rect(0,0,e.lerp(0,e.width,r*l(i)),e.height)):e.rect(0,0,e.lerp(0,e.width,r),e.height),e.pop()};let l=m=>o(e.sq(o(m))),o=m=>1-m})}from_camera(){var e=this;return(0,I.c)(function*(){try{const i=yield A.Ut.getPhoto({quality:90,resultType:A.on.Base64,source:A._8.Camera});let s=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});s.present();let a={};a.filename=`Camera_${(new Date).toLocaleString().replace(/[:|.|\/]/g,"_")}.${i.format}`,a.file_ext=i.format,a.base64="data:image/jpeg;base64,"+i.base64String,a.thumbnail=e.sanitizer.bypassSecurityTrustUrl(a.base64),a.type=`image/${i.format}`,a.typeheader="image",a.content_related_creator=[{timestamp:(new Date).getTime(),display_name:e.nakama.users.self.display_name,various:"camera"}],a.content_creator={timestamp:(new Date).getTime(),display_name:e.nakama.users.self.display_name,various:"camera"},a.path=`tmp_files/todo/${a.filename}`,a.viewer="image";let n=yield e.indexed.saveBase64ToUserPath(a.base64,a.path);a.blob=new Blob([n],{type:a.type}),a.size=a.blob.size,s.dismiss(),e.userInput.attach.push(a)}catch{}})()}open_select_new(){delete this.global.p5key.KeyShortCut.Escape,delete this.global.p5key.KeyShortCut.AddAct;let e=["camera","image","inapp","load"];this.global.p5key.KeyShortCut.Digit=i=>{this.checkIfInputFocus()||(delete this.global.p5key.KeyShortCut.Digit,e.length>i&&this.new_attach({detail:{value:e[i]}}))},this.NewAttach.open()}checkIfInputFocus(){this.input_ele_ids.length||(this.input_ele_ids.push(this.titleIonInput),this.input_ele_ids.push(document.getElementById("descInput")));let e=!1;for(let i=0,s=this.input_ele_ids.length;i<s;i++)if(document.activeElement==this.input_ele_ids[i]){e=!0;break}return e}new_attach(e){var i=this;return(0,I.c)(function*(){switch(e.detail.value){case"camera":yield i.from_camera(),i.AddShortCut(),i.auto_scroll_down(100);break;case"image":i.modalCtrl.create({component:x.S,cssClass:"fullscreen"}).then(s=>{i.removeShortCut(),s.onWillDismiss().then(function(){var a=(0,I.c)(function*(r){r.data&&i.voidDraw_fileAct_callback(r)});return function(r){return a.apply(this,arguments)}}()),s.onDidDismiss().then(()=>{i.AddShortCut()}),s.present()});break;case"inapp":i.modalCtrl.create({component:R.w}).then(s=>{s.onWillDismiss().then(function(){var a=(0,I.c)(function*(r){r.data&&i.selected_blobFile_callback_act(r.data)});return function(r){return a.apply(this,arguments)}}()),s.onDidDismiss().then(()=>{i.AddShortCut()}),s.present()});break;case"load":i.select_attach(),i.AddShortCut()}})()}select_attach(){document.getElementById(this.file_sel_id).click()}inputImageSelected(e){var i=this;return(0,I.c)(function*(){if(e.target.files.length)for(let s=0,a=e.target.files.length;s<a;s++)yield i.selected_blobFile_callback_act(e.target.files[s])})()}StoreAtSelClicked(){this.StoreAt.open()}StoreAtSelChanged(e){let i=e.detail.value;"local"==i?(this.userInput.storeAt="local",this.userInput.remote=void 0,this.isManager=!1,this.userInput.workers=void 0):(this.userInput.storeAt=i.type,this.userInput.remote=i,this.userInput.workers=[],this.nakama.servers[i.isOfficial][i.target].client.getAccount(this.nakama.servers[i.isOfficial][i.target].session).then(s=>{let a=JSON.parse(s.user.metadata);if(this.WorkerGroups.length=0,this.AvailableWorker={},a.is_admin)this.nakama.servers[i.isOfficial][i.target].client.rpc(this.nakama.servers[i.isOfficial][i.target].session,"query_all_groups",{}).then(r=>{let n=r.payload;for(let l=0,o=n.length;l<o;l++){this.AvailableWorker[n[l].id]||(this.AvailableWorker[n[l].id]=[]);for(let m=0,c=n[l].users.length;m<c;m++){let f=this.nakama.load_other_user(n[l].users[m].user.user_id,i.isOfficial,i.target);delete f.todo_checked,f.email||this.AvailableWorker[n[l].id].push(f)}this.AvailableWorker[n[l].id].length?this.WorkerGroups.push({id:n[l].id,name:n[l].name}):delete this.AvailableWorker[n[l].id]}this.isManager=!0});else if(a.is_manager){for(let r=a.is_manager.length-1;r>=0;r--)try{let n=this.nakama.groups[i.isOfficial][i.target][a.is_manager[r]];this.AvailableWorker[n.id]||(this.AvailableWorker[n.id]=[]);for(let l=0,o=n.users.length;l<o;l++){if(!n.users[l].user.user_id&&!n.users[l].user.id||(n.users[l].user.user_id||n.users[l].user.id)==this.nakama.servers[i.isOfficial][i.target].session.user_id)continue;let m=this.nakama.load_other_user(n.users[l].user.user_id||n.users[l].user.id,i.isOfficial,i.target);delete m.todo_checked,(m.id||m.user_id)!=this.nakama.servers[i.isOfficial][i.target].session.user_id&&m.display_name&&this.AvailableWorker[n.id].push(m)}this.AvailableWorker[n.id].length?this.WorkerGroups.push({id:n.id,name:n.name}):delete this.AvailableWorker[n.id]}catch{a.is_manager.splice(r,1)}this.isManager=a.is_manager.length,this.isManager||delete a.is_manager,this.nakama.servers[i.isOfficial][i.target].client.rpc(this.nakama.servers[i.isOfficial][i.target].session,"update_user_metadata_fn",{user_id:this.nakama.servers[i.isOfficial][i.target].session.user_id,metadata:a}).catch(r=>{})}}))}toggle_all_user(e){this.toggle_logs[e]=!this.toggle_logs[e];for(let i=0,s=this.AvailableWorker[e].length;i<s;i++)this.AvailableWorker[e][i].todo_checked=this.toggle_logs[e]}ImporantSelClicked(){this.ImporantSel.open()}ImporantSelChanged(e){switch(this.userInput.importance=e.detail.value,this.userInput.importance){case"0":this.normal_color="#888b",this.alert_color="#58a192bb",this.AlertLerpStartFrom=.8;break;case"1":this.normal_color="#888b",this.alert_color="#ddbb41bb",this.AlertLerpStartFrom=.5;break;case"2":this.normal_color="#dddd0cbb",this.alert_color="#ff754ebb",this.AlertLerpStartFrom=.4}}SpeechToTitleText(){var e=this;return(0,I.c)(function*(){let i=yield M.I.start({language:e.lang.lang,maxResults:1,prompt:e.lang.text.ChatRoom.TalkMessage,partialResults:!0,popup:!0});e.userInput.title=i.matches[0]})()}SpeechToDetailText(){var e=this;return(0,I.c)(function*(){let i=yield M.I.start({language:e.lang.lang,maxResults:1,prompt:e.lang.text.ChatRoom.TalkMessage,partialResults:!0,popup:!0});e.userInput.description?e.userInput.description+="\n":e.userInput.description="",e.userInput.description+=i.matches[0]})()}toggle_custom_color(){this.userInput.custom_color=this.userInput.custom_color?void 0:"#000000"}open_content_viewer(e){let i=[];for(let s=0,a=this.userInput.attach.length;s<a;s++)i.push({content:this.userInput.attach[s]});this.modalCtrl.create({component:S.K,componentProps:{info:{content:this.userInput.attach[e]},path:this.userInput.attach[e].path,relevance:i,targetDB:this.indexed.ionicDB},cssClass:"fullscreen"}).then(s=>{this.removeShortCut(),s.onDidDismiss().then(a=>{if(this.AddShortCut(),a.data)switch(a.data.type){case"image":let r=[];if(this.userInput.attach[a.data.index].content_related_creator&&(r=[...this.userInput.attach[a.data.index].content_related_creator]),this.userInput.attach[a.data.index].content_creator){let n=!1;for(let l=0,o=r.length;l<o;l++)if(void 0!==r[l].user_id&&void 0!==this.userInput.attach[a.data.index].content_creator.user_id&&r[l].user_id==this.userInput.attach[a.data.index].content_creator.user_id){n=!0;break}n||r.push(this.userInput.attach[a.data.index].content_creator)}return delete this.userInput.attach[a.data.index].exist,void this.modalCtrl.create({component:x.S,componentProps:{path:a.data.path||this.userInput.attach[a.data.index].path,width:a.data.width,height:a.data.height,text:a.data.text},cssClass:"fullscreen"}).then(n=>{this.removeShortCut(),n.onWillDismiss().then(l=>{l.data&&("image"===a.data.msg.content.viewer?this.voidDraw_fileAct_callback(l,r,a.data.index,!0):this.voidDraw_fileAct_callback(l,r,a.data.index))}),n.onDidDismiss().then(l=>{this.AddShortCut()}),n.present()});case"text":this.userInput.attach[a.data.index].content_related_creator.push(this.userInput.attach[a.data.index].content_creator),this.userInput.attach[a.data.index].content_creator={timestamp:(new Date).getTime(),display_name:this.nakama.users.self.display_name,various:"textedit"},this.userInput.attach[a.data.index].blob=a.data.blob,this.userInput.attach[a.data.index].path=a.data.path,this.userInput.attach[a.data.index].size=a.data.blob.size,this.userInput.attach[a.data.index].filename=a.data.blob.name||this.userInput.attach[a.data.index].filename,delete this.userInput.attach[a.data.index].exist}}),this.noti.Current="IonicViewerPage",s.present()})}auto_scroll_down(e=0){setTimeout(()=>{this.MainDiv.scrollTo({top:this.MainDiv.scrollHeight,behavior:"smooth"})},e)}voidDraw_fileAct_callback(e,i,s,a=!1){let r;try{if(!a)throw"not overwrite";r={},this.userInput.attach[s]=r}catch{r={},this.userInput.attach.push(r)}r.filename=e.data.name,r.file_ext="png",r.type="image/png",r.viewer="image",i?(r.content_related_creator=i,r.content_creator={timestamp:(new Date).getTime(),display_name:this.nakama.users.self.display_name,various:"voidDraw"}):(r.content_related_creator=[{timestamp:(new Date).getTime(),display_name:this.nakama.users.self.display_name,various:"voidDraw"}],r.content_creator={timestamp:(new Date).getTime(),display_name:this.nakama.users.self.display_name,various:"voidDraw"}),r.thumbnail=this.sanitizer.bypassSecurityTrustUrl(e.data.img),r.path=`tmp_files/todo/${r.filename}`,this.indexed.saveBase64ToUserPath(e.data.img,"tmp_files/todo/attach.jpeg",n=>{let l=new Blob([n],{type:r.type});r.blob=new File([l],e.data.name),r.size=r.blob.size}),this.indexed.saveBase64ToUserPath(e.data.img,r.path,n=>{e.data.loadingCtrl.dismiss()}),this.auto_scroll_down(100)}doneTodo(){var e=this;return(0,I.c)(function*(){if(e.isButtonClicked=!0,e.userInput.done=!0,e.global.p5todo&&e.global.p5todo.add_todo&&e.global.p5todo.add_todo(JSON.stringify(e.userInput)),e.userInput.remote){let i=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});i.present(),e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target]&&(yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].socket.sendMatchState(e.nakama.self_match[e.userInput.remote.isOfficial][e.userInput.remote.target].match_id,T.i.MANAGE_TODO,encodeURIComponent(`done,${e.userInput.id}`))),i.dismiss()}e.deleteFromStorage(!1)})()}saveData(){var e=this;return(0,I.c)(function*(){if(!e.userInput.title)return void e.p5toast.show({text:e.lang.text.TodoDetail.needDisplayName});e.isButtonClicked=!0;let i=!!e.userInput.attach.length;if(delete e.userInput.display_store,delete e.userInput.display_creator,JSON.stringify(e.userInput)==e.received_data)return void e.navCtrl.pop();if(e.userInput.create_at||(e.userInput.create_at=(new Date).getTime()),!e.userInput.id||!e.isModify)if(e.userInput.remote){let n=yield e.nakama.getRemoteTodoCounter(e.userInput.remote.isOfficial,e.userInput.remote.target);e.userInput.id=`RemoteTodo_${(n||0)+1}`}else e.userInput.id=new Date(e.userInput.create_at).toISOString().replace(/[:|.|\/]/g,"_");e.userInput.noti_id&&(e.isMobile||(clearTimeout(e.nakama.web_noti_id[e.userInput.noti_id]),delete e.nakama.web_noti_id[e.userInput.noti_id]),e.noti.ClearNoti(e.userInput.noti_id)),e.userInput.noti_id=e.nakama.get_noti_id(),e.nakama.set_todo_notification(e.userInput);let a=e.received_data?JSON.parse(e.received_data):void 0,r=!1;if(e.userInput.workers){e.userInput.workers.length=0;let n=Object.keys(e.AvailableWorker),l=[];for(let o=0,m=n.length;o<m;o++)for(let c=0,f=e.AvailableWorker[n[o]].length;c<f;c++){let y=e.AvailableWorker[n[o]][c].id||e.AvailableWorker[n[o]][c].user_id;e.AvailableWorker[n[o]][c].todo_checked&&!l.includes(y)&&(e.userInput.workers.push({id:y,name:e.nakama.load_other_user(y,e.userInput.remote.isOfficial,e.userInput.remote.target).display_name}),l.push(y))}e.userInput.workers.length||(e.userInput.workers=void 0)}try{a.attach.forEach(o=>{delete o.exist,delete o.thumbnail,delete o.base64,delete o.blob});let n=JSON.stringify(a.attach),l=JSON.parse(JSON.stringify(e.userInput.attach));l.forEach(o=>{delete o.exist,delete o.thumbnail,delete o.base64,delete o.blob}),l=JSON.stringify(l),r=n!=l}catch{r=!0}if(i&&r){let l,n=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});if(n.present(),a){yield e.indexed.removeFileFromUserPath(`todo/${e.userInput.id}/thumbnail.png`);for(let o=0,m=a.attach.length;o<m;o++){for(let c=0,f=e.userInput.attach.length;c<f;c++)if(e.userInput.attach[c].path==a.attach[o].path){a.attach[o].exist=!0,a.attach[o].index=c;break}(!a.attach[o].exist||a.attach[o].exist&&!e.userInput.attach[a.attach[o].index])&&(yield e.indexed.removeFileFromUserPath(a.attach[o].path))}}for(let o=0,m=e.userInput.attach.length;o<m;o++){let c,f=!1;try{if(l)throw"already exist";c=yield e.indexed.loadBlobFromUserPath(`${e.userInput.attach[o].path}_thumbnail.png`,"image/png"),f=!0}catch{}!e.userInput.attach[o].exist||!l&&"image"==e.userInput.attach[o].viewer?(f||(c=yield e.indexed.loadBlobFromUserPath(e.userInput.attach[o].path,e.userInput.attach[o].type)),e.userInput.attach[o].path=`todo/${e.userInput.id}/${e.userInput.attach[o].filename}`,yield e.indexed.saveBlobToUserPath(c,e.userInput.attach[o].path)):delete e.userInput.attach[o].exist,!l&&("image"==e.userInput.attach[o].viewer||f)&&(l=URL.createObjectURL(c))}l&&(yield new Promise(o=>{new O(m=>{m.setup=()=>{m.noCanvas(),m.loadImage(l,c=>{c.width>c.height?c.resize(c.width/c.height*128,128):c.resize(128,c.height/c.width*128);let y=m.createCanvas(128,128);y.hide(),m.smooth(),m.pixelDensity(1),m.image(c,-(c.width-128)/2,-(c.height-128)/2);let D=y.elt.toDataURL("image/png").replace("image/png","image/octet-stream");e.indexed.saveBase64ToUserPath(D,`todo/${e.userInput.id}/thumbnail.png`,G=>{o()}),URL.revokeObjectURL(l),m.remove()},c=>{console.error("Todo-\ub4f1\ub85d\ub41c \uc774\ubbf8\uc9c0 \ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",c),o(),URL.revokeObjectURL(l),m.remove()})}})})),n.dismiss()}if(!i&&r&&a&&(yield e.indexed.removeFileFromUserPath(`todo/${e.userInput.id}/thumbnail.png`),a.attach))for(let n=0,l=a.attach.length;n<l;n++)yield e.indexed.removeFileFromUserPath(a.attach[n].path);if(e.userInput.attach.forEach(n=>{URL.revokeObjectURL(n.thumbnail),delete n.thumbnail,delete n.exist,delete n.base64}),e.userInput.written=(new Date).getTime(),e.userInput.startFrom){let n=new Date(e.userInput.startFrom).getTime();(new Date).getTime()>n?delete e.userInput.startFrom:e.userInput.startFrom=n}if(e.userInput.limit=new Date(e.userInput.limit).getTime(),e.isModify||e.userInput.remote&&!e.userInput.remote.creator_id&&(e.userInput.remote.creator_id=e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session.user_id),e.userInput.remote){let n=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});n.present();try{if(e.userInput.attach.forEach(l=>{URL.revokeObjectURL(l.thumbnail),delete l.thumbnail,delete l.exist,delete l.base64}),e.userInput.workers){let l=yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].client.rpc(e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session,"manage_todo_add_fn",e.userInput);e.userInput.id=`RemoteTodo_${l.payload.value}`;for(let o=0,m=e.userInput.workers.length;o<m;o++)try{let c=yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].client.readStorageObjects(e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session,{object_ids:[{collection:"self_share",key:"private_match",user_id:e.userInput.workers[o].id}]});c.objects.length&&(yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].socket.joinMatch(c.objects[0].value.match_id),yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].socket.sendMatchState(c.objects[0].value.match_id,T.i.MANAGE_TODO,encodeURIComponent(`add,server_todo,${e.userInput.id}`)),yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].socket.leaveMatch(c.objects[0].value.match_id))}catch{}}else yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].client.writeStorageObjects(e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session,[{collection:"server_todo",key:e.userInput.id,permission_read:2,permission_write:1,value:e.userInput}]).then(function(){var l=(0,I.c)(function*(o){yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].socket.sendMatchState(e.nakama.self_match[e.userInput.remote.isOfficial][e.userInput.remote.target].match_id,T.i.MANAGE_TODO,encodeURIComponent(`add,${o.acks[0].collection},${o.acks[0].key}`))});return function(o){return l.apply(this,arguments)}}());if(i&&r&&a)for(let l=0,o=a.attach.length;l<o;l++){for(let m=0,c=e.userInput.attach.length;m<c;m++)if(e.userInput.attach[m].path==a.attach[l].path){a.attach[l].exist=!0,a.attach[l].index=m;break}(!a.attach[l].exist||a.attach[l].exist&&!e.userInput.attach[a.attach[l].index])&&(yield e.nakama.sync_remove_file(a.attach[l].path,e.userInput.remote.isOfficial,e.userInput.remote.target,"todo_attach"))}for(let l=0,o=e.userInput.attach.length;l<o;l++)yield e.nakama.sync_save_file(e.userInput.attach[l],e.userInput.remote.isOfficial,e.userInput.remote.target,"todo_attach");e.isModify||e.nakama.addRemoteTodoCounter(e.userInput.remote.isOfficial,e.userInput.remote.target,Number(e.userInput.id.split("_")[1])),n.dismiss()}catch(l){return console.error("\ud574\uc57c\ud560 \uc77c\uc774 \uc11c\ubc84\uc5d0 \uc804\uc1a1\ub418\uc9c0 \uc54a\uc74c: ",l),e.p5toast.show({text:e.lang.text.TodoDetail.CanAddToServer}),e.isButtonClicked=!1,void n.dismiss()}}e.global.p5todo&&e.global.p5todo.add_todo&&e.global.p5todo.add_todo(JSON.stringify(e.userInput)),yield e.indexed.saveTextFileToUserPath(JSON.stringify(e.userInput),`todo/${e.userInput.id}/info.todo`),e.navCtrl.pop()})()}deleteData(){this.alertCtrl.create({header:this.lang.text.TodoDetail.remove,message:this.lang.text.TodoDetail.terminateTodo,buttons:[{text:this.lang.text.TodoDetail.remove,handler:()=>{this.deleteFromStorage()},cssClass:"red_font"}]}).then(e=>e.present())}deleteFromStorage(e=!0){var i=this;return(0,I.c)(function*(){i.isButtonClicked=!0;let s=yield i.loadingCtrl.create({message:i.lang.text.TodoDetail.WIP});if(s.present(),i.userInput.remote)try{if(!i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target])throw"Server deleted.";try{let a=i.userInput.remote.isOfficial,r=i.userInput.remote.target;yield i.nakama.servers[a][r].client.deleteStorageObjects(i.nakama.servers[a][r].session,{object_ids:[{collection:"server_todo",key:i.userInput.id}]});for(let n=0,l=i.userInput.attach.length;n<l;n++)yield i.nakama.sync_remove_file(i.userInput.attach[n].path,a,r,"todo_attach");e&&(yield i.nakama.servers[a][r].socket.sendMatchState(i.nakama.self_match[a][r].match_id,T.i.MANAGE_TODO,encodeURIComponent(`delete,${i.userInput.id}`)))}catch(a){console.error("\ud574\uc57c\ud560 \uc77c \uc0ad\uc81c \uc694\uccad\uc774 \uc11c\ubc84\uc5d0 \uc804\uc1a1\ub418\uc9c0 \uc54a\uc74c: ",a)}try{if(i.userInput.remote.creator_id!=i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].session.user_id){let a=(new Date).getTime();try{yield i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].client.rpc(i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].session,"manage_todo_done_fn",{id:i.userInput.id,creator_id:i.userInput.remote.creator_id,user_id:i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].session.user_id,timestamp:a,isDelete:e})}catch{}try{let r=yield i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].client.readStorageObjects(i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].session,{object_ids:[{collection:"self_share",key:"private_match",user_id:i.userInput.remote.creator_id}]});r.objects.length&&(yield i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].socket.joinMatch(r.objects[0].value.match_id),yield i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].socket.sendMatchState(r.objects[0].value.match_id,T.i.MANAGE_TODO,encodeURIComponent(`worker,${i.userInput.id},${i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].session.user_id},${e},${a}`)),yield i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].socket.leaveMatch(r.objects[0].value.match_id))}catch{}}}catch{}if(i.userInput.workers){try{yield i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].client.rpc(i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].session,"manage_todo_delete_fn",{id:i.userInput.id,workers:i.userInput.workers})}catch{}for(let a=0,r=i.userInput.workers.length;a<r;a++)try{let n=yield i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].client.readStorageObjects(i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].session,{object_ids:[{collection:"self_share",key:"private_match",user_id:i.userInput.workers[a].id}]});n.objects.length&&(yield i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].socket.joinMatch(n.objects[0].value.match_id),yield i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].socket.sendMatchState(n.objects[0].value.match_id,T.i.MANAGE_TODO,encodeURIComponent(e?`delete,${i.userInput.id}`:`done,${i.userInput.id}`)),yield i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].socket.leaveMatch(n.objects[0].value.match_id))}catch{}}i.nakama.removeRemoteTodoCounter(i.userInput.remote.isOfficial,i.userInput.remote.target,Number(i.userInput.id.split("_")[1]))}catch(a){console.log("\uc11c\ubc84 \uc815\ubcf4 \uc5c6\uc74c, \ub85c\uceec\uc5d0\uc11c \ud589\ub3d9: ",a)}i.indexed.GetFileListFromDB(`todo/${i.userInput.id}`,function(){var a=(0,I.c)(function*(r){r.forEach(n=>i.indexed.removeFileFromUserPath(n)),i.userInput.noti_id&&(i.isMobile||(clearTimeout(i.nakama.web_noti_id[i.userInput.noti_id]),delete i.nakama.web_noti_id[i.userInput.noti_id])),i.noti.ClearNoti(i.userInput.noti_id),e&&i.global.p5todo&&i.global.p5todo.remove_todo(JSON.stringify(i.userInput)),s.dismiss(),i.navCtrl.pop()});return function(r){return a.apply(this,arguments)}}())})()}ionViewWillLeave(){var e=this;return(0,I.c)(function*(){e.WillLeavePage=!0,delete e.global.p5key.KeyShortCut.Escape,delete e.global.p5key.KeyShortCut.AddAct,delete e.global.p5key.KeyShortCut.Digit,e.noti.Current="",e.p5timer&&e.p5timer.remove()})()}ngOnDestroy(){this.nakama.AddTodoLinkAct=void 0,this.nakama.AddTodoManageUpdateAct=void 0,this.p5canvas&&this.p5canvas.remove()}}return(d=_).\u0275fac=function(e){return new(e||d)(t.GI1(g.gV),t.GI1(g.E5),t.GI1(h.qS),t.GI1(E.o),t.GI1($.O),t.GI1(F.mI),t.GI1(j.k),t.GI1(T.h),t.GI1(h.iW),t.GI1(Y.s),t.GI1(N.Y),t.GI1(h.Kg),t.GI1(W.A1),t.GI1(P.wX))},d.\u0275cmp=t.In1({type:d,selectors:[["app-add-todo-menu"]],viewQuery:function(e,i){if(1&e&&(t.CC$(U,5),t.CC$(B,5),t.CC$(L,5),t.CC$(K,5),t.CC$(J,5)),2&e){let s;t.wto(s=t.Gqi())&&(i.StartCalendar=s.first),t.wto(s=t.Gqi())&&(i.Calendar=s.first),t.wto(s=t.Gqi())&&(i.NewAttach=s.first),t.wto(s=t.Gqi())&&(i.StoreAt=s.first),t.wto(s=t.Gqi())&&(i.ImporantSel=s.first)}},decls:83,vars:37,consts:[[1,"ion-no-border"],["slot","start"],["defaultHref","portal/main"],["id","p5Drop_todo",2,"position","absolute","width","100%","height","100%","display","flex","pointer-events","none","z-index","500"],["id","main_table",2,"width","100%","height","100%"],[2,"height","100%"],[2,"vertical-align","top"],["id","p5timer",2,"position","absolute","width","100%","height","8px","z-index","2"],["id","main_div",1,"main",2,"max-width","100vw"],[3,"click",4,"ngIf"],[4,"ngIf"],["id","titleInput",1,"ion-text-right",3,"label","ngModel","placeholder","ngModelChange"],["slot","end","name","mic-outline",3,"click",4,"ngIf"],["button","",3,"click"],[2,"pointer-events","none",3,"label","value","ionChange"],["ImporantSel",""],["value","2"],["value","1"],["value","0"],["button",""],["button","","color","medium","class","ion-text-end",3,"click",4,"ngIf"],["DateTime",""],["value","Start"],["button","","slot","header"],[1,"ion-text-right","uneditable_data"],[1,"ion-accordion-toggle-icon","hide_accordion_icon"],["slot","content"],[2,"display","inline",3,"locale","ionChange"],["StartCalendar",""],["value","Limit"],["Calendar",""],["id","descInput",1,"infobox",2,"height","240px",3,"ngModel","placeholder","ngModelChange"],[4,"ngFor","ngForOf"],[2,"display","none"],["interface","action-sheet",3,"label","ionChange","ionDismiss"],["NewAttach",""],["value","camera"],["value","image"],["value","inapp"],["value","load"],["hidden","","type","file","accept","*","multiple","",3,"id","change"],[2,"width","100%"],["id","bottom_buttons",2,"width","100%","background-color","black"],["expand","block",3,"disabled","click"],[3,"click"],[2,"pointer-events","none",3,"label","ionChange"],["StoreAt",""],["value","local"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["color","medium"],["color","medium",1,"ion-text-right"],["fixed",""],["col-33",""],["button","","color","success",3,"disabled","click"],[1,"ion-text-center"],["slot","end","name","mic-outline",3,"click"],["ManageWorker",""],["Groups",""],[3,"ngModel","ngModelChange"],[1,"ion-text-end"],["class","ignore_check",4,"ngFor","ngForOf"],[1,"ignore_check"],["style","color: var(--ion-color-medium);",4,"ngIf"],["slot","end","color","medium","name","ellipsis-horizontal-circle-outline",4,"ngIf"],["slot","end","color","danger","name","close-circle-outline",4,"ngIf"],["slot","end","color","success","name","checkmark-circle-outline",4,"ngIf"],[2,"color","var(--ion-color-medium)"],["slot","end","color","medium","name","ellipsis-horizontal-circle-outline"],["slot","end","color","danger","name","close-circle-outline"],["slot","end","color","success","name","checkmark-circle-outline"],["button","","color","medium",1,"ion-text-end",3,"click"],[2,"height","27px","transform","translateY(-3px)","padding","0px 8px",3,"click"],["type","color",2,"margin-right","8px","height","27px",3,"ngModel","ngModelChange"],["text-wrap",""],["class","image_thumbnail",3,"src","alt",4,"ngIf"],["button","",4,"ngIf"],[1,"image_thumbnail",3,"src","alt"],["color","danger","expand","block",3,"disabled","click"]],template:function(e,i){1&e&&(t.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),t.OEk(3),t.C$Y(),t.I0R(4,"ion-buttons",1),t.wR5(5,"ion-back-button",2),t.C$Y()()(),t.I0R(6,"ion-content"),t.wR5(7,"div",3),t.I0R(8,"table",4)(9,"tr",5)(10,"td",6),t.wR5(11,"div",7),t.I0R(12,"div",8),t.yuY(13,Q,6,3,"ion-item",9)(14,H,12,4,"div",10),t.I0R(15,"ion-item")(16,"ion-input",11),t.iHE("ngModelChange",function(a){return t.kNx(i.userInput.title,a)||(i.userInput.title=a),a}),t.C$Y(),t.yuY(17,V,1,0,"ion-icon",12),t.C$Y(),t.yuY(18,Z,11,2,"div",10),t.I0R(19,"ion-item",13),t.qCj("click",function(){return i.ImporantSelClicked()}),t.I0R(20,"ion-select",14,15),t.qCj("ionChange",function(a){return i.ImporantSelChanged(a)}),t.I0R(22,"ion-select-option",16),t.OEk(23),t.C$Y(),t.I0R(24,"ion-select-option",17),t.OEk(25),t.C$Y(),t.I0R(26,"ion-select-option",18),t.OEk(27),t.C$Y()()(),t.yuY(28,oe,11,3,"div",10),t.I0R(29,"ion-item",19)(30,"ion-label"),t.OEk(31),t.C$Y(),t.yuY(32,re,2,1,"ion-label",20)(33,se,4,2,"div",10),t.C$Y(),t.I0R(34,"ion-accordion-group",null,21)(36,"ion-accordion",22)(37,"ion-item",23)(38,"ion-label"),t.OEk(39),t.C$Y(),t.I0R(40,"ion-label",24),t.OEk(41),t.C$Y(),t.wR5(42,"ion-icon",25),t.C$Y(),t.I0R(43,"div",26)(44,"ion-datetime",27,28),t.qCj("ionChange",function(a){return i.start_change(a)}),t.C$Y()()(),t.I0R(46,"ion-accordion",29)(47,"ion-item",23)(48,"ion-label"),t.OEk(49),t.C$Y(),t.I0R(50,"ion-label",24),t.OEk(51),t.C$Y(),t.wR5(52,"ion-icon",25),t.C$Y(),t.I0R(53,"div",26)(54,"ion-datetime",27,30),t.qCj("ionChange",function(a){return i.limit_change(a)}),t.C$Y()()()(),t.yuY(56,le,4,1,"ion-item-divider",10),t.I0R(57,"textarea",31),t.iHE("ngModelChange",function(a){return t.kNx(i.userInput.description,a)||(i.userInput.description=a),a}),t.C$Y(),t.yuY(58,me,7,3,"div",32),t.I0R(59,"ion-item",13),t.qCj("click",function(){return i.open_select_new()}),t.I0R(60,"ion-label"),t.OEk(61),t.C$Y(),t.I0R(62,"ion-item",33)(63,"ion-select",34,35),t.qCj("ionChange",function(a){return i.new_attach(a)})("ionDismiss",function(){return i.AddShortCut()}),t.I0R(65,"ion-select-option",36),t.OEk(66),t.C$Y(),t.I0R(67,"ion-select-option",37),t.OEk(68),t.C$Y(),t.I0R(69,"ion-select-option",38),t.OEk(70),t.C$Y(),t.I0R(71,"ion-select-option",39),t.OEk(72),t.C$Y()()()(),t.I0R(73,"input",40),t.qCj("change",function(a){return i.inputImageSelected(a)}),t.C$Y()()()(),t.I0R(74,"tr")(75,"td")(76,"div",41)(77,"table",42)(78,"tr")(79,"td")(80,"ion-button",43),t.qCj("click",function(){return i.saveData()}),t.OEk(81),t.C$Y()(),t.yuY(82,pe,3,2,"td",10),t.C$Y()()()()()()()),2&e&&(t.yG2(3),t.cNF(i.lang.text.TodoDetail.Title),t.yG2(10),t.E7m("ngIf",!i.isModify),t.yG2(),t.E7m("ngIf",i.isModify),t.yG2(2),t.E7m("label",i.lang.text.TodoDetail.DisplayName),t.OKB("ngModel",i.userInput.title),t.E7m("placeholder",i.lang.text.TodoDetail.DisplayName_placeholder),t.yG2(),t.E7m("ngIf",i.isMobile),t.yG2(),t.E7m("ngIf","local"!=i.userInput.storeAt&&i.isManager),t.yG2(2),t.E7m("label",i.lang.text.TodoDetail.Importance)("value",i.userInput.importance),t.yG2(3),t.cNF(i.lang.text.TodoDetail.Importance_2),t.yG2(2),t.cNF(i.lang.text.TodoDetail.Importance_1),t.yG2(2),t.cNF(i.lang.text.TodoDetail.Importance_0),t.yG2(),t.E7m("ngIf",i.isModify&&i.userInput.workers),t.yG2(3),t.cNF(i.lang.text.TodoDetail.CustomColor),t.yG2(),t.E7m("ngIf",!i.userInput.custom_color),t.yG2(),t.E7m("ngIf",i.userInput.custom_color),t.yG2(6),t.cNF(i.lang.text.TodoDetail.startFrom),t.yG2(2),t.cNF(i.startDisplay||i.lang.text.TodoDetail.startImmediatly),t.yG2(3),t.E7m("locale",i.lang.lang),t.yG2(5),t.cNF(i.lang.text.TodoDetail.limit),t.yG2(2),t.cNF(i.limitDisplay),t.yG2(3),t.E7m("locale",i.lang.lang),t.yG2(2),t.E7m("ngIf",i.isMobile),t.yG2(),t.OKB("ngModel",i.userInput.description),t.E7m("placeholder",i.lang.text.TodoDetail.description),t.yG2(),t.E7m("ngForOf",i.userInput.attach),t.yG2(3),t.cNF(i.lang.text.TodoDetail.attachments),t.yG2(2),t.E7m("label",i.lang.text.TodoDetail.new_attach),t.yG2(3),t.cNF(i.lang.text.GlobalAct.FromCamera),t.yG2(2),t.cNF(i.lang.text.TodoDetail.new_draw),t.yG2(2),t.cNF(i.lang.text.TodoDetail.user_fs),t.yG2(2),t.cNF(i.lang.text.TodoDetail.add_attach),t.yG2(),t.E7m("id",i.file_sel_id),t.yG2(7),t.E7m("disabled",!i.isModifiable||i.isButtonClicked),t.yG2(),t.oRS(" ",i.buttonDisplay.saveTodo," "),t.yG2(),t.E7m("ngIf",i.isModify))},dependencies:[v.ay,v.u_,k.ot,k.ue,k._G,h.cm,h.qU,h.sn,h.GS,h.ew,h.Kk,h._i,h.on,h.YP,h.wB,h.Ko,h.A5,h.Yb,h.S8,h.QR,h.qo,h.Cy,h.gd,h.tM,h.Md,h.UJ,h.IT,h.qG,h.Im],styles:[".uneditable_data[_ngcontent-%COMP%]{color:#888}.main[_ngcontent-%COMP%]{width:100%;height:100%;padding-top:8px;overflow-x:hidden;overflow-y:auto;scroll-behavior:smooth}.logs[_ngcontent-%COMP%]{background:var(--voidDraw-menu-background);border-radius:8px;margin:8px;padding:4px 8px;text-align:center}.image_thumbnail[_ngcontent-%COMP%]{width:auto;height:auto;object-fit:contain;display:block;margin:auto}.ignore_check[_ngcontent-%COMP%]{pointer-events:none}"]}),_})()}];let _e=(()=>{var d;class _{}return(d=_).\u0275fac=function(e){return new(e||d)},d.\u0275mod=t.a4G({type:d}),d.\u0275inj=t.s3X({imports:[g.qQ.forChild(he),g.qQ]}),_})(),ge=(()=>{var d;class _{}return(d=_).\u0275fac=function(e){return new(e||d)},d.\u0275mod=t.a4G({type:d}),d.\u0275inj=t.s3X({imports:[v.MD,k.y,h.wZ,_e]}),_})()}}]);