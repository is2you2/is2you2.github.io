"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4048],{4048:(W,w,_)=>{_.r(w),_.d(w,{CommunityPageModule:()=>c});var T=_(1368),G=_(4716),b=_(5624),R=_(3332),x=_(1528),D=_(340),n=_(416),k=_(4428),t=_(4496),U=_(4180),S=_(7136),j=_(4500),$=_(5020),A=_(9240),L=_(4668);function K(i,g){if(1&i&&t.wR5(0,"img",18),2&i){const d=t.GaO().$implicit;t.m_g(d.isNSFW?"filter: blur(16px);":""),t.E7m("src",d.mainImage.thumbnail,t.K6U)}}function V(i,g){if(1&i&&(t.I0R(0,"span",19),t.OEk(1),t.C$Y()),2&i){const d=t.GaO().$implicit,e=t.GaO(2);t.yG2(),t.oRS(" ","("+(d.server?d.server.name||d.server.target:e.lang.text.AddGroup.UseLocalStorage)+")"," ")}}function B(i,g){if(1&i){const d=t.KQA();t.I0R(0,"ion-card",11),t.qCj("click",function(){const a=t.usT(d),r=a.$implicit,s=a.index,l=t.GaO(2);return t.CGJ(l.open_post(r,s))}),t.yuY(1,K,1,3,"img",12),t.I0R(2,"ion-card-header")(3,"ion-card-subtitle",13)(4,"span",14),t.qCj("click",function(){const r=t.usT(d).$implicit,s=t.GaO(2);return t.CGJ(s.open_profile(r))}),t.OEk(5),t.C$Y(),t.yuY(6,V,2,1,"span",15),t.C$Y(),t.I0R(7,"ion-card-title",16),t.OEk(8),t.C$Y()(),t.I0R(9,"ion-card-content",17),t.OEk(10),t.C$Y()()}if(2&i){const d=g.$implicit,e=t.GaO(2);t.E7m("id",d.id),t.yG2(),t.E7m("ngIf",d.mainImage),t.yG2(3),t.m_g("color: #"+d.UserColor),t.yG2(),t.oRS(" ",d.creator_name," "),t.yG2(),t.E7m("ngIf",e.nakama.showServer),t.yG2(2),t.cNF(d.title),t.yG2(2),t.oRS(" ",d.content," ")}}function Y(i,g){1&i&&t.wR5(0,"div",20)}function F(i,g){if(1&i&&(t.I0R(0,"div",8),t.yuY(1,B,11,8,"ion-card",9)(2,Y,1,0,"div",10),t.C$Y()),2&i){const d=t.GaO();t.yG2(),t.E7m("ngForOf",d.nakama.posts),t.yG2(),t.E7m("ngIf",d.is_loadable)}}function P(i,g){if(1&i){const d=t.KQA();t.I0R(0,"div")(1,"div",21),t.qCj("click",function(){t.usT(d);const a=t.GaO();return t.CGJ(a.add_post())}),t.wR5(2,"ion-icon",22),t.I0R(3,"div")(4,"ion-label",23),t.OEk(5),t.C$Y()()()()}if(2&i){const d=t.GaO();t.yG2(5),t.cNF(d.lang.text.Community.NoPosts)}}const v=[{path:"",component:(()=>{var i;class g{constructor(e,a,r,s,l,u,f){this.statusBar=e,this.nakama=a,this.lang=r,this.global=s,this.navCtrl=l,this.indexed=u,this.modalCtrl=f,this.is_loadable=!0,this.counter={local:{target:{me:0}},official:{},unofficial:{}},this.isOpenProfile=!1}ngOnInit(){this.nakama.is_post_lock=!0,this.nakama.CommunityGoToEditPost=this.add_post}add_post(e){this.navCtrl.navigateForward("portal/community/add-post",{state:{data:e,act:!0}})}ionViewDidEnter(){var e=this;return(0,x.c)(function*(){e.is_loadable=!0,yield e.load_posts_counter(),e.try_add_shortcut(),e.ContentDiv&&e.ContentScroll&&e.ContentDiv.clientHeight-(e.ContentScroll.scrollTop+e.ContentScroll.clientHeight)<1&&e.load_post_cycles()})()}load_post_cycles(){var e=this;return(0,x.c)(function*(){e.is_loadable&&(yield e.load_posts()),setTimeout(()=>{e.ContentDiv||(e.ContentDiv=document.getElementById("CommunityMainContent")),e.ContentScroll||(e.ContentScroll=document.getElementById("CommunityScrollDiv"),e.ContentScroll.onscroll=a=>{e.ContentDiv.clientHeight-(e.ContentScroll.scrollTop+e.ContentScroll.clientHeight)<1&&e.load_post_cycles()}),e.is_loadable&&e.ContentDiv.clientHeight-(e.ContentScroll.scrollTop+e.ContentScroll.clientHeight)<1&&e.load_post_cycles()},50)})()}try_add_shortcut(){this.global.p5key&&this.global.p5key.KeyShortCut?this.AddShortcut():setTimeout(()=>{this.try_add_shortcut()},100)}load_posts_counter(){var e=this;return(0,x.c)(function*(){let a=Number(yield e.indexed.loadTextFromUserPath("servers/local/target/posts/me/counter.txt"))||0;e.counter.local.target.me=a;let r=e.nakama.get_all_server_info(!0,!0);for(let s=0,l=r.length;s<l;s++){let u=r[s].isOfficial,f=r[s].target;e.counter[u][f]||(e.counter[u][f]={});try{let C=yield e.nakama.servers[u][f].client.readStorageObjects(e.nakama.servers[u][f].session,{object_ids:[{collection:"server_post",key:"Counter",user_id:e.nakama.servers[u][f].session.user_id}]}),m=0;C.objects.length&&(m=C.objects[0].value.counter),e.counter[u][f][e.nakama.servers[u][f].session.user_id]=m}catch(C){console.log("\ub0b4 \uc11c\ubc84 \uc18c\uc2dd \uce74\uc6b4\ud130 \ubd88\ub7ec\uc624\uae30 \uc624\ub958: ",C)}if(e.nakama.users[u][f]){let C=Object.keys(e.nakama.users[u][f]);for(let m=0,h=C.length;m<h;m++)try{let p=yield e.nakama.servers[u][f].client.readStorageObjects(e.nakama.servers[u][f].session,{object_ids:[{collection:"server_post",key:"Counter",user_id:C[m]}]}),y=0;p.objects.length&&(y=p.objects[0].value.counter),e.counter[u][f][C[s]]=y}catch(p){console.log("\ub2e4\ub978 \uc0ac\ub78c\uc758 \uce74\uc6b4\ud130 \ubd88\ub7ec\uc624\uae30 \uc624\ub958: ",p)}}}e.load_post_cycles()})()}load_posts(){var e=this;return(0,x.c)(function*(){let a=!1,r=Object.keys(e.counter);for(let s=0,l=r.length;s<l;s++){let u=Object.keys(e.counter[r[s]]);for(let f=0,C=u.length;f<C;f++){let m=Object.keys(e.counter[r[s]][u[f]]);for(let h=0,p=m.length;h<p;h++){let y=e.counter[r[s]][u[f]][m[h]];!a&&y>0&&(a=!0),"local"==r[s]?yield e.load_local_post_step_by_step(y):yield e.load_server_user_post_step_by_step(y,r[s],u[f],m[h])}}}e.is_loadable=a,e.nakama.rearrange_posts()})()}load_local_post_step_by_step(e){var a=this;return(0,x.c)(function*(){if(e<0)return;let r=yield a.nakama.load_local_post_with_id(`LocalPost_${e}`);a.counter.local.target.me--,r||(yield a.load_local_post_step_by_step(a.counter.local.target.me))})()}load_server_user_post_step_by_step(e,a,r,s){var l=this;return(0,x.c)(function*(){if(e<0)return;let u=yield l.load_server_post_with_id(`ServerPost_${e}`,a,r,s);l.counter[a][r][s]--,u||(yield l.load_server_user_post_step_by_step(l.counter[a][r][s],a,r,s))})()}load_server_post_with_id(e,a,r,s){var l=this;return(0,x.c)(function*(){try{let u={path:`servers/${a}/${r}/posts/${s}/${e}/info.json`,type:"text/plain"},C=yield(yield l.nakama.sync_load_file(u,a,r,"server_post",s,e,!1)).text(),m=JSON.parse(C);if(m.server={name:l.nakama.servers[a][r].info.name,isOfficial:a,target:r},m.mainImage)if(m.mainImage.url)m.mainImage.thumbnail=m.mainImage.url;else{let h={path:`servers/${a}/${r}/posts/${s}/${e}/mainImage.png`,type:"image/png"},p=yield l.nakama.sync_load_file(h,a,r,"server_post",s,`${e}_mainImage`,!1);m.mainImage.blob=p;let y=URL.createObjectURL(p);m.mainImage.thumbnail=y,setTimeout(()=>{URL.revokeObjectURL(y)},100)}return l.nakama.posts_orig[a][r]||(l.nakama.posts_orig[a][r]={}),l.nakama.posts_orig[a][r][s]||(l.nakama.posts_orig[a][r][s]={}),l.nakama.posts_orig[a][r][s][e]=m,!0}catch{return!1}})()}open_profile(e){if(this.isOpenProfile=!0,"me"==e.creator_id)this.modalCtrl.create({component:D.w}).then(a=>a.present());else{let a=e.server.isOfficial,r=e.server.target,s=e.creator_id;s==this.nakama.servers[a][r].session.user_id?this.modalCtrl.create({component:D.w,componentProps:{isOfficial:a,target:r}}).then(l=>l.present()):this.modalCtrl.create({component:k.y,componentProps:{info:{user:this.nakama.load_other_user(s,a,r)},group:{server:{isOfficial:a,target:r}}}}).then(l=>l.present())}setTimeout(()=>{this.isOpenProfile=!1},0)}open_post(e,a){this.isOpenProfile||(this.isOpenProfile=!0,this.modalCtrl.create({component:n.S,componentProps:{data:e,index:a+1}}).then(r=>{delete this.global.p5key.KeyShortCut.Digit,delete this.global.p5key.KeyShortCut.AddAct,r.onDidDismiss().then(s=>{s.data||this.AddShortcut()}),r.present()}),setTimeout(()=>{this.isOpenProfile=!1},0))}AddShortcut(){this.global.p5key&&this.global.p5key.KeyShortCut&&(this.global.p5key.KeyShortCut.Digit=e=>{this.nakama.posts.length>e?this.open_post(this.nakama.posts[e],e):this.add_post()}),this.global.p5key&&this.global.p5key.KeyShortCut&&!this.global.p5key.KeyShortCut.AddAct&&(this.global.p5key.KeyShortCut.AddAct=()=>{this.add_post()})}ionViewWillLeave(){delete this.global.p5key.KeyShortCut.Digit,delete this.global.p5key.KeyShortCut.AddAct,this.nakama.is_post_lock=!1}}return(i=g).\u0275fac=function(e){return new(e||i)(t.GI1(U.Y),t.GI1(S.h),t.GI1(j.o),t.GI1($.A1),t.GI1(A.wX),t.GI1(L.k),t.GI1(b.qS))},i.\u0275cmp=t.In1({type:i,selectors:[["app-community"]],decls:12,vars:5,consts:[[1,"ion-no-border"],[1,"add_post",3,"click"],["button","","name","add-circle-outline",2,"width","24px","height","24px"],[1,"header_online_circle",3,"click"],["id","CommunityScrollDiv",2,"height","100%","overflow-y","auto"],["id","CommunityMainContent"],["style","display: ruby-text",4,"ngIf"],[4,"ngIf"],[2,"display","ruby-text"],["button","","class","card_style",3,"id","click",4,"ngFor","ngForOf"],["style","width:100%; height: 72px;",4,"ngIf"],["button","",1,"card_style",3,"id","click"],["class","thumbnail_image","alt","",3,"src","style",4,"ngIf"],[1,"cardCreator"],[3,"click"],["style","color: #888; font-weight: normal;",4,"ngIf"],[1,"cardTitle"],[1,"cardContent"],["alt","",1,"thumbnail_image",3,"src"],[2,"color","#888","font-weight","normal"],[2,"width","100%","height","72px"],[1,"disconnect_info",3,"click"],["color","medium","name","document-text-outline",2,"width","60px","height","60px"],["color","medium"]],template:function(e,a){1&e&&(t.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),t.OEk(3),t.C$Y(),t.I0R(4,"div",1),t.qCj("click",function(){return a.add_post()}),t.wR5(5,"ion-icon",2),t.C$Y(),t.I0R(6,"div",3),t.qCj("click",function(){return a.nakama.toggle_all_session(!0)}),t.C$Y()()(),t.I0R(7,"ion-content")(8,"div",4)(9,"div",5),t.yuY(10,F,3,2,"div",6)(11,P,6,1,"div",7),t.C$Y()()()),2&e&&(t.yG2(3),t.cNF(a.lang.text.Community.Title),t.yG2(3),t.m_g("background-color: "+a.statusBar.colors[a.statusBar.settings.groupServer]+"; cursor: pointer;"),t.yG2(4),t.E7m("ngIf",a.nakama.posts.length),t.yG2(),t.E7m("ngIf",!a.nakama.posts.length))},dependencies:[T.ay,T.u_,b.KC,b.Gg,b.YY,b.MN,b.I7,b._i,b.wB,b.Ko,b.QR,b.tM,b.Md],styles:[".md[_ngcontent-%COMP%]   .add_post[_ngcontent-%COMP%]{position:absolute;right:68px;top:16px;cursor:pointer}.ios[_ngcontent-%COMP%]   .add_post[_ngcontent-%COMP%]{position:absolute;right:68px;top:10px;cursor:pointer}.card_style[_ngcontent-%COMP%]{width:90%;max-width:400px}.cardCreator[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;font-weight:700;max-height:20px;overflow-y:hidden}.cardTitle[_ngcontent-%COMP%]{max-height:24px;overflow-y:hidden}.cardContent[_ngcontent-%COMP%]{max-height:40px;overflow-y:hidden;padding-bottom:0;margin-bottom:13px}.thumbnail_image[_ngcontent-%COMP%]{width:100%;max-height:240px;object-fit:cover}"]}),g})()},{path:"add-post",loadChildren:()=>_.e(1592).then(_.bind(_,1592)).then(i=>i.AddPostPageModule)},{path:"post-viewer",loadChildren:()=>_.e(9368).then(_.bind(_,9368)).then(i=>i.PostViewerPageModule)}];let o=(()=>{var i;class g{}return(i=g).\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.a4G({type:i}),i.\u0275inj=t.s3X({imports:[R.qQ.forChild(v),R.qQ]}),g})(),c=(()=>{var i;class g{}return(i=g).\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.a4G({type:i}),i.\u0275inj=t.s3X({imports:[T.MD,G.y,b.wZ,o]}),g})()},416:(W,w,_)=>{_.d(w,{S:()=>F});var T=_(1528),G=_(9352),R=_(8744),x=_(340),D=_(4428),n=_(4496),k=_(5624),t=_(9240),U=_(4500),S=_(4668),j=_(7136),$=_(5020),A=_(1368);function L(P,O){if(1&P){const v=n.KQA();n.I0R(0,"ion-icon",10),n.qCj("click",function(){n.usT(v);const c=n.GaO();return n.CGJ(c.ChangeToAnother(-1))}),n.C$Y()}}function K(P,O){if(1&P&&(n.I0R(0,"ion-label",11),n.OEk(1),n.C$Y()),2&P){const v=n.GaO();n.yG2(),n.cNF(v.CurrentIndex+" / "+v.nakama.posts.length)}}function V(P,O){if(1&P){const v=n.KQA();n.I0R(0,"ion-icon",12),n.qCj("click",function(){n.usT(v);const c=n.GaO();return n.CGJ(c.ChangeToAnother(1))}),n.C$Y()}}function B(P,O){if(1&P&&n.wR5(0,"img",13),2&P){const v=n.GaO();n.E7m("src",v.PostInfo.mainImage.MainThumbnail,n.K6U)}}function Y(P,O){if(1&P){const v=n.KQA();n.I0R(0,"ion-footer")(1,"table",14)(2,"tr")(3,"td")(4,"ion-button",15),n.qCj("click",function(){n.usT(v);const c=n.GaO();return n.CGJ(c.EditPost())}),n.OEk(5),n.C$Y()(),n.I0R(6,"td")(7,"ion-button",16),n.qCj("click",function(){n.usT(v);const c=n.GaO();return n.CGJ(c.RemovePost())}),n.OEk(8),n.C$Y()()()()()}if(2&P){const v=n.GaO();n.yG2(5),n.oRS(" ",v.lang.text.AddPost.EditTitle," "),n.yG2(3),n.oRS(" ",v.lang.text.PostViewer.RemovePost," ")}}let F=(()=>{var P;class O{constructor(o,c,i,g,d,e,a){this.modalCtrl=o,this.navParam=c,this.lang=i,this.indexed=g,this.nakama=d,this.alertCtrl=e,this.global=a,this.isOwner=!1,this.HavePosts=!1,this.CurrentIndex=1,this.ContentChanging=!1}ngOnInit(){this.PostInfo=this.navParam.get("data"),this.CurrentIndex=this.navParam.get("index"),this.initialize()}ChangeContentWithKeyInput(){if(this.p5canvas){this.p5canvas.keyPressed=g=>{switch(g.code){case"KeyA":case"ArrowLeft":this.ChangeToAnother(-1);break;case"KeyD":case"ArrowRight":this.ChangeToAnother(1)}};let o=this.p5canvas.createVector(),c={};this.p5canvas.touchStarted=g=>{if("changedTouches"in g){for(let e=0,a=g.changedTouches.length;e<a;e++)c[g.changedTouches[e].identifier]=this.p5canvas.createVector(g.changedTouches[e].clientX,g.changedTouches[e].clientY);1===Object.keys(c).length&&(o=c[g.changedTouches[0].identifier].copy())}};const i=50;this.p5canvas.touchEnded=g=>{if("changedTouches"in g){let d;for(let a=0,r=g.changedTouches.length;a<r;a++)d=this.p5canvas.createVector(g.changedTouches[a].clientX,g.changedTouches[a].clientY),delete c[g.changedTouches[a].identifier];0===Object.keys(c).length&&(d.sub(o),d.x>i?this.ChangeToAnother(-1):d.x<-i&&this.ChangeToAnother(1))}}}}initialize(){if(this.PostInfo.mainImage){let o=this.PostInfo.mainImage.url;o||(URL.createObjectURL(this.PostInfo.mainImage.blob),setTimeout(()=>{URL.revokeObjectURL(o)},100)),this.PostInfo.mainImage.MainThumbnail=o}this.create_content(),this.isOwner="me"==this.PostInfo.creator_id||this.PostInfo.creator_id==this.nakama.servers[this.PostInfo.server.isOfficial][this.PostInfo.server.target].session.user_id,this.HavePosts=this.nakama.posts.length>1,this.ChangeContentWithKeyInput()}ChangeToAnother(o){if(this.ContentChanging)return;this.ContentChanging=!0;let c=this.CurrentIndex+o;c<=0||c>this.nakama.posts.length||(this.p5canvas&&this.p5canvas.remove(),this.CurrentIndex=c,this.PostInfo=this.nakama.posts[this.CurrentIndex-1],this.initialize()),this.ContentChanging=!1}create_content(){var o=this;let c=document.getElementById("PostContent");this.p5canvas=new G(i=>{i.setup=(0,T.c)(function*(){i.noCanvas();let g=i.createDiv(o.PostInfo.title);g.style("font-size","32px"),g.style("font-weight","bold"),g.parent(c);let d=i.createDiv();d.style("color","#888"),d.parent(c),i.createDiv(`${o.lang.text.PostViewer.CreateTime}: ${new Date(o.PostInfo.create_time).toLocaleString()}`).parent(d),o.PostInfo.create_time!=o.PostInfo.modify_time&&i.createDiv(`${o.lang.text.PostViewer.ModifyTime}: ${new Date(o.PostInfo.modify_time).toLocaleString()}`).parent(d);let a=i.createDiv();a.style("padding-bottom","8px"),a.parent(c);let r=i.createSpan(o.PostInfo.creator_name);if(r.style("color",`#${o.PostInfo.UserColor}`),r.style("font-weight","bold"),r.style("font-size","17px"),r.style("cursor","pointer"),r.elt.onclick=()=>{if("me"==o.PostInfo.creator_id)o.modalCtrl.create({component:x.w}).then(s=>s.present());else{let s=o.PostInfo.server.isOfficial,l=o.PostInfo.server.target,u=o.PostInfo.creator_id;u==o.nakama.servers[s][l].session.user_id?o.modalCtrl.create({component:x.w,componentProps:{isOfficial:s,target:l}}).then(f=>f.present()):o.modalCtrl.create({component:D.y,componentProps:{info:{user:o.nakama.load_other_user(u,s,l)},group:{server:{isOfficial:s,target:l}}}}).then(f=>f.present())}},r.parent(a),o.PostInfo.server.local)for(let s=0,l=o.PostInfo.attachments.length;s<l;s++){let u=yield o.indexed.loadBlobFromUserPath(o.PostInfo.attachments[s].path,o.PostInfo.attachments[s].type);o.PostInfo.attachments[s].blob=u}else for(let s=0,l=o.PostInfo.attachments.length;s<l;s++)try{let u=yield o.nakama.sync_load_file(o.PostInfo.attachments[s],o.PostInfo.server.isOfficial,o.PostInfo.server.target,"server_post",o.PostInfo.creator_id,`${o.PostInfo.id}_attach_${s}`,!1);o.PostInfo.attachments[s].blob=u}catch{}if(o.PostInfo.content){let s=o.PostInfo.content.split("\n");for(let l=0,u=s.length;l<u;l++){let f=!1,C=s[l].length-1,m=0;try{m=Number(s[l].substring(1,C)),f="["==s[l].charAt(0)&&"]"==s[l].charAt(C)&&!isNaN(m)}catch{}if(f)switch(o.PostInfo.attachments[m].viewer){case"image":{let h=o.PostInfo.attachments[m].url;if(!h)try{h=URL.createObjectURL(o.PostInfo.attachments[m].blob),setTimeout(()=>{URL.revokeObjectURL(h)},100)}catch(y){console.log("\uac8c\uc2dc\ubb3c image \ucca8\ubd80\ud30c\uc77c \ubd88\ub7ec\uc624\uae30 \uc624\ub958: ",y)}let p=i.createImg(h,`${m}`);p.style("cursor","pointer"),p.elt.onclick=()=>{let y=[];for(let I=0,M=o.PostInfo.attachments.length;I<M;I++)y.push({content:o.PostInfo.attachments[I]});o.modalCtrl.create({component:R.K,componentProps:{info:{content:o.PostInfo.attachments[m]},path:o.PostInfo.attachments[m].path,relevance:y,noEdit:!0},cssClass:"fullscreen"}).then(I=>I.present())},p.parent(c)}break;case"audio":{let h=o.PostInfo.attachments[m].url;if(!h)try{h=URL.createObjectURL(o.PostInfo.attachments[l].blob),setTimeout(()=>{URL.revokeObjectURL(h)},100)}catch(y){console.log("\uac8c\uc2dc\ubb3c audio \ucca8\ubd80\ud30c\uc77c \ubd88\ub7ec\uc624\uae30 \uc624\ub958: ",y)}let p=i.createAudio([h]);p.showControls(),p.parent(c)}break;case"video":{let h=o.PostInfo.attachments[m].url;if(!h)try{h=URL.createObjectURL(o.PostInfo.attachments[l].blob),setTimeout(()=>{URL.revokeObjectURL(h)},100)}catch(y){console.log("\uac8c\uc2dc\ubb3c video \ucca8\ubd80\ud30c\uc77c \ubd88\ub7ec\uc624\uae30 \uc624\ub958: ",y)}let p=i.createVideo([h]);p.style("width","100%"),p.style("height","auto"),p.showControls(),p.parent(c)}break;case"godot":{let h=`PostViewer_godot_pck_${m}`,p=i.createDiv();p.id(h),p.style("width","100%"),p.style("height","432px"),p.parent(c),setTimeout((0,T.c)(function*(){let y=!1;if(o.indexed.godotDB)try{yield o.indexed.GetGodotIndexedDB(),yield o.indexed.saveBlobToUserPath(o.PostInfo.attachments[l].blob,`tmp_files/duplicate/${o.PostInfo.attachments[m].filename}`,void 0,o.indexed.godotDB),y=!0}catch(I){console.log("\ub0b4\ubd80 \ud30c\uc77c \uc5c6\uc74c: ",I)}if(yield o.global.CreateGodotIFrame(h,{path:`tmp_files/duplicate/${o.PostInfo.attachments[m].filename}`,url:o.PostInfo.attachments[m].url},"start_load_pck",!0),!y){try{let I=yield o.indexed.loadBlobFromUserPath(o.PostInfo.attachments[m].path,"",void 0,o.indexed.ionicDB);yield o.indexed.GetGodotIndexedDB(),yield o.indexed.saveBlobToUserPath(I,`tmp_files/duplicate/${o.PostInfo.attachments[m].filename}`,void 0,o.indexed.godotDB)}catch{}yield o.global.CreateGodotIFrame(h,{path:`tmp_files/duplicate/${o.PostInfo.attachments[m].filename}`,url:o.PostInfo.attachments[m].url},"start_load_pck",!0)}o.PostInfo.attachments[m].url?o.global.godot_window.download_url():o.global.godot_window.start_load_pck()}),100)}break;default:{let h=i.createDiv();h.style("width","160px"),h.style("height","112px"),h.style("overflow","hidden"),h.style("background-color","grey"),h.style("margin-top","4px"),h.style("border-radius","8px"),h.style("cursor","pointer"),h.parent(c);let p=i.createP(o.PostInfo.attachments[m].filename);p.style("margin","0px 4px"),p.style("text-align","start"),p.parent(h);let y=i.createDiv();y.style("background-color","white"),y.style("margin-top","2px"),y.style("position","relative"),y.style("width","100%"),y.style("height","2px"),y.parent(h);let I=i.createSpan(o.lang.text.PostViewer.OpenFromViewer);I.style("margin","2px 4px 0px 4px"),I.style("text-align","start"),I.style("display","grid"),I.parent(h),h.elt.onclick=()=>{let M=[];for(let E=0,N=o.PostInfo.attachments.length;E<N;E++)M.push({content:o.PostInfo.attachments[E]});o.modalCtrl.create({component:R.K,componentProps:{info:{content:o.PostInfo.attachments[m]},path:o.PostInfo.attachments[m].path,relevance:M,noEdit:!0},cssClass:"fullscreen"}).then(E=>E.present())}}}else i.createDiv(s[l]+"&nbsp").parent(c)}}})})}EditPost(){this.modalCtrl.dismiss({edit:!0}),this.nakama.EditPost(this.PostInfo)}RemovePost(){var c,o=this;this.alertCtrl.create({header:this.lang.text.PostViewer.RemovePost,message:this.lang.text.ChatRoom.CannotUndone,buttons:[{text:this.lang.text.TodoDetail.remove,cssClass:"redfont",handler:(c=(0,T.c)(function*(){yield o.nakama.RemovePost(o.PostInfo),o.modalCtrl.dismiss()}),function(){return c.apply(this,arguments)})}]}).then(c=>c.present())}ionViewDidLeave(){this.p5canvas&&this.p5canvas.remove()}}return(P=O).\u0275fac=function(o){return new(o||P)(n.GI1(k.qS),n.GI1(t.a6),n.GI1(U.o),n.GI1(S.k),n.GI1(j.h),n.GI1(k.iW),n.GI1($.A1))},P.\u0275cmp=n.In1({type:P,selectors:[["app-post-viewer"]],decls:13,vars:8,consts:[[3,"translucent"],["slot","start",3,"click"],["defaultHref",""],["class","relevance_change","style","padding-right: 4px;","slot","end","name","arrow-back-circle-outline",3,"click",4,"ngIf"],["slot","end",4,"ngIf"],["class","relevance_change","style","padding-right: 16px; padding-left: 4px;","slot","end","name","arrow-forward-circle-outline",3,"click",4,"ngIf"],[3,"fullscreen"],["style","width: 100%; height: auto;","alt","MainImage",3,"src",4,"ngIf"],["id","PostContent",2,"padding","16px"],[4,"ngIf"],["slot","end","name","arrow-back-circle-outline",1,"relevance_change",2,"padding-right","4px",3,"click"],["slot","end"],["slot","end","name","arrow-forward-circle-outline",1,"relevance_change",2,"padding-right","16px","padding-left","4px",3,"click"],["alt","MainImage",2,"width","100%","height","auto",3,"src"],[2,"width","100%","background-color","black"],["expand","block",3,"click"],["color","danger","expand","block",3,"click"]],template:function(o,c){1&o&&(n.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),n.OEk(3),n.C$Y(),n.I0R(4,"ion-buttons",1),n.qCj("click",function(){return c.modalCtrl.dismiss()}),n.wR5(5,"ion-back-button",2),n.C$Y(),n.yuY(6,L,1,0,"ion-icon",3)(7,K,2,1,"ion-label",4)(8,V,1,0,"ion-icon",5),n.C$Y()(),n.I0R(9,"ion-content",6),n.yuY(10,B,1,1,"img",7),n.wR5(11,"div",8),n.C$Y(),n.yuY(12,Y,9,2,"ion-footer",9)),2&o&&(n.E7m("translucent",!0),n.yG2(3),n.cNF(c.lang.text.PostViewer.Title),n.yG2(3),n.E7m("ngIf",c.HavePosts),n.yG2(),n.E7m("ngIf",c.HavePosts),n.yG2(),n.E7m("ngIf",c.HavePosts),n.yG2(),n.E7m("fullscreen",!0),n.yG2(),n.E7m("ngIf",c.PostInfo.mainImage&&c.PostInfo.mainImage.MainThumbnail),n.yG2(2),n.E7m("ngIf",c.isOwner))},dependencies:[A.u_,k.sn,k.GS,k._i,k.eV,k.wB,k.Ko,k.QR,k.tM,k.Md,k.Im],styles:[".relevance_change[_ngcontent-%COMP%]{width:25px;height:25px}"]}),O})()}}]);