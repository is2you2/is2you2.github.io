"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[887],{887:(ut,Se,C)=>{C.r(Se),C.d(Se,{MainPageModule:()=>nt});var ge=C(177),$e=C(4341),L=C(5374),ke=C(9858),U=C(467),ie=C(7100),Ce=C(4237),je=C(92),fe=C(8326),De=C(617),Y=C(9969),t=C(3953),Ve=C(4234),Le=C(8065),Ge=C(755),He=C(3307),ze=C(5547),Ue=C(9900);const Xe=["LocalToRemoteSel"];function Ye(h,F){1&h&&t.nrm(0,"ion-icon",14)}function We(h,F){1&h&&t.nrm(0,"ion-icon",15)}function Je(h,F){1&h&&(t.j41(0,"div",16),t.EFF(1,"A"),t.k0s())}function Ke(h,F){if(1&h){const _=t.RV6();t.j41(0,"div")(1,"div",17),t.bIt("click",function(){t.eBV(_);const o=t.XpG();return t.Njj(o.nakama.open_add_todo_page())}),t.nrm(2,"ion-icon",18),t.j41(3,"div")(4,"ion-label",19),t.EFF(5),t.k0s()()()()}if(2&h){const _=t.XpG();t.Y8G("@emptyTodoToggle",void 0),t.R7$(5),t.JRh(_.lang.text.Main.NoTodo)}}function Qe(h,F){if(1&h){const _=t.RV6();t.j41(0,"div")(1,"ion-item",21),t.bIt("click",function(){const o=t.eBV(_).$implicit,x=t.XpG(2);return t.Njj(x.TodoServerSelected(o))}),t.j41(2,"ion-label"),t.EFF(3),t.k0s()()()}if(2&h){const _=F.$implicit;t.R7$(3),t.JRh(_.name)}}function Ze(h,F){if(1&h&&(t.j41(0,"ion-content")(1,"ion-item-divider")(2,"ion-label"),t.EFF(3),t.k0s()(),t.DNE(4,Qe,4,1,"div",20),t.k0s()),2&h){const _=t.XpG();t.R7$(3),t.JRh(_.lang.text.Main.MigrateRemote),t.R7$(),t.Y8G("ngForOf",_.SelectableTodoServer)}}function qe(h,F){1&h&&(t.j41(0,"div",25),t.EFF(1,"`"),t.k0s())}function et(h,F){if(1&h&&(t.j41(0,"div",25),t.EFF(1),t.k0s()),2&h){const _=t.XpG(2).index;t.R7$(),t.SpI(" ",(_+1)%10," ")}}function tt(h,F){if(1&h){const _=t.RV6();t.j41(0,"span")(1,"button",26),t.bIt("click",function(){t.eBV(_);const o=t.XpG().$implicit,x=t.XpG(2);return t.Njj(x.ChangeFilterValue(o.value))})("contextmenu",function(){t.eBV(_);const o=t.XpG().$implicit,x=t.XpG(2);return t.Njj(x.FilterContextAct(o))}),t.DNE(2,et,2,1,"div",24),t.EFF(3),t.k0s()()}if(2&h){const _=t.XpG(),f=_.$implicit,o=_.index,x=t.XpG(2);t.R7$(),t.Aen("background-color: "+(f.color||"#8888")+"; "+(x.CurrentFilterValue===f.value?"border: 4px solid var(--ion-color-secondary); margin: -4px 4px 4px -4px;":"")),t.Y8G("id","filterSel_"+o),t.R7$(),t.Y8G("ngIf",x.global.ShowHint&&x.global.portalHint&&o<10),t.R7$(),t.SpI(" ",f.force_name||x.lang.text.TodoDetail[f.name]," ")}}function it(h,F){if(1&h){const _=t.RV6();t.j41(0,"span")(1,"input",27),t.bIt("input",function(o){t.eBV(_);const x=t.XpG().$implicit,e=t.XpG(2);return t.Njj(e.GetFilterInput(o,x.name))})("blur",function(){t.eBV(_);const o=t.XpG(3);return t.Njj(o.global.toggleBlockMainShortcut(!1))})("focus",function(){t.eBV(_);const o=t.XpG(3);return t.Njj(o.global.toggleBlockMainShortcut(!0))}),t.k0s()()}if(2&h){const _=t.XpG().$implicit,f=t.XpG(2);t.R7$(),t.Y8G("placeholder",f.lang.text.TodoDetail[_.name])}}function ot(h,F){if(1&h&&(t.j41(0,"span"),t.DNE(1,tt,4,5,"span",10)(2,it,2,1,"span",10),t.k0s()),2&h){const _=F.$implicit;t.R7$(),t.Y8G("ngIf",!_.type),t.R7$(),t.Y8G("ngIf","input"==_.type)}}function at(h,F){if(1&h){const _=t.RV6();t.j41(0,"div",22)(1,"button",23),t.bIt("click",function(){t.eBV(_);const o=t.XpG();return t.Njj(o.SwitchTargetFilter())})("contextmenu",function(){t.eBV(_);const o=t.XpG();return t.Njj(o.ReverseSwitchTargetFilter())}),t.DNE(2,qe,2,0,"div",24),t.EFF(3),t.k0s(),t.DNE(4,ot,3,2,"span",20),t.k0s()}if(2&h){const _=t.XpG();t.R7$(2),t.Y8G("ngIf",_.global.ShowHint&&_.global.portalHint),t.R7$(),t.SpI(" ",_.lang.text.TodoDetail[_.TargetFilterDisplayName]," "),t.R7$(),t.Y8G("ngForOf",_.AllCategories[_.TargetFilterName])}}var P=function(h){return h[h.None=0]="None",h[h.Status=1]="Status",h[h.Importance=2]="Importance",h[h.Color=3]="Color",h[h.Creator=4]="Creator",h[h.InputText=5]="InputText",h}(P||{});const lt=[{path:"",component:(()=>{var h;class F{constructor(f,o,x,e,ue,c,s,W,J){this.global=f,this.lang=o,this.nakama=x,this.statusBar=e,this.indexed=ue,this.alertCtrl=c,this.p5loading=s,this.noti=W,this.p5toast=J,this.isPlayingCanvas={loop:!0},this.TargetFilterDisplayName="FilterCat_0",this.TargetFilterName=1,this.AllCategories={},this.CurrentFilterValue=null,this.SelectableTodoServer=[],this.isEmptyTodo=!1}ngOnInit(){let f=document.getElementById("p5todo");if(this.indexed.ionicDB?!f&&!this.global.p5todo&&this.CreateTodoManager():this.indexed.PortalTabCallback.push(()=>{!f&&!this.global.p5todo&&this.CreateTodoManager()}),"MobilePWA"==je.aH){let o;this.global.WindowOnBlurAct.todobackground=()=>{var x;o=setInterval(()=>{var e;null===(e=this.global.p5todo)||void 0===e||e.redraw()},(null===(x=this.global.p5todo)||void 0===x?void 0:x.frameRate())||50)},this.global.windowOnFocusAct.todobackground=()=>{o&&clearInterval(o)}}this.global.PortalBottonTabAct.Todo=()=>{var o;null===(o=this.ViewInitFunc)||void 0===o||o.call(this)}}toggle_session(){this.nakama.toggle_all_session(),this.global.p5todo.redraw()}toggleCanvasPlaying(){var f,o;this.isPlayingCanvas.loop=!this.isPlayingCanvas.loop,this.isPlayingCanvas.loop?null===(f=this.global.p5todo)||void 0===f||f.loop():null===(o=this.global.p5todo)||void 0===o||o.noLoop()}SwitchTargetFilter(f){var o,x;switch(this.TargetFilterName=null!=f?f:(this.TargetFilterName+1)%6,this.TargetFilterName){case P.None:this.TargetFilterDisplayName="FilterCat_0";break;case P.Importance:this.TargetFilterDisplayName="Importance";break;case P.Color:this.TargetFilterDisplayName="CustomColor";break;case P.Status:this.TargetFilterDisplayName="Status";break;case P.Creator:this.TargetFilterDisplayName="FilterByCreator";break;case P.InputText:this.TargetFilterDisplayName="AsString"}this.CurrentFilterValue=null,null===(o=(x=this.global).p5FilteringTodos)||void 0===o||o.call(x,P.None,this.TargetFilterDisplayName)}ReverseSwitchTargetFilter(){return this.TargetFilterName=this.TargetFilterName+6-2,this.SwitchTargetFilter(),!1}ChangeFilterValue(f){this.CurrentFilterValue=this.CurrentFilterValue===f?null:f,this.global.p5FilteringTodos()}FilterContextAct(f){return this.global.p5FilterContextMenu(f),!1}CreateTodoManager(){var f,o=this;setTimeout(()=>{"DesktopPWA"!=je.aH&&this.toggleCanvasPlaying()},8e3);let x=document.getElementById("todo");null===(f=this.global.p5todo)||void 0===f||f.remove(),this.global.p5todo=new fe(e=>{let B,pe,ne,we,_e,ue=this.statusBar,c={},s=[],W=[],J=[],K=e.createVector(0,0),S=e.createVector(0,0),j=1,V=e.createVector(0,0),Q=this.nakama,Pe=this.indexed,H=[],$=!1,oe=this.isPlayingCanvas;this.GetFilterInput=(p,l)=>{if("InputPlaceHolder"===l){const d=p.target.value;for(let a=0,g=s.length;a<g;a++){var r;let m=!1;const T=c[s[a]].json;if(T.title){if(T.title.indexOf(d)>=0&&(m=!0),m){c[s[a]].isHidden=!m;continue}(null===(r=T.description)||void 0===r?void 0:r.indexOf(d))>=0&&(m=!0),c[s[a]].isHidden=!m}}}this.isPlayingCanvas.loop||e.redraw()},e.setup=(0,U.A)(function*(){let p=e.createCanvas(x.clientWidth,x.clientHeight);p.parent(x),p.id("p5todo"),p.elt.oncontextmenu=function(){var r=(0,U.A)(function*(d){for(let a=s.length-1;a>=0;a--){const g=c[s[a]];if("AddButton"!=g.json.id&&g.position.dist(X(d.offsetX,d.offsetY))<g.EllipseSize/2){let T="";try{let R;try{R=`todo/${g.json.id}_${g.json.remote.isOfficial}_${g.json.remote.target}/thumbnail.png`}catch{R=`todo/${g.json.id}/thumbnail.png`}let N=yield Pe.loadBlobFromUserPath(R,"image/png");const A=URL.createObjectURL(N);T=`<div style="text-align: center"><img src="${A}" alt="todo_image" style="border-radius: 2px"></div>`,setTimeout(()=>{URL.revokeObjectURL(A)},100)}catch{}o.alertCtrl.create({header:g.json.title,message:new De.Vk(T+`<div>${g.json.description||""}</div>`),buttons:[{text:o.lang.text.TodoDetail.TodoComplete,handler:()=>{!function(){var N=(0,U.A)(function*(){try{yield Q.doneTodo(g.json)}catch(A){console.log("\ud560 \uc77c \uc644\ub8cc \uc624\ub958: ",A)}});return function(){return N.apply(this,arguments)}}()()}},{text:o.lang.text.TodoDetail.remove,cssClass:"redfont",handler:()=>{!function(){var N=(0,U.A)(function*(){try{yield Q.deleteTodoFromStorage(!0,g.json)}catch(A){console.log("\ud560 \uc77c \uc0ad\uc81c \uc624\ub958: ",A)}});return function(){return N.apply(this,arguments)}}()()}}]}).then(R=>{Oe(),R.onDidDismiss().then(()=>{$=!1}),$=!0,R.present()});break}}});return function(d){return r.apply(this,arguments)}}(),e.smooth(),e.noStroke(),e.pixelDensity(1),e.ellipseMode(e.CENTER),e.rectMode(e.CENTER),e.textAlign(e.CENTER,e.CENTER),e.textSize(20),e.textLeading(28),e.textWrap(e.CHAR),e.imageMode(e.CENTER);let l=Number(localStorage.getItem("p5todoScale")||1);dt(),o.ViewInitFunc=be,j=l,localStorage.setItem("p5todoScale",`${j}`),o.global.p5todoStopCanvas=()=>{$=!0,e.noLoop()},o.global.p5todoPlayCanvas=()=>{$=!1,e.windowResized(),o.isPlayingCanvas.loop&&e.loop()},o.global.p5todoAddtodo=r=>{let d=JSON.parse(r),a=d.id;if(d.remote&&(a+=`_${d.remote.isOfficial}_${d.remote.target}`),!d.removed){if(o.global.AddTodoTags(d),d.done){for(let g=s.length-1;g>=0;g--)if(s[g]==a)return void c[s[g]].makeDone()}else c[a]?(c[a].json=d,c[a].initialize()):c[a]=new Ie(d);o.isPlayingCanvas.loop||(pe=c[a],e.loop()),ne()}},ne=()=>{s=Object.keys(c),o.isEmptyTodo=!s.length,o.isEmptyTodo||(c.AddButton?1==s.length&&c.AddButton.makeDone():(c.AddButton=new Ie("",!0),s=Object.keys(c)))},o.global.p5removeTodo=(r,d=!1)=>{let a=JSON.parse(r),g=a.id;a.remote&&(g+=`_${a.remote.isOfficial}_${a.remote.target}`);for(let m=s.length-1;m>=0;m--)if(s[m]==g){c[s[m]].RemoveTodo();break}o.global.RemoveTodoTags(a),d||(o.isEmptyTodo=!Object.keys(s).length,ne(),e.redraw())},o.global.p5removeAllTodo=(0,U.A)(function*(){let r=yield o.indexed.GetFileListFromDB("todo/RemoteTodo_");for(let g of r)if(g.indexOf("/info.todo")>=0){var d,a;let m=yield o.indexed.loadTextFromUserPath(g),T=JSON.parse(m);(yield o.indexed.GetFileListFromDB(`todo/${T.id}`)).forEach(M=>o.indexed.removeFileFromUserPath(M)),o.nakama.RemoveLocalPushSchedule(T),o.nakama.removeRegisteredId(T.noti_id),o.noti.ClearNoti(T.noti_id),null===(d=(a=o.global).p5removeTodo)||void 0===d||d.call(a,m,!0)}o.isEmptyTodo=!Object.keys(s).length,ne(),e.redraw()}),we=function(){var r=(0,U.A)(function*(){c={},s.length=0;let d=yield o.indexed.GetFileListFromDB("todo/");for(let a=0,g=d.length;a<g;a++)if(d[a].indexOf("/info.todo")>=0){let m=yield o.indexed.loadTextFromUserPath(d[a]);o.global.p5todoAddtodo(m)}o.isEmptyTodo=!Object.keys(s).length});return function(){return r.apply(this,arguments)}}(),we(),o.SwitchTargetFilter(o.TargetFilterName),o.AllCategories[P.None]=o.global.TodoTagsKey,o.AllCategories[P.Importance]=[{name:"Importance_0",color:"#58a19288",value:"0"},{name:"Importance_1",color:"#ddbb4188",value:"1"},{name:"Importance_2",color:"#b9543788",value:"2"}],o.AllCategories[P.Color]=[{name:"ColorFilterRed",color:"#ff000088",value:[-30,30]},{name:"ColorFilterYellow",color:"#ffff0088",value:[30,90]},{name:"ColorFilterGreen",color:"#00ff0088",value:[90,150]},{name:"ColorFilterCyan",color:"#00ffff88",value:[150,210]},{name:"ColorFilterBlue",color:"#0000ff88",value:[210,270]},{name:"ColorFilterMagenta",color:"#ff00ff88",value:[270,330]},{name:"ColorFilterNone",color:"#bbbbbbbb"}],o.AllCategories[P.Status]=[{name:"TimeBefore",color:"#bbbbbb88",value:"before"},{name:"TimeIn",color:"#00ff0088",value:"ontime"},{name:"TimeOut",color:"#b9543788",value:"after"},{name:"Yesterday",color:"#45678988",value:"yesterday"},{name:"Today",color:"#789abc88",value:"today"},{name:"Tomorrow",color:"#abcdef88",value:"tomorrow"}],o.AllCategories[P.Creator]=[{name:"CreatorLocal",color:"#bbbbbb88",value:"local"},{name:"CreatorMe",color:"#00ff0088",value:"server"},{name:"Requested",color:"#6789ab88",value:"worker"},{name:"CreatorOther",color:"#ba987688",value:"other"}],o.AllCategories[P.InputText]=[{name:"InputPlaceHolder",color:"#bbbbbb88",type:"input",value:"text"}],o.global.p5FilteringTodos=rt,o.global.p5FilterContextMenu=ct});const re=()=>{oe.loop||(e.loop(),_e&&clearTimeout(_e),_e=setTimeout(()=>{oe.loop||e.noLoop()},4e3))};let Re;const rt=(p,l)=>{switch(l&&(Re=l),null!=p?p:this.TargetFilterName){case P.None:if(null!=this.CurrentFilterValue){for(let a=0,g=s.length;a<g;a++)if("AddButton"==c[s[a]].json.id)c[s[a]].isHidden=!1;else{var d;const m=!(null!==(d=c[s[a]].json.tags)&&void 0!==d&&d.includes(this.global.TodoTagsKey[this.CurrentFilterValue].force_name));c[s[a]].isHidden=m,m&&c[s[a]].Repositioning()}re()}else s.forEach(a=>c[a].isHidden=!1);break;case P.Importance:if(this.CurrentFilterValue){for(let a=0,g=s.length;a<g;a++)if("AddButton"==c[s[a]].json.id)c[s[a]].isHidden=!1;else{const m=c[s[a]].json.importance!=this.CurrentFilterValue;c[s[a]].isHidden=m,m&&c[s[a]].Repositioning()}re()}else s.forEach(a=>c[a].isHidden=!1);break;case P.Color:for(let a=0,g=s.length;a<g;a++){let m;switch(e.push(),e.colorMode(e.HSB),c[s[a]].json.importance){case"0":m=e.color("#58a192");break;case"1":m=e.color("#ddbb41");break;case"2":m=e.color("#b95437")}try{m=e.color(c[s[a]].json.custom_color)}catch{}if(e.pop(),this.CurrentFilterValue){if(m){const T=(360+this.CurrentFilterValue[0])%360,k=(360+this.CurrentFilterValue[1])%360,M=e.hue(m);let R=!1;R=T<k?!(T<M&&M<k):k<M&&M<T;const N=e.saturation(m);R=R||!N,c[s[a]].isHidden=R,R&&c[s[a]].Repositioning()}}else if(void 0===this.CurrentFilterValue){if(m){const T=e.saturation(m);c[s[a]].isHidden=!!T,T&&c[s[a]].Repositioning()}}else c[s[a]].isHidden=!1}re();break;case P.Status:if(this.CurrentFilterValue){for(let a=0,g=s.length;a<g;a++)if("AddButton"==c[s[a]].json.id)c[s[a]].isHidden=!1;else{let m=!1;switch(this.CurrentFilterValue){case"before":m=!(c[s[a]].json.startFrom&&c[s[a]].json.startFrom>Date.now());break;case"ontime":m=!((c[s[a]].json.startFrom||0)<Date.now()&&(c[s[a]].json.limit||c[s[a]].json.written)>Date.now());break;case"after":m=!(c[s[a]].json.limit<=Date.now());break;case"yesterday":{const T=new Date;T.setDate(T.getDate()-1),T.setHours(0,0,0,0);const k=new Date;k.setDate(k.getDate()-1),k.setHours(23,59,59,999),m=!((c[s[a]].json.startFrom||c[s[a]].json.written)<=k&&c[s[a]].json.limit>T)}break;case"today":{const T=new Date;T.setHours(0,0,0,0);const k=new Date;k.setHours(23,59,59,999),m=!((c[s[a]].json.startFrom||c[s[a]].json.written)<=k&&c[s[a]].json.limit>T)}break;case"tomorrow":{const T=new Date;T.setDate(T.getDate()+1),T.setHours(0,0,0,0);const k=new Date;k.setDate(k.getDate()+1),k.setHours(23,59,59,999),m=!((c[s[a]].json.startFrom||c[s[a]].json.written)<=k&&c[s[a]].json.limit>T)}}c[s[a]].isHidden=m,m&&c[s[a]].Repositioning()}re()}else s.forEach(a=>c[a].isHidden=!1);break;case P.Creator:if(this.CurrentFilterValue){for(let a=0,g=s.length;a<g;a++)if("AddButton"==c[s[a]].json.id)c[s[a]].isHidden=!1;else{let m=!1;switch(this.CurrentFilterValue){case"local":m=c[s[a]].json.storeAt!=this.CurrentFilterValue;break;case"server":m=void 0===c[s[a]].json.remote;break;case"worker":m=!(void 0!==c[s[a]].json.workers&&c[s[a]].json.is_me);break;case"other":m=c[s[a]].json.is_me||"local"==c[s[a]].json.storeAt}c[s[a]].isHidden=m,m&&c[s[a]].Repositioning()}re()}else s.forEach(a=>c[a].isHidden=!1)}e.redraw()},ct=p=>{"FilterByCreator"===this.TargetFilterDisplayName&&"local"===p.value&&(this.SelectableTodoServer=Q.get_all_server_info(!0,!0,!0),this.SelectableTodoServer.length&&(this.global.toggleBlockMainShortcut(!0),this.LocalToRemoteSel.onDidDismiss().then(()=>{this.global.toggleBlockMainShortcut(!1)}),this.LocalToRemoteSel.present()))};this.TodoServerSelected=function(){var p=(0,U.A)(function*(l){const r=l.isOfficial,d=l.target,a="migrateTodo";let g=[];for(let N=s.length-1;N>=0;N--)"AddButton"!=c[s[N]].json.id&&"local"==c[s[N]].json.storeAt&&g.push(c[s[N]]);if(g.length)for(;g.length;){const N=g.shift(),A=JSON.stringify(N.json),q=JSON.parse(A),y=JSON.parse(A),i=JSON.parse(A);i.storeAt=`${r}/${d}`,i.remote=l;try{var m,T;yield o.p5loading.update({id:a,message:`${o.lang.text.TodoDetail.ApplyingTodo}: ${i.title}`});const ee=!!i.attach.length;delete i.display_store,delete i.display_creator;let z={};try{z.apache_port=l.apache_port,z.cdn_port=l.cdn_port,z.user_id=Q.servers[r][d].session.user_id}catch{z={}}for(let n=0,u=y.attach.length;n<u;n++){try{const b=y.attach[n].filename,v=yield o.indexed.loadBlobFromUserPath(y.attach[n].path,y.attach[n].type),E=`tmp_files/todo/${b}`;yield o.indexed.saveBlobToUserPath(v,E),i.attach[n].path=E,i.attach[n].blob=v}catch{if(y.attach[n].url){const v=y.attach[n].filename,I=yield(yield fetch(y.attach[n].url)).blob(),Z=`tmp_files/todo/${v}`;yield o.indexed.saveBlobToUserPath(I,Z),i.attach[n].path=Z,i.attach[n].blob=I,yield o.global.remove_file_from_storage(i.attach[n].url,z)}}delete i.attach[n].thumbnail,delete i.attach[n].alt_path,delete i.attach[n].url,delete i.attach[n].exist}if(yield o.nakama.deleteTodoFromStorage(!0,q,void 0,a),i.remote)try{const n=yield o.nakama.getRemoteTodoCounter(i.remote.isOfficial,i.remote.target);i.id=`RemoteTodo_${n}`}catch{}else i.id=new Date(i.create_at).toISOString().replace(/[:|.|\/]/g,"_");i.noti_id&&(o.nakama.RemoveLocalPushSchedule(i),o.nakama.removeRegisteredId(i.noti_id),o.noti.ClearNoti(i.noti_id)),i.noti_id=o.nakama.get_noti_id();let he=!1;try{y.attach.forEach(b=>{delete b.exist,delete b.thumbnail,delete b.base64,delete b.blob});const n=JSON.stringify(y.attach);let u=JSON.parse(JSON.stringify(i.attach));u.forEach(b=>{delete b.exist,delete b.thumbnail,delete b.base64,delete b.blob}),u=JSON.stringify(u),he=n!=u}catch{he=!0}if(ee&&he){if(y)try{for(let u=0,b=y.attach.length;u<b;u++){for(let v=0,E=i.attach.length;v<E;v++)if(i.attach[v].path==y.attach[u].path){y.attach[u].exist=!0,y.attach[u].index=v;break}(!y.attach[u].exist||y.attach[u].exist&&!i.attach[y.attach[u].index])&&(y.attach[u].url?""!==y.attach[u].type&&(yield o.global.remove_file_from_storage(y.attach[u].url,z)):yield o.indexed.removeFileFromUserPath(y.attach[u].path))}}catch{}let n;for(let u=0,b=i.attach.length;u<b;u++){let v,E=!1;try{if(n)throw"already exist";v=yield o.indexed.loadBlobFromUserPath(`${i.attach[u].path}_thumbnail.png`,"image/png"),E=!0}catch{}if(!i.attach[u].exist||!n&&"image"==i.attach[u].viewer){try{E||(v=yield o.indexed.loadBlobFromUserPath(i.attach[u].path,i.attach[u].type))}catch{}try{if(1!=i.CDN)throw"FFS \uc0ac\uc6a9 \uc21c\uc704\uc5d0 \uc5c6\uc74c";let I;if(I=yield o.global.try_upload_to_user_custom_fs(i.attach[u],o.nakama.users.self.display_name,a,i.title),!I)throw"\uc5c5\ub85c\ub4dc \uc2e4\ud328";delete i.attach[u].partsize,delete i.attach[u].size,i.attach[u].url=I}catch{try{i.attach[u].path=`todo/${i.id}_${i.remote.isOfficial}_${i.remote.target}/${i.attach[u].filename}`}catch{i.attach[u].path=`todo/${i.id}/${i.attach[u].filename}`}try{v||(v=yield o.indexed.loadBlobFromUserPath(i.attach[u].path,i.attach[u].type)),yield o.indexed.saveBlobToUserPath(v,i.attach[u].path)}catch{}}}else delete i.attach[u].exist;if(!n&&("image"==i.attach[u].viewer||E))try{n=URL.createObjectURL(v)}catch{}}o.p5loading.update({id:a,image:n||null}),n&&(yield new Promise(u=>{new fe(b=>{b.setup=()=>{b.noCanvas(),b.loadImage(n,v=>{v.width>v.height?v.resize(v.width/v.height*128,128):v.resize(128,v.height/v.width*128);let I=b.createCanvas(128,128);I.hide(),b.smooth(),b.pixelDensity(1),b.image(v,-(v.width-128)/2,-(v.height-128)/2);const Z=I.elt.toDataURL("image/png").replace("image/png","image/octet-stream");let te;try{te=`todo/${i.id}_${i.remote.isOfficial}_${i.remote.target}/thumbnail.png`}catch{te=`todo/${i.id}/thumbnail.png`}URL.revokeObjectURL(n),b.remove(),o.indexed.saveBase64ToUserPath(Z,te).then(ht=>{u()})},v=>{console.error("Todo-\ub4f1\ub85d\ub41c \uc774\ubbf8\uc9c0 \ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",v),URL.revokeObjectURL(n),b.remove(),u()})}})}))}if(!ee&&he&&y){let n;try{n=`todo/${i.id}_${i.remote.isOfficial}_${i.remote.target}/thumbnail.png`}catch{n=`todo/${i.id}/thumbnail.png`}if(yield o.indexed.removeFileFromUserPath(n),y.attach)for(let u=0,b=y.attach.length;u<b;u++)y.attach[u].url?""!==y.attach[u].type&&(yield o.global.remove_file_from_storage(y.attach[u].url,z)):yield o.indexed.removeFileFromUserPath(y.attach[u].path)}if(i.attach.forEach(n=>{URL.revokeObjectURL(n.thumbnail),delete n.thumbnail,delete n.exist,delete n.base64}),i.written=(new Date).getTime(),i.startFrom){const n=new Date(i.startFrom).getTime();(new Date).getTime()>n?delete i.startFrom:i.startFrom=n}if(i.limit=new Date(i.limit).getTime(),o.nakama.set_todo_notification(i),i.remote&&!i.remote.creator_id&&(i.remote.creator_id=o.nakama.servers[i.remote.isOfficial][i.remote.target].session.user_id),i.attach.forEach(n=>{URL.revokeObjectURL(n.thumbnail),delete n.thumbnail,delete n.exist,delete n.base64}),ee&&he&&y)for(let n=0,u=y.attach.length;n<u;n++){for(let b=0,v=i.attach.length;b<v;b++)if(i.attach[b].path==y.attach[n].path){y.attach[n].exist=!0,y.attach[n].index=b;break}if(!y.attach[n].exist||y.attach[n].exist&&!i.attach[y.attach[n].index])if(y.attach[n].url)""!==y.attach[n].type&&(yield o.global.remove_file_from_storage(y.attach[n].url,z));else try{yield o.nakama.sync_remove_file(y.attach[n].path,i.remote.isOfficial,i.remote.target,"todo_attach")}catch{}}for(let n=0,u=i.attach.length;n<u;n++)if(i.attach[n].url)delete i.attach[n].path,delete i.attach[n].size,delete i.attach[n].partsize;else try{if(2==i.CDN)throw"ForceSQL";!i.attach[n].blob.size&&i.attach[n].url&&(i.attach[n].blob=yield(yield fetch(i.attach[n].url)).blob());const b=o.nakama.servers[i.remote.isOfficial][i.remote.target].info.address,v=o.nakama.servers[i.remote.isOfficial][i.remote.target].info.useSSL?"https:":"http:";let E=`${o.nakama.users.self.display_name}/${i.id}`;try{E=`${i.remote.creator_id}/${i.id}`}catch{}const I=yield o.global.upload_file_to_storage(i.attach[n],{user_id:E,apache_port:z.apache_port,cdn_port:z.cdn_port},v,b,1==i.CDN,a,i.title);if(!I)throw"\ub9c1\ud06c \ub9cc\ub4e4\uae30 \uc2e4\ud328";delete i.attach[n].size,delete i.attach[n].partsize,i.attach[n].url=I}catch(b){console.log("cdn \uc5c5\ub85c\ub4dc \ucc98\ub9ac \uc2e4\ud328: ",b),"ForceSQL"==b&&i.attach[n].url&&(i.attach[n].blob=yield(yield fetch(i.attach[n].url)).blob());try{yield o.nakama.sync_save_file(i.attach[n],i.remote.isOfficial,i.remote.target,"todo_attach")}catch{}}const Ne=yield o.nakama.servers[i.remote.isOfficial][i.remote.target].client.writeStorageObjects(o.nakama.servers[i.remote.isOfficial][i.remote.target].session,[{collection:"server_todo",key:i.id,permission_read:2,permission_write:1,value:i}]);let Te,xe;yield o.nakama.updateRemoteCounter(i.remote.isOfficial,i.remote.target),yield o.nakama.servers[i.remote.isOfficial][i.remote.target].client.rpc(o.nakama.servers[i.remote.isOfficial][i.remote.target].session,"send_noti_fn",{receiver_id:[o.nakama.servers[i.remote.isOfficial][i.remote.target].session.user_id],title:"Manage_todo_add",content:{type:"add",collection:Ne.acks[0].collection,key:Ne.acks[0].key},code:Ce.I.MANAGE_TODO,persistent:!1}),i.is_me=!0,null===(m=(T=o.global).p5todoAddtodo)||void 0===m||m.call(T,JSON.stringify(i));try{Te=`todo/${i.id}_${i.remote.isOfficial}_${i.remote.target}/info.todo`}catch{Te=`todo/${i.id}/info.todo`}yield o.indexed.saveTextFileToUserPath(JSON.stringify(i),Te);for(let n=0,u=i.attach.length;n<u;n++)if("image"==i.attach[n].viewer&&i.attach[n].url){xe=i.attach[n].url;break}try{var k;let n=localStorage.getItem("fallback_fs");if(!n)throw"\uc0ac\uc6a9\uc790 \uc9c0\uc815 \uc11c\ubc84 \uc5c6\uc74c";let u=n.split("://"),b=u.pop().split(":"),v=u.pop();v?v+=":":v=o.global.checkProtocolFromAddress(b[0])?"https:":"http:";const E=null===(k=b[1])||void 0===k?void 0:k.split(","),I=`${v}//${b[0]}:${(null==E?void 0:E[2])||5e3}/`;let te=[localStorage.getItem("fallback_fs_push_tog")];yield o.nakama.remove_schedule_webpush(I,{todo_id:i.id},te),yield o.nakama.schedule_webpush(I,{id:i.noti_id,title:i.title,body:i.description,icon:"todo",image:xe,todo_id:i.id,time:i.startFrom||i.limit,data:{url:`/?todo=${A}&address=${Q.GetNodejsServerAddress(i.remote.isOfficial,i.remote.target,"nakama_port")}`}},te)}catch(n){console.log("FFS \ud560 \uc77c \uc54c\ub9bc \ub4f1\ub85d \uc808\ucc28 \uc624\ub958: ",n)}if(i.remote)try{const n=o.nakama.GetNodejsServerAddress(i.remote.isOfficial,i.remote.target,"webpush_port");let u=[o.nakama.servers[i.remote.isOfficial][i.remote.target].session.user_id];yield o.nakama.schedule_webpush(n,{id:i.noti_id,title:i.title,body:i.description,icon:"todo",image:xe,todo_id:i.id,time:i.startFrom||i.limit,data:{url:`/?todo=${A}&address=${Q.GetNodejsServerAddress(i.remote.isOfficial,i.remote.target,"nakama_port")}`}},u)}catch(n){console.log("\uc6d0\uaca9 \ud560 \uc77c \uc54c\ub9bc \uc608\uc57d \uad6c\uc131 \uc2e4\ud328: ",n)}o.p5loading.update({id:a,message:`${o.lang.text.TodoDetail.ApplyingTodo}: ${i.title}`,progress:1})}catch(ee){var M,R;console.error("\ud574\uc57c\ud560 \uc77c\uc774 \uc11c\ubc84\uc5d0 \uc804\uc1a1\ub418\uc9c0 \uc54a\uc74c: ",ee),null===(M=(R=o.global).p5todoAddtodo)||void 0===M||M.call(R,JSON.stringify(q)),o.p5toast.show({text:o.lang.text.TodoDetail.CanAddToServer}),o.p5loading.update({id:a,message:`${o.lang.text.TodoDetail.ApplyingTodo}: ${i.title}`})}yield new Promise(ee=>setTimeout(ee,0))}else o.p5toast.show({text:o.lang.text.Main.NoMigratable});o.p5loading.remove(a)});return function(l){return p.apply(this,arguments)}}();const dt=()=>{V.x=e.width/2,V.y=e.height/2,S.x=0,S.y=0,j=1,localStorage.setItem("p5todoScale",`${j}`),this.isPlayingCanvas.loop||e.redraw()};let w={Act:!1,lerp:0,Scale:e.createVector(),CamPos:e.createVector(),CamScale:0};const be=()=>{w.Act=!0,w.Scale.x=V.x,w.Scale.y=V.y,w.CamPos.x=S.x,w.CamPos.y=S.y,w.CamScale=j,this.isPlayingCanvas.loop||e.loop()};e.draw=()=>{if(this.global.stream?e.background(ie.ud?"#121212":"#fff"):e.clear(),e.push(),e.translate(V),e.scale(j),e.translate(S),this.TargetFilterName==P.None&&"Hidden"==this.CurrentFilterValue){for(let r=0,d=s.length;r<d;r++)if(c[s[r]].isAddButton){c[s[r]].display();break}}else for(let r=0,d=s.length;r<d;r++)c[s[r]].display();for(let r=J.length-1;r>=0;r--)J[r].display(),J[r].lifeTime<0&&J.splice(r,1);for(let r=W.length-1;r>=0;r--)W[r].DoneAnim();e.pop(),w.Act&&(w.lerp+=.07,V.x=e.lerp(w.Scale.x,e.width/2,ce(w.lerp)),V.y=e.lerp(w.Scale.y,e.height/2,ce(w.lerp)),S.x=e.lerp(w.CamPos.x,0,ce(w.lerp)),S.y=e.lerp(w.CamPos.y,0,ce(w.lerp)),j=e.lerp(w.CamScale,1,ce(w.lerp)),localStorage.setItem("p5todoScale",`${j}`),w.lerp>=1&&(w.Act=!1,w.lerp=0,V.x=e.width/2,V.y=e.height/2,S.x=0,S.y=0,j=1,localStorage.setItem("p5todoScale",`${j}`),this.isPlayingCanvas.loop||e.noLoop()))};let ce=p=>e.sin(p*e.PI/2);e.windowResized=()=>{$||setTimeout(()=>{let p=S.x/e.width,l=S.y/e.height;e.resizeCanvas(x.clientWidth,x.clientHeight),V.x=e.width/2,V.y=e.height/2,S.x=p*e.width,S.y=l*e.height},50)};let ae=!0;class Ie{constructor(l,r=!1){if(this.isAddButton=!1,this.EllipseSize=96,this.position=e.createVector(0,0),this.Velocity=e.createVector(0,0),this.Accel=e.createVector(0,0),this.isGrabbed=!1,this.TextColor=e.color(ie.ud?255:0),this.ProgressWeight=8,this.LerpProgress=0,this.isHidden=!1,this.InView=!1,this.LifeTime=1,this.json=l,r)return this.isAddButton=r,this.position.set(K),this.defaultColor=e.color(ie.ud?"#bbb":"#888"),void(this.json={id:"AddButton",written:0,limit:1,longSide:53,shortSide:11});this.Repositioning(),this.initialize()}Repositioning(){const l=e.max(e.width,e.height)||1;this.position.set(l/e.min(1,j),0).setHeading(e.random(-e.PI,e.PI))}initialize(){if(!this.json.custom_color)switch(this.json.importance){case"0":this.defaultColor=e.color("#58a192");break;case"1":this.defaultColor=e.color("#ddbb41");break;case"2":this.defaultColor=e.color("#b95437")}let r,l=Number(this.json.importance);switch(l){case 0:this.EllipseSize=96;break;case 1:this.EllipseSize=104;break;case 2:this.EllipseSize=112}if(this.ProgressCircleSize=this.EllipseSize-this.ProgressWeight,!H[l]){H[l]=e.createImage(this.EllipseSize,this.EllipseSize),H[l].loadPixels();let d=e.createVector(H[l].width/2,H[l].height/2);for(let a=0,g=H[l].height;a<g;a++)for(let m=0,T=H[l].width;m<T;m++){let k=e.createVector(m,a);d.dist(k)<this.EllipseSize/2-1&&H[l].set(m,a,e.color(255,80))}H[l].updatePixels()}try{r=`todo/${this.json.id}_${this.json.remote.isOfficial}_${this.json.remote.target}/thumbnail.png`}catch{r=`todo/${this.json.id}/thumbnail.png`}Pe.loadBlobFromUserPath(r,"").then(d=>{const a=URL.createObjectURL(d);e.loadImage(a,g=>{this.ThumbnailImage=g,this.ThumbnailImage.mask(H[l]),URL.revokeObjectURL(a)})}).catch(d=>{this.ThumbnailImage=null})}display(){e.push(),this.isGrabbed||(this.CalcPosition(),this.OnCollider(),this.position=this.position.add(this.Velocity)),e.translate(this.position),this.LerpProgress=e.map(Date.now(),this.json.startFrom||this.json.written,this.json.limit,0,1,!0),(this.isAddButton||this.json.written>this.json.limit)&&(this.LerpProgress=1);const l=e.width/2/j,r=e.height/2/j,d=this.EllipseSize/2;if(this.InView=this.position.x<l-S.x+d&&this.position.x>-l-S.x-d&&this.position.y<r-S.y+d&&this.position.y>-r-S.y-d,this.InView&&(this.isHidden?e.fill(128,40):e.fill("FilterByCreator"==Re&&this.json.remote?ue.colors[ue.groupServer[this.json.remote.isOfficial][this.json.remote.target]||"offline"]+e.hex(e.floor(e.lerp(34,96,this.LerpProgress)),2):(this.json.custom_color||this.defaultColor.toString("#rrggbb"))+e.hex(e.floor(e.lerp(34,96,this.LerpProgress)),2)),e.circle(0,0,this.EllipseSize),!this.isHidden&&this.ThumbnailImage&&e.image(this.ThumbnailImage,0,0,this.EllipseSize,this.EllipseSize),e.push(),this.isHidden||(e.noFill(),this.isAddButton?(e.push(),e.noStroke(),e.fill(255),e.rect(0,0,this.json.shortSide,this.json.longSide),e.rect(0,0,this.json.longSide,this.json.shortSide),e.pop()):(e.stroke(this.json.custom_color||this.defaultColor),e.strokeWeight(this.ProgressWeight)),e.rotate(-e.PI/2),this.LerpProgress<1?e.arc(0,0,this.ProgressCircleSize,this.ProgressCircleSize,0,this.LerpProgress*e.TWO_PI):e.circle(0,0,this.ProgressCircleSize)),e.pop(),!this.isHidden)){let m=.9*this.EllipseSize;this.TextColor=e.color(ie.ud?255:0,0==this.LerpProgress?128:255),e.fill(this.TextColor),e.text(this.json.title,0,0,m,m)}e.pop()}CalcPosition(){let l=this.position.dist(K),r=e.map(l,0,this.EllipseSize/8,0,1,!0),d=e.map(r,this.EllipseSize/4,0,1,.95,!0);this.Accel.x=r,this.Accel.y=0;let a=this.position.heading()-e.PI;this.Accel=this.Accel.setHeading(a),this.Velocity.add(this.Accel).mult(d)}OnCollider(){for(let l=0,r=s.length;l<r;l++)if(c[s[l]]!=this){let d=c[s[l]],a=this.position.dist(d.position),g=this.EllipseSize/2+d.EllipseSize/2;a<g&&(oe.loop||pe==this&&(pe=null,e.noLoop()),this.ReflectBounce(d,a/g),d.ReflectBounce(this,a/g))}}ReflectBounce(l,r){let d=fe.Vector.sub(this.position,l.position);this.Velocity.add(d.mult(1-r)).mult(.85)}makeDone(){var l=this;return(0,U.A)(function*(){l.LifeTime=1,yield new Promise(r=>setTimeout(r,500)),l.Velocity.set(K),l.Accel.set(K),l.OriginalEllipseSize=l.EllipseSize,l.OriginalProgWeight=l.ProgressWeight,l.json.done=!0,W.push(l),oe.loop||e.loop()})()}DoneAnim(){var l=this;return(0,U.A)(function*(){if(oe.loop||e.loop(),l.LifeTime-=.04,l.EllipseSize=l.OriginalEllipseSize*l.LifeTime,l.ProgressWeight=l.OriginalProgWeight*l.LifeTime,l.ProgressCircleSize=l.EllipseSize-l.ProgressWeight,l.LifeTime<.5&&J.push(new Ae(l.position,l.json.custom_color||l.defaultColor)),l.TextColor=e.color(ie.ud?255:0,(0==l.LerpProgress?128:255)*l.LifeTime),l.isAddButton&&(l.json.longSide*=l.LifeTime,l.json.shortSide*=l.LifeTime),l.LifeTime<0){oe.loop||setTimeout(()=>e.noLoop(),1e3),l.RemoveTodo(),ne();for(let r=0;r<20;r++)J.push(new Ae(l.position,l.json.custom_color||l.defaultColor))}})()}Clicked(){ae&&!$&&!this.json.done&&(this.isAddButton?Q.open_add_todo_page():Q.open_add_todo_page(JSON.stringify(this.json)))}RemoveTodo(){let l=this.json.id;this.json.remote&&(l+=`_${this.json.remote.isOfficial}_${this.json.remote.target}`);for(let r=s.length-1;r>=0;r--)if(s[r]==l){s.splice(r,1);break}for(let r=W.length-1;r>=0;r--)if(W[r]=this){W.splice(r,1);break}delete c[l]}}class Ae{constructor(l,r){this.pos=e.createVector(),this.vel=e.createVector(),this.acc=e.createVector(),this.RectSize=4,this.rotate=0,this.pos.set(l),e.randomSeed(e.random(-255,255)),this.lifeTime=e.random(180,255),this.vel.set(e.random(-75,75),e.random(-40,-80)),this.acc.set(0,e.random(-1,-3)),e.push(),e.colorMode(e.HSB);let d=e.hue(r),a=e.saturation(r),g=e.brightness(r);this.color=e.color(e.random(d-20,d+20),e.random(a-20,a+20),e.random(g-20,g+20),this.lifeTime/255),e.pop(),this.RectSize=e.random(3,4),this.rotate=e.random(-e.PI,e.PI)}display(){this.color.setAlpha(this.lifeTime/255),e.fill(this.color),this.CalcPhysics(),e.push(),e.translate(this.pos),e.rotate(this.rotate),e.rect(0,0,this.RectSize,this.RectSize),e.pop(),this.lifeTime--}CalcPhysics(){this.acc.y+=.07,this.vel.add(this.acc),this.pos.x+=this.vel.x/100,this.pos.y+=this.vel.y/100}}let Ee,ye=e.createVector(),D=e.createVector(),ve=0,G=e.createVector();e.mousePressed=p=>{let l=p.target==document.getElementById("p5todo");if(!$&&l)switch(ae=!0,p.which){case 1:D.set(e.mouseX,e.mouseY),G.set(S),ye.set(e.mouseX,e.mouseY);for(let r=s.length-1;r>=0;r--)if(c[s[r]].position.dist(X())<c[s[r]].EllipseSize/2){c[s[r]].isGrabbed=!0,B=c[s[r]],D=X();break}break;case 2:be()}},e.mouseDragged=p=>{let l=p.target==document.getElementById("p5todo");if(!$&&l&&1===(this.isPlayingCanvas.loop||e.redraw(),p.which))try{ye.set(e.mouseX,e.mouseY);let r=0;B?(B.position=X(),r=D.dist(X())):(S.set(G).add(ye.sub(D).div(j)),r=G.dist(S)),r>15&&(ae=!1)}catch{}},e.mouseReleased=p=>{let l=p.target==document.getElementById("p5todo");!$&&l&&1===p.which&&Me()};let de=e.createVector(),X=(p,l)=>(de.set(p||e.mouseX,l||e.mouseY),de.sub(V),de.div(j),de.sub(S),de);e.mouseWheel=p=>{let l=p.target==document.getElementById("p5todo");!$&&l&&(this.isPlayingCanvas.loop||e.redraw(),j*=p.deltaY<0?1.1:.9,localStorage.setItem("p5todoScale",`${j}`))};let O=[],le=!1;e.touchStarted=p=>{let l=p.target==document.getElementById("p5todo");if(!$&&l)switch(ae=!0,O=p.touches,le=!0,O.length){case 1:Be();break;case 2:let r=O[0].clientX,d=O[0].clientY-56,a=O[1].clientX,g=O[1].clientY-56;ae=!1,ve=e.dist(r,d,a,g),D.x=(r+a)/2,D.y=(d+g)/2,G.x=S.x,G.y=S.y,Ee=j,B&&(B.isGrabbed=!1,B.Velocity.set(K),B.Accel.set(K),B=null);break;default:le=!1,be()}};let me=e.createVector();e.touchMoved=p=>{let l=p.target==document.getElementById("p5todo");if(!$&&l){switch(this.isPlayingCanvas.loop||e.redraw(),O=p.touches,O.length){case 1:{if(!le)return;let r=p.changedTouches[0];me.set(r.clientX,r.clientY-56);let d=0;B?(B.position=X(),d=D.dist(X(me.x,me.y))):(S.set(G).add(me.sub(D).div(j)),d=G.dist(S)),d>15&&(ae=!1)}break;case 2:{if(!le)return;let r=O[0].clientX,d=O[0].clientY-56,a=O[1].clientX,g=O[1].clientY-56,m=(r+a)/2,T=(d+g)/2;j=e.dist(r,d,a,g)/ve*Ee,localStorage.setItem("p5todoScale",`${j}`);let R=(T-D.y)/j;S.x=G.x+(m-D.x)/j,S.y=G.y+R}}return!1}},e.touchEnded=p=>{let l=p.target==document.getElementById("p5todo");if(!$&&l)switch(O=p.touches,O.length){case 0:Me(),le=!1;break;case 1:if(!le)return;Be(),ve=0}};let Be=()=>{D.set(O[0].clientX,O[0].clientY-56),G.set(S);for(let p=s.length-1;p>=0;p--)if(c[s[p]].position.dist(X(D.x,D.y))<c[s[p]].EllipseSize/2){c[s[p]].isGrabbed=!0,B=c[s[p]];break}},Oe=()=>{B&&(B.isGrabbed=!1,B.Velocity.set(K),B.Accel.set(K),B=null)},Me=()=>{Oe();try{if(G.dist(S)<15)for(let l=s.length-1;l>=0;l--)if(c[s[l]].position.dist(X())<c[s[l]].EllipseSize/2){c[s[l]].Clicked();break}}catch{}}})}ionViewDidEnter(){var f,o;null===(f=(o=this.global).p5todoPlayCanvas)||void 0===f||f.call(o);const x=localStorage.getItem("StartPage")||"0";(!this.nakama.OnInit||"0"==x)&&this.try_add_shortcut()}try_add_shortcut(){this.global.p5KeyShortCut?(this.global.p5KeyShortCut.AddAct=()=>{this.nakama.open_add_todo_page()},this.global.p5KeyShortCut.Backquote=f=>{f.shiftKey&&(this.TargetFilterName=this.TargetFilterName+6-2),this.SwitchTargetFilter()},this.global.p5KeyShortCut.Digit=f=>{this.AllCategories[this.TargetFilterName].length>f&&this.ChangeFilterValue(this.AllCategories[this.TargetFilterName][f].value)}):setTimeout(()=>{this.try_add_shortcut()},100)}ionViewWillLeave(){this.global.p5todoStopCanvas&&this.global.p5todoStopCanvas(),this.global.p5KeyShortCut&&(delete this.global.p5KeyShortCut.AddAct,delete this.global.p5KeyShortCut.Backquote,delete this.global.p5KeyShortCut.Digit)}}return(h=F).\u0275fac=function(f){return new(f||h)(t.rXU(ie.z3),t.rXU(Ve.y),t.rXU(Ce.X),t.rXU(Le.j),t.rXU(Ge.n),t.rXU(L.hG),t.rXU(He.f),t.rXU(ze.r),t.rXU(Ue.G))},h.\u0275cmp=t.VBU({type:h,selectors:[["app-main"]],viewQuery:function(f,o){if(1&f&&t.GBs(Xe,5),2&f){let x;t.mGM(x=t.lsd())&&(o.LocalToRemoteSel=x.first)}},decls:18,vars:8,consts:[["LocalToRemoteSel",""],[1,"ion-no-border"],[1,"play_button",3,"click"],["button","","style","width: 24px; height: 24px;","name","play-circle",4,"ngIf"],["button","","style","width: 24px; height: 24px;","name","pause-circle",4,"ngIf"],[1,"add_button",3,"click"],["class","shortcut_hint shortcut_top_add",4,"ngIf"],["button","","name","add-circle-outline",2,"width","24px","height","24px"],[1,"header_online_circle",3,"click"],["oncontextmenu","return false;"],[4,"ngIf"],["dismissOnSelect",""],["id","todo",1,"full_screen",2,"overflow","hidden"],["style","position: absolute; top: 16px; left: 16px;",4,"ngIf"],["button","","name","play-circle",2,"width","24px","height","24px"],["button","","name","pause-circle",2,"width","24px","height","24px"],[1,"shortcut_hint","shortcut_top_add"],[1,"disconnect_info",3,"click"],["color","medium","name","create-outline",2,"width","60px","height","60px"],["color","medium"],[4,"ngFor","ngForOf"],["button","",3,"click"],[2,"position","absolute","top","16px","left","16px"],[1,"FilterSwitchButton","backdrop_filter",3,"click","contextmenu"],["class","shortcut_hint shortcut_todo_categories",4,"ngIf"],[1,"shortcut_hint","shortcut_todo_categories"],[1,"FilterSwitchButton","backdrop_filter",3,"click","contextmenu","id"],["type","text",3,"input","blur","focus","placeholder"]],template:function(f,o){if(1&f){const x=t.RV6();t.j41(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-title"),t.EFF(3),t.k0s(),t.j41(4,"div",2),t.bIt("click",function(){return t.eBV(x),t.Njj(o.toggleCanvasPlaying())}),t.DNE(5,Ye,1,0,"ion-icon",3)(6,We,1,0,"ion-icon",4),t.k0s(),t.j41(7,"div",5),t.bIt("click",function(){return t.eBV(x),t.Njj(o.nakama.open_add_todo_page())}),t.DNE(8,Je,2,0,"div",6),t.nrm(9,"ion-icon",7),t.k0s(),t.j41(10,"div",8),t.bIt("click",function(){return t.eBV(x),t.Njj(o.toggle_session())}),t.k0s()()(),t.j41(11,"ion-content",9),t.DNE(12,Ke,6,2,"div",10),t.j41(13,"ion-popover",11,0),t.DNE(15,Ze,5,2,"ng-template"),t.k0s(),t.j41(16,"div",12),t.DNE(17,at,5,3,"div",13),t.k0s()()}2&f&&(t.R7$(3),t.JRh(o.lang.text.Main.Title),t.R7$(2),t.Y8G("ngIf",!o.isPlayingCanvas.loop),t.R7$(),t.Y8G("ngIf",o.isPlayingCanvas.loop),t.R7$(2),t.Y8G("ngIf",o.global.ShowHint),t.R7$(2),t.Aen("background-color: "+o.statusBar.colors[o.statusBar.settings.groupServer]),t.R7$(2),t.Y8G("ngIf",o.isEmptyTodo),t.R7$(5),t.Y8G("ngIf",!o.isEmptyTodo))},dependencies:[ge.Sq,ge.bT,L.W9,L.eU,L.iq,L.uz,L.Dg,L.he,L.BC,L.ai,L.CF],styles:[".play_button[_ngcontent-%COMP%]{position:absolute;right:116px;top:16px;cursor:pointer}.add_button[_ngcontent-%COMP%]{position:absolute;right:68px;top:16px;cursor:pointer}.FilterSwitchButton[_ngcontent-%COMP%]{padding:8px;border-radius:8px;font-size:16px;background-color:#8888;margin-right:8px;margin-bottom:8px;color:var(--default-text-color-direction)}"],data:{animation:[(0,Y.hZ)("emptyTodoToggle",[(0,Y.kY)(":enter",[(0,Y.iF)({opacity:0}),(0,Y.i0)(".3s ease-out",(0,Y.iF)({opacity:1}))]),(0,Y.kY)(":leave",[(0,Y.i0)(".3s ease-in",(0,Y.iF)({opacity:0}))])])]}}),F})()},{path:"add-todo-menu",loadChildren:()=>Promise.all([C.e(2076),C.e(8163)]).then(C.bind(C,8163)).then(h=>h.AddTodoMenuPageModule)}];let st=(()=>{var h;class F{}return(h=F).\u0275fac=function(f){return new(f||h)},h.\u0275mod=t.$C({type:h}),h.\u0275inj=t.G2t({imports:[ke.iI.forChild(lt),ke.iI]}),F})(),nt=(()=>{var h;class F{}return(h=F).\u0275fac=function(f){return new(f||h)},h.\u0275mod=t.$C({type:h}),h.\u0275inj=t.G2t({imports:[ge.MD,$e.YN,L.bv,st]}),F})()}}]);