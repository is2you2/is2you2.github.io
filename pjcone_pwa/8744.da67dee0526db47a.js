(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8744],{8744:($e,Be,h)=>{"use strict";h.d(Be,{K:()=>rt});var l=h(1528),ie=h(5193),q=h(9352),le=h(896),Oe=h(2272),Ce=h(7668),t=h(4496),N=h(5624),Fe=h(9240),Ie=h(4668),H=h(4500),fe=h(544),$=h(3824),X=h(5020),te=h(7136),be=h(7756),Pe=h(6819),Re=h(1368),p=h(4716);const g=["FileMenu"],w=["ShowContentInfoIonic"];function E(s,D){if(1&s){const a=t.KQA();t.I0R(0,"ion-icon",21),t.qCj("click",function(){t.usT(a);const n=t.GaO();return t.CGJ(n.AutoPlayNext=!n.AutoPlayNext)}),t.C$Y()}}function M(s,D){if(1&s){const a=t.KQA();t.I0R(0,"ion-icon",22),t.qCj("click",function(){t.usT(a);const n=t.GaO();return t.CGJ(n.AutoPlayNext=!n.AutoPlayNext)}),t.C$Y()}}function F(s,D){if(1&s){const a=t.KQA();t.I0R(0,"ion-icon",23),t.qCj("click",function(){t.usT(a);const n=t.GaO();return t.CGJ(n.ChangeToAnother(-1))}),t.C$Y()}}function C(s,D){if(1&s&&(t.I0R(0,"ion-label",24),t.OEk(1),t.C$Y()),2&s){const a=t.GaO();t.yG2(),t.cNF(a.RelevanceIndex+" / "+a.Relevances.length)}}function O(s,D){if(1&s){const a=t.KQA();t.I0R(0,"ion-icon",25),t.qCj("click",function(){t.usT(a);const n=t.GaO();return t.CGJ(n.ChangeToAnother(1))}),t.C$Y()}}function Z(s,D){if(1&s&&(t.I0R(0,"ion-label",26),t.OEk(1),t.C$Y()),2&s){const a=t.GaO();t.yG2(),t.cNF(a.FileInfo.filename||a.FileInfo.name)}}function re(s,D){if(1&s){const a=t.KQA();t.I0R(0,"ion-input",27),t.iHE("ngModelChange",function(n){t.usT(a);const o=t.GaO();return t.kNx(o.NewTextFileName,n)||(o.NewTextFileName=n),t.CGJ(n)}),t.C$Y()}if(2&s){const a=t.GaO();t.OKB("ngModel",a.NewTextFileName),t.E7m("placeholder",a.FileInfo.filename||a.FileInfo.name)}}function K(s,D){if(1&s){const a=t.KQA();t.I0R(0,"ion-button",28),t.qCj("click",function(){t.usT(a);const n=t.GaO();return t.CGJ(n.close_text_edit())}),t.wR5(1,"ion-icon",29),t.C$Y()}}function ye(s,D){if(1&s){const a=t.KQA();t.I0R(0,"ion-button",28),t.qCj("click",function(){t.usT(a);const n=t.GaO();return t.CGJ(n.SaveText())}),t.wR5(1,"ion-icon",30),t.C$Y()}}function ne(s,D){1&s&&(t.I0R(0,"ion-button",31),t.wR5(1,"ion-icon",32),t.C$Y())}function J(s,D){if(1&s){const a=t.KQA();t.I0R(0,"ion-item",36),t.qCj("click",function(){t.usT(a);const n=t.GaO(3);return t.CGJ(n.open_text_editor())}),t.I0R(1,"ion-label"),t.OEk(2),t.C$Y()()}if(2&s){const a=t.GaO(3);t.yG2(2),t.cNF(a.lang.text.ContentViewer.EditText)}}function ae(s,D){if(1&s){const a=t.KQA();t.I0R(0,"ion-item",36),t.qCj("click",function(){t.usT(a);const n=t.GaO(3);return t.CGJ(n.modify_image())}),t.I0R(1,"ion-label"),t.OEk(2),t.C$Y()()}if(2&s){const a=t.GaO(3);t.yG2(2),t.cNF(a.lang.text.ContentViewer.Edit)}}function ve(s,D){if(1&s){const a=t.KQA();t.I0R(0,"ion-item",36),t.qCj("click",function(){t.usT(a);const n=t.GaO(3);return t.CGJ(n.ShareContent())}),t.I0R(1,"ion-label"),t.OEk(2),t.C$Y()()}if(2&s){const a=t.GaO(3);t.yG2(2),t.cNF(a.lang.text.ContentViewer.ShareContent)}}function oe(s,D){if(1&s){const a=t.KQA();t.I0R(0,"ion-item",36),t.qCj("click",function(){t.usT(a);const n=t.GaO(3);return t.CGJ(n.download_file())}),t.I0R(1,"ion-label"),t.OEk(2),t.C$Y()()}if(2&s){const a=t.GaO(3);t.yG2(2),t.cNF(a.lang.text.ContentViewer.Download)}}function _e(s,D){if(1&s){const a=t.KQA();t.I0R(0,"ion-item",36),t.qCj("click",function(){t.usT(a);const n=t.GaO(3);return t.CGJ(n.RemoveFile())}),t.I0R(1,"ion-label"),t.OEk(2),t.C$Y()()}if(2&s){const a=t.GaO(3);t.yG2(2),t.cNF(a.lang.text.ContentViewer.RemoveFile)}}function u(s,D){if(1&s){const a=t.KQA();t.I0R(0,"ion-content")(1,"ion-list"),t.yuY(2,J,3,1,"ion-item",35)(3,ae,3,1,"ion-item",35)(4,ve,3,1,"ion-item",35)(5,oe,3,1,"ion-item",35),t.I0R(6,"ion-item",36),t.qCj("click",function(){t.usT(a);const n=t.GaO(2);return t.CGJ(n.open_bottom_modal())}),t.I0R(7,"ion-label"),t.OEk(8),t.C$Y()(),t.yuY(9,_e,3,1,"ion-item",35),t.C$Y()()}if(2&s){const a=t.GaO(2);t.yG2(2),t.E7m("ngIf",!a.NeedDownloadFile&&("text"==a.FileInfo.viewer||"code"==a.FileInfo.viewer)&&a.showEdit),t.yG2(),t.E7m("ngIf",!a.NeedDownloadFile&&"audio"!=a.FileInfo.viewer&&a.showEdit),t.yG2(),t.E7m("ngIf",!a.NeedDownloadFile),t.yG2(),t.E7m("ngIf",!a.NeedDownloadFile),t.yG2(3),t.cNF(a.lang.text.ContentViewer.ContentInfo),t.yG2(),t.E7m("ngIf",!a.NeedDownloadFile&&a.OpenInChannelChat&&!a.FileInfo.url)}}function R(s,D){1&s&&(t.I0R(0,"ion-popover",33,34),t.yuY(2,u,10,6,"ng-template"),t.C$Y())}function U(s,D){if(1&s&&(t.I0R(0,"div")(1,"div",38),t.wR5(2,"ion-icon",39),t.I0R(3,"div")(4,"ion-label",40),t.OEk(5),t.C$Y()()()()),2&s){const a=t.GaO(2);t.yG2(5),t.cNF(a.lang.text.ContentViewer.OnLoadContent)}}function V(s,D){if(1&s&&(t.I0R(0,"div")(1,"div",38),t.wR5(2,"ion-icon",41),t.I0R(3,"div")(4,"ion-label",40),t.OEk(5),t.C$Y()()()()),2&s){const a=t.GaO(2);t.yG2(5),t.cNF(a.lang.text.ContentViewer.OnFailedLoadContent)}}function Q(s,D){if(1&s&&(t.I0R(0,"td"),t.yuY(1,U,6,1,"div",18)(2,V,6,1,"div",18),t.wR5(3,"div",37),t.C$Y()),2&s){const a=t.GaO();t.yG2(),t.E7m("ngIf",!a.ContentOnLoad),t.yG2(),t.E7m("ngIf",a.ContentOnLoad&&a.ContentFailedLoad)}}function se(s,D){if(1&s){const a=t.KQA();t.I0R(0,"td")(1,"ion-grid")(2,"ion-row",42)(3,"ion-col",43)(4,"ion-button",44),t.qCj("click",function(){t.usT(a);const n=t.GaO();return t.CGJ(n.DownloadCurrentFile())}),t.OEk(5),t.C$Y()()()()()}if(2&s){const a=t.GaO();t.yG2(4),t.E7m("disabled",a.isDownloading||a.MessageInfo.content.transfer_index&&"download"==a.MessageInfo.content.transfer_index.OnTransfer),t.yG2(),t.oRS(" ",a.MessageInfo.content.transfer_index&&"download"==a.MessageInfo.content.transfer_index.OnTransfer?a.lang.text.ContentViewer.FileDownloading:a.lang.text.ContentViewer.DownloadThisFile," ")}}function De(s,D){if(1&s){const a=t.KQA();t.I0R(0,"ion-item",36),t.qCj("click",function(){t.usT(a);const n=t.GaO(2);return t.CGJ(n.copy_url(n.content_creator.user_id))}),t.I0R(1,"ion-label"),t.OEk(2),t.C$Y(),t.I0R(3,"ion-label",46),t.OEk(4),t.C$Y()()}if(2&s){const a=t.GaO(2);t.yG2(2),t.cNF(a.lang.text.ContentInfo.LastPost),t.yG2(2),t.oRS(" ",a.content_creator.publisher||a.content_creator.display_name||a.lang.text.Profile.noname_user,"")}}function Ae(s,D){if(1&s&&(t.I0R(0,"ion-item",49)(1,"ion-label"),t.OEk(2),t.C$Y(),t.I0R(3,"ion-label",46),t.OEk(4),t.C$Y()()),2&s){const a=t.GaO(2);t.yG2(2),t.cNF(a.lang.text.ContentInfo.SourceFrom),t.yG2(2),t.cNF(a.content_creator.various_display)}}function ue(s,D){if(1&s&&(t.I0R(0,"ion-item")(1,"ion-label"),t.OEk(2),t.C$Y(),t.I0R(3,"ion-label",46),t.OEk(4),t.C$Y()()),2&s){const a=t.GaO(2);t.yG2(2),t.cNF(a.lang.text.ContentInfo.FileSize),t.yG2(2),t.cNF(a.CurrentFileSize)}}function ge(s,D){1&s&&t.wR5(0,"ion-icon",58)}function Te(s,D){1&s&&t.wR5(0,"ion-icon",59)}function qe(s,D){1&s&&t.wR5(0,"ion-icon",60)}function et(s,D){1&s&&t.wR5(0,"ion-icon",61)}function tt(s,D){1&s&&t.wR5(0,"ion-icon",62)}function nt(s,D){1&s&&t.wR5(0,"ion-icon",63)}function it(s,D){1&s&&(t.I0R(0,"ion-avatar"),t.wR5(1,"img",64),t.C$Y())}function at(s,D){if(1&s){const a=t.KQA();t.I0R(0,"div")(1,"div",50),t.OEk(2),t.I0R(3,"ion-chip",51),t.qCj("click",function(){const o=t.usT(a).$implicit,c=t.GaO(2);return t.CGJ(c.toast_info(o))}),t.yuY(4,ge,1,0,"ion-icon",52)(5,Te,1,0,"ion-icon",53)(6,qe,1,0,"ion-icon",54)(7,et,1,0,"ion-icon",55)(8,tt,1,0,"ion-icon",56)(9,nt,1,0,"ion-icon",57)(10,it,2,0,"ion-avatar",18),t.I0R(11,"ion-label"),t.OEk(12),t.C$Y()()()()}if(2&s){const a=D.$implicit,e=t.GaO(2);t.yG2(2),t.oRS(" ",a.timeDisplay," "),t.yG2(2),t.E7m("ngIf","loaded"==a.various),t.yG2(),t.E7m("ngIf","camera"==a.various),t.yG2(),t.E7m("ngIf","link"==a.various),t.yG2(),t.E7m("ngIf","long_text"==a.various),t.yG2(),t.E7m("ngIf","textedit"==a.various),t.yG2(),t.E7m("ngIf","shared"==a.various),t.yG2(),t.E7m("ngIf","voidDraw"==a.various),t.yG2(2),t.cNF(a.publisher||a.display_name||e.lang.text.Profile.noname_user)}}function ot(s,D){if(1&s){const a=t.KQA();t.I0R(0,"ion-content")(1,"ion-item-divider")(2,"ion-label"),t.OEk(3),t.C$Y()(),t.yuY(4,De,5,2,"ion-item",35)(5,Ae,5,2,"ion-item",45)(6,ue,5,2,"ion-item",18),t.I0R(7,"ion-item")(8,"ion-label"),t.OEk(9),t.C$Y(),t.I0R(10,"ion-label",46),t.OEk(11),t.C$Y()(),t.I0R(12,"ion-item-divider")(13,"ion-label"),t.OEk(14),t.C$Y()(),t.yuY(15,at,13,9,"div",47),t.I0R(16,"ion-item",36),t.qCj("click",function(){t.usT(a),t.GaO();const n=t.Gew(26);return t.CGJ(n.dismiss())}),t.I0R(17,"ion-label",48),t.OEk(18),t.C$Y()()()}if(2&s){const a=t.GaO();t.yG2(3),t.cNF(a.lang.text.ContentInfo.WorkLogs),t.yG2(),t.E7m("ngIf",!a.FromUserFsDir),t.yG2(),t.E7m("ngIf",a.content_creator.various),t.yG2(),t.E7m("ngIf",!a.FileInfo.url),t.yG2(3),t.cNF(a.lang.text.ContentInfo.TimeAt),t.yG2(2),t.cNF(a.content_creator.timeDisplay),t.yG2(3),t.cNF(a.lang.text.ContentInfo.WorkHistory),t.yG2(),t.E7m("ngForOf",a.content_related_creator),t.yG2(3),t.cNF(a.lang.text.ContentInfo.CloseModal)}}const lt=()=>[.5,1];let rt=(()=>{var s;class D{constructor(e,n,o,c,i,r,f,S,y,m,_,T){this.modalCtrl=e,this.navParams=n,this.indexed=o,this.lang=c,this.file=i,this.p5toast=r,this.alertCtrl=f,this.loadingCtrl=S,this.global=y,this.nakama=m,this.mClipboard=_,this.noti=T,this.useP5Navigator=!0,this.RelevanceIndex=0,this.HaveRelevances=!1,this.NeedDownloadFile=!1,this.ContentOnLoad=!1,this.ContentFailedLoad=!0,this.isDownloading=!1,this.OpenInChannelChat=!1,this.isChannelOnline=!0,this.fromLocalChannel=!1,this.showEdit=!0,this.EventListenerAct=k=>{k.detail.register(120,d=>{})},this.BackButtonPressed=!1,this.ContentChanging=!1,this.AutoPlayNext=!1,this.isTextEditMode=!1,this.NewTextFileName="",this.image_info={},this.forceWrite=!1}InitBrowserBackButtonOverride(){window.history.replaceState(null,null,window.location.href),window.onpopstate=()=>{this.BackButtonPressed||(this.BackButtonPressed=!0,this.modalCtrl.dismiss())}}ngOnInit(){var e=this;return(0,l.c)(function*(){e.InitBrowserBackButtonOverride(),e.fromLocalChannel=e.navParams.get("local"),e.MessageInfo=e.navParams.get("info"),e.OpenInChannelChat=void 0!==e.MessageInfo.code,e.CurrentViewId=e.MessageInfo.message_id,e.FileInfo=e.MessageInfo.content,e.ContentBox=document.getElementById("ContentBox"),e.FileHeader=document.getElementById("FileHeader"),e.isOfficial=e.navParams.get("isOfficial"),e.target=e.navParams.get("target");try{e.isChannelOnline="online"==e.nakama.channels_orig[e.isOfficial][e.target][e.MessageInfo.channel_id].info.status,e.isChannelOnline=e.isChannelOnline||"online"==e.nakama.channels_orig[e.isOfficial][e.target][e.MessageInfo.channel_id].status||"pending"==e.nakama.channels_orig[e.isOfficial][e.target][e.MessageInfo.channel_id].status}catch{}switch(e.FromUserFsDir=e.navParams.get("no_edit")||!1,e.FileInfo.is_new){case"code":case"text":break;default:if(e.Relevances=e.navParams.get("relevance"),e.Relevances){for(let n=0,o=e.Relevances.length;n<o;n++)if(e.Relevances[n].message_id&&e.MessageInfo.message_id){if(e.Relevances[n].message_id==e.MessageInfo.message_id){e.RelevanceIndex=n+1;break}}else if(e.Relevances[n].content.path==e.MessageInfo.content.path){e.RelevanceIndex=n+1;break}e.HaveRelevances=e.Relevances.length>1}else e.HaveRelevances=!1;e.CreateContentInfo()}e.showEdit=!e.navParams.get("noEdit")})()}reinit_content_data(e){var n=this;return(0,l.c)(function*(){if(n.NewTextFileName="",n.NeedDownloadFile=!0,n.ContentOnLoad=!1,n.ContentFailedLoad=!0,n.isTextEditMode=!1,n.MessageInfo=e,n.CurrentViewId=n.MessageInfo.message_id,n.FileInfo=n.MessageInfo.content,n.p5canvas&&n.p5canvas.remove(),n.canvasDiv=document.getElementById("content_viewer_canvas"),n.canvasDiv)for(let o=0,c=n.canvasDiv.childNodes.length;o<c;o++)n.canvasDiv.removeChild(n.canvasDiv.childNodes[o]);if(URL.revokeObjectURL(n.FileURL),n.FileInfo.url)n.CreateContentInfo(),n.NeedDownloadFile=!1,n.ContentOnLoad=!0,n.ionViewDidEnter();else{let o=n.FileInfo.path||`servers/${n.isOfficial}/${n.target}/channels/${e.channel_id}/files/msg_${e.message_id}.${e.content.file_ext}`;n.image_info.path=o,n.NeedDownloadFile=yield n.indexed.checkIfFileExist(`${o}.history`);try{n.blob=yield n.indexed.loadBlobFromUserPath(o,n.FileInfo.type),n.CreateContentInfo(),n.ionViewDidEnter()}catch{n.FileURL=void 0,n.blob=void 0,n.isDownloading=!1,n.NeedDownloadFile=!0,n.ContentOnLoad=!0,n.ContentFailedLoad=!1,n.CreateContentInfo(),n.p5canvas&&n.p5canvas.remove(),n.p5canvas=new q(i=>{i.setup=()=>{i.noCanvas()}}),n.ChangeContentWithKeyInput()}}})()}DownloadInOrder(){var e=this;return(0,l.c)(function*(){("Android"==ie.s1||"iOS"==ie.s1)&&e.noti.noti.schedule({id:6,title:e.lang.text.ContentViewer.DownloadThisFile,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://diychat",color:"b0b0b0"});for(let n=0,o=e.Relevances.length;n<o;n++)e.nakama.OnTransfer[e.isOfficial]||(e.nakama.OnTransfer[e.isOfficial]={}),e.nakama.OnTransfer[e.isOfficial][e.target]||(e.nakama.OnTransfer[e.isOfficial][e.target]={}),e.nakama.OnTransfer[e.isOfficial][e.target][e.Relevances[n].channel_id]||(e.nakama.OnTransfer[e.isOfficial][e.target][e.Relevances[n].channel_id]={}),e.nakama.OnTransfer[e.isOfficial][e.target][e.Relevances[n].channel_id][e.Relevances[n].message_id]||(e.nakama.OnTransfer[e.isOfficial][e.target][e.Relevances[n].channel_id][e.Relevances[n].message_id]={});for(let n=0,o=e.Relevances.length;n<o;n++){("Android"==ie.s1||"iOS"==ie.s1)&&e.noti.noti.schedule({id:6,title:`${e.lang.text.ContentViewer.DownloadThisFile}: ${o-n}`,progressBar:{value:n,maxValue:o},sound:null,smallIcon:"res://diychat",color:"b0b0b0"});let c=`servers/${e.isOfficial}/${e.target}/channels/${e.Relevances[n].channel_id}/files/msg_${e.Relevances[n].message_id}.${e.Relevances[n].content.file_ext}`;if(!(yield e.indexed.checkIfFileExist(c)))try{yield e.DownloadCurrentFile(n)}catch(r){console.log(r)}}e.noti.ClearNoti(6)})()}ChangeToAnother(e){if(this.ContentChanging)return;this.ContentChanging=!0;let n=this.RelevanceIndex+e;n<=0||n>this.Relevances.length||(this.p5canvas&&this.p5canvas.remove(),this.RelevanceIndex=n,this.FileInfo={file_ext:""},this.reinit_content_data(this.Relevances[this.RelevanceIndex-1])),this.ContentChanging=!1}DownloadCurrentFile(e){var n=this;return(0,l.c)(function*(){n.isDownloading=!0;let o=0,c=n.Relevances[null!=e?e:n.RelevanceIndex-1],i=`servers/${n.isOfficial}/${n.target}/channels/${c.channel_id}/files/msg_${c.message_id}.${c.content.file_ext}`;try{let f=yield n.indexed.loadTextFromUserPath(`${i}.history`);o=JSON.parse(f).index}catch{}let r=c.message_id;yield n.nakama.ReadStorage_From_channel(c,i,n.isOfficial,n.target,o),n.CurrentViewId==r&&n.reinit_content_data(c)})()}formatBytes(e,n=2){if(!+e)return"0 Bytes";const c=n<0?0:n,r=Math.floor(Math.log(e)/Math.log(1024));return`${parseFloat((e/Math.pow(1024,r)).toFixed(c))} ${["Bytes","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"][r]}`}CreateContentInfo(){try{if(this.FileInfo.url||(this.CurrentFileSize=this.formatBytes(this.FileInfo.size||this.FileInfo.filesize||this.blob.size)),this.content_creator=this.FileInfo.content_creator||{timestamp:this.FileInfo.timestamp},this.content_creator.timeDisplay=new Date(this.content_creator.timestamp).toLocaleString(),this.content_related_creator=this.FileInfo.content_related_creator||[],this.content_creator.user_id)try{this.content_creator.is_me=this.nakama.servers[this.isOfficial][this.target].session.user_id==this.content_creator.user_id}catch{}try{this.content_creator.publisher=this.content_creator.is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_creator.user_id].display_name}catch{}this.set_various_display(this.content_creator);for(let e=0,n=this.content_related_creator.length;e<n;e++){if(this.content_related_creator[e].user_id)try{this.content_related_creator[e].is_me=this.nakama.servers[this.isOfficial][this.target].session.user_id==this.content_related_creator[e].user_id}catch{}this.content_related_creator[e].timeDisplay=new Date(this.content_related_creator[e].timestamp).toLocaleString()}}catch{}try{this.content_related_creator[0].publisher=this.content_related_creator[0].is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_related_creator[0].user_id].display_name,this.content_related_creator[0].timestamp==this.content_related_creator[1].timestamp&&(this.content_related_creator[0].publisher=this.content_related_creator[1].is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_related_creator[1].user_id].display_name,this.content_related_creator.splice(1,1))}catch{try{this.content_related_creator[0].publisher=this.content_related_creator[1].display_name,this.content_related_creator[0].timestamp==this.content_related_creator[1].timestamp&&(this.content_related_creator[0].publisher=this.content_related_creator[1].display_name,this.content_related_creator.splice(1,1))}catch{}try{this.content_related_creator[0].publisher||(this.content_related_creator[0].publisher=this.content_related_creator[0].display_name)}catch{}}try{this.content_related_creator.sort((e,n)=>e.timestamp>n.timestamp?-1:e.timestamp<n.timestamp?1:0)}catch{}}set_various_display(e){switch(e.various){case"camera":e.various_display=this.lang.text.GlobalAct.FromCamera;break;case"link":e.various_display=this.lang.text.ChatRoom.ExternalLinkFile;break;case"loaded":e.various_display=this.lang.text.GlobalAct.variousCreator;break;case"voidDraw":e.various_display=this.lang.text.GlobalAct.FromVoidDraw;break;case"long_text":e.various_display=this.lang.text.GlobalAct.FromAutoLongText;break;case"textedit":e.various_display=this.lang.text.GlobalAct.FromTextEditor;break;case"shared":e.various_display=this.lang.text.GlobalAct.SharedContent;break;default:e.various_display=this.lang.text.GlobalAct.UnknownSource}}close_text_edit(){this.FileInfo.is_new?this.modalCtrl.dismiss():this.reinit_content_data(this.MessageInfo)}ionViewDidEnter(){var e=this;return(0,l.c)(function*(){if(e.FileInfo.url)e.FileURL=e.FileInfo.url;else if(!e.FileInfo.is_new)try{e.blob=yield e.indexed.loadBlobFromUserPath(e.FileInfo.path||e.navParams.get("path"),e.FileInfo.type),e.FileURL=URL.createObjectURL(e.blob)}catch(n){console.log(n)}switch(e.forceWrite=!1,e.canvasDiv=document.getElementById("content_viewer_canvas"),null==e.canvasDiv.oncontextmenu&&(e.canvasDiv.oncontextmenu=()=>("blender"!=e.FileInfo.viewer&&e.FileMenu.present(),!1)),e.canvasDiv&&(e.canvasDiv.style.backgroundImage=""),document.removeEventListener("ionBackButton",e.EventListenerAct),e.p5canvas&&e.p5canvas.remove(),e.FileInfo.viewer){case"image":e.p5canvas=new q(i=>{i.setup=(0,l.c)(function*(){e.canvasDiv.style.maxWidth="100%",e.canvasDiv.style.overflow="hidden",e.ContentBox.style.overflow="hidden",i.noCanvas();let x=i.createElement("img");x.elt.hidden=!0,x.elt.src=e.FileURL,x.elt.onload=()=>{e.canvasDiv.style.backgroundImage=`url('${e.FileURL}')`,e.canvasDiv.style.backgroundRepeat="no-repeat",e.image_info.width=x.elt.naturalWidth,e.image_info.height=x.elt.naturalHeight,f=i.createVector(x.elt.naturalWidth,x.elt.naturalHeight),r(),x.remove(),e.ContentOnLoad=!0,e.ContentFailedLoad=!1},i.noLoop()});let r=()=>{if(e.image_info.width/e.image_info.height<e.canvasDiv.clientWidth/e.canvasDiv.clientHeight){let x=e.image_info.width*e.canvasDiv.clientHeight/e.image_info.height;e.canvasDiv.style.backgroundSize=`${x}px`,e.canvasDiv.style.backgroundPositionX=(e.canvasDiv.clientWidth-x)/2+"px",e.canvasDiv.style.backgroundPositionY="0px"}else e.canvasDiv.style.backgroundSize=`${e.canvasDiv.clientWidth}px`,e.canvasDiv.style.backgroundPositionX="0px",e.canvasDiv.style.backgroundPositionY=e.canvasDiv.clientHeight/2-f.y*(e.canvasDiv.clientWidth/f.x)/2+"px";W=!0};i.windowResized=()=>{setTimeout(()=>{r()},50)};let f,S=i.createVector(),y=i.createVector(),m=i.createVector(),_=1,T=()=>{e.canvasDiv.style.backgroundPositionX=`${S.x+m.x}px`,e.canvasDiv.style.backgroundPositionY=`${S.y+m.y}px`},k=(x,j)=>{let G=_,v=_*j,Y=Number(e.canvasDiv.style.backgroundPositionX.split("px")[0]),A=Number(e.canvasDiv.style.backgroundPositionY.split("px")[0]),Ge=(G-v)*i.map(x.x,Y,Y+G,0,1),Le=(G-v)/f.x*f.y*i.map(x.y,A,A+G/f.x*f.y,0,1);e.canvasDiv.style.backgroundPositionX=`${Y+Ge}px`,e.canvasDiv.style.backgroundPositionY=`${A+Le}px`,e.canvasDiv.style.backgroundSize=`${v}px`};i.mousePressed=()=>{e.useP5Navigator&&(i.mouseButton==i.CENTER&&r(),"DesktopPWA"==ie.s1&&(S=i.createVector(Number(e.canvasDiv.style.backgroundPositionX.split("px")[0]),Number(e.canvasDiv.style.backgroundPositionY.split("px")[0])),y=i.createVector(i.mouseX,i.mouseY)))},i.mouseWheel=x=>{e.useP5Navigator&&(_=Number(e.canvasDiv.style.backgroundSize.split("px")[0]),k(i.createVector(e.canvasDiv.clientWidth/2,e.canvasDiv.clientHeight/2),1-x.delta/1e3))},i.mouseDragged=()=>{e.useP5Navigator&&"DesktopPWA"==ie.s1&&(m=i.createVector(i.mouseX,i.mouseY),m.sub(y),T())};let B,d={},ce=!1,W=!0;i.touchStarted=x=>{if(e.useP5Navigator){for(let G=0,v=x.changedTouches.length;G<v;G++)d[x.changedTouches[G].identifier]=i.createVector(x.changedTouches[G].clientX,x.changedTouches[G].clientY);switch(Object.keys(d).length){case 1:S=i.createVector(Number(e.canvasDiv.style.backgroundPositionX.split("px")[0]),Number(e.canvasDiv.style.backgroundPositionY.split("px")[0])),y=d[x.changedTouches[0].identifier].copy();break;case 2:S=i.createVector(Number(e.canvasDiv.style.backgroundPositionX.split("px")[0]),Number(e.canvasDiv.style.backgroundPositionY.split("px")[0]));let G=d[0].copy();B=G.dist(d[1]),y=G.add(d[1]).div(2).copy(),_=Number(e.canvasDiv.style.backgroundSize.split("px")[0]),T();break;default:ce=!0,r()}}},i.touchMoved=x=>{if(e.useP5Navigator&&!ce){for(let G=0,v=x.changedTouches.length;G<v;G++)d[x.changedTouches[G].identifier]=i.createVector(x.changedTouches[G].clientX,x.changedTouches[G].clientY);switch(Object.keys(d).length){case 1:m=d[x.changedTouches[0].identifier].copy(),m.sub(y),W||T();break;case 2:W=!1;let G=d[0].copy(),v=G.dist(d[1]);m=G.add(d[1]).div(2).copy();let Y=m.copy();m.sub(y),T(),k(Y,v/B)}}},i.touchEnded=x=>{if(e.useP5Navigator&&"changedTouches"in x){for(let G=0,v=x.changedTouches.length;G<v;G++)delete d[x.changedTouches[G].identifier];switch(Object.keys(d).length){case 1:S=i.createVector(Number(e.canvasDiv.style.backgroundPositionX.split("px")[0]),Number(e.canvasDiv.style.backgroundPositionY.split("px")[0])),y=d[Object.keys(d)[0]].copy();break;case 0:W&&!ce&&(m.x>50?e.ChangeToAnother(-1):m.x<-50&&e.ChangeToAnother(1)),ce=!1}}}});break;case"audio":e.p5canvas=new q(i=>{var r;i.setup=()=>{i.noCanvas(),i.noLoop(),(r=i.createAudio([e.FileURL],()=>{e.canvasDiv.appendChild(r.elt),r.elt.onended=()=>{e.AutoPlayNext&&e.ChangeToAnother(1)},setTimeout(()=>{f(),r.elt.hidden=!1},50),r.showControls(),r.play(),e.ContentOnLoad=!0,e.ContentFailedLoad=!1})).elt.hidden=!0};let f=()=>{let _=e.ContentBox.offsetWidth;r.elt.setAttribute("style","position: relative; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%);"),r.size(_,25)};i.windowResized=()=>{setTimeout(()=>{f()},50)};let S=i.createVector(),y={};i.touchStarted=_=>{if(e.useP5Navigator&&!document.pictureInPictureElement&&"changedTouches"in _){for(let k=0,d=_.changedTouches.length;k<d;k++)y[_.changedTouches[k].identifier]=i.createVector(_.changedTouches[k].clientX,_.changedTouches[k].clientY);1===Object.keys(y).length&&(S=y[_.changedTouches[0].identifier].copy())}},i.touchEnded=_=>{if(e.useP5Navigator&&!document.pictureInPictureElement&&"changedTouches"in _){let T;for(let d=0,B=_.changedTouches.length;d<B;d++)T=i.createVector(_.changedTouches[d].clientX,_.changedTouches[d].clientY),delete y[_.changedTouches[d].identifier];0===Object.keys(y).length&&(T.sub(S),T.x>50?e.ChangeToAnother(-1):T.x<-50&&e.ChangeToAnother(1))}}});break;case"video":e.p5canvas=new q(i=>{var r;i.setup=(0,l.c)(function*(){i.noCanvas(),i.noLoop(),(r=i.createVideo([e.FileURL],()=>{e.global.PIPLinkedVideoElement?(r.elt.remove(),r.elt=e.global.PIPLinkedVideoElement,r.elt.setAttribute("src",e.FileURL)):e.global.PIPLinkedVideoElement=r.elt,e.canvasDiv&&e.canvasDiv.appendChild(r.elt),r.elt.onended=()=>{e.AutoPlayNext&&e.ChangeToAnother(1)},setTimeout(()=>{e.image_info.width=r.elt.videoWidth,e.image_info.height=r.elt.videoHeight,f(),r.elt.hidden=!1},50),r.showControls(),r.play(),e.ContentOnLoad=!0,e.ContentFailedLoad=!1})).elt.hidden=!0,i.VideoMedia=r});let f=()=>{let _=e.ContentBox.offsetWidth,T=e.ContentBox.offsetHeight-e.FileHeader.offsetHeight,k=r.elt.videoWidth,d=r.elt.videoHeight;0!=k&&0!=d&&(_/T>k/d?(d=T,k=k/r.elt.videoHeight*d,r.elt.setAttribute("style","position: relative; left: 50%; transform: translateX(-50%);")):(k=_,d=d/r.elt.videoWidth*k||T/2,r.elt.setAttribute("style","position: relative; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%);")),r.size(k,d))};i.windowResized=()=>{setTimeout(()=>{f()},50)};let S=i.createVector(),y={};i.touchStarted=_=>{if(e.useP5Navigator&&!document.pictureInPictureElement&&"changedTouches"in _){for(let k=0,d=_.changedTouches.length;k<d;k++)y[_.changedTouches[k].identifier]=i.createVector(_.changedTouches[k].clientX,_.changedTouches[k].clientY);1===Object.keys(y).length&&(S=y[_.changedTouches[0].identifier].copy())}},i.touchEnded=_=>{if(e.useP5Navigator&&!document.pictureInPictureElement&&"changedTouches"in _){let T;for(let d=0,B=_.changedTouches.length;d<B;d++)T=i.createVector(_.changedTouches[d].clientX,_.changedTouches[d].clientY),delete y[_.changedTouches[d].identifier];0===Object.keys(y).length&&(T.sub(S),T.x>50?e.ChangeToAnother(-1):T.x<-50&&e.ChangeToAnother(1))}}});break;case"code":case"text":e.p5canvas=new q(i=>{i.setup=()=>{i.noCanvas(),i.noLoop();let r=i.createElement("textarea");r.elt.disabled=!0,r.elt.className="infobox",r.elt.setAttribute("style","height: 100%; display: block;"),r.elt.textContent="",e.canvasDiv.appendChild(r.elt),i.TextArea=r.elt,e.FileInfo.is_new?e.open_text_editor(r.elt):i.loadStrings(e.FileURL,f=>{r.elt.textContent=f.join("\n"),e.open_text_reader(i),e.ContentOnLoad=!0,e.ContentFailedLoad=!1},f=>{e.canvasDiv.textContent=e.lang.text.ContentViewer.CannotOpenText,e.FileInfo.else=!0,e.ContentOnLoad=!0})},i.windowResized=()=>{let r=window.innerHeight-45-56;i.SyntaxHighlightReader.setAttribute("style",`height: ${r}px; display: ${e.isTextEditMode?"none":"block"}; overflow-y: scroll;`)}});break;case"godot":document.addEventListener("ionBackButton",e.EventListenerAct);let n,o=e.MessageInfo.message_id;try{let i=yield e.indexed.loadBlobFromUserPath((e.FileInfo.path||e.navParams.get("path"))+"_thumbnail.png","");n=URL.createObjectURL(i)}catch{}!e.NeedDownloadFile&&e.CurrentViewId==o&&setTimeout((0,l.c)(function*(){let i=!1;if(e.indexed.godotDB)try{let r=yield e.indexed.loadBlobFromUserPath(e.FileInfo.path||e.navParams.get("path"),"",void 0,e.indexed.ionicDB);yield e.indexed.GetGodotIndexedDB(),yield e.indexed.saveBlobToUserPath(r,"tmp_files/duplicate/viewer.pck",void 0,e.indexed.godotDB),i=!0}catch(r){console.log("\ub0b4\ubd80 \ud30c\uc77c \uc5c6\uc74c: ",r)}if(yield e.global.CreateGodotIFrame("content_viewer_canvas",{path:"tmp_files/duplicate/viewer.pck",alt_path:e.FileInfo.path||e.navParams.get("path"),url:e.FileInfo.url,background:n,receive_image:(r=(0,l.c)(function*(f,S,y){let m="tmp_files/modify_image.png";yield e.indexed.saveBase64ToUserPath(","+f,m),e.modalCtrl.dismiss({type:"image",path:m,width:S,height:y,msg:e.MessageInfo,index:e.RelevanceIndex-1})}),function(S,y,m){return r.apply(this,arguments)})},"start_load_pck"),!i){try{let r=yield e.indexed.loadBlobFromUserPath(e.FileInfo.path||e.navParams.get("path"),"",void 0,e.indexed.ionicDB);yield e.indexed.GetGodotIndexedDB(),yield e.indexed.saveBlobToUserPath(r,"tmp_files/duplicate/viewer.pck",void 0,e.indexed.godotDB)}catch{}yield e.global.CreateGodotIFrame("content_viewer_canvas",{path:"tmp_files/duplicate/viewer.pck",alt_path:e.FileInfo.path||e.navParams.get("path"),url:e.FileInfo.url,background:n,receive_image:function(){var r=(0,l.c)(function*(f,S,y){let m="tmp_files/modify_image.png";yield e.indexed.saveBase64ToUserPath(","+f,m),e.modalCtrl.dismiss({type:"image",path:m,width:S,height:y,msg:e.MessageInfo,index:e.RelevanceIndex-1})});return function(S,y,m){return r.apply(this,arguments)}}()},"start_load_pck")}var r;e.ContentOnLoad=!0,e.ContentFailedLoad=!1,n&&URL.revokeObjectURL(n),e.FileInfo.url?e.global.godot_window.download_url():e.global.godot_window.start_load_pck()}),100);break;case"blender":let c=yield e.loadingCtrl.create({message:e.lang.text.ContentViewer.OnLoadContent});c.present(),e.p5canvas=new q(i=>{let m,r=[],f=[],y={};i.setup=(0,l.c)(function*(){let T,_=i.createCanvas(e.canvasDiv.clientWidth,e.canvasDiv.clientHeight,i.WEBGL);_.parent(e.canvasDiv),i.canvas=_,i.textureMode(i.NORMAL),i.textureWrap(i.REPEAT),i.clear(255,255,255,0),i.pixelDensity(1);try{T=yield e.indexed.loadBlobFromUserPath(e.FileInfo.path,e.FileInfo.type||"")}catch{try{T=yield(yield fetch(e.FileInfo.url)).blob()}catch(B){console.log("\ubdf0\uc5b4\uc5d0\uc11c \ud30c\uc77c \ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",B)}}let k=i.createElement("iframe");k.elt.id="jsBlend",k.elt.setAttribute("src","assets/js.blend/index.html"),k.elt.setAttribute("frameborder","0"),k.elt.setAttribute("class","full_screen"),k.elt.setAttribute("allow","fullscreen; encrypted-media"),k.elt.setAttribute("scrolling","no"),k.elt.setAttribute("withCredentials","true"),k.elt.setAttribute("hidden","true"),e.canvasDiv.appendChild(k.elt),k.elt.contentWindow.TARGET_FILE=T,k.elt.onload=(0,l.c)(function*(){if(!T)return e.p5toast.show({text:e.lang.text.ContentViewer.CannotOpenText}),void c.dismiss();m=i.createDiv(),m.parent(e.canvasDiv),m.id("logDiv"),m.style("position","absolute"),m.style("width","100%"),m.style("height","100%"),m.style("max-height",`${e.canvasDiv.clientHeight}px`),m.style("pointer-events","none");let d=yield k.elt.contentWindow.JSBLEND(T);const B=100;let ce=d.file.AB;if(d.file.objects.PackedFile)for(let ke=0,Ye=d.file.objects.PackedFile.length;ke<Ye;ke++){let I=d.file.objects.PackedFile[ke],Me=I.data.__data_address__,we=ce.slice(Me,Me+I.size),de=new Blob([we]),he=URL.createObjectURL(de);i.loadImage(he,Ee=>{y[I.data.__data_address__]=Ee,URL.revokeObjectURL(he)},Ee=>{console.log("\ud14d\uc2a4\uccd0 \ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",Ee),URL.revokeObjectURL(he)})}let W=d.file.objects.vec2f,pe=0,x=d.file.objects.Mesh,j=d.file.objects.vec3f,G=0,v=d.file.objects.vec2i,Y=0;for(let ke=0,Ye=d.file.objects.Object.length;ke<Ye;ke++){let I=d.file.objects.Object[ke];c.message=`${e.lang.text.ContentViewer.ReadObject}: ${I.aname}`;let Me=i.createVector(-I.loc[0]*B,-I.loc[2]*B,I.loc[1]*B),Ne=i.createVector(I.rot[0],I.rot[2],-I.rot[1]);switch(I.type){case 1:{{let b=["noimp","colonly","convcolonly","navmesh"],L=!1;for(let P=0,z=b.length;P<z;P++)if(-1!==I.aname.indexOf(b[P],I.aname.length-b[P].length)){L=!0;break}if(L||(L=448==I.base_flag),L)continue}let de,he,Ee,Ue,we=null;for(let b=0,L=x.length;b<L;b++)if(x[b].address==I.data.address){we=b;break}try{let b=-1;for(let L=0,P=W.length;L<P;L++)if(W[L].address&&(b++,b==we)){pe=L;break}}catch{}try{let b=-1,L=!1,P=j.length;for(let z=0;z<P;z++)if(j[z].address){if(b++,L){de=j.slice(G,z);break}b==we&&(G=z,L=!0)}de||(de=j.slice(G,P))}catch{}try{let b=-1,L=!1,P=v.length;for(let z=0;z<P;z++)if(v[z].address){if(b++,L){he=v.slice(Y,z);break}b==we&&(Y=z,L=!0)}he||(he=v.slice(Y,P))}catch{}if(I.data.ldata.layers.length)for(let b=0,L=I.data.ldata.layers.length;b<L;b++)11===I.data.ldata.layers[b].type&&(Ue=I.data.ldata.layers[b].data);else Ue=I.data.ldata.layers.data;i.beginGeometry(),i.push(),i.translate(Me),i.scale(I.size[0],I.size[2],I.size[1]),I.rot[0]+I.rot[1]+I.rot[2]&&(m.elt.innerHTML+=`<div style="color: var(--ion-color-warning-shade)">${I.aname}: ${e.lang.text.ContentViewer.MayGimbalLock}</div>`,i.rotate(i.HALF_PI,Ne));try{let b=[];for(let L=0,P=de.length;L<P;L++)b.push([]);for(let L=0,P=he.length;L<P;L++){var A,Ge;let z=null!==(A=he[L].x)&&void 0!==A?A:he[L].v1,xe=null!==(Ge=he[L].y)&&void 0!==Ge?Ge:he[L].v2;b[z].push(xe),b[xe].push(z)}for(let z,xe,P=Ue.length-1;P>=0;P--){var Se,Le,je;let me=Ue[P].i,Xe=null!==(Se=de[me].x)&&void 0!==Se?Se:de[me].co[0],Je=null!==(Le=de[me].y)&&void 0!==Le?Le:de[me].co[1],Qe=null!==(je=de[me].z)&&void 0!==je?je:de[me].co[2];if(void 0!==xe){try{if(!b[xe].includes(me))throw"\ub9c8\uc9c0\ub9c9 \uc810\uc73c\ub85c\ubd80\ud130 \uadf8\ub9b4 \uc218 \uc5c6\uc74c";i.vertex(-Xe*B,-Qe*B,Je*B,W[pe+P].x,-W[pe+P].y);let Ze=!1;if(xe!=z&&(Ze=b[me].includes(z)),Ze)throw"\ub3cc\uc544\uac08 \uc218 \uc788\ub294\ub370 \ub3cc\uc544\uac00\uc9c0 \uc54a\ub294\ub2e4\uba74 \uc0c8 \uc2dc\uc791\uc810\uc73c\ub85c \uc778\uc2dd"}catch{i.endShape(i.CLOSE),xe=void 0;continue}xe=me}else i.beginShape(),i.vertex(-Xe*B,-Qe*B,Je*B,W[pe+P].x,-W[pe+P].y),z=me,xe=me}}catch(b){console.log("\uba54\uc26c \uc815\ubcf4 \ubd88\ub7ec\uc624\uae30 \uc624\ub958: ",b),m.elt.innerHTML+=`<div style="color: var(--ion-color-danger-shade)">${I.aname}: ${e.lang.text.ContentViewer.LoadMeshFailed}: ${b}</div>`}i.pop(),Ee=i.endGeometry();let We,He,Ke,ze=0;try{if(!I.data.mat.length)throw"no_mat";for(let b=0,L=I.data.mat.length;b<L;b++){try{let P=I.data.mat[b].nodetree.nodes.first.next.inputs.first.default_value.value;He=i.color(255*P[0],255*P[1],255*P[2],255*P[3])}catch(P){console.log("\ubca0\uc774\uc2a4 \uc0c9\uc0c1 \uac00\uc838\uc624\uae30 \uc2e4\ud328: ",P),m.elt.innerHTML+=`<div style="color: var(--ion-color-danger-shade)">${I.aname}: ${e.lang.text.ContentViewer.FailedGetBaseColor}: ${P}</div>`}try{let P=I.data.mat[b].nodetree.nodes.first.next.inputs.last.prev.default_value.value;ze=I.data.mat[b].nodetree.nodes.first.next.inputs.last.default_value.value,Ke=i.color(255*P[0],255*P[1],255*P[2],255*P[3])}catch(P){m.elt.innerHTML+=`<div style="color: var(--ion-color-danger-shade)">${I.aname}: ${e.lang.text.ContentViewer.FailedGetEmitColor}: ${P}</div>`}if(I.data.mat[b].nodetree.nodes.last.id){let P=I.data.mat[b].nodetree.nodes.last.id.packedfile;if(!P)throw"unpacked";We=P.data.__data_address__}}}catch(b){switch(b){case"unpacked":m.elt.innerHTML+=`<div style="color: var(--ion-color-warning-shade)">${I.aname}: ${e.lang.text.ContentViewer.LinkedTexFile}</div>`;break;case"no_mat":m.elt.innerHTML+=`<div style="color: var(--ion-color-medium-shade)">${I.aname}: ${e.lang.text.ContentViewer.NoMaterial}</div>`;break;default:console.log(I.aname,"_\uc7ac\uc9c8 \uc815\ubcf4 \ubd88\ub7ec\uc624\uae30 \uc624\ub958: ",b),m.elt.innerHTML+=`<div style="color: var(--ion-color-danger-shade)">${I.aname}: ${b}</div>`}}Ee.computeNormals(),f.push({id:I.data.address,name:I.data.aname,color:He,emissionColor:Ke,emissionStrength:ze,texture:We,mesh:Ee})}break;case 10:r.length<5?(m.elt.innerHTML+=`<div style="color: var(--ion-color-warning-shade)">${I.aname}: ${e.lang.text.ContentViewer.OnWorkReadLightMode}</div>`,r.push({type:"point",loc:Me,rot:Ne,color:i.color(255,255,255)})):m.elt.innerHTML+=`<div style="color: var(--ion-color-medium-shade)">${I.aname}: ${e.lang.text.ContentViewer.ReachLightLimit}</div>`}yield new Promise(we=>setTimeout(we,0))}c.dismiss(),setTimeout(()=>{m.elt.remove()},8e3),e.ContentOnLoad=!0,e.ContentFailedLoad=!1}),i.camera(0,0,-i.height/2/i.tan(30*i.PI/180),0,0,0,0,1,0)}),i.draw=()=>{if(i.clear(255,255,255,0),i.orbitControl(),r.length)for(let _=0,T=r.length;_<T;_++)"point"===r[_].type&&i.pointLight(r[_].color,r[_].loc);else i.directionalLight(128,128,128,-1,1,1);i.ambientLight(128);for(let _=0,T=f.length;_<T;_++)i.push(),f[_].texture?(i.noStroke(),y[f[_].texture]&&i.texture(y[f[_].texture])):f[_].color&&(i.noStroke(),i.ambientMaterial(f[_].color)),f[_].emissionStrength&&(i.noStroke(),i.emissiveMaterial(f[_].emissionColor)),i.model(f[_].mesh),i.pop()},i.windowResized=()=>{setTimeout(()=>{e.canvasDiv.style.maxHeight=window.innerHeight-56-45+"px",m&&m.style("max-height",`${e.canvasDiv.clientHeight}px`),i.resizeCanvas(e.canvasDiv.clientWidth,e.canvasDiv.clientHeight)},50)}});break;default:console.log("\uc815\uc758\ub418\uc9c0 \uc54a\uc740 \ud30c\uc77c \uc815\ubcf4: ",e.FileInfo.viewer);case"disabled":e.p5canvas=new q(i=>{i.setup=()=>{i.noCanvas()}}),e.ContentOnLoad=!0}e.ChangeContentWithKeyInput()})()}ChangeContentWithKeyInput(){this.p5canvas&&(this.p5canvas.keyPressed=e=>{if(!this.isTextEditMode)switch(e.code){case"KeyA":case"ArrowLeft":this.ChangeToAnother(-1);break;case"KeyS":this.download_file();break;case"KeyD":case"ArrowRight":this.ChangeToAnother(1);break;case"KeyS":this.NeedDownloadFile&&this.DownloadCurrentFile()}})}open_bottom_modal(){this.ShowContentInfoIonic.onDidDismiss().then(e=>{this.useP5Navigator=!0}),this.useP5Navigator=!1,this.ShowContentInfoIonic.present()}open_text_editor(e=this.p5canvas.TextArea){this.p5canvas.SyntaxHighlightReader.style.display="none",e.style.display="block",e.disabled=!1,setTimeout(()=>{this.isTextEditMode=!0,e.focus()},500)}open_text_reader(e=this.p5canvas){if(!e.SyntaxHighlightReader){let T=e.createDiv();T.elt.className="infobox",T.elt.setAttribute("style",`height: ${e.TextArea.clientHeight}px; display: block; overflow-y: auto;`),this.canvasDiv.appendChild(T.elt),e.SyntaxHighlightReader=T.elt}let o=e.TextArea.textContent.split("\n");const c=["void","static","import","export","interface","include","#include","using","from","as","public","protected","private","use","package","local","async","await","program","namespace","begin","end","puts","Private","Protected","Public","Sub","End","var","let","enum","String","char","Integer","Float","Boolean","Array","NULL","Resource","strings","integer","complex","byte","ubyte","int","uint","short","ushort","long","ulong","bvec2","bvec3","bvec4","ivec2","ivec3","ivec4","uvec2","uvec3","uvec4","mat2","mat3","mat4","Vector","Vector2","Vector3","PVector","PImage","PGraphics","float","double","number","color","bool","boolean","Arary","Object","Table","TableRow","HashMap","JSONObject","JSONArray","ArrayList","IntDict","IntList","FloatDict","FloatList","StringDict","StringList","null","undefined","data","function","func","fn","def","fun","class","extends","implements","object","override","partial"],i=["final","const"],r=["for","match","switch","if","else","elif","return","continue","pass","throw","loop","while","in","try","catch","and","or","do","then","yield"],f=["!=",">=","<=","==","<",">"],S=["#","##","\x3c!--","--\x3e","/**","*/","//"],y=["="],m=["{","}","<<",">>",":","(",")","[","]",">>>","->","<-","=>","<="],_=["SELECT","UPDATE","DELETE","INSERT INTO","CREATE DATABASE","ALTER DATABASE","CREATE TABLE","ALTER TABLE","DROP TABLE","CREATE INDEX","DROP INDEX","ECHO","FROM","WHERE","AND","OR","NOT","ALTER","ADD","echo","<?php","?>"];for(let T=0,k=o.length;T<k;T++){let d=e.createDiv(),B=o[T].split(" "),ce=!1;for(let W=0,pe=B.length;W<pe;W++){let x=this.HTMLEncode(B[W]),j=!1;for(let v=0,Y=S.length;v<Y;v++)if(B[W]==S[v]){ce=!0;break}if(!ce){for(let v=0,Y=y.length;v<Y;v++)if(B[W]==y[v]){let A=e.createSpan(x+"&nbsp");A.style("color","var(--syntax-text-coding-equalmark)"),A.style("white-space","break-spaces"),A.parent(d),j=!0;break}if(j)continue;for(let v=0,Y=i.length;v<Y;v++)if(B[W]==i[v]){let A=e.createSpan(x+"&nbsp");A.style("color","var(--syntax-text-coding-final)"),A.style("white-space","break-spaces"),A.parent(d),j=!0;break}for(let v=0,Y=f.length;v<Y;v++)if(B[W]==f[v]){let A=e.createSpan(x+"&nbsp");A.style("color","var(--syntax-text-coding-comparion-op)"),A.style("white-space","break-spaces"),A.parent(d),j=!0;break}if(j||j)continue;for(let v=0,Y=r.length;v<Y;v++)if(B[W]==r[v]){let A=e.createSpan(x+"&nbsp");A.style("color","var(--syntax-text-coding-operator)"),A.style("white-space","break-spaces"),A.parent(d),j=!0;break}if(j)continue;for(let v=0,Y=m.length;v<Y;v++)if(B[W]==m[v]){let A=e.createSpan(x+"&nbsp");A.style("color","var(--syntax-text-coding-spechar)"),A.style("white-space","break-spaces"),A.parent(d),j=!0;break}if(j)continue;for(let v=0,Y=_.length;v<Y;v++)if(B[W]==_[v]){let A=e.createSpan(x+"&nbsp");A.style("color","var(--syntax-text-coding-command)"),A.style("white-space","break-spaces"),A.parent(d),j=!0;break}if(j)continue;for(let v=0,Y=c.length;v<Y;v++)if(B[W]==c[v]){let A=e.createSpan(x+"&nbsp");A.style("color","var(--syntax-text-coding-basic)"),A.style("white-space","break-spaces"),A.parent(d),j=!0;break}if(j)continue}let G=e.createSpan(x+"&nbsp");ce&&G.style("color","var(--syntax-text-coding-comments)"),G.style("white-space","break-spaces"),G.parent(d)}d.parent(e.SyntaxHighlightReader)}e.TextArea.style.display="none",e.SyntaxHighlightReader.style.display="block"}HTMLEncode(e){let n=(e=[...e]).length,o=[];for(;n--;){var c=e[n].codePointAt(0);o[n]=c<65||c>127||c>90&&c<97?"&#"+c+";":e[n]}return o.join("")}SaveText(){var e=this;return(0,l.c)(function*(){let n=new Blob([e.p5canvas.TextArea.value],{type:e.FileInfo.type});if(n.name=e.NewTextFileName||e.FileInfo.filename||e.FileInfo.name,e.OpenInChannelChat)e.modalCtrl.dismiss({type:"text",blob:n,contentRelated:e.FileInfo.content_related_creator});else{let o=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});o.present();let c=`tmp_files/texteditor/${e.FileInfo.filename||e.FileInfo.name}`;e.FileInfo.path||(e.FileInfo.path=c),yield e.indexed.saveBlobToUserPath(n,c),o.dismiss(),e.p5toast.show({text:e.lang.text.ContentViewer.fileSaved}),e.modalCtrl.dismiss({type:"text",blob:n,path:c,index:e.RelevanceIndex-1})}})()}modify_image(){var e=this;return(0,l.c)(function*(){switch(e.FileInfo.viewer){case"image":{let o=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});o.present();try{let c;e.image_info.path=e.FileInfo.path||e.navParams.get("path"),e.FileInfo.url&&(e.image_info.path="tmp_files/modify_image.png",c=yield fetch(e.FileInfo.url).then(i=>i.blob()),yield e.indexed.saveBlobToUserPath(c,e.image_info.path)),e.modalCtrl.dismiss({type:"image",...e.image_info,path:e.image_info.path,msg:e.MessageInfo,index:e.RelevanceIndex-1})}catch(c){e.p5toast.show({text:`${e.lang.text.ContentViewer.CannotEditFile}: ${c}`})}o.dismiss()}break;case"code":case"text":let n=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});n.present();try{e.p5canvas.SyntaxHighlightReader.style.height="fit-content";let o=yield Ce.toBlob(e.p5canvas.SyntaxHighlightReader);e.image_info.width=e.p5canvas.SyntaxHighlightReader.clientWidth,e.image_info.height=e.p5canvas.SyntaxHighlightReader.clientHeight,e.image_info.path="tmp_files/modify_image.png",yield e.indexed.saveBlobToUserPath(o,e.image_info.path),e.modalCtrl.dismiss({type:"image",...e.image_info,path:e.image_info.path,msg:e.MessageInfo,index:e.RelevanceIndex-1,isDarkMode:e.global.GetExactDarkMode()})}catch(o){e.p5toast.show({text:`${e.lang.text.ContentViewer.CannotEditFile}: ${o}`})}n.dismiss();break;case"video":try{let o=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});o.present(),e.p5canvas.pixelDensity(1),e.p5canvas.VideoMedia.pause(),e.p5canvas.VideoMedia.size(e.image_info.width,e.image_info.height);let c=e.p5canvas.createCanvas(e.image_info.width,e.image_info.height);e.p5canvas.image(e.p5canvas.VideoMedia,0,0,e.p5canvas.width,e.p5canvas.height);let i=c.elt.toDataURL("image/png").replace("image/png","image/octet-stream");try{o.dismiss(),e.image_info.path="tmp_files/modify_image.png",yield e.indexed.saveBase64ToUserPath(i,e.image_info.path),e.modalCtrl.dismiss({type:"image",...e.image_info,msg:e.MessageInfo,index:e.RelevanceIndex-1})}catch(r){console.log("\ud30c\uc77c \uc800\uc7a5 \uc624\ub958: ",r)}}catch(o){console.log("\uc7ac\uc0dd\uc911\uc778 \ube44\ub514\uc624 \uc774\ubbf8\uc9c0 \ucd94\ucd9c \uc624\ub958: ",o)}break;case"blender":try{let o=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});o.present(),e.p5canvas.pixelDensity(1);let c=e.p5canvas.canvas.elt.toDataURL("image/png").replace("image/png","image/octet-stream");try{o.dismiss(),e.image_info.path="tmp_files/modify_image.png",e.image_info.width=e.p5canvas.width,e.image_info.height=e.p5canvas.height,yield e.indexed.saveBase64ToUserPath(c,e.image_info.path),e.modalCtrl.dismiss({type:"image",...e.image_info,msg:e.MessageInfo,index:e.RelevanceIndex-1,isDarkMode:e.global.GetExactDarkMode()})}catch(i){console.log("\ud30c\uc77c \uc800\uc7a5 \uc624\ub958: ",i)}}catch(o){console.log("\uc7ac\uc0dd\uc911\uc778 \ube44\ub514\uc624 \uc774\ubbf8\uc9c0 \ucd94\ucd9c \uc624\ub958: ",o)}break;case"godot":e.global.godot_window.modify_image();break;default:console.log("\ud3b8\uc9d1 \ubd88\uac00 \ud30c\uc77c \uc815\ubcf4: ",e.FileInfo)}})()}download_file(){var e=this;return(0,l.c)(function*(){if("DesktopPWA"==ie.s1||"MobilePWA"==ie.s1)if(e.FileInfo.url)try{let n=yield fetch(e.FileInfo.url),o=yield n.blob();if(!n.ok)throw"\uc81c\ub300\ub85c \ub2e4\uc6b4\ubc1b\uc544\uc9c0\uc9c0 \uc54a\uc74c";yield e.indexed.saveBlobToUserPath(o,e.FileInfo.path),e.indexed.DownloadFileFromUserPath(e.FileInfo.path,e.FileInfo.type,e.FileInfo.filename||e.FileInfo.name)}catch(n){console.log("\ub2e4\uc6b4\ubc1b\uae30 \uc2e4\ud328: ",n),e.p5toast.show({text:`${e.lang.text.Nakama.FailedDownload}: ${n}`})}else e.indexed.DownloadFileFromUserPath(e.FileInfo.path,e.FileInfo.type,e.FileInfo.filename||e.FileInfo.name);else e.alertCtrl.create({header:e.lang.text.ContentViewer.Filename,inputs:[{name:"filename",placeholder:e.FileInfo.filename||e.FileInfo.name,type:"text"}],buttons:[{text:e.lang.text.ContentViewer.saveFile,handler:(n=(0,l.c)(function*(o){if(e.FileInfo.url)try{let c=yield fetch(e.FileInfo.url),i=yield c.blob();if(!c.ok)throw"\uc81c\ub300\ub85c \ub2e4\uc6b4\ubc1b\uc544\uc9c0\uc9c0 \uc54a\uc74c";yield e.indexed.saveBlobToUserPath(i,e.FileInfo.path),e.DownloadFileAct(o)}catch(c){console.log("\ub2e4\uc6b4\ubc1b\uae30 \uc2e4\ud328: ",c),e.p5toast.show({text:`${e.lang.text.Nakama.FailedDownload}: ${c}`})}else e.DownloadFileAct(o)}),function(c){return n.apply(this,arguments)})}]}).then(n=>n.present());var n})()}DownloadFileAct(e){var n=this;return(0,l.c)(function*(){let o=yield n.loadingCtrl.create({message:n.lang.text.TodoDetail.WIP});o.present();let c=e.filename?e.filename.replace(/:|\?|\/|\\|<|>/g,""):n.FileInfo.filename||n.FileInfo.name,i=yield n.indexed.loadBlobFromUserPath(n.FileInfo.path,n.FileInfo.type);n.forceWrite&&!e.filename?n.file.writeExistingFile(n.file.externalDataDirectory,c,i).then(r=>{n.forceWrite=!1,o.dismiss(),n.p5toast.show({text:`${n.lang.text.ContentViewer.OverWriteFile}: ${c}`})}):n.file.writeFile(n.file.externalDataDirectory,c,i).then(r=>{o.dismiss(),n.p5toast.show({text:n.lang.text.ContentViewer.fileSaved})}).catch(r=>{12===(o.dismiss(),r.code)?(n.p5toast.show({text:n.lang.text.ContentViewer.AlreadyExist}),n.forceWrite=!0,n.download_file()):console.log("\uc900\ube44\ub418\uc9c0 \uc54a\uc740 \uc624\ub958 \ubc18\ud658: ",r)})})()}toast_info(e){e.various_display||this.set_various_display(e),this.p5toast.show({text:e.various_display})}ShareContent(){let e=this.nakama.rearrange_channels();for(let n=e.length-1;n>=0;n--)("missing"==e[n].status||"offline"==e[n].status)&&e.splice(n,1);e.length?this.modalCtrl.create({component:le._,componentProps:{file:this.FileInfo,channels:e}}).then(n=>{n.onDidDismiss().then(o=>{o.data&&this.modalCtrl.dismiss()}),n.present()}):this.p5toast.show({text:this.lang.text.ShareContentToOther.NoChannelToShare})}RemoveFile(){this.alertCtrl.create({header:this.lang.text.ContentViewer.RemoveFile,message:this.FileInfo.path,buttons:[{text:this.lang.text.TodoDetail.remove,handler:()=>{this.RemoveFileAct()},cssClass:"redfont"}]}).then(e=>e.present())}RemoveFileAct(){var e=this;return(0,l.c)(function*(){URL.revokeObjectURL(e.FileURL),delete e.FileInfo.thumbnail,delete e.FileInfo.text,yield e.indexed.removeFileFromUserPath(e.FileInfo.path),e.RelevanceIndex-=1,e.ChangeToAnother(1)})()}ionViewWillLeave(){var e=this;return(0,l.c)(function*(){switch(document.removeEventListener("ionBackButton",e.EventListenerAct),e.FileInfo.viewer){case"video":try{let c,i,o=e.p5canvas.VideoMedia.size();o.width>o.height?(c=192,i=o.height/o.width*192):(c=o.width/o.height*192,i=192);let r=e.p5canvas.createCanvas(c,i);e.p5canvas.pixelDensity(1),e.p5canvas.imageMode(e.p5canvas.CORNER),e.p5canvas.image(e.p5canvas.VideoMedia,0,0,c,i),e.p5canvas.fill(255,128),e.p5canvas.rect(0,0,c,i),e.p5canvas.textWrap(e.p5canvas.CHAR),e.p5canvas.textSize(16);let f=i/16;e.p5canvas.push(),e.p5canvas.translate(f/6,f/6),e.p5canvas.fill(0),e.p5canvas.text(e.FileInfo.filename||e.FileInfo.name,f,f,c-2*f,i-2*f),e.p5canvas.filter(e.p5canvas.BLUR,3,!1),e.p5canvas.pop(),e.p5canvas.fill(255),e.p5canvas.text(e.FileInfo.filename||e.FileInfo.name,f,f,c-2*f,i-2*f);let S=r.elt.toDataURL("image/png").replace("image/png","image/octet-stream");try{yield e.indexed.saveBase64ToUserPath(S,`${e.FileInfo.path}_thumbnail.png`),e.FileInfo.thumbnail=S,e.global.modulate_thumbnail(e.FileInfo,""),e.p5canvas&&e.p5canvas.remove()}catch(y){console.log("\uc378\ub124\uc77c \uc800\uc7a5 \uc624\ub958: ",y)}}catch(o){console.log("\ube44\ub514\uc624 \uc378\ub124\uc77c \uc0dd\uc131 \ucde8\uc18c: ",o)}break;case"godot":try{e.global.godot_window.filename=e.FileInfo.filename||e.FileInfo.name,e.global.godot_window.create_thumbnail(e.FileInfo),(yield e.indexed.GetFileListFromDB("tmp_files",void 0,e.indexed.godotDB)).forEach(c=>e.indexed.removeFileFromUserPath(c,void 0,e.indexed.godotDB)),e.p5canvas&&e.p5canvas.remove()}catch(o){console.log("godot \uc378\ub124\uc77c \uc800\uc7a5 \uc624\ub958: ",o)}break;case"blender":let n=e.p5canvas.canvas.elt.toDataURL("image/png").replace("image/png","image/octet-stream");try{new q(o=>{o.setup=()=>{o.loadImage(n,function(){var c=(0,l.c)(function*(i){let r,f;i.width>i.height?(r=192,f=i.height/i.width*192):(r=i.width/i.height*192,f=192);let S=o.createCanvas(r,f);o.pixelDensity(1),o.imageMode(o.CORNER),o.image(i,0,0,o.width,o.height),o.fill(255,128),o.rect(0,0,r,f),o.textWrap(o.CHAR),o.textSize(16);let y=f/16;o.push(),o.translate(y/6,y/6),o.fill(0),o.text(e.FileInfo.filename||e.FileInfo.name,y,y,r-2*y,f-2*y),o.filter(o.BLUR,3,!1),o.pop(),o.fill(255),o.text(e.FileInfo.filename||e.FileInfo.name,y,y,r-2*y,f-2*y);let m=S.elt.toDataURL("image/png").replace("image/png","image/octet-stream");yield e.indexed.saveBase64ToUserPath(m,`${e.FileInfo.path}_thumbnail.png`),e.FileInfo.thumbnail=m,e.global.modulate_thumbnail(e.FileInfo,""),o.remove(),e.p5canvas&&e.p5canvas.remove()});return function(i){return c.apply(this,arguments)}}(),c=>{console.log("\ube14\ub80c\ub354 \uc378\ub124\uc77c \ubc30\uacbd \ubc1b\uc544\uc624\uae30 \uc624\ub958: ",c),o.remove(),e.p5canvas&&e.p5canvas.remove()})}})}catch(o){console.log("blender \uc378\ub124\uc77c \uc800\uc7a5 \uc624\ub958: ",o)}break;default:e.p5canvas&&e.p5canvas.remove()}URL.revokeObjectURL(e.FileURL);try{(yield e.file.checkFile(e.file.externalDataDirectory,`viewer_tmp.${e.FileInfo.file_ext}`))&&(yield e.file.removeFile(e.file.externalDataDirectory,`viewer_tmp.${e.FileInfo.file_ext}`))}catch{}})()}ionViewDidLeave(){this.noti.ClearNoti(6)}copy_url(e){this.mClipboard.copy(e).catch(n=>Oe.c.write(e))}}return(s=D).\u0275fac=function(e){return new(e||s)(t.GI1(N.qS),t.GI1(Fe.a6),t.GI1(Ie.k),t.GI1(H.o),t.GI1(fe.S),t.GI1($.O),t.GI1(N.iW),t.GI1(N.Kg),t.GI1(X.A1),t.GI1(te.h),t.GI1(be._),t.GI1(Pe.s))},s.\u0275cmp=t.In1({type:s,selectors:[["app-ionic-viewer"]],viewQuery:function(e,n){if(1&e&&(t.CC$(g,5),t.CC$(w,5)),2&e){let o;t.wto(o=t.Gqi())&&(n.FileMenu=o.first),t.wto(o=t.Gqi())&&(n.ShowContentInfoIonic=o.first)}},decls:28,vars:17,consts:[[1,"ion-no-border"],["id","Toolbar"],["slot","start",3,"click"],["defaultHref",""],["class","relevance_change","style","padding-right: 16px;","slot","end","name","pause-circle",3,"click",4,"ngIf"],["class","relevance_change","style","padding-right: 16px;","slot","end","name","play-circle",3,"click",4,"ngIf"],["class","relevance_change","style","padding-right: 4px;","slot","end","name","arrow-back-circle-outline",3,"click",4,"ngIf"],["slot","end",4,"ngIf"],["class","relevance_change","style","padding-right: 16px; padding-left: 4px;","slot","end","name","arrow-forward-circle-outline",3,"click",4,"ngIf"],["id","ContentBox"],[1,"main_table_elt"],[2,"height","0"],["id","FileHeader",2,"max-width","100vw"],["text-wrap","","style","overflow-x: auto;",4,"ngIf"],["type","text","text-warp","","style","overflow-x: auto; overflow-y: hidden;",3,"ngModel","placeholder","ngModelChange",4,"ngIf"],[3,"click",4,"ngIf"],["id","menu_trigger",4,"ngIf"],["trigger","menu_trigger","dismissOnSelect","",4,"ngIf"],[4,"ngIf"],[3,"initialBreakpoint","breakpoints"],["ShowContentInfoIonic",""],["slot","end","name","pause-circle",1,"relevance_change",2,"padding-right","16px",3,"click"],["slot","end","name","play-circle",1,"relevance_change",2,"padding-right","16px",3,"click"],["slot","end","name","arrow-back-circle-outline",1,"relevance_change",2,"padding-right","4px",3,"click"],["slot","end"],["slot","end","name","arrow-forward-circle-outline",1,"relevance_change",2,"padding-right","16px","padding-left","4px",3,"click"],["text-wrap","",2,"overflow-x","auto"],["type","text","text-warp","",2,"overflow-x","auto","overflow-y","hidden",3,"ngModel","placeholder","ngModelChange"],[3,"click"],["name","close-circle-outline"],["name","save-outline"],["id","menu_trigger"],["name","ellipsis-vertical"],["trigger","menu_trigger","dismissOnSelect",""],["FileMenu",""],["button","",3,"click",4,"ngIf"],["button","",3,"click"],["id","content_viewer_canvas",1,"full_screen",2,"max-width","100vw"],[1,"disconnect_info"],["color","medium","name","attach-outline",2,"width","60px","height","60px"],["color","medium"],["color","medium","name","close-circle-outline",2,"width","60px","height","60px"],[1,"ion-align-items-center"],["size","12",1,"ion-text-center"],["color","warning","shape","round",1,"ion-align-items-center",3,"disabled","click"],["button","",4,"ngIf"],[1,"ion-text-end"],[4,"ngFor","ngForOf"],[1,"ion-text-center"],["button",""],[1,"history_center"],["color","secondary","mode","ios","outline","true",3,"click"],["name","document-attach-outline",4,"ngIf"],["name","camera-outline",4,"ngIf"],["name","link-outline",4,"ngIf"],["name","text-outline",4,"ngIf"],["name","document-text-outline",4,"ngIf"],["name","share-social-outline",4,"ngIf"],["name","document-attach-outline"],["name","camera-outline"],["name","link-outline"],["name","text-outline"],["name","document-text-outline"],["name","share-social-outline"],["src","assets/icon/voidDraw.png"]],template:function(e,n){1&e&&(t.I0R(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-title"),t.OEk(3),t.C$Y(),t.I0R(4,"ion-buttons",2),t.qCj("click",function(){return n.modalCtrl.dismiss()}),t.wR5(5,"ion-back-button",3),t.C$Y(),t.yuY(6,E,1,0,"ion-icon",4)(7,M,1,0,"ion-icon",5)(8,F,1,0,"ion-icon",6)(9,C,2,1,"ion-label",7)(10,O,1,0,"ion-icon",8),t.C$Y()(),t.I0R(11,"ion-content",9)(12,"table",10)(13,"tr",11)(14,"td")(15,"ion-list-header",12),t.yuY(16,Z,2,1,"ion-label",13)(17,re,1,2,"ion-input",14)(18,K,2,0,"ion-button",15)(19,ye,2,0,"ion-button",15)(20,ne,2,0,"ion-button",16)(21,R,3,0,"ion-popover",17),t.C$Y()()(),t.I0R(22,"tr"),t.yuY(23,Q,4,2,"td",18)(24,se,6,2,"td",18),t.C$Y()(),t.I0R(25,"ion-modal",19,20),t.yuY(27,ot,19,9,"ng-template"),t.C$Y()()),2&e&&(t.yG2(3),t.cNF(n.lang.text.ContentViewer.Title),t.yG2(3),t.E7m("ngIf",n.HaveRelevances&&("video"==n.FileInfo.viewer||"audio"==n.FileInfo.viewer)&&n.AutoPlayNext),t.yG2(),t.E7m("ngIf",n.HaveRelevances&&("video"==n.FileInfo.viewer||"audio"==n.FileInfo.viewer)&&!n.AutoPlayNext),t.yG2(),t.E7m("ngIf",n.HaveRelevances),t.yG2(),t.E7m("ngIf",n.HaveRelevances),t.yG2(),t.E7m("ngIf",n.HaveRelevances),t.yG2(6),t.E7m("ngIf",!n.isTextEditMode),t.yG2(),t.E7m("ngIf",n.isTextEditMode),t.yG2(),t.E7m("ngIf",n.isTextEditMode),t.yG2(),t.E7m("ngIf",n.isTextEditMode),t.yG2(),t.E7m("ngIf",!n.isTextEditMode),t.yG2(),t.E7m("ngIf",!n.isTextEditMode),t.yG2(2),t.E7m("ngIf",!n.NeedDownloadFile),t.yG2(),t.E7m("ngIf",n.NeedDownloadFile),t.yG2(),t.E7m("initialBreakpoint",.5)("breakpoints",t.q4q(16,lt)))},dependencies:[Re.ay,Re.u_,p.ue,p._G,N.O7,N.sn,N.GS,N.cz,N.Kk,N._i,N.YP,N.wB,N.Ko,N.A5,N.Yb,N.S8,N.QR,N.OC,N.zz,N.qo,N.tM,N.Md,N.yc,N.sW,N.qG,N.Im],styles:[".main_table_elt[_ngcontent-%COMP%]{width:100%;height:100%;border:0;margin:0}.relevance_change[_ngcontent-%COMP%]{width:25px;height:25px}.history_center[_ngcontent-%COMP%]{text-align:center}"]}),D})()},896:($e,Be,h)=>{"use strict";h.d(Be,{_:()=>Ie});var l=h(4496),ie=h(4500),q=h(9240),ee=h(5624),le=h(4180),Oe=h(7136),Ce=h(1368);function Ve(H,fe){if(1&H&&l.wR5(0,"img",12),2&H){const $=l.GaO().$implicit;l.m_g("online"==$.status||3==$.redirect.type&&"pending"==$.status?"filter: grayscale(0) contrast(1)":"filter: grayscale(.9) contrast(1.4)"),l.E7m("src",$.info.img||"assets/data/channel.svg",l.K6U)}}function t(H,fe){if(1&H&&l.wR5(0,"div",13),2&H){const $=l.GaO().$implicit;l.m_g("background-image: linear-gradient(to right, #0000, #"+($.color||"abcdef")+"44)")}}function N(H,fe){if(1&H&&(l.I0R(0,"td",14),l.OEk(1),l.C$Y()),2&H){const $=l.GaO().$implicit;l.yG2(),l.oRS(" ","("+$.server.target+")"," ")}}function Fe(H,fe){if(1&H){const $=l.KQA();l.I0R(0,"ion-item",4),l.qCj("click",function(){const be=l.usT($).$implicit,Pe=l.GaO();return l.CGJ(Pe.go_to_chatroom(be))}),l.I0R(1,"div",5),l.yuY(2,Ve,1,3,"img",6),l.wR5(3,"div",7),l.C$Y(),l.yuY(4,t,1,2,"div",8),l.I0R(5,"ion-label")(6,"div",9)(7,"table")(8,"tr")(9,"td"),l.OEk(10),l.C$Y(),l.yuY(11,N,2,1,"td",10),l.C$Y()()(),l.I0R(12,"div",11),l.OEk(13),l.C$Y()()()}if(2&H){const $=fe.$implicit,X=l.GaO();l.yG2(2),l.E7m("ngIf",$.info),l.yG2(),l.m_g("background-color: "+X.statusBar.colors[$.status||"offline"]),l.yG2(),l.E7m("ngIf",$.is_new),l.yG2(6),l.oRS(" ",$.info?$.info.name||$.info.display_name||X.lang.text.ChatRoom.noname_chatroom:$.title||X.lang.text.ChatRoom.noname_chatroom," "),l.yG2(),l.E7m("ngIf",X.nakama.showServer),l.yG2(2),l.oRS(" ",$.last_comment||$.noti||X.lang.text.Subscribes.noMessageHistory," ")}}let Ie=(()=>{var H;class fe{constructor(X,te,be,Pe,Re){this.lang=X,this.navParams=te,this.modalCtrl=be,this.statusBar=Pe,this.nakama=Re,this.BackButtonPressed=!1}InitBrowserBackButtonOverride(){window.history.replaceState(null,null,window.location.href),window.onpopstate=()=>{this.BackButtonPressed||(this.BackButtonPressed=!0,this.modalCtrl.dismiss())}}ngOnInit(){this.InitBrowserBackButtonOverride(),this.channels=this.navParams.get("channels")}go_to_chatroom(X){let te=this.navParams.get("file");delete te.db,this.nakama.go_to_chatroom_without_admob_act(X,te),this.modalCtrl.dismiss(!0)}}return(H=fe).\u0275fac=function(X){return new(X||H)(l.GI1(ie.o),l.GI1(q.a6),l.GI1(ee.qS),l.GI1(le.Y),l.GI1(Oe.h))},H.\u0275cmp=l.In1({type:H,selectors:[["app-share-content-to-other"]],decls:11,vars:3,consts:[[1,"ion-no-border"],["slot","start",3,"click"],["defaultHref",""],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"],[1,"channel_image","channel_image_div"],["class","channel_image","alt","ch_img",3,"src","style",4,"ngIf"],[1,"status_circle"],["class","additional_form new_bg_form",3,"style",4,"ngIf"],[1,"channel_text_form","header"],["class","channel_text_form server_target",4,"ngIf"],[1,"channel_text_form","content"],["alt","ch_img",1,"channel_image",3,"src"],[1,"additional_form","new_bg_form"],[1,"channel_text_form","server_target"]],template:function(X,te){1&X&&(l.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),l.OEk(3),l.C$Y(),l.I0R(4,"ion-buttons",1),l.qCj("click",function(){return te.modalCtrl.dismiss()}),l.wR5(5,"ion-back-button",2),l.C$Y()()(),l.I0R(6,"ion-content")(7,"ion-item-divider")(8,"ion-label"),l.OEk(9),l.C$Y()(),l.yuY(10,Fe,14,7,"ion-item",3),l.C$Y()),2&X&&(l.yG2(3),l.cNF(te.lang.text.ShareContentToOther.Title),l.yG2(6),l.cNF(te.lang.text.ShareContentToOther.AvailableChannels),l.yG2(),l.E7m("ngForOf",te.channels))},dependencies:[Ce.ay,Ce.u_,ee.GS,ee._i,ee.wB,ee.Yb,ee.S8,ee.QR,ee.tM,ee.Md,ee.Im],styles:[".server_target[_ngcontent-%COMP%]{color:#888;padding-left:4px}.header[_ngcontent-%COMP%]{padding-bottom:4px}.content[_ngcontent-%COMP%]{color:#888;height:24px;line-height:24px;vertical-align:middle;overflow:hidden}.channel_image_div[_ngcontent-%COMP%]{position:absolute}.channel_image[_ngcontent-%COMP%]{width:52px;height:52px;border-radius:64px;object-fit:cover}.status_circle[_ngcontent-%COMP%]{position:relative;top:-56px;left:38px;width:12px;height:12px;border-radius:12px}.channel_text_form[_ngcontent-%COMP%]{margin-left:64px}"]}),fe})()},7668:function($e){!function(Be){"use strict";var h=function te(){return{escape:function ye(u){return u.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")},parseExtension:g,mimeType:function w(u){var R=g(u).toLowerCase();return function p(){var u="application/font-woff",R="image/jpeg";return{woff:u,woff2:u,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:R,jpeg:R,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}()[R]||""},dataAsUrl:function K(u,R){return"data:"+R+";base64,"+u},isDataUrl:function E(u){return-1!==u.search(/^(data:)/)},canvasToBlob:function F(u){return u.toBlob?new Promise(function(R){u.toBlob(R)}):function M(u){return new Promise(function(R){for(var U=window.atob(u.toDataURL().split(",")[1]),V=U.length,Q=new Uint8Array(V),se=0;se<V;se++)Q[se]=U.charCodeAt(se);R(new Blob([Q],{type:"image/png"}))})}(u)},resolveUrl:function C(u,R){var U=document.implementation.createHTMLDocument(),V=U.createElement("base");U.head.appendChild(V);var Q=U.createElement("a");return U.body.appendChild(Q),V.href=R,Q.href=u,Q.href},getAndEncode:function re(u){return le.impl.options.cacheBust&&(u+=(/\?/.test(u)?"&":"?")+(new Date).getTime()),new Promise(function(U){var Q,V=new XMLHttpRequest;if(V.onreadystatechange=function De(){if(4===V.readyState){if(200!==V.status)return void(Q?U(Q):ue("cannot fetch resource: "+u+", status: "+V.status));var ge=new FileReader;ge.onloadend=function(){var Te=ge.result.split(/,/)[1];U(Te)},ge.readAsDataURL(V.response)}},V.ontimeout=function Ae(){Q?U(Q):ue("timeout of 30000ms occured while fetching resource: "+u)},V.responseType="blob",V.timeout=3e4,V.open("GET",u,!0),V.send(),le.impl.options.imagePlaceholder){var se=le.impl.options.imagePlaceholder.split(/,/);se&&se[1]&&(Q=se[1])}function ue(ge){console.error(ge),U("")}})},uid:function O(){var u=0;return function(){return"u"+function R(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}()+u++}}(),delay:function ne(u){return function(R){return new Promise(function(U){setTimeout(function(){U(R)},u)})}},asArray:function J(u){for(var R=[],U=u.length,V=0;V<U;V++)R.push(u[V]);return R},escapeXhtml:function ae(u){return u.replace(/#/g,"%23").replace(/\n/g,"%0A")},makeImage:function Z(u){return new Promise(function(R,U){var V=new Image;V.onload=function(){R(V)},V.onerror=U,V.src=u})},width:function ve(u){var R=_e(u,"border-left-width"),U=_e(u,"border-right-width");return u.scrollWidth+R+U},height:function oe(u){var R=_e(u,"border-top-width"),U=_e(u,"border-bottom-width");return u.scrollHeight+R+U}};function g(u){var R=/\.([^\.\/]*?)$/g.exec(u);return R?R[1]:""}function _e(u,R){var U=window.getComputedStyle(u).getPropertyValue(R);return parseFloat(U.replace("px",""))}}(),l=function be(){var p=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:function M(F,C,O){return function Z(){return!g(F)}()?Promise.resolve(F):Promise.resolve(F).then(w).then(function(re){var K=Promise.resolve(F);return re.forEach(function(ye){K=K.then(function(ne){return E(ne,ye,C,O)})}),K})},shouldProcess:g,impl:{readUrls:w,inline:E}};function g(F){return-1!==F.search(p)}function w(F){for(var O,C=[];null!==(O=p.exec(F));)C.push(O[1]);return C.filter(function(Z){return!h.isDataUrl(Z)})}function E(F,C,O,Z){return Promise.resolve(C).then(function(K){return O?h.resolveUrl(K,O):K}).then(Z||h.getAndEncode).then(function(K){return h.dataAsUrl(K,h.mimeType(C))}).then(function(K){return F.replace(function re(K){return new RegExp("(url\\(['\"]?)("+h.escape(K)+")(['\"]?\\))","g")}(C),"$1"+K+"$3")})}}(),ie=function Pe(){return{resolveAll:function p(){return g(document).then(function(w){return Promise.all(w.map(function(E){return E.resolve()}))}).then(function(w){return w.join("\n")})},impl:{readAll:g}};function g(){return Promise.resolve(h.asArray(document.styleSheets)).then(function E(F){var C=[];return F.forEach(function(O){try{h.asArray(O.cssRules||[]).forEach(C.push.bind(C))}catch(Z){console.log("Error while reading CSS rules from "+O.href,Z.toString())}}),C}).then(function w(F){return F.filter(function(C){return C.type===CSSRule.FONT_FACE_RULE}).filter(function(C){return l.shouldProcess(C.style.getPropertyValue("src"))})}).then(function(F){return F.map(M)});function M(F){return{resolve:function(){return l.inlineAll(F.cssText,(F.parentStyleSheet||{}).href)},src:function(){return F.style.getPropertyValue("src")}}}}}(),q=function Re(){return{inlineAll:function g(w){return w instanceof Element?function E(M){var F=M.style.getPropertyValue("background");return F?l.inlineAll(F).then(function(C){M.style.setProperty("background",C,M.style.getPropertyPriority("background"))}).then(function(){return M}):Promise.resolve(M)}(w).then(function(){return w instanceof HTMLImageElement?p(w).inline():Promise.all(h.asArray(w.childNodes).map(function(M){return g(M)}))}):Promise.resolve(w)},impl:{newImage:p}};function p(w){return{inline:function E(M){return h.isDataUrl(w.src)?Promise.resolve():Promise.resolve(w.src).then(M||h.getAndEncode).then(function(F){return h.dataAsUrl(F,h.mimeType(w.src))}).then(function(F){return new Promise(function(C,O){w.onload=C,w.onerror=O,w.src=F})})}}}}(),ee={imagePlaceholder:void 0,cacheBust:!1},le={toSvg:Oe,toPng:function Ve(p,g){return Ie(p,g||{}).then(function(w){return w.toDataURL()})},toJpeg:function t(p,g){return Ie(p,g=g||{}).then(function(w){return w.toDataURL("image/jpeg",g.quality||1)})},toBlob:function N(p,g){return Ie(p,g||{}).then(h.canvasToBlob)},toPixelData:function Ce(p,g){return Ie(p,g||{}).then(function(w){return w.getContext("2d").getImageData(0,0,h.width(p),h.height(p)).data})},impl:{fontFaces:ie,images:q,util:h,inliner:l,options:{}}};function Oe(p,g){return function Fe(p){le.impl.options.imagePlaceholder=typeof p.imagePlaceholder>"u"?ee.imagePlaceholder:p.imagePlaceholder,le.impl.options.cacheBust=typeof p.cacheBust>"u"?ee.cacheBust:p.cacheBust}(g=g||{}),Promise.resolve(p).then(function(E){return H(E,g.filter,!0)}).then(fe).then($).then(function w(E){return g.bgcolor&&(E.style.backgroundColor=g.bgcolor),g.width&&(E.style.width=g.width+"px"),g.height&&(E.style.height=g.height+"px"),g.style&&Object.keys(g.style).forEach(function(M){E.style[M]=g.style[M]}),E}).then(function(E){return function X(p,g,w){return Promise.resolve(p).then(function(E){return E.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),(new XMLSerializer).serializeToString(E)}).then(h.escapeXhtml).then(function(E){return'<foreignObject x="0" y="0" width="100%" height="100%">'+E+"</foreignObject>"}).then(function(E){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+g+'" height="'+w+'">'+E+"</svg>"}).then(function(E){return"data:image/svg+xml;charset=utf-8,"+E})}(E,g.width||h.width(p),g.height||h.height(p))})}function Ie(p,g){return Oe(p,g).then(h.makeImage).then(h.delay(100)).then(function(E){var M=function w(E){var M=document.createElement("canvas");if(M.width=g.width||h.width(E),M.height=g.height||h.height(E),g.bgcolor){var F=M.getContext("2d");F.fillStyle=g.bgcolor,F.fillRect(0,0,M.width,M.height)}return M}(p);return M.getContext("2d").drawImage(E,0,0),M})}function H(p,g,w){return w||!g||g(p)?Promise.resolve(p).then(function E(C){return C instanceof HTMLCanvasElement?h.makeImage(C.toDataURL()):C.cloneNode(!1)}).then(function(C){return function M(C,O,Z){var re=C.childNodes;return 0===re.length?Promise.resolve(O):function K(ye,ne,J){var ae=Promise.resolve();return ne.forEach(function(ve){ae=ae.then(function(){return H(ve,J)}).then(function(oe){oe&&ye.appendChild(oe)})}),ae}(O,h.asArray(re),Z).then(function(){return O})}(p,C,g)}).then(function(C){return function F(C,O){return O instanceof Element?Promise.resolve().then(function Z(){!function ne(J,ae){J.cssText?ae.cssText=J.cssText:function ve(oe,_e){h.asArray(oe).forEach(function(u){_e.setProperty(u,oe.getPropertyValue(u),oe.getPropertyPriority(u))})}(J,ae)}(window.getComputedStyle(C),O.style)}).then(function re(){[":before",":after"].forEach(function(J){!function ne(J){var ae=window.getComputedStyle(C,J),ve=ae.getPropertyValue("content");if(""!==ve&&"none"!==ve){var oe=h.uid();O.className=O.className+" "+oe;var _e=document.createElement("style");_e.appendChild(function u(R,U,V){var Q="."+R+":"+U,se=V.cssText?De(V):Ae(V);return document.createTextNode(Q+"{"+se+"}");function De(ue){var ge=ue.getPropertyValue("content");return ue.cssText+" content: "+ge+";"}function Ae(ue){return h.asArray(ue).map(ge).join("; ")+";";function ge(Te){return Te+": "+ue.getPropertyValue(Te)+(ue.getPropertyPriority(Te)?" !important":"")}}}(oe,J,ae)),O.appendChild(_e)}}(J)})}).then(function K(){C instanceof HTMLTextAreaElement&&(O.innerHTML=C.value),C instanceof HTMLInputElement&&O.setAttribute("value",C.value)}).then(function ye(){O instanceof SVGElement&&(O.setAttribute("xmlns","http://www.w3.org/2000/svg"),O instanceof SVGRectElement&&["width","height"].forEach(function(ne){var J=O.getAttribute(ne);J&&O.style.setProperty(ne,J)}))}).then(function(){return O}):O}(p,C)}):Promise.resolve()}function fe(p){return ie.resolveAll().then(function(g){var w=document.createElement("style");return p.appendChild(w),w.appendChild(document.createTextNode(g)),p})}function $(p){return q.inlineAll(p).then(function(){return p})}$e.exports=le}()}}]);