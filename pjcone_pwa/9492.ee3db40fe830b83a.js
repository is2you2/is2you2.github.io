"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9492],{9492:(L,I,o)=>{o.d(I,{s:()=>M});var _=o(1528),g=o(5193),f=o(2272),m=o(9352),e=o(4496),r=o(5624),v=o(3824),G=o(7136),C=o(4180),E=o(4500),k=o(5020),x=o(7756),A=o(4668),h=o(1368),c=o(4716);const O=["AddGroupPublic"];function b(l,u){if(1&l){const n=e.KQA();e.I0R(0,"ion-item",22),e.qCj("click",function(){const a=e.usT(n).index,s=e.GaO(2);return e.CGJ(s.select_server(a))}),e.I0R(1,"ion-label"),e.OEk(2),e.C$Y()()}if(2&l){const n=u.$implicit;e.yG2(2),e.cNF(n.name)}}function P(l,u){if(1&l){const n=e.KQA();e.I0R(0,"ion-accordion-group",14,15),e.qCj("click",function(){e.usT(n);const t=e.GaO();return e.CGJ(t.isExpanded=!0)}),e.I0R(2,"ion-accordion",16)(3,"ion-item",17)(4,"ion-label"),e.OEk(5),e.C$Y(),e.I0R(6,"ion-label",18),e.OEk(7),e.C$Y(),e.wR5(8,"ion-icon",19),e.C$Y(),e.I0R(9,"div",20),e.yuY(10,b,3,1,"ion-item",21),e.C$Y()()()}if(2&l){const n=e.GaO();e.E7m("disabled",n.isSaveClicked)("value",n.isExpanded),e.yG2(5),e.cNF(n.lang.text.AddGroup.SelectServer),e.yG2(2),e.cNF(n.servers[n.index].name),e.yG2(3),e.E7m("ngForOf",n.servers)}}function R(l,u){if(1&l){const n=e.KQA();e.I0R(0,"div")(1,"ion-item-divider")(2,"ion-label"),e.OEk(3),e.C$Y()(),e.I0R(4,"ion-item",5)(5,"ion-input",23),e.iHE("ngModelChange",function(t){e.usT(n);const a=e.GaO();return e.kNx(a.userInput.id,t)||(a.userInput.id=t),e.CGJ(t)}),e.C$Y()()()}if(2&l){const n=e.GaO();e.yG2(3),e.cNF(n.lang.text.AddGroup.JoinGroupWithId),e.yG2(),e.E7m("disabled",n.isSaveClicked),e.yG2(),e.E7m("label",n.lang.text.AddGroup.InputGroupId),e.OKB("ngModel",n.userInput.id)}}function y(l,u){if(1&l){const n=e.KQA();e.I0R(0,"div")(1,"ion-item-divider")(2,"ion-label"),e.OEk(3),e.C$Y()(),e.I0R(4,"textarea",24),e.iHE("ngModelChange",function(t){e.usT(n);const a=e.GaO();return e.kNx(a.userInput.description,t)||(a.userInput.description=t),e.CGJ(t)}),e.C$Y(),e.I0R(5,"ion-item",25)(6,"ion-input",26),e.iHE("ngModelChange",function(t){e.usT(n);const a=e.GaO();return e.kNx(a.userInput.max_count,t)||(a.userInput.max_count=t),e.CGJ(t)}),e.C$Y()(),e.I0R(7,"ion-item",5,27)(9,"ion-toggle",28),e.iHE("ngModelChange",function(t){e.usT(n);const a=e.GaO();return e.kNx(a.userInput.open,t)||(a.userInput.open=t),e.CGJ(t)}),e.qCj("ionChange",function(){e.usT(n);const t=e.GaO();return e.CGJ(t.isPublicToggle())}),e.OEk(10),e.C$Y()()()}if(2&l){const n=e.GaO();e.yG2(3),e.cNF(n.lang.text.AddGroup.GroupDetail),e.yG2(),e.E7m("disabled",n.isSaveClicked||""!=n.userInput.id),e.OKB("ngModel",n.userInput.description),e.E7m("placeholder",n.lang.text.AddGroup.GroupDetail_placeholder),e.yG2(),e.E7m("disabled",n.isSaveClicked||""!=n.userInput.id),e.yG2(),e.E7m("label",n.lang.text.AddGroup.MemberMaxLimit),e.OKB("ngModel",n.userInput.max_count),e.yG2(),e.E7m("disabled",n.isSaveClicked||""!=n.userInput.id),e.yG2(2),e.OKB("ngModel",n.userInput.open),e.yG2(),e.oRS(" ",n.lang.text.AddGroup.IsOpen,"")}}let M=(()=>{var l;class u{constructor(i,t,a,s,d,p,T,D){this.modalCtrl=i,this.p5toast=t,this.nakama=a,this.statusBar=s,this.lang=d,this.global=p,this.mClipboard=T,this.indexed=D,this.userInput={server:void 0,id:"",name:void 0,description:void 0,max_count:void 0,lang_tag:void 0,open:!0,creator_id:void 0,img:void 0},this.servers=[],this.index=0,this.isExpanded=!0,this.imageURL_disabled=!1,this.imageURL_placeholder=this.lang.text.Profile.pasteURI,this.isSaveClicked=!1,this.file_sel_id=""}ngOnInit(){let i=JSON.parse(localStorage.getItem("add-group"));i&&(this.userInput=i),this.servers=this.nakama.get_all_server_info(!0,!0),this.servers.push({name:this.lang.text.AddGroup.UseLocalStorage,isOfficial:"local",target:"channels",local:!0}),this.userInput.server=this.servers[this.index],this.file_sel_id=`add_group_${(new Date).getTime()}`}ionViewWillEnter(){this.ChangeContentWithKeyInput()}ChangeContentWithKeyInput(){let t=document.getElementById("group_name").childNodes[1].childNodes[1].childNodes[0];setTimeout(()=>{t.focus()},0),this.p5canvas=new m(a=>{a.keyPressed=s=>{"Enter"===s.code&&"group_desc"!=document.activeElement.id&&this.save()}})}select_server(i){this.index=i,this.userInput.server=this.servers[i],this.servers[i].local&&(this.userInput.id=""),this.isExpanded=!1}imageURLPasted(){this.imageURL_disabled=!0,"DesktopPWA"==g.s1||"MobilePWA"==g.s1?f.c.read().then(i=>{this.check_if_clipboard_available(i)}):this.mClipboard.paste().then(i=>{this.check_if_clipboard_available(i)},i=>{console.log("\ud074\ub9bd\ubcf4\ub4dc \uc790\ub8cc\ubc1b\uae30 \uc624\ub958: ",i)}),setTimeout(()=>{this.imageURL_disabled=!1},1500)}check_if_clipboard_available(i){0==i.indexOf("http")?(this.userInput.img=i,this.imageURL_placeholder=i):0==i.indexOf("data:image")?this.nakama.limit_image_size(i,t=>this.userInput.img=t.canvas.toDataURL()):this.p5toast.show({text:this.lang.text.Profile.copyURIFirst})}isPublicToggle(){this.userInput.open=this.GroupIsPublic.checked}save(){var i=this;return(0,_.c)(function*(){if(i.isSaveClicked=!0,i.servers[i.index].local)return void i.SaveLocalAct();if(i.userInput.id)return void(yield i.JoinWithSpecificId());if("online"!=i.statusBar.groupServer[i.servers[i.index].isOfficial][i.servers[i.index].target])return void i.p5toast.show({text:i.lang.text.AddGroup.cannot_use_selected_server});let t=i.nakama.servers[i.servers[i.index].isOfficial][i.servers[i.index].target].client,a=i.nakama.servers[i.servers[i.index].isOfficial][i.servers[i.index].target].session;i.userInput.owner=a.user_id,i.userInput.status="online",i.userInput.lang_tag=i.userInput.lang_tag||navigator.language.split("-")[0]||i.lang.lang,i.userInput.max_count=i.userInput.max_count||2,t.createGroup(a,{name:i.userInput.name,lang_tag:i.userInput.lang_tag,description:i.userInput.description,max_count:i.userInput.max_count,open:i.userInput.open}).then(function(){var s=(0,_.c)(function*(d){i.userInput.id=d.id,i.userInput.creator_id=i.nakama.servers[i.servers[i.index].isOfficial][i.servers[i.index].target].session.user_id,i.nakama.save_group_info(i.userInput,i.servers[i.index].isOfficial,i.servers[i.index].target);try{yield i.nakama.join_chat_with_modulation(d.id,3,i.servers[i.index].isOfficial,i.servers[i.index].target),i.p5toast.show({text:i.lang.text.AddGroup.group_created})}catch(p){console.error(p)}setTimeout(()=>{i.modalCtrl.dismiss()},500)});return function(d){return s.apply(this,arguments)}}()).catch(s=>{switch(console.error("\uadf8\ub8f9 \uc0dd\uc131 \uc2e4\ud328: ",s),s.status){case 400:setTimeout(()=>{i.p5toast.show({text:i.lang.text.AddGroup.NeedSetGroupName}),i.isSaveClicked=!1},500);break;case 409:setTimeout(()=>{i.p5toast.show({text:i.lang.text.AddGroup.AlreadyExist}),i.isSaveClicked=!1},500);break;default:setTimeout(()=>{i.p5toast.show({text:`${i.lang.text.AddGroup.UnexpectedErr}: ${s}`}),i.isSaveClicked=!1},500)}})})()}SaveLocalAct(){if(this.nakama.channels_orig.local||(this.nakama.channels_orig.local={}),this.nakama.channels_orig.local.channels||(this.nakama.channels_orig.local.channels={}),this.nakama.channels_orig.local.channels[this.userInput.name])return this.p5toast.show({text:this.lang.text.AddGroup.AlreadyExist}),void(this.isSaveClicked=!1);let i=this.CreateRandomLocalId();this.nakama.channels_orig.local.channels[i]={id:i,local:!0,title:this.userInput.name,redirect:{type:0},status:"online",HideAutoThumbnail:!1,info:{...this.userInput,status:"online"}},this.userInput.img&&this.indexed.saveTextFileToUserPath(this.userInput.img,`servers/local/channels/groups/${i}.img`),this.nakama.rearrange_channels(),setTimeout(()=>{this.modalCtrl.dismiss()},500)}CreateRandomLocalId(){let i="";for(let a=0,s=16;a<s;a++){let d=Math.floor(62*Math.random());i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(d)}return this.nakama.channels_orig.local.channels[i]?this.CreateRandomLocalId():i}JoinWithSpecificId(){var i=this;return(0,_.c)(function*(){let t=!1,a=i.nakama.servers[i.servers[i.index].isOfficial][i.servers[i.index].target];try{yield a.client.joinGroup(a.session,i.userInput.id),yield i.nakama.get_group_list_from_server(i.servers[i.index].isOfficial,i.servers[i.index].target),t=!0}catch{try{yield i.nakama.join_chat_with_modulation(i.userInput.id,2,i.servers[i.index].isOfficial,i.servers[i.index].target),t=!0}catch{i.p5toast.show({text:i.lang.text.AddGroup.check_group_id}),i.isSaveClicked=!1}}t&&(i.p5toast.show({text:i.lang.text.AddGroup.join_group_succ}),setTimeout(()=>{i.modalCtrl.dismiss()},500))})()}ionViewWillLeave(){this.p5canvas&&this.p5canvas.remove()}buttonClickLinkInputFile(){document.getElementById(this.file_sel_id).click()}inputImageSelected(i){var t=this;return(0,_.c)(function*(){let a=yield t.global.GetBase64ThroughFileReader(i.target.files[0]);t.nakama.limit_image_size(a,s=>t.userInput.img=s.canvas.toDataURL())})()}}return(l=u).\u0275fac=function(i){return new(i||l)(e.GI1(r.qS),e.GI1(v.O),e.GI1(G.h),e.GI1(C.Y),e.GI1(E.o),e.GI1(k.A1),e.GI1(x._),e.GI1(A.k))},l.\u0275cmp=e.In1({type:l,selectors:[["app-add-group"]],viewQuery:function(i,t){if(1&i&&e.CC$(O,5),2&i){let a;e.wto(a=e.Gqi())&&(t.GroupIsPublic=a.first)}},decls:30,vars:18,consts:[[1,"ion-no-border"],["slot","start",3,"click"],["defaultHref",""],["value","colors","expand","inset",3,"disabled","value","click",4,"ngIf"],[4,"ngIf"],["button","",3,"disabled"],["id","group_name",1,"ion-text-right",3,"label","ngModel","placeholder","ngModelChange"],["button","",3,"disabled","click"],[1,"additional_form","bg_img_form"],[1,"profile_img",2,"filter","grayscale(0) contrast(1)",3,"src"],[3,"disabled","click"],["color","medium"],["hidden","","type","file","accept","image/*",3,"id","change"],[1,"ion-text-center"],["value","colors","expand","inset",3,"disabled","value","click"],["accordionGroup",""],["value","colors"],["slot","header"],[1,"ion-text-right"],[1,"ion-accordion-toggle-icon","hide_accordion_icon"],["slot","content"],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"],["placeholder","00000000-0000-0000-0000-000000000000",1,"ion-text-right",3,"label","ngModel","ngModelChange"],["id","group_desc",1,"infobox",3,"disabled","ngModel","placeholder","ngModelChange"],[3,"disabled"],["type","number","min","2","placeholder","2",1,"ion-text-right",3,"label","ngModel","ngModelChange"],["AddGroupPublic",""],[2,"pointer-events","none",3,"ngModel","ngModelChange","ionChange"]],template:function(i,t){1&i&&(e.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),e.OEk(3),e.C$Y(),e.I0R(4,"ion-buttons",1),e.qCj("click",function(){return t.modalCtrl.dismiss()}),e.wR5(5,"ion-back-button",2),e.C$Y()()(),e.I0R(6,"ion-content"),e.yuY(7,P,11,5,"ion-accordion-group",3)(8,R,6,4,"div",4),e.I0R(9,"ion-item-divider")(10,"ion-label"),e.OEk(11),e.C$Y()(),e.I0R(12,"ion-item",5)(13,"ion-input",6),e.iHE("ngModelChange",function(s){return e.kNx(t.userInput.name,s)||(t.userInput.name=s),s}),e.C$Y()(),e.I0R(14,"ion-item",7),e.qCj("click",function(){return t.buttonClickLinkInputFile()}),e.I0R(15,"div",8),e.wR5(16,"img",9),e.C$Y(),e.I0R(17,"ion-label")(18,"p"),e.OEk(19),e.C$Y(),e.I0R(20,"h2"),e.OEk(21),e.C$Y()()(),e.I0R(22,"ion-item",10),e.qCj("click",function(){return t.imageURLPasted()}),e.I0R(23,"ion-label",11),e.OEk(24),e.C$Y()(),e.I0R(25,"input",12),e.qCj("change",function(s){return t.inputImageSelected(s)}),e.C$Y(),e.yuY(26,y,11,10,"div",4),e.I0R(27,"ion-item",7),e.qCj("click",function(){return t.save()}),e.I0R(28,"ion-label",13),e.OEk(29),e.C$Y()()()),2&i&&(e.yG2(3),e.cNF(t.lang.text.AddGroup.Title),e.yG2(4),e.E7m("ngIf",t.servers.length),e.yG2(),e.E7m("ngIf",!t.userInput.server.local),e.yG2(3),e.cNF(t.lang.text.AddGroup.GroupInfo),e.yG2(),e.E7m("disabled",t.isSaveClicked||""!=t.userInput.id),e.yG2(),e.E7m("label",t.lang.text.AddGroup.DisplayName),e.OKB("ngModel",t.userInput.name),e.E7m("placeholder",t.lang.text.AddGroup.DisplayName_placeholder),e.yG2(),e.E7m("disabled",t.isSaveClicked||""!=t.userInput.id),e.yG2(2),e.E7m("src",t.userInput.img,e.K6U),e.yG2(3),e.oRS("",(t.userInput.name||t.lang.text.AddGroup.DisplayName_placeholder)+" ("+(t.userInput.server.name||t.userInput.server.target)+")"," "),e.yG2(2),e.cNF(t.lang.text.AddGroup.ClicktoChangeGroupImg),e.yG2(),e.E7m("disabled",t.isSaveClicked||t.imageURL_disabled||""!=t.userInput.id),e.yG2(2),e.cNF(t.imageURL_placeholder),e.yG2(),e.E7m("id",t.file_sel_id),e.yG2(),e.E7m("ngIf",!t.userInput.server.local),e.yG2(),e.E7m("disabled",t.isSaveClicked),e.yG2(2),e.cNF(t.lang.text.AddGroup.submit))},dependencies:[h.ay,h.u_,c.ot,c.ue,c._G,r.cm,r.qU,r.GS,r._i,r.wB,r.Ko,r.A5,r.Yb,r.S8,r.QR,r.tM,r.E$,r.Md,r.UJ,r.Ch,r.qG,r.Im,r.W9]}),u})()}}]);