"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7602],{5087:(L,T,r)=>{r.d(T,{r:()=>A});var E=r(655),P=r(5016),o=r(9863),m=r(3996),i=r(1282),_=r(3496),D=r(5742),O=r(4433),F=r(3336);let A=(()=>{class x{constructor(f,d,y,t,e,n,c,s,p){this.modalCtrl=f,this.navParams=d,this.global=y,this.indexed=t,this.lang=e,this.file=n,this.alertCtrl=c,this.loadingCtrl=s,this.p5toast=p,this.EventListenerAct=h=>{h.detail.register(120,g=>{})}}ngOnInit(){this.FileInfo=this.navParams.get("info")}ionViewDidEnter(){document.addEventListener("ionBackButton",this.EventListenerAct),this.global.CreateGodotIFrame("viewer",{local_url:"assets/data/godot/viewer.pck",title:"ViewerEx",path:this.navParams.get("path"),ext:this.FileInfo.file_ext,force_logo:!0})}download_file(){"DesktopPWA"==P.n$||"MobilePWA"==P.n$?this.indexed.DownloadFileFromUserPath(this.navParams.get("path"),this.FileInfo.type,this.FileInfo.filename):this.alertCtrl.create({header:this.lang.text.ContentViewer.Filename,inputs:[{name:"filename",placeholder:this.FileInfo.filename,type:"text"}],buttons:[{text:this.lang.text.ContentViewer.saveFile,handler:f=>(0,E.mG)(this,void 0,void 0,function*(){let d=yield this.loadingCtrl.create({message:this.lang.text.TodoDetail.WIP});d.present();let y=f.filename?`${f.filename.replace(/:|\?|\/|\\|<|>/g,"")}.${this.FileInfo.file_ext}`:this.FileInfo.filename,t=yield this.indexed.loadBlobFromUserPath(this.navParams.get("path"),this.FileInfo.type);this.file.writeFile(this.file.externalDataDirectory,y,t).then(e=>{d.dismiss(),this.p5toast.show({text:this.lang.text.ContentViewer.fileSaved})}).catch(e=>{12===(d.dismiss(),e.code)?(this.p5toast.show({text:this.lang.text.ContentViewer.AlreadyExist}),this.download_file()):console.log("\uc900\ube44\ub418\uc9c0 \uc54a\uc740 \uc624\ub958 \ubc18\ud658: ",e)})})}]}).then(f=>f.present())}ionViewWillLeave(){document.removeEventListener("ionBackButton",this.EventListenerAct)}}return x.\u0275fac=function(f){return new(f||x)(o.Y36(m.IN),o.Y36(m.X1),o.Y36(i.A),o.Y36(_.H),o.Y36(D.b),o.Y36(O.$),o.Y36(m.Br),o.Y36(m.HT),o.Y36(F.F))},x.\u0275cmp=o.Xpm({type:x,selectors:[["app-godot-viewer"]],decls:18,vars:3,consts:[["slot","start",3,"click"],["defaultHref",""],[1,"main_table",2,"width","100%","height","100%","margin","0"],[2,"height","0"],[3,"click"],["id","viewer",1,"full_screen",2,"display","flex"]],template:function(f,d){1&f&&(o.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),o._uU(3),o.qZA(),o.TgZ(4,"ion-buttons",0),o.NdJ("click",function(){return d.modalCtrl.dismiss()}),o._UZ(5,"ion-back-button",1),o.qZA()()(),o.TgZ(6,"ion-content")(7,"table",2)(8,"tr",3)(9,"td")(10,"ion-list-header")(11,"ion-label"),o._uU(12),o.qZA(),o.TgZ(13,"ion-button",4),o.NdJ("click",function(){return d.download_file()}),o._uU(14),o.qZA()()()(),o.TgZ(15,"tr")(16,"td"),o._UZ(17,"div",5),o.qZA()()()()),2&f&&(o.xp6(3),o.Oqu(d.lang.text.ContentViewer.Title),o.xp6(9),o.Oqu(d.FileInfo.filename),o.xp6(2),o.hij("",d.lang.text.ContentViewer.Download," "))},directives:[m.Gu,m.sr,m.wd,m.Sm,m.oU,m.cs,m.W2,m.yh,m.Q$,m.YG],styles:[""]}),x})()},774:(L,T,r)=>{r.d(T,{B:()=>f});var E=r(655),P=r(5016),o=r(6505),i=r(9863),_=r(3996),D=r(3496),O=r(5742),F=r(4433),A=r(3336),x=r(9808);function w(d,y){if(1&d){const t=i.EpF();i.TgZ(0,"ion-button",8),i.NdJ("click",function(){return i.CHM(t),i.oxw().modify_image()}),i._uU(1),i.qZA()}if(2&d){const t=i.oxw();i.xp6(1),i.hij(" ",t.lang.text.ContentViewer.Edit," ")}}let f=(()=>{class d{constructor(t,e,n,c,s,p,h,g){this.modalCtrl=t,this.navParams=e,this.indexed=n,this.lang=c,this.file=s,this.p5toast=p,this.alertCtrl=h,this.loadingCtrl=g,this.image_info={}}ngOnInit(){this.FileInfo=this.navParams.get("info"),this.ContentBox=document.getElementById("ContentBox"),this.FileHeader=document.getElementById("FileHeader"),this.HasNoEditButton=this.navParams.get("no_edit")||!1,this.indexed.loadBlobFromUserPath(this.navParams.get("path"),this.FileInfo.type,t=>{this.FileURL=URL.createObjectURL(t)})}ionViewDidEnter(){let t=document.getElementById("p5canvas");switch(this.FileInfo.viewer){case"image":this.p5canvas=new o(e=>{let n;e.setup=()=>(0,E.mG)(this,void 0,void 0,function*(){t.style.maxWidth="100%",t.style.overflow="hidden",this.ContentBox.style.overflow="hidden";let l=e.createCanvas(t.clientWidth,t.clientHeight);l.style("margin","0"),l.style("position","relative"),l.style("pointer-events","none"),t.style.backgroundImage=`url(${this.FileURL})`,t.style.backgroundRepeat="no-repeat",t.style.pointerEvents="none";let b=yield this.loadingCtrl.create({message:this.lang.text.TodoDetail.WIP});b.present(),e.loadImage(this.FileURL,a=>{this.image_info.width=a.width,this.image_info.height=a.height,s=e.createVector(a.width,a.height),c(),b.dismiss()},a=>{console.error("viewer-loadImageFailed: ",a),b.dismiss()}),("Android"==P.n$||"iOS"==P.n$)&&(n=document.createElement("iframe"),n.setAttribute("src",this.FileURL),n.setAttribute("frameborder","0"),n.setAttribute("class","full_screen"),n.setAttribute("style","position: relative; pointer-events: all"),n.hidden=!0,t.appendChild(n)),e.noLoop()});let c=()=>{t.style.backgroundSize=`${t.clientWidth}px`,t.style.backgroundPositionX="0px",t.style.backgroundPositionY=t.clientHeight/2-s.y*(t.clientWidth/s.x)/2+"px"};e.windowResized=()=>{setTimeout(()=>{c()},50)};let s,p=e.createVector(),h=e.createVector(),g=e.createVector(),C=1,I=()=>{t.style.backgroundPositionX=`${p.x+g.x}px`,t.style.backgroundPositionY=`${p.y+g.y}px`},M=(l,b)=>{let a=C,v=C*b,U=Number(t.style.backgroundPositionX.split("px")[0]),V=Number(t.style.backgroundPositionY.split("px")[0]),B=(a-v)*e.map(l.x,U,U+a,0,1),R=(a-v)/s.x*s.y*e.map(l.y,V,V+a/s.x*s.y,0,1);t.style.backgroundPositionX=`${U+B}px`,t.style.backgroundPositionY=`${V+R}px`,t.style.backgroundSize=`${v}px`};e.mousePressed=()=>{e.mouseButton==e.CENTER&&c(),"DesktopPWA"==P.n$&&(p=e.createVector(Number(t.style.backgroundPositionX.split("px")[0]),Number(t.style.backgroundPositionY.split("px")[0])),h=e.createVector(e.mouseX,e.mouseY))},e.mouseWheel=l=>{C=Number(t.style.backgroundSize.split("px")[0]),M(e.createVector(t.clientWidth/2,t.clientHeight/2),1-l.delta/1e3)},e.mouseDragged=()=>{"DesktopPWA"==P.n$&&(g=e.createVector(e.mouseX,e.mouseY),g.sub(h),I())};let W,u={},k=!1;e.touchStarted=l=>{for(let a=0,v=l.changedTouches.length;a<v;a++)u[l.changedTouches[a].identifier]=e.createVector(l.changedTouches[a].clientX,l.changedTouches[a].clientY);switch(Object.keys(u).length){case 1:p=e.createVector(Number(t.style.backgroundPositionX.split("px")[0]),Number(t.style.backgroundPositionY.split("px")[0])),h=u[l.changedTouches[0].identifier].copy();break;case 2:p=e.createVector(Number(t.style.backgroundPositionX.split("px")[0]),Number(t.style.backgroundPositionY.split("px")[0]));let a=u[0].copy();W=a.dist(u[1]),h=a.add(u[1]).div(2).copy(),C=Number(t.style.backgroundSize.split("px")[0]),I();break;default:k=!0,c()}},e.touchMoved=l=>{if(!k){for(let a=0,v=l.changedTouches.length;a<v;a++)u[l.changedTouches[a].identifier]=e.createVector(l.changedTouches[a].clientX,l.changedTouches[a].clientY);switch(Object.keys(u).length){case 1:g=u[l.changedTouches[0].identifier].copy(),g.sub(h),I();break;case 2:let a=u[0].copy(),v=a.dist(u[1]);g=a.add(u[1]).div(2).copy(),g.sub(h),I(),M(e.createVector(t.clientWidth/2,t.clientHeight/2),v/W)}}},e.touchEnded=l=>{if("changedTouches"in l){for(let a=0,v=l.changedTouches.length;a<v;a++)delete u[l.changedTouches[a].identifier];switch(Object.keys(u).length){case 1:p=e.createVector(Number(t.style.backgroundPositionX.split("px")[0]),Number(t.style.backgroundPositionY.split("px")[0])),h=u[Object.keys(u)[0]].copy();break;case 0:k=!1}}}});break;case"audio":this.p5canvas=new o(e=>{var n;e.setup=()=>{let s=e.createCanvas(t.clientWidth,t.clientHeight);s.style("margin","0"),s.style("position","relative"),s.style("pointer-events","none"),e.noLoop(),n=e.createAudio([this.FileURL],()=>{t.appendChild(n.elt),s.parent(t),n.elt.hidden=!0,setTimeout(()=>{c(),n.elt.hidden=!1},50),n.showControls(),n.play()})};let c=()=>{if("audio"!=this.FileInfo.viewer)return;let s=this.ContentBox.offsetWidth;n.elt.setAttribute("style","position: relative; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%);"),n.size(s,25)};e.windowResized=()=>{setTimeout(()=>{c()},50)}});break;case"video":this.p5canvas=new o(e=>{var n;e.setup=()=>{let s=e.createCanvas(t.clientWidth,t.clientHeight);s.style("margin","0"),s.style("position","relative"),s.style("pointer-events","none"),e.noLoop(),n=e.createVideo([this.FileURL],()=>{t.appendChild(n.elt),s.parent(t),n.elt.hidden=!0,setTimeout(()=>{c(),n.elt.hidden=!1},50),n.showControls(),n.play()})};let c=()=>{if("video"!=this.FileInfo.viewer)return;let s=this.ContentBox.offsetWidth,p=this.ContentBox.offsetHeight-this.FileHeader.offsetHeight,h=n.width,g=n.height;n.elt.setAttribute("style","position: relative; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%);"),h>g?(h=s,g=g/n.width*h):(g=p,h=h/n.height*g),n.size(h,g)};e.windowResized=()=>{setTimeout(()=>{c()},50)}});break;default:this.p5canvas=new o(e=>{e.setup=()=>{let n=e.createCanvas(t.clientWidth,t.clientHeight);n.style("margin","0"),n.style("position","relative"),n.style("pointer-events","none"),e.noLoop(),e.loadStrings(this.FileURL,c=>{let s=document.createElement("textarea");s.disabled=!0,s.className="infobox",s.setAttribute("style","height: 100%; display: block;"),s.textContent=c.join("\n"),t.appendChild(s)},c=>{console.error("\uc5f4\ub78c\ud560 \uc218 \uc5c6\ub294 \ud30c\uc77c: ",c),t.textContent="\uc5f4\ub78c\ud560 \uc218 \uc5c6\ub294 \ud30c\uc77c\uc785\ub2c8\ub2e4.",this.FileInfo.else=!0})}})}}modify_image(){this.modalCtrl.dismiss(this.image_info)}download_file(){"DesktopPWA"==P.n$||"MobilePWA"==P.n$?this.indexed.DownloadFileFromUserPath(this.navParams.get("path"),this.FileInfo.type,this.FileInfo.filename):this.alertCtrl.create({header:this.lang.text.ContentViewer.Filename,inputs:[{name:"filename",placeholder:this.FileInfo.filename,type:"text"}],buttons:[{text:this.lang.text.ContentViewer.saveFile,handler:t=>(0,E.mG)(this,void 0,void 0,function*(){let e=yield this.loadingCtrl.create({message:this.lang.text.TodoDetail.WIP});e.present();let n=t.filename?`${t.filename.replace(/:|\?|\/|\\|<|>/g,"")}.${this.FileInfo.file_ext}`:this.FileInfo.filename,c=yield this.indexed.loadBlobFromUserPath(this.navParams.get("path"),this.FileInfo.type);this.file.writeFile(this.file.externalDataDirectory,n,c).then(s=>{e.dismiss(),this.p5toast.show({text:this.lang.text.ContentViewer.fileSaved})}).catch(s=>{12===(e.dismiss(),s.code)?(this.p5toast.show({text:this.lang.text.ContentViewer.AlreadyExist}),this.download_file()):console.log("\uc900\ube44\ub418\uc9c0 \uc54a\uc740 \uc624\ub958 \ubc18\ud658: ",s)})})}]}).then(t=>t.present())}ionViewWillLeave(){this.p5canvas&&this.p5canvas.remove(),this.FileURL&&URL.revokeObjectURL(this.FileURL)}}return d.\u0275fac=function(t){return new(t||d)(i.Y36(_.IN),i.Y36(_.X1),i.Y36(D.H),i.Y36(O.b),i.Y36(F.$),i.Y36(A.F),i.Y36(_.Br),i.Y36(_.HT))},d.\u0275cmp=i.Xpm({type:d,selectors:[["app-ionic-viewer"]],decls:19,vars:4,consts:[["id","Toolbar"],["slot","start",3,"click"],["defaultHref",""],["id","ContentBox"],[1,"main_table_elt"],[2,"height","0"],["id","FileHeader"],[3,"click",4,"ngIf"],[3,"click"],["id","p5canvas",1,"full_screen",2,"overflow-y","scroll"]],template:function(t,e){1&t&&(i.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),i._uU(3),i.qZA(),i.TgZ(4,"ion-buttons",1),i.NdJ("click",function(){return e.modalCtrl.dismiss()}),i._UZ(5,"ion-back-button",2),i.qZA()()(),i.TgZ(6,"ion-content",3)(7,"table",4)(8,"tr",5)(9,"td")(10,"ion-list-header",6)(11,"ion-label"),i._uU(12),i.qZA(),i.YNc(13,w,2,1,"ion-button",7),i.TgZ(14,"ion-button",8),i.NdJ("click",function(){return e.download_file()}),i._uU(15),i.qZA()()()(),i.TgZ(16,"tr")(17,"td"),i._UZ(18,"div",9),i.qZA()()()()),2&t&&(i.xp6(3),i.Oqu(e.lang.text.ContentViewer.Title),i.xp6(9),i.Oqu(e.FileInfo.filename),i.xp6(1),i.Q6J("ngIf","image"==e.FileInfo.viewer&&!e.HasNoEditButton),i.xp6(2),i.hij(" ",e.lang.text.ContentViewer.Download," "))},directives:[_.Gu,_.sr,_.wd,_.Sm,_.oU,_.cs,_.W2,_.yh,_.Q$,x.O5,_.YG],styles:[".main_table_elt[_ngcontent-%COMP%]{width:100%;height:100%;border:0;margin:0}"]}),d})()}}]);