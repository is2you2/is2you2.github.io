"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1860],{1186:(z,E,_)=>{_.d(E,{M:()=>n});const n=(0,_(2726).fo)("SpeechRecognition",{web:()=>_.e(4850).then(_.bind(_,7554)).then(R=>new R.SpeechRecognitionWeb)})},5961:(z,E,_)=>{_.d(E,{GW:()=>n,dk:()=>R,oK:()=>L});var L=function(m){return m.Prompt="PROMPT",m.Camera="CAMERA",m.Photos="PHOTOS",m}(L||{}),n=function(m){return m.Rear="REAR",m.Front="FRONT",m}(n||{}),R=function(m){return m.Uri="uri",m.Base64="base64",m.DataUrl="dataUrl",m}(R||{})},8162:(z,E,_)=>{_.d(E,{V1:()=>R,dk:()=>n.dk,oK:()=>n.oK});var L=_(2726),n=_(5961);const R=(0,L.fo)("Camera",{web:()=>_.e(6468).then(_.bind(_,6468)).then(m=>new m.CameraWeb)})},4688:(z,E,_)=>{_.d(E,{b:()=>K});var L=_(6845),n=_(9468),R=_(3857),m=_(6052),p=_(9080),U=_(1325),j=_(797),B=_(6814);function N(O,J){if(1&O&&(n.TgZ(0,"ion-select-option",7),n._uU(1),n.qZA()),2&O){const Z=J.$implicit;n.Q6J("value",Z),n.xp6(1),n.hij("",Z.name," ")}}function X(O,J){if(1&O&&(n.TgZ(0,"ion-select-option",7),n._uU(1),n.qZA()),2&O){const Z=J.$implicit;n.Q6J("value",Z),n.xp6(1),n.Oqu(Z.name+" ("+Z.server.name+")")}}function G(O,J){if(1&O&&(n.TgZ(0,"ion-select-option",7),n._uU(1),n.qZA()),2&O){const Z=J.$implicit;n.Q6J("value",Z),n.xp6(1),n.hij(" ",Z.urls[0],"")}}function W(O,J){if(1&O){const Z=n.EpF();n.TgZ(0,"ion-item",8),n.NdJ("click",function(){n.CHM(Z);const T=n.oxw();return n.KtG(T.scanQRCode())}),n.TgZ(1,"ion-label",9),n._uU(2),n.qZA()()}if(2&O){const Z=n.oxw();n.Q6J("disabled",!Z.ActKeyLength),n.xp6(2),n.Oqu(Z.lang.text.QuickQRShare.SendData)}}function ee(O,J){if(1&O&&n._UZ(0,"img",10),2&O){const Z=n.oxw();n.Q6J("src",Z.QRCodeSRC,n.LSH)}}let K=(()=>{var O;class J{constructor(w,T,M,Q,te,e){this.lang=w,this.global=T,this.nakama=M,this.modalCtrl=Q,this.navParams=te,this.indexed=e,this.ActKeyLength=!1,this.userInput={servers:[],groups:[],rtcserver:[]},this.servers=[],this.groups=[],this.rtcServer=[],this.NoReturn=!1}ngOnInit(){this.NoReturn=this.navParams.get("NoReturn"),this.servers=this.nakama.get_all_server_info(),this.groups=this.nakama.rearrange_group_list(),this.indexed.loadTextFromUserPath("servers/webrtc_server.json",(w,T)=>{w&&T&&(this.rtcServer=JSON.parse(T))});for(let w=this.groups.length-1;w>=0;w--)"missing"==this.groups[w].status&&this.groups.splice(w,1)}SelectGroupServer(w){this.userInput.servers=w.detail.value||[],this.information_changed()}SelectGroupChannel(w){this.userInput.groups=w.detail.value||[],this.information_changed()}SelectRTCServer(w){this.userInput.rtcserver=w.detail.value||[],this.information_changed()}information_changed(){this.result_address=`${L.Oy}pjcone_pwa/`;let w="",T=0;for(let M=0,Q=this.userInput.servers.length;M<Q;M++)w+=T?"&":"?",w+="server=",w+=`${this.userInput.servers[M].name||""},${this.userInput.servers[M].address||""},${this.userInput.servers[M].useSSL||""},${this.userInput.servers[M].port||7350},${this.userInput.servers[M].key||""}`,T++;for(let M=0,Q=this.userInput.groups.length;M<Q;M++)w+=T?"&":"?",w+="group=",w+=`${this.userInput.groups[M].name},${this.userInput.groups[M].id}`,T++;if(this.userInput.rtcserver.length)for(let M=0,Q=this.userInput.rtcserver.length;M<Q;M++)w+=T?"&":"?",w+="rtcserver=",w+=`[${this.userInput.rtcserver[M].urls}],${this.userInput.rtcserver[M].username},${this.userInput.rtcserver[M].credential}`,T++;w?(this.result_address+=w,this.QRCodeSRC=this.global.readasQRCodeFromString(this.result_address),this.ActKeyLength=!0):(this.QRCodeSRC="",this.ActKeyLength=!1)}scanQRCode(){this.modalCtrl.dismiss(this.result_address)}}return(O=J).\u0275fac=function(w){return new(w||O)(n.Y36(R.b),n.Y36(m.AN),n.Y36(p.a),n.Y36(U.IN),n.Y36(U.X1),n.Y36(j.H))},O.\u0275cmp=n.Xpm({type:O,selectors:[["app-qr-share"]],decls:24,vars:14,consts:[[1,"ion-no-border"],["slot","start",3,"click"],["defaultHref",""],["multiple","true",3,"label","placeholder","ionChange"],[3,"value",4,"ngFor","ngForOf"],["button","",3,"disabled","click",4,"ngIf"],["style","width: 100%; height: auto;","alt","QRCodeSRC",3,"src",4,"ngIf"],[3,"value"],["button","",3,"disabled","click"],[1,"ion-text-center"],["alt","QRCodeSRC",2,"width","100%","height","auto",3,"src"]],template:function(w,T){1&w&&(n.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),n._uU(3),n.qZA(),n.TgZ(4,"ion-buttons",1),n.NdJ("click",function(){return T.modalCtrl.dismiss()}),n._UZ(5,"ion-back-button",2),n.qZA()()(),n.TgZ(6,"ion-content")(7,"ion-item-divider")(8,"ion-label"),n._uU(9),n.qZA()(),n.TgZ(10,"ion-item")(11,"ion-select",3),n.NdJ("ionChange",function(Q){return T.SelectGroupServer(Q)}),n.YNc(12,N,2,2,"ion-select-option",4),n.qZA()(),n.TgZ(13,"ion-item")(14,"ion-select",3),n.NdJ("ionChange",function(Q){return T.SelectGroupChannel(Q)}),n.YNc(15,X,2,2,"ion-select-option",4),n.qZA()(),n.TgZ(16,"ion-item")(17,"ion-select",3),n.NdJ("ionChange",function(Q){return T.SelectRTCServer(Q)}),n.YNc(18,G,2,2,"ion-select-option",4),n.qZA()(),n.YNc(19,W,3,2,"ion-item",5),n.TgZ(20,"ion-item-divider")(21,"ion-label"),n._uU(22),n.qZA()(),n.YNc(23,ee,1,1,"img",6),n.qZA()),2&w&&(n.xp6(3),n.Oqu(T.lang.text.Settings.quickQRshare),n.xp6(6),n.Oqu(T.lang.text.QuickQRShare.SelectData),n.xp6(2),n.Q6J("label",T.lang.text.QuickQRShare.GroupServer)("placeholder",T.lang.text.QuickQRShare.EmptyData),n.xp6(1),n.Q6J("ngForOf",T.servers),n.xp6(2),n.Q6J("label",T.lang.text.QuickQRShare.Group)("placeholder",T.lang.text.QuickQRShare.EmptyData),n.xp6(1),n.Q6J("ngForOf",T.groups),n.xp6(2),n.Q6J("label",T.lang.text.WebRTCDevManager.Title)("placeholder",T.lang.text.QuickQRShare.EmptyData),n.xp6(1),n.Q6J("ngForOf",T.rtcServer),n.xp6(1),n.Q6J("ngIf",!T.NoReturn),n.xp6(3),n.Oqu(T.lang.text.QuickQRShare.ReceiveData),n.xp6(1),n.Q6J("ngIf",T.QRCodeSRC))},dependencies:[B.sg,B.O5,U.oU,U.Sm,U.W2,U.Gu,U.Ie,U.rH,U.Q$,U.t9,U.n0,U.wd,U.sr,U.QI,U.cs]}),J})()},1860:(z,E,_)=>{_.r(E),_.d(E,{ChatRoomPageModule:()=>nt});var L=_(6814),n=_(95),R=_(1325),m=_(5877),p=_(5861),U=_(1450),j=_(9868),B=_(9461),N=_(6845),X=_(9745),G=_(477),W=_(6052),ee=_(2854),K=_(8162),O=_(196),J=_(4688),Z=_(5470),w=_(9761);const M=(0,_(2726).fo)("TextToSpeech",{web:()=>_.e(5549).then(_.bind(_,5549)).then(l=>new l.TextToSpeechWeb)});"speechSynthesis"in window&&window;var Q=_(1186),te=_(3832),e=_(9468),v=_(9080),P=_(4093),g=_(7488),f=_(797),C=_(3857),k=_(6593),A=_(7429),H=_(9376),ie=_(4663);function se(l,d){if(1&l){const s=e.EpF();e.TgZ(0,"ion-icon",30),e.NdJ("click",function(){e.CHM(s);const i=e.oxw();return e.KtG(i.toggle_thumbnail())}),e.qZA()}}function oe(l,d){if(1&l){const s=e.EpF();e.TgZ(0,"ion-icon",31),e.NdJ("click",function(){e.CHM(s);const i=e.oxw();return e.KtG(i.toggle_thumbnail())}),e.qZA()}}function le(l,d){if(1&l&&(e.TgZ(0,"div",40)(1,"font",41),e._uU(2),e.qZA()()),2&l){const s=e.oxw().$implicit;e.xp6(2),e.hij(" ",s.msgDate," ")}}function re(l,d){if(1&l){const s=e.EpF();e.TgZ(0,"div",42)(1,"span",43),e.NdJ("click",function(){e.CHM(s);const i=e.oxw().$implicit,a=e.oxw();return e.KtG(a.user_detail(i))}),e.TgZ(2,"b")(3,"font",44),e._uU(4),e.qZA()()(),e.TgZ(5,"span",45),e._uU(6),e.qZA()()}if(2&l){const s=e.oxw().$implicit,t=e.oxw();e.xp6(3),e.MGl("color","#",s.is_me&&t.nakama.users.self.online||!s.is_me&&t.nakama.users[t.isOfficial][t.target][s.sender_id].online?s.color:"888",""),e.xp6(1),e.hij(" ",s.user_display_name||t.lang.text.Profile.noname_user,""),e.xp6(2),e.Oqu(s.msgTime)}}function ce(l,d){if(1&l){const s=e.EpF();e.TgZ(0,"div",46),e.NdJ("click",function(){e.CHM(s);const i=e.oxw().$implicit,a=e.oxw();return e.KtG(a.quickShare_act(i))}),e._uU(1),e.qZA()}if(2&l){const s=e.oxw(2);e.xp6(1),e.hij(" ",s.lang.text.ChatRoom.QuickShare," ")}}function _e(l,d){if(1&l){const s=e.EpF();e.TgZ(0,"div",46),e.NdJ("click",function(){e.CHM(s);const i=e.oxw().$implicit,a=e.oxw();return e.KtG(a.JoinWebRTCMatch(i))}),e._uU(1),e.qZA()}if(2&l){const s=e.oxw(2);e.xp6(1),e.hij(" ",s.lang.text.ChatRoom.JoinWebRTCMatch," ")}}function de(l,d){1&l&&e._UZ(0,"div",55)}function he(l,d){if(1&l&&(e.TgZ(0,"span",56),e._uU(1),e.qZA()),2&l){const s=d.$implicit;e.xp6(1),e.hij(" ",s," ")}}function ue(l,d){if(1&l){const s=e.EpF();e.TgZ(0,"div",51),e.NdJ("click",function(){e.CHM(s);const i=e.oxw(2).$implicit,a=e.oxw();return e.KtG(a.file_detail(i))}),e.TgZ(1,"p",52),e._uU(2),e.qZA(),e.YNc(3,de,1,0,"div",53),e.YNc(4,he,2,1,"span",54),e.qZA()}if(2&l){const s=e.oxw(2).$implicit,t=e.oxw();e.Akn(t.info.HideAutoThumbnail?"filter: blur(6px);":""),e.xp6(2),e.hij(" ",s.content.filename," "),e.xp6(1),e.Q6J("ngIf",s.content.text),e.xp6(1),e.Q6J("ngForOf",s.content.text)}}function ge(l,d){if(1&l){const s=e.EpF();e.TgZ(0,"div",57),e.NdJ("click",function(){e.CHM(s);const i=e.oxw(2).$implicit,a=e.oxw();return e.KtG(a.file_detail(i))}),e._UZ(1,"img",58),e.qZA()}if(2&l){const s=e.oxw(2).$implicit,t=e.oxw();e.xp6(1),e.Akn(t.info.HideAutoThumbnail?"filter: blur(6px);":""),e.Q6J("src",s.content.thumbnail,e.LSH)("alt",s.content.filename)}}function fe(l,d){if(1&l&&(e.TgZ(0,"div",59),e._uU(1),e.qZA()),2&l){const s=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",s.content.transfer_index.index,"")}}function me(l,d){if(1&l&&(e.TgZ(0,"div",47),e.YNc(1,ue,5,5,"div",48),e.YNc(2,ge,2,4,"div",49),e.YNc(3,fe,2,1,"div",50),e.qZA()),2&l){const s=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf",!s.content.thumbnail),e.xp6(1),e.Q6J("ngIf",s.content.thumbnail),e.xp6(1),e.Q6J("ngIf",s.content.transfer_index)}}function pe(l,d){if(1&l&&(e.TgZ(0,"div",60)(1,"div",61),e._uU(2),e.qZA()()),2&l){const s=e.oxw().$implicit;e.xp6(2),e.hij(" ",s.content.noti," ")}}function xe(l,d){if(1&l){const s=e.EpF();e.TgZ(0,"span",32),e.NdJ("click",function(){e.CHM(s);const i=e.oxw(5);return e.KtG(i.SetOtherAct())}),e._uU(1),e.qZA()}if(2&l){const s=e.oxw().$implicit;e.Akn("font-size: "+(s.size||16)+"px"),e.xp6(1),e.hij(" ",s.text," ")}}function ve(l,d){if(1&l){const s=e.EpF();e.TgZ(0,"a",66),e.NdJ("click",function(){e.CHM(s);const i=e.oxw(5);return e.KtG(i.SetOtherAct())}),e._uU(1),e.qZA()}if(2&l){const s=e.oxw().$implicit;e.Q6J("href",s.text,e.LSH),e.xp6(1),e.Oqu(s.text)}}function be(l,d){if(1&l&&(e.TgZ(0,"span"),e.YNc(1,xe,2,3,"span",64),e.YNc(2,ve,2,2,"a",65),e.qZA()),2&l){const s=d.$implicit;e.xp6(1),e.Q6J("ngIf",!s.href),e.xp6(1),e.Q6J("ngIf",s.href)}}function Ce(l,d){if(1&l&&(e.TgZ(0,"span",67),e._uU(1),e.qZA()),2&l){const s=e.oxw(4);e.xp6(1),e.Oqu("("+s.lang.text.ChatRoom.MsgEdited+")")}}function we(l,d){if(1&l&&(e.TgZ(0,"div")(1,"span"),e.YNc(2,be,3,2,"span",13),e.qZA(),e.YNc(3,Ce,2,1,"span",63),e.qZA()),2&l){const s=d.$implicit,t=d.index,i=e.oxw(2).$implicit;e.xp6(2),e.Q6J("ngForOf",s),e.xp6(1),e.Q6J("ngIf",i.content.edited&&t==i.content.msg.length-1)}}function Te(l,d){if(1&l&&(e.TgZ(0,"div",62),e.YNc(1,we,4,2,"div",13),e.qZA()),2&l){const s=e.oxw().$implicit;e.xp6(1),e.Q6J("ngForOf",s.content.msg)}}function ke(l,d){if(1&l&&(e.TgZ(0,"div",68),e._uU(1),e.qZA()),2&l){const s=e.oxw(2);e.xp6(1),e.hij(" ",s.lang.text.ChatRoom.YouReadHereLast,"")}}function Ie(l,d){if(1&l){const s=e.EpF();e.TgZ(0,"div",32),e.NdJ("click",function(){const i=e.CHM(s),a=i.$implicit,o=i.index,c=e.oxw();return e.KtG(c.message_detail(a,o))}),e.YNc(1,le,3,1,"div",33),e.YNc(2,re,7,3,"div",34),e.YNc(3,ce,2,1,"div",35),e.YNc(4,_e,2,1,"div",35),e.YNc(5,me,4,3,"div",36),e.YNc(6,pe,3,1,"div",37),e.YNc(7,Te,2,1,"div",38),e.YNc(8,ke,2,1,"div",39),e.qZA()}if(2&l){const s=d.$implicit;e.xp6(1),e.Q6J("ngIf",s.showInfo&&s.showInfo.date),e.xp6(1),e.Q6J("ngIf",s.showInfo&&s.showInfo.sender),e.xp6(1),e.Q6J("ngIf",s.content.quickShare),e.xp6(1),e.Q6J("ngIf",s.content.match),e.xp6(1),e.Q6J("ngIf",s.content.filename),e.xp6(1),e.Q6J("ngIf",s.content.noti),e.xp6(1),e.Q6J("ngIf",s.content.msg),e.xp6(1),e.Q6J("ngIf",s.isLastRead)}}function ye(l,d){if(1&l){const s=e.EpF();e.TgZ(0,"div",46),e.NdJ("click",function(){e.CHM(s);const i=e.oxw().$implicit,a=e.oxw();return e.KtG(a.quickShare_act(i))}),e._uU(1),e.qZA()}if(2&l){const s=e.oxw(2);e.xp6(1),e.hij(" ",s.lang.text.ChatRoom.QuickShare," ")}}function Me(l,d){1&l&&e._UZ(0,"div",55)}function Re(l,d){if(1&l&&(e.TgZ(0,"span",56),e._uU(1),e.qZA()),2&l){const s=d.$implicit;e.xp6(1),e.hij(" ",s," ")}}function Oe(l,d){if(1&l&&(e.TgZ(0,"div",71)(1,"p",52),e._uU(2),e.qZA(),e.YNc(3,Me,1,0,"div",53),e.YNc(4,Re,2,1,"span",54),e.qZA()),2&l){const s=e.oxw(2).$implicit,t=e.oxw();e.Akn(t.info.HideAutoThumbnail?"filter: blur(6px);":""),e.xp6(2),e.hij(" ",s.content.filename," "),e.xp6(1),e.Q6J("ngIf",s.content.text),e.xp6(1),e.Q6J("ngForOf",s.content.text)}}function Pe(l,d){if(1&l&&(e.TgZ(0,"div",72),e._UZ(1,"img",58),e.qZA()),2&l){const s=e.oxw(2).$implicit,t=e.oxw();e.xp6(1),e.Akn(t.info.HideAutoThumbnail?"filter: blur(6px);":""),e.Q6J("src",s.content.thumbnail,e.LSH)("alt",s.content.filename)}}function Se(l,d){if(1&l&&(e.TgZ(0,"div",47),e.YNc(1,Oe,5,5,"div",69),e.YNc(2,Pe,2,4,"div",70),e.qZA()),2&l){const s=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf",!s.content.thumbnail),e.xp6(1),e.Q6J("ngIf",s.content.thumbnail)}}function Ze(l,d){if(1&l){const s=e.EpF();e.TgZ(0,"span",75),e.NdJ("click",function(){e.CHM(s);const i=e.oxw(5);return e.KtG(i.SetOtherAct())}),e._uU(1),e.qZA()}if(2&l){const s=e.oxw().$implicit;e.xp6(1),e.hij(" ",s.text," ")}}function Ae(l,d){if(1&l){const s=e.EpF();e.TgZ(0,"a",76),e.NdJ("click",function(){e.CHM(s);const i=e.oxw(5);return e.KtG(i.SetOtherAct())}),e._uU(1),e.qZA()}if(2&l){const s=e.oxw().$implicit;e.Q6J("href",s.text,e.LSH),e.xp6(1),e.Oqu(s.text)}}function $e(l,d){if(1&l&&(e.TgZ(0,"span"),e.YNc(1,Ze,2,1,"span",73),e.YNc(2,Ae,2,2,"a",74),e.qZA()),2&l){const s=d.$implicit;e.xp6(1),e.Q6J("ngIf",!s.href),e.xp6(1),e.Q6J("ngIf",s.href)}}function Ue(l,d){if(1&l&&(e.TgZ(0,"div"),e.YNc(1,$e,3,2,"span",13),e.qZA()),2&l){const s=d.$implicit;e.xp6(1),e.Q6J("ngForOf",s)}}function Qe(l,d){if(1&l&&(e.TgZ(0,"div",62),e.YNc(1,Ue,2,1,"div",13),e.qZA()),2&l){const s=e.oxw().$implicit;e.xp6(1),e.Q6J("ngForOf",s.content.msg)}}function De(l,d){if(1&l&&(e.TgZ(0,"div"),e.YNc(1,ye,2,1,"div",35),e.YNc(2,Se,3,2,"div",36),e.YNc(3,Qe,2,1,"div",38),e.qZA()),2&l){const s=d.$implicit;e.xp6(1),e.Q6J("ngIf",s.content.quickShare),e.xp6(1),e.Q6J("ngIf",s.content.filename),e.xp6(1),e.Q6J("ngIf",s.content.msg)}}function Le(l,d){if(1&l){const s=e.EpF();e.TgZ(0,"tr",77),e.NdJ("click",function(){e.CHM(s);const i=e.oxw();return e.KtG(i.cancel_qrshare())}),e.TgZ(1,"td",78)(2,"span"),e._uU(3),e.qZA()()()}if(2&l){const s=e.oxw();e.xp6(3),e.Oqu(s.lang.text.Settings.quickQRshare)}}function Je(l,d){if(1&l&&e._UZ(0,"img",84),2&l){const s=e.oxw(4);e.Q6J("src",s.userInput.file.thumbnail,e.LSH)("alt",s.userInput.file.name)}}function Ve(l,d){if(1&l&&(e.TgZ(0,"div"),e.YNc(1,Je,1,2,"img",83),e.qZA()),2&l){const s=e.oxw(3);e.xp6(1),e.Q6J("ngIf","image"==s.userInput.file.typeheader)}}function Fe(l,d){if(1&l&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&l){const s=d.$implicit;e.xp6(1),e.hij(" ",s," ")}}function Ne(l,d){if(1&l&&(e.TgZ(0,"div",85),e.YNc(1,Fe,2,1,"span",13),e.qZA()),2&l){const s=e.oxw(3);e.xp6(1),e.Q6J("ngForOf",s.userInput.file.thumbnail)}}function Ee(l,d){if(1&l){const s=e.EpF();e.TgZ(0,"div",32),e.NdJ("click",function(){e.CHM(s);const i=e.oxw(2);return e.KtG(i.removeAttach())}),e.TgZ(1,"div",81),e._uU(2),e.qZA(),e.YNc(3,Ve,2,1,"div",22),e.YNc(4,Ne,2,1,"div",82),e.qZA()}if(2&l){const s=e.oxw(2);e.xp6(2),e.hij(" ",s.userInput.file.filename," "),e.xp6(1),e.Q6J("ngIf",s.userInput.file.thumbnail),e.xp6(1),e.Q6J("ngIf","text"==s.userInput.file.typeheader)}}function He(l,d){if(1&l&&(e.TgZ(0,"tr",79)(1,"td"),e.YNc(2,Ee,5,3,"div",80),e.qZA()()),2&l){const s=e.oxw();e.xp6(2),e.Q6J("ngIf",s.userInput.file)}}function Ye(l,d){if(1&l){const s=e.EpF();e.TgZ(0,"tr",77),e.NdJ("click",function(){e.CHM(s);const i=e.oxw();return e.KtG(i.init_chatroom())}),e.TgZ(1,"td",86),e._uU(2),e.qZA()()}if(2&l){const s=e.oxw();e.xp6(2),e.Oqu(s.lang.text.ChatRoom.GoToRecent)}}function qe(l,d){if(1&l){const s=e.EpF();e.TgZ(0,"span",32),e.NdJ("click",function(){e.CHM(s);const i=e.oxw(4);return e.KtG(i.SetOtherAct())}),e._uU(1),e.qZA()}if(2&l){const s=e.oxw().$implicit;e.xp6(1),e.hij(" ",s.text," ")}}function Be(l,d){if(1&l){const s=e.EpF();e.TgZ(0,"a",66),e.NdJ("click",function(){e.CHM(s);const i=e.oxw(4);return e.KtG(i.SetOtherAct())}),e._uU(1),e.qZA()}if(2&l){const s=e.oxw().$implicit;e.Q6J("href",s.text,e.LSH),e.xp6(1),e.Oqu(s.text)}}function Ke(l,d){if(1&l&&(e.TgZ(0,"span"),e.YNc(1,qe,2,1,"span",80),e.YNc(2,Be,2,2,"a",65),e.qZA()),2&l){const s=d.$implicit;e.xp6(1),e.Q6J("ngIf",!s.href),e.xp6(1),e.Q6J("ngIf",s.href)}}function je(l,d){if(1&l&&(e.TgZ(0,"span"),e.YNc(1,Ke,3,2,"span",13),e.qZA()),2&l){const s=d.$implicit;e.xp6(1),e.Q6J("ngForOf",s)}}function Ge(l,d){if(1&l){const s=e.EpF();e.TgZ(0,"tr",77),e.NdJ("click",function(){e.CHM(s);const i=e.oxw();return e.KtG(i.init_chatroom())}),e.TgZ(1,"td",87)(2,"span")(3,"b"),e._uU(4),e.qZA()(),e.YNc(5,je,2,1,"span",13),e.qZA()()}if(2&l){const s=e.oxw();e.xp6(2),e.Akn("margin-right: 8px; color: #"+s.last_message_viewer.color),e.xp6(2),e.Oqu((s.last_message_viewer.is_me?s.nakama.users.self.display_name:s.nakama.users[s.isOfficial][s.target][s.last_message_viewer.user_id].display_name)||s.lang.text.Profile.noname_user),e.xp6(1),e.Q6J("ngForOf",s.last_message_viewer.message)}}function We(l,d){if(1&l){const s=e.EpF();e.TgZ(0,"td")(1,"ion-button",88),e.NdJ("click",function(){e.CHM(s);const i=e.oxw();return e.KtG(i.GetSpeechToText())}),e._UZ(2,"ion-icon",89),e.qZA()()}}function ze(l,d){if(1&l&&e._UZ(0,"ion-icon",94),2&l){const s=e.oxw().$implicit;e.Q6J("name",s.icon||"close-circle")}}function Xe(l,d){if(1&l&&e._UZ(0,"img",95),2&l){const s=e.oxw().$implicit;e.Q6J("src","assets/icon/"+s.icon_img,e.LSH)("alt",s.title)}}function et(l,d){if(1&l){const s=e.EpF();e.TgZ(0,"div",90)(1,"div",91),e.NdJ("click",function(){const a=e.CHM(s).$implicit;return e.KtG(a.act())}),e.YNc(2,ze,1,1,"ion-icon",92),e.YNc(3,Xe,1,2,"img",93),e.qZA()()}if(2&l){const s=d.$implicit;e.xp6(1),e.Akn("cursor: "+(s.cursor||"pointer")+";"),e.Q6J("hidden",s.isHide),e.xp6(1),e.Q6J("ngIf",s.icon),e.xp6(1),e.Q6J("ngIf",s.icon_img)}}const tt=[{path:"",component:(()=>{var l;class d{constructor(t,i,a,o,c,u,h,x,b,$,y,Y,V,ae,at,st,ot){var S,r=this;this.modalCtrl=t,this.navCtrl=i,this.route=a,this.router=o,this.nakama=c,this.noti=u,this.statusBar=h,this.indexed=x,this.lang=b,this.sanitizer=$,this.global=y,this.loadingCtrl=Y,this.webrtc=V,this.p5toast=ae,this.mClipboard=at,this.alertCtrl=st,this.platform=ot,this.info={},this.foundLastRead=!1,this.messages=[],this.sending_msg=[],this.temporary_open_thumbnail={},this.extended_buttons=[{icon:"settings-outline",act:()=>{3!=this.info.redirect.type?this.extended_buttons[0].isHide=!0:this.lock_modal_open||(this.lock_modal_open=!0,this.modalCtrl.create({component:ee.x,componentProps:{info:this.nakama.groups[this.isOfficial][this.target][this.info.group_id],server:{isOfficial:this.isOfficial,target:this.target}}}).then(S=>{S.onWillDismiss().then(I=>{I.data&&(this.extended_buttons.forEach(F=>{F.isHide=!0}),this.extended_buttons[0].isHide=!1,this.extended_buttons[8].isHide=!1,this.extended_buttons[11].isHide=!1)}),S.onDidDismiss().then(()=>{this.ionViewDidEnter()}),this.removeShortCutKey(),S.present(),this.lock_modal_open=!1}))}},{icon:"hammer-outline",isHide:!0,act:()=>{document.getElementById("local_channel").click()}},{icon_img:"voidDraw.png",act:(S=(0,p.Z)(function*(){r.userInputTextArea||(r.userInputTextArea=document.getElementById(r.ChannelUserInputId));let F,I={};if(r.userInput.file)switch(r.userInput.file.typeheader){case"image":try{r.userInput.file.url&&(r.userInput.file.blob=yield fetch(r.userInput.file.url).then(ne=>ne.blob()));let D=`tmp_files/chatroom/attached.${r.userInput.file.file_ext}`;yield r.indexed.saveBlobToUserPath(r.userInput.file.blob,D,void 0,r.indexed.godotDB);let q=document.getElementById("ChatroomSelectedImage");I.path=D,I.width=q.naturalWidth,I.height=q.naturalHeight,F=r.userInput.file.content_related_creator}catch(D){return void r.p5toast.show({text:`${r.lang.text.ContentViewer.CannotEditFile}: ${D}`})}break;case"text":I.text=r.userInput.file.thumbnail}r.modalCtrl.create({component:G.$,componentProps:I,cssClass:"fullscreen"}).then(D=>{D.onWillDismiss().then(function(){var q=(0,p.Z)(function*(ne){ne.data&&(yield r.voidDraw_fileAct_callback(ne,F))});return function(ne){return q.apply(this,arguments)}}()),D.onDidDismiss().then(()=>{r.is_modal=!1,r.ionViewDidEnter()}),r.is_modal=!0,D.present()})}),function(){return S.apply(this,arguments)})},{icon:"document-attach-outline",act:()=>{this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId)),this.new_attach({detail:{value:"load"}})}},{icon:"link-outline",act:()=>{this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId)),this.new_attach({detail:{value:"link"}})}},{icon:"camera-outline",act:function(){var S=(0,p.Z)(function*(){try{const I=yield K.V1.getPhoto({quality:90,resultType:K.dk.Base64,source:K.oK.Camera});let F=yield r.loadingCtrl.create({message:r.lang.text.TodoDetail.WIP});F.present(),r.userInputTextArea||(r.userInputTextArea=document.getElementById(r.ChannelUserInputId)),r.userInput.file={},r.userInput.file.filename=`Camera_${(new Date).toLocaleString().replace(/:/g,"_")}.${I.format}`,r.userInput.file.file_ext=I.format,r.userInput.file.thumbnail=r.sanitizer.bypassSecurityTrustUrl("data:image/jpeg;base64,"+I.base64String),r.userInput.file.type=`image/${I.format}`,r.userInput.file.typeheader="image",r.userInput.file.content_related_creator=[{user_id:r.info.local?"local":r.nakama.servers[r.isOfficial][r.target].session.user_id,timestamp:(new Date).getTime(),display_name:r.nakama.users.self.display_name,various:"camera"}],r.userInput.file.content_creator={user_id:r.info.local?"local":r.nakama.servers[r.isOfficial][r.target].session.user_id,timestamp:(new Date).getTime(),display_name:r.nakama.users.self.display_name,various:"camera"},yield r.indexed.saveBase64ToUserPath("data:image/jpeg;base64,"+I.base64String,`tmp_files/chatroom/${r.userInput.file.filename}`,q=>{r.userInput.file.blob=new Blob([q],{type:r.userInput.file.type})}),F.dismiss()}catch{}});return function(){return S.apply(this,arguments)}}()},{icon:"server-outline",act:()=>{this.modalCtrl.create({component:J.b}).then(S=>{S.onDidDismiss().then(I=>{I.data?(this.userInput.quickShare=I.data,this.inputPlaceholder=this.lang.text.ChatRoom.QuickShare_placeholder):this.cancel_qrshare(),this.ionViewDidEnter()}),this.removeShortCutKey(),S.present()})}},{icon:"call-outline",act:function(){var S=(0,p.Z)(function*(){try{yield r.webrtc.initialize("audio",void 0,{isOfficial:r.isOfficial,target:r.target,channel_id:r.info.id,user_id:r.info.info.id||r.info.info.user_id}),r.webrtc.CurrentMatch=yield r.nakama.servers[r.isOfficial][r.target].socket.createMatch(),yield r.nakama.servers[r.isOfficial][r.target].socket.writeChatMessage(r.info.id,{match:r.webrtc.CurrentMatch.match_id}),r.scroll_down_logs(),r.webrtc.CreateOfffer()}catch(I){console.log("webrtc \uc2dc\uc791\ub2e8\uacc4 \uc624\ub958: ",I)}});return function(){return S.apply(this,arguments)}}()},{isHide:!1,icon:"file-tray-full-outline",act:()=>{this.modalCtrl.create({component:te.P,componentProps:{path:`/${this.info.id}/files/`}}).then(S=>{S.onWillDismiss().then(function(){var I=(0,p.Z)(function*(F){F.data&&r.selected_blobFile_callback_act(F.data)});return function(F){return I.apply(this,arguments)}}()),S.onDidDismiss().then(()=>{this.is_modal=!1,this.ionViewDidEnter()}),this.is_modal=!0,S.present()})}},{icon:"volume-mute-outline",act:function(){var S=(0,p.Z)(function*(){r.toggle_speakermode()});return function(){return S.apply(this,arguments)}}()},{icon:"log-out-outline",act:function(){var S=(0,p.Z)(function*(){if(3!=r.info.redirect.type)try{yield r.nakama.remove_group_list(r.nakama.groups[r.isOfficial][r.target][r.info.group_id]||r.info.info,r.isOfficial,r.target,!1),yield r.nakama.servers[r.isOfficial][r.target].socket.leaveChat(r.info.id),r.nakama.channels_orig[r.isOfficial][r.target][r.info.id].status="missing",r.extended_buttons.forEach(I=>{I.isHide=!0}),r.extended_buttons[8].isHide=!1,r.extended_buttons[11].isHide=!1}catch(I){console.error("\ucc44\ub110\uc5d0\uc11c \ub098\uc624\uae30 \uc2e4\ud328: ",I)}else r.extended_buttons[10].isHide=!0;r.ionViewDidEnter()});return function(){return S.apply(this,arguments)}}()},{isHide:!0,icon:"close-circle-outline",act:()=>{this.alertCtrl.create({header:this.lang.text.ChatRoom.RemoveChannel,message:this.lang.text.ChatRoom.CannotUndone,buttons:[{text:this.lang.text.ChatRoom.Delete,handler:function(){var S=(0,p.Z)(function*(){let I=yield r.loadingCtrl.create({message:r.lang.text.TodoDetail.WIP});switch(I.present(),delete r.nakama.channels_orig[r.isOfficial][r.target][r.info.id],r.info.redirect.type){case 3:yield r.nakama.remove_group_list(r.nakama.groups[r.isOfficial][r.target][r.info.group_id]||r.info.info,r.isOfficial,r.target);break;case 0:yield r.indexed.removeFileFromUserPath(`servers/${r.isOfficial}/${r.target}/groups/${r.info.id}.img`)}try{delete r.nakama.groups[r.isOfficial][r.target][r.info.group_id]}catch(D){console.log("DeleteGroupFailed: ",D)}r.nakama.remove_channel_files(r.isOfficial,r.target,r.info.id),r.nakama.save_groups_with_less_info();let F=yield r.indexed.GetFileListFromDB(`servers/${r.isOfficial}/${r.target}/channels/${r.info.id}`);for(let D=0,q=F.length;D<q;D++)I.message=`${r.lang.text.UserFsDir.DeleteFile}: ${q-D}`,yield r.indexed.removeFileFromUserPath(F[D]);I.dismiss(),r.navCtrl.pop()});return function(){return S.apply(this,arguments)}}(),cssClass:"red_font"}]}).then(S=>S.present())}}],this.is_modal=!1,this.next_cursor="",this.prev_cursor="",this.file_sel_id="file_sel_id",this.ShowGoToBottom=!1,this.isMobile=!1,this.last_message_viewer={user_id:void 0,message:void 0,color:void 0,is_me:void 0},this.userInput={file:void 0,quickShare:void 0,text:""},this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder,this.pullable=!0,this.ViewableMessage=[],this.ViewMsgIndex=0,this.RefreshCount=15,this.ViewCount=45,this.ShowRecentMsg=!1,this.useSpeaker=!1,this.isSpeeching=!1,this.SpeechThese=[],this.isHistoryLoaded=!1,this.LocalHistoryList=[],this.isHidden=!0,this.isIphone=!1,this.ChannelUserInputId="ChannelUserInputId",this.isOtherAct=!1,this.lock_modal_open=!1}add_shortcut(){this.is_modal||this.ionViewDidEnter()}ionViewDidEnter(){this.nakama.resumeBanner(),this.global.p5key.KeyShortCut.Escape=()=>{this.navCtrl.pop()},this.global.p5key.KeyShortCut.BottomTab=i=>{document.activeElement!=document.getElementById(this.ChannelUserInputId)&&"E"===i&&this.open_ext_with_delay()};let t=[];for(let i=0,a=this.extended_buttons.length;i<a;i++)this.extended_buttons[i].isHide||t.push(this.extended_buttons[i]);this.global.p5key.KeyShortCut.Digit=i=>{!this.isHidden&&document.activeElement!=document.getElementById(this.ChannelUserInputId)&&t.length>i&&t[i].act()},this.global.p5key.KeyShortCut.EnterAct=()=>{document.activeElement!=document.getElementById(this.ChannelUserInputId)&&setTimeout(()=>{this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId)),this.userInputTextArea.focus()},0)}}new_attach(t){var i=this;return(0,p.Z)(function*(){switch(t.detail.value){case"load":i.userInputTextArea||(i.userInputTextArea=document.getElementById(i.ChannelUserInputId)),document.getElementById(i.file_sel_id).click();break;case"link":try{let a;try{a=yield i.mClipboard.paste()}catch{try{a=yield w.Z.read()}catch(h){throw h}}let o={};o.url=a,o.content_related_creator=[{user_id:i.info.local?"local":i.nakama.servers[i.isOfficial][i.target].session.user_id,timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"link"}],o.content_creator={user_id:i.info.local?"local":i.nakama.servers[i.isOfficial][i.target].session.user_id,timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"link"};let c=o.url.split(".");o.file_ext=c.pop().split("?").shift(),o.filename=`${c.pop().split("/").pop()||i.lang.text.ChatRoom.ExternalLinkFile}.${o.file_ext}`,i.global.set_viewer_category_from_ext(o),o.type="",o.typeheader=o.viewer,i.global.modulate_thumbnail(o,o.url),i.NeedScrollDown()&&setTimeout(()=>{i.scroll_down_logs()},100),i.userInput.file=o,i.inputPlaceholder=`(${i.lang.text.ChatRoom.FileLink}: ${i.userInput.file.filename})`}catch(a){i.p5toast.show({text:`${i.lang.text.ChatRoom.FailedToPasteData}: ${a}`})}}})()}toggle_speakermode(t){var i=this;return(0,p.Z)(function*(){if(i.useSpeaker=null!=t?t:!i.useSpeaker,i.extended_buttons[9].icon=i.useSpeaker?"volume-high-outline":"volume-mute-outline",!i.useSpeaker)try{yield M.stop()}catch{}})()}cancel_qrshare(){delete this.userInput.quickShare,this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder}inputFileSelected(t){var i=this;return(0,p.Z)(function*(){if(t.target.files.length)if(1!=t.target.files.length)(yield i.alertCtrl.create({header:i.lang.text.ChatRoom.MultipleSend,message:`${i.lang.text.ChatRoom.CountFile}: ${t.target.files.length}`,buttons:[{text:i.lang.text.ChatRoom.Send,handler:(c=(0,p.Z)(function*(){let u=yield i.loadingCtrl.create({message:i.lang.text.ChatRoom.MultipleSend});u.present(),i.noti.noti.schedule({id:7,title:i.lang.text.ChatRoom.MultipleSend,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://diychat",color:"b0b0b0"});for(let h=0,x=t.target.files.length;h<x;h++)u.message=`${i.lang.text.ChatRoom.MultipleSend}: ${x-h}`,i.noti.noti.schedule({id:7,title:i.lang.text.ChatRoom.MultipleSend,progressBar:{value:h,maxValue:x},sound:null,smallIcon:"res://diychat",color:"b0b0b0"}),yield i.selected_blobFile_callback_act(t.target.files[h]),yield i.send();i.noti.ClearNoti(7),u.dismiss(),setTimeout(()=>{i.scroll_down_logs()},300)}),function(){return c.apply(this,arguments)})}]})).present();else{let o=yield i.loadingCtrl.create({message:i.lang.text.TodoDetail.WIP});o.present(),yield i.selected_blobFile_callback_act(t.target.files[0]),o.dismiss()}else delete i.userInput.file,i.inputPlaceholder=i.lang.text.ChatRoom.input_placeholder;var c})()}LocalChannelImageChanged(t){var i=this;return(0,p.Z)(function*(){let a=yield i.global.GetBase64ThroughFileReader(t.target.files[0]);i.nakama.limit_image_size(a,o=>{i.info.info.img=o.canvas.toDataURL(),i.indexed.saveTextFileToUserPath(i.info.info.img,`servers/${i.info.server.isOfficial}/${i.info.server.target}/groups/${i.info.id}.img`),i.p5toast.show({text:i.lang.text.ChatRoom.LocalImageChanged})})})()}ngOnInit(){var t=this;this.isIphone=this.platform.is("iphone"),this.ChatLogs=document.getElementById("chatroom_div"),this.ChatLogs.onscroll=i=>{Math.abs(this.ChatLogs.scrollHeight-(this.ChatLogs.scrollTop+this.ChatLogs.clientHeight))<1&&(this.ShowGoToBottom||this.ShowRecentMsg||this.init_last_message_viewer(),this.ShowRecentMsg&&this.pull_msg_history(!1)),this.ShowGoToBottom=this.ChatLogs.scrollHeight-220>this.ChatLogs.scrollTop+this.ChatLogs.clientHeight},this.nakama.ChatroomLinkAct=function(){var i=(0,p.Z)(function*(a,o){delete t.nakama.channels_orig[t.isOfficial][t.target][t.info.id].update,t.info=a,yield t.init_chatroom(),t.userInput.file=o,t.userInput.file&&t.create_thumbnail_imported(o)});return function(a,o){return i.apply(this,arguments)}}(),this.route.queryParams.subscribe(function(){var i=(0,p.Z)(function*(a){const o=t.router.getCurrentNavigation().extras.state;o&&(t.info=o.info),yield new Promise(c=>setTimeout(c,100)),yield t.init_chatroom(),t.userInput.file=o.file,t.userInput.file&&t.create_thumbnail_imported(o.file)});return function(a){return i.apply(this,arguments)}}()),"DesktopPWA"==N.n$&&setTimeout(()=>{this.CreateDrop()},0),this.isMobile="Android"==N.n$||"iOS"==N.n$}GetSpeechToText(){var t=this;return(0,p.Z)(function*(){let i=yield Q.M.start({language:t.lang.lang,maxResults:1,prompt:t.lang.text.ChatRoom.TalkMessage,partialResults:!0,popup:!0});t.userInput.text=i.matches[0]})()}CreateDrop(){var t=this;let i=document.getElementById("p5Drop_chatroom");this.p5canvas=new j(a=>{a.setup=()=>{let x=a.createCanvas(i.clientWidth,i.clientHeight);x.parent(i),a.pixelDensity(1),x.drop(b=>{let $=a.millis();u<$-400?(c=!1,h.length=0,h.push(b)):(c=!0,h.push(b)),u=$,clearTimeout(o),o=setTimeout((0,p.Z)(function*(){if(c)t.alertCtrl.create({header:t.lang.text.ChatRoom.MultipleSend,message:`${t.lang.text.ChatRoom.CountFile}: ${h.length}`,buttons:[{text:t.lang.text.ChatRoom.Send,handler:()=>{t.DropSendAct(h)}}]}).then(y=>y.present());else{let y=yield t.loadingCtrl.create({message:t.lang.text.TodoDetail.WIP});y.present(),t.selected_blobFile_callback_act(b.file),y.dismiss()}}),400)})};let o,c=!1,u=0,h=[];a.mouseMoved=x=>{x.dataTransfer?(i.style.pointerEvents="all",i.style.backgroundColor="#0008"):(i.style.pointerEvents="none",i.style.backgroundColor="transparent")}})}DropSendAct(t){var i=this;return(0,p.Z)(function*(){let a=yield i.loadingCtrl.create({message:i.lang.text.TodoDetail.WIP});a.present();for(let o=0,c=t.length;o<c;o++)yield i.selected_blobFile_callback_act(t[o].file),yield i.send();a.dismiss(),setTimeout(()=>{i.scroll_down_logs()},300)})()}selected_blobFile_callback_act(t,i=[],a="loaded"){var o=this;return(0,p.Z)(function*(){o.userInput.file={},o.userInput.file.filename=t.name,o.userInput.file.file_ext=t.name.split(".").pop()||t.type||o.lang.text.ChatRoom.unknown_ext,o.userInput.file.size=t.size,o.userInput.file.type=t.type,o.userInput.file.content_related_creator=[...i,{user_id:o.info.local?"local":o.nakama.servers[o.isOfficial][o.target].session.user_id,timestamp:(new Date).getTime(),display_name:o.nakama.users.self.display_name,various:a}],o.userInput.file.content_creator={user_id:o.info.local?"local":o.nakama.servers[o.isOfficial][o.target].session.user_id,timestamp:(new Date).getTime(),display_name:o.nakama.users.self.display_name,various:a},o.userInput.file.blob=t,o.create_selected_thumbnail(),o.inputPlaceholder=`(${o.lang.text.ChatRoom.attachments}: ${o.userInput.file.filename})`})()}create_thumbnail_imported(t){var i=this;return(0,p.Z)(function*(){let a=yield i.indexed.loadBlobFromUserPath(t.path,t.type);a.name=t.filename,i.selected_blobFile_callback_act(a,t.content_related_creator,"shared")})()}create_selected_thumbnail(){var t=this;return(0,p.Z)(function*(){try{if(t.userInput.file.blob.user_fs){if(t.global.set_viewer_category_from_ext(t.userInput.file),t.userInput.file.url)return t.userInput.file.thumbnail=t.userInput.file.url,void(t.userInput.file.typeheader=t.userInput.file.viewer);t.userInput.file.thumbnail=yield t.indexed.loadBlobFromUserPath(t.userInput.file.path,t.userInput.file.type)}}catch{}let i=URL.createObjectURL(t.userInput.file.blob);switch(t.userInput.file.typeheader=t.userInput.file.blob.type.split("/")[0]||t.userInput.file.viewer,setTimeout(()=>{URL.revokeObjectURL(i)},0),t.userInput.file.thumbnail=void 0,t.userInput.file.typeheader){case"image":t.userInput.file.thumbnail=t.sanitizer.bypassSecurityTrustUrl(i);break;case"text":new j(a=>{a.setup=()=>{a.noCanvas(),a.loadStrings(i,o=>{t.userInput.file.thumbnail=o,a.remove()},o=>{console.error("\ubb38\uc790\uc5f4 \ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",o),a.remove()})}})}})()}init_chatroom(){var t=this;return(0,p.Z)(function*(){switch(t.nakama.OnTransferMessage={},t.ViewableMessage.length=0,t.ViewMsgIndex=0,t.ShowGoToBottom=!1,t.ShowRecentMsg=!1,t.isHistoryLoaded=!1,t.LocalHistoryList.length=0,t.messages.length=0,t.prev_cursor="",t.next_cursor="",t.pullable=!0,t.toggle_speakermode(!1),t.init_last_message_viewer(),t.file_sel_id=`chatroom_${t.info.id}_${(new Date).getTime()}`,t.ChannelUserInputId=`chatroom_input_${t.info.id}_${(new Date).getTime()}`,t.noti.Current=t.info.cnoti_id,t.info.cnoti_id&&t.noti.ClearNoti(t.info.cnoti_id),t.noti.RemoveListener(`openchat${t.info.cnoti_id}`),t.isOfficial=t.info.server.isOfficial,t.target=t.info.server.target,t.info=t.nakama.channels_orig[t.isOfficial][t.target][t.info.id],t.nakama.opened_page_info.channel={isOfficial:t.isOfficial,target:t.target,id:t.info.id},t.foundLastRead=t.info.last_read_id==t.info.last_comment_id,t.info.redirect.type){case 2:"missing"!=t.info.status&&(t.info.redirect?"online"==t.statusBar.groupServer[t.isOfficial][t.target]&&(t.info.status=t.nakama.load_other_user(t.info.redirect.id,t.isOfficial,t.target).online?"online":"pending"):t.info.status=t.info.info.online?"online":"pending",delete t.extended_buttons[8].isHide,t.extended_buttons[0].isHide=!0,t.extended_buttons[7].isHide="http:"==window.location.protocol&&0!=window.location.host.indexOf("localhost")||!1);break;case 3:"missing"!=t.info.status&&(yield t.nakama.load_groups(t.isOfficial,t.target,t.info.group_id)),t.extended_buttons[10].isHide=!0,delete t.extended_buttons[0].isHide,t.extended_buttons[7].isHide=!0;break;case 0:t.extended_buttons.forEach(i=>{i.isHide=!0}),t.extended_buttons[1].isHide=!1,t.extended_buttons[2].isHide=!1,t.extended_buttons[3].isHide=!1,t.extended_buttons[4].isHide=!1,t.extended_buttons[5].isHide=!1,t.extended_buttons[8].isHide=!1,t.extended_buttons[9].isHide=!1,t.extended_buttons[11].isHide=!1}t.nakama.channels_orig[t.isOfficial][t.target]&&t.nakama.channels_orig[t.isOfficial][t.target][t.info.id]&&"missing"!=t.info.status&&(t.nakama.channels_orig[t.isOfficial][t.target][t.info.id].update=i=>{if(1==i.code){for(let o=0,c=t.messages.length;o<c;o++)if(t.messages[o].message_id==i.message_id){t.messages[o].content=i.content;break}return}let a="local"==i.sender_id;a||t.nakama.check_sender_and_show_name(i,t.isOfficial,t.target),i.content.filename&&t.ModulateFileEmbedMessage(i),t.info.last_read_id=t.info.last_comment_id,t.nakama.save_channels_with_less_info(),a||t.check_if_send_msg(i),1==i.code||2==i.code||t.messages.push(i),t.ViewMsgIndex+t.ViewCount==t.messages.length-1&&t.ViewMsgIndex++,t.ViewableMessage=t.messages.slice(t.ViewMsgIndex,t.ViewMsgIndex+t.ViewCount),t.modulate_chatmsg(0,t.ViewableMessage.length),t.modulate_chatmsg(t.ViewableMessage.length-1,t.ViewableMessage.length),t.ShowRecentMsg=t.messages.length>t.ViewMsgIndex+t.ViewCount,t.useSpeaker&&t.SpeechReceivedMessage(i),setTimeout(()=>{if(t.info.is_new=!1,t.nakama.has_new_channel_msg=!1,t.NeedScrollDown()&&!t.ShowRecentMsg)t.init_last_message_viewer(),t.ChatLogs.scrollTo({top:t.ChatLogs.scrollHeight,behavior:"smooth"});else{t.last_message_viewer.is_me=!!t.info.local||i.sender_id==t.nakama.servers[t.isOfficial][t.target].session.user_id,t.last_message_viewer.user_id=i.sender_id;let o=JSON.parse(JSON.stringify(i.content.msg));i.content.filename&&(o.length?o[0][0].text=`(${t.lang.text.ChatRoom.attachments}) ${o[0][0].text}`:o=[[{text:`(${t.lang.text.ChatRoom.attachments})`}]]),t.last_message_viewer.message=o,t.last_message_viewer.color=i.color}},0),t.global.godot_window&&t.global.godot_window.received_msg&&t.global.godot_window.received_msg({sender_id:i.sender_id,user_display_name:i.user_display_name,content:i.content})}),(void 0===t.info.status||"missing"==t.info.status)&&(t.extended_buttons.forEach(i=>{i.isHide=!0}),t.extended_buttons[8].isHide=!1,t.extended_buttons[11].isHide=!1,3==t.info.redirect.type&&(t.extended_buttons[0].isHide=!1)),t.extended_buttons[9].isHide=N.bS||"missing"==t.info.status,t.pull_msg_history(),setTimeout(()=>{t.ChatLogs.scrollTo({top:t.ChatLogs.scrollHeight,behavior:"smooth"})},500)})()}init_last_message_viewer(){delete this.last_message_viewer.user_id,delete this.last_message_viewer.message,delete this.last_message_viewer.color,delete this.last_message_viewer.is_me}NeedScrollDown(){return this.ChatLogs.scrollHeight<this.ChatLogs.scrollTop+this.ChatLogs.clientHeight+200}scroll_down_logs(){this.ShowRecentMsg||this.init_last_message_viewer(),this.ChatLogs.scrollTo({top:this.ChatLogs.scrollHeight,behavior:"smooth"})}check_if_send_msg(t){for(let i=0,a=this.sending_msg.length;i<a;i++)if(t.sender_id==this.nakama.servers[this.isOfficial][this.target].session.user_id&&t.content.local_comp==this.sending_msg[i].content.local_comp){t.content.filename&&this.auto_open_thumbnail(t),this.sending_msg.splice(i,1);break}}auto_open_thumbnail(t){try{this.temporary_open_thumbnail[t.message_id]()}catch{this.temporary_open_thumbnail[t.message_id]=()=>{this.indexed.loadBlobFromUserPath(`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${t.message_id}.${t.content.file_ext}`,t.content.type,a=>{t.content.path=`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${t.message_id}.${t.content.file_ext}`;let o=URL.createObjectURL(a);this.global.modulate_thumbnail(t.content,o),this.NeedScrollDown()&&setTimeout(()=>{this.scroll_down_logs()},100),this.nakama.WriteStorage_From_channel(t,t.content.path,this.isOfficial,this.target)}),delete this.temporary_open_thumbnail[t.message_id]}}}removeAttach(){delete this.userInput.file,this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder}pull_msg_history(t=!0){var i=this;return(0,p.Z)(function*(){if(i.pullable||!t)if(i.pullable=!1,t)try{if(i.info.local)throw"Local channel";if(void 0===i.info.status||"missing"==i.info.status)throw"Channel missing";if(0!=i.ViewMsgIndex){let a=Math.min(i.ViewMsgIndex,i.RefreshCount);i.ViewMsgIndex-=a,i.ViewableMessage=i.messages.slice(i.ViewMsgIndex,i.ViewMsgIndex+i.ViewCount);for(let o=0;o<a;o++)try{i.ViewableMessage[o].content.path=`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${i.ViewableMessage[o].message_id}.${i.ViewableMessage[o].content.file_ext}`;let c=yield i.indexed.loadBlobFromUserPath(i.ViewableMessage[o].content.path,i.ViewableMessage[o].content.file_ext),u=URL.createObjectURL(c);i.global.modulate_thumbnail(i.ViewableMessage[o].content,u)}catch{}return i.modulate_chatmsg(0,i.ViewableMessage.length),i.ShowRecentMsg=i.messages.length>i.ViewMsgIndex+i.ViewCount,void(i.pullable=!0)}yield i.nakama.servers[i.isOfficial][i.target].client.listChannelMessages(i.nakama.servers[i.isOfficial][i.target].session,i.info.id,i.RefreshCount,!1,i.next_cursor).then(a=>{i.info.is_new=!1,a.messages.forEach(o=>{o=i.nakama.modulation_channel_message(o,i.isOfficial,i.target),i.nakama.check_sender_and_show_name(o,i.isOfficial,i.target),i.info.last_comment||(i.info.last_comment=(o.content.filename?`(${i.lang.text.ChatRoom.attachments}) `:"")+(o.content.msg||o.content.noti||"")),!i.foundLastRead&&i.info.last_read_id?i.info.last_read_id==o.message_id&&(o.isLastRead=!0,i.foundLastRead=!0,i.info.last_read_id=i.info.last_comment_id,i.nakama.save_channels_with_less_info()):i.foundLastRead=!0,i.nakama.translate_updates(o),o.content.filename&&i.ModulateFileEmbedMessage(o),i.nakama.ModulateTimeDate(o),i.nakama.content_to_hyperlink(o),2!=o.code&&i.messages.unshift(o),i.ViewableMessage=i.messages.slice(i.ViewMsgIndex,i.ViewMsgIndex+i.ViewCount),i.modulate_chatmsg(0,i.ViewableMessage.length)}),i.ShowRecentMsg=i.messages.length>i.ViewMsgIndex+i.ViewCount,i.next_cursor=a.next_cursor,i.prev_cursor=a.prev_cursor,i.pullable=!0,i.nakama.saveListedMessage(i.messages,i.info,i.isOfficial,i.target)})}catch{if(3==i.info.redirect.type&&i.nakama.groups[i.isOfficial][i.target]&&i.nakama.groups[i.isOfficial][i.target][i.info.group_id]&&!i.nakama.groups[i.isOfficial][i.target][i.info.group_id].open){let o=[{content:{msg:[{text:i.lang.text.ChatRoom.closed_group_must_online}]}},{content:{msg:[{text:i.lang.text.ChatRoom.closed_group_not_allow}]}}];return i.next_cursor=void 0,i.isHistoryLoaded=!0,void o.forEach(c=>{2!=c.code&&i.messages.push(c)})}i.LoadLocalChatHistory()}else{let a=i.messages.length-i.ViewMsgIndex-i.ViewCount;i.ShowRecentMsg=0!=a,i.ViewMsgIndex+=Math.min(i.RefreshCount,a),i.ViewableMessage=i.messages.slice(i.ViewMsgIndex,i.ViewMsgIndex+i.ViewCount);for(let o=i.ViewableMessage.length-1;o>=0;o--){try{i.ViewableMessage[o].content.path=`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${i.ViewableMessage[o].message_id}.${i.ViewableMessage[o].content.file_ext}`;let c=yield i.indexed.loadBlobFromUserPath(i.ViewableMessage[o].content.path,i.ViewableMessage[o].content.file_ext),u=URL.createObjectURL(c);i.global.modulate_thumbnail(i.ViewableMessage[o].content,u)}catch{}i.modulate_chatmsg(o,i.ViewableMessage.length)}i.pullable=!0}})()}SpeechReceivedMessage(t){let i=JSON.parse(JSON.stringify(t.content.msg)),a="";for(let o=0,c=i.length;o<c;o++)for(let u=0,h=i[o].length;u<h;u++)a+=i[o][u].text+" ";this.SpeechThese.push(a),this.isSpeeching||this.SpeechingTexts()}SpeechingTexts(){var t=this;return(0,p.Z)(function*(){let i=t.SpeechThese.shift();t.isSpeeching=!0,yield M.speak({text:i,lang:t.lang.lang}),t.SpeechThese.length?t.SpeechingTexts():t.isSpeeching=!1})()}LoadLocalChatHistory(){var t=this;return(0,p.Z)(function*(){if(t.ViewMsgIndex>0){let i=Math.min(t.ViewableMessage.length,Math.min(t.ViewMsgIndex,t.RefreshCount));t.ViewMsgIndex-=i,t.ViewableMessage=t.messages.slice(t.ViewMsgIndex,t.ViewMsgIndex+t.ViewCount);for(let a=i-1;a>=0;a--){try{t.ViewableMessage[a].content.path=`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/files/msg_${t.ViewableMessage[a].message_id}.${t.ViewableMessage[a].content.file_ext}`;let o=yield t.indexed.loadBlobFromUserPath(t.ViewableMessage[a].content.path,t.ViewableMessage[a].content.file_ext),c=URL.createObjectURL(o);t.global.modulate_thumbnail(t.ViewableMessage[a].content,c)}catch{}t.modulate_chatmsg(a,i+1)}return t.ShowRecentMsg=t.messages.length>t.ViewMsgIndex+t.ViewCount,t.pullable=0!=t.ViewMsgIndex||!!t.LocalHistoryList.length,void(t.ViewableMessage.length<t.RefreshCount&&t.LoadLocalChatHistory())}t.isHistoryLoaded?t.indexed.loadTextFromUserPath(t.LocalHistoryList.pop(),function(){var i=(0,p.Z)(function*(a,o){if(a&&o){let c=JSON.parse(o.trim());for(let h=c.length-1;h>=0;h--)t.nakama.translate_updates(c[h]),c[h]=t.nakama.modulation_channel_message(c[h],t.isOfficial,t.target),t.nakama.ModulateTimeDate(c[h]),2!=c[h].code&&t.messages.unshift(c[h]);t.ViewMsgIndex=Math.max(0,c.length-t.RefreshCount),t.ViewableMessage=t.messages.slice(t.ViewMsgIndex,t.ViewMsgIndex+t.ViewCount);let u=Math.min(Math.min(c.length,t.RefreshCount),t.ViewableMessage.length);for(let h=u-1;h>=0;h--){try{t.ViewableMessage[h].content.path=`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/files/msg_${t.ViewableMessage[h].message_id}.${t.ViewableMessage[h].content.file_ext}`;let x=yield t.indexed.loadBlobFromUserPath(t.ViewableMessage[h].content.path,t.ViewableMessage[h].content.file_ext),b=URL.createObjectURL(x);t.global.modulate_thumbnail(t.ViewableMessage[h].content,b)}catch{}t.modulate_chatmsg(h,u)}t.ShowRecentMsg=t.messages.length>t.ViewMsgIndex+t.ViewCount}else a&&t.LoadLocalChatHistory();t.pullable=!!t.LocalHistoryList.length});return function(a,o){return i.apply(this,arguments)}}()):t.indexed.GetFileListFromDB(`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/chats/`,i=>{t.LocalHistoryList=i,t.isHistoryLoaded=!0,t.LocalHistoryList.length&&t.indexed.loadTextFromUserPath(t.LocalHistoryList.pop(),function(){var a=(0,p.Z)(function*(o,c){if(o&&c){let u=JSON.parse(c.trim());for(let h=u.length-1;h>=0;h--)t.nakama.translate_updates(u[h]),t.info.local||(u[h]=t.nakama.modulation_channel_message(u[h],t.isOfficial,t.target)),t.nakama.ModulateTimeDate(u[h]),2!=u[h].code&&t.messages.unshift(u[h]);t.ViewMsgIndex=Math.max(0,t.messages.length-t.RefreshCount),t.ViewableMessage=t.messages.slice(t.ViewMsgIndex,t.ViewMsgIndex+t.RefreshCount),t.modulate_chatmsg(0,u.length);for(let h=t.ViewableMessage.length-1;h>=0;h--){try{t.ViewableMessage[h].content.path=`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/files/msg_${t.ViewableMessage[h].message_id}.${t.ViewableMessage[h].content.file_ext}`;let x=yield t.indexed.loadBlobFromUserPath(t.ViewableMessage[h].content.path,t.ViewableMessage[h].content.file_ext),b=URL.createObjectURL(x);t.global.modulate_thumbnail(t.ViewableMessage[h].content,b)}catch{}t.modulate_chatmsg(h,t.ViewableMessage.length)}t.ViewableMessage.length<t.RefreshCount&&t.LoadLocalChatHistory()}t.next_cursor=null,t.pullable=!0});return function(o,c){return a.apply(this,arguments)}}())})})()}open_ext_with_delay(){this.ScrollNearLogs(),this.isHidden=!this.isHidden}make_ext_hidden(){this.ScrollNearLogs(),"DesktopPWA"!=N.n$&&(this.isHidden=!0)}ScrollNearLogs(){this.NeedScrollDown()&&(this.ChatLogs.scrollTo({top:this.ChatLogs.scrollHeight,behavior:"smooth"}),setTimeout(()=>{this.ChatLogs.scrollTo({top:this.ChatLogs.scrollHeight,behavior:"smooth"})},150))}ResizeTextArea(){this.userInputTextArea.style.height=this.isIphone?"60px":"36px"}check_key(t){this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId)),"DesktopPWA"==N.n$?"Enter"!=t.key||t.shiftKey||"keydown"!=t.type?setTimeout(()=>{this.ResizeTextArea(),this.userInputTextArea.style.height=this.userInputTextArea.scrollHeight+"px"},0):this.send(!0):setTimeout(()=>{this.ResizeTextArea(),this.userInputTextArea.style.height=this.userInputTextArea.scrollHeight+"px"},0)}send(t=!1){var i=this;return(0,p.Z)(function*(){if(t&&("Android"==N.n$||"iOS"==N.n$))return;if(i.userInputTextArea||(i.userInputTextArea=document.getElementById(i.ChannelUserInputId)),!i.userInput.text.trim()&&!i.userInput.file&&!i.userInput.quickShare)return void setTimeout(()=>{i.userInput.text="",i.ResizeTextArea()},0);i.userInputTextArea.focus(),i.isHidden=!0;let a={};a.msg=i.userInput.text;let o=!1,c=!1,u="";if(i.userInput.file){a.filename=i.userInput.file.filename,a.file_ext=i.userInput.file.file_ext,a.type=i.userInput.file.type;try{a.filesize=i.userInput.file.size||i.userInput.file.blob.size,a.partsize=Math.ceil(a.filesize/W.In)}catch{a.url=i.userInput.file.url,c=!0}a.msg.length>800?(u=a.msg,delete a.msg):a.msg=a.msg,a.content_creator=i.userInput.file.content_creator,a.content_related_creator=i.userInput.file.content_related_creator,o=!0;for(let x=0,b=a.content_related_creator.length;x<b;x++)delete a.content_related_creator[x].is_me,delete a.content_related_creator[x].timeDisplay,delete a.content_related_creator[x].various_display}else if(a.msg.length>800)return void i.LongTextMessageAsFile(a);i.userInput.quickShare&&(a.quickShare=i.userInput.quickShare),a.local_comp=Math.random();let h={content:JSON.parse(JSON.stringify(a))};if(i.nakama.content_to_hyperlink(h),i.info.local){let x=(new Date).getTime().toString();if(o&&!c){let y=`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${x}.${i.userInput.file.file_ext}`;yield i.indexed.saveBlobToUserPath(i.userInput.file.blob,y)}delete i.userInput.quickShare,delete i.userInput.file,u&&(a.msg=u,i.LongTextMessageAsFile(a));let b=(new Date).toISOString(),$={channel_id:i.info.id,code:0,color:"888",...h,create_time:b,update_time:b,sender_id:"local",message_id:x,user_display_name:i.nakama.users.self.display_name,is_me:!0};i.SendLocalMessage($)}else{i.sending_msg.push(h);try{yield i.nakama.servers[i.isOfficial][i.target].socket.writeChatMessage(i.info.id,a).then(x=>{o&&!c&&i.indexed.saveBlobToUserPath(i.userInput.file.blob,`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${x.message_id}.${i.userInput.file.file_ext}`,()=>{i.auto_open_thumbnail({content:a,message_id:x.message_id})}),delete i.userInput.quickShare,delete i.userInput.file,i.userInput.text="",i.ResizeTextArea(),i.inputPlaceholder=i.lang.text.ChatRoom.input_placeholder,u&&(a.msg=u,i.LongTextMessageAsFile(a))})}catch(x){3===x.code?i.p5toast.show({text:i.lang.text.ChatRoom.FailedToJoinChannel}):(console.log("\uc624\ub958 \uac80\ud1a0 \ud544\uc694: ",x),i.p5toast.show({text:`${i.lang.text.ChatRoom.FailedToSend}: ${x.message}`})),setTimeout(()=>{i.userInput.text="",i.ResizeTextArea()},0),setTimeout(()=>{for(let b=i.sending_msg.length-1;b>=0;b--)i.sending_msg[b].content.local_comp==a.local_comp&&i.sending_msg.splice(b,1)},1500)}}})()}SendLocalMessage(t){let i=this.deserialize_text(t);this.nakama.ModulateTimeDate(t),this.nakama.channels_orig[this.isOfficial][this.target][t.channel_id].last_comment_time=t.update_time,this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].last_comment_id=t.message_id,this.nakama.rearrange_channels(),this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].update(t),this.nakama.saveListedMessage([t],this.info,this.isOfficial,this.target),this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].last_comment=(t.content.filename?`(${this.lang.text.ChatRoom.attachments}) `:"")+(i||t.content.noti||(t.content.match?this.lang.text.ChatRoom.JoinWebRTCMatch:void 0)||""),this.nakama.save_channels_with_less_info(),setTimeout(()=>{this.userInput.text="",this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId)),this.ResizeTextArea(),this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder},0)}LongTextMessageAsFile(t){var i=this;return(0,p.Z)(function*(){let a=new Blob([t.msg]);yield i.indexed.saveBlobToUserPath(a,`tmp_files/chatroom/${i.lang.text.ChatRoom.LongText}_${t.msg.substring(0,10)}.txt`);let o={};o.blob=a,o.content_related_creator=[{user_id:i.info.local?"local":i.nakama.servers[i.isOfficial][i.target].session.user_id,timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"long_text"}],o.content_creator={user_id:i.info.local?"local":i.nakama.servers[i.isOfficial][i.target].session.user_id,timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"long_text"};let c=t.msg.substring(0,24);o.path=`tmp_files/chatroom/${i.lang.text.ChatRoom.LongText}_${c}~.txt`,o.file_ext="txt",o.filename=`[${i.lang.text.ChatRoom.LongText}] ${c}~.txt`,i.global.set_viewer_category_from_ext(o),o.type="text/plain",o.typeheader="text",delete t.msg,delete i.userInput.quickShare,delete i.userInput.file,i.userInput.text="",i.ResizeTextArea(),i.inputPlaceholder=i.lang.text.ChatRoom.input_placeholder,i.userInput.file=o,i.inputPlaceholder=`(${i.lang.text.ChatRoom.attachments}: ${i.userInput.file.filename})`,i.create_selected_thumbnail(),i.p5toast.show({text:i.lang.text.ChatRoom.CreateAsTextFile})})()}SetOtherAct(){this.isOtherAct=!0,setTimeout(()=>{this.isOtherAct=!1},0)}message_detail(t,i){var a=this;return(0,p.Z)(function*(){if(a.isOtherAct||"offline"==a.info.status||"missing"==a.info.status||!t.is_me)return;let c,o=a.deserialize_text(t);if(t.content.viewer){try{if("image"!=t.content.viewer)throw"\uc774\ubbf8\uc9c0 \ud30c\uc77c\uc774 \uc544\ub2d8";let b=yield a.indexed.loadBlobFromUserPath(t.content.path,t.content.type);c=URL.createObjectURL(b)}catch{try{let $=yield a.indexed.loadBlobFromUserPath(`${t.content.path}_thumbnail.png`,t.content.type);c=URL.createObjectURL($)}catch{}}o=`(${a.lang.text.ChatRoom.attachments}) ${o}`}let u=c?`<div style="text-align: center;">${o}</div>`:`<div>${o}</div>`;var b;a.alertCtrl.create({header:a.lang.text.ChatRoom.ManageChat,message:new U.Wy(c?`<div style="width: 100%;"><img src="${c}" alt="${t.content.filename}" style="border-radius: 8px; max-height: 230px; position: relative; left: 50%; transform: translateX(-50%); ${a.info.HideAutoThumbnail?"filter: blur(6px);":""}"></div>`+u:u),buttons:[{text:a.lang.text.ChatRoom.EditChat,handler:()=>{var b;a.alertCtrl.create({header:a.lang.text.ChatRoom.EditChat,inputs:[{type:"textarea",value:o,placeholder:o}],buttons:[{text:a.lang.text.ChatRoom.EditChat,handler:(b=(0,p.Z)(function*($){let y=$[0]||o,Y=!1,V=JSON.parse(JSON.stringify(t));if(V.content.msg=y,V.content.edited=!0,V.update_time=(new Date).toISOString(),a.info.local)Y=!0;else try{yield a.nakama.servers[a.isOfficial][a.target].socket.updateChatMessage(a.info.id,t.message_id,V.content),Y=!0}catch(ae){console.log("\uba54\uc2dc\uc9c0 \ud3b8\uc9d1 \uc694\uccad \uc624\ub958: ",ae)}Y&&(V.code=1,a.info.local&&(a.nakama.content_to_hyperlink(V),a.SendLocalMessage(V)))}),function(y){return b.apply(this,arguments)})}]}).then(b=>{b.onWillDismiss().then(()=>{a.ionViewDidEnter()}),a.removeShortCutKey(),b.present()})}},{text:a.lang.text.UserFsDir.Delete,cssClass:"red_font",handler:(b=(0,p.Z)(function*(){let $=!1;if(a.info.local){if(c)try{let y=`servers/${a.isOfficial}/${a.target}/channels/${a.info.id}/files/msg_${t.message_id}.${t.content.file_ext}`;yield a.indexed.removeFileFromUserPath(y),yield a.indexed.removeFileFromUserPath(`${y}_thumbnail.png`),$=!0}catch{}}else try{if(yield a.nakama.servers[a.isOfficial][a.target].socket.removeChatMessage(a.info.id,t.message_id),c){let y=yield a.loadingCtrl.create({message:a.lang.text.UserFsDir.DeleteFile});y.present();for(let V=0;V<t.content.partsize;V++)yield a.nakama.servers[a.isOfficial][a.target].client.deleteStorageObjects(a.nakama.servers[a.isOfficial][a.target].session,{object_ids:[{collection:`file_${t.channel_id.replace(/[.]/g,"_")}`,key:`msg_${t.message_id}_${V}`}]}),y.message=`${a.lang.text.UserFsDir.DeleteFile}: ${t.content.filename}_${t.content.partsize-V}`;let Y=`servers/${a.isOfficial}/${a.target}/channels/${a.info.id}/files/msg_${t.message_id}.${t.content.file_ext}`;yield a.indexed.removeFileFromUserPath(Y),yield a.indexed.removeFileFromUserPath(`${Y}_thumbnail.png`),y.dismiss()}$=!0}catch(y){console.error("\ucc44\ub110 \uba54\uc2dc\uc9c0 \uc0ad\uc81c \uc624\ub958: ",y)}if($){a.ViewableMessage.splice(i,1);for(let y=0,Y=a.messages.length;y<Y;y++)if(a.messages[y].message_id==t.message_id){a.messages.splice(y,1);break}t.code=2,a.SendLocalMessage(t);for(let y=a.ViewableMessage.length-1;y>=0;y--)a.modulate_chatmsg(y,a.ViewableMessage.length);a.p5toast.show({text:a.lang.text.ChatRoom.MsgRemoved})}}),function(){return b.apply(this,arguments)})}]}).then(b=>{b.onDidDismiss().then(()=>{URL.revokeObjectURL(c),a.isOtherAct=!1}),b.present()})})()}deserialize_text(t){let i="";for(let a=0,o=t.content.msg.length;a<o;a++){for(let c=0,u=t.content.msg[a].length;c<u;c++)i+=t.content.msg[a][c].text;a+1<o&&(i+="\n")}return i}file_detail(t){var i=this;return(0,p.Z)(function*(){if(i.isOtherAct=!0,t.content.url)return t.content.thumbnail=t.content.url,void i.open_viewer(t,t.content.url);let a=`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${t.message_id}.${t.content.file_ext}`;try{if(!(yield i.indexed.checkIfFileExist(`${a}.history`)))throw"\uc378\ub124\uc77c \uc5f4\uae30";t.content.text=[i.lang.text.TodoDetail.WIP];let c=yield i.indexed.loadTextFromUserPath(`${a}.history`),u=JSON.parse(c);switch(delete t.content.text,u.type){case"upload":if(t.content.text=[i.lang.text.ChatRoom.uploading],i.nakama.WriteStorage_From_channel(t,a,i.isOfficial,i.target,u.index),t.content.transfer_index&&i.nakama.OnTransfer[i.isOfficial][i.target][t.channel_id][t.message_id].OnTransfer)throw"\uc804\uc1a1\uc791\uc5c5 \uc911, \uc378\ub124\uc77c \uc5f4\uae30";break;case"download":t.content.text=[i.lang.text.TodoDetail.WIP],yield i.nakama.ReadStorage_From_channel(t,a,i.isOfficial,i.target,u.index),i.NeedScrollDown()&&setTimeout(()=>{i.scroll_down_logs()},100)}}catch{(yield i.indexed.checkIfFileExist(a))?(t.content.text||(t.content.text=[i.lang.text.ChatRoom.downloaded]),i.indexed.loadBlobFromUserPath(a,t.content.type,u=>{t.content.path=a;let h=URL.createObjectURL(u);i.global.modulate_thumbnail(t.content,h),i.NeedScrollDown()&&setTimeout(()=>{i.scroll_down_logs()},100)}),i.open_viewer(t,a)):i.isHistoryLoaded||(t.content.text=[i.lang.text.TodoDetail.WIP],yield i.nakama.ReadStorage_From_channel(t,a,i.isOfficial,i.target),i.NeedScrollDown()&&setTimeout(()=>{i.scroll_down_logs()},400))}i.isOtherAct=!1})()}quickShare_act(t){var i=this;return(0,p.Z)(function*(){i.modalCtrl.create({component:Z.y,componentProps:{data:t.content.quickShare}}).then(a=>a.present())})()}JoinWebRTCMatch(t){this.nakama.JoinWebRTCMatch(t,this.isOfficial,this.target,this.info)}modulate_chatmsg(t,i){if(0!=i){this.ViewableMessage[t].showInfo||(this.ViewableMessage[t].showInfo={}),this.ViewableMessage[t].showInfo.date=!!this.ViewableMessage[t].msgDate,this.ViewableMessage[t].showInfo.sender=!this.ViewableMessage[t].content.noti,t-1>=0&&(this.ViewableMessage[t].showInfo.date=!!this.ViewableMessage[t].msgDate&&this.ViewableMessage[t].msgDate!=this.ViewableMessage[t-1].msgDate,this.ViewableMessage[t].showInfo.sender=!this.ViewableMessage[t].content.noti&&(this.ViewableMessage[t-1].isLastRead||this.ViewableMessage[t].sender_id!=this.ViewableMessage[t-1].sender_id||this.ViewableMessage[t-1].content.noti||this.ViewableMessage[t].msgDate!=this.ViewableMessage[t-1].msgDate||this.ViewableMessage[t].msgTime!=this.ViewableMessage[t-1].msgTime)),this.ViewableMessage[t].content.url&&("image"==this.ViewableMessage[t].content.viewer?this.ViewableMessage[t].content.thumbnail=this.ViewableMessage[t].content.url:delete this.ViewableMessage[t].content.thumbnail);try{t+1<i&&(this.ViewableMessage[t+1].showInfo.date=!!this.ViewableMessage[t].msgDate&&this.ViewableMessage[t].msgDate!=this.ViewableMessage[t+1].msgDate,this.ViewableMessage[t+1].showInfo.sender=!this.ViewableMessage[t+1].content.noti&&(this.ViewableMessage[t].isLastRead||this.ViewableMessage[t].sender_id!=this.ViewableMessage[t+1].sender_id||this.ViewableMessage[t].content.noti||this.ViewableMessage[t].msgDate!=this.ViewableMessage[t+1].msgDate||this.ViewableMessage[t].msgTime!=this.ViewableMessage[t+1].msgTime))}catch{}}}ModulateFileEmbedMessage(t){let i=`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${t.message_id}.${t.content.file_ext}`;t.content.path=i;try{t.content.transfer_index=this.nakama.OnTransfer[this.isOfficial][this.target][t.channel_id][t.message_id]}catch{}t.content.transfer_index||this.indexed.checkIfFileExist(`${i}.history`,a=>{a&&this.indexed.loadTextFromUserPath(`${i}.history`,(o,c)=>{if(o&&c){let u=JSON.parse(c);delete t.content.text,this.nakama.OnTransfer[this.isOfficial]||(this.nakama.OnTransfer[this.isOfficial]={}),this.nakama.OnTransfer[this.isOfficial][this.target]||(this.nakama.OnTransfer[this.isOfficial][this.target]={}),this.nakama.OnTransfer[this.isOfficial][this.target][t.channel_id]||(this.nakama.OnTransfer[this.isOfficial][this.target][t.channel_id]={}),this.nakama.OnTransfer[this.isOfficial][this.target][t.channel_id][t.message_id]||(this.nakama.OnTransfer[this.isOfficial][this.target][t.channel_id][t.message_id]={index:t.content.partsize-u.index}),t.content.transfer_index=this.nakama.OnTransfer[this.isOfficial][this.target][t.channel_id][t.message_id]}})}),this.global.set_viewer_category(t.content),this.indexed.checkIfFileExist(i,a=>{a&&(t.content.text=[this.lang.text.ChatRoom.downloaded],this.indexed.loadBlobFromUserPath(i,t.content.type,o=>{t.content.path=i;let c=URL.createObjectURL(o);this.global.modulate_thumbnail(t.content,c),this.NeedScrollDown()&&setTimeout(()=>{this.scroll_down_logs()},100)}))})}toggle_thumbnail(){var t=this;return(0,p.Z)(function*(){t.info.HideAutoThumbnail=!t.info.HideAutoThumbnail,t.nakama.save_channels_with_less_info()})()}open_viewer(t,i){var a=this;let o=[];for(let c=0,u=this.messages.length;c<u;c++)this.messages[c].content.filename&&o.push(this.messages[c]);this.lock_modal_open||(this.lock_modal_open=!0,this.removeShortCutKey(),this.modalCtrl.create({component:X.B,componentProps:{info:t,path:i,alt_path:i,isOfficial:this.isOfficial,target:this.target,targetDB:this.indexed.ionicDB,relevance:o,local:this.info.local},cssClass:"fullscreen"}).then(c=>{c.onDidDismiss().then(u=>{if(this.ionViewDidEnter(),u.data)switch(u.data.type){case"image":let h=[];if(u.data.msg.content.content_related_creator&&(h=[...u.data.msg.content.content_related_creator]),u.data.msg.content.content_creator){let x=!1;for(let b=0,$=h.length;b<$;b++)if(h[b].user_id==u.data.msg.content.content_creator.user_id){x=!0;break}x||h.push(u.data.msg.content.content_creator)}return void this.modalCtrl.create({component:G.$,componentProps:{path:u.data.path||i,width:u.data.width,height:u.data.height,text:u.data.text},cssClass:"fullscreen"}).then(x=>{x.onWillDismiss().then(function(){var b=(0,p.Z)(function*($){$.data&&(yield a.voidDraw_fileAct_callback($,h))});return function($){return b.apply(this,arguments)}}()),x.present()});case"text":this.selected_blobFile_callback_act(u.data.blob,u.data.contentRelated,"textedit")}this.noti.Current=this.info.cnoti_id,this.info.cnoti_id&&this.noti.ClearNoti(this.info.cnoti_id),this.noti.RemoveListener(`openchat${this.info.cnoti_id}`)}),this.noti.Current="IonicViewerPage",c.present(),this.nakama.removeBanner(),this.lock_modal_open=!1}))}voidDraw_fileAct_callback(t,i){var a=this;return(0,p.Z)(function*(){try{a.userInput.file={},a.userInput.file.filename=t.data.name,a.userInput.file.file_ext="png",a.userInput.file.thumbnail=a.sanitizer.bypassSecurityTrustUrl(t.data.img),a.userInput.file.type="image/png",a.userInput.file.typeheader="image",i?(a.userInput.file.content_related_creator=i,a.userInput.file.content_creator={user_id:a.info.local?"local":a.nakama.servers[a.isOfficial][a.target].session.user_id,timestamp:(new Date).getTime(),display_name:a.nakama.users.self.display_name,various:"voidDraw"}):(a.userInput.file.content_related_creator=[{user_id:a.info.local?"local":a.nakama.servers[a.isOfficial][a.target].session.user_id,timestamp:(new Date).getTime(),display_name:a.nakama.users.self.display_name,various:"voidDraw"}],a.userInput.file.content_creator={user_id:a.info.local?"local":a.nakama.servers[a.isOfficial][a.target].session.user_id,timestamp:(new Date).getTime(),display_name:a.nakama.users.self.display_name,various:"voidDraw"}),yield a.indexed.saveBase64ToUserPath(t.data.img,`tmp_files/chatroom/${a.userInput.file.filename}`,o=>{a.userInput.file.blob=new Blob([o],{type:a.userInput.file.type})}),a.inputPlaceholder=`(${a.lang.text.ChatRoom.attachments}: ${a.userInput.file.filename})`}catch(o){console.error("godot-\uc774\ubbf8\uc9c0 \ud3b8\uc9d1 \uc0ac\uc6a9 \ubd88\uac00: ",o)}t.data.loadingCtrl.dismiss()})()}user_detail(t){this.lock_modal_open||(this.isOtherAct=!0,this.lock_modal_open=!0,t.is_me?this.modalCtrl.create({component:O.Y,componentProps:{isOfficial:this.info.server.isOfficial,target:this.info.server.target}}).then(i=>{i.onDidDismiss().then(a=>{this.isOtherAct=!1,this.ionViewDidEnter(),this.noti.Current=this.info.cnoti_id,this.info.cnoti_id&&this.noti.ClearNoti(this.info.cnoti_id),this.noti.RemoveListener(`openchat${this.info.cnoti_id}`)}),this.noti.Current="GroupServerPage",i.present(),this.lock_modal_open=!1}):this.modalCtrl.create({component:B.r,componentProps:{info:{user:this.nakama.load_other_user(t.sender_id,this.isOfficial,this.target)},group:this.info,has_admin:!1}}).then(i=>{i.onDidDismiss().then(a=>{this.isOtherAct=!1,this.noti.Current=this.info.cnoti_id,this.info.cnoti_id&&this.noti.ClearNoti(this.info.cnoti_id),this.noti.RemoveListener(`openchat${this.info.cnoti_id}`)}),this.noti.Current="OthersProfilePage",i.present(),this.lock_modal_open=!1}))}ionViewWillLeave(){this.nakama.rearrange_channels(),this.nakama.channels_orig[this.isOfficial][this.target]&&this.nakama.channels_orig[this.isOfficial][this.target][this.info.id]&&delete this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].update,this.noti.Current=void 0,this.removeShortCutKey()}removeShortCutKey(){delete this.global.p5key.KeyShortCut.Escape,delete this.global.p5key.KeyShortCut.BottomTab,delete this.global.p5key.KeyShortCut.Digit,delete this.global.p5key.KeyShortCut.EnterAct}ngOnDestroy(){delete this.nakama.opened_page_info.channel,this.nakama.ChatroomLinkAct=void 0,this.p5canvas&&this.p5canvas.remove(),this.nakama.OnTransferMessage={}}}return(l=d).\u0275fac=function(t){return new(t||l)(e.Y36(R.IN),e.Y36(R.SH),e.Y36(m.gz),e.Y36(m.F0),e.Y36(v.a),e.Y36(P.J),e.Y36(g.g),e.Y36(f.H),e.Y36(C.b),e.Y36(k.H7),e.Y36(W.AN),e.Y36(R.HT),e.Y36(A.V),e.Y36(H.F),e.Y36(ie.T),e.Y36(R.Br),e.Y36(R.t4))},l.\u0275cmp=e.Xpm({type:l,selectors:[["app-chat-room"]],decls:45,vars:22,consts:[[1,"ion-no-border"],["slot","start"],["defaultHref","portal/subscribes"],["class","top_icon","slot","end","name","eye-outline",3,"click",4,"ngIf"],["class","top_icon","slot","end","name","eye-off-outline",3,"click",4,"ngIf"],[1,"header_online_circle"],["id","p5Drop_chatroom",2,"position","absolute","width","100%","height","100%","display","flex","pointer-events","none"],["id","main_table",2,"width","100%","height","100%","background-color","var(--chatroom-background)"],[2,"height","100%"],[2,"vertical-align","top"],["id","chatroom_div",1,"main",2,"max-width","100vw"],["button","",3,"disabled","click"],[3,"click",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"thumnails"],["class","thumnail_parts",3,"click",4,"ngIf"],["class","thumnail_parts",4,"ngIf"],["id","input_table",2,"width","100%","background-color","var(--chatroom-input-background)"],["fill","clear",1,"ion-text-center",3,"disabled","click"],["name","add"],[2,"width","100%","vertical-align","bottom"],[1,"TextAreaInput",3,"id","ngModel","placeholder","ngModelChange","keyup","keydown","click"],[4,"ngIf"],["fill","clear","expand","block",3,"disabled","click"],["name","send"],["id","ext_menu",3,"hidden"],[1,"expanded"],["hidden","","type","file","id","local_channel","accept","image/*",3,"change"],["hidden","","type","file","accept","*","multiple","",3,"id","change"],["style","display: inline-block;",4,"ngFor","ngForOf"],["slot","end","name","eye-outline",1,"top_icon",3,"click"],["slot","end","name","eye-off-outline",1,"top_icon",3,"click"],[3,"click"],["style","text-align: center; font-size: 16px; padding-top: 8px;",4,"ngIf"],["class","message_form",4,"ngIf"],["class","quickShare_form",3,"click",4,"ngIf"],["class","file_message_form",4,"ngIf"],["class","notice_form",4,"ngIf"],["class","message_content_form",4,"ngIf"],["class","read_last_here",4,"ngIf"],[2,"text-align","center","font-size","16px","padding-top","8px"],["color","#888"],[1,"message_form"],[1,"message_span_form",3,"click"],[3,"color"],[1,"time_form"],[1,"quickShare_form",3,"click"],[1,"file_message_form"],["class","file_button",3,"style","click",4,"ngIf"],["class","file_name_form",3,"click",4,"ngIf"],["class","transfer_count",4,"ngIf"],[1,"file_button",3,"click"],[1,"file_info"],["class","text_seperator",4,"ngIf"],["class","file_info file_text_thumbnail",4,"ngFor","ngForOf"],[1,"text_seperator"],[1,"file_info","file_text_thumbnail"],[1,"file_name_form",3,"click"],[1,"file_thumbnail",3,"src","alt"],[1,"transfer_count"],[1,"notice_form"],[1,"notice"],[1,"message_content_form"],["style","color: #888; font-size: 12px;",4,"ngIf"],[3,"style","click",4,"ngIf"],["target","_system",3,"href","click",4,"ngIf"],["target","_system",3,"href","click"],[2,"color","#888","font-size","12px"],[1,"read_last_here"],["class","file_button",3,"style",4,"ngIf"],["class","file_name_form",4,"ngIf"],[1,"file_button"],[1,"file_name_form"],["class","comp_local_content",3,"click",4,"ngIf"],["class","comp_local_content","target","_system",3,"href","click",4,"ngIf"],[1,"comp_local_content",3,"click"],["target","_system",1,"comp_local_content",3,"href","click"],[1,"thumnail_parts",3,"click"],[2,"padding","8px","text-align","center"],[1,"thumnail_parts"],[3,"click",4,"ngIf"],[2,"text-align","center","margin-top","4px"],["style","display: grid;","class","thumnail_parts",4,"ngIf"],["id","ChatroomSelectedImage","class","image_thumbnail",3,"src","alt",4,"ngIf"],["id","ChatroomSelectedImage",1,"image_thumbnail",3,"src","alt"],[1,"thumnail_parts",2,"display","grid"],[2,"text-align","center","padding","4px 0px"],[1,"bottom_thumbnail"],["fill","clear","expand","block",3,"click"],["name","mic-outline"],[2,"display","inline-block"],[1,"ext_button",3,"hidden","click"],["slot","icon-only","style","width: 36px; height: 36px;",3,"name",4,"ngIf"],["class","ext_icon_img",3,"src","alt",4,"ngIf"],["slot","icon-only",2,"width","36px","height","36px",3,"name"],[1,"ext_icon_img",3,"src","alt"]],template:function(t,i){1&t&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),e._uU(3),e.qZA(),e.TgZ(4,"ion-buttons",1),e._UZ(5,"ion-back-button",2),e.qZA(),e.YNc(6,se,1,0,"ion-icon",3),e.YNc(7,oe,1,0,"ion-icon",4),e._UZ(8,"div",5),e.qZA()(),e.TgZ(9,"ion-content"),e._UZ(10,"div",6),e.TgZ(11,"table",7)(12,"tr",8)(13,"td",9)(14,"div",10)(15,"ion-item",11),e.NdJ("click",function(){return i.pull_msg_history()}),e.TgZ(16,"ion-label"),e._uU(17),e.qZA()(),e.YNc(18,Ie,9,8,"div",12),e.YNc(19,De,4,3,"div",13),e.qZA(),e.TgZ(20,"table",14),e.YNc(21,Le,4,1,"tr",15),e.YNc(22,He,3,1,"tr",16),e.YNc(23,Ye,3,1,"tr",15),e.YNc(24,Ge,6,4,"tr",15),e.qZA()()(),e.TgZ(25,"tr")(26,"td")(27,"div")(28,"table",17)(29,"tr")(30,"td")(31,"ion-button",18),e.NdJ("click",function(){return i.open_ext_with_delay()}),e._UZ(32,"ion-icon",19),e.qZA()(),e.TgZ(33,"td",20)(34,"textarea",21),e.NdJ("ngModelChange",function(o){return i.userInput.text=o})("keyup",function(o){return i.check_key(o)})("keydown",function(o){return i.check_key(o)})("click",function(){return i.make_ext_hidden()}),e.qZA()(),e.YNc(35,We,3,0,"td",22),e.TgZ(36,"td")(37,"ion-button",23),e.NdJ("click",function(){return i.send(!1)}),e._UZ(38,"ion-icon",24),e.qZA()()()()()()(),e.TgZ(39,"tr",25)(40,"td")(41,"div",26)(42,"input",27),e.NdJ("change",function(o){return i.LocalChannelImageChanged(o)}),e.qZA(),e.TgZ(43,"input",28),e.NdJ("change",function(o){return i.inputFileSelected(o)}),e.qZA(),e.YNc(44,et,4,5,"div",29),e.qZA()()()()()),2&t&&(e.xp6(3),e.Oqu(i.info.title||i.lang.text.ChatRoom.noname_chatroom),e.xp6(3),e.Q6J("ngIf",!i.info.HideAutoThumbnail),e.xp6(1),e.Q6J("ngIf",i.info.HideAutoThumbnail),e.xp6(1),e.Akn("background-color: "+i.statusBar.colors[i.info.status||"offline"]),e.xp6(7),e.Q6J("disabled",void 0===i.next_cursor&&!i.ViewMsgIndex||!i.pullable),e.xp6(2),e.Oqu(i.lang.text.ChatRoom.fetch_previous_chat),e.xp6(1),e.Q6J("ngForOf",i.ViewableMessage),e.xp6(1),e.Q6J("ngForOf",i.sending_msg),e.xp6(2),e.Q6J("ngIf",i.userInput.quickShare),e.xp6(1),e.Q6J("ngIf",i.userInput.file),e.xp6(1),e.Q6J("ngIf",i.ShowGoToBottom&&!i.last_message_viewer.user_id),e.xp6(1),e.Q6J("ngIf",i.last_message_viewer.user_id),e.xp6(7),e.Q6J("disabled","offline"==((i.info.status?i.info.status:i.info.info.status)||"offline")),e.xp6(3),e.Q6J("id",i.ChannelUserInputId)("ngModel",i.userInput.text)("placeholder",i.inputPlaceholder),e.xp6(1),e.Q6J("ngIf",i.isMobile),e.xp6(2),e.Q6J("disabled",!i.info.status||"missing"==i.info.status||"offline"==i.info.status),e.xp6(2),e.Q6J("hidden",i.isHidden),e.xp6(4),e.Q6J("id",i.file_sel_id),e.xp6(1),e.Q6J("ngForOf",i.extended_buttons))},dependencies:[L.sg,L.O5,n.Fj,n.JJ,n.On,R.oU,R.YG,R.Sm,R.W2,R.Gu,R.gu,R.Ie,R.Q$,R.wd,R.sr,R.cs],styles:[".top_icon[_ngcontent-%COMP%]{width:28px;height:28px;padding-right:68px;cursor:pointer}.main[_ngcontent-%COMP%]{width:100%;height:100%;padding:8px;overflow-x:hidden;overflow-y:auto;scroll-behavior:smooth}.message_form[_ngcontent-%COMP%]{margin:8px 0 0}.message_span_form[_ngcontent-%COMP%]{margin-right:8px}.time_form[_ngcontent-%COMP%]{font-size:12px;color:#888}.file_message_form[_ngcontent-%COMP%]{display:flex}.file_name_form[_ngcontent-%COMP%]{margin-top:4px;max-width:192px;max-height:192px}.file_thumbnail[_ngcontent-%COMP%]{max-width:192px;max-height:192px;width:auto;height:auto;border-radius:8px}.file_info[_ngcontent-%COMP%]{margin:0 4px}.file_text_thumbnail[_ngcontent-%COMP%]{margin-top:2px;display:grid}.quickShare_form[_ngcontent-%COMP%]{border-radius:16px;max-width:156px;width:-moz-fit-content;width:fit-content;height:-moz-fit-content;height:fit-content;padding:8px;margin:8px 0;text-align:center;vertical-align:middle;word-break:keep-all;overflow:hidden;background-color:var(--chatroom-you-read-here-backgruond)}.message_content_form[_ngcontent-%COMP%]{margin:4px 0 0}.comp_local_content[_ngcontent-%COMP%]{color:#888}.text_seperator[_ngcontent-%COMP%]{background-color:#fff;margin-top:2px;position:relative;width:100%;height:2px}.expanded[_ngcontent-%COMP%]{height:240px;overflow-x:hidden;overflow-y:auto;scroll-behavior:smooth;text-align:center;background-color:var(--chatroom-input-background)}.ext_button[_ngcontent-%COMP%]{width:64px;height:48px;margin:24px 12px 0;text-align:center}.ext_button_icon[_ngcontent-%COMP%]{width:72px;height:72px}.file_button[_ngcontent-%COMP%]{width:160px;height:112px;overflow:hidden;background-color:gray;margin-top:4px;border-radius:8px}#send_thumbnail[_ngcontent-%COMP%]{width:100%;max-width:100vw;height:-moz-fit-content;height:fit-content;max-height:160px;transform:translateY(-100%);position:relative;background:rgba(187,187,187,.7333333333);padding:8px;overflow:hidden}.bottom_thumbnail[_ngcontent-%COMP%]{width:100%;max-width:100vw;max-height:96px;overflow:hidden;padding:8px}.image_thumbnail[_ngcontent-%COMP%]{width:auto;max-height:96px;height:auto;object-fit:contain;display:block;margin:auto;padding:8px}.thumnails[_ngcontent-%COMP%]{width:100%;height:-moz-fit-content;height:fit-content;position:relative;transform:translateY(-100%);background:var(--chatroom-last-msg-viewer-bg);padding:8px}.thumnail_parts[_ngcontent-%COMP%]{max-height:96px;overflow-y:scroll;max-width:100vw}.transfer_count[_ngcontent-%COMP%]{align-self:flex-end;margin-left:4px}.notice_form[_ngcontent-%COMP%]{text-align:center;margin:12px}.notice[_ngcontent-%COMP%]{font-size:12px;display:inline;background:#444;border-radius:8px;padding:4px 8px;color:#fff}.read_last_here[_ngcontent-%COMP%]{text-align:center;font-size:12px;display:inherit;background:var(--chatroom-you-read-here-backgruond);margin:4px 0;color:var(--chatroom-you-read-here-text)}.ext_icon_img[_ngcontent-%COMP%]{max-width:36px;max-height:36px}.md[_ngcontent-%COMP%]   .TextAreaInput[_ngcontent-%COMP%]{width:100%;height:36px;max-height:156px;resize:none;padding:6px;margin-top:5px;border:0;overflow:hidden;background-color:var(--chatroom-input-background)}.ios[_ngcontent-%COMP%]   .TextAreaInput[_ngcontent-%COMP%]{width:100%;height:60px;max-height:156px;resize:none;padding:6px;margin-top:5px;border:0;overflow:hidden;background-color:var(--chatroom-input-background)}"]}),d})()},{path:"ionic-viewer",loadChildren:()=>_.e(1277).then(_.bind(_,1277)).then(l=>l.IonicViewerPageModule)},{path:"void-draw",loadChildren:()=>_.e(4139).then(_.bind(_,4139)).then(l=>l.VoidDrawPageModule)},{path:"quick-share-review",loadChildren:()=>_.e(3556).then(_.bind(_,3556)).then(l=>l.QuickShareReviewPageModule)}];let it=(()=>{var l;class d{}return(l=d).\u0275fac=function(t){return new(t||l)},l.\u0275mod=e.oAB({type:l}),l.\u0275inj=e.cJS({imports:[m.Bz.forChild(tt),m.Bz]}),d})(),nt=(()=>{var l;class d{}return(l=d).\u0275fac=function(t){return new(t||l)},l.\u0275mod=e.oAB({type:l}),l.\u0275inj=e.cJS({imports:[L.ez,n.u5,R.Pc,it]}),d})()},5470:(z,E,_)=>{_.d(E,{y:()=>e});var L=_(5861),n=_(9468),R=_(3857),m=_(1325),p=_(9080),U=_(9376),j=_(6052),B=_(6814),N=_(95);function X(v,P){1&v&&n._UZ(0,"ion-icon",16)}function G(v,P){1&v&&n._UZ(0,"ion-icon",17)}function W(v,P){if(1&v){const g=n.EpF();n.TgZ(0,"ion-accordion",7)(1,"ion-item",8),n.YNc(2,X,1,0,"ion-icon",9),n.YNc(3,G,1,0,"ion-icon",10),n.TgZ(4,"ion-label"),n._uU(5),n.qZA()(),n.TgZ(6,"div",11)(7,"ion-item",4),n.NdJ("click",function(){const k=n.CHM(g).$implicit;return n.KtG(k.grant=!k.grant)}),n.TgZ(8,"ion-toggle",12),n.NdJ("ngModelChange",function(C){const A=n.CHM(g).$implicit;return n.KtG(A.grant=C)}),n._uU(9),n.qZA()(),n.TgZ(10,"ion-item",13)(11,"ion-label"),n._uU(12),n.qZA(),n.TgZ(13,"ion-label",14),n._uU(14),n.qZA()(),n.TgZ(15,"ion-item",13)(16,"ion-label"),n._uU(17),n.qZA(),n.TgZ(18,"ion-label",14),n._uU(19),n.qZA()(),n.TgZ(20,"ion-item",13)(21,"ion-label"),n._uU(22),n.qZA(),n.TgZ(23,"ion-label",14),n._uU(24),n.qZA()(),n.TgZ(25,"ion-item",13)(26,"ion-toggle",15),n.NdJ("ngModelChange",function(C){const A=n.CHM(g).$implicit;return n.KtG(A.value.isSSL=C)}),n._uU(27),n.qZA()()()()}if(2&v){const g=P.$implicit,f=P.index,C=n.oxw(2);n.Q6J("value",f),n.xp6(2),n.Q6J("ngIf",!g.grant),n.xp6(1),n.Q6J("ngIf",g.grant),n.xp6(2),n.Oqu(g.value.name),n.xp6(3),n.Q6J("ngModel",g.grant),n.xp6(1),n.Oqu(C.lang.text.QuickShareReview.QuickShareGrant),n.xp6(3),n.Oqu(C.lang.text.GroupServer.Address),n.xp6(2),n.Oqu(g.value.address),n.xp6(3),n.Oqu(C.lang.text.GroupServer.Port),n.xp6(2),n.Oqu(g.value.port||7350),n.xp6(3),n.Oqu(C.lang.text.GroupServer.Key),n.xp6(2),n.Oqu(g.value.key||"defaultkey"),n.xp6(2),n.Q6J("ngModel",g.value.isSSL),n.xp6(1),n.Oqu(C.lang.text.GroupServer.isSSL)}}function ee(v,P){if(1&v&&(n.TgZ(0,"div")(1,"ion-item-divider")(2,"ion-label"),n._uU(3),n.qZA()(),n.TgZ(4,"ion-accordion-group"),n.YNc(5,W,28,14,"ion-accordion",6),n.qZA()()),2&v){const g=n.oxw();n.xp6(3),n.Oqu(g.lang.text.QuickShareReview.Servers),n.xp6(2),n.Q6J("ngForOf",g.servers)}}function K(v,P){1&v&&n._UZ(0,"ion-icon",16)}function O(v,P){1&v&&n._UZ(0,"ion-icon",17)}function J(v,P){if(1&v){const g=n.EpF();n.TgZ(0,"ion-accordion",7)(1,"ion-item",8),n.YNc(2,K,1,0,"ion-icon",9),n.YNc(3,O,1,0,"ion-icon",10),n.TgZ(4,"ion-label"),n._uU(5),n.qZA()(),n.TgZ(6,"div",11)(7,"ion-item",4),n.NdJ("click",function(){const k=n.CHM(g).$implicit;return n.KtG(k.grant=!k.grant)}),n.TgZ(8,"ion-toggle",12),n.NdJ("ngModelChange",function(C){const A=n.CHM(g).$implicit;return n.KtG(A.grant=C)}),n._uU(9),n.qZA()()()()}if(2&v){const g=P.$implicit,f=P.index,C=n.oxw(2);n.Q6J("value",f),n.xp6(2),n.Q6J("ngIf",!g.grant),n.xp6(1),n.Q6J("ngIf",g.grant),n.xp6(2),n.Oqu(g.name),n.xp6(3),n.Q6J("ngModel",g.grant),n.xp6(1),n.Oqu(C.lang.text.QuickShareReview.QuickShareGrant)}}function Z(v,P){if(1&v&&(n.TgZ(0,"div")(1,"ion-item-divider")(2,"ion-label"),n._uU(3),n.qZA()(),n.TgZ(4,"ion-accordion-group"),n.YNc(5,J,10,6,"ion-accordion",6),n.qZA()()),2&v){const g=n.oxw();n.xp6(3),n.Oqu(g.lang.text.QuickShareReview.Channels),n.xp6(2),n.Q6J("ngForOf",g.groups)}}function w(v,P){1&v&&n._UZ(0,"ion-icon",16)}function T(v,P){1&v&&n._UZ(0,"ion-icon",17)}function M(v,P){if(1&v&&(n.TgZ(0,"ion-item")(1,"ion-label"),n._uU(2),n.qZA()()),2&v){const g=P.$implicit;n.xp6(2),n.Oqu(g)}}function Q(v,P){if(1&v){const g=n.EpF();n.TgZ(0,"ion-accordion",7)(1,"ion-item",8),n.YNc(2,w,1,0,"ion-icon",9),n.YNc(3,T,1,0,"ion-icon",10),n.TgZ(4,"ion-label"),n._uU(5),n.qZA()(),n.TgZ(6,"div",11),n.YNc(7,M,3,1,"ion-item",18),n.TgZ(8,"ion-item",4),n.NdJ("click",function(){const k=n.CHM(g).$implicit;return n.KtG(k.grant=!k.grant)}),n.TgZ(9,"ion-toggle",12),n.NdJ("ngModelChange",function(C){const A=n.CHM(g).$implicit;return n.KtG(A.grant=C)}),n._uU(10),n.qZA()()()()}if(2&v){const g=P.$implicit,f=P.index,C=n.oxw(2);n.Q6J("value",f),n.xp6(2),n.Q6J("ngIf",!g.grant),n.xp6(1),n.Q6J("ngIf",g.grant),n.xp6(2),n.Oqu(g.value.urls[0]),n.xp6(2),n.Q6J("ngForOf",g.value.urls),n.xp6(2),n.Q6J("ngModel",g.grant),n.xp6(1),n.Oqu(C.lang.text.QuickShareReview.QuickShareGrant)}}function te(v,P){if(1&v&&(n.TgZ(0,"div")(1,"ion-item-divider")(2,"ion-label"),n._uU(3),n.qZA()(),n.TgZ(4,"ion-accordion-group"),n.YNc(5,Q,11,7,"ion-accordion",6),n.qZA()()),2&v){const g=n.oxw();n.xp6(3),n.Oqu(g.lang.text.QuickShareReview.Channels),n.xp6(2),n.Q6J("ngForOf",g.rtcserver)}}let e=(()=>{var v;class P{constructor(f,C,k,A,H,ie){this.lang=f,this.navParams=C,this.modalCtrl=k,this.nakama=A,this.p5toast=H,this.global=ie,this.servers=[],this.groups=[],this.rtcserver=[]}ngOnInit(){var f=this;return(0,L.Z)(function*(){let C=f.navParams.get("data"),k=f.global.CatchGETs(C),A=yield f.nakama.AddressToQRCodeAct(k,!0);for(let H=0,ie=A.length;H<ie;H++)switch(A[H].type){case"server":f.servers.push(A[H]);break;case"group":f.groups.push(A[H]);break;case"rtcserver":f.rtcserver.push(A[H])}})()}apply_selected(){var f=this;return(0,L.Z)(function*(){let C=[];for(let k=0,A=f.servers.length;k<A;k++)f.servers[k].grant&&C.push(f.servers[k]);for(let k=0,A=f.groups.length;k<A;k++)f.groups[k].grant&&C.push(f.groups[k]);for(let k=0,A=f.rtcserver.length;k<A;k++)f.rtcserver[k].grant&&C.push(f.rtcserver[k]);yield f.nakama.act_from_QRInfo(C),f.p5toast.show({text:f.lang.text.QuickQRShare.success_received,lateable:!0}),f.modalCtrl.dismiss()})()}}return(v=P).\u0275fac=function(f){return new(f||v)(n.Y36(R.b),n.Y36(m.X1),n.Y36(m.IN),n.Y36(p.a),n.Y36(U.F),n.Y36(j.AN))},v.\u0275cmp=n.Xpm({type:v,selectors:[["app-quick-share-review"]],decls:14,vars:5,consts:[[1,"ion-no-border"],["slot","start",3,"click"],["defaultHref",""],[4,"ngIf"],["button","",3,"click"],[1,"ion-text-center"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["slot","header"],["color","danger","slot","start","name","close-outline",4,"ngIf"],["color","success","slot","start","name","checkmark-outline",4,"ngIf"],["slot","content"],[1,"ion_toggle_ignore",3,"ngModel","ngModelChange"],["button",""],[1,"ion-text-end"],["disabled","",1,"ion_toggle_ignore",3,"ngModel","ngModelChange"],["color","danger","slot","start","name","close-outline"],["color","success","slot","start","name","checkmark-outline"],[4,"ngFor","ngForOf"]],template:function(f,C){1&f&&(n.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),n._uU(3),n.qZA(),n.TgZ(4,"ion-buttons",1),n.NdJ("click",function(){return C.modalCtrl.dismiss()}),n._UZ(5,"ion-back-button",2),n.qZA()()(),n.TgZ(6,"ion-content"),n.YNc(7,ee,6,2,"div",3),n.YNc(8,Z,6,2,"div",3),n.YNc(9,te,6,2,"div",3),n.qZA(),n.TgZ(10,"ion-footer")(11,"ion-item",4),n.NdJ("click",function(){return C.apply_selected()}),n.TgZ(12,"ion-label",5),n._uU(13),n.qZA()()()),2&f&&(n.xp6(3),n.Oqu(C.lang.text.QuickShareReview.Title),n.xp6(4),n.Q6J("ngIf",C.servers.length),n.xp6(1),n.Q6J("ngIf",C.groups.length),n.xp6(1),n.Q6J("ngIf",C.rtcserver.length),n.xp6(4),n.Oqu(C.lang.text.QuickShareReview.ApplyChecked))},dependencies:[B.sg,B.O5,N.JJ,N.On,m.We,m.eh,m.oU,m.Sm,m.W2,m.fr,m.Gu,m.gu,m.Ie,m.rH,m.Q$,m.wd,m.ho,m.sr,m.w,m.cs],styles:[".ion_toggle_ignore[_ngcontent-%COMP%]{pointer-events:none}"]}),P})()}}]);