(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8744],{8744:(Se,De,h)=>{"use strict";h.d(De,{K:()=>Ze});var r=h(1528),ae=h(5193),ee=h(9352),re=h(896),Pe=h(2272),we=h(7668),t=h(4496),G=h(5624),Ee=h(9240),N=h(4668),he=h(4500),B=h(544),K=h(3824),ne=h(5020),xe=h(7136),be=h(7756),ke=h(6819),Ge=h(1368),y=h(4716);const m=["FileMenu"],I=["ShowContentInfoIonic"];function P(s,O){if(1&s){const a=t.KQA();t.I0R(0,"ion-icon",22),t.qCj("click",function(){t.usT(a);const n=t.GaO();return t.CGJ(n.AutoPlayNext=!n.AutoPlayNext)}),t.C$Y()}}function F(s,O){if(1&s){const a=t.KQA();t.I0R(0,"ion-icon",23),t.qCj("click",function(){t.usT(a);const n=t.GaO();return t.CGJ(n.AutoPlayNext=!n.AutoPlayNext)}),t.C$Y()}}function R(s,O){if(1&s){const a=t.KQA();t.I0R(0,"ion-icon",24),t.qCj("click",function(){t.usT(a);const n=t.GaO();return t.CGJ(n.ChangeToAnother(-1))}),t.C$Y()}}function w(s,O){if(1&s&&(t.I0R(0,"ion-label",25),t.OEk(1),t.C$Y()),2&s){const a=t.GaO();t.yG2(),t.cNF(a.RelevanceIndex+" / "+a.Relevances.length)}}function E(s,O){if(1&s){const a=t.KQA();t.I0R(0,"ion-icon",26),t.qCj("click",function(){t.usT(a);const n=t.GaO();return t.CGJ(n.ChangeToAnother(1))}),t.C$Y()}}function Z(s,O){if(1&s&&(t.I0R(0,"ion-label",27),t.OEk(1),t.C$Y()),2&s){const a=t.GaO();t.yG2(),t.cNF(a.FileInfo.filename||a.FileInfo.name)}}function se(s,O){if(1&s){const a=t.KQA();t.I0R(0,"ion-input",28),t.iHE("ngModelChange",function(n){t.usT(a);const o=t.GaO();return t.kNx(o.NewTextFileName,n)||(o.NewTextFileName=n),t.CGJ(n)}),t.C$Y()}if(2&s){const a=t.GaO();t.OKB("ngModel",a.NewTextFileName),t.E7m("placeholder",a.FileInfo.filename||a.FileInfo.name)}}function $(s,O){if(1&s){const a=t.KQA();t.I0R(0,"ion-button",29),t.qCj("click",function(){t.usT(a);const n=t.GaO();return t.CGJ(n.close_text_edit())}),t.wR5(1,"ion-icon",30),t.C$Y()}}function ve(s,O){if(1&s){const a=t.KQA();t.I0R(0,"ion-button",29),t.qCj("click",function(){t.usT(a);const n=t.GaO();return t.CGJ(n.SaveText())}),t.wR5(1,"ion-icon",31),t.C$Y()}}function ie(s,O){if(1&s){const a=t.KQA();t.I0R(0,"ion-button",32),t.qCj("click",function(){t.usT(a);const n=t.GaO();return t.CGJ(n.DownloadAllListFiles())}),t.wR5(1,"ion-icon",33),t.C$Y()}if(2&s){const a=t.GaO();t.E7m("disabled",a.isDownloading||a.MessageInfo.content.transfer_index&&"download"==a.MessageInfo.content.transfer_index.OnTransfer)}}function Q(s,O){1&s&&(t.I0R(0,"ion-button",34),t.wR5(1,"ion-icon",35),t.C$Y())}function oe(s,O){if(1&s){const a=t.KQA();t.I0R(0,"ion-item",39),t.qCj("click",function(){t.usT(a);const n=t.GaO(3);return t.CGJ(n.open_text_editor())}),t.I0R(1,"ion-label"),t.OEk(2),t.C$Y()()}if(2&s){const a=t.GaO(3);t.yG2(2),t.cNF(a.lang.text.ContentViewer.EditText)}}function me(s,O){if(1&s){const a=t.KQA();t.I0R(0,"ion-item",39),t.qCj("click",function(){t.usT(a);const n=t.GaO(3);return t.CGJ(n.modify_image())}),t.I0R(1,"ion-label"),t.OEk(2),t.C$Y()()}if(2&s){const a=t.GaO(3);t.yG2(2),t.cNF(a.lang.text.ContentViewer.Edit)}}function le(s,O){if(1&s){const a=t.KQA();t.I0R(0,"ion-item",39),t.qCj("click",function(){t.usT(a);const n=t.GaO(3);return t.CGJ(n.ShareContent())}),t.I0R(1,"ion-label"),t.OEk(2),t.C$Y()()}if(2&s){const a=t.GaO(3);t.yG2(2),t.cNF(a.lang.text.ContentViewer.ShareContent)}}function _e(s,O){if(1&s){const a=t.KQA();t.I0R(0,"ion-item",39),t.qCj("click",function(){t.usT(a);const n=t.GaO(3);return t.CGJ(n.download_file())}),t.I0R(1,"ion-label"),t.OEk(2),t.C$Y()()}if(2&s){const a=t.GaO(3);t.yG2(2),t.cNF(a.lang.text.ContentViewer.Download)}}function g(s,O){if(1&s){const a=t.KQA();t.I0R(0,"ion-item",39),t.qCj("click",function(){t.usT(a);const n=t.GaO(3);return t.CGJ(n.RemoveFile())}),t.I0R(1,"ion-label"),t.OEk(2),t.C$Y()()}if(2&s){const a=t.GaO(3);t.yG2(2),t.cNF(a.lang.text.ContentViewer.RemoveFile)}}function k(s,O){if(1&s){const a=t.KQA();t.I0R(0,"ion-content")(1,"ion-list"),t.yuY(2,oe,3,1,"ion-item",38)(3,me,3,1,"ion-item",38),t.I0R(4,"ion-item",39),t.qCj("click",function(){t.usT(a);const n=t.GaO(2);return t.CGJ(n.open_bottom_modal())}),t.I0R(5,"ion-label"),t.OEk(6),t.C$Y()(),t.yuY(7,le,3,1,"ion-item",38)(8,_e,3,1,"ion-item",38)(9,g,3,1,"ion-item",38),t.C$Y()()}if(2&s){const a=t.GaO(2);t.yG2(2),t.E7m("ngIf",!a.NeedDownloadFile&&"text"==a.FileInfo.viewer),t.yG2(),t.E7m("ngIf",!a.NeedDownloadFile&&"audio"!=a.FileInfo.viewer),t.yG2(3),t.cNF(a.lang.text.ContentViewer.ContentInfo),t.yG2(),t.E7m("ngIf",!a.NeedDownloadFile),t.yG2(),t.E7m("ngIf",!a.NeedDownloadFile),t.yG2(),t.E7m("ngIf",!a.NeedDownloadFile&&a.OpenInChannelChat&&!a.FileInfo.url)}}function M(s,O){1&s&&(t.I0R(0,"ion-popover",36,37),t.yuY(2,k,10,6,"ng-template"),t.C$Y())}function D(s,O){if(1&s&&(t.I0R(0,"div")(1,"div",41),t.wR5(2,"ion-icon",42),t.I0R(3,"div")(4,"ion-label",43),t.OEk(5),t.C$Y()()()()),2&s){const a=t.GaO(2);t.yG2(5),t.cNF(a.lang.text.ContentViewer.OnLoadContent)}}function q(s,O){if(1&s&&(t.I0R(0,"td"),t.yuY(1,D,6,1,"div",19),t.wR5(2,"div",40),t.C$Y()),2&s){const a=t.GaO();t.yG2(),t.E7m("ngIf",!a.ContentOnLoad)}}function ce(s,O){if(1&s){const a=t.KQA();t.I0R(0,"td")(1,"ion-grid")(2,"ion-row",44)(3,"ion-col",45)(4,"ion-button",46),t.qCj("click",function(){t.usT(a);const n=t.GaO();return t.CGJ(n.DownloadCurrentFile())}),t.OEk(5),t.C$Y()()()()()}if(2&s){const a=t.GaO();t.yG2(4),t.E7m("disabled",a.isDownloading||a.MessageInfo.content.transfer_index&&"download"==a.MessageInfo.content.transfer_index.OnTransfer),t.yG2(),t.oRS(" ",a.MessageInfo.content.transfer_index&&"download"==a.MessageInfo.content.transfer_index.OnTransfer?a.lang.text.ContentViewer.FileDownloading:a.lang.text.ContentViewer.DownloadThisFile," ")}}function Re(s,O){if(1&s){const a=t.KQA();t.I0R(0,"ion-item",39),t.qCj("click",function(){t.usT(a);const n=t.GaO(2);return t.CGJ(n.copy_url(n.content_creator.user_id))}),t.I0R(1,"ion-label"),t.OEk(2),t.C$Y(),t.I0R(3,"ion-label",48),t.OEk(4),t.C$Y()()}if(2&s){const a=t.GaO(2);t.yG2(2),t.cNF(a.lang.text.ContentInfo.LastPost),t.yG2(2),t.oRS(" ",a.content_creator.publisher||a.content_creator.display_name||a.lang.text.Profile.noname_user,"")}}function Oe(s,O){if(1&s&&(t.I0R(0,"ion-item",51)(1,"ion-label"),t.OEk(2),t.C$Y(),t.I0R(3,"ion-label",48),t.OEk(4),t.C$Y()()),2&s){const a=t.GaO(2);t.yG2(2),t.cNF(a.lang.text.ContentInfo.SourceFrom),t.yG2(2),t.cNF(a.content_creator.various_display)}}function fe(s,O){if(1&s&&(t.I0R(0,"ion-item")(1,"ion-label"),t.OEk(2),t.C$Y(),t.I0R(3,"ion-label",48),t.OEk(4),t.C$Y()()),2&s){const a=t.GaO(2);t.yG2(2),t.cNF(a.lang.text.ContentInfo.FileSize),t.yG2(2),t.cNF(a.CurrentFileSize)}}function ue(s,O){1&s&&t.wR5(0,"ion-icon",60)}function Ce(s,O){1&s&&t.wR5(0,"ion-icon",61)}function je(s,O){1&s&&t.wR5(0,"ion-icon",62)}function He(s,O){1&s&&t.wR5(0,"ion-icon",63)}function Ke(s,O){1&s&&t.wR5(0,"ion-icon",64)}function ze(s,O){1&s&&t.wR5(0,"ion-icon",65)}function Xe(s,O){1&s&&(t.I0R(0,"ion-avatar"),t.wR5(1,"img",66),t.C$Y())}function Je(s,O){if(1&s){const a=t.KQA();t.I0R(0,"div")(1,"div",52),t.OEk(2),t.I0R(3,"ion-chip",53),t.qCj("click",function(){const o=t.usT(a).$implicit,d=t.GaO(2);return t.CGJ(d.toast_info(o))}),t.yuY(4,ue,1,0,"ion-icon",54)(5,Ce,1,0,"ion-icon",55)(6,je,1,0,"ion-icon",56)(7,He,1,0,"ion-icon",57)(8,Ke,1,0,"ion-icon",58)(9,ze,1,0,"ion-icon",59)(10,Xe,2,0,"ion-avatar",19),t.I0R(11,"ion-label"),t.OEk(12),t.C$Y()()()()}if(2&s){const a=O.$implicit,e=t.GaO(2);t.yG2(2),t.oRS(" ",a.timeDisplay," "),t.yG2(2),t.E7m("ngIf","loaded"==a.various),t.yG2(),t.E7m("ngIf","camera"==a.various),t.yG2(),t.E7m("ngIf","link"==a.various),t.yG2(),t.E7m("ngIf","long_text"==a.various),t.yG2(),t.E7m("ngIf","textedit"==a.various),t.yG2(),t.E7m("ngIf","shared"==a.various),t.yG2(),t.E7m("ngIf","voidDraw"==a.various),t.yG2(2),t.cNF(a.publisher||a.display_name||e.lang.text.Profile.noname_user)}}function Qe(s,O){if(1&s){const a=t.KQA();t.I0R(0,"ion-content")(1,"ion-item-divider")(2,"ion-label"),t.OEk(3),t.C$Y()(),t.yuY(4,Re,5,2,"ion-item",38)(5,Oe,5,2,"ion-item",47)(6,fe,5,2,"ion-item",19),t.I0R(7,"ion-item")(8,"ion-label"),t.OEk(9),t.C$Y(),t.I0R(10,"ion-label",48),t.OEk(11),t.C$Y()(),t.I0R(12,"ion-item-divider")(13,"ion-label"),t.OEk(14),t.C$Y()(),t.yuY(15,Je,13,9,"div",49),t.I0R(16,"ion-item",39),t.qCj("click",function(){t.usT(a),t.GaO();const n=t.Gew(27);return t.CGJ(n.dismiss())}),t.I0R(17,"ion-label",50),t.OEk(18),t.C$Y()()()}if(2&s){const a=t.GaO();t.yG2(3),t.cNF(a.lang.text.ContentInfo.WorkLogs),t.yG2(),t.E7m("ngIf",!a.FromUserFsDir),t.yG2(),t.E7m("ngIf",a.content_creator.various),t.yG2(),t.E7m("ngIf",!a.FileInfo.url),t.yG2(3),t.cNF(a.lang.text.ContentInfo.TimeAt),t.yG2(2),t.cNF(a.content_creator.timeDisplay),t.yG2(3),t.cNF(a.lang.text.ContentInfo.WorkHistory),t.yG2(),t.E7m("ngForOf",a.content_related_creator),t.yG2(3),t.cNF(a.lang.text.ContentInfo.CloseModal)}}const qe=()=>[.5,1];let Ze=(()=>{var s;class O{constructor(e,n,o,d,i,l,_,A,p,v,f,b){this.modalCtrl=e,this.navParams=n,this.indexed=o,this.lang=d,this.file=i,this.p5toast=l,this.alertCtrl=_,this.loadingCtrl=A,this.global=p,this.nakama=v,this.mClipboard=f,this.noti=b,this.useP5Navigator=!0,this.RelevanceIndex=0,this.HaveRelevances=!1,this.NeedDownloadFile=!1,this.ContentOnLoad=!1,this.isDownloading=!1,this.OpenInChannelChat=!1,this.isChannelOnline=!0,this.fromLocalChannel=!1,this.EventListenerAct=C=>{C.detail.register(120,u=>{})},this.BackButtonPressed=!1,this.ContentChanging=!1,this.AutoPlayNext=!1,this.isTextEditMode=!1,this.NewTextFileName="",this.image_info={},this.forceWrite=!1}InitBrowserBackButtonOverride(){window.history.replaceState(null,null,window.location.href),window.onpopstate=()=>{this.BackButtonPressed||(this.BackButtonPressed=!0,this.modalCtrl.dismiss())}}ngOnInit(){var e=this;return(0,r.c)(function*(){e.InitBrowserBackButtonOverride(),e.fromLocalChannel=e.navParams.get("local"),e.MessageInfo=e.navParams.get("info"),e.OpenInChannelChat=void 0!==e.MessageInfo.code,e.CurrentViewId=e.MessageInfo.message_id,e.FileInfo=e.MessageInfo.content,e.ContentBox=document.getElementById("ContentBox"),e.FileHeader=document.getElementById("FileHeader"),e.isOfficial=e.navParams.get("isOfficial"),e.target=e.navParams.get("target");try{e.isChannelOnline="online"==e.nakama.channels_orig[e.isOfficial][e.target][e.MessageInfo.channel_id].info.status,e.isChannelOnline=e.isChannelOnline||"online"==e.nakama.channels_orig[e.isOfficial][e.target][e.MessageInfo.channel_id].status||"pending"==e.nakama.channels_orig[e.isOfficial][e.target][e.MessageInfo.channel_id].status}catch{}switch(e.FromUserFsDir=e.navParams.get("no_edit")||!1,e.FileInfo.is_new){case"code":case"text":break;default:if(e.Relevances=e.navParams.get("relevance"),e.Relevances){for(let n=0,o=e.Relevances.length;n<o;n++)if(e.Relevances[n].message_id&&e.MessageInfo.message_id){if(e.Relevances[n].message_id==e.MessageInfo.message_id){e.RelevanceIndex=n+1;break}}else if(e.Relevances[n].content.path==e.MessageInfo.content.path){e.RelevanceIndex=n+1;break}e.HaveRelevances=e.Relevances.length>1}else e.HaveRelevances=!1;e.CreateContentInfo()}})()}reinit_content_data(e){var n=this;return(0,r.c)(function*(){if(n.NewTextFileName="",n.NeedDownloadFile=!0,n.ContentOnLoad=!1,n.isTextEditMode=!1,n.MessageInfo=e,n.CurrentViewId=n.MessageInfo.message_id,n.FileInfo=n.MessageInfo.content,n.p5canvas&&n.p5canvas.remove(),n.canvasDiv=document.getElementById("content_viewer_canvas"),n.canvasDiv)for(let o=0,d=n.canvasDiv.childNodes.length;o<d;o++)n.canvasDiv.removeChild(n.canvasDiv.childNodes[o]);if(URL.revokeObjectURL(n.FileURL),n.FileInfo.url)n.CreateContentInfo(),n.NeedDownloadFile=!1,n.ContentOnLoad=!0,n.ionViewDidEnter();else{let o=n.FileInfo.path||`servers/${n.isOfficial}/${n.target}/channels/${e.channel_id}/files/msg_${e.message_id}.${e.content.file_ext}`;n.image_info.path=o,n.NeedDownloadFile=yield n.indexed.checkIfFileExist(`${o}.history`);try{n.blob=yield n.indexed.loadBlobFromUserPath(o,n.FileInfo.type),n.CreateContentInfo(),n.ionViewDidEnter()}catch{n.FileURL=void 0,n.blob=void 0,n.isDownloading=!1,n.NeedDownloadFile=!0,n.ContentOnLoad=!1,n.CreateContentInfo(),n.p5canvas&&n.p5canvas.remove(),n.p5canvas=new ee(i=>{i.setup=()=>{i.noCanvas()}}),n.ChangeContentWithKeyInput()}}})()}DownloadAllListFiles(){this.alertCtrl.create({header:this.lang.text.ContentViewer.DownloadAllFiles,message:this.lang.text.ContentViewer.DownloadLoadedList,buttons:[{text:this.lang.text.ContentViewer.DownloadThisFile,handler:()=>{this.DownloadInOrder()}}]}).then(e=>e.present())}DownloadInOrder(){var e=this;return(0,r.c)(function*(){("Android"==ae.s1||"iOS"==ae.s1)&&e.noti.noti.schedule({id:6,title:e.lang.text.ContentViewer.DownloadThisFile,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://diychat",color:"b0b0b0"});for(let n=0,o=e.Relevances.length;n<o;n++)e.nakama.OnTransfer[e.isOfficial]||(e.nakama.OnTransfer[e.isOfficial]={}),e.nakama.OnTransfer[e.isOfficial][e.target]||(e.nakama.OnTransfer[e.isOfficial][e.target]={}),e.nakama.OnTransfer[e.isOfficial][e.target][e.Relevances[n].channel_id]||(e.nakama.OnTransfer[e.isOfficial][e.target][e.Relevances[n].channel_id]={}),e.nakama.OnTransfer[e.isOfficial][e.target][e.Relevances[n].channel_id][e.Relevances[n].message_id]||(e.nakama.OnTransfer[e.isOfficial][e.target][e.Relevances[n].channel_id][e.Relevances[n].message_id]={});for(let n=0,o=e.Relevances.length;n<o;n++){("Android"==ae.s1||"iOS"==ae.s1)&&e.noti.noti.schedule({id:6,title:`${e.lang.text.ContentViewer.DownloadThisFile}: ${o-n}`,progressBar:{value:n,maxValue:o},sound:null,smallIcon:"res://diychat",color:"b0b0b0"});let d=`servers/${e.isOfficial}/${e.target}/channels/${e.Relevances[n].channel_id}/files/msg_${e.Relevances[n].message_id}.${e.Relevances[n].content.file_ext}`;if(!(yield e.indexed.checkIfFileExist(d)))try{yield e.DownloadCurrentFile(n)}catch(l){console.log(l)}}e.noti.ClearNoti(6)})()}ChangeToAnother(e){if(this.ContentChanging)return;this.ContentChanging=!0;let n=this.RelevanceIndex+e;n<=0||n>this.Relevances.length||(this.p5canvas&&this.p5canvas.remove(),this.RelevanceIndex=n,this.FileInfo={file_ext:""},this.reinit_content_data(this.Relevances[this.RelevanceIndex-1])),this.ContentChanging=!1}DownloadCurrentFile(e){var n=this;return(0,r.c)(function*(){n.isDownloading=!0;let o=0,d=n.Relevances[null!=e?e:n.RelevanceIndex-1],i=`servers/${n.isOfficial}/${n.target}/channels/${d.channel_id}/files/msg_${d.message_id}.${d.content.file_ext}`;try{let _=yield n.indexed.loadTextFromUserPath(`${i}.history`);o=JSON.parse(_).index}catch{}let l=d.message_id;yield n.nakama.ReadStorage_From_channel(d,i,n.isOfficial,n.target,o),n.CurrentViewId==l&&n.reinit_content_data(d)})()}formatBytes(e,n=2){if(!+e)return"0 Bytes";const d=n<0?0:n,l=Math.floor(Math.log(e)/Math.log(1024));return`${parseFloat((e/Math.pow(1024,l)).toFixed(d))} ${["Bytes","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"][l]}`}CreateContentInfo(){try{if(this.FileInfo.url||(this.CurrentFileSize=this.formatBytes(this.FileInfo.size||this.FileInfo.filesize||this.blob.size)),this.content_creator=this.FileInfo.content_creator||{timestamp:this.FileInfo.timestamp},this.content_creator.timeDisplay=new Date(this.content_creator.timestamp).toLocaleString(),this.content_related_creator=this.FileInfo.content_related_creator||[],this.content_creator.user_id)try{this.content_creator.is_me=this.nakama.servers[this.isOfficial][this.target].session.user_id==this.content_creator.user_id}catch{}try{this.content_creator.publisher=this.content_creator.is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_creator.user_id].display_name}catch{}this.set_various_display(this.content_creator);for(let e=0,n=this.content_related_creator.length;e<n;e++){if(this.content_related_creator[e].user_id)try{this.content_related_creator[e].is_me=this.nakama.servers[this.isOfficial][this.target].session.user_id==this.content_related_creator[e].user_id}catch{}this.content_related_creator[e].timeDisplay=new Date(this.content_related_creator[e].timestamp).toLocaleString()}}catch{}try{this.content_related_creator[0].publisher=this.content_related_creator[0].is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_related_creator[0].user_id].display_name,this.content_related_creator[0].timestamp==this.content_related_creator[1].timestamp&&(this.content_related_creator[0].publisher=this.content_related_creator[1].is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_related_creator[1].user_id].display_name,this.content_related_creator.splice(1,1))}catch{try{this.content_related_creator[0].publisher=this.content_related_creator[1].display_name,this.content_related_creator[0].timestamp==this.content_related_creator[1].timestamp&&(this.content_related_creator[0].publisher=this.content_related_creator[1].display_name,this.content_related_creator.splice(1,1))}catch{}try{this.content_related_creator[0].publisher||(this.content_related_creator[0].publisher=this.content_related_creator[0].display_name)}catch{}}try{this.content_related_creator.sort((e,n)=>e.timestamp>n.timestamp?-1:e.timestamp<n.timestamp?1:0)}catch{}}set_various_display(e){switch(e.various){case"camera":e.various_display=this.lang.text.GlobalAct.FromCamera;break;case"link":e.various_display=this.lang.text.ChatRoom.ExternalLinkFile;break;case"loaded":e.various_display=this.lang.text.GlobalAct.variousCreator;break;case"voidDraw":e.various_display=this.lang.text.GlobalAct.FromVoidDraw;break;case"long_text":e.various_display=this.lang.text.GlobalAct.FromAutoLongText;break;case"textedit":e.various_display=this.lang.text.GlobalAct.FromTextEditor;break;case"shared":e.various_display=this.lang.text.GlobalAct.SharedContent;break;default:e.various_display=this.lang.text.GlobalAct.UnknownSource}}close_text_edit(){this.FileInfo.is_new?this.modalCtrl.dismiss():this.reinit_content_data(this.MessageInfo)}ionViewDidEnter(){var e=this;return(0,r.c)(function*(){if(e.FileInfo.url)e.FileURL=e.FileInfo.url;else if(!e.FileInfo.is_new)try{e.blob=yield e.indexed.loadBlobFromUserPath(e.FileInfo.path||e.navParams.get("path"),e.FileInfo.type),e.FileURL=URL.createObjectURL(e.blob)}catch(n){console.log(n)}switch(e.forceWrite=!1,e.canvasDiv=document.getElementById("content_viewer_canvas"),null==e.canvasDiv.oncontextmenu&&(e.canvasDiv.oncontextmenu=()=>("blender"!=e.FileInfo.viewer&&e.FileMenu.present(),!1)),e.canvasDiv&&(e.canvasDiv.style.backgroundImage=""),document.removeEventListener("ionBackButton",e.EventListenerAct),e.p5canvas&&e.p5canvas.remove(),e.FileInfo.viewer){case"image":e.p5canvas=new ee(i=>{i.setup=(0,r.c)(function*(){e.canvasDiv.style.maxWidth="100%",e.canvasDiv.style.overflow="hidden",e.ContentBox.style.overflow="hidden",i.noCanvas();let T=i.createElement("img");T.elt.hidden=!0,T.elt.src=e.FileURL,T.elt.onload=()=>{e.canvasDiv.style.backgroundImage=`url('${e.FileURL}')`,e.canvasDiv.style.backgroundRepeat="no-repeat",e.image_info.width=T.elt.naturalWidth,e.image_info.height=T.elt.naturalHeight,_=i.createVector(T.elt.naturalWidth,T.elt.naturalHeight),l(),T.remove(),e.ContentOnLoad=!0},i.noLoop()});let l=()=>{if(e.image_info.width/e.image_info.height<e.canvasDiv.clientWidth/e.canvasDiv.clientHeight){let T=e.image_info.width*e.canvasDiv.clientHeight/e.image_info.height;e.canvasDiv.style.backgroundSize=`${T}px`,e.canvasDiv.style.backgroundPositionX=(e.canvasDiv.clientWidth-T)/2+"px",e.canvasDiv.style.backgroundPositionY="0px"}else e.canvasDiv.style.backgroundSize=`${e.canvasDiv.clientWidth}px`,e.canvasDiv.style.backgroundPositionX="0px",e.canvasDiv.style.backgroundPositionY=e.canvasDiv.clientHeight/2-_.y*(e.canvasDiv.clientWidth/_.x)/2+"px";de=!0};i.windowResized=()=>{setTimeout(()=>{l()},50)};let _,A=i.createVector(),p=i.createVector(),v=i.createVector(),f=1,b=()=>{e.canvasDiv.style.backgroundPositionX=`${A.x+v.x}px`,e.canvasDiv.style.backgroundPositionY=`${A.y+v.y}px`},C=(T,W)=>{let x=f,X=f*W,c=Number(e.canvasDiv.style.backgroundPositionX.split("px")[0]),U=Number(e.canvasDiv.style.backgroundPositionY.split("px")[0]),V=(x-X)*i.map(T.x,c,c+x,0,1),pe=(x-X)/_.x*_.y*i.map(T.y,U,U+x/_.x*_.y,0,1);e.canvasDiv.style.backgroundPositionX=`${c+V}px`,e.canvasDiv.style.backgroundPositionY=`${U+pe}px`,e.canvasDiv.style.backgroundSize=`${X}px`};i.mousePressed=()=>{e.useP5Navigator&&(i.mouseButton==i.CENTER&&l(),"DesktopPWA"==ae.s1&&(A=i.createVector(Number(e.canvasDiv.style.backgroundPositionX.split("px")[0]),Number(e.canvasDiv.style.backgroundPositionY.split("px")[0])),p=i.createVector(i.mouseX,i.mouseY)))},i.mouseWheel=T=>{e.useP5Navigator&&(f=Number(e.canvasDiv.style.backgroundSize.split("px")[0]),C(i.createVector(e.canvasDiv.clientWidth/2,e.canvasDiv.clientHeight/2),1-T.delta/1e3))},i.mouseDragged=()=>{e.useP5Navigator&&"DesktopPWA"==ae.s1&&(v=i.createVector(i.mouseX,i.mouseY),v.sub(p),b())};let L,u={},Y=!1,de=!0;i.touchStarted=T=>{if(e.useP5Navigator){for(let x=0,X=T.changedTouches.length;x<X;x++)u[T.changedTouches[x].identifier]=i.createVector(T.changedTouches[x].clientX,T.changedTouches[x].clientY);switch(Object.keys(u).length){case 1:A=i.createVector(Number(e.canvasDiv.style.backgroundPositionX.split("px")[0]),Number(e.canvasDiv.style.backgroundPositionY.split("px")[0])),p=u[T.changedTouches[0].identifier].copy();break;case 2:A=i.createVector(Number(e.canvasDiv.style.backgroundPositionX.split("px")[0]),Number(e.canvasDiv.style.backgroundPositionY.split("px")[0]));let x=u[0].copy();L=x.dist(u[1]),p=x.add(u[1]).div(2).copy(),f=Number(e.canvasDiv.style.backgroundSize.split("px")[0]),b();break;default:Y=!0,l()}}},i.touchMoved=T=>{if(e.useP5Navigator&&!Y){for(let x=0,X=T.changedTouches.length;x<X;x++)u[T.changedTouches[x].identifier]=i.createVector(T.changedTouches[x].clientX,T.changedTouches[x].clientY);switch(Object.keys(u).length){case 1:v=u[T.changedTouches[0].identifier].copy(),v.sub(p),de||b();break;case 2:de=!1;let x=u[0].copy(),X=x.dist(u[1]);v=x.add(u[1]).div(2).copy();let c=v.copy();v.sub(p),b(),C(c,X/L)}}},i.touchEnded=T=>{if(e.useP5Navigator&&"changedTouches"in T){for(let x=0,X=T.changedTouches.length;x<X;x++)delete u[T.changedTouches[x].identifier];switch(Object.keys(u).length){case 1:A=i.createVector(Number(e.canvasDiv.style.backgroundPositionX.split("px")[0]),Number(e.canvasDiv.style.backgroundPositionY.split("px")[0])),p=u[Object.keys(u)[0]].copy();break;case 0:de&&!Y&&(v.x>50?e.ChangeToAnother(-1):v.x<-50&&e.ChangeToAnother(1)),Y=!1}}}});break;case"audio":e.p5canvas=new ee(i=>{var l;i.setup=()=>{i.noCanvas(),i.noLoop(),(l=i.createAudio([e.FileURL],()=>{e.canvasDiv.appendChild(l.elt),l.elt.onended=()=>{e.AutoPlayNext&&e.ChangeToAnother(1)},setTimeout(()=>{_(),l.elt.hidden=!1},50),l.showControls(),l.play(),e.ContentOnLoad=!0})).elt.hidden=!0};let _=()=>{let f=e.ContentBox.offsetWidth;l.elt.setAttribute("style","position: relative; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%);"),l.size(f,25)};i.windowResized=()=>{setTimeout(()=>{_()},50)};let A=i.createVector(),p={};i.touchStarted=f=>{if(e.useP5Navigator&&!document.pictureInPictureElement&&"changedTouches"in f){for(let C=0,u=f.changedTouches.length;C<u;C++)p[f.changedTouches[C].identifier]=i.createVector(f.changedTouches[C].clientX,f.changedTouches[C].clientY);1===Object.keys(p).length&&(A=p[f.changedTouches[0].identifier].copy())}},i.touchEnded=f=>{if(e.useP5Navigator&&!document.pictureInPictureElement&&"changedTouches"in f){let b;for(let u=0,L=f.changedTouches.length;u<L;u++)b=i.createVector(f.changedTouches[u].clientX,f.changedTouches[u].clientY),delete p[f.changedTouches[u].identifier];0===Object.keys(p).length&&(b.sub(A),b.x>50?e.ChangeToAnother(-1):b.x<-50&&e.ChangeToAnother(1))}}});break;case"video":e.p5canvas=new ee(i=>{var l;i.setup=(0,r.c)(function*(){i.noCanvas(),i.noLoop(),(l=i.createVideo([e.FileURL],()=>{e.global.PIPLinkedVideoElement?(l.elt.remove(),l.elt=e.global.PIPLinkedVideoElement,l.elt.setAttribute("src",e.FileURL)):e.global.PIPLinkedVideoElement=l.elt,e.canvasDiv&&e.canvasDiv.appendChild(l.elt),l.elt.onended=()=>{e.AutoPlayNext&&e.ChangeToAnother(1)},setTimeout(()=>{e.image_info.width=l.elt.videoWidth,e.image_info.height=l.elt.videoHeight,_(),l.elt.hidden=!1},50),l.showControls(),l.play(),e.ContentOnLoad=!0})).elt.hidden=!0,i.VideoMedia=l});let _=()=>{let f=e.ContentBox.offsetWidth,b=e.ContentBox.offsetHeight-e.FileHeader.offsetHeight,C=l.elt.videoWidth,u=l.elt.videoHeight;0!=C&&0!=u&&(f/b>C/u?(u=b,C=C/l.elt.videoHeight*u,l.elt.setAttribute("style","position: relative; left: 50%; transform: translateX(-50%);")):(C=f,u=u/l.elt.videoWidth*C||b/2,l.elt.setAttribute("style","position: relative; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%);")),l.size(C,u))};i.windowResized=()=>{setTimeout(()=>{_()},50)};let A=i.createVector(),p={};i.touchStarted=f=>{if(e.useP5Navigator&&!document.pictureInPictureElement&&"changedTouches"in f){for(let C=0,u=f.changedTouches.length;C<u;C++)p[f.changedTouches[C].identifier]=i.createVector(f.changedTouches[C].clientX,f.changedTouches[C].clientY);1===Object.keys(p).length&&(A=p[f.changedTouches[0].identifier].copy())}},i.touchEnded=f=>{if(e.useP5Navigator&&!document.pictureInPictureElement&&"changedTouches"in f){let b;for(let u=0,L=f.changedTouches.length;u<L;u++)b=i.createVector(f.changedTouches[u].clientX,f.changedTouches[u].clientY),delete p[f.changedTouches[u].identifier];0===Object.keys(p).length&&(b.sub(A),b.x>50?e.ChangeToAnother(-1):b.x<-50&&e.ChangeToAnother(1))}}});break;case"code":case"text":e.p5canvas=new ee(i=>{i.setup=()=>{i.noCanvas(),i.noLoop();let l=i.createElement("textarea");l.elt.disabled=!0,l.elt.className="infobox",l.elt.setAttribute("style","height: 100%; display: block;"),l.elt.textContent="",e.canvasDiv.appendChild(l.elt),i.TextArea=l.elt,e.FileInfo.is_new?e.open_text_editor(l.elt):i.loadStrings(e.FileURL,_=>{l.elt.textContent=_.join("\n"),e.open_text_reader(i),e.ContentOnLoad=!0},_=>{e.canvasDiv.textContent=e.lang.text.ContentViewer.CannotOpenText,e.FileInfo.else=!0,e.ContentOnLoad=!0})},i.windowResized=()=>{let l=window.innerHeight-45-56;i.SyntaxHighlightReader.setAttribute("style",`height: ${l}px; display: ${e.isTextEditMode?"none":"block"}; overflow-y: scroll;`)}});break;case"godot":document.addEventListener("ionBackButton",e.EventListenerAct);let n,o=e.MessageInfo.message_id;try{let i=yield e.indexed.loadBlobFromUserPath((e.FileInfo.path||e.navParams.get("path"))+"_thumbnail.png","");n=URL.createObjectURL(i)}catch{}!e.NeedDownloadFile&&e.CurrentViewId==o&&setTimeout((0,r.c)(function*(){let i=!1;if(e.indexed.godotDB)try{let l=yield e.indexed.loadBlobFromUserPath(e.FileInfo.path||e.navParams.get("path"),"",void 0,e.indexed.ionicDB);yield e.indexed.GetGodotIndexedDB(),yield e.indexed.saveBlobToUserPath(l,"tmp_files/duplicate/viewer.pck",void 0,e.indexed.godotDB),i=!0}catch(l){console.log("\ub0b4\ubd80 \ud30c\uc77c \uc5c6\uc74c: ",l)}if(yield e.global.CreateGodotIFrame("content_viewer_canvas",{path:"tmp_files/duplicate/viewer.pck",alt_path:e.FileInfo.path||e.navParams.get("path"),ext:e.FileInfo.file_ext,url:e.FileInfo.url,background:n,receive_image:(l=(0,r.c)(function*(_,A,p){let v="tmp_files/modify_image.png";yield e.indexed.saveBase64ToUserPath(","+_,v),e.modalCtrl.dismiss({type:"image",path:v,width:A,height:p,msg:e.MessageInfo,index:e.RelevanceIndex-1})}),function(A,p,v){return l.apply(this,arguments)})},"start_load_pck"),!i){try{let l=yield e.indexed.loadBlobFromUserPath(e.FileInfo.path||e.navParams.get("path"),"",void 0,e.indexed.ionicDB);yield e.indexed.GetGodotIndexedDB(),yield e.indexed.saveBlobToUserPath(l,"tmp_files/duplicate/viewer.pck",void 0,e.indexed.godotDB)}catch{}yield e.global.CreateGodotIFrame("content_viewer_canvas",{path:"tmp_files/duplicate/viewer.pck",alt_path:e.FileInfo.path||e.navParams.get("path"),ext:e.FileInfo.file_ext,url:e.FileInfo.url,background:n,receive_image:function(){var l=(0,r.c)(function*(_,A,p){let v="tmp_files/modify_image.png";yield e.indexed.saveBase64ToUserPath(","+_,v),e.modalCtrl.dismiss({type:"image",path:v,width:A,height:p,msg:e.MessageInfo,index:e.RelevanceIndex-1})});return function(A,p,v){return l.apply(this,arguments)}}()},"start_load_pck")}var l;e.ContentOnLoad=!0,n&&URL.revokeObjectURL(n),e.FileInfo.url?e.global.godot_window.download_url():e.global.godot_window.start_load_pck()}),100);break;case"blender":let d=yield e.loadingCtrl.create({message:e.lang.text.ContentViewer.OnLoadContent});d.present(),e.p5canvas=new ee(i=>{let v,l=[],_=[],p={};i.setup=(0,r.c)(function*(){let b,f=i.createCanvas(e.canvasDiv.clientWidth,e.canvasDiv.clientHeight,i.WEBGL);f.parent(e.canvasDiv),i.canvas=f,i.textureMode(i.NORMAL),i.textureWrap(i.REPEAT),i.clear(255,255,255,0),i.pixelDensity(1);try{b=yield e.indexed.loadBlobFromUserPath(e.FileInfo.path,e.FileInfo.type||"")}catch{try{b=yield(yield fetch(e.FileInfo.url)).blob()}catch(L){console.log("\ubdf0\uc5b4\uc5d0\uc11c \ud30c\uc77c \ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",L)}}let C=i.createElement("iframe");C.elt.id="jsBlend",C.elt.setAttribute("src","assets/js.blend/index.html"),C.elt.setAttribute("frameborder","0"),C.elt.setAttribute("class","full_screen"),C.elt.setAttribute("allow","fullscreen; encrypted-media"),C.elt.setAttribute("scrolling","no"),C.elt.setAttribute("withCredentials","true"),C.elt.setAttribute("hidden","true"),e.canvasDiv.appendChild(C.elt),C.elt.contentWindow.TARGET_FILE=b,C.elt.onload=(0,r.c)(function*(){if(!b)return e.p5toast.show({text:e.lang.text.ContentViewer.CannotOpenText}),void d.dismiss();v=i.createDiv(),v.parent(e.canvasDiv),v.id("logDiv"),v.style("position","absolute"),v.style("width","100%"),v.style("height","100%"),v.style("max-height",`${e.canvasDiv.clientHeight}px`),v.style("pointer-events","none");let u=yield C.elt.contentWindow.JSBLEND(b);const L=100;let Y=u.file.AB;for(let X=0;X<u.file.objects.Object.length;X++){let c=u.file.objects.Object[X];d.message=`${e.lang.text.ContentViewer.ReadObject}: ${c.aname}`;let U=i.createVector(-c.loc[0]*L,-c.loc[2]*L,c.loc[1]*L),V=i.createVector(c.rot[0],c.rot[2],-c.rot[1]);switch(c.type){case 0:case 11:break;case 1:{let Te,pe=(c.data.vdata.layers[0]||c.data.vdata.layers).data,Fe=(c.data.edata.layers[0]||c.data.edata.layers).data,Ue=(c.data.ldata.layers[0]||c.data.ldata.layers).data;i.beginGeometry(),i.push(),i.translate(U),i.scale(c.size[0],c.size[2],c.size[1]),c.rot[0]+c.rot[1]+c.rot[2]&&(v.elt.innerHTML+=`<div style="color: var(--ion-color-warning-shade)">${c.aname}: ${e.lang.text.ContentViewer.MayGimbalLock}</div>`,i.rotate(i.HALF_PI,V));try{let j=[];for(let H=0,ye=pe.length;H<ye;H++)j.push([]);for(let H=0,ye=Fe.length;H<ye;H++){var de,z;let ge=null!==(de=Fe[H].x)&&void 0!==de?de:Fe[H].v1,J=null!==(z=Fe[H].y)&&void 0!==z?z:Fe[H].v2;j[ge].push(J),j[J].push(ge)}let Le=4==Ue.length,S=[{u:0,v:1},{u:1,v:1},{u:1,v:0},{u:0,v:0}];for(let ye,ge,H=Ue.length-1;H>=0;H--){var T,W,x;let J=Ue[H].i,Ie=null!==(T=pe[J].x)&&void 0!==T?T:pe[J].co[0],Be=null!==(W=pe[J].y)&&void 0!==W?W:pe[J].co[1],Ve=null!==(x=pe[J].z)&&void 0!==x?x:pe[J].co[2];if(void 0!==ge){try{if(!j[ge].includes(J))throw"\ub9c8\uc9c0\ub9c9 \uc810\uc73c\ub85c\ubd80\ud130 \uadf8\ub9b4 \uc218 \uc5c6\uc74c";Le?i.vertex(-Ie*L,-Ve*L,Be*L,S[H].u,S[H].v):i.vertex(-Ie*L,-Ve*L,Be*L);let We=!1;if(ge!=ye&&(We=j[J].includes(ye)),We)throw"\ub3cc\uc544\uac08 \uc218 \uc788\ub294\ub370 \ub3cc\uc544\uac00\uc9c0 \uc54a\ub294\ub2e4\uba74 \uc0c8 \uc2dc\uc791\uc810\uc73c\ub85c \uc778\uc2dd"}catch{i.endShape(i.CLOSE),ge=void 0;continue}ge=J}else i.beginShape(),Le?i.vertex(-Ie*L,-Ve*L,Be*L,S[H].u,S[H].v):i.vertex(-Ie*L,-Ve*L,Be*L),ye=J,ge=J}}catch(j){console.log("\uba54\uc26c \uc815\ubcf4 \ubd88\ub7ec\uc624\uae30 \uc624\ub958: ",j)}i.pop(),Te=i.endGeometry();let Me,Ne,$e,Ye=0;try{if(!c.data.mat.length)throw"no_mat";for(let j=0,Le=c.data.mat.length;j<Le;j++){try{let S=c.data.mat[j].nodetree.nodes.first.next.inputs.first.default_value.value;Ne=i.color(255*S[0],255*S[1],255*S[2],255*S[3])}catch(S){console.log("\ubca0\uc774\uc2a4 \uc0c9\uc0c1 \uac00\uc838\uc624\uae30 \uc2e4\ud328: ",S)}try{let S=c.data.mat[j].nodetree.nodes.first.next.inputs.last.prev.default_value.value;Ye=c.data.mat[j].nodetree.nodes.first.next.inputs.last.default_value.value,$e=i.color(255*S[0],255*S[1],255*S[2],255*S[3])}catch(S){console.log("\uc774\ubbf8\uc158 \uc815\ubcf4 \uc218\uc9d1 \uc2e4\ud328: ",S)}if(c.data.mat[j].nodetree.nodes.last.id){let S=c.data.mat[j].nodetree.nodes.last.id.packedfile;if(!S)throw"unpacked";if(p[S.data.__data_address__])throw"duplicated";Me=S.data.__data_address__;let ye=Y.slice(Me,Me+S.size),ge=new Blob([ye]),J=URL.createObjectURL(ge);i.loadImage(J,Ie=>{p[S.data.__data_address__]=Ie,v.elt.innerHTML+=`<div style="color: var(--ion-color-danger-shade)">${c.aname}: ${e.lang.text.ContentViewer.OnWorkReadUV}</div>`,URL.revokeObjectURL(J)},Ie=>{console.log("\ud14d\uc2a4\uccd0 \ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",Ie),URL.revokeObjectURL(J)})}}}catch(j){switch(j){case"unpacked":v.elt.innerHTML+=`<div style="color: var(--ion-color-warning-shade)">${c.aname}: ${e.lang.text.ContentViewer.LinkedTexFile}</div>`;break;case"duplicated":break;case"no_mat":v.elt.innerHTML+=`<div style="color: var(--ion-color-medium-shade)">${c.aname}: ${e.lang.text.ContentViewer.NoMaterial}</div>`;break;default:console.log(c.aname,"_\uc7ac\uc9c8 \uc815\ubcf4 \ubd88\ub7ec\uc624\uae30 \uc624\ub958: ",j),v.elt.innerHTML+=`<div style="color: var(--ion-color-danger-shade)">${c.aname}: ${j}</div>`}}Te.computeNormals(),_.push({id:c.data.address,name:c.data.aname,color:Ne,emissionColor:$e,emissionStrength:Ye,texture:Me,mesh:Te})}break;case 10:l.length<5?(v.elt.innerHTML+=`<div style="color: var(--ion-color-warning-shade)">${c.aname}: ${e.lang.text.ContentViewer.OnWorkReadLightMode}</div>`,l.push({type:"point",loc:U,rot:V,color:i.color(255,255,255)})):v.elt.innerHTML+=`<div style="color: var(--ion-color-medium-shade)">${c.aname}: ${e.lang.text.ContentViewer.ReachLightLimit}</div>`;break;default:v.elt.innerHTML+=`<div style="color: var(--ion-color-medium-shade)>${c.aname}: ${e.lang.text.ContentViewer.OnWorkObjectType}_${c.type}</div>`}yield new Promise(Te=>setTimeout(Te,0))}d.dismiss(),setTimeout(()=>{v.elt.remove()},8e3),e.ContentOnLoad=!0})}),i.draw=()=>{if(i.clear(255,255,255,0),i.orbitControl(),l.length)for(let f=0,b=l.length;f<b;f++)"point"===l[f].type&&i.pointLight(l[f].color,l[f].loc);else i.lights();for(let f=0,b=_.length;f<b;f++)i.push(),_[f].texture?(i.noStroke(),p[_[f].texture]&&i.texture(p[_[f].texture])):_[f].color&&(i.noStroke(),i.ambientMaterial(_[f].color)),_[f].emissionStrength&&(i.noStroke(),i.emissiveMaterial(_[f].emissionColor)),i.model(_[f].mesh),i.pop()},i.windowResized=()=>{setTimeout(()=>{e.canvasDiv.style.maxHeight=window.innerHeight-56-45+"px",v&&v.style("max-height",`${e.canvasDiv.clientHeight}px`),i.resizeCanvas(e.canvasDiv.clientWidth,e.canvasDiv.clientHeight)},50)}});break;default:console.log("\uc815\uc758\ub418\uc9c0 \uc54a\uc740 \ud30c\uc77c \uc815\ubcf4: ",e.FileInfo.viewer);case"disabled":e.p5canvas=new ee(i=>{i.setup=()=>{i.noCanvas()}}),e.ContentOnLoad=!0}e.ChangeContentWithKeyInput()})()}ChangeContentWithKeyInput(){this.p5canvas&&(this.p5canvas.keyPressed=e=>{if(!this.isTextEditMode)switch(e.code){case"KeyA":case"ArrowLeft":this.ChangeToAnother(-1);break;case"KeyS":this.download_file();break;case"KeyD":case"ArrowRight":this.ChangeToAnother(1);break;case"KeyS":this.NeedDownloadFile&&this.DownloadCurrentFile()}})}open_bottom_modal(){this.ShowContentInfoIonic.onDidDismiss().then(e=>{this.useP5Navigator=!0}),this.useP5Navigator=!1,this.ShowContentInfoIonic.present()}open_text_editor(e=this.p5canvas.TextArea){this.p5canvas.SyntaxHighlightReader.style.display="none",e.style.display="block",e.disabled=!1,setTimeout(()=>{this.isTextEditMode=!0,e.focus()},500)}open_text_reader(e=this.p5canvas){if(!e.SyntaxHighlightReader){let b=e.createDiv();b.elt.className="infobox",b.elt.setAttribute("style",`height: ${e.TextArea.clientHeight}px; display: block; overflow-y: scroll;`),this.canvasDiv.appendChild(b.elt),e.SyntaxHighlightReader=b.elt}let o=e.TextArea.textContent.split("\n");const d=["void","static","import","include","#include","using","from","as","public","protected","private","use","package","local","program","namespace","begin","end","puts","Private","Protected","Public","Sub","End","var","let","String","char","Integer","Float","Boolean","Array","NULL","Resource","strings","integer","complex","byte","ubyte","int","uint","short","ushort","long","ulong","bvec2","bvec3","bvec4","ivec2","ivec3","ivec4","uvec2","uvec3","uvec4","mat2","mat3","mat4","Vector","Vector2","Vector3","PVector","PImage","PGraphics","float","double","number","color","bool","boolean","Arary","Object","Table","TableRow","HashMap","null","undefined","data","function","func","fn","def","fun","class","extends","implements","object"],i=["final","const"],l=["for","match","switch","if","else","elif","return","continue","pass","loop","while","in","try","catch","and","or","do","then","yield"],_=["!=",">=","<=","==","<",">"],A=["#","##","\x3c!--","--\x3e","/**","*/","//"],p=["="],v=["{","}","<<",">>",":","-","(",")","[","]",">>>","->","<-","=>","<="],f=["SELECT","UPDATE","DELETE","INSERT INTO","CREATE DATABASE","ALTER DATABASE","CREATE TABLE","ALTER TABLE","DROP TABLE","CREATE INDEX","DROP INDEX","ECHO","FROM","WHERE","AND","OR","NOT","ALTER","ADD","echo","<?php","?>"];for(let b=0,C=o.length;b<C;b++){let u=e.createDiv(),Y=o[b].split(" "),de=!1;for(let z=0,T=Y.length;z<T;z++){let W=this.HTMLEncode(Y[z]),x=!1;for(let c=0,U=A.length;c<U;c++)if(Y[z]==A[c]){de=!0;break}if(!de){for(let c=0,U=p.length;c<U;c++)if(Y[z]==p[c]){let V=e.createSpan(W+"&nbsp");V.style("color","var(--syntax-text-coding-equalmark)"),V.parent(u),x=!0;break}if(x)continue;for(let c=0,U=i.length;c<U;c++)if(Y[z]==i[c]){let V=e.createSpan(W+"&nbsp");V.style("color","var(--syntax-text-coding-final)"),V.parent(u),x=!0;break}for(let c=0,U=_.length;c<U;c++)if(Y[z]==_[c]){let V=e.createSpan(W+"&nbsp");V.style("color","var(--syntax-text-coding-comparion-op)"),V.parent(u),x=!0;break}if(x||x)continue;for(let c=0,U=l.length;c<U;c++)if(Y[z]==l[c]){let V=e.createSpan(W+"&nbsp");V.style("color","var(--syntax-text-coding-operator)"),V.parent(u),x=!0;break}if(x)continue;for(let c=0,U=v.length;c<U;c++)if(Y[z]==v[c]){let V=e.createSpan(W+"&nbsp");V.style("color","var(--syntax-text-coding-spechar)"),V.parent(u),x=!0;break}if(x)continue;for(let c=0,U=f.length;c<U;c++)if(Y[z]==f[c]){let V=e.createSpan(W+"&nbsp");V.style("color","var(--syntax-text-coding-command)"),V.parent(u),x=!0;break}if(x)continue;for(let c=0,U=d.length;c<U;c++)if(Y[z]==d[c]){let V=e.createSpan(W+"&nbsp");V.style("color","var(--syntax-text-coding-basic)"),V.parent(u),x=!0;break}if(x)continue}let X=e.createSpan(W+"&nbsp");de&&X.style("color","var(--syntax-text-coding-comments)"),X.parent(u)}u.parent(e.SyntaxHighlightReader)}e.TextArea.style.display="none",e.SyntaxHighlightReader.style.display="block"}HTMLEncode(e){let n=(e=[...e]).length,o=[];for(;n--;){var d=e[n].codePointAt(0);o[n]=d<65||d>127||d>90&&d<97?"&#"+d+";":e[n]}return o.join("")}SaveText(){var e=this;return(0,r.c)(function*(){let n=new Blob([e.p5canvas.TextArea.value],{type:e.FileInfo.type});if(n.name=e.NewTextFileName||e.FileInfo.filename||e.FileInfo.name,e.OpenInChannelChat)e.modalCtrl.dismiss({type:"text",blob:n,contentRelated:e.FileInfo.content_related_creator});else{let o=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});o.present();let d=`tmp_files/texteditor/${e.FileInfo.filename||e.FileInfo.name}`;e.FileInfo.path||(e.FileInfo.path=d),yield e.indexed.saveBlobToUserPath(n,d),o.dismiss(),e.p5toast.show({text:e.lang.text.ContentViewer.fileSaved}),e.modalCtrl.dismiss({type:"text",blob:n,path:d,index:e.RelevanceIndex-1})}})()}modify_image(){var e=this;return(0,r.c)(function*(){switch(e.FileInfo.viewer){case"image":{let o=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});o.present();try{let d;e.image_info.path=e.FileInfo.path||e.navParams.get("path"),e.FileInfo.url&&(e.image_info.path="tmp_files/modify_image.png",d=yield fetch(e.FileInfo.url).then(i=>i.blob()),yield e.indexed.saveBlobToUserPath(d,e.image_info.path)),e.modalCtrl.dismiss({type:"image",...e.image_info,path:e.image_info.path,msg:e.MessageInfo,index:e.RelevanceIndex-1})}catch(d){e.p5toast.show({text:`${e.lang.text.ContentViewer.CannotEditFile}: ${d}`})}o.dismiss()}break;case"code":case"text":let n=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});n.present();try{e.p5canvas.SyntaxHighlightReader.style.height="fit-content";let o=yield we.toBlob(e.p5canvas.SyntaxHighlightReader);e.image_info.width=e.p5canvas.SyntaxHighlightReader.clientWidth,e.image_info.height=e.p5canvas.SyntaxHighlightReader.clientHeight,e.image_info.path="tmp_files/modify_image.png",yield e.indexed.saveBlobToUserPath(o,e.image_info.path),e.modalCtrl.dismiss({type:"image",...e.image_info,path:e.image_info.path,msg:e.MessageInfo,index:e.RelevanceIndex-1,isDarkMode:e.global.GetExactDarkMode()})}catch(o){e.p5toast.show({text:`${e.lang.text.ContentViewer.CannotEditFile}: ${o}`})}n.dismiss();break;case"video":try{let o=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});o.present(),e.p5canvas.pixelDensity(1),e.p5canvas.VideoMedia.pause(),e.p5canvas.VideoMedia.size(e.image_info.width,e.image_info.height);let d=e.p5canvas.createCanvas(e.image_info.width,e.image_info.height);e.p5canvas.image(e.p5canvas.VideoMedia,0,0,e.p5canvas.width,e.p5canvas.height);let i=d.elt.toDataURL("image/png").replace("image/png","image/octet-stream");try{o.dismiss(),e.image_info.path="tmp_files/modify_image.png",yield e.indexed.saveBase64ToUserPath(i,e.image_info.path),e.modalCtrl.dismiss({type:"image",...e.image_info,msg:e.MessageInfo,index:e.RelevanceIndex-1})}catch(l){console.log("\ud30c\uc77c \uc800\uc7a5 \uc624\ub958: ",l)}}catch(o){console.log("\uc7ac\uc0dd\uc911\uc778 \ube44\ub514\uc624 \uc774\ubbf8\uc9c0 \ucd94\ucd9c \uc624\ub958: ",o)}break;case"blender":try{let o=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});o.present(),e.p5canvas.pixelDensity(1);let d=e.p5canvas.canvas.elt.toDataURL("image/png").replace("image/png","image/octet-stream");try{o.dismiss(),e.image_info.path="tmp_files/modify_image.png",e.image_info.width=e.p5canvas.width,e.image_info.height=e.p5canvas.height,yield e.indexed.saveBase64ToUserPath(d,e.image_info.path),e.modalCtrl.dismiss({type:"image",...e.image_info,msg:e.MessageInfo,index:e.RelevanceIndex-1})}catch(i){console.log("\ud30c\uc77c \uc800\uc7a5 \uc624\ub958: ",i)}}catch(o){console.log("\uc7ac\uc0dd\uc911\uc778 \ube44\ub514\uc624 \uc774\ubbf8\uc9c0 \ucd94\ucd9c \uc624\ub958: ",o)}break;case"godot":e.global.godot_window.modify_image();break;default:console.log("\ud3b8\uc9d1 \ubd88\uac00 \ud30c\uc77c \uc815\ubcf4: ",e.FileInfo)}})()}download_file(){var e=this;return(0,r.c)(function*(){if("DesktopPWA"==ae.s1||"MobilePWA"==ae.s1)if(e.FileInfo.url)try{let n=yield fetch(e.FileInfo.url),o=yield n.blob();if(!n.ok)throw"\uc81c\ub300\ub85c \ub2e4\uc6b4\ubc1b\uc544\uc9c0\uc9c0 \uc54a\uc74c";yield e.indexed.saveBlobToUserPath(o,e.FileInfo.path),e.indexed.DownloadFileFromUserPath(e.FileInfo.path,e.FileInfo.type,e.FileInfo.filename||e.FileInfo.name)}catch(n){console.log("\ub2e4\uc6b4\ubc1b\uae30 \uc2e4\ud328: ",n),e.p5toast.show({text:`${e.lang.text.Nakama.FailedDownload}: ${n}`})}else e.indexed.DownloadFileFromUserPath(e.FileInfo.path,e.FileInfo.type,e.FileInfo.filename||e.FileInfo.name);else e.alertCtrl.create({header:e.lang.text.ContentViewer.Filename,inputs:[{name:"filename",placeholder:e.FileInfo.filename||e.FileInfo.name,type:"text"}],buttons:[{text:e.lang.text.ContentViewer.saveFile,handler:(n=(0,r.c)(function*(o){if(e.FileInfo.url)try{let d=yield fetch(e.FileInfo.url),i=yield d.blob();if(!d.ok)throw"\uc81c\ub300\ub85c \ub2e4\uc6b4\ubc1b\uc544\uc9c0\uc9c0 \uc54a\uc74c";yield e.indexed.saveBlobToUserPath(i,e.FileInfo.path),e.DownloadFileAct(o)}catch(d){console.log("\ub2e4\uc6b4\ubc1b\uae30 \uc2e4\ud328: ",d),e.p5toast.show({text:`${e.lang.text.Nakama.FailedDownload}: ${d}`})}else e.DownloadFileAct(o)}),function(d){return n.apply(this,arguments)})}]}).then(n=>n.present());var n})()}DownloadFileAct(e){var n=this;return(0,r.c)(function*(){let o=yield n.loadingCtrl.create({message:n.lang.text.TodoDetail.WIP});o.present();let d=e.filename?e.filename.replace(/:|\?|\/|\\|<|>/g,""):n.FileInfo.filename||n.FileInfo.name,i=yield n.indexed.loadBlobFromUserPath(n.FileInfo.path,n.FileInfo.type);n.forceWrite&&!e.filename?n.file.writeExistingFile(n.file.externalDataDirectory,d,i).then(l=>{n.forceWrite=!1,o.dismiss(),n.p5toast.show({text:`${n.lang.text.ContentViewer.OverWriteFile}: ${d}`})}):n.file.writeFile(n.file.externalDataDirectory,d,i).then(l=>{o.dismiss(),n.p5toast.show({text:n.lang.text.ContentViewer.fileSaved})}).catch(l=>{12===(o.dismiss(),l.code)?(n.p5toast.show({text:n.lang.text.ContentViewer.AlreadyExist}),n.forceWrite=!0,n.download_file()):console.log("\uc900\ube44\ub418\uc9c0 \uc54a\uc740 \uc624\ub958 \ubc18\ud658: ",l)})})()}toast_info(e){e.various_display||this.set_various_display(e),this.p5toast.show({text:e.various_display})}ShareContent(){let e=this.nakama.rearrange_channels();for(let n=e.length-1;n>=0;n--)("missing"==e[n].status||"offline"==e[n].status)&&e.splice(n,1);e.length?this.modalCtrl.create({component:re._,componentProps:{file:this.FileInfo,channels:e}}).then(n=>{n.onDidDismiss().then(o=>{o.data&&this.modalCtrl.dismiss()}),n.present()}):this.p5toast.show({text:this.lang.text.ShareContentToOther.NoChannelToShare})}RemoveFile(){this.alertCtrl.create({header:this.lang.text.ContentViewer.RemoveFile,message:this.FileInfo.path,buttons:[{text:this.lang.text.TodoDetail.remove,handler:()=>{this.RemoveFileAct()},cssClass:"red_font"}]}).then(e=>e.present())}RemoveFileAct(){var e=this;return(0,r.c)(function*(){URL.revokeObjectURL(e.FileURL),delete e.FileInfo.thumbnail,delete e.FileInfo.text,yield e.indexed.removeFileFromUserPath(e.FileInfo.path),e.RelevanceIndex-=1,e.ChangeToAnother(1)})()}ionViewWillLeave(){var e=this;return(0,r.c)(function*(){switch(document.removeEventListener("ionBackButton",e.EventListenerAct),e.FileInfo.viewer){case"video":try{let d,i,o=e.p5canvas.VideoMedia.size();o.width>o.height?(d=192,i=o.height/o.width*192):(d=o.width/o.height*192,i=192);let l=e.p5canvas.createCanvas(d,i);e.p5canvas.pixelDensity(1),e.p5canvas.imageMode(e.p5canvas.CORNER),e.p5canvas.image(e.p5canvas.VideoMedia,0,0,d,i),e.p5canvas.fill(255,128),e.p5canvas.rect(0,0,d,i),e.p5canvas.textWrap(e.p5canvas.CHAR),e.p5canvas.textSize(16);let _=i/16;e.p5canvas.push(),e.p5canvas.translate(_/6,_/6),e.p5canvas.fill(0),e.p5canvas.text(e.FileInfo.filename||e.FileInfo.name,_,_,d-2*_,i-2*_),e.p5canvas.filter(e.p5canvas.BLUR,3),e.p5canvas.pop(),e.p5canvas.fill(255),e.p5canvas.text(e.FileInfo.filename||e.FileInfo.name,_,_,d-2*_,i-2*_);let A=l.elt.toDataURL("image/png").replace("image/png","image/octet-stream");try{yield e.indexed.saveBase64ToUserPath(A,`${e.FileInfo.path}_thumbnail.png`),e.FileInfo.thumbnail=A,e.global.modulate_thumbnail(e.FileInfo,""),e.p5canvas&&e.p5canvas.remove()}catch(p){console.log("\uc378\ub124\uc77c \uc800\uc7a5 \uc624\ub958: ",p)}}catch(o){console.log("\ube44\ub514\uc624 \uc378\ub124\uc77c \uc0dd\uc131 \ucde8\uc18c: ",o)}break;case"godot":try{e.global.godot_window.filename=e.FileInfo.filename||e.FileInfo.name,e.global.godot_window.create_thumbnail(e.FileInfo),(yield e.indexed.GetFileListFromDB("tmp_files",void 0,e.indexed.godotDB)).forEach(d=>e.indexed.removeFileFromUserPath(d,void 0,e.indexed.godotDB)),e.p5canvas&&e.p5canvas.remove()}catch(o){console.log("godot \uc378\ub124\uc77c \uc800\uc7a5 \uc624\ub958: ",o)}break;case"blender":let n=e.p5canvas.canvas.elt.toDataURL("image/png").replace("image/png","image/octet-stream");try{new ee(o=>{o.setup=()=>{o.loadImage(n,function(){var d=(0,r.c)(function*(i){let l,_;i.width>i.height?(l=192,_=i.height/i.width*192):(l=i.width/i.height*192,_=192);let A=o.createCanvas(l,_);o.pixelDensity(1),o.imageMode(o.CORNER),o.image(i,0,0,o.width,o.height),o.fill(255,128),o.rect(0,0,l,_),o.textWrap(o.CHAR),o.textSize(16);let p=_/16;o.push(),o.translate(p/6,p/6),o.fill(0),o.text(e.FileInfo.filename||e.FileInfo.name,p,p,l-2*p,_-2*p),o.filter(o.BLUR,3),o.pop(),o.fill(255),o.text(e.FileInfo.filename||e.FileInfo.name,p,p,l-2*p,_-2*p);let v=A.elt.toDataURL("image/png").replace("image/png","image/octet-stream");yield e.indexed.saveBase64ToUserPath(v,`${e.FileInfo.path}_thumbnail.png`),e.FileInfo.thumbnail=v,e.global.modulate_thumbnail(e.FileInfo,""),o.remove(),e.p5canvas&&e.p5canvas.remove()});return function(i){return d.apply(this,arguments)}}(),d=>{console.log("\ube14\ub80c\ub354 \uc378\ub124\uc77c \ubc30\uacbd \ubc1b\uc544\uc624\uae30 \uc624\ub958: ",d),o.remove(),e.p5canvas&&e.p5canvas.remove()})}})}catch(o){console.log("blender \uc378\ub124\uc77c \uc800\uc7a5 \uc624\ub958: ",o)}break;default:e.p5canvas&&e.p5canvas.remove()}URL.revokeObjectURL(e.FileURL);try{(yield e.file.checkFile(e.file.externalDataDirectory,`viewer_tmp.${e.FileInfo.file_ext}`))&&(yield e.file.removeFile(e.file.externalDataDirectory,`viewer_tmp.${e.FileInfo.file_ext}`))}catch{}})()}ionViewDidLeave(){this.noti.ClearNoti(6)}copy_url(e){this.mClipboard.copy(e).catch(n=>Pe.c.write(e))}}return(s=O).\u0275fac=function(e){return new(e||s)(t.GI1(G.qS),t.GI1(Ee.a6),t.GI1(N.k),t.GI1(he.o),t.GI1(B.S),t.GI1(K.O),t.GI1(G.iW),t.GI1(G.Kg),t.GI1(ne.A1),t.GI1(xe.h),t.GI1(be._),t.GI1(ke.s))},s.\u0275cmp=t.In1({type:s,selectors:[["app-ionic-viewer"]],viewQuery:function(e,n){if(1&e&&(t.CC$(m,5),t.CC$(I,5)),2&e){let o;t.wto(o=t.Gqi())&&(n.FileMenu=o.first),t.wto(o=t.Gqi())&&(n.ShowContentInfoIonic=o.first)}},decls:29,vars:18,consts:[[1,"ion-no-border"],["id","Toolbar"],["slot","start",3,"click"],["defaultHref",""],["class","relevance_change","style","padding-right: 16px;","slot","end","name","pause-circle",3,"click",4,"ngIf"],["class","relevance_change","style","padding-right: 16px;","slot","end","name","play-circle",3,"click",4,"ngIf"],["class","relevance_change","style","padding-right: 4px;","slot","end","name","arrow-back-circle-outline",3,"click",4,"ngIf"],["slot","end",4,"ngIf"],["class","relevance_change","style","padding-right: 16px; padding-left: 4px;","slot","end","name","arrow-forward-circle-outline",3,"click",4,"ngIf"],["id","ContentBox"],[1,"main_table_elt"],[2,"height","0"],["id","FileHeader",2,"max-width","100vw"],["text-wrap","","style","overflow-x: auto;",4,"ngIf"],["type","text","text-warp","","style","overflow-x: auto; overflow-y: hidden;",3,"ngModel","placeholder","ngModelChange",4,"ngIf"],[3,"click",4,"ngIf"],["class","ion-align-items-center",3,"disabled","click",4,"ngIf"],["id","menu_trigger",4,"ngIf"],["trigger","menu_trigger","dismissOnSelect","",4,"ngIf"],[4,"ngIf"],[3,"initialBreakpoint","breakpoints"],["ShowContentInfoIonic",""],["slot","end","name","pause-circle",1,"relevance_change",2,"padding-right","16px",3,"click"],["slot","end","name","play-circle",1,"relevance_change",2,"padding-right","16px",3,"click"],["slot","end","name","arrow-back-circle-outline",1,"relevance_change",2,"padding-right","4px",3,"click"],["slot","end"],["slot","end","name","arrow-forward-circle-outline",1,"relevance_change",2,"padding-right","16px","padding-left","4px",3,"click"],["text-wrap","",2,"overflow-x","auto"],["type","text","text-warp","",2,"overflow-x","auto","overflow-y","hidden",3,"ngModel","placeholder","ngModelChange"],[3,"click"],["name","close-circle-outline"],["name","save-outline"],[1,"ion-align-items-center",3,"disabled","click"],["name","code-download-outline"],["id","menu_trigger"],["name","ellipsis-vertical"],["trigger","menu_trigger","dismissOnSelect",""],["FileMenu",""],["button","",3,"click",4,"ngIf"],["button","",3,"click"],["id","content_viewer_canvas",1,"full_screen",2,"max-width","100vw"],[1,"disconnect_info"],["color","medium","name","attach-outline",2,"width","60px","height","60px"],["color","medium"],[1,"ion-align-items-center"],["size","12",1,"ion-text-center"],["color","warning","shape","round",1,"ion-align-items-center",3,"disabled","click"],["button","",4,"ngIf"],[1,"ion-text-end"],[4,"ngFor","ngForOf"],[1,"ion-text-center"],["button",""],[1,"history_center"],["color","secondary","mode","ios","outline","true",3,"click"],["name","document-attach-outline",4,"ngIf"],["name","camera-outline",4,"ngIf"],["name","link-outline",4,"ngIf"],["name","text-outline",4,"ngIf"],["name","document-text-outline",4,"ngIf"],["name","share-social-outline",4,"ngIf"],["name","document-attach-outline"],["name","camera-outline"],["name","link-outline"],["name","text-outline"],["name","document-text-outline"],["name","share-social-outline"],["src","assets/icon/voidDraw.png"]],template:function(e,n){1&e&&(t.I0R(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-title"),t.OEk(3),t.C$Y(),t.I0R(4,"ion-buttons",2),t.qCj("click",function(){return n.modalCtrl.dismiss()}),t.wR5(5,"ion-back-button",3),t.C$Y(),t.yuY(6,P,1,0,"ion-icon",4)(7,F,1,0,"ion-icon",5)(8,R,1,0,"ion-icon",6)(9,w,2,1,"ion-label",7)(10,E,1,0,"ion-icon",8),t.C$Y()(),t.I0R(11,"ion-content",9)(12,"table",10)(13,"tr",11)(14,"td")(15,"ion-list-header",12),t.yuY(16,Z,2,1,"ion-label",13)(17,se,1,2,"ion-input",14)(18,$,2,0,"ion-button",15)(19,ve,2,0,"ion-button",15)(20,ie,2,1,"ion-button",16)(21,Q,2,0,"ion-button",17)(22,M,3,0,"ion-popover",18),t.C$Y()()(),t.I0R(23,"tr"),t.yuY(24,q,3,1,"td",19)(25,ce,6,2,"td",19),t.C$Y()(),t.I0R(26,"ion-modal",20,21),t.yuY(28,Qe,19,9,"ng-template"),t.C$Y()()),2&e&&(t.yG2(3),t.cNF(n.lang.text.ContentViewer.Title),t.yG2(3),t.E7m("ngIf",("video"==n.FileInfo.viewer||"audio"==n.FileInfo.viewer)&&n.AutoPlayNext),t.yG2(),t.E7m("ngIf",("video"==n.FileInfo.viewer||"audio"==n.FileInfo.viewer)&&!n.AutoPlayNext),t.yG2(),t.E7m("ngIf",n.HaveRelevances),t.yG2(),t.E7m("ngIf",n.HaveRelevances),t.yG2(),t.E7m("ngIf",n.HaveRelevances),t.yG2(6),t.E7m("ngIf",!n.isTextEditMode),t.yG2(),t.E7m("ngIf",n.isTextEditMode),t.yG2(),t.E7m("ngIf",n.isTextEditMode),t.yG2(),t.E7m("ngIf",n.isTextEditMode),t.yG2(),t.E7m("ngIf",n.isChannelOnline&&n.HaveRelevances&&!n.isTextEditMode&&!n.fromLocalChannel),t.yG2(),t.E7m("ngIf",!n.isTextEditMode),t.yG2(),t.E7m("ngIf",!n.isTextEditMode),t.yG2(2),t.E7m("ngIf",!n.NeedDownloadFile),t.yG2(),t.E7m("ngIf",n.NeedDownloadFile),t.yG2(),t.E7m("initialBreakpoint",.5)("breakpoints",t.q4q(17,qe)))},dependencies:[Ge.ay,Ge.u_,y.ue,y._G,G.O7,G.sn,G.GS,G.cz,G.Kk,G._i,G.YP,G.wB,G.Ko,G.A5,G.Yb,G.S8,G.QR,G.OC,G.zz,G.qo,G.tM,G.Md,G.yc,G.sW,G.qG,G.Im],styles:[".main_table_elt[_ngcontent-%COMP%]{width:100%;height:100%;border:0;margin:0}.relevance_change[_ngcontent-%COMP%]{width:25px;height:25px}.history_center[_ngcontent-%COMP%]{text-align:center}"]}),O})()},896:(Se,De,h)=>{"use strict";h.d(De,{_:()=>Ee});var r=h(4496),ae=h(4500),ee=h(9240),te=h(5624),re=h(4180),Pe=h(7136),we=h(1368);function Ae(N,he){if(1&N&&r.wR5(0,"img",12),2&N){const B=r.GaO().$implicit;r.m_g("online"==B.status||3==B.redirect.type&&"pending"==B.status?"filter: grayscale(0) contrast(1)":"filter: grayscale(.9) contrast(1.4)"),r.E7m("src",B.info.img||"assets/data/channel.svg",r.K6U)}}function t(N,he){if(1&N&&r.wR5(0,"div",13),2&N){const B=r.GaO().$implicit;r.m_g("background-image: linear-gradient(to right, #0000, #"+(B.color||"abcdef")+"44)")}}function G(N,he){if(1&N){const B=r.KQA();r.I0R(0,"ion-item",4),r.qCj("click",function(){const xe=r.usT(B).$implicit,be=r.GaO();return r.CGJ(be.go_to_chatroom(xe))}),r.I0R(1,"div",5),r.yuY(2,Ae,1,3,"img",6),r.wR5(3,"div",7),r.C$Y(),r.yuY(4,t,1,2,"div",8),r.I0R(5,"ion-label")(6,"div",9)(7,"table")(8,"tr")(9,"td"),r.OEk(10),r.C$Y(),r.I0R(11,"td",10),r.OEk(12),r.C$Y()()()(),r.I0R(13,"div",11),r.OEk(14),r.C$Y()()()}if(2&N){const B=he.$implicit,K=r.GaO();r.yG2(2),r.E7m("ngIf",B.info),r.yG2(),r.m_g("background-color: "+K.statusBar.colors[B.status||"offline"]),r.yG2(),r.E7m("ngIf",B.is_new),r.yG2(6),r.oRS(" ",B.info?B.info.name||B.info.display_name||K.lang.text.ChatRoom.noname_chatroom:B.title||K.lang.text.ChatRoom.noname_chatroom," "),r.yG2(2),r.oRS(" ","("+B.server.target+")"," "),r.yG2(2),r.oRS(" ",B.last_comment||B.noti||K.lang.text.Subscribes.noMessageHistory," ")}}let Ee=(()=>{var N;class he{constructor(K,ne,xe,be,ke){this.lang=K,this.navParams=ne,this.modalCtrl=xe,this.statusBar=be,this.nakama=ke,this.BackButtonPressed=!1}InitBrowserBackButtonOverride(){window.history.replaceState(null,null,window.location.href),window.onpopstate=()=>{this.BackButtonPressed||(this.BackButtonPressed=!0,this.modalCtrl.dismiss())}}ngOnInit(){this.InitBrowserBackButtonOverride(),this.channels=this.navParams.get("channels")}go_to_chatroom(K){let ne=this.navParams.get("file");delete ne.db,this.nakama.go_to_chatroom_without_admob_act(K,ne),this.modalCtrl.dismiss(!0)}}return(N=he).\u0275fac=function(K){return new(K||N)(r.GI1(ae.o),r.GI1(ee.a6),r.GI1(te.qS),r.GI1(re.Y),r.GI1(Pe.h))},N.\u0275cmp=r.In1({type:N,selectors:[["app-share-content-to-other"]],decls:11,vars:3,consts:[[1,"ion-no-border"],["slot","start",3,"click"],["defaultHref",""],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"],[1,"channel_image","channel_image_div"],["class","channel_image","alt","ch_img",3,"src","style",4,"ngIf"],[1,"status_circle"],["class","additional_form new_bg_form",3,"style",4,"ngIf"],[1,"channel_text_form","header"],[1,"channel_text_form","server_target"],[1,"channel_text_form","content"],["alt","ch_img",1,"channel_image",3,"src"],[1,"additional_form","new_bg_form"]],template:function(K,ne){1&K&&(r.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),r.OEk(3),r.C$Y(),r.I0R(4,"ion-buttons",1),r.qCj("click",function(){return ne.modalCtrl.dismiss()}),r.wR5(5,"ion-back-button",2),r.C$Y()()(),r.I0R(6,"ion-content")(7,"ion-item-divider")(8,"ion-label"),r.OEk(9),r.C$Y()(),r.yuY(10,G,15,7,"ion-item",3),r.C$Y()),2&K&&(r.yG2(3),r.cNF(ne.lang.text.ShareContentToOther.Title),r.yG2(6),r.cNF(ne.lang.text.ShareContentToOther.AvailableChannels),r.yG2(),r.E7m("ngForOf",ne.channels))},dependencies:[we.ay,we.u_,te.GS,te._i,te.wB,te.Yb,te.S8,te.QR,te.tM,te.Md,te.Im],styles:[".server_target[_ngcontent-%COMP%]{color:#888;padding-left:4px}.header[_ngcontent-%COMP%]{padding-bottom:4px}.content[_ngcontent-%COMP%]{color:#888;height:24px;line-height:24px;vertical-align:middle;overflow:hidden}.channel_image_div[_ngcontent-%COMP%]{position:absolute}.channel_image[_ngcontent-%COMP%]{width:52px;height:52px;border-radius:64px;object-fit:cover}.status_circle[_ngcontent-%COMP%]{position:relative;top:-56px;left:38px;width:12px;height:12px;border-radius:12px}.channel_text_form[_ngcontent-%COMP%]{margin-left:64px}"]}),he})()},7668:function(Se){!function(De){"use strict";var h=function xe(){return{escape:function ve(g){return g.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")},parseExtension:m,mimeType:function I(g){var k=m(g).toLowerCase();return function y(){var g="application/font-woff",k="image/jpeg";return{woff:g,woff2:g,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:k,jpeg:k,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}()[k]||""},dataAsUrl:function $(g,k){return"data:"+k+";base64,"+g},isDataUrl:function P(g){return-1!==g.search(/^(data:)/)},canvasToBlob:function R(g){return g.toBlob?new Promise(function(k){g.toBlob(k)}):function F(g){return new Promise(function(k){for(var M=window.atob(g.toDataURL().split(",")[1]),D=M.length,q=new Uint8Array(D),ce=0;ce<D;ce++)q[ce]=M.charCodeAt(ce);k(new Blob([q],{type:"image/png"}))})}(g)},resolveUrl:function w(g,k){var M=document.implementation.createHTMLDocument(),D=M.createElement("base");M.head.appendChild(D);var q=M.createElement("a");return M.body.appendChild(q),D.href=k,q.href=g,q.href},getAndEncode:function se(g){return re.impl.options.cacheBust&&(g+=(/\?/.test(g)?"&":"?")+(new Date).getTime()),new Promise(function(M){var q,D=new XMLHttpRequest;if(D.onreadystatechange=function Re(){if(4===D.readyState){if(200!==D.status)return void(q?M(q):fe("cannot fetch resource: "+g+", status: "+D.status));var ue=new FileReader;ue.onloadend=function(){var Ce=ue.result.split(/,/)[1];M(Ce)},ue.readAsDataURL(D.response)}},D.ontimeout=function Oe(){q?M(q):fe("timeout of 30000ms occured while fetching resource: "+g)},D.responseType="blob",D.timeout=3e4,D.open("GET",g,!0),D.send(),re.impl.options.imagePlaceholder){var ce=re.impl.options.imagePlaceholder.split(/,/);ce&&ce[1]&&(q=ce[1])}function fe(ue){console.error(ue),M("")}})},uid:function E(){var g=0;return function(){return"u"+function k(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}()+g++}}(),delay:function ie(g){return function(k){return new Promise(function(M){setTimeout(function(){M(k)},g)})}},asArray:function Q(g){for(var k=[],M=g.length,D=0;D<M;D++)k.push(g[D]);return k},escapeXhtml:function oe(g){return g.replace(/#/g,"%23").replace(/\n/g,"%0A")},makeImage:function Z(g){return new Promise(function(k,M){var D=new Image;D.onload=function(){k(D)},D.onerror=M,D.src=g})},width:function me(g){var k=_e(g,"border-left-width"),M=_e(g,"border-right-width");return g.scrollWidth+k+M},height:function le(g){var k=_e(g,"border-top-width"),M=_e(g,"border-bottom-width");return g.scrollHeight+k+M}};function m(g){var k=/\.([^\.\/]*?)$/g.exec(g);return k?k[1]:""}function _e(g,k){var M=window.getComputedStyle(g).getPropertyValue(k);return parseFloat(M.replace("px",""))}}(),r=function be(){var y=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:function F(R,w,E){return function Z(){return!m(R)}()?Promise.resolve(R):Promise.resolve(R).then(I).then(function(se){var $=Promise.resolve(R);return se.forEach(function(ve){$=$.then(function(ie){return P(ie,ve,w,E)})}),$})},shouldProcess:m,impl:{readUrls:I,inline:P}};function m(R){return-1!==R.search(y)}function I(R){for(var E,w=[];null!==(E=y.exec(R));)w.push(E[1]);return w.filter(function(Z){return!h.isDataUrl(Z)})}function P(R,w,E,Z){return Promise.resolve(w).then(function($){return E?h.resolveUrl($,E):$}).then(Z||h.getAndEncode).then(function($){return h.dataAsUrl($,h.mimeType(w))}).then(function($){return R.replace(function se($){return new RegExp("(url\\(['\"]?)("+h.escape($)+")(['\"]?\\))","g")}(w),"$1"+$+"$3")})}}(),ae=function ke(){return{resolveAll:function y(){return m(document).then(function(I){return Promise.all(I.map(function(P){return P.resolve()}))}).then(function(I){return I.join("\n")})},impl:{readAll:m}};function m(){return Promise.resolve(h.asArray(document.styleSheets)).then(function P(R){var w=[];return R.forEach(function(E){try{h.asArray(E.cssRules||[]).forEach(w.push.bind(w))}catch(Z){console.log("Error while reading CSS rules from "+E.href,Z.toString())}}),w}).then(function I(R){return R.filter(function(w){return w.type===CSSRule.FONT_FACE_RULE}).filter(function(w){return r.shouldProcess(w.style.getPropertyValue("src"))})}).then(function(R){return R.map(F)});function F(R){return{resolve:function(){return r.inlineAll(R.cssText,(R.parentStyleSheet||{}).href)},src:function(){return R.style.getPropertyValue("src")}}}}}(),ee=function Ge(){return{inlineAll:function m(I){return I instanceof Element?function P(F){var R=F.style.getPropertyValue("background");return R?r.inlineAll(R).then(function(w){F.style.setProperty("background",w,F.style.getPropertyPriority("background"))}).then(function(){return F}):Promise.resolve(F)}(I).then(function(){return I instanceof HTMLImageElement?y(I).inline():Promise.all(h.asArray(I.childNodes).map(function(F){return m(F)}))}):Promise.resolve(I)},impl:{newImage:y}};function y(I){return{inline:function P(F){return h.isDataUrl(I.src)?Promise.resolve():Promise.resolve(I.src).then(F||h.getAndEncode).then(function(R){return h.dataAsUrl(R,h.mimeType(I.src))}).then(function(R){return new Promise(function(w,E){I.onload=w,I.onerror=E,I.src=R})})}}}}(),te={imagePlaceholder:void 0,cacheBust:!1},re={toSvg:Pe,toPng:function Ae(y,m){return N(y,m||{}).then(function(I){return I.toDataURL()})},toJpeg:function t(y,m){return N(y,m=m||{}).then(function(I){return I.toDataURL("image/jpeg",m.quality||1)})},toBlob:function G(y,m){return N(y,m||{}).then(h.canvasToBlob)},toPixelData:function we(y,m){return N(y,m||{}).then(function(I){return I.getContext("2d").getImageData(0,0,h.width(y),h.height(y)).data})},impl:{fontFaces:ae,images:ee,util:h,inliner:r,options:{}}};function Pe(y,m){return function Ee(y){re.impl.options.imagePlaceholder=typeof y.imagePlaceholder>"u"?te.imagePlaceholder:y.imagePlaceholder,re.impl.options.cacheBust=typeof y.cacheBust>"u"?te.cacheBust:y.cacheBust}(m=m||{}),Promise.resolve(y).then(function(P){return he(P,m.filter,!0)}).then(B).then(K).then(function I(P){return m.bgcolor&&(P.style.backgroundColor=m.bgcolor),m.width&&(P.style.width=m.width+"px"),m.height&&(P.style.height=m.height+"px"),m.style&&Object.keys(m.style).forEach(function(F){P.style[F]=m.style[F]}),P}).then(function(P){return function ne(y,m,I){return Promise.resolve(y).then(function(P){return P.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),(new XMLSerializer).serializeToString(P)}).then(h.escapeXhtml).then(function(P){return'<foreignObject x="0" y="0" width="100%" height="100%">'+P+"</foreignObject>"}).then(function(P){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+m+'" height="'+I+'">'+P+"</svg>"}).then(function(P){return"data:image/svg+xml;charset=utf-8,"+P})}(P,m.width||h.width(y),m.height||h.height(y))})}function N(y,m){return Pe(y,m).then(h.makeImage).then(h.delay(100)).then(function(P){var F=function I(P){var F=document.createElement("canvas");if(F.width=m.width||h.width(P),F.height=m.height||h.height(P),m.bgcolor){var R=F.getContext("2d");R.fillStyle=m.bgcolor,R.fillRect(0,0,F.width,F.height)}return F}(y);return F.getContext("2d").drawImage(P,0,0),F})}function he(y,m,I){return I||!m||m(y)?Promise.resolve(y).then(function P(w){return w instanceof HTMLCanvasElement?h.makeImage(w.toDataURL()):w.cloneNode(!1)}).then(function(w){return function F(w,E,Z){var se=w.childNodes;return 0===se.length?Promise.resolve(E):function $(ve,ie,Q){var oe=Promise.resolve();return ie.forEach(function(me){oe=oe.then(function(){return he(me,Q)}).then(function(le){le&&ve.appendChild(le)})}),oe}(E,h.asArray(se),Z).then(function(){return E})}(y,w,m)}).then(function(w){return function R(w,E){return E instanceof Element?Promise.resolve().then(function Z(){!function ie(Q,oe){Q.cssText?oe.cssText=Q.cssText:function me(le,_e){h.asArray(le).forEach(function(g){_e.setProperty(g,le.getPropertyValue(g),le.getPropertyPriority(g))})}(Q,oe)}(window.getComputedStyle(w),E.style)}).then(function se(){[":before",":after"].forEach(function(Q){!function ie(Q){var oe=window.getComputedStyle(w,Q),me=oe.getPropertyValue("content");if(""!==me&&"none"!==me){var le=h.uid();E.className=E.className+" "+le;var _e=document.createElement("style");_e.appendChild(function g(k,M,D){var q="."+k+":"+M,ce=D.cssText?Re(D):Oe(D);return document.createTextNode(q+"{"+ce+"}");function Re(fe){var ue=fe.getPropertyValue("content");return fe.cssText+" content: "+ue+";"}function Oe(fe){return h.asArray(fe).map(ue).join("; ")+";";function ue(Ce){return Ce+": "+fe.getPropertyValue(Ce)+(fe.getPropertyPriority(Ce)?" !important":"")}}}(le,Q,oe)),E.appendChild(_e)}}(Q)})}).then(function $(){w instanceof HTMLTextAreaElement&&(E.innerHTML=w.value),w instanceof HTMLInputElement&&E.setAttribute("value",w.value)}).then(function ve(){E instanceof SVGElement&&(E.setAttribute("xmlns","http://www.w3.org/2000/svg"),E instanceof SVGRectElement&&["width","height"].forEach(function(ie){var Q=E.getAttribute(ie);Q&&E.style.setProperty(ie,Q)}))}).then(function(){return E}):E}(y,w)}):Promise.resolve()}function B(y){return ae.resolveAll().then(function(m){var I=document.createElement("style");return y.appendChild(I),I.appendChild(document.createTextNode(m)),y})}function K(y){return ee.inlineAll(y).then(function(){return y})}Se.exports=re}()}}]);