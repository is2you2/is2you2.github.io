"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7048],{5404:(U,D,_)=>{_.d(D,{Gq:()=>h});var h=function(x){return x.UTF8="utf8",x.ASCII="ascii",x.UTF16="utf16",x}(h||{})},7048:(U,D,_)=>{_.d(D,{w:()=>_e});var m=_(1528),h=_(5193),v=_(8744),C=_(6400);_(5404);const G=(0,C.C_)("Filesystem",{web:()=>_.e(7688).then(_.bind(_,7688)).then(l=>new l.FilesystemWeb)});var T=_(9352),E=_(1052),e=_(4496),F=_(5624),I=_(9240),R=_(4668),O=_(4500),k=_(5020),P=_(3824),L=_(4476),w=_(544),$=_(6819),S=_(7136),b=_(1368);const B=["FileSel"];function A(l,d){if(1&l){const r=e.KQA();e.I0R(0,"ion-icon",9),e.qCj("click",function(){e.usT(r);const i=e.GaO();return e.CGJ(i.toggle_thumbnail())}),e.C$Y()}}function Y(l,d){if(1&l){const r=e.KQA();e.I0R(0,"ion-icon",10),e.qCj("click",function(){e.usT(r);const i=e.GaO();return e.CGJ(i.toggle_thumbnail())}),e.C$Y()}}function j(l,d){if(1&l){const r=e.KQA();e.I0R(0,"div")(1,"ion-item",19),e.qCj("click",function(){e.usT(r);const i=e.GaO(2);return e.CGJ(i.SelectImportFolder())}),e.wR5(2,"ion-icon",20),e.I0R(3,"ion-label"),e.OEk(4),e.C$Y()(),e.I0R(5,"input",21),e.qCj("change",function(i){e.usT(r);const n=e.GaO(2);return e.CGJ(n.inputImageSelected(i))}),e.C$Y()()}if(2&l){const r=e.GaO(2);e.yG2(4),e.oRS(" ",r.lang.text.UserFsDir.ImportFolder," ")}}function N(l,d){if(1&l){const r=e.KQA();e.I0R(0,"ion-button",14),e.qCj("click",function(){e.usT(r);const i=e.GaO(2);return e.CGJ(i.ExportDirectoryRecursive())}),e.OEk(1),e.C$Y()}if(2&l){const r=e.GaO(2);e.yG2(),e.oRS(" ",r.lang.text.UserFsDir.ExportDir," ")}}function M(l,d){if(1&l){const r=e.KQA();e.I0R(0,"ion-item",19),e.qCj("click",function(){e.usT(r);const i=e.GaO(2);return e.CGJ(i.MoveToUpDir())}),e.wR5(1,"ion-icon",12),e.I0R(2,"ion-label"),e.OEk(3,".."),e.C$Y()()}}function K(l,d){if(1&l){const r=e.KQA();e.I0R(0,"ion-item",19),e.qCj("click",function(){e.usT(r);const i=e.GaO().$implicit,n=e.GaO(2);return e.CGJ(n.SelectFolder(i))}),e.wR5(1,"ion-icon",12),e.I0R(2,"ion-label"),e.OEk(3),e.C$Y()()}if(2&l){const r=e.GaO().$implicit;e.yG2(3),e.cNF(r.name)}}function J(l,d){if(1&l&&(e.I0R(0,"div"),e.yuY(1,K,4,1,"ion-item",16),e.C$Y()),2&l){const r=d.$implicit,t=e.GaO(2);e.yG2(),e.E7m("ngIf",t.CurrentDir==r.dir)}}function Q(l,d){1&l&&e.wR5(0,"ion-icon",37)}function W(l,d){1&l&&e.wR5(0,"ion-icon",38)}function H(l,d){1&l&&e.wR5(0,"ion-icon",39)}function V(l,d){1&l&&e.wR5(0,"ion-icon",40)}function z(l,d){1&l&&e.wR5(0,"ion-icon",41)}function X(l,d){1&l&&e.wR5(0,"ion-icon",42)}function q(l,d){if(1&l&&(e.I0R(0,"ion-label",43),e.OEk(1),e.C$Y()),2&l){const r=e.GaO(2).$implicit;e.yG2(),e.cNF(r.name)}}function Z(l,d){if(1&l&&(e.I0R(0,"ion-label"),e.OEk(1),e.C$Y()),2&l){const r=e.GaO(2).$implicit;e.yG2(),e.cNF(r.name)}}function ee(l,d){if(1&l){const r=e.KQA();e.I0R(0,"ion-button",44),e.qCj("click",function(){e.usT(r);const i=e.GaO(2).$implicit,n=e.GaO(2);return e.CGJ(n.OpenFile(i))}),e.OEk(1),e.C$Y()}if(2&l){const r=e.GaO(4);e.yG2(),e.oRS(" ",r.lang.text.UserFsDir.Open," ")}}function te(l,d){if(1&l){const r=e.KQA();e.I0R(0,"ion-button",44),e.qCj("click",function(){e.usT(r);const i=e.GaO(2).$implicit,n=e.GaO(2);return e.CGJ(n.dismiss_page(i))}),e.OEk(1),e.C$Y()}if(2&l){const r=e.GaO(4);e.yG2(),e.oRS(" ",r.lang.text.UserFsDir.Select," ")}}function ie(l,d){if(1&l){const r=e.KQA();e.I0R(0,"ion-button",44),e.qCj("click",function(){e.usT(r);const i=e.GaO(2).$implicit,n=e.GaO(2);return e.CGJ(n.DownloadFile(i))}),e.OEk(1),e.C$Y()}if(2&l){const r=e.GaO(4);e.yG2(),e.oRS(" ",r.lang.text.UserFsDir.Download," ")}}function ne(l,d){if(1&l){const r=e.KQA();e.I0R(0,"div",45),e.qCj("click",function(){e.usT(r);const i=e.GaO(2).$implicit,n=e.GaO(2);return e.CGJ(n.OpenFile(i))}),e.wR5(1,"img",46),e.C$Y()}if(2&l){const r=e.GaO(2).$implicit,t=e.GaO(2);e.yG2(),e.m_g(t.HideThumbnail?"filter: blur(6px);":""),e.E7m("src",r.thumbnail,e.K6U)("alt",r.name)}}function re(l,d){if(1&l){const r=e.KQA();e.I0R(0,"ion-accordion",23)(1,"ion-item",24),e.yuY(2,Q,1,0,"ion-icon",25)(3,W,1,0,"ion-icon",26)(4,H,1,0,"ion-icon",27)(5,V,1,0,"ion-icon",28)(6,z,1,0,"ion-icon",29)(7,X,1,0,"ion-icon",30)(8,q,2,1,"ion-label",31)(9,Z,2,1,"ion-label",8),e.wR5(10,"ion-icon",32),e.C$Y(),e.I0R(11,"div",33)(12,"ion-item",11)(13,"ion-label"),e.OEk(14),e.C$Y(),e.yuY(15,ee,2,1,"ion-button",34)(16,te,2,1,"ion-button",34)(17,ie,2,1,"ion-button",34),e.I0R(18,"ion-button",35),e.qCj("click",function(){e.usT(r);const i=e.GaO(),n=i.$implicit,o=i.index,s=e.GaO(2);return e.CGJ(s.RemoveFile(n,o))}),e.OEk(19),e.C$Y()(),e.yuY(20,ne,2,4,"div",36),e.C$Y()()}if(2&l){const r=e.GaO().$implicit;e.GaO();const t=e.Gew(17),i=e.GaO();e.E7m("value",r.path),e.yG2(2),e.E7m("ngIf","image"==r.viewer),e.yG2(),e.E7m("ngIf","audio"==r.viewer),e.yG2(),e.E7m("ngIf","video"==r.viewer),e.yG2(),e.E7m("ngIf","text"==r.viewer),e.yG2(),e.E7m("ngIf","godot"==r.viewer),e.yG2(),e.E7m("ngIf","disabled"==r.viewer),e.yG2(),e.E7m("ngIf",t.value==r.path),e.yG2(),e.E7m("ngIf",t.value!=r.path),e.yG2(5),e.cNF(i.lang.text.UserFsDir.Action),e.yG2(),e.E7m("ngIf","image"!=r.viewer),e.yG2(),e.E7m("ngIf",i.is_file_selector),e.yG2(),e.E7m("ngIf",i.cant_dedicated&&!i.is_file_selector),e.yG2(2),e.oRS(" ",i.lang.text.UserFsDir.Delete," "),e.yG2(),e.E7m("ngIf","image"==r.viewer)}}function se(l,d){if(1&l&&(e.I0R(0,"div"),e.yuY(1,re,21,15,"ion-accordion",22),e.C$Y()),2&l){const r=d.$implicit,t=e.GaO(2);e.yG2(),e.E7m("ngIf",t.CurrentDir==r.dir||t.is_file_selector)}}function oe(l,d){if(1&l){const r=e.KQA();e.I0R(0,"ion-list"),e.yuY(1,j,6,1,"div",8),e.I0R(2,"div")(3,"ion-item",11),e.wR5(4,"ion-icon",12),e.I0R(5,"ion-label"),e.OEk(6,"."),e.C$Y(),e.yuY(7,N,2,1,"ion-button",13),e.I0R(8,"ion-button",14),e.qCj("click",function(){e.usT(r);const i=e.GaO();return e.CGJ(i.CreateNewFolder())}),e.OEk(9),e.C$Y(),e.I0R(10,"ion-button",14),e.qCj("click",function(){e.usT(r);const i=e.GaO();return e.CGJ(i.SelectFiles())}),e.OEk(11),e.C$Y(),e.I0R(12,"ion-button",15),e.qCj("click",function(){e.usT(r);const i=e.GaO();return e.CGJ(i.RemoveDirectoryRecursive())}),e.OEk(13),e.C$Y()(),e.yuY(14,M,4,0,"ion-item",16),e.C$Y(),e.yuY(15,J,2,1,"div",17),e.I0R(16,"ion-accordion-group",null,18),e.yuY(18,se,2,1,"div",17),e.C$Y()()}if(2&l){const r=e.GaO();e.yG2(),e.E7m("ngIf",""==r.CurrentDir&&!r.is_file_selector&&r.CanImportFolder),e.yG2(6),e.E7m("ngIf",!r.cant_dedicated),e.yG2(2),e.oRS(" ",r.lang.text.UserFsDir.NewFolder," "),e.yG2(2),e.oRS(" ",r.lang.text.UserFsDir.AddFile," "),e.yG2(2),e.oRS(" ",r.lang.text.UserFsDir.RemoveCurrentDir," "),e.yG2(),e.E7m("ngIf",""!=r.CurrentDir),e.yG2(),e.E7m("ngForOf",r.DirList),e.yG2(3),e.E7m("ngForOf",r.FileList)}}function le(l,d){if(1&l){const r=e.KQA();e.I0R(0,"ion-item",19),e.qCj("click",function(){e.usT(r);const i=e.GaO().$implicit,n=e.GaO(2);return e.CGJ(n.importFolderMiddleAct(i))}),e.wR5(1,"ion-icon",12),e.I0R(2,"ion-label"),e.OEk(3),e.C$Y()()}if(2&l){const r=e.GaO().$implicit;e.yG2(3),e.cNF(r.name)}}function ae(l,d){if(1&l&&(e.I0R(0,"ion-item",49),e.wR5(1,"ion-icon",42),e.I0R(2,"ion-label"),e.OEk(3),e.C$Y()()),2&l){const r=e.GaO().$implicit;e.yG2(3),e.cNF(r.name)}}function ce(l,d){if(1&l&&(e.I0R(0,"div"),e.yuY(1,le,4,1,"ion-item",16)(2,ae,4,1,"ion-item",48),e.C$Y()),2&l){const r=d.$implicit;e.yG2(),e.E7m("ngIf",r.isDirectory),e.yG2(),e.E7m("ngIf",r.isFile)}}function de(l,d){if(1&l){const r=e.KQA();e.I0R(0,"ion-list")(1,"ion-item",19),e.qCj("click",function(){e.usT(r);const i=e.GaO();return e.CGJ(i.InAppBrowser=!0)}),e.wR5(2,"ion-icon",12),e.I0R(3,"ion-label",47),e.OEk(4,"/sdcard/Android/data/org.pjcone.portal/files"),e.C$Y()(),e.yuY(5,ce,3,2,"div",17),e.C$Y()}if(2&l){const r=e.GaO();e.yG2(5),e.E7m("ngForOf",r.ExternalFolder)}}let _e=(()=>{var l;class d{constructor(t,i,n,o,s,a,u,c,p,g,f,y,ue){this.modalCtrl=t,this.indexed=i,this.loadingCtrl=n,this.lang=o,this.global=s,this.p5toast=a,this.alertCtrl=u,this.sanitizer=c,this.file=p,this.navCtrl=g,this.noti=f,this.navParams=y,this.nakama=ue,this.DirList=[],this.FileList=[],this.cant_dedicated=!1,this.InAppBrowser=!0,this.is_ready=!1,this.is_file_selector=!1,this.HideThumbnail=!1,this.CanImportFolder=!0,this.BackButtonPressed=!1,this.StopIndexing=!1,this.EventListenerAct=me=>{me.detail.register(110,ge=>{this.is_ready?""==this.CurrentDir?ge():this.MoveToUpDir():(this.initLoadingElement.dismiss(),this.is_ready=!0)})},this.isCreateFolderRecursive=!1,this.ExternalFolder=[]}toggle_thumbnail(){this.HideThumbnail=!this.HideThumbnail,localStorage.setItem("user-fs-thumbnail",this.HideThumbnail?"1":"0")}InitBrowserBackButtonOverride(){window.history.pushState(null,null,window.location.href),window.onpopstate=()=>{this.BackButtonPressed||(this.BackButtonPressed=!0,this.navCtrl.back())}}ngOnInit(){this.InitBrowserBackButtonOverride(),"DesktopPWA"==h.s1&&setTimeout(()=>{this.CreateDrop()},0),this.CanImportFolder="MobilePWA"!=h.s1}ionViewDidEnter(){this.global.p5key.KeyShortCut.Escape=()=>{this.is_ready?""==this.CurrentDir?this.navCtrl.pop():this.MoveToUpDir():(this.initLoadingElement.dismiss(),this.is_ready=!0)}}CreateDrop(){var t=this;let i=document.getElementById("p5Drop_userfs");this.p5canvas=new T(n=>{n.setup=()=>{let c=n.createCanvas(i.clientWidth,i.clientHeight);c.parent(i),n.pixelDensity(1),c.drop(p=>{let g=n.millis();a<g-400?(s=!1,u.length=0,u.push(p)):(s=!0,u.push(p)),a=g,clearTimeout(o),o=setTimeout((0,m.c)(function*(){if(s)t.MultipleDrops(u);else{let f=yield t.loadingCtrl.create({message:t.lang.text.TodoDetail.WIP});f.present(),t.importSelected(p.file),f.dismiss()}}),400)})};let o,s=!1,a=0,u=[];n.mouseMoved=c=>{c.dataTransfer?(i.style.pointerEvents="all",i.style.backgroundColor="#0008"):(i.style.pointerEvents="none",i.style.backgroundColor="transparent")}})}CreateNewFolder(){var i,t=this;this.alertCtrl.create({header:this.lang.text.UserFsDir.CreateFolder,inputs:[{type:"text",placeholder:this.lang.text.UserFsDir.FolderName}],buttons:[{text:this.lang.text.UserFsDir.Create,handler:(i=(0,m.c)(function*(n){if(n[0])try{let o=`${t.CurrentDir}/${n[0]}`;yield t.indexed.createDirectory(o);let s=yield t.indexed.GetFileInfoFromDB(o),a={path:o,mode:s.mode,timestamp:s.timestamp,db:t.indexed.ionicDB};a.name=n[0],a.dir=t.CurrentDir,t.DirList.push(a)}catch(o){console.error("\ud3f4\ub354 \uc0dd\uc131 \uc2e4\ud328: ",o),t.p5toast.show({text:`${t.lang.text.UserFsDir.FailedToCreateFolder}: ${o}`})}else t.p5toast.show({text:t.lang.text.UserFsDir.NeedFolderName})}),function(o){return i.apply(this,arguments)})}]}).then(i=>i.present())}SelectFiles(){document.getElementById("import_file").click()}MultipleDrops(t){var i=this;return(0,m.c)(function*(){let n=yield i.loadingCtrl.create({message:i.lang.text.TodoDetail.WIP});n.present();for(let o=0,s=t.length;o<s;o++)yield i.importSelected(t[o].file);n.dismiss()})()}inputFileSelected(t){var i=this;return(0,m.c)(function*(){if(t.target.files.length)if(1!=t.target.files.length){let o=yield i.loadingCtrl.create({message:i.lang.text.UserFsDir.MultipleSave});o.present(),i.noti.noti.schedule({id:4,title:i.lang.text.UserFsDir.MultipleSave,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://diychat",color:"b0b0b0"});for(let s=0,a=t.target.files.length;s<a;s++)o.message=`${i.lang.text.UserFsDir.MultipleSave}: ${a-s}`,i.noti.noti.schedule({id:4,title:i.lang.text.UserFsDir.MultipleSave,progressBar:{value:s,maxValue:a},sound:null,smallIcon:"res://diychat",color:"b0b0b0"}),yield i.importSelected(t.target.files[s]);i.noti.ClearNoti(4),o.dismiss()}else{let o=yield i.loadingCtrl.create({message:i.lang.text.TodoDetail.WIP});o.present(),yield i.importSelected(t.target.files[0]),o.dismiss()}})()}importSelected(t){var i=this;return(0,m.c)(function*(){try{let n=`${i.CurrentDir}/${t.name}`;yield i.indexed.saveBlobToUserPath(t,n);let o=yield i.indexed.GetFileInfoFromDB(n),s={path:n,mode:o.mode,timestamp:o.timestamp,db:i.indexed.ionicDB};s.name=t.name,s.dir=i.CurrentDir,s.file_ext=s.name.split(".").pop(),i.global.set_viewer_category_from_ext(s),"image"==s.viewer&&i.indexed.loadBlobFromUserPath(s.path,"",a=>{let u=URL.createObjectURL(a);s.thumbnail=i.sanitizer.bypassSecurityTrustUrl(u)});try{let a=s.path.split("/");if(5!=a.length||"groups"!=a[3])throw"\uadf8\ub8f9 \uc774\ubbf8\uc9c0 \ud30c\uc77c\uc774 \uc544\ub2d8";i.SetDisplayGroupImageName(s,a)}catch{}for(let a=0,u=i.FileList.length;a<u;a++)if(i.FileList[a].path==n){i.FileList.splice(a,1);break}i.FileList.push(s)}catch(n){console.log("importSelected error: ",n)}})()}ionViewWillEnter(){this.HideThumbnail="1"==localStorage.getItem("user-fs-thumbnail"),this.CurrentDir="",this.is_file_selector=!!this.navParams.data.modal,this.LoadAllIndexedFiles(),("DesktopPWA"==h.s1||"MobilePWA"==h.s1)&&(this.cant_dedicated=!0),document.addEventListener("ionBackButton",this.EventListenerAct)}dismiss_page(t){var i=this;return(0,m.c)(function*(){if(i.is_file_selector){let n;t&&(n=yield i.indexed.loadBlobFromUserPath(t.path,""),n.name=t.name,n.file_ext=t.file_ext),i.modalCtrl.dismiss(n)}})()}LoadAllIndexedFiles(){var t=this;return(0,m.c)(function*(){if(t.initLoadingElement=yield t.loadingCtrl.create({message:t.lang.text.UserFsDir.LoadingExplorer}),t.initLoadingElement.present(),t.DirList.length=0,t.FileList.length=0,("Android"==h.s1||"iOS"==h.s1)&&t.noti.noti.schedule({id:5,title:t.lang.text.UserFsDir.LoadingExplorer,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"}),t.is_file_selector)if(t.navParams.get("path")){let i=yield t.indexed.GetFileListFromDB(t.navParams.get("path"));yield t.ModulateIndexedFile(i)}else{let i=yield t.indexed.GetFileListFromDB("/files/"),n=yield t.indexed.GetFileListFromDB("/todo/");i.push.apply(i,n),yield t.ModulateIndexedFile(i)}else{if(t.indexed.godotDB){let n=yield t.indexed.GetFileListFromDB("/",void 0,t.indexed.godotDB);yield t.ModulateIndexedFile(n,t.indexed.godotDB)}let i=yield t.indexed.GetFileListFromDB("/");yield t.ModulateIndexedFile(i)}t.FileList.sort((i,n)=>i.path>n.path?1:i.path<n.path?-1:0),t.DirList.sort((i,n)=>i.path>n.path?1:i.path<n.path?-1:0),setTimeout(()=>{t.noti.ClearNoti(5)},100),t.initLoadingElement.dismiss(),t.is_ready=!0})()}ModulateIndexedFile(t,i=this.indexed.ionicDB){var n=this;return(0,m.c)(function*(){for(let o=0,s=t.length;o<s;o++){if(n.StopIndexing)return;let a=`${n.lang.text.UserFsDir.LoadingExplorer}: ${t.length-o}`;("Android"==h.s1||"iOS"==h.s1)&&n.noti.noti.schedule({id:5,title:a,progressBar:{value:o,maxValue:t.length},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"}),n.initLoadingElement.message=a,yield n.indexed.GetFileInfoFromDB(t[o],u=>{let c={path:t[o],mode:u.mode,timestamp:u.timestamp,db:i};switch(c.name=c.path.substring(c.path.lastIndexOf("/")+1),c.dir=t[o].substring(0,t[o].lastIndexOf("/")),c.mode){case 33206:c.file_ext=c.name.split(".").pop(),n.global.set_viewer_category_from_ext(c),"image"==c.viewer&&n.indexed.loadBlobFromUserPath(c.path,"",f=>{let y=URL.createObjectURL(f);c.thumbnail=n.sanitizer.bypassSecurityTrustUrl(y)},i);try{let f=c.path.split("/");if(5!=f.length||"groups"!=f[3])throw"\uadf8\ub8f9 \uc774\ubbf8\uc9c0 \ud30c\uc77c\uc774 \uc544\ub2d8";n.SetDisplayGroupImageName(c,f)}catch{}n.FileList.push(c);break;case 16893:0==c.path.indexOf("todo/")&&n.SetDisplayTodoName(c);let p=!1,g=c.path.split("/");try{if(5!=g.length||"channels"!=g[3])throw"\ucc44\ub110 \ud3f4\ub354\uac00 \uc544\ub2d8";n.SetDisplayChannelName(c,g),p=!0}catch{}try{if(p||5!=g.length||"users"!=g[3])throw"\uc0ac\uc6a9\uc790 \ud3f4\ub354\uac00 \uc544\ub2d8";n.SetDisplayUserName(c,g),p=!0}catch{}n.DirList.push(c);break;default:console.log("\uc608\uc0c1\ud558\uc9c0 \ubabb\ud55c \ud30c\uc77c \ubaa8\ub4dc: ",c)}},i)}})()}SetDisplayTodoName(t){var i=this;return(0,m.c)(function*(){try{let n=yield i.indexed.loadTextFromUserPath(`${t.path}/info.todo`),o=JSON.parse(n);t.name=o.title}catch(n){console.error("SetDisplayTodoName error: ",n)}})()}SetDisplayUserName(t,i){try{t.name=this.nakama.users[i[1]][i[2]][i[4]].display_name}catch{}}SetDisplayChannelName(t,i){try{t.name=this.nakama.channels_orig[i[1]][i[2]][t.name].title}catch{}}SetDisplayGroupImageName(t,i){try{t.name=`${this.nakama.groups[i[1]][i[2]][i[4].split(".").shift()].name}.img`}catch(n){console.error("SetDisplayGroupImageName error: ",n)}}MoveToUpDir(){this.CurrentDir=this.CurrentDir.substring(0,this.CurrentDir.lastIndexOf("/")),this.FileSel.value=void 0}SelectFolder(t){this.CurrentDir=t.path,this.FileSel.value=void 0}OpenFile(t){var i=this;return(0,m.c)(function*(){if(!i.CheckIfAccessable(t.path))return;document.removeEventListener("ionBackButton",i.EventListenerAct);let n=[];if(i.is_file_selector){if(i.navParams.data.path)for(let o=0,s=i.FileList.length;o<s;o++)n.push({content:i.FileList[o]})}else for(let o=0,s=i.FileList.length;o<s;o++)i.FileList[o].dir==i.CurrentDir&&n.push({content:i.FileList[o]});{let o=yield i.indexed.loadBlobFromUserPath(t.path,"");t.size=o.size}i.modalCtrl.create({component:v.K,componentProps:{info:{content:t},targetDB:i.indexed.ionicDB,no_edit:!0,path:t.path,relevance:n},cssClass:"fullscreen"}).then(o=>{delete i.global.p5key.KeyShortCut.Escape,delete i.global.p5key.KeyShortCut.Digit,o.onDidDismiss().then(s=>{if(s.data)switch(s.data.type){case"image":return void i.modalCtrl.create({component:E.S,componentProps:{path:s.data.path,width:s.data.width,height:s.data.height,text:s.data.text},cssClass:"fullscreen"}).then(a=>{a.onWillDismiss().then(function(){var u=(0,m.c)(function*(c){let p=i.global.Base64ToBlob(c.data.img,"image/png");p.name=c.data.name,yield i.importSelected(p),c.data.loadingCtrl.dismiss(),document.addEventListener("ionBackButton",i.EventListenerAct),i.ionViewDidEnter()});return function(c){return u.apply(this,arguments)}}()),a.present()});case"text":console.log(s),i.importSelected(s.data.blob)}else document.addEventListener("ionBackButton",i.EventListenerAct),i.ionViewDidEnter()}),o.present()})})()}CheckIfAccessable(t){switch(t){case"servers/webrtc_server.json":case"servers/self/profile.json":return this.p5toast.show({text:this.lang.text.UserFsDir.PrivateAccessDenied}),!1}return!0}DownloadFile(t){this.CheckIfAccessable(t.path)&&this.indexed.DownloadFileFromUserPath(t.path,"",t.name)}ExportDirectoryRecursive(){this.alertCtrl.create({header:this.lang.text.UserFsDir.ExportDirTitle,message:this.lang.text.UserFsDir.ExportDirMsg,buttons:[{text:this.lang.text.UserFsDir.ExportConfirm,handler:()=>{this.ExportDirectoryRecursiveAct()}}]}).then(t=>t.present())}ExportDirectoryRecursiveAct(){var t=this;return(0,m.c)(function*(){let i=yield t.loadingCtrl.create({message:t.lang.text.UserFsDir.ExportDirTitle});i.present();let n=yield t.indexed.GetFileListFromDB(t.CurrentDir);for(let o=0,s=n.length;o<s;o++){let a=yield t.indexed.GetFileInfoFromDB(n[o]),u=yield t.indexed.loadBlobFromUserPath(n[o],""),c=n[o].lastIndexOf("/"),p=n[o].substring(0,c),g=n[o].substring(c+1);t.isCreateFolderRecursive||(t.isCreateFolderRecursive=!0,yield t.CreateFolderRecursive(p));try{if(16893==a.mode)throw yield t.file.createDir(t.file.externalDataDirectory+p,g,!0),i.message=`${t.lang.text.UserFsDir.ExportDirTitle}: ${g}`,"\uc774\uac70 \ud3f4\ub354\uc784";if(!t.CheckIfAccessable(n[o]))throw"\uc5f4\ub78c \ubd88\uac00 \ud30c\uc77c \uc81c\uc678";i.message=`${t.lang.text.UserFsDir.ExportDirTitle}: ${g}`,yield t.file.writeFile(t.file.externalDataDirectory+p+"/",g,u,{replace:!0})}catch(f){console.error(n[o],": \ud30c\uc77c \uc800\uc7a5 \uc2e4\ud328: ",f)}}t.isCreateFolderRecursive=!1,i.dismiss()})()}CreateFolderRecursive(t){var i=this;return(0,m.c)(function*(){let n=t.lastIndexOf("/")+1,o=t.substring(0,n),s=t.substring(n);o&&(yield i.CreateFolderRecursive(t.substring(0,n-1)));try{yield i.file.createDir(i.file.externalDataDirectory+o,s,!0)}catch{}})()}BrowseExternalFiles(){var t=this;return(0,m.c)(function*(){t.ExternalFolder.length=0,t.InAppBrowser=!1,t.ExternalFolder=yield t.file.listDir(t.file.externalApplicationStorageDirectory,"files"),t.ExternalFolder.sort(),t.ExternalFolder.sort((i,n)=>i.isDirectory?-1:1)})()}importFolderMiddleAct(t){var i=this;return(0,m.c)(function*(){let n=yield i.loadingCtrl.create({message:i.lang.text.UserFsDir.Import});n.present(),yield i.importThisFolder(t,n),i.InAppBrowser=!0,n.dismiss(),i.p5toast.show({text:i.lang.text.UserFsDir.NeedResetToApply})})()}importThisFolder(t,i){var n=this;return(0,m.c)(function*(){let o=t.nativeURL.substring(0,t.nativeURL.length-1),s=o.lastIndexOf("/"),a=yield n.file.listDir(o.substring(0,s)+"/",o.substring(s+1));for(let u=0,c=a.length;u<c;u++)if(a[u].isDirectory)yield n.importThisFolder(a[u],i);else{let p=a[u].nativeURL.split("org.pjcone.portal/files/")[1];console.log("Now importing: ",p);try{let f=(yield G.readFile({path:a[u].nativeURL})).data.replace(/"|\\|=/g,"");yield n.indexed.saveBase64ToUserPath(","+f,decodeURIComponent(p)),i.message=`${n.lang.text.UserFsDir.Import}: ${a[u].name}`}catch(g){console.log("\ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",g),n.p5toast.show({text:`${n.lang.text.UserFsDir.ImportFailed}: ${g}`})}}})()}SelectImportFolder(){this.cant_dedicated?document.getElementById("folder_sel_id").click():this.BrowseExternalFiles()}inputImageSelected(t){var i=this;return(0,m.c)(function*(){let n=yield i.loadingCtrl.create({message:i.lang.text.UserFsDir.LoadingExplorer});n.present();for(let o=0,s=t.target.files.length;o<s;o++)yield i.indexed.saveBlobToUserPath(t.target.files[o],t.target.files[o].webkitRelativePath);i.LoadAllIndexedFiles(),n.dismiss(),i.p5toast.show({text:i.lang.text.UserFsDir.NeedResetToApply})})()}RemoveDirectoryRecursive(){var i,t=this;this.alertCtrl.create({header:this.CurrentDir.substring(this.CurrentDir.lastIndexOf("/")+1)||this.lang.text.UserFsDir.ResetDB,message:this.lang.text.UserFsDir.RemoveThisFolder,buttons:[{text:this.lang.text.UserFsDir.RemoveApply,handler:(i=(0,m.c)(function*(){let n=yield t.loadingCtrl.create({message:t.lang.text.UserFsDir.DeleteFile});n.present(),("Android"==h.s1||"iOS"==h.s1)&&t.noti.noti.schedule({id:4,title:t.lang.text.UserFsDir.DeleteFile,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"});let o=yield t.indexed.GetFileListFromDB(t.CurrentDir);for(let s=0,a=o.length;s<a;s++)("Android"==h.s1||"iOS"==h.s1)&&t.noti.noti.schedule({id:5,title:`${t.lang.text.UserFsDir.DeleteFile}: ${a-s}`,progressBar:{value:s,maxValue:a},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"}),n.message=`${t.lang.text.UserFsDir.DeleteFile}: ${a-s}`,yield t.indexed.removeFileFromUserPath(o[s]);for(let s=t.DirList.length-1;s>=0;s--)0==t.DirList[s].path.indexOf(t.CurrentDir)&&t.DirList.splice(s,1);for(let s=t.FileList.length-1;s>=0;s--)0==t.FileList[s].path.indexOf(t.CurrentDir)&&t.FileList.splice(s,1);o=yield t.indexed.GetFileListFromDB(t.CurrentDir);for(let s=0,a=o.length;s<a;s++)("Android"==h.s1||"iOS"==h.s1)&&t.noti.noti.schedule({id:5,title:`${t.lang.text.UserFsDir.DeleteFile}: ${a-s}`,progressBar:{value:s,maxValue:a},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"}),n.message=`${t.lang.text.UserFsDir.DeleteFile}: ${a-s}`,yield t.indexed.removeFileFromUserPath(o[s]);for(let s=t.DirList.length-1;s>=0;s--)0==t.DirList[s].path.indexOf(t.CurrentDir)&&t.DirList.splice(s,1);for(let s=t.FileList.length-1;s>=0;s--)0==t.FileList[s].path.indexOf(t.CurrentDir)&&t.FileList.splice(s,1);t.MoveToUpDir(),n.dismiss(),setTimeout(()=>{t.noti.ClearNoti(4)},100)}),function(){return i.apply(this,arguments)}),cssClass:"red_font"}]}).then(i=>i.present())}RemoveFile(t,i){this.alertCtrl.create({header:this.lang.text.UserFsDir.DeleteFile,message:this.lang.text.UserFsDir.CannotBeUndo,buttons:[{text:this.lang.text.UserFsDir.DeleteAccept,handler:()=>{this.indexed.removeFileFromUserPath(t.path,()=>{this.FileList.splice(i,1)})},cssClass:"red_font"}]}).then(n=>n.present())}ionViewDidLeave(){this.StopIndexing=!0,this.FileList.forEach(t=>{URL.revokeObjectURL(t.thumbnail)}),this.noti.ClearNoti(4),this.noti.ClearNoti(5)}ionViewWillLeave(){document.removeEventListener("ionBackButton",this.EventListenerAct),delete this.global.p5key.KeyShortCut.Escape,delete this.global.p5key.KeyShortCut.Digit}}return(l=d).\u0275fac=function(t){return new(t||l)(e.GI1(F.qS),e.GI1(R.k),e.GI1(F.Kg),e.GI1(O.o),e.GI1(k.A1),e.GI1(P.O),e.GI1(F.iW),e.GI1(L.mI),e.GI1(w.S),e.GI1(I.wX),e.GI1($.s),e.GI1(I.a6),e.GI1(S.h))},l.\u0275cmp=e.In1({type:l,selectors:[["app-user-fs-dir"]],viewQuery:function(t,i){if(1&t&&e.CC$(B,5),2&t){let n;e.wto(n=e.Gqi())&&(i.FileSel=n.first)}},decls:13,vars:5,consts:[[1,"ion-no-border"],["slot","start",3,"click"],["defaultHref",""],["class","top_icon","slot","end","name","eye-outline",3,"click",4,"ngIf"],["class","top_icon","slot","end","name","eye-off-outline",3,"click",4,"ngIf"],["oncontextmenu","return false;"],["id","p5Drop_userfs",2,"position","absolute","width","100%","height","100%","display","flex","pointer-events","none"],["hidden","","type","file","id","import_file","accept","*","multiple","",3,"change"],[4,"ngIf"],["slot","end","name","eye-outline",1,"top_icon",3,"click"],["slot","end","name","eye-off-outline",1,"top_icon",3,"click"],["button",""],["slot","start","name","folder"],["class","folder_button",3,"click",4,"ngIf"],[1,"folder_button",3,"click"],[3,"click"],["button","",3,"click",4,"ngIf"],[4,"ngFor","ngForOf"],["FileSel",""],["button","",3,"click"],["slot","start","name","arrow-down-circle"],["hidden","","type","file","id","folder_sel_id","webkitdirectory","",3,"change"],[3,"value",4,"ngIf"],[3,"value"],["slot","header"],["slot","start","name","image",4,"ngIf"],["slot","start","name","musical-notes",4,"ngIf"],["slot","start","name","play-circle",4,"ngIf"],["slot","start","name","reader",4,"ngIf"],["slot","start","name","extension-puzzle",4,"ngIf"],["slot","start","name","document",4,"ngIf"],["text-wrap","",4,"ngIf"],[1,"ion-accordion-toggle-icon","hide_accordion_icon"],["slot","content"],["class","ion-text-right button_dist",3,"click",4,"ngIf"],[1,"ion-text-end","button_dist",3,"click"],["class","image_front_form",3,"click",4,"ngIf"],["slot","start","name","image"],["slot","start","name","musical-notes"],["slot","start","name","play-circle"],["slot","start","name","reader"],["slot","start","name","extension-puzzle"],["slot","start","name","document"],["text-wrap",""],[1,"ion-text-right","button_dist",3,"click"],[1,"image_front_form",3,"click"],[1,"image_front_view",3,"src","alt"],["color","medium"],["button","","disabled","",4,"ngIf"],["button","","disabled",""]],template:function(t,i){1&t&&(e.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),e.OEk(3),e.C$Y(),e.I0R(4,"ion-buttons",1),e.qCj("click",function(){return i.dismiss_page()}),e.wR5(5,"ion-back-button",2),e.C$Y(),e.yuY(6,A,1,0,"ion-icon",3)(7,Y,1,0,"ion-icon",4),e.C$Y()(),e.I0R(8,"ion-content",5)(9,"div",6)(10,"input",7),e.qCj("change",function(o){return i.inputFileSelected(o)}),e.C$Y()(),e.yuY(11,oe,19,8,"ion-list",8)(12,de,6,1,"ion-list",8),e.C$Y()),2&t&&(e.yG2(3),e.cNF(i.lang.text.Settings.InAppExplorer),e.yG2(3),e.E7m("ngIf",!i.HideThumbnail),e.yG2(),e.E7m("ngIf",i.HideThumbnail),e.yG2(4),e.E7m("ngIf",i.InAppBrowser),e.yG2(),e.E7m("ngIf",!i.InAppBrowser))},dependencies:[b.ay,b.u_,F.cm,F.qU,F.sn,F.GS,F._i,F.wB,F.Ko,F.Yb,F.QR,F.OC,F.tM,F.Md,F.Im],styles:[".item.sc-ion-label-md-h[_ngcontent-%COMP%], .item[_ngcontent-%COMP%]   .sc-ion-label-md-h[_ngcontent-%COMP%]{overflow:unset}.image_front_form[_ngcontent-%COMP%]{display:flex;justify-content:center;text-align:center}.image_front_view[_ngcontent-%COMP%]{max-height:233px}.top_icon[_ngcontent-%COMP%]{width:28px;height:28px;padding-right:28px;cursor:pointer}.button_dist[_ngcontent-%COMP%]{padding-left:2px}.folder_button[_ngcontent-%COMP%]{padding-right:4px}"]}),d})()}}]);