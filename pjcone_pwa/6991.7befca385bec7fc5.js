"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6991],{6991:(ci,K,C)=>{C.r(K),C.d(K,{ChatRoomPageModule:()=>li});var X=C(177),D=C(4341),A=C(5374),U=C(9858),p=C(467),Z=C(617),ee=C(4237),Y=C(8326),N=C(92),te=C(7100),ie=C(2682),q=C(5402),F=C(9969),e=C(3953),se=C(3656),le=C(5547),re=C(8065),ce=C(755),de=C(4234),_e=C(345),he=C(9900),ue=C(7476),ge=C(3307);const fe=l=>({offset:l}),me=l=>({value:"",params:l});function pe(l,c){1&l&&e.nrm(0,"ion-icon",40)}function ve(l,c){1&l&&e.nrm(0,"ion-icon",41)}function be(l,c){if(1&l){const a=e.RV6();e.j41(0,"ion-icon",42),e.bIt("click",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.toggle_thumbnail())}),e.k0s()}}function xe(l,c){if(1&l){const a=e.RV6();e.j41(0,"ion-icon",43),e.bIt("click",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.toggle_thumbnail())}),e.k0s()}}function ke(l,c){1&l&&(e.j41(0,"div",44),e.EFF(1,"`"),e.k0s())}function Re(l,c){if(1&l){const a=e.RV6();e.j41(0,"div",62),e.bIt("click",function(){e.eBV(a);const i=e.XpG(3);return e.Njj(i.SetOtherAct())}),e.j41(1,"span",63),e.EFF(2),e.k0s()()}if(2&l){const a=e.XpG(2).$implicit;e.R7$(2),e.SpI(" ",a.displayDate," ")}}function Ce(l,c){if(1&l){const a=e.RV6();e.j41(0,"div",64),e.bIt("click",function(){e.eBV(a);const i=e.XpG(2).$implicit,n=e.XpG();return e.Njj(n.user_detail(i))}),e.nrm(1,"img",65),e.k0s()}if(2&l){const a=e.XpG(2).$implicit,t=e.XpG();e.R7$(),e.Aen(t.nakama.users[t.isOfficial][t.target][a.sender_id].online?"filter: grayscale(0) contrast(1);":"filter: grayscale(.9) contrast(1.4);"),e.Y8G("src",t.nakama.users[t.isOfficial][t.target][a.sender_id].img||"assets/data/avatar.svg",e.B4B)}}function Ie(l,c){if(1&l){const a=e.RV6();e.j41(0,"div")(1,"div",66)(2,"span",67),e.bIt("click",function(){e.eBV(a);const i=e.XpG(2).$implicit,n=e.XpG();return e.Njj(n.user_detail(i))}),e.j41(3,"b")(4,"span"),e.EFF(5),e.k0s()()(),e.j41(6,"span",68),e.bIt("click",function(){e.eBV(a);const i=e.XpG(3);return e.Njj(i.SetOtherAct())}),e.EFF(7),e.k0s()()()}if(2&l){const a=e.XpG(2).$implicit,t=e.XpG();e.R7$(4),e.Aen("color: "+(t.nakama.users[t.isOfficial][t.target][a.sender_id].online?a.color:"var(--offline-user-color)")),e.R7$(),e.SpI(" ",t.nakama.usernameOverride[t.isOfficial][t.target][a.sender_id]||a.user_display_name||t.lang.text.Profile.noname_user,""),e.R7$(2),e.JRh(a.msgTime)}}function ye(l,c){if(1&l&&(e.j41(0,"div",73),e.nrm(1,"img",74),e.k0s()),2&l){const a=e.XpG(3).$implicit,t=e.XpG();e.R7$(),e.Aen(t.info.HideAutoThumbnail?"filter: blur(6px);":""),e.Y8G("src",a.content.qoute.url,e.B4B)}}function we(l,c){if(1&l&&(e.j41(0,"div",75),e.EFF(1),e.k0s()),2&l){const a=e.XpG(3).$implicit;e.R7$(),e.SpI(" ",a.content.qoute.text,"")}}function Me(l,c){if(1&l){const a=e.RV6();e.j41(0,"div",69),e.bIt("click",function(){e.eBV(a);const i=e.XpG(2).$implicit,n=e.XpG();return e.Njj(n.FindQoute(i.content.qoute.id,i.content.qoute.timestamp))}),e.j41(1,"div",70),e.EFF(2),e.k0s(),e.DNE(3,ye,2,3,"div",71)(4,we,2,1,"div",72),e.k0s()}if(2&l){const a=e.XpG(2).$implicit,t=e.XpG();e.R7$(2),e.JRh(t.lang.text.ChatRoom.qouteMsg+": "+(a.content.qoute.username||a.content.qoute.display_name)),e.R7$(),e.Y8G("ngIf",a.content.qoute.url),e.R7$(),e.Y8G("ngIf",a.content.qoute.text)}}function Te(l,c){1&l&&(e.j41(0,"div",44),e.EFF(1,"Q"),e.k0s())}function $e(l,c){1&l&&e.nrm(0,"div",84)}function Oe(l,c){if(1&l&&(e.j41(0,"span",85),e.EFF(1),e.k0s()),2&l){const a=c.$implicit;e.R7$(),e.SpI(" ",a," ")}}function Fe(l,c){if(1&l){const a=e.RV6();e.j41(0,"div",80),e.bIt("click",function(){e.eBV(a);const i=e.XpG(3).$implicit,n=e.XpG();return e.Njj(n.file_detail(i))}),e.DNE(1,Te,2,0,"div",17),e.j41(2,"p",81),e.EFF(3),e.k0s(),e.DNE(4,$e,1,0,"div",82)(5,Oe,2,1,"span",83),e.k0s()}if(2&l){const a=e.XpG(3).$implicit,t=e.XpG();e.Aen(t.info.HideAutoThumbnail?"filter: blur(6px);":""),e.R7$(),e.Y8G("ngIf",t.global.ShowHint&&!t.CheckIfFocusOnInput&&(0==t.ChatLogs.scrollTop&&t.CheckIfHasScroll&&a==t.Attach.first||(0!=t.ChatLogs.scrollTop||!t.CheckIfHasScroll)&&a==t.Attach.last)),e.R7$(2),e.SpI(" ",a.content.filename," "),e.R7$(),e.Y8G("ngIf",a.content.text),e.R7$(),e.Y8G("ngForOf",a.content.text)}}function Ae(l,c){1&l&&(e.j41(0,"div",44),e.EFF(1,"Q"),e.k0s())}function Se(l,c){if(1&l){const a=e.RV6();e.j41(0,"div",86),e.bIt("click",function(){e.eBV(a);const i=e.XpG(3).$implicit,n=e.XpG();return e.Njj(n.file_detail(i))}),e.DNE(1,Ae,2,0,"div",17),e.nrm(2,"img",87),e.k0s()}if(2&l){const a=e.XpG(3).$implicit,t=e.XpG();e.R7$(),e.Y8G("ngIf",t.global.ShowHint&&!t.CheckIfFocusOnInput&&(0==t.ChatLogs.scrollTop&&t.CheckIfHasScroll&&a==t.Attach.first||(0!=t.ChatLogs.scrollTop||!t.CheckIfHasScroll)&&a==t.Attach.last)),e.R7$(),e.Aen(t.info.HideAutoThumbnail?"filter: blur(6px);":""),e.Y8G("src",a.content.thumbnail,e.B4B)("alt",a.content.filename)}}function Pe(l,c){if(1&l&&(e.j41(0,"div",88),e.EFF(1),e.k0s()),2&l){const a=e.XpG(3).$implicit;e.R7$(),e.SpI(" ",a.content.transfer_index.index,"")}}function Ve(l,c){if(1&l&&(e.j41(0,"div",76),e.DNE(1,Fe,6,6,"div",77)(2,Se,3,5,"div",78)(3,Pe,2,1,"div",79),e.k0s()),2&l){const a=e.XpG(2).$implicit;e.R7$(),e.Y8G("ngIf",!a.content.thumbnail),e.R7$(),e.Y8G("ngIf",a.content.thumbnail),e.R7$(),e.Y8G("ngIf",a.content.transfer_index)}}function Ee(l,c){if(1&l){const a=e.RV6();e.j41(0,"span",97),e.bIt("click",function(){e.eBV(a);const i=e.XpG(6);return e.Njj(i.SetOtherAct())}),e.EFF(1),e.k0s()}if(2&l){const a=e.XpG().$implicit;e.Aen("font-size: "+(a.size||16)+"px"),e.R7$(),e.SpI(" ",a.text," ")}}function Le(l,c){if(1&l){const a=e.RV6();e.j41(0,"a",98),e.bIt("click",function(i){e.eBV(a);const n=e.XpG().$implicit,o=e.XpG(5);return e.Njj(o.open_url_link(i,n.text))}),e.EFF(1),e.k0s()}if(2&l){const a=e.XpG().$implicit;e.Y8G("href",a.text,e.B4B),e.R7$(),e.JRh(a.text)}}function je(l,c){if(1&l&&(e.j41(0,"span"),e.DNE(1,Ee,2,3,"span",95)(2,Le,2,2,"a",96),e.k0s()),2&l){const a=c.$implicit;e.R7$(),e.Y8G("ngIf",!a.href),e.R7$(),e.Y8G("ngIf",a.href)}}function Ge(l,c){if(1&l&&(e.j41(0,"div",93)(1,"span"),e.DNE(2,je,3,2,"span",94),e.k0s()()),2&l){const a=c.$implicit;e.R7$(2),e.Y8G("ngForOf",a)}}function Be(l,c){if(1&l&&(e.j41(0,"div",99),e.EFF(1),e.k0s()),2&l){const a=e.XpG(4);e.R7$(),e.SpI(" ","("+a.lang.text.ChatRoom.MsgEdited+")","")}}function De(l,c){if(1&l&&(e.j41(0,"div",89)(1,"div",90),e.DNE(2,Ge,3,1,"div",91),e.k0s(),e.DNE(3,Be,2,1,"div",92),e.k0s()),2&l){const a=e.XpG(2).$implicit;e.R7$(),e.Aen(a.content.msg[0]&&a.content.msg[0][0].size?"padding: 0; margin: 0":"background-color: "+(a.color_bg||a.color+"bb")),e.R7$(),e.Y8G("ngForOf",a.content.msg),e.R7$(),e.Y8G("ngIf",a.content.edited)}}function Ue(l,c){if(1&l&&e.nrm(0,"img",103),2&l){const a=e.XpG(3).$implicit,t=e.XpG();e.Aen(t.info.HideAutoThumbnail?"filter: blur(6px);":""),e.Y8G("src",a.content.hasLink.imageUrl,e.B4B)("alt",a.content.hasLink.imageAlt)}}function Ne(l,c){if(1&l){const a=e.RV6();e.j41(0,"div",100)(1,"div",101),e.bIt("click",function(i){e.eBV(a);const n=e.XpG(2).$implicit,o=e.XpG();return e.Njj(o.open_url_link(i,n.content.hasLink.url))}),e.EFF(2),e.DNE(3,Ue,1,4,"img",102),e.k0s()()}if(2&l){const a=e.XpG(2).$implicit;e.Y8G("@link_info",void 0),e.R7$(2),e.SpI(" ",a.content.hasLink.title," "),e.R7$(),e.Y8G("ngIf",a.content.hasLink.imageUrl)}}function He(l,c){if(1&l&&(e.j41(0,"div",104),e.EFF(1),e.k0s()),2&l){const a=e.XpG(3);e.R7$(),e.SpI(" ",a.lang.text.ChatRoom.YouReadHereLast,"")}}function Xe(l,c){if(1&l&&(e.j41(0,"div",51),e.DNE(1,Re,3,1,"div",52),e.j41(2,"table")(3,"tr")(4,"td",53),e.DNE(5,Ce,2,3,"div",54),e.k0s(),e.j41(6,"td"),e.DNE(7,Ie,8,4,"div",55)(8,Me,5,3,"div",56)(9,Ve,4,3,"div",57)(10,De,4,4,"div",58),e.k0s()()(),e.DNE(11,Ne,4,3,"div",59),e.j41(12,"div",60),e.DNE(13,He,2,1,"div",61),e.k0s()()),2&l){const a=e.XpG().$implicit;e.R7$(),e.Y8G("ngIf",a.showInfo&&a.showInfo.date),e.R7$(4),e.Y8G("ngIf",a.showInfo&&a.showInfo.sender),e.R7$(2),e.Y8G("ngIf",a.showInfo&&a.showInfo.sender),e.R7$(),e.Y8G("ngIf",a.content.qoute),e.R7$(),e.Y8G("ngIf",a.content.filename),e.R7$(),e.Y8G("ngIf",a.content.msg),e.R7$(),e.Y8G("ngIf",a.content.hasLink),e.R7$(2),e.Y8G("ngIf",a.isLastRead)}}function Ye(l,c){if(1&l){const a=e.RV6();e.j41(0,"div",62),e.bIt("click",function(){e.eBV(a);const i=e.XpG(3);return e.Njj(i.SetOtherAct())}),e.j41(1,"span",63),e.EFF(2),e.k0s()()}if(2&l){const a=e.XpG(2).$implicit;e.R7$(2),e.SpI(" ",a.displayDate," ")}}function qe(l,c){if(1&l){const a=e.RV6();e.j41(0,"div",113)(1,"div",66)(2,"span",114),e.bIt("click",function(){e.eBV(a);const i=e.XpG(3);return e.Njj(i.SetOtherAct())}),e.EFF(3),e.k0s(),e.j41(4,"span",67),e.bIt("click",function(){e.eBV(a);const i=e.XpG(2).$implicit,n=e.XpG();return e.Njj(n.user_detail(i))}),e.j41(5,"b")(6,"span"),e.EFF(7),e.k0s()()()()()}if(2&l){const a=e.XpG(2).$implicit,t=e.XpG();e.R7$(3),e.JRh(a.msgTime),e.R7$(3),e.Aen("color: "+(t.nakama.users.self.online?a.color:"var(--offline-user-color)")),e.R7$(),e.SpI(" ",a.user_display_name||t.lang.text.Profile.noname_user,"")}}function ze(l,c){if(1&l&&(e.j41(0,"div",73),e.nrm(1,"img",74),e.k0s()),2&l){const a=e.XpG(3).$implicit,t=e.XpG();e.R7$(),e.Aen(t.info.HideAutoThumbnail?"filter: blur(6px);":""),e.Y8G("src",a.content.qoute.url,e.B4B)}}function We(l,c){if(1&l&&(e.j41(0,"div",75),e.EFF(1),e.k0s()),2&l){const a=e.XpG(3).$implicit;e.R7$(),e.SpI(" ",a.content.qoute.text,"")}}function Qe(l,c){if(1&l){const a=e.RV6();e.j41(0,"div",69),e.bIt("click",function(){e.eBV(a);const i=e.XpG(2).$implicit,n=e.XpG();return e.Njj(n.FindQoute(i.content.qoute.id,i.content.qoute.timestamp))}),e.j41(1,"div",70),e.EFF(2),e.k0s(),e.DNE(3,ze,2,3,"div",71)(4,We,2,1,"div",72),e.k0s()}if(2&l){const a=e.XpG(2).$implicit,t=e.XpG();e.R7$(2),e.JRh(t.lang.text.ChatRoom.qouteMsg+": "+(a.content.qoute.username||a.content.qoute.display_name)),e.R7$(),e.Y8G("ngIf",a.content.qoute.url),e.R7$(),e.Y8G("ngIf",a.content.qoute.text)}}function Je(l,c){1&l&&(e.j41(0,"div",44),e.EFF(1,"Q"),e.k0s())}function Ke(l,c){1&l&&e.nrm(0,"div",84)}function Ze(l,c){if(1&l&&(e.j41(0,"span",85),e.EFF(1),e.k0s()),2&l){const a=c.$implicit;e.R7$(),e.SpI(" ",a," ")}}function et(l,c){if(1&l){const a=e.RV6();e.j41(0,"div",80),e.bIt("click",function(){e.eBV(a);const i=e.XpG(3).$implicit,n=e.XpG();return e.Njj(n.file_detail(i))}),e.DNE(1,Je,2,0,"div",17),e.j41(2,"p",81),e.EFF(3),e.k0s(),e.DNE(4,Ke,1,0,"div",82)(5,Ze,2,1,"span",83),e.k0s()}if(2&l){const a=e.XpG(3).$implicit,t=e.XpG();e.Aen(t.info.HideAutoThumbnail?"filter: blur(6px);":""),e.R7$(),e.Y8G("ngIf",t.global.ShowHint&&!t.CheckIfFocusOnInput&&(0==t.ChatLogs.scrollTop&&t.CheckIfHasScroll&&a==t.Attach.first||(0!=t.ChatLogs.scrollTop||!t.CheckIfHasScroll)&&a==t.Attach.last)),e.R7$(2),e.SpI(" ",a.content.filename," "),e.R7$(),e.Y8G("ngIf",a.content.text),e.R7$(),e.Y8G("ngForOf",a.content.text)}}function tt(l,c){1&l&&(e.j41(0,"div",44),e.EFF(1,"Q"),e.k0s())}function it(l,c){if(1&l){const a=e.RV6();e.j41(0,"div",86),e.bIt("click",function(){e.eBV(a);const i=e.XpG(3).$implicit,n=e.XpG();return e.Njj(n.file_detail(i))}),e.DNE(1,tt,2,0,"div",17),e.nrm(2,"img",87),e.k0s()}if(2&l){const a=e.XpG(3).$implicit,t=e.XpG();e.R7$(),e.Y8G("ngIf",t.global.ShowHint&&!t.CheckIfFocusOnInput&&(0==t.ChatLogs.scrollTop&&t.CheckIfHasScroll&&a==t.Attach.first||(0!=t.ChatLogs.scrollTop||!t.CheckIfHasScroll)&&a==t.Attach.last)),e.R7$(),e.Aen(t.info.HideAutoThumbnail?"filter: blur(6px);":""),e.Y8G("src",a.content.thumbnail,e.B4B)("alt",a.content.filename)}}function nt(l,c){if(1&l&&(e.j41(0,"div",88),e.EFF(1),e.k0s()),2&l){const a=e.XpG(3).$implicit;e.R7$(),e.SpI(" ",a.content.transfer_index.index,"")}}function at(l,c){if(1&l&&(e.j41(0,"div",113),e.DNE(1,et,6,6,"div",77)(2,it,3,5,"div",78)(3,nt,2,1,"div",79),e.k0s()),2&l){const a=e.XpG(2).$implicit;e.R7$(),e.Y8G("ngIf",!a.content.thumbnail),e.R7$(),e.Y8G("ngIf",a.content.thumbnail),e.R7$(),e.Y8G("ngIf",a.content.transfer_index)}}function ot(l,c){if(1&l&&(e.j41(0,"div",99),e.EFF(1),e.k0s()),2&l){const a=e.XpG(4);e.R7$(),e.SpI(" ","("+a.lang.text.ChatRoom.MsgEdited+")","")}}function st(l,c){if(1&l){const a=e.RV6();e.j41(0,"span",97),e.bIt("click",function(){e.eBV(a);const i=e.XpG(6);return e.Njj(i.SetOtherAct())}),e.EFF(1),e.k0s()}if(2&l){const a=e.XpG().$implicit;e.Aen("font-size: "+(a.size||16)+"px"),e.R7$(),e.SpI(" ",a.text," ")}}function lt(l,c){if(1&l){const a=e.RV6();e.j41(0,"a",98),e.bIt("click",function(i){e.eBV(a);const n=e.XpG().$implicit,o=e.XpG(5);return e.Njj(o.open_url_link(i,n.text))}),e.EFF(1),e.k0s()}if(2&l){const a=e.XpG().$implicit;e.Y8G("href",a.text,e.B4B),e.R7$(),e.JRh(a.text)}}function rt(l,c){if(1&l&&(e.j41(0,"span"),e.DNE(1,st,2,3,"span",95)(2,lt,2,2,"a",96),e.k0s()),2&l){const a=c.$implicit;e.R7$(),e.Y8G("ngIf",!a.href),e.R7$(),e.Y8G("ngIf",a.href)}}function ct(l,c){if(1&l&&(e.j41(0,"div",93)(1,"span"),e.DNE(2,rt,3,2,"span",94),e.k0s()()),2&l){const a=c.$implicit;e.R7$(2),e.Y8G("ngForOf",a)}}function dt(l,c){if(1&l&&(e.j41(0,"div",115),e.DNE(1,ot,2,1,"div",92),e.j41(2,"div",90),e.DNE(3,ct,3,1,"div",91),e.k0s()()),2&l){const a=e.XpG(2).$implicit;e.R7$(),e.Y8G("ngIf",a.content.edited),e.R7$(),e.Aen(a.content.msg[0]&&a.content.msg[0][0].size?"padding: 0; margin: 0":"background-color: "+(a.color_bg||a.color+"bb")),e.R7$(),e.Y8G("ngForOf",a.content.msg)}}function _t(l,c){if(1&l){const a=e.RV6();e.j41(0,"div",64),e.bIt("click",function(){e.eBV(a);const i=e.XpG(2).$implicit,n=e.XpG();return e.Njj(n.user_detail(i))}),e.nrm(1,"img",116),e.k0s()}if(2&l){const a=e.XpG(3);e.R7$(),e.Aen(a.nakama.users.self.online?"filter: grayscale(0) contrast(1);":"filter: grayscale(.9) contrast(1.4);"),e.Y8G("src",a.nakama.users.self.img||"assets/data/avatar.svg",e.B4B)}}function ht(l,c){if(1&l&&e.nrm(0,"img",103),2&l){const a=e.XpG(3).$implicit,t=e.XpG();e.Aen(t.info.HideAutoThumbnail?"filter: blur(6px);":""),e.Y8G("src",a.content.hasLink.imageUrl,e.B4B)("alt",a.content.hasLink.imageAlt)}}function ut(l,c){if(1&l){const a=e.RV6();e.j41(0,"div",117)(1,"div",101),e.bIt("click",function(i){e.eBV(a);const n=e.XpG(2).$implicit,o=e.XpG();return e.Njj(o.open_url_link(i,n.content.hasLink.url))}),e.EFF(2),e.DNE(3,ht,1,4,"img",102),e.k0s()()}if(2&l){const a=e.XpG(2).$implicit;e.Y8G("@link_info",void 0),e.R7$(2),e.SpI(" ",a.content.hasLink.title," "),e.R7$(),e.Y8G("ngIf",a.content.hasLink.imageUrl)}}function gt(l,c){if(1&l){const a=e.RV6();e.j41(0,"div",118),e.bIt("click",function(){e.eBV(a);const i=e.XpG(3);return e.Njj(i.SetOtherAct())}),e.EFF(1),e.k0s()}if(2&l){const a=e.XpG(3);e.R7$(),e.SpI(" ",a.lang.text.ChatRoom.YouReadHereLast,"")}}function ft(l,c){if(1&l){const a=e.RV6();e.j41(0,"div",105),e.DNE(1,Ye,3,1,"div",52),e.j41(2,"table",106)(3,"tr")(4,"td"),e.DNE(5,qe,8,4,"div",107),e.j41(6,"input",108),e.bIt("change",function(i){e.eBV(a);const n=e.XpG(2);return e.Njj(n.SelectVoidDrawBackgroundImage(i))}),e.k0s(),e.DNE(7,Qe,5,3,"div",56)(8,at,4,3,"div",107)(9,dt,4,4,"div",109),e.k0s(),e.j41(10,"td",110),e.DNE(11,_t,2,3,"div",54),e.k0s()()(),e.DNE(12,ut,4,3,"div",111),e.j41(13,"div",60),e.DNE(14,gt,2,1,"div",112),e.k0s()()}if(2&l){const a=e.XpG().$implicit,t=e.XpG();e.R7$(),e.Y8G("ngIf",a.showInfo&&a.showInfo.date),e.R7$(4),e.Y8G("ngIf",a.showInfo&&a.showInfo.sender),e.R7$(),e.Y8G("id",t.voidDrawContextId),e.R7$(),e.Y8G("ngIf",a.content.qoute),e.R7$(),e.Y8G("ngIf",a.content.filename),e.R7$(),e.Y8G("ngIf",a.content.msg),e.R7$(2),e.Y8G("ngIf",a.showInfo&&a.showInfo.sender),e.R7$(),e.Y8G("ngIf",a.content.hasLink),e.R7$(2),e.Y8G("ngIf",a.isLastRead)}}function mt(l,c){if(1&l){const a=e.RV6();e.j41(0,"div",119),e.bIt("click",function(){e.eBV(a);const i=e.XpG(2);return e.Njj(i.SetOtherAct())}),e.j41(1,"div",120),e.EFF(2),e.k0s()()}if(2&l){const a=e.XpG().$implicit;e.R7$(2),e.SpI(" ",a.content.noti," ")}}function pt(l,c){if(1&l){const a=e.RV6();e.j41(0,"div",45),e.bIt("contextmenu",function(){const i=e.eBV(a).$implicit,n=e.XpG();return e.Njj(n.ChatBalloonContextMenu(i))})("mousedown",function(i){const n=e.eBV(a).$implicit,o=e.XpG();return e.Njj(o.ChatBalloonMouseDown(i,n))})("touchstart",function(i){const n=e.eBV(a).$implicit,o=e.XpG();return e.Njj(o.ChatBalloonOnTouchStart(i,n))}),e.j41(1,"div",46),e.nrm(2,"div",47),e.k0s(),e.DNE(3,Xe,14,8,"div",48)(4,ft,15,9,"div",49)(5,mt,3,1,"div",50),e.k0s()}if(2&l){const a=c.$implicit;e.Y8G("@chat_lifecycle",e.eq3(8,me,e.eq3(6,fe,a.is_me?"20px":"-20px")))("id",a.message_id),e.R7$(2),e.Y8G("id",a.message_id+"_bg"),e.R7$(),e.Y8G("ngIf",!a.is_me&&!a.content.noti),e.R7$(),e.Y8G("ngIf",a.is_me&&!a.content.noti),e.R7$(),e.Y8G("ngIf",a.content.noti)}}function vt(l,c){if(1&l&&(e.j41(0,"div",73),e.nrm(1,"img",74),e.k0s()),2&l){const a=e.XpG(2).$implicit,t=e.XpG();e.R7$(),e.Aen(t.info.HideAutoThumbnail?"filter: blur(6px);":""),e.Y8G("src",a.content.qoute.url,e.B4B)}}function bt(l,c){if(1&l&&(e.j41(0,"div",75),e.EFF(1),e.k0s()),2&l){const a=e.XpG(2).$implicit;e.R7$(),e.SpI(" ",a.content.qoute.text,"")}}function xt(l,c){if(1&l){const a=e.RV6();e.j41(0,"div",69),e.bIt("click",function(){e.eBV(a);const i=e.XpG().$implicit,n=e.XpG();return e.Njj(n.FindQoute(i.content.qoute.id,i.content.qoute.timestamp))}),e.j41(1,"div",70),e.EFF(2),e.k0s(),e.DNE(3,vt,2,3,"div",71)(4,bt,2,1,"div",72),e.k0s()}if(2&l){const a=e.XpG().$implicit,t=e.XpG();e.R7$(2),e.JRh(t.lang.text.ChatRoom.qouteMsg+": "+(a.content.qoute.username||a.content.qoute.display_name)),e.R7$(),e.Y8G("ngIf",a.content.qoute.url),e.R7$(),e.Y8G("ngIf",a.content.qoute.text)}}function kt(l,c){1&l&&e.nrm(0,"div",84)}function Rt(l,c){if(1&l&&(e.j41(0,"span",85),e.EFF(1),e.k0s()),2&l){const a=c.$implicit;e.R7$(),e.SpI(" ",a," ")}}function Ct(l,c){if(1&l&&(e.j41(0,"div",124)(1,"p",81),e.EFF(2),e.k0s(),e.DNE(3,kt,1,0,"div",82)(4,Rt,2,1,"span",83),e.k0s()),2&l){const a=e.XpG(2).$implicit,t=e.XpG();e.Aen(t.info.HideAutoThumbnail?"filter: blur(6px);":""),e.R7$(2),e.SpI(" ",a.content.filename," "),e.R7$(),e.Y8G("ngIf",a.content.text),e.R7$(),e.Y8G("ngForOf",a.content.text)}}function It(l,c){if(1&l&&(e.j41(0,"div",125),e.nrm(1,"img",87),e.k0s()),2&l){const a=e.XpG(2).$implicit,t=e.XpG();e.R7$(),e.Aen(t.info.HideAutoThumbnail?"filter: blur(6px);":""),e.Y8G("src",a.content.thumbnail,e.B4B)("alt",a.content.filename)}}function yt(l,c){if(1&l&&(e.j41(0,"div",113),e.DNE(1,Ct,5,5,"div",122)(2,It,2,4,"div",123),e.k0s()),2&l){const a=e.XpG().$implicit;e.R7$(),e.Y8G("ngIf",!a.content.thumbnail),e.R7$(),e.Y8G("ngIf",a.content.thumbnail)}}function wt(l,c){if(1&l){const a=e.RV6();e.j41(0,"span",128),e.bIt("click",function(){e.eBV(a);const i=e.XpG(5);return e.Njj(i.SetOtherAct())}),e.EFF(1),e.k0s()}if(2&l){const a=e.XpG().$implicit;e.Aen("font-size: "+(a.size||16)+"px"),e.R7$(),e.SpI(" ",a.text," ")}}function Mt(l,c){if(1&l){const a=e.RV6();e.j41(0,"a",129),e.bIt("click",function(i){e.eBV(a);const n=e.XpG().$implicit,o=e.XpG(4);return e.Njj(o.open_url_link(i,n.text))}),e.EFF(1),e.k0s()}if(2&l){const a=e.XpG().$implicit;e.Y8G("href",a.text,e.B4B),e.R7$(),e.JRh(a.text)}}function Tt(l,c){if(1&l&&(e.j41(0,"span"),e.DNE(1,wt,2,3,"span",126)(2,Mt,2,2,"a",127),e.k0s()),2&l){const a=c.$implicit;e.R7$(),e.Y8G("ngIf",!a.href),e.R7$(),e.Y8G("ngIf",a.href)}}function $t(l,c){if(1&l&&(e.j41(0,"div",93)(1,"span"),e.DNE(2,Tt,3,2,"span",94),e.k0s()()),2&l){const a=c.$implicit;e.R7$(2),e.Y8G("ngForOf",a)}}function Ot(l,c){if(1&l&&(e.j41(0,"div",115)(1,"div",90),e.DNE(2,$t,3,1,"div",91),e.k0s()()),2&l){const a=e.XpG().$implicit;e.R7$(),e.Aen(a.content.msg[0]&&a.content.msg[0][0].size?"padding: 0; margin: 0":"background-color: #888b"),e.R7$(),e.Y8G("ngForOf",a.content.msg)}}function Ft(l,c){if(1&l&&(e.j41(0,"div",121),e.DNE(1,xt,5,3,"div",56)(2,yt,3,2,"div",107)(3,Ot,3,3,"div",109),e.k0s()),2&l){const a=c.$implicit;e.R7$(),e.Y8G("ngIf",a.content.qoute),e.R7$(),e.Y8G("ngIf",a.content.filename),e.R7$(),e.Y8G("ngIf",a.content.msg)}}function At(l,c){if(1&l&&(e.j41(0,"div",131),e.EFF(1),e.k0s()),2&l){const a=e.XpG(2);e.R7$(),e.JRh(a.userInput.qoute.text)}}function St(l,c){if(1&l&&(e.j41(0,"div",134),e.nrm(1,"img",74),e.k0s()),2&l){const a=e.XpG(2);e.R7$(),e.Aen("max-height: 84px;"+(a.info.HideAutoThumbnail?"filter: blur(6px);":"")),e.Y8G("src",a.userInput.qoute.url,e.B4B)}}function Pt(l,c){if(1&l){const a=e.RV6();e.j41(0,"tr",130),e.bIt("click",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.RemoveQoute())}),e.j41(1,"div",131),e.EFF(2),e.k0s(),e.DNE(3,At,2,1,"div",132)(4,St,2,3,"div",133),e.k0s()}if(2&l){const a=e.XpG();e.R7$(2),e.SpI("",a.lang.text.ChatRoom.qouteMsg+": "+(a.userInput.qoute.username||a.userInput.qoute.display_name)," "),e.R7$(),e.Y8G("ngIf",a.userInput.qoute.text),e.R7$(),e.Y8G("ngIf",a.userInput.qoute.url)}}function Vt(l,c){if(1&l&&(e.j41(0,"div",131),e.EFF(1),e.k0s()),2&l){const a=e.XpG(2);e.R7$(),e.JRh(a.userInput.memo.text)}}function Et(l,c){if(1&l&&(e.j41(0,"div",134),e.nrm(1,"img",74),e.k0s()),2&l){const a=e.XpG(2);e.R7$(),e.Aen("max-height: 84px;"+(a.info.HideAutoThumbnail?"filter: blur(6px);":"")),e.Y8G("src",a.userInput.memo.url,e.B4B)}}function Lt(l,c){if(1&l){const a=e.RV6();e.j41(0,"tr",130),e.bIt("click",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.RemoveQoute())}),e.j41(1,"div",131),e.EFF(2),e.k0s(),e.DNE(3,Vt,2,1,"div",132)(4,Et,2,3,"div",133),e.k0s()}if(2&l){const a=e.XpG();e.R7$(2),e.SpI("",a.lang.text.ChatRoom.memoMsgHere+": "+(a.userInput.memo.username||a.userInput.memo.display_name)," "),e.R7$(),e.Y8G("ngIf",a.userInput.memo.text),e.R7$(),e.Y8G("ngIf",a.userInput.memo.url)}}function jt(l,c){if(1&l&&(e.j41(0,"div",134),e.nrm(1,"img",74),e.k0s()),2&l){const a=e.XpG(2);e.R7$(),e.Aen("max-height: 84px;"+(a.info.HideAutoThumbnail?"filter: blur(6px);":"")),e.Y8G("src",a.IsMsgEditMode.thumbnail,e.B4B)}}function Gt(l,c){if(1&l){const a=e.RV6();e.j41(0,"tr",130),e.bIt("click",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.IsMsgEditMode=void 0)}),e.j41(1,"div",131),e.EFF(2),e.k0s(),e.DNE(3,jt,2,3,"div",133),e.k0s()}if(2&l){const a=e.XpG();e.R7$(2),e.SpI("",a.lang.text.ChatRoom.EditChat+": "+a.IsMsgEditMode.msg_string," "),e.R7$(),e.Y8G("ngIf",a.IsMsgEditMode.thumbnail)}}function Bt(l,c){if(1&l&&e.nrm(0,"img",140),2&l){const a=e.XpG(3);e.Y8G("src",a.userInput.file.thumbnail,e.B4B)("alt",a.userInput.file.name)}}function Dt(l,c){if(1&l&&(e.j41(0,"div"),e.DNE(1,Bt,1,2,"img",139),e.k0s()),2&l){const a=e.XpG(2);e.R7$(),e.Y8G("ngIf","image"==a.userInput.file.viewer)}}function Ut(l,c){if(1&l&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&l){const a=c.$implicit;e.R7$(),e.SpI(" ",a," ")}}function Nt(l,c){if(1&l&&(e.j41(0,"div",141),e.DNE(1,Ut,2,1,"span",94),e.k0s()),2&l){const a=e.XpG(2);e.R7$(),e.Y8G("ngForOf",a.userInput.file.thumbnail)}}function Ht(l,c){if(1&l){const a=e.RV6();e.j41(0,"tr",135)(1,"td")(2,"div",136),e.bIt("click",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.removeAttach())}),e.j41(3,"div",137),e.EFF(4),e.k0s(),e.DNE(5,Dt,2,1,"div",55)(6,Nt,2,1,"div",138),e.k0s()()()}if(2&l){const a=e.XpG();e.R7$(4),e.SpI(" ",a.userInput.file.filename," "),e.R7$(),e.Y8G("ngIf",a.userInput.file.thumbnail),e.R7$(),e.Y8G("ngIf","code"==a.userInput.file.viewer||"text"==a.userInput.file.viewer)}}function Xt(l,c){1&l&&(e.j41(0,"div",145),e.EFF(1," Enter"),e.k0s())}function Yt(l,c){if(1&l){const a=e.RV6();e.j41(0,"tr",142),e.bIt("click",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.scroll_down_logs())})("contextmenu",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.nakama.go_to_chatroom(i.nakama.channels_orig[i.isOfficial][i.target][i.info.id]))}),e.j41(1,"td",143),e.DNE(2,Xt,2,0,"div",144),e.EFF(3),e.k0s()()}if(2&l){const a=e.XpG();e.R7$(2),e.Y8G("ngIf",a.global.ShowHint&&a.CheckIfFocusOnInput),e.R7$(),e.SpI(" ",a.lang.text.ChatRoom.GoToRecent," ")}}function qt(l,c){if(1&l){const a=e.RV6();e.j41(0,"span",97),e.bIt("click",function(){e.eBV(a);const i=e.XpG(4);return e.Njj(i.SetOtherAct())}),e.EFF(1),e.k0s()}if(2&l){const a=e.XpG().$implicit;e.R7$(),e.SpI(" ",a.text," ")}}function zt(l,c){if(1&l){const a=e.RV6();e.j41(0,"a",98),e.bIt("click",function(i){e.eBV(a);const n=e.XpG().$implicit,o=e.XpG(3);return e.Njj(o.open_url_link(i,n.text))}),e.EFF(1),e.k0s()}if(2&l){const a=e.XpG().$implicit;e.Y8G("href",a.text,e.B4B),e.R7$(),e.JRh(a.text)}}function Wt(l,c){if(1&l&&(e.j41(0,"span"),e.DNE(1,qt,2,1,"span",147)(2,zt,2,2,"a",96),e.k0s()),2&l){const a=c.$implicit;e.R7$(),e.Y8G("ngIf",!a.href),e.R7$(),e.Y8G("ngIf",a.href)}}function Qt(l,c){if(1&l&&(e.j41(0,"span"),e.DNE(1,Wt,3,2,"span",94),e.k0s()),2&l){const a=c.$implicit;e.R7$(),e.Y8G("ngForOf",a)}}function Jt(l,c){if(1&l){const a=e.RV6();e.j41(0,"tr",142),e.bIt("click",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.scroll_down_logs())})("contextmenu",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.nakama.go_to_chatroom(i.nakama.channels_orig[i.isOfficial][i.target][i.info.id]))}),e.j41(1,"td",146)(2,"span")(3,"b"),e.EFF(4),e.k0s()(),e.DNE(5,Qt,2,1,"span",94),e.k0s()()}if(2&l){const a=e.XpG();e.R7$(2),e.Aen("margin-right: 8px; color: "+a.last_message_viewer.color),e.R7$(2),e.JRh((a.last_message_viewer.is_me?a.nakama.users.self.display_name:a.nakama.users[a.isOfficial][a.target][a.last_message_viewer.user_id].display_name)||a.lang.text.Profile.noname_user),e.R7$(),e.Y8G("ngForOf",a.last_message_viewer.message)}}function Kt(l,c){1&l&&(e.j41(0,"div",148),e.EFF(1,"E"),e.k0s())}function Zt(l,c){1&l&&(e.j41(0,"div",149),e.EFF(1,"Enter "),e.k0s())}function ei(l,c){1&l&&(e.j41(0,"div",149),e.EFF(1,"Backspace "),e.k0s())}function ti(l,c){if(1&l&&(e.j41(0,"div",155),e.EFF(1),e.k0s()),2&l){const a=e.XpG().$implicit;e.R7$(),e.SpI(" ",a.index,"")}}function ii(l,c){if(1&l&&e.nrm(0,"ion-icon",156),2&l){const a=e.XpG().$implicit;e.Y8G("name",a.icon||"close-circle")}}function ni(l,c){if(1&l&&e.nrm(0,"img",157),2&l){const a=e.XpG().$implicit;e.Y8G("src","assets/icon/"+a.icon_img,e.B4B)("alt",a.title)}}function ai(l,c){if(1&l){const a=e.RV6();e.j41(0,"div",150)(1,"div",151),e.bIt("click",function(){const i=e.eBV(a).$implicit;return e.Njj(i.act())})("contextmenu",function(){const i=e.eBV(a).$implicit;return e.Njj(i.context?i.context():null)}),e.DNE(2,ti,2,1,"div",152)(3,ii,1,1,"ion-icon",153)(4,ni,1,2,"img",154),e.j41(5,"div"),e.EFF(6),e.k0s()()()}if(2&l){const a=c.$implicit,t=e.XpG();e.R7$(),e.Aen("cursor: "+(a.cursor||"pointer")+";"),e.Y8G("hidden",a.isHide),e.R7$(),e.Y8G("ngIf",t.global.ShowHint&&!t.CheckIfFocusOnInput),e.R7$(),e.Y8G("ngIf",a.icon),e.R7$(),e.Y8G("ngIf",a.icon_img),e.R7$(2),e.JRh(a.name)}}const oi=[{path:"",component:(()=>{var l;class c{constructor(t,i,n,o,r,d,_,b,k,I,x,h,g,w){var m,s=this;this.navCtrl=t,this.route=i,this.router=n,this.nakama=o,this.noti=r,this.statusBar=d,this.indexed=_,this.lang=b,this.sanitizer=k,this.global=I,this.p5toast=x,this.alertCtrl=h,this.floatButton=g,this.p5loading=w,this.info={},this.foundLastRead=!1,this.messages=[],this.sending_msg=[],this.temporary_open_thumbnail={},this.voidDrawContextId="chatroom_voiddraw",this.extended_buttons=[{icon:"settings-outline",name:this.lang.text.ChatRoom.ExtSettings,act:()=>{if(3!=this.info.redirect.type)this.extended_buttons[0].isHide=!0;else try{this.global.PageDismissAct.group_detail=m=>{this.SetExtensionButtons(),delete this.global.PageDismissAct.group_detail},this.global.ActLikeModal("group-detail",{info:this.nakama.groups[this.isOfficial][this.target][this.info.group_id],server:{isOfficial:this.isOfficial,target:this.target}})}catch{this.p5toast.show({text:this.lang.text.ChatRoom.AlreadyRemoved})}}},{icon:"hammer-outline",name:this.lang.text.ChatRoom.ExtSoloImage,isHide:!0,act:(m=(0,p.A)(function*(){s.info.info.img?(delete s.info.info.img,s.indexed.removeFileFromUserPath(`servers/${s.info.server.isOfficial}/${s.info.server.target}/groups/${s.info.id}.img`),s.p5loading.update({id:s.FileActId,message:s.lang.text.ChatRoom.LocalImageRemoved,image:null,forceEnd:1e3})):document.getElementById("local_channel").click()}),function(){return m.apply(this,arguments)}),context:()=>(function(){var u=(0,p.A)(function*(){if(s.info.info.img)delete s.info.info.img,s.indexed.removeFileFromUserPath(`servers/${s.info.server.isOfficial}/${s.info.server.target}/groups/${s.info.id}.img`),s.p5loading.update({id:s.FileActId,message:s.lang.text.ChatRoom.LocalImageRemoved,image:null,forceEnd:1e3});else try{let f=yield s.global.GetValueFromClipboard(s.FileActId);switch(f.type){case"image/png":s.LocalChannelImageChanged({target:{files:[f.value]}});break;case"text/plain":yield s.check_if_clipboard_available(f.value);break;case"error":throw f.value}}catch{document.getElementById("local_channel").click()}});return function(){return u.apply(this,arguments)}}()(),!1)},{icon:"image-outline",name:this.lang.text.ChatRoom.BackgroundImage,act:function(){var m=(0,p.A)(function*(){s.HasBackgroundImage?s.RemoveChannelBackgroundImage():document.getElementById("backgroundImage_sel").click()});return function(){return m.apply(this,arguments)}}(),context:(m=!1)=>(function(){var f=(0,p.A)(function*(){try{if(m&&s.HasBackgroundImage)return s.RemoveChannelBackgroundImage(),!1;const v=yield s.global.GetValueFromClipboard(s.FileActId);switch(v.type){case"image/png":s.ChangeBackgroundImage({target:{files:[v.value]}});break;case"error":throw v.value}}catch{document.getElementById("backgroundImage_sel").click()}});return function(){return f.apply(this,arguments)}}()(),!1)},{icon:"document-attach-outline",name:this.lang.text.ChatRoom.attachments,act:()=>{this.new_attach({detail:{value:"load"}})},context:()=>(this.new_attach({detail:{value:"link"}}),!1)},{icon_img:"voidDraw.png",name:this.lang.text.ChatRoom.voidDraw,act:function(){var m=(0,p.A)(function*(){let f,u={};if(s.userInput.file)switch(s.userInput.file.typeheader){case"image":try{s.userInput.file.url&&(s.userInput.file.blob=yield fetch(s.userInput.file.url,{signal:s.cont.signal}).then(R=>R.blob()));const v=URL.createObjectURL(s.userInput.file.blob);yield s.p5loading.update({id:"voiddraw",image:v,forceEnd:null}),setTimeout(()=>{URL.revokeObjectURL(v)},100);const y=`tmp_files/chatroom/attached.${s.userInput.file.file_ext}`;yield s.indexed.saveBlobToUserPath(s.userInput.file.blob,y);const M=document.getElementById("ChatroomSelectedImage");u.path=y,u.width=M.naturalWidth,u.height=M.naturalHeight,f=s.userInput.file.content_related_creator}catch(v){return void s.p5toast.show({text:`${s.lang.text.ContentViewer.CannotEditFile}: ${(v.statusText?`${v.statusText}(${v.status})`:v.status)||v}`})}break;case"text":u.text=s.userInput.file.thumbnail}s.global.PageDismissAct["chatroom-voiddraw"]=function(){var v=(0,p.A)(function*(y){var M;y.data&&(yield s.voidDraw_fileAct_callback(y,f)),null!==(M=y.data)&&void 0!==M&&M.fromChat&&s.autoSendWithLocalNoti(),delete s.global.PageDismissAct["chatroom-voiddraw"]});return function(y){return v.apply(this,arguments)}}(),u.dismiss="chatroom-voiddraw",u.fromChat=!0,s.global.ActLikeModal("portal/subscribes/chat-room/void-draw",u)});return function(){return m.apply(this,arguments)}}(),context:()=>(function(){var u=(0,p.A)(function*(){const f="voiddraw",v=yield s.global.GetValueFromClipboard(f);switch(v.type){case"image/png":s.SelectVoidDrawBackgroundImage({target:{files:[v.value]}});break;case"text/plain":const M={file_ext:v.value.split(".").pop()};if(s.global.set_viewer_category_from_ext(M),"image"==M.viewer)try{s.p5loading.update({id:f,message:`${s.lang.text.Arcade.TryingDownload}: ${v.value.split("/").pop()}`,forceEnd:null});const R=yield fetch(v.value);if(!R.ok)throw`${R.statusText} (${R.status})`;const S=yield R.blob();s.p5loading.update({id:f,message:`${s.lang.text.Arcade.TryingDownload}: ${v.value.split("/").pop()}`,progress:1,forceEnd:350}),s.SelectVoidDrawBackgroundImage({target:{files:[S]}});break}catch(R){console.log("\uadf8\ub9bc\ud310 \ube60\ub978 \uc9c4\uc785 \uc624\ub958: ",R)}default:s.extended_buttons[4].act()}});return function(){return u.apply(this,arguments)}}()(),!1)},{icon:"reader-outline",name:this.lang.text.ChatRoom.newText,act:function(){var m=(0,p.A)(function*(){let u={info:{content:{is_new:void 0,type:"text/plain",viewer:"text",filename:void 0,path:void 0}},no_edit:void 0};try{if(!s.userInput.file)throw"\uc0c8 \ud30c\uc77c \uc0dd\uc131";switch(s.userInput.file.viewer){case"code":case"text":let f="tmp_files/chatroom/edit_text.txt";yield s.indexed.saveBlobToUserPath(s.userInput.file.blob,f),u.info.content.path=f,u.info.content.type=s.userInput.file.type,u.info.content.viewer=s.userInput.file.viewer,u.info.content.filename=s.userInput.file.filename;break;default:throw"\uac10\ub2f9 \ubd88\uac00\ud55c \ud30c\uc77c"}}catch{u.info.content.is_new="text",u.info.content.filename=s.global.TextEditorNewFileName(),u.no_edit=!0}s.global.PageDismissAct["chatroom-ionicviewer"]=f=>{if(f.data){let v=s.global.TextEditorAfterAct(f.data,{display_name:s.nakama.users.self.display_name});s.userInput.file=v,s.CancelEditText(),s.selected_blobFile_callback_act(v.blob)}delete s.global.PageDismissAct["chatroom-ionicviewer"]},u.dismiss="chatroom-ionicviewer",s.global.ActLikeModal("portal/subscribes/chat-room/ionic-viewer",u)});return function(){return m.apply(this,arguments)}}()},{icon:"camera-outline",name:this.lang.text.ChatRoom.Camera,act:function(){var m=(0,p.A)(function*(){try{let u=yield s.global.from_camera("tmp_files/chatroom/",{user_id:s.info.local?"local":s.nakama.servers[s.isOfficial][s.target].session.user_id,display_name:s.nakama.users.self.display_name});s.userInput.file=u,s.CancelEditText()}catch{}});return function(){return m.apply(this,arguments)}}()},{icon:"mic-circle-outline",name:this.lang.text.ChatRoom.Voice,act:function(){var m=(0,p.A)(function*(){s.global.useVoiceRecording&&"ChatRoomRecording"!=s.global.useVoiceRecording?s.p5toast.show({text:s.lang.text.GlobalAct[s.global.useVoiceRecording]}):(s.useVoiceRecording=!s.useVoiceRecording,s.useVoiceRecording?(yield q.R.hasAudioRecordingPermission()).value?(s.global.useVoiceRecording="ChatRoomRecording",s.extended_buttons[7].icon="stop-circle-outline",s.extended_buttons[7].name=s.lang.text.ChatRoom.VoiceStop,yield q.R.startRecording(),s.CreateFloatingVoiceTimeHistoryAddButton(),s.p5loading.toast(s.lang.text.ChatRoom.StartVRecord,s.FileActId)):yield q.R.requestAudioRecordingPermission():s.StopAndSaveVoiceRecording())});return function(){return m.apply(this,arguments)}}()},{icon:"cloud-done-outline",name:this.lang.text.ChatRoom.Detour,act:()=>{this.toggle_custom_attach(),this.nakama.save_channels_with_less_info()}},{icon:"copy-outline",name:this.lang.text.ChatRoom.ShareToOther,act:function(){var m=(0,p.A)(function*(){let u=JSON.parse(JSON.stringify(s.info)),f=s.nakama.rearrange_channels();for(let y=f.length-1;y>=0;y--)("online"!=f[y].status||1!=f[y].info.max_count)&&f.splice(y,1);if(!f.length)return void s.p5toast.show({text:s.lang.text.ChatRoom.NoCopyChannelAvailable});let v=JSON.parse(JSON.stringify(f));s.global.PageDismissAct.share=function(){var y=(0,p.A)(function*(M){if(yield s.WaitingCurrent(),M.data){const R=`share_to_other_${s.info.id}`;s.p5loading.update({id:R,message:s.lang.text.ChatRoom.CopyingChats,progress:0}),s.nakama.go_to_chatroom(M.data);let S=yield s.indexed.GetFileListFromDB(`servers/${u.info.isOfficial}/${u.info.target}/channels/${u.id}/chats`);const L=S.length;let V=0;for(let $ of S){if(V++,33206!=(yield s.indexed.GetFileInfoFromDB($)).mode)continue;const G=yield(yield s.indexed.loadBlobFromUserPath($,"")).text(),z=JSON.parse(G);let H=0;const W=z.length;s.p5loading.update({id:R,message:`${u.title} -> ${s.info.title}: ${$.split("/").pop()} (${V}/${L})`,progress:null}),yield new Promise(O=>setTimeout(O,1e3));for(let O of z){if(H++,2==O.code)continue;let B,Q;1==O.code&&delete O.content.edited;try{B=yield s.indexed.loadBlobFromUserPath(`servers/${u.info.isOfficial}/${u.info.target}/channels/${u.id}/files/msg_${O.message_id}.${O.content.file_ext}`,O.content.type),Q={blob:B,filename:O.content.filename,content_creator:O.content.content_creator,content_related_creator:O.content.content_related_creator,file_ext:O.content.file_ext,size:O.content.size,partsize:O.content.partsize,type:O.content.type,viewer:O.content.viewer}}catch{}let E=O.content,ne=s.nakama.deserialize_text(O);if(E.msg=ne,E.qoute)for(let T of z)T.complete_send&&T.message_id==E.qoute.id&&(E.qoute.id=T.complete_send.message_id,E.qoute.url=T.content.url);if(s.p5loading.update({id:R,message:`${u.title} -> ${s.info.title}: ${s.global.truncateString(ne,12)} (${H}/${W})`,progress:H/W}),B&&2!=s.useFirstCustomCDN)try{let T=s.nakama.servers[s.isOfficial][s.target].info.address,J=s.nakama.servers[s.isOfficial][s.target].info.useSSL?"https:":"http:",ri=`${s.info.group_id||(s.info.user_id_one==s.nakama.servers[s.isOfficial][s.target].session.user_id?s.info.user_id_two:s.info.user_id_one)}/${s.nakama.servers[s.isOfficial][s.target].session.user_id}`,ae=s.nakama.servers[s.isOfficial][s.target].info,oe=yield s.global.upload_file_to_storage(Q,{user_id:ri,apache_port:ae.apache_port,cdn_port:ae.cdn_port},J,T,1==s.useFirstCustomCDN,R,`${u.title} -> ${s.info.title}: ${s.lang.text.GlobalAct.CheckCdnServer} (${H}/${W})`);if(!oe)throw"\ub9c1\ud06c \ub9cc\ub4e4\uae30 \uc2e4\ud328";E.url=oe}catch(T){console.log("cdn \uc5c5\ub85c\ub4dc \ucc98\ub9ac \uc2e4\ud328: ",T)}try{let T=yield s.nakama.servers[s.isOfficial][s.target].socket.writeChatMessage(s.info.id,E);if(O.complete_send=T,B&&!E.url){let J=`servers/${s.isOfficial}/${s.target}/channels/${s.info.id}/files/msg_${T.message_id}.${Q.file_ext}`;yield s.indexed.saveBlobToUserPath(B,J)}s.inputPlaceholder=s.lang.text.ChatRoom.input_placeholder}catch(T){3===T.code?s.p5toast.show({text:s.lang.text.ChatRoom.FailedToJoinChannel}):(console.log("\uc624\ub958 \uac80\ud1a0 \ud544\uc694: ",T),s.p5toast.show({text:`${s.lang.text.ChatRoom.FailedToSend}: ${"string"==typeof T?T:T.message}`}))}s.scroll_down_logs(),yield new Promise(T=>setTimeout(T,1e3))}}s.p5loading.remove(R)}s.WillLeave||s.ionViewDidEnter(),delete s.global.PageDismissAct.share});return function(M){return y.apply(this,arguments)}}(),delete v.update,s.global.ActLikeModal("share-content-to-other",{channels:v})});return function(){return m.apply(this,arguments)}}()},{icon:"volume-mute-outline",name:this.lang.text.ChatRoom.ReadText,act:function(){var m=(0,p.A)(function*(){s.toggle_speakermode()});return function(){return m.apply(this,arguments)}}()},{icon:"log-out-outline",name:this.lang.text.ChatRoom.LogOut,act:function(){var m=(0,p.A)(function*(){if(3!=s.info.redirect.type)try{yield s.nakama.servers[s.isOfficial][s.target].socket.leaveChat(s.info.id),s.nakama.channels_orig[s.isOfficial][s.target][s.info.id].status="missing",s.extended_buttons.forEach(u=>{u.isHide=!0}),s.extended_buttons[12].isHide=!1}catch(u){console.error("\ucc44\ub110\uc5d0\uc11c \ub098\uc624\uae30 \uc2e4\ud328: ",u)}else s.extended_buttons[11].isHide=!0});return function(){return m.apply(this,arguments)}}()},{isHide:!0,name:this.lang.text.ChatRoom.RemoveHistory,icon:"close-circle-outline",act:()=>{this.alertCtrl.create({header:this.lang.text.ChatRoom.RemoveChannel,message:this.lang.text.ChatRoom.CannotUndone,buttons:[{text:this.lang.text.ChatRoom.Delete,handler:()=>{!function(){var u=(0,p.A)(function*(){const f=`remove_chatroom_${s.info.id}`;s.p5loading.update({id:f});let v={};try{const R=s.nakama.servers[s.isOfficial][s.target].info;v.cdn_port=R.cdn_port,v.apache_port=R.apache_port,v.user_id=s.nakama.servers[s.isOfficial][s.target].session.user_id}catch{v={}}delete s.nakama.channels_orig[s.isOfficial][s.target][s.info.id];try{switch(s.info.redirect.type){case 3:yield s.nakama.remove_group_list(s.nakama.groups[s.isOfficial][s.target][s.info.group_id]||s.info.info,s.isOfficial,s.target,!0);break;case 0:yield s.indexed.removeFileFromUserPath(`servers/${s.isOfficial}/${s.target}/groups/${s.info.id}.img`)}}catch(R){console.log("\uadf8\ub8f9 \uc774\ubbf8\uc9c0 \uc0ad\uc81c \uc624\ub958: ",R)}try{delete s.nakama.groups[s.isOfficial][s.target][s.info.group_id]}catch(R){console.log("DeleteGroupFailed: ",R)}s.nakama.save_groups_with_less_info();try{var y;let R=localStorage.getItem("fallback_fs");if(!R)throw"\uc0ac\uc6a9\uc790 \uc9c0\uc815 \uc11c\ubc84 \uc5c6\uc74c";let S=R.split("://"),L=S.pop().split(":"),V=S.pop();V?V+=":":V=s.global.checkProtocolFromAddress(L[0])?"https:":"http:";const $=null===(y=L[1])||void 0===y?void 0:y.split(",");let P=`${V}//${L[0]}:${(null==$?void 0:$[1])||9002}/`,j=`${s.info.id}_${s.nakama.users.self.display_name}`;try{j=`${s.info.info.id}/${s.nakama.servers[s.isOfficial][s.target].session.user_id}`}catch{}s.global.remove_files_from_storage_with_key(P,j,{user_id:s.nakama.servers[s.isOfficial][s.target].session.user_id})}catch{}try{let R=s.nakama.GetNodejsServerAddress(s.isOfficial,s.target,"apache_port");s.global.remove_files_from_storage_with_key(R,`${s.info.info.id}_${s.nakama.servers[s.isOfficial][s.target].session.user_id}`,v)}catch{}let M=yield s.indexed.GetFileListFromDB(`servers/${s.isOfficial}/${s.target}/channels/${s.info.id}`);for(let R=0,S=M.length;R<S;R++)s.p5loading.update({id:f,message:`${s.lang.text.UserFsDir.DeleteFile}: ${s.info.title} (${M[R].split("/").pop()})`}),yield s.indexed.removeFileFromUserPath(M[R]);s.p5loading.remove(f),s.navCtrl.pop()});return function(){return u.apply(this,arguments)}}()()},cssClass:"redfont"}]}).then(m=>{this.global.StoreShortCutAct("chatroom-alert"),m.onDidDismiss().then(()=>{this.global.RestoreShortCutAct("chatroom-alert")}),m.present()})}}],this.useVoiceRecording=!1,this.QueuedAct=[],this.useFirstCustomCDN=0,this.HasBackgroundImage=!1,this.next_cursor="",this.prev_cursor="",this.file_sel_id="file_sel_id",this.ShowGoToBottom=!1,this.WillLeave=!1,this.InitWithFileImport=!1,this.InitWithRoomEnv=!1,this.FileActId="chatroom_withfile_id",this.ExtTarget=[],this.CheckIfHasScroll=!1,this.Attach={first:void 0,last:void 0},this.OnFinding=!1,this.BlockAutoScrollDown=!1,this.last_message_viewer={user_id:void 0,message:void 0,color:void 0,is_me:void 0},this.userInput={file:void 0,text:"",qoute:void 0,memo:void 0},this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder,this.is_pulling=!1,this.pullable=!0,this.ViewableMessage=[],this.ViewMsgIndex=0,this.RefreshCount=15,this.ViewCount=45,this.ShowRecentMsg=!1,this.useSpeaker=!1,this.isSpeeching=!1,this.SpeechThese=[],this.isHistoryLoaded=!1,this.LocalHistoryList=[],this.isHidden=!0,this.CheckIfFocusOnInput=!1,this.ChannelUserInputId="ChannelUserInputId",this.SendQueue=[],this.isSendingQueue=!1,this.isOtherAct=!1,this.lock_modal_open=!1,this.ModifyEditedMessage=void 0,this.VideoEditedTimestamp=void 0}CreateFloatingVoiceTimeHistoryAddButton(){this.floatButton.RemoveFloatButton("chatroom-record"),this.floatButton.AddFloatButton("chatroom-record","mic-outline").mouseClicked(()=>{this.p5toast.show({text:`${this.lang.text.GlobalAct.ChatRoomRecording}`})})}StopAndSaveVoiceRecording(){var t=this;return(0,p.A)(function*(){t.floatButton.RemoveFloatButton("chatroom-record"),yield t.p5loading.update({id:t.FileActId,message:t.lang.text.AddPost.SavingRecord});try{let i=yield t.global.StopAndSaveVoiceRecording();t.selected_blobFile_callback_act(i)}catch{}t.p5loading.remove(t.FileActId),t.extended_buttons[7].icon="mic-circle-outline",t.extended_buttons[7].name=t.lang.text.ChatRoom.Voice})()}SelectVoidDrawBackgroundImage(t){var i=this;return(0,p.A)(function*(){const n="SelectVoidDrawBackgroundImage";i.p5loading.update({id:n,message:`${i.lang.text.ContentViewer.OnLoadContent}: ${t.target.files[0].name}`});const o=t.target.files[0],r=`tmp_files/chatroom/${o.name}`;yield i.indexed.saveBlobToUserPath(o,r);const d=yield i.indexed.loadBlobFromUserPath(r,o.type),_=URL.createObjectURL(d);new Y(b=>{b.setup=()=>{const k=document.getElementById(i.voidDrawContextId);k&&(k.value=""),b.noCanvas(),b.loadImage(_,I=>{i.global.PageDismissAct["chatroom-voiddraw-quick"]=function(){var x=(0,p.A)(function*(h){var g;h.data&&(yield i.voidDraw_fileAct_callback(h)),null!==(g=h.data)&&void 0!==g&&g.fromChat&&i.autoSendWithLocalNoti(),delete i.global.PageDismissAct["chatroom-voiddraw-quick"]});return function(h){return x.apply(this,arguments)}}(),i.global.ActLikeModal("portal/subscribes/chat-room/void-draw",{path:r,width:I.width,height:I.height,type:o.type,fromChat:!0,dismiss:"chatroom-voiddraw-quick"}),URL.revokeObjectURL(_),i.p5loading.update({id:n,progress:1,forceEnd:0}),b.remove()},I=>{console.log("\ube60\ub978 \uadf8\ub9bc\ud310 \uc5f4\uae30 \uc2e4\ud328: ",I),URL.revokeObjectURL(_),i.p5loading.update({id:n,message:`${I}`,progress:0,forceEnd:0}),b.remove()})}})})()}WaitingCurrent(){var t=this;return(0,p.A)(function*(){for(;t.WillLeave;)yield new Promise(i=>setTimeout(i,0))})()}check_if_clipboard_available(t){var i=this;return(0,p.A)(function*(){try{if(0!=t.indexOf("http"))throw"URL \uc8fc\uc18c\uac00 \uc544\ub2d8";yield new Promise((n,o)=>{let r=document.createElement("img");r.src=t,r.onload=()=>{i.info.info.img=t,r.onload=null,r.onerror=null,r.remove(),n(void 0)},r.onerror=()=>{r.onload=null,r.onerror=null,r.remove(),o()}})}catch{try{if(0!=t.indexOf("data:image"))throw"DataURL \uc8fc\uc18c\uac00 \uc544\ub2d8";i.nakama.limit_image_size(t,o=>{i.info.info.img=o.canvas.toDataURL(),i.indexed.saveTextFileToUserPath(i.info.info.img,`servers/${i.info.server.isOfficial}/${i.info.server.target}/groups/${i.info.id}.img`),i.p5loading.update({id:i.FileActId,message:i.lang.text.ChatRoom.LocalImageChanged,image:i.info.info.img,forceEnd:1e3})})}catch{throw"\uc0ac\uc6a9\ubd88\uac00 \uc774\ubbf8\uc9c0"}}})()}SetWebPushAddress(){if(!this.webpush_address)try{this.webpush_address=this.nakama.GetNodejsServerAddress(this.isOfficial,this.target,"webpush_port")}catch{}}ionViewDidEnter(){for(let i of this.QueuedAct)i();var t;(this.QueuedAct.length=0,this.lock_modal_open=!1,this.init_noties(),this.AddShortCut(),this.SetWebPushAddress(),this.webpush_address)&&this.nakama.send_webpush(this.webpush_address,{id:this.info.cnoti_id,icon:"remove"},[null===(t=this.nakama.servers[this.isOfficial])||void 0===t||null===(t=t[this.target])||void 0===t||null===(t=t.session)||void 0===t?void 0:t.user_id])}new_attach(t,i=void 0){var n=this;return(0,p.A)(function*(){switch(void 0===i&&(i={}),t.detail.value){case"load":document.getElementById(n.file_sel_id).click();break;case"link":try{let o=i.url;if(!n.userInput.file&&void 0===o)try{let _=yield n.global.GetValueFromClipboard(n.FileActId);switch(_.type){case"text/plain":o=_.value;break;case"image/png":return void n.inputFileSelected({target:{files:[_.value]}});case"error":throw _.value}}catch(_){throw _}try{let _=n.global.Base64ToBlob(o),b=o.split(";")[0].split(":")[1],k=new File([_],`${n.lang.text.ChatRoom.FileLink}.${b.split("/").pop()}`,{type:b});throw n.selected_blobFile_callback_act(k),"done"}catch(_){if("done"===_)throw _}try{if(0!=o.indexOf("http:")&&0!=o.indexOf("https:"))throw"\uc62c\ubc14\ub978 \uc6f9 \uc8fc\uc18c\uac00 \uc544\ub2d8";if(n.userInput.file&&void 0===i.filename)throw"\uc774\ubbf8 \ud30c\uc77c\uc774 \ucca8\ubd80\ub428, \ud1a0\uae00\ub9cc \uc2dc\ub3c4"}catch(_){throw _}let r={};r.url=o,r.content_related_creator=[],i&&i.content_related_creator&&(r.content_related_creator=[...i.content_related_creator]),r.content_related_creator.length<2&&r.content_related_creator.push({user_id:n.info.local?"local":n.nakama.servers[n.isOfficial][n.target].session.user_id,timestamp:(new Date).getTime(),display_name:n.nakama.users.self.display_name,various:i.url?"shared":"link"}),r.content_creator={user_id:n.info.local?"local":n.nakama.servers[n.isOfficial][n.target].session.user_id,timestamp:(new Date).getTime(),display_name:n.nakama.users.self.display_name,various:i.url?"shared":"link"};let d=r.url.split(".");r.file_ext=i.file_ext||d.pop().split("?").shift(),r.filename=i.filename||decodeURIComponent(r.url.split("/").pop()||`${n.lang.text.ChatRoom.ExternalLinkFile}.${r.file_ext}`),r.filename=r.filename,n.global.set_viewer_category_from_ext(r),r.type=i.type||"",r.typeheader=i.typeheader||r.viewer,n.global.modulate_thumbnail(r,r.url,n.cont),n.NeedScrollDown()&&setTimeout(()=>{n.scroll_down_logs()},100),n.userInput.file=r,n.CancelEditText(),n.inputPlaceholder=`(${n.lang.text.ChatRoom.FileLink}: ${n.userInput.file.filename})`}catch(o){throw"done"==o?o:`\uc778\uc2dd \ubd88\uac00\ub2a5\ud55c URL \uc815\ubcf4: ${(o.statusText?`${o.statusText}(${o.status})`:o.status)||o}`}}})()}toggle_custom_attach(t){var i=this;return(0,p.A)(function*(){switch(i.useFirstCustomCDN=(null!=t?t:i.useFirstCustomCDN+1)%3,i.useFirstCustomCDN){case 0:i.extended_buttons[8].icon="cloud-offline-outline",i.extended_buttons[8].name=i.lang.text.ChatRoom.Detour;break;case 1:i.extended_buttons[8].icon="cloud-done-outline",i.extended_buttons[8].name=i.lang.text.ChatRoom.useFSS;break;case 2:i.extended_buttons[8].icon="server-outline",i.extended_buttons[8].name=i.lang.text.ChatRoom.forceSQL}i.info.CDN=i.useFirstCustomCDN})()}toggle_speakermode(t){var i=this;return(0,p.A)(function*(){if(i.useSpeaker=null!=t?t:!i.useSpeaker,i.extended_buttons[10].icon=i.useSpeaker?"volume-high-outline":"volume-mute-outline",i.useSpeaker?localStorage.setItem("useChannelSpeaker",`${i.useSpeaker}`):localStorage.removeItem("useChannelSpeaker"),!i.useSpeaker)try{yield ie.x.stop()}catch{}})()}LoadChannelBackgroundImage(){var t=this;return(0,p.A)(function*(){try{let i=yield t.indexed.loadBlobFromUserPath(`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/backgroundImage.png`,"");t.ChangeBackgroundImage({target:{files:[i]}}),t.HasBackgroundImage=!0}catch{}})()}RemoveChannelBackgroundImage(){var t=this;return(0,p.A)(function*(){try{yield t.indexed.removeFileFromUserPath(`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/backgroundImage.png`),document.getElementById("main_table").style.backgroundImage='url("")'}catch{}t.HasBackgroundImage=!1})()}ChangeBackgroundImage(t){try{let i=document.getElementById("main_table"),n=t.target.files[0];const o=URL.createObjectURL(n);i.style.backgroundImage=`url('${o}')`,this.indexed.saveBlobToUserPath(n,`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/backgroundImage.png`),this.HasBackgroundImage=!0,setTimeout(()=>{URL.revokeObjectURL(o)},100)}catch{}}inputFileSelected(t){var i=this;return(0,p.A)(function*(){if(t.target.files.length)if(1!=t.target.files.length){const o=yield i.alertCtrl.create({header:i.lang.text.ChatRoom.MultipleSend,message:`${i.lang.text.ChatRoom.CountFile}: ${t.target.files.length}`,buttons:[{text:i.lang.text.ChatRoom.Send,handler:()=>{for(let r=0,d=t.target.files.length;r<d;r++)i.selected_blobFile_callback_act(t.target.files[r],void 0,void 0,void 0,!1),i.send();i.noti.ClearNoti(7)}}]});i.global.StoreShortCutAct("chatroom-alert"),o.onDidDismiss().then(()=>{setTimeout(()=>{i.scroll_down_logs(),document.getElementById(i.file_sel_id).value=""},300),i.global.RestoreShortCutAct("chatroom-alert")}),o.present()}else yield i.p5loading.update({id:i.FileActId,forceEnd:1e3}),i.selected_blobFile_callback_act(t.target.files[0]),document.getElementById(i.file_sel_id).value="";else delete i.userInput.file,i.inputPlaceholder=i.lang.text.ChatRoom.input_placeholder,document.getElementById(i.file_sel_id).value=""})()}LocalChannelImageChanged(t){var i=this;return(0,p.A)(function*(){let n=yield i.global.GetBase64ThroughFileReader(t.target.files[0]);i.nakama.limit_image_size(n,o=>{i.info.info.img=o.canvas.toDataURL(),i.indexed.saveTextFileToUserPath(i.info.info.img,`servers/${i.info.server.isOfficial}/${i.info.server.target}/groups/${i.info.id}.img`),i.p5loading.update({id:i.FileActId,message:i.lang.text.ChatRoom.LocalImageChanged,image:i.info.info.img,forceEnd:1e3})})})()}ngOnInit(){var t=this;this.voidDrawContextId=`chatroom_voiddraw_${Date.now()}`,this.cont=new AbortController,this.global.WindowOnBlurAct.chatroom=()=>{this.ChatManageMenu&&this.ChatManageMenu.dismiss()},this.useSpeaker=!!localStorage.getItem("useChannelSpeaker"),this.toggle_speakermode(this.useSpeaker);try{this.ChatLogs=document.getElementById("chatroom_div"),this.ChatLogs.onscroll=i=>{this.ListOnScrollAct()}}catch(i){console.log("\ucc44\ud305 \ub85c\uadf8 \uac1c\uccb4 \ud589\ub3d9 \uc624\ub958: ",i)}this.nakama.ChatroomLinkAct=function(){var i=(0,p.A)(function*(n,o){t.useVoiceRecording&&t.StopAndSaveVoiceRecording(),delete t.info.is_new;try{delete t.nakama.channels_orig[t.isOfficial][t.target][t.info.id].update}catch{}t.info=n,t.FileActId=`chatroom_withfile_${t.info.id}`,t.InitWithFileImport=!!o,t.InitWithRoomEnv=!0,yield t.init_chatroom(),t.CancelEditText(),o&&(t.userInput.file=o,t.create_thumbnail_imported(o))});return function(n,o){return i.apply(this,arguments)}}(),this.route.queryParams.subscribe(function(){var i=(0,p.A)(function*(n){try{const o=t.router.getCurrentNavigation().extras.state;o&&(t.info=o.info,t.FileActId=`chatroom_withfile_${t.info.id}`),yield new Promise(r=>setTimeout(r,100)),t.InitWithFileImport=!!o.file,t.InitWithRoomEnv=!!o,yield t.init_chatroom(),t.CancelEditText(),o.file&&(t.userInput.file=o.file,t.create_thumbnail_imported(o.file))}catch{}});return function(n){return i.apply(this,arguments)}}()),setTimeout(()=>{this.WillLeave||this.CreateDrop()},100),this.nakama.StatusBarChangedCallback=()=>{this.SetExtensionButtons()}}ListOnScrollAct(){let t=this.NeedScrollDown();t&&(this.ShowGoToBottom||this.ShowRecentMsg||this.init_last_message_viewer(),this.ShowRecentMsg&&!this.BlockAutoScrollDown&&!this.OnFinding&&this.pull_msg_history(!1)),this.ShowGoToBottom=!t||this.ShowRecentMsg}textAreaOnFocusAct(){this.global.NeedBackgroundMode&&(this.global.ArcadeWithFullScreen=!0,this.isHidden=!0),this.CheckIfFocusOnInput=!0}textAreaOnBlurAct(){this.global.NeedBackgroundMode&&(this.global.ArcadeWithFullScreen=!1,this.NeedScrollDown()&&setTimeout(()=>{this.scroll_down_logs()},0)),this.CheckIfFocusOnInput=!1}textAreaOnPasteAct(t){let i=[];for(const n of t.clipboardData.files)i.push({file:n});if(i.length)return 1==i.length?this.selected_blobFile_callback_act(i[0].file):this.alertCtrl.create({header:this.lang.text.ChatRoom.MultipleSend,message:`${this.lang.text.ChatRoom.CountFile}: ${i.length}`,buttons:[{text:this.lang.text.ChatRoom.Send,handler:()=>{this.DropSendAct(i)}}]}).then(n=>{this.global.StoreShortCutAct("chatroom-alert"),n.onDidDismiss().then(()=>{this.global.RestoreShortCutAct("chatroom-alert")}),n.present()}),!1}ionViewWillEnter(){this.global.portalHint=!1,this.global.StoreShortCutAct("chat-room"),this.WillLeave=!1,this.global.windowOnFocusAct.chatroom=()=>{this.info.cnoti_id&&(this.noti.ClearNoti(this.info.cnoti_id),this.SelfSyncNotiInfo())},this.ChatContDiv=document.getElementById("chatroom_content_div");try{this.CheckIfHasScroll=this.ChatLogs.scrollHeight>this.ChatLogs.clientHeight}catch{}this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId))}AddShortCut(){var t=this;this.global.p5KeyShortCut&&(this.global.p5KeyShortCut.Backspace=()=>{document.activeElement==document.getElementById(this.ChannelUserInputId)&&(!this.userInput.text||0==this.userInputTextArea.selectionEnd)&&this.userInputTextArea.blur()},this.global.p5KeyShortCut.Backquote=()=>{!function(){var n=(0,p.A)(function*(){document.activeElement!=document.getElementById(t.ChannelUserInputId)&&(t.BlockAutoScrollDown=!0,t.ChatLogs.scrollTo({top:0,behavior:"instant"}),yield t.pull_msg_history(),t.BlockAutoScrollDown=!1)});return function(){return n.apply(this,arguments)}}()()},this.global.p5KeyShortCut.BottomTab=i=>{if(document.activeElement!=document.getElementById(this.ChannelUserInputId))switch(i){case"Q":0==this.ChatLogs.scrollTop&&this.CheckIfHasScroll?this.open_first_file():this.open_last_file();break;case"W":document.activeElement!=document.getElementById(this.ChannelUserInputId)&&this.ChatLogs.scrollTo({top:this.ChatLogs.scrollTop-this.ChatLogs.clientHeight/2,behavior:"smooth"});break;case"E":this.open_ext_with_delay()}},this.global.p5KeyShortCut.Digit=i=>{!this.isHidden&&document.activeElement!=document.getElementById(this.ChannelUserInputId)&&this.ExtTarget.length>i&&(this.ExtTarget[i].context?this.ExtTarget[i].context(!0):this.ExtTarget[i].act())},this.global.p5KeyShortCut.SKeyAct=()=>{document.activeElement!=document.getElementById(this.ChannelUserInputId)&&this.ChatLogs.scrollTo({top:this.ChatLogs.scrollTop+this.ChatLogs.clientHeight/2,behavior:"smooth"})},this.global.p5KeyShortCut.EnterAct=()=>{document.activeElement!=document.getElementById(this.ChannelUserInputId)?setTimeout(()=>{this.WillLeave||(this.make_ext_hidden(),this.userInputTextArea.focus())},0):this.userInput.text||this.ChatLogs.scrollTo({top:this.ChatLogs.scrollHeight,behavior:"smooth"})})}CheckIfShortcutLinkFile(){delete this.Attach.first,delete this.Attach.last;for(let t=0,i=this.ViewableMessage.length;t<i;t++)if(this.ViewableMessage[t].content.filename){this.Attach.first=this.ViewableMessage[t];break}for(let t=this.ViewableMessage.length-1;t>=0;t--)if(this.ViewableMessage[t].content.filename){this.Attach.last=this.ViewableMessage[t];break}}open_first_file(){for(let t=0,i=this.ViewableMessage.length;t<i;t++)if(this.ViewableMessage[t].content.filename){this.file_detail(this.ViewableMessage[t]);break}}open_last_file(){for(let t=this.ViewableMessage.length-1;t>=0;t--)if(this.ViewableMessage[t].content.filename){this.file_detail(this.ViewableMessage[t]);break}}init_noties(){this.noti.Current=this.info.cnoti_id,this.info.cnoti_id&&(this.noti.ClearNoti(this.info.cnoti_id),this.SelfSyncNotiInfo()),this.isOtherAct=!1,this.useFirstCustomCDN=this.info.CDN||0,this.toggle_custom_attach(this.useFirstCustomCDN)}CreateDrop(){var t=this;let i=document.getElementById("p5Drop_chatroom");this.p5canvas=new Y(n=>{n.setup=()=>{let h=n.createCanvas(i.clientWidth,i.clientHeight);h.parent(i),n.pixelDensity(.1),h.drop(g=>{let w=n.millis();d<w-400?(r=!1,_.length=0,_.push(g)):(r=!0,_.push(g)),d=w,clearTimeout(o),o=setTimeout((0,p.A)(function*(){t.WillLeave||(r?t.alertCtrl.create({header:t.lang.text.ChatRoom.MultipleSend,message:`${t.lang.text.ChatRoom.CountFile}: ${_.length}`,buttons:[{text:t.lang.text.ChatRoom.Send,handler:()=>{t.DropSendAct(_)}}]}).then(s=>{t.global.StoreShortCutAct("chatroom-alert"),s.onDidDismiss().then(()=>{t.global.RestoreShortCutAct("chatroom-alert")}),s.present()}):(yield t.p5loading.update({id:t.FileActId,forceEnd:1e3}),t.selected_blobFile_callback_act(g.file)))}),400)}),this.p5ChatMsgDragAct=I};let o,r=!1,d=0,_=[];n.mouseMoved=h=>{h.dataTransfer?(i.style.pointerEvents="all",i.style.backgroundColor="#0008"):(i.style.pointerEvents="none",i.style.backgroundColor="transparent")};let k=0;n.touchMoved=h=>{try{I(h.touches[0].clientX)}catch{}};const I=h=>{this.MsgClickedStartPos&&this.TargetMessageObject&&(k=this.MsgClickedStartPos-h,this.IsQouteMyMessage?k>0?this.TargetMessageObject.style.paddingRight=k/2+"px":this.TargetMessageObject.style.marginRight=k/2+"px":this.TargetMessageObject.style.marginLeft=-k/2+"px",this.TargetMessageBackground.style.backgroundColor=80<k?"rgba(var(--ion-color-primary-rgb), .5)":-80>k?"rgba(var(--ion-color-tertiary-rgb), .5)":null)};n.mouseReleased=()=>{x()},n.touchEnded=()=>{x()};const x=function(){var h=(0,p.A)(function*(){try{if(t.MsgClickedStartPos&&t.TargetMessageObject)if(80<k){const g=t.TargetMessageObject;let w;for(let f=0,v=t.ViewableMessage.length;f<v;f++)if(g.id==t.ViewableMessage[f].message_id){w=f;break}if(void 0===w)throw"\uba54\uc2dc\uc9c0\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc74c";const s=t.ViewableMessage[w];if("offline"==t.info.info.status||"missing"==t.info.info.status)throw"\uc791\uc5c5 \ubd88\uac00\ub2a5\ud55c \ucc44\ub110";const m=t.nakama.deserialize_text(s),u=()=>{try{if(t.userInput.memo=void 0,setTimeout(()=>{t.ResizeTextArea(),t.userInputTextArea.style.height=t.userInputTextArea.scrollHeight+"px"},0),t.userInput.qoute={timestamp:s.create_time},m&&(t.userInput.qoute.text=t.global.truncateString(m,80)),s.content.viewer)if("image"==s.content.viewer){if(s.content.url)t.userInput.qoute.url=s.content.url,t.userInput.qoute.path=s.content.url;else if(s.content.path&&(t.userInput.qoute.path=s.content.path.split("/").pop(),!t.userInput.qoute.url)){let f=`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/files/${t.userInput.qoute.path}`;t.indexed.checkIfFileExist(f).then(v=>{v&&t.indexed.loadBlobFromUserPath(f,s.content.type).then(y=>{const M=URL.createObjectURL(y);t.userInput.qoute.url=M,setTimeout(()=>{URL.revokeObjectURL(M)},100)})})}}else try{t.indexed.loadBlobFromUserPath(`${s.content.path}_thumbnail.png`,"image/png").then(f=>{const v=URL.createObjectURL(f);t.userInput.qoute.url=v,setTimeout(()=>{URL.revokeObjectURL(v)},100)})}catch{}t.userInput.qoute.id=s.message_id,t.userInput.qoute.display_name=s.user_display_name,t.userInput.qoute.user_id=s.sender_id,t.CancelEditText(),setTimeout(()=>{t.WillLeave||(t.make_ext_hidden(),t.userInputTextArea.focus())},0)}catch(f){console.log("\uba54\uc2dc\uc9c0 \uc778\uc6a9\ud558\uae30 \uc2e4\ud328: ",f),t.p5toast.show({text:`${t.lang.text.ChatRoom.MsgWork}: ${f}`})}};if("local"!=t.isOfficial&&s.sender_id!=t.nakama.servers[t.isOfficial][t.target].session.user_id)u();else{let v=t.nakama.deserialize_text(s),y=s.content.url;if(s.content.viewer){try{const $=yield t.indexed.loadBlobFromUserPath(`${s.content.path}_thumbnail.png`,s.content.type);y=URL.createObjectURL($)}catch{try{const P=yield t.indexed.loadBlobFromUserPath(s.content.path,s.content.type);y=URL.createObjectURL(P)}catch{}}v=`(${t.lang.text.ChatRoom.attachments}) ${v}`}const M=t.global.HTMLEncode(v),R=y?`<div style="text-align: center;">${M}</div>`:`<div>${M}</div>`,L=y?`<div style="width: 100%;"><img src="${y}" alt="${s.content.filename}" style="border-radius: 8px; max-height: 230px; position: relative; left: 50%; transform: translateX(-50%); ${t.info.HideAutoThumbnail?"filter: blur(6px);":""}"/></div>`+R:R;(yield t.alertCtrl.create({header:t.lang.text.ChatRoom.MsgWork,message:new Z.Vk(L),buttons:[{text:t.lang.text.ChatRoom.qouteMsg,handler:()=>{u()}},{text:t.lang.text.ChatRoom.memoMsg,handler:()=>{try{if(t.userInput.qoute=void 0,setTimeout(()=>{t.ResizeTextArea(),t.userInputTextArea.style.height=t.userInputTextArea.scrollHeight+"px"},0),t.userInput.memo={timestamp:s.create_time},m&&(t.userInput.memo.text=t.global.truncateString(m,80)),s.content.viewer)if("image"==s.content.viewer){if(s.content.url)t.userInput.memo.url=s.content.url,t.userInput.memo.path=s.content.url;else if(s.content.path&&(t.userInput.memo.path=s.content.path.split("/").pop(),!t.userInput.memo.url)){let $=`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/files/${t.userInput.memo.path}`;t.indexed.checkIfFileExist($).then(P=>{P&&t.indexed.loadBlobFromUserPath($,s.content.type).then(j=>{const G=URL.createObjectURL(j);t.userInput.memo.url=G,setTimeout(()=>{URL.revokeObjectURL(G)},100)})})}}else try{t.indexed.loadBlobFromUserPath(`${s.content.path}_thumbnail.png`,"image/png").then($=>{const P=URL.createObjectURL($);t.userInput.memo.url=P,setTimeout(()=>{URL.revokeObjectURL(P)},100)})}catch{}t.CancelEditText(),t.userInput.memo.orig_msg=JSON.parse(JSON.stringify(s)),t.userInput.memo.id=s.message_id,t.userInput.text="",setTimeout(()=>{t.WillLeave||(t.make_ext_hidden(),t.userInputTextArea.focus())},0)}catch($){console.log("\uba54\uc2dc\uc9c0\uc5d0 \uba54\ubaa8\ud558\uae30: ",$),t.p5toast.show({text:`${t.lang.text.ChatRoom.MsgWork}: ${$}`})}}}]})).present()}}else if(-80>k)try{let g;for(let s=0,m=t.ViewableMessage.length;s<m;s++)if(t.TargetMessageObject.id==t.ViewableMessage[s].message_id){g=s;break}if(void 0===g)throw"\uba54\uc2dc\uc9c0\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc74c";let w=t.ViewableMessage[g];yield t.CopyMessageText(w)}catch(g){console.log("\uba54\uc2dc\uc9c0 \ubcf5\uc0ac\ud558\uae30 \uc2e4\ud328: ",g)}}catch(g){console.log("\uc778\uc6a9 \ubc0f \uba54\ubaa8 \uc791\uc131 \ub3d9\uc791 \uc624\ub958: ",g)}t.TargetMessageObject&&(t.TargetMessageObject.style.paddingRight=null,t.TargetMessageObject.style.marginRight=null,t.TargetMessageObject.style.marginLeft=null),k=0,t.MsgClickedStartPos=null,t.TargetMessageObject=null,t.IsQouteMyMessage=null});return function(){return h.apply(this,arguments)}}()})}FindQoute(t,i){var n=this;return(0,p.A)(function*(){let o,r,d,_;for(let x=n.ViewableMessage.length-1;x>=0;x--)if(t==n.ViewableMessage[x].message_id){d=t,_=t+"_bg";break}const b=n.info.info?n.info.info.name||n.nakama.usernameOverride[n.info.info.isOfficial][n.info.info.target][n.info.info.id]||n.info.info.display_name||n.lang.text.ChatRoom.noname_chatroom:n.info.title||n.lang.text.ChatRoom.noname_chatroom;if(n.OnFinding=!0,n.BlockAutoScrollDown=!0,n.p5loading.update({id:"FindQoute",message:`${b}: ${n.lang.text.ChatRoom.FindingMsg}`,progress:null,forceEnd:null}),!d){let x=!1;for(;!d&&n.pullable&&!x;){if(!n.nakama.ChatroomLinkAct)return;yield n.pull_msg_history();for(let h=n.ViewableMessage.length-1;h>=0;h--){if(new Date(n.ViewableMessage[h].create_time).getTime()<new Date(i).getTime()){x=!0;break}if(t==n.ViewableMessage[h].message_id){d=t,_=t+"_bg";break}}}}let k=()=>{var x;null===(x=o)||void 0===x||x.scrollIntoView({block:"center",behavior:"smooth"}),setTimeout(()=>{n.WillLeave||r&&(r.style.backgroundColor="rgba(var(--ion-color-secondary-rgb), .5)")},100),setTimeout(()=>{n.BlockAutoScrollDown=!1,n.OnFinding=!1,!n.WillLeave&&n.ListOnScrollAct()},3500)};if(yield new Promise(x=>setTimeout(x,500)),n.TargetMessageBackground&&(n.TargetMessageBackground.style.backgroundColor=null),o=document.getElementById(d),r=document.getElementById(_),n.TargetMessageObject=o,n.TargetMessageBackground=r,n.nakama.ChatroomLinkAct)return d&&n.WillLeave?(n.p5loading.update({id:"FindQoute",message:`${b}: ${n.lang.text.ChatRoom.MsgFound}`,progress:1}),void n.QueuedAct.push(()=>{d=t,_=t+"_bg",o=document.getElementById(d),r=document.getElementById(_),n.CreateCurrentThumbnails().then(()=>{k(),n.p5loading.update({id:"FindQoute",clickable:()=>{k()},forceEnd:2500},!0)})})):(d?(n.p5loading.update({id:"FindQoute",message:`${b}: ${n.lang.text.ChatRoom.MsgFound}`,progress:1}),n.CreateCurrentThumbnails().then(()=>{k()})):(n.p5loading.update({id:"FindQoute",message:`${b}: ${n.lang.text.ChatRoom.LostOriginMsg}`,progress:0}),n.BlockAutoScrollDown=!1,n.OnFinding=!1),void n.p5loading.update({id:"FindQoute",clickable:()=>{k()},forceEnd:2500},!0))})()}RemoveQoute(){this.TargetMessageBackground&&(this.TargetMessageBackground.style.backgroundColor=null),delete this.userInput.qoute,delete this.userInput.memo}CreateCurrentThumbnails(){var t=this;return(0,p.A)(function*(){for(let i=t.ViewableMessage.length-1;i>=0;i--)if(t.ViewableMessage[i].content.filename){let n;t.ViewableMessage[i].content.path=`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/files/msg_${t.ViewableMessage[i].message_id}.${t.ViewableMessage[i].content.file_ext}`;try{const o=yield t.indexed.loadBlobFromUserPath(t.ViewableMessage[i].content.path,t.ViewableMessage[i].content.type);n=URL.createObjectURL(o),t.global.modulate_thumbnail(t.ViewableMessage[i].content,n,t.cont)}catch{t.info.HideAutoThumbnail||t.global.modulate_thumbnail(t.ViewableMessage[i].content,"",t.cont)}t.ViewableMessage[i].content.qoute&&t.OpenQouteThumbnail(t.ViewableMessage[i])}})()}DropSendAct(t){var i=this;return(0,p.A)(function*(){for(let n=0,o=t.length;n<o;n++)i.selected_blobFile_callback_act(t[n].file,void 0,void 0,void 0,!1),i.send();setTimeout(()=>{i.scroll_down_logs()},300)})()}selected_blobFile_callback_act(t,i=[],n="loaded",o,r=!0){this.userInput.file={},this.userInput.file.filename=t.name,this.userInput.file.file_ext=t.name.split(".").pop()||t.type||this.lang.text.ChatRoom.unknown_ext,this.userInput.file.size=t.size,this.userInput.file.type=t.type||t.type_override,o&&(this.userInput.file.path=o),this.userInput.file.content_related_creator=[...i];try{this.userInput.file.content_related_creator.length<2&&this.userInput.file.content_related_creator.push({user_id:this.info.local?"local":this.nakama.servers[this.isOfficial][this.target].session.user_id,timestamp:(new Date).getTime(),display_name:this.nakama.users.self.display_name,various:n})}catch{}this.userInput.file.content_creator={timestamp:(new Date).getTime()};try{this.userInput.file.content_creator={user_id:this.info.local?"local":this.nakama.servers[this.isOfficial][this.target].session.user_id,timestamp:(new Date).getTime(),display_name:this.nakama.users.self.display_name,various:n}}catch{}this.userInput.file.blob=t,this.create_selected_thumbnail(r),this.inputPlaceholder=`(${this.lang.text.ChatRoom.attachments}: ${this.userInput.file.filename})`}create_thumbnail_imported(t){var i=this;return(0,p.A)(function*(){if(t.url)yield i.new_attach({detail:{value:"link"}},t);else{let n=yield i.indexed.loadBlobFromUserPath(t.path,t.type),o=new File([n],t.filename||t.name);i.selected_blobFile_callback_act(o,t.content_related_creator,"shared",t.path)}})()}create_selected_thumbnail(t=!0){var i=this;return(0,p.A)(function*(){var n;if(i.global.set_viewer_category_from_ext(i.userInput.file),i.userInput.file.url){try{if(i.OnFinding||i.info.HideAutoThumbnail)throw"\uac80\ud1a0\ud558\uc9c0 \uc54a\ub294 \uc21c\uac04";(yield fetch(i.userInput.file.url,{method:"HEAD",signal:i.cont.signal})).ok&&(i.userInput.file.thumbnail=i.userInput.file.url)}catch{}return void(i.userInput.file.typeheader=i.userInput.file.viewer)}const o=URL.createObjectURL(i.userInput.file.blob);if(t&&(yield i.p5loading.update({id:i.FileActId,message:`${i.lang.text.ContentViewer.OnLoadContent}: ${i.userInput.file.blob.name}`,image:null,forceEnd:null})),t&&"image"==(null===(n=i.userInput.file)||void 0===n?void 0:n.viewer)&&i.p5loading.update({id:i.FileActId,image:o}),t&&i.p5loading.remove(i.FileActId),i.userInput.file.typeheader=i.userInput.file.blob.type.split("/")[0]||i.userInput.file.viewer,setTimeout(()=>{URL.revokeObjectURL(o)},500),!i.userInput.file.thumbnail)switch(i.userInput.file.viewer){case"image":i.userInput.file.thumbnail=i.sanitizer.bypassSecurityTrustUrl(o);break;case"code":case"text":new Y(r=>{r.setup=()=>{r.noCanvas(),r.loadStrings(o,d=>{i.userInput.file.thumbnail=d,r.remove()},d=>{console.error("\ubb38\uc790\uc5f4 \ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",d),r.remove()})}})}})()}SelfSyncNotiInfo(){var t=this;return(0,p.A)(function*(){if(t.info.is_new){try{yield t.nakama.servers[t.isOfficial][t.target].client.rpc(t.nakama.servers[t.isOfficial][t.target].session,"send_noti_fn",{receiver_id:[t.nakama.servers[t.isOfficial][t.target].session.user_id],title:"chatroom_read",content:{id:`${t.info.id}`},code:ee.I.CHATROOM_CHECKED,persistent:!1})}catch{}t.info.is_new=!1,t.nakama.has_new_channel_msg=!1}})()}init_chatroom(){var t=this;return(0,p.A)(function*(){t.InitWithFileImport||(t.userInput.text="",delete t.userInput.file,delete t.userInput.qoute),t.InitWithRoomEnv&&(t.BlockAutoScrollDown=!1,t.ResizeTextArea(),t.nakama.OnTransferMessage={},t.ViewableMessage.length=0,t.ViewMsgIndex=0,t.ShowGoToBottom=!1,t.ShowRecentMsg=!1,t.isHistoryLoaded=!1,t.LocalHistoryList.length=0,t.messages.length=0,t.prev_cursor="",t.next_cursor="",t.pullable=!0,t.is_pulling=!1,t.OnFinding=!1,t.init_last_message_viewer(),t.file_sel_id=`chatroom_${t.info.id}_${(new Date).getTime()}`,t.ChannelUserInputId=`chatroom_input_${t.info.id}_${(new Date).getTime()}`,t.isOfficial=t.info.server.isOfficial,t.target=t.info.server.target,t.info=t.nakama.channels_orig[t.isOfficial][t.target][t.info.id],t.FileActId=`chatroom_withfile_${t.info.id}`,t.LoadChannelBackgroundImage(),t.nakama.opened_page_info.channel={isOfficial:t.isOfficial,target:t.target,id:t.info.id},t.foundLastRead=t.info.last_read_id==t.info.last_comment_id,t.SetExtensionButtons()),t.nakama.channels_orig[t.isOfficial][t.target]&&t.nakama.channels_orig[t.isOfficial][t.target][t.info.id]&&"missing"!=t.info.status&&(t.nakama.channels_orig[t.isOfficial][t.target][t.info.id].update=i=>{if(1==i.code){for(let o=0,r=t.messages.length;o<r;o++)if(t.messages[o].message_id==i.message_id){t.messages[o].content=i.content,t.global.modulate_thumbnail(t.messages[o].content,t.messages[o].content.url,t.cont),t.nakama.ServerBaseMessageWork(t.messages[o],t.isOfficial,t.target,t.cont,()=>{setTimeout(()=>{t.NeedScrollDown()&&t.scroll_down_logs()},100)});break}return}t.CheckIfHasScroll=t.ChatLogs.scrollHeight>t.ChatLogs.clientHeight;let n="local"==i.sender_id;if(i.content.filename&&t.ModulateFileEmbedMessage(i),t.info.last_read_id=i.message_id,n||t.check_if_send_msg(i),1!=i.code&&2!=i.code)try{t.messages[t.messages.length-1].message_id!=i.message_id&&t.messages.push(i)}catch{t.messages.push(i)}if(2==i.code)for(let o=t.messages.length-1;o>=0;o--)if(t.messages[o].message_id==i.message_id){t.messages.splice(o,1);break}i.content.qoute&&t.OpenQouteThumbnail(i),t.nakama.ServerBaseMessageWork(i,t.isOfficial,t.target,t.cont,()=>{setTimeout(()=>{t.NeedScrollDown()&&t.scroll_down_logs()},100)}),t.ViewMsgIndex+t.ViewCount==t.messages.length-1&&t.ViewMsgIndex++,t.ViewableMessage=t.messages.slice(t.ViewMsgIndex,t.ViewMsgIndex+t.ViewCount),t.CheckIfShortcutLinkFile(),t.pullable=(t.info.local?!!t.LocalHistoryList.length:void 0!==t.next_cursor)||t.ViewMsgIndex>0,t.modulate_chatmsg(0,t.ViewableMessage.length),t.modulate_chatmsg(t.ViewableMessage.length-1,t.ViewableMessage.length),t.ShowRecentMsg=t.messages.length>t.ViewMsgIndex+t.ViewCount,t.useSpeaker&&t.SpeechReceivedMessage(i),setTimeout(()=>{if(!t.WillLeave)if(t.NeedScrollDown()&&!t.ShowRecentMsg)t.init_last_message_viewer(),t.ChatLogs.scrollTo({top:t.ChatLogs.scrollHeight,behavior:"smooth"});else if(2!=i.code){t.last_message_viewer.is_me=!!t.info.local||i.sender_id==t.nakama.servers[t.isOfficial][t.target].session.user_id,t.last_message_viewer.user_id=i.sender_id;let o=JSON.parse(JSON.stringify(i.content.msg));i.content.filename&&(o.length?o[0][0].text=`(${t.lang.text.ChatRoom.attachments}) ${o[0][0].text}`:o=[[{text:`(${t.lang.text.ChatRoom.attachments})`}]]),t.last_message_viewer.message=o,t.last_message_viewer.color=i.color}},100),t.global.godot_window&&t.global.godot_window.received_msg&&t.global.godot_window.received_msg({sender_id:i.sender_id,user_display_name:i.user_display_name,content:i.content})}),(t.InitWithFileImport||t.InitWithRoomEnv)&&(yield t.pull_msg_history(),setTimeout(()=>{t.WillLeave||(t.ChatLogs.scrollTo({top:t.ChatLogs.scrollHeight,behavior:"smooth"}),t.CheckIfHasScroll=t.ChatLogs.scrollHeight>t.ChatLogs.clientHeight)},500))})()}OpenQouteThumbnail(t){let i=`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/${t.content.qoute.path}`;this.indexed.checkIfFileExist(i).then(n=>{let o=i.split(".").pop(),r="";"svg"===o&&(r="image/svg+xml"),n?this.indexed.loadBlobFromUserPath(i,r).then(d=>{const _=URL.createObjectURL(d);t.content.qoute.url=_,setTimeout(()=>{URL.revokeObjectURL(_)},100)}):t.content.qoute.path&&0==t.content.qoute.path.indexOf("http")?t.content.qoute.url=t.content.qoute.path:this.indexed.GetFileListFromDB(`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${t.content.qoute.id}`).then(_=>{let b=_.pop();b&&b.indexOf("_thumbnail.png")&&this.indexed.loadBlobFromUserPath(b,r).then(k=>{const I=URL.createObjectURL(k);t.content.qoute.url=I,setTimeout(()=>{URL.revokeObjectURL(I)},100)})})})}SetExtensionButtons(){switch(this.extended_buttons.forEach(i=>{i.isHide=!1,i.index=void 0}),this.info.redirect.type){case 2:"missing"!=this.info.status&&(this.info.redirect?"online"==this.statusBar.groupServer[this.isOfficial][this.target]&&(this.info.status=this.nakama.load_other_user(this.info.redirect.id,this.isOfficial,this.target).online?"online":"pending"):this.info.status=this.info.info.online?"online":"pending",this.extended_buttons[0].isHide=!0,this.extended_buttons[1].isHide=!0,this.extended_buttons[9].isHide=!0,this.extended_buttons[12].isHide=!0);break;case 3:"missing"!=this.info.status&&this.nakama.load_groups(this.isOfficial,this.target,this.info.group_id),this.extended_buttons[1].isHide=!0,this.extended_buttons[10].isHide=!0,delete this.extended_buttons[0].isHide,this.extended_buttons[9].isHide=!0,this.extended_buttons[11].isHide=!0,this.extended_buttons[12].isHide=!0;break;case 0:this.extended_buttons[0].isHide=!0,this.extended_buttons[11].isHide=!0}void 0===this.info.status||"missing"==this.info.status?(this.extended_buttons.forEach(i=>{i.isHide=!0}),this.extended_buttons[12].isHide=!1,3==this.info.redirect.type&&(this.extended_buttons[0].isHide=!1)):this.extended_buttons[10].isHide=N.Yl||"missing"==this.info.status,this.extended_buttons[2].isHide=!1;let t=1;this.extended_buttons.forEach(i=>{!i.isHide&&t<11&&(i.index=t%10,t++)}),this.ExtTarget.length=0;for(let i=0,n=this.extended_buttons.length;i<n;i++)this.extended_buttons[i].isHide||this.ExtTarget.push(this.extended_buttons[i])}CopyMessageText(t){var i=this;return(0,p.A)(function*(){try{let n=i.nakama.deserialize_text(t);if(!n)try{if(!t.content.url)throw"URL \uc5c6\uc74c";n=t.content.url.replace(/ /g,"%20")}catch{let r=t.content.path;return n=yield i.indexed.loadBlobFromUserPath(r,t.content.type),void(yield i.global.WriteValueToClipboard(n.type,n,t.content.filename,i.FileActId))}yield i.global.WriteValueToClipboard("text/plain",n,void 0,"chatroom")}catch(n){console.log("\ud074\ub9bd\ubcf4\ub4dc \ubcf5\uc0ac \uc2e4\ud328: ",n)}})()}init_last_message_viewer(){delete this.last_message_viewer.user_id,delete this.last_message_viewer.message,delete this.last_message_viewer.color,delete this.last_message_viewer.is_me}NeedScrollDown(){return this.ChatLogs.scrollHeight-(this.ChatLogs.scrollTop+this.ChatLogs.clientHeight)<this.ChatLogs.scrollHeight/12}scroll_down_logs(){this.ShowRecentMsg||this.init_last_message_viewer(),this.ChatLogs.scrollTo({top:this.ChatLogs.scrollHeight,behavior:"smooth"})}check_if_send_msg(t){for(let i=0,n=this.sending_msg.length;i<n;i++)if(t.sender_id==this.nakama.servers[this.isOfficial][this.target].session.user_id&&t.content.local_comp==this.sending_msg[i].content.local_comp){t.content.filename&&this.auto_open_thumbnail(t),this.sending_msg.splice(i,1);break}}auto_open_thumbnail(t){try{this.temporary_open_thumbnail[t.message_id](t.actId)}catch{this.temporary_open_thumbnail[t.message_id]=n=>{t.content.url?this.global.modulate_thumbnail(t.content,"",this.cont):(this.indexed.loadBlobFromUserPath(`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${t.message_id}.${t.content.file_ext}`,t.content.type).then(o=>{t.content.path=`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${t.message_id}.${t.content.file_ext}`;let r=URL.createObjectURL(o);this.global.modulate_thumbnail(t.content,r,this.cont),this.NeedScrollDown()&&setTimeout(()=>{this.scroll_down_logs()},100),this.nakama.WriteStorage_From_channel(t,t.content.path,this.isOfficial,this.target,void 0,n)}),delete this.temporary_open_thumbnail[t.message_id])}}}removeAttach(){this.ModifyEditedMessage=void 0,this.VideoEditedTimestamp=void 0,delete this.userInput.file,this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder}pull_msg_history(t=!0){var i=this;return(0,p.A)(function*(){if((!t||i.pullable&&(void 0!==i.next_cursor||0!=i.ViewMsgIndex))&&(t||!i.BlockAutoScrollDown)&&!i.is_pulling){if(i.is_pulling=!0,i.pullable=!1,t){try{if(i.info.local)throw"Local channel";if(void 0===i.info.status||"missing"==i.info.status)throw"Channel missing";if(0!=i.ViewMsgIndex){let o=Math.min(i.ViewMsgIndex,i.RefreshCount);i.ViewMsgIndex-=o,i.ViewableMessage=i.messages.slice(i.ViewMsgIndex,i.ViewMsgIndex+i.ViewCount),i.CheckIfShortcutLinkFile();for(let r=0;r<o;r++){let d;try{i.ViewableMessage[r].content.path=`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${i.ViewableMessage[r].message_id}.${i.ViewableMessage[r].content.file_ext}`;let _=yield i.indexed.loadBlobFromUserPath(i.ViewableMessage[r].content.path,i.ViewableMessage[r].content.type);d=URL.createObjectURL(_)}catch{}!i.OnFinding&&!i.info.HideAutoThumbnail&&i.global.modulate_thumbnail(i.ViewableMessage[r].content,d,i.cont),i.modulate_chatmsg(r,o+1),i.ViewableMessage[r].content.qoute&&i.OpenQouteThumbnail(i.ViewableMessage[r])}return i.modulate_chatmsg(0,i.ViewableMessage.length),i.ShowRecentMsg=i.messages.length>i.ViewMsgIndex+i.ViewCount,i.pullable=void 0!==i.next_cursor||0!=i.ViewMsgIndex,void(i.is_pulling=!1)}let n=yield i.nakama.servers[i.isOfficial][i.target].client.listChannelMessages(i.nakama.servers[i.isOfficial][i.target].session,i.info.id,i.RefreshCount,!1,i.next_cursor);n.messages.forEach(o=>{if(o=i.nakama.modulation_channel_message(o,i.isOfficial,i.target),i.nakama.check_sender_and_show_name(o,i.isOfficial,i.target),i.info.last_comment||2!=o.code&&(i.info.last_comment=(o.content.filename?`(${i.lang.text.ChatRoom.attachments}) `:"")+(o.content.msg||o.content.noti||"")),!i.foundLastRead&&i.info.last_read_id?i.info.last_read_id==o.message_id&&(o.isLastRead=!0,i.foundLastRead=!0,i.info.last_read_id=i.info.last_comment_id,i.nakama.save_channels_with_less_info()):i.foundLastRead=!0,i.nakama.translate_updates(o),o.content.filename&&i.ModulateFileEmbedMessage(o),i.nakama.CatchQouteMsgUserName(o,i.isOfficial,i.target),i.nakama.ModulateTimeDate(o),i.nakama.content_to_hyperlink(o,i.isOfficial,i.target),i.nakama.ServerBaseMessageWork(o,i.isOfficial,i.target,i.cont,()=>{setTimeout(()=>{i.NeedScrollDown()&&i.scroll_down_logs()},100)}),2!=o.code){let r=!0;for(let d=i.messages.length-1;d>=i.messages.length-i.RefreshCount-1&&d>=0;d--)if(i.messages[d].message_id==o.message_id){r=!1;break}r&&i.messages.unshift(o)}}),i.ViewableMessage=i.messages.slice(i.ViewMsgIndex,i.ViewMsgIndex+i.ViewCount),i.CheckIfShortcutLinkFile();for(let o=0,r=i.ViewableMessage.length;o<r;o++){let d;try{if(!i.ViewableMessage[o].content.file_ext)throw"\ud30c\uc77c\uc774 \uc5c6\ub294 \uba54\uc2dc\uc9c0";if(i.ViewableMessage[o].content.url)throw"\ub9c1\ud06c\ub41c \ud30c\uc77c";i.ViewableMessage[o].content.path=`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${i.ViewableMessage[o].message_id}.${i.ViewableMessage[o].content.file_ext}`,i.indexed.checkIfFileExist(i.ViewableMessage[o].content.path).then(_=>{_&&i.indexed.loadBlobFromUserPath(i.ViewableMessage[o].content.path,i.ViewableMessage[o].content.type).then(b=>{d=URL.createObjectURL(b),i.global.modulate_thumbnail(i.ViewableMessage[o].content,d,i.cont)}).catch(b=>{})})}catch{!i.OnFinding&&!i.info.HideAutoThumbnail&&i.global.modulate_thumbnail(i.ViewableMessage[o].content,"",i.cont)}i.modulate_chatmsg(o,r+1),i.ViewableMessage[o].content.qoute&&i.OpenQouteThumbnail(i.ViewableMessage[o])}i.modulate_chatmsg(0,i.ViewableMessage.length),i.ShowRecentMsg=i.messages.length>i.ViewMsgIndex+i.ViewCount,i.next_cursor=n.next_cursor,i.prev_cursor=n.prev_cursor,i.pullable=void 0!==i.next_cursor||0!=i.ViewMsgIndex,i.nakama.saveListedMessage(i.messages,i.info,i.isOfficial,i.target,void 0===i.next_cursor)}catch{yield i.LoadLocalChatHistory()}setTimeout(()=>{i.WillLeave||i.ChatContDiv&&i.ChatContDiv.clientHeight<i.ChatLogs.clientHeight&&i.pull_msg_history()},0)}else{let n=i.messages.length-i.ViewMsgIndex-i.ViewCount;i.ShowRecentMsg=0!=n,i.ViewMsgIndex+=Math.min(i.RefreshCount,Math.max(0,n)),i.ViewableMessage=i.messages.slice(i.ViewMsgIndex,i.ViewMsgIndex+i.ViewCount),i.CheckIfShortcutLinkFile();for(let o=i.ViewableMessage.length-1;o>=0;o--){let r;try{i.ViewableMessage[o].content.path=`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${i.ViewableMessage[o].message_id}.${i.ViewableMessage[o].content.file_ext}`;let d=yield i.indexed.loadBlobFromUserPath(i.ViewableMessage[o].content.path,i.ViewableMessage[o].content.type);r=URL.createObjectURL(d)}catch{}!i.OnFinding&&!i.info.HideAutoThumbnail&&i.global.modulate_thumbnail(i.ViewableMessage[o].content,r,i.cont),i.modulate_chatmsg(o,i.ViewableMessage.length),i.ViewableMessage[o].content.qoute&&i.OpenQouteThumbnail(i.ViewableMessage[o])}i.pullable=!0}i.is_pulling=!1}})()}SpeechReceivedMessage(t){try{if(0!=t.code)throw"\uc77c\ubc18 \uc218\uc2e0 \uba54\uc2dc\uc9c0\uac00 \uc544\ub2d8";let i=JSON.parse(JSON.stringify(t.content.msg)),n="";for(let o=0,r=i.length;o<r;o++)for(let d=0,_=i[o].length;d<_;d++)n+=i[o][d].text+" ";n&&n.trim()&&this.SpeechThese.push(n),this.isSpeeching||this.SpeechingTexts()}catch{}}SpeechingTexts(){var t=this;return(0,p.A)(function*(){let i=t.SpeechThese.shift();t.isSpeeching=!0,i&&i.trim()&&(yield ie.x.speak({text:i,lang:t.lang.lang})),t.SpeechThese.length?t.SpeechingTexts():t.isSpeeching=!1})()}LoadLocalChatHistory(){var t=this;return(0,p.A)(function*(){if(t.ViewMsgIndex>0){let i=Math.min(t.ViewableMessage.length,Math.min(t.ViewMsgIndex,t.RefreshCount));t.ViewMsgIndex-=i,t.ViewableMessage=t.messages.slice(t.ViewMsgIndex,t.ViewMsgIndex+t.ViewCount),t.CheckIfShortcutLinkFile();for(let n=i-1;n>=0;n--){let o;try{t.ViewableMessage[n].content.path=`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/files/msg_${t.ViewableMessage[n].message_id}.${t.ViewableMessage[n].content.file_ext}`;let r=yield t.indexed.loadBlobFromUserPath(t.ViewableMessage[n].content.path,t.ViewableMessage[n].content.type);o=URL.createObjectURL(r)}catch{}t.global.modulate_thumbnail(t.ViewableMessage[n].content,o,t.cont),t.modulate_chatmsg(n,i+1),t.ViewableMessage[n].content.qoute&&t.OpenQouteThumbnail(t.ViewableMessage[n])}return t.ShowRecentMsg=t.messages.length>t.ViewMsgIndex+t.ViewCount,t.pullable=0!=t.ViewMsgIndex||!!t.LocalHistoryList.length,void(t.pullable&&t.ViewableMessage.length&&t.ViewableMessage.length<t.RefreshCount&&(yield t.LoadLocalChatHistory()))}if(t.isHistoryLoaded){try{let i=t.LocalHistoryList.pop();if(!i)throw"\uae30\ub85d \uc5c6\uc74c";let n=yield t.indexed.loadTextFromUserPath(i);if(n){let o=JSON.parse(n.trim()),r=0;for(let _=o.length-1;_>=0;_--)t.nakama.translate_updates(o[_]),o[_]=t.nakama.modulation_channel_message(o[_],t.isOfficial,t.target),t.nakama.CatchQouteMsgUserName(o[_],t.isOfficial,t.target),t.nakama.ModulateTimeDate(o[_]),t.nakama.content_to_hyperlink(o[_],t.isOfficial,t.target),o[_].content.path=`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/files/msg_${o[_].message_id}.${o[_].content.file_ext}`,2!=o[_].code&&(r++,t.messages.unshift(o[_]));t.ViewMsgIndex=Math.max(0,r-t.RefreshCount),t.ViewableMessage=t.messages.slice(t.ViewMsgIndex,t.ViewMsgIndex+t.ViewCount),t.CheckIfShortcutLinkFile();let d=Math.min(Math.min(r,t.RefreshCount),t.ViewableMessage.length);for(let _=d-1;_>=0;_--){let b;try{let k=yield t.indexed.loadBlobFromUserPath(t.ViewableMessage[_].content.path,t.ViewableMessage[_].content.type);b=URL.createObjectURL(k)}catch{}t.global.modulate_thumbnail(t.ViewableMessage[_].content,b,t.cont),t.modulate_chatmsg(_,d),t.ViewableMessage[_].content.qoute&&t.OpenQouteThumbnail(t.ViewableMessage[_])}t.ShowRecentMsg=t.messages.length>t.ViewMsgIndex+t.ViewCount}else yield t.LoadLocalChatHistory()}catch{}t.pullable=0!=t.ViewMsgIndex||!!t.LocalHistoryList.length,t.pullable&&t.ViewableMessage.length<t.RefreshCount&&t.LoadLocalChatHistory()}else{let i=yield t.indexed.GetFileListFromDB(`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/chats/`);t.LocalHistoryList=i;for(let n=i.length-1;n>=0;n--){let o=i[n].split("/");"chats"!=o[o.length-4]&&i.splice(n,1)}if(t.isHistoryLoaded=!0,!t.LocalHistoryList.length)return;t.LoadLocalChatHistory()}})()}ChatBalloonMouseDown(t,i){2==t.which&&(this.TargetMessageBackground&&(this.TargetMessageBackground.style.backgroundColor=null),this.IsQouteMyMessage=i.is_me,this.MsgClickedStartPos=t.clientX,this.TargetMessageObject=document.getElementById(i.message_id),this.TargetMessageBackground=document.getElementById(i.message_id+"_bg"),this.MsgClickedStartPos=t.clientX+90,this.p5ChatMsgDragAct(t.clientX))}ChatBalloonOnTouchStart(t,i){try{this.TargetMessageBackground&&(this.TargetMessageBackground.style.backgroundColor=null),this.IsQouteMyMessage=i.is_me,this.MsgClickedStartPos=t.touches[0].clientX,this.TargetMessageObject=document.getElementById(i.message_id),this.TargetMessageBackground=document.getElementById(i.message_id+"_bg")}catch{}}ChatBalloonContextMenu(t){try{let i;for(let n=0,o=this.ViewableMessage.length;n<o;n++)if(t.message_id==this.ViewableMessage[n].message_id){i=n;break}if(void 0===i)throw"\uba54\uc2dc\uc9c0\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc74c";"DesktopPWA"==N.aH&&this.CopyMessageText(this.ViewableMessage[i]),this.message_detail(t,i)}catch(i){console.log("\uba54\uc2dc\uc9c0 \uc0c1\uc138\ubcf4\uae30 \uc2e4\ud328: ",i)}return!1}open_ext_with_delay(){this.ScrollNearLogs(),this.isHidden=!this.isHidden}make_ext_hidden(){this.ScrollNearLogs(),this.global.NeedBackgroundMode&&(this.isHidden=!0)}ScrollNearLogs(){this.NeedScrollDown()&&(this.ChatLogs.scrollTo({top:this.ChatLogs.scrollHeight,behavior:"smooth"}),this.CheckIfHasScroll=this.ChatLogs.scrollHeight>this.ChatLogs.clientHeight,setTimeout(()=>{this.ChatLogs.scrollTo({top:this.ChatLogs.scrollHeight,behavior:"smooth"}),this.CheckIfHasScroll=this.ChatLogs.scrollHeight>this.ChatLogs.clientHeight},150))}ResizeTextArea(){this.userInputTextArea&&(this.userInputTextArea.style.height="36px")}check_key(t){"DesktopPWA"==N.aH?"Enter"!=t.key||t.shiftKey||"keydown"!=t.type?setTimeout(()=>{this.ResizeTextArea(),this.userInputTextArea.style.height=this.userInputTextArea.scrollHeight+"px"},0):this.send(!0):setTimeout(()=>{this.ResizeTextArea(),this.userInputTextArea.style.height=this.userInputTextArea.scrollHeight+"px"},0)}SendQueuedMessages(){var t=this;return(0,p.A)(function*(){if(!t.isSendingQueue){for(t.isSendingQueue=!0;t.SendQueue.length;){const o=t.SendQueue.shift();if(!o)continue;yield t.p5loading.update({id:o.actId,progress:null,forceEnd:null},!0);let r={};try{if(o.text.length>600)throw"\uba54\uc2dc\uc9c0\uac00 \ucda9\ubd84\ud788 \uae41\ub2c8\ub2e4";const h=!!o.memo;if(void 0!==o.IsMsgEditMode){let g=!1;if(h||(o.IsMsgEditMode.content.msg=o.text,o.IsMsgEditMode.content.thumbnail&&(o.IsMsgEditMode.content.thumbnail=o.IsMsgEditMode.thumbnail),o.IsMsgEditMode.update_time=(new Date).toISOString()),o.IsMsgEditMode.content.edited=o.IsMsgEditMode.content.edited||!h,h&&(o.IsMsgEditMode.content.hasLink||(o.IsMsgEditMode.content.hasLink={}),o.IsMsgEditMode.content.hasLink.title=o.text),t.info.local)g=!0;else try{yield t.nakama.servers[t.isOfficial][t.target].socket.updateChatMessage(t.info.id,o.IsMsgEditMode.message_id,o.IsMsgEditMode.content),g=!0}catch(w){console.log("\uba54\uc2dc\uc9c0 \ud3b8\uc9d1 \uc694\uccad \uc624\ub958: ",w)}if(!g)continue;t.info.local&&(o.IsMsgEditMode.code=1,t.nakama.content_to_hyperlink(o.IsMsgEditMode,t.isOfficial,t.target),o.IsMsgEditMode.update_time=Date.now(),t.SendLocalMessage(o.IsMsgEditMode)),t.CancelEditText();continue}var i;h&&null!==(i=o.memo)&&void 0!==i&&i.text&&(r.hasLink={title:o.memo.text})}catch(h){console.log("\uba54\uc2dc\uc9c0 \ud3b8\uc9d1 \ub610\ub294 \uba54\ubaa8 \ub3d9\uc791 \uc624\ub958: ",h),t.CancelEditText()}if(t.isHidden=!0,o.text.length>600){const h=yield t.LongTextMessageAsFile(o.text,o.actId);o.file=h,o.text=""}r.msg=o.text;let d=!1,_=!1;if(o.qoute&&(r.qoute=o.qoute),o.file){r.filename=o.file.filename,r.file_ext=o.file.file_ext,r.type=o.file.type;try{var n;if(r.size=o.file.size||(null===(n=o.file.blob)||void 0===n?void 0:n.size),!r.size)throw"\uc2e4\uc81c\ub85c \ud30c\uc77c\uc744 \ubc1b\uc740 \uac83\uc774 \uc544\ub2d8";r.partsize=Math.ceil(r.size/te.xM)}catch{r.url=o.file.url,_=!0}if(r.content_creator=o.file.content_creator,r.content_related_creator=o.file.content_related_creator,!_&&!t.info.local&&2!=t.useFirstCustomCDN)try{const h=t.nakama.servers[t.isOfficial][t.target].info.address,g=t.nakama.servers[t.isOfficial][t.target].info.useSSL?"https:":"http:",w=`${t.info.group_id||(t.info.user_id_one==t.nakama.servers[t.isOfficial][t.target].session.user_id?t.info.user_id_two:t.info.user_id_one)}/${t.nakama.servers[t.isOfficial][t.target].session.user_id}`,s=t.nakama.servers[t.isOfficial][t.target].info,m=yield t.global.upload_file_to_storage(o.file,{user_id:w,apache_port:s.apache_port,cdn_port:s.cdn_port},g,h,1==t.useFirstCustomCDN,o.actId,t.info.title);if(_=!!m,!_)throw"\ub9c1\ud06c \ub9cc\ub4e4\uae30 \uc2e4\ud328";delete r.partsize,r.url=m,t.noti.PushLocal({id:7,title:t.lang.text.ChatRoom.SendFile,body:o.file.filename,smallIcon_ln:"diychat"},t.noti.Current)}catch(h){console.log("cdn \uc5c5\ub85c\ub4dc \ucc98\ub9ac \uc2e4\ud328: ",h),t.noti.PushLocal({id:7,title:t.lang.text.Nakama.FailedUpload,body:`${o.file.filename}: ${(h.statusText?`${h.statusText}(${h.status})`:h.status)||h}`,smallIcon_ln:"diychat"},t.noti.Current)}d=!0;for(let h=0,g=r.content_related_creator.length;h<g;h++)delete r.content_related_creator[h].is_me,delete r.content_related_creator[h].timeDisplay,delete r.content_related_creator[h].various_display}r.local_comp=Math.random(),r.msg&&(r.lo=t.lang.lang);let b={content:JSON.parse(JSON.stringify(r))};if(t.nakama.content_to_hyperlink(b,t.isOfficial,t.target),t.info.local){let h=(new Date).getTime().toString();if(d&&!_)try{let s;if(1==t.useFirstCustomCDN&&(s=yield t.global.try_upload_to_user_custom_fs(o.file,`${t.info.id}_${t.nakama.users.self.display_name}`,o.actId,t.info.title)),!s)throw"\uc5c5\ub85c\ub4dc \uc2e4\ud328";delete b.content.path,delete b.content.partsize,b.content.url=s,t.noti.PushLocal({id:7,title:t.lang.text.ChatRoom.SendFile,body:o.file.filename,smallIcon_ln:"diychat"},t.noti.Current)}catch(s){let m=`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/files/msg_${h}.${o.file.file_ext}`;"local"!=t.isOfficial?(t.noti.PushLocal({id:7,title:t.lang.text.Nakama.FailedUpload,body:`${o.file.filename}: ${(s.statusText?`${s.statusText}(${s.status})`:s.status)||s}`,smallIcon_ln:"diychat"},t.noti.Current),t.p5loading.update({id:o.actId,message:`${t.lang.text.Nakama.FailedUpload}: ${o.file.filename}`,progress:0})):t.p5loading.update({id:o.actId,message:`${t.lang.text.ChatRoom.SavingFile}: ${o.file.filename}`,progress:null}),yield t.indexed.saveBlobToUserPath(o.file.blob,m),t.p5loading.remove(o.actId)}let g=(new Date).toISOString(),w={channel_id:t.info.id,code:0,color:"var(--offline-user-color)",color_bg:"var(--offline-user-bgcolor)",...b,create_time:g,update_time:g,sender_id:"local",message_id:h,user_display_name:t.nakama.users.self.display_name,is_me:!0};t.SendLocalMessage(w),t.p5loading.remove(o.actId);continue}t.sending_msg.push(b),t.NeedScrollDown()&&setTimeout(()=>{t.scroll_down_logs()},100);try{setTimeout(()=>{t.ResizeTextArea()},0);let h=yield t.nakama.servers[t.isOfficial][t.target].socket.writeChatMessage(t.info.id,r);d&&(_?t.auto_open_thumbnail({content:r,message_id:h.message_id,actId:o.actId}):t.indexed.saveBlobToUserPath(o.file.blob,`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/files/msg_${h.message_id}.${o.file.file_ext}`).then(()=>{t.auto_open_thumbnail({content:r,message_id:h.message_id,actId:o.actId})}))}catch(h){3===h.code?t.p5toast.show({text:t.lang.text.ChatRoom.FailedToJoinChannel}):(console.log("\uc624\ub958 \uac80\ud1a0 \ud544\uc694: ",h),t.p5toast.show({text:`${t.lang.text.ChatRoom.FailedToSend}: ${"string"==typeof h?h:h.message}`})),setTimeout(()=>{t.ResizeTextArea()},0),setTimeout(()=>{for(let g=t.sending_msg.length-1;g>=0;g--)t.sending_msg[g].content.local_comp==r.local_comp&&t.sending_msg.splice(g,1)},1500)}t.p5loading.remove(o.actId);const I={body:(r.filename?`(${t.lang.text.ChatRoom.attachments}) `:"")+r.msg,id:t.info.cnoti_id,image:r.url,icon:"diychat",data:{type:"chat",id:t.info.id,address:t.nakama.GetNodejsServerAddress(t.isOfficial,t.target,"nakama_port")}};let x=[];switch(t.info.redirect.type){case 2:{I.title=t.nakama.users.self.display_name,t.nakama.users[t.isOfficial][t.target][t.info.redirect.id].online||x.push(t.info.redirect.id);const h=t.nakama.GenerateQRCode(t.nakama.servers[t.isOfficial][t.target].info,"/");I.data.url=`${h}&open_prv_channel=${t.nakama.servers[t.isOfficial][t.target].session.user_id}`}break;case 3:{I.title=t.info.title;for(let g of t.info.info.users)!g.is_me&&!t.nakama.users[t.isOfficial][t.target][g.user.id].online&&x.push(g.user.id);const h=t.nakama.GenerateQRCode(t.nakama.servers[t.isOfficial][t.target].info,"/");I.data.url=`${h}&group=${t.info.title||t.info.info.name},${t.info.group_id||t.info.info.id}`.replace(/ /g,"%20")}}t.nakama.send_webpush(t.webpush_address,I,x)}t.isSendingQueue=!1}})()}autoSendWithLocalNoti(){this.p5loading.update({id:"7",message:this.lang.text.voidDraw.AutoSendMsg,progress:1,forceEnd:1e3,soundAlert:!0}),this.send()}send(t=!1){var i;if(t&&"MobilePWA"==N.aH)return;if(this.userInputTextArea.focus(),!(this.userInput.text.trim()||this.userInput.file||void 0!==this.IsMsgEditMode&&this.IsMsgEditMode.content.filename))return void setTimeout(()=>{this.userInput.text="",this.ResizeTextArea()},0);this.TargetMessageBackground&&(this.TargetMessageBackground.style.backgroundColor=null);let n="chatroom";var o;(this.userInput.file&&(n=this.FileActId),this.ModifyEditedMessage)&&(this.userInput.qoute||(this.userInput.qoute={text:this.global.truncateString(this.nakama.deserialize_text(this.ModifyEditedMessage),80),timestamp:this.ModifyEditedMessage.create_time,id:this.ModifyEditedMessage.message_id,url:this.ModifyEditedMessage.content.url,path:(null===(o=this.ModifyEditedMessage.content.path)||void 0===o||null===(o=o.split("/"))||void 0===o?void 0:o.pop())||this.ModifyEditedMessage.content.url,display_name:this.ModifyEditedMessage.user_display_name,user_id:this.ModifyEditedMessage.sender_id}),this.VideoEditedTimestamp&&(this.userInput.memo={timestamp:`${Date.now()}`,display_name:this.nakama.users.display_name,user_id:this.info.local?"local":this.nakama.servers[this.isOfficial][this.target].session.user_id,text:`${this.VideoEditedTimestamp}`},this.VideoEditedTimestamp=void 0),this.ModifyEditedMessage=void 0);this.SendQueue.push({...this.userInput,actId:n,IsMsgEditMode:this.IsMsgEditMode||(null===(i=this.userInput.memo)||void 0===i?void 0:i.orig_msg)}),setTimeout(()=>{this.userInput={file:void 0,qoute:void 0,memo:void 0,text:""},this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder,this.make_ext_hidden(),this.userInputTextArea.focus(),this.ResizeTextArea(),this.SendQueuedMessages()},0)}open_url_link(t,i){var n=this;return(0,p.A)(function*(){yield n.nakama.open_url_link(t,i),n.make_ext_hidden(),n.userInputTextArea.focus(),n.userInputTextArea.blur(),n.SetOtherAct()})()}SendLocalMessage(t){let i=this.nakama.deserialize_text(t);this.nakama.CatchQouteMsgUserName(t,this.isOfficial,this.target),this.nakama.ModulateTimeDate(t),this.nakama.content_to_hyperlink(t,this.isOfficial,this.target),this.nakama.channels_orig[this.isOfficial][this.target][t.channel_id].last_comment_time=t.update_time,this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].last_comment_id=t.message_id,this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].update&&this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].update(t),this.nakama.saveListedMessage([t],this.info,this.isOfficial,this.target),2!=t.code&&(this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].last_comment=(t.content.filename?`(${this.lang.text.ChatRoom.attachments}) `:"")+(i||t.content.noti||"")),setTimeout(()=>{this.NeedScrollDown()&&this.scroll_down_logs()},0)}LongTextMessageAsFile(t,i){var n=this;return(0,p.A)(function*(){let o=new Blob([t]);yield n.indexed.saveBlobToUserPath(o,`tmp_files/chatroom/${n.lang.text.ChatRoom.LongText}_${t.substring(0,10)}.txt`);let r={};r.blob=o,r.content_related_creator=[{user_id:n.info.local?"local":n.nakama.servers[n.isOfficial][n.target].session.user_id,timestamp:(new Date).getTime(),display_name:n.nakama.users.self.display_name,various:"long_text"}],r.content_creator={user_id:n.info.local?"local":n.nakama.servers[n.isOfficial][n.target].session.user_id,timestamp:(new Date).getTime(),display_name:n.nakama.users.self.display_name,various:"long_text"};let d=t.substring(0,24);return r.path=`tmp_files/chatroom/${n.lang.text.ChatRoom.LongText}_${d}~.txt`,r.file_ext="txt",r.filename=`[${n.lang.text.ChatRoom.LongText}] ${d}~.txt`,n.global.set_viewer_category_from_ext(r),r.type="text/plain",r.typeheader="text",n.CancelEditText(),n.p5loading.toast(n.lang.text.ChatRoom.CreateAsTextFile,i),r})()}SetOtherAct(){this.isOtherAct=!0,setTimeout(()=>{this.isOtherAct=!1},0)}message_detail(t,i){var n=this;return(0,p.A)(function*(){if(3==t.code||n.isOtherAct||t.content.gupdate||!t.is_me)return;let o={};try{const g=n.nakama.servers[n.isOfficial][n.target].info;o.cdn_port=g.cdn_port,o.apache_port=g.apache_port,o.user_id=n.nakama.servers[n.isOfficial][n.target].session.user_id}catch{o={}}const r=n.nakama.deserialize_text(t);let d=r,_=t.content.url;if(t.content.viewer){try{const g=yield n.indexed.loadBlobFromUserPath(`${t.content.path}_thumbnail.png`,t.content.type);_=URL.createObjectURL(g)}catch{try{const w=yield n.indexed.loadBlobFromUserPath(t.content.path,t.content.type);_=URL.createObjectURL(w)}catch{}}d=`(${n.lang.text.ChatRoom.attachments}) ${d}`}const b=n.global.HTMLEncode(d),k=_?`<div style="text-align: center;">${b}</div>`:`<div>${b}</div>`;let h={header:n.lang.text.ChatRoom.ManageChat,message:new Z.Vk(_?`<div style="width: 100%;"><img src="${_}" alt="${t.content.filename}" style="border-radius: 8px; max-height: 230px; position: relative; left: 50%; transform: translateX(-50%); ${n.info.HideAutoThumbnail?"filter: blur(6px);":""}"/></div>`+k:k),buttons:[{text:n.lang.text.ChatRoom.EditChat,handler:()=>{!function(){var w=(0,p.A)(function*(){n.TargetMessageObject&&(n.TargetMessageObject.style.paddingRight=null,n.TargetMessageObject.style.marginRight=null,n.TargetMessageObject.style.marginLeft=null,n.TargetMessageObject=null),n.TargetMessageBackground&&(n.TargetMessageBackground.style.backgroundColor=null,n.TargetMessageBackground=null),n.userInput.qoute=void 0,n.userInput.memo=void 0;let s=JSON.parse(JSON.stringify(t));s.msg_string=d,n.IsMsgEditMode=s;try{let m=yield n.indexed.loadBlobFromUserPath(s.content.path,s.content.type);const u=URL.createObjectURL(m);s.thumbnail=u}catch{}n.userInput.text=r,setTimeout(()=>{n.ResizeTextArea(),n.userInputTextArea.style.height=n.userInputTextArea.scrollHeight+"px"},0),n.make_ext_hidden(),n.userInputTextArea.focus()});return function(){return w.apply(this,arguments)}}()()}},{text:n.lang.text.UserFsDir.Delete,cssClass:"redfont",handler:()=>{!function(){var w=(0,p.A)(function*(){n.CancelEditText();const s=`remove_chat_msg_file_${n.info.id}`;if(n.info.local){if(_){let m=`servers/${n.isOfficial}/${n.target}/channels/${n.info.id}/files/msg_${t.message_id}.${t.content.file_ext}`;t.content.url&&""!==t.content.type&&n.global.remove_file_from_storage(t.content.url,o);let u=yield n.indexed.GetFileListFromDB(m);for(let f of u)yield n.indexed.removeFileFromUserPath(f)}}else try{if(yield n.nakama.servers[n.isOfficial][n.target].socket.removeChatMessage(n.info.id,t.message_id),_){n.p5loading.update({id:s,message:n.lang.text.UserFsDir.DeleteFile});let m=`servers/${n.isOfficial}/${n.target}/channels/${n.info.id}/files/msg_${t.message_id}.${t.content.file_ext}`;if(t.content.url)(t.content.url.indexOf(t.group_id)>=0||t.content.url.indexOf(t.user_id_one)>=0||t.content.url.indexOf(t.user_id_two)>=0)&&""!==t.content.type&&n.global.remove_file_from_storage(t.content.url,o);else for(let f=0;f<t.content.partsize;f++){try{yield n.nakama.servers[n.isOfficial][n.target].client.deleteStorageObjects(n.nakama.servers[n.isOfficial][n.target].session,{object_ids:[{collection:`file_${t.channel_id.replace(/[.]/g,"_")}`,key:`msg_${t.message_id}_${f}`}]})}catch{}n.p5loading.update({id:s,message:`${n.lang.text.UserFsDir.DeleteFile}: ${t.content.filename} (${t.content.partsize-f})`,progress:f/t.content.partsize})}let u=yield n.indexed.GetFileListFromDB(m);for(let f of u)yield n.indexed.removeFileFromUserPath(f)}}catch(m){console.error("\ucc44\ub110 \uba54\uc2dc\uc9c0 \uc0ad\uc81c \uc624\ub958: ",m)}n.ViewableMessage.splice(i,1);for(let m=0,u=n.messages.length;m<u;m++)if(n.messages[m].message_id==t.message_id){n.messages.splice(m,1);break}t.update_time=Date.now(),t.code=2,n.SendLocalMessage(t);for(let m=n.ViewableMessage.length-1;m>=0;m--)n.modulate_chatmsg(m,n.ViewableMessage.length);n.p5loading.update({id:s,message:`${n.lang.text.ChatRoom.MsgRemoved}: ${n.global.HTMLEncode(d)}`,forceEnd:1e3})});return function(){return w.apply(this,arguments)}}()()}}]};("offline"==n.info.info.status||"missing"==n.info.info.status)&&delete h.buttons,n.alertCtrl.create(h).then(g=>{n.ChatManageMenu=g,n.global.StoreShortCutAct("chatroom-alert"),g.onDidDismiss().then(()=>{n.global.RestoreShortCutAct("chatroom-alert"),URL.revokeObjectURL(_),n.isOtherAct=!1}),g.present()})})()}CancelEditText(){try{const t=this.IsMsgEditMode.thumbnail;this.IsMsgEditMode=void 0,setTimeout(()=>{URL.revokeObjectURL(t)},100)}catch{}}file_detail(t){var i=this;return(0,p.A)(function*(){if(i.isOtherAct=!0,t.content.url)return i.open_viewer(t,t.content.url),void setTimeout(()=>{i.isOtherAct=!1},0);let n=`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${t.message_id}.${t.content.file_ext}`;try{if(!(yield i.indexed.checkIfFileExist(`${n}.history`)))throw"\uc378\ub124\uc77c \uc5f4\uae30";t.content.text=[i.lang.text.TodoDetail.WIP];let r=yield i.indexed.loadTextFromUserPath(`${n}.history`),d=JSON.parse(r);switch(delete t.content.text,d.type){case"upload":if(t.content.text=[i.lang.text.ChatRoom.uploading],i.nakama.WriteStorage_From_channel(t,n,i.isOfficial,i.target,d.index),t.content.transfer_index&&i.nakama.OnTransfer[i.isOfficial][i.target][t.channel_id][t.message_id].OnTransfer)throw"\uc804\uc1a1\uc791\uc5c5 \uc911, \uc378\ub124\uc77c \uc5f4\uae30";break;case"download":t.content.text=[i.lang.text.TodoDetail.WIP],yield i.nakama.ReadStorage_From_channel(t,n,i.isOfficial,i.target,d.index),i.NeedScrollDown()&&setTimeout(()=>{i.scroll_down_logs()},100)}}catch{(yield i.indexed.checkIfFileExist(n))?(t.content.text||(t.content.text=[i.lang.text.ChatRoom.downloaded]),i.indexed.loadBlobFromUserPath(n,t.content.type).then(d=>{t.content.path=n;let _=URL.createObjectURL(d);t.content.thumbnail||i.global.modulate_thumbnail(t.content,_,i.cont),i.NeedScrollDown()&&setTimeout(()=>{i.scroll_down_logs()},100)}),i.open_viewer(t,n)):i.isHistoryLoaded?i.p5toast.show({text:i.lang.text.ChatRoom.cannot_open_file}):(t.content.text=[i.lang.text.TodoDetail.WIP],yield i.nakama.ReadStorage_From_channel(t,n,i.isOfficial,i.target),i.NeedScrollDown()&&setTimeout(()=>{i.scroll_down_logs()},400))}i.isOtherAct=!1})()}modulate_chatmsg(t,i){var n=this;return(0,p.A)(function*(){if(0!=i){n.ViewableMessage[t].showInfo||(n.ViewableMessage[t].showInfo={}),n.ViewableMessage[t].showInfo.date=!!n.ViewableMessage[t].msgDate,n.ViewableMessage[t].showInfo.sender=!n.ViewableMessage[t].content.noti,t-1>=0&&(n.ViewableMessage[t].showInfo.date=!!n.ViewableMessage[t].msgDate&&n.ViewableMessage[t].msgDate!=n.ViewableMessage[t-1].msgDate,n.ViewableMessage[t].showInfo.sender=!n.ViewableMessage[t].content.noti&&(n.ViewableMessage[t-1].isLastRead||n.ViewableMessage[t].sender_id!=n.ViewableMessage[t-1].sender_id||n.ViewableMessage[t-1].content.noti||n.ViewableMessage[t].msgDate!=n.ViewableMessage[t-1].msgDate||n.ViewableMessage[t].msgTime!=n.ViewableMessage[t-1].msgTime));try{t+1<i&&(n.ViewableMessage[t+1].showInfo.date=!!n.ViewableMessage[t].msgDate&&n.ViewableMessage[t].msgDate!=n.ViewableMessage[t+1].msgDate,n.ViewableMessage[t+1].showInfo.sender=!n.ViewableMessage[t+1].content.noti&&(n.ViewableMessage[t].isLastRead||n.ViewableMessage[t].sender_id!=n.ViewableMessage[t+1].sender_id||n.ViewableMessage[t].content.noti||n.ViewableMessage[t].msgDate!=n.ViewableMessage[t+1].msgDate||n.ViewableMessage[t].msgTime!=n.ViewableMessage[t+1].msgTime))}catch{}}})()}ModulateFileEmbedMessage(t){var i=this;t.content.url&&!this.OnFinding&&!this.info.HideAutoThumbnail&&this.global.modulate_thumbnail(t.content,"",this.cont);let n=`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${t.message_id}.${t.content.file_ext}`;t.content.path=n;try{t.content.transfer_index=this.nakama.OnTransfer[this.isOfficial][this.target][t.channel_id][t.message_id]}catch{}t.content.transfer_index||this.indexed.checkIfFileExist(`${n}.history`).then(o=>{o&&this.indexed.loadTextFromUserPath(`${n}.history`,(r,d)=>{if(r&&d){let _=JSON.parse(d);delete t.content.text,this.nakama.OnTransfer[this.isOfficial][this.target][t.channel_id]||(this.nakama.OnTransfer[this.isOfficial][this.target][t.channel_id]={}),this.nakama.OnTransfer[this.isOfficial][this.target][t.channel_id][t.message_id]||(this.nakama.OnTransfer[this.isOfficial][this.target][t.channel_id][t.message_id]={index:t.content.partsize-_.index}),t.content.transfer_index=this.nakama.OnTransfer[this.isOfficial][this.target][t.channel_id][t.message_id]}})}),this.global.set_viewer_category(t.content),this.indexed.checkIfFileExist(n).then(function(){var o=(0,p.A)(function*(r){if(r)t.content.text=[i.lang.text.ChatRoom.downloaded],i.indexed.loadBlobFromUserPath(n,t.content.type).then(d=>{t.content.path=n;let _=URL.createObjectURL(d);i.global.modulate_thumbnail(t.content,_,i.cont),i.NeedScrollDown()&&setTimeout(()=>{i.scroll_down_logs()},100)});else try{let d=yield i.indexed.loadBlobFromUserPath(`${t.content.path}_thumbnail.png`,"image/png");const _=URL.createObjectURL(d);i.global.modulate_thumbnail(t.content,_,i.cont)}catch{}});return function(r){return o.apply(this,arguments)}}())}toggle_thumbnail(){var t=this;return(0,p.A)(function*(){t.info.HideAutoThumbnail=!t.info.HideAutoThumbnail,t.nakama.save_channels_with_less_info()})()}open_viewer(t,i){var n=this;let o=[];for(let r=0,d=this.messages.length;r<d;r++)2!=this.messages[r].code&&this.messages[r].content.filename&&o.push(JSON.parse(JSON.stringify(this.messages[r])));this.lock_modal_open||(this.lock_modal_open=!0,this.global.PageDismissAct["chatroom-ionicviewer"]=function(){var r=(0,p.A)(function*(d){if(n.lock_modal_open=!1,d.data)switch(d.data.type){case"gif-export":{var _,b;let I=new File([d.data.blob],d.data.name);n.ModifyEditedMessage=null===(_=d.data)||void 0===_?void 0:_.message,n.VideoEditedTimestamp=null===(b=d.data)||void 0===b?void 0:b.timestamp;let x=[];d.data.msg.content.content_related_creator&&(x=[...d.data.msg.content.content_related_creator]),n.selected_blobFile_callback_act(I,x),n.CreateCurrentThumbnails()}break;case"image":let k=[];if(d.data.msg.content.content_related_creator&&(k=[...d.data.msg.content.content_related_creator]),d.data.msg.content.content_creator){let I=!1;for(let x=0,h=k.length;x<h;x++)if(k[x].user_id==d.data.msg.content.content_creator.user_id){I=!0;break}I||k.push(d.data.msg.content.content_creator)}return n.global.PageDismissAct["modify-image"]=function(){var I=(0,p.A)(function*(x){var h,g,w;x.data&&(yield n.voidDraw_fileAct_callback(x,k)),null!==(h=x.data)&&void 0!==h&&h.fromChat&&n.autoSendWithLocalNoti(),n.ModifyEditedMessage=null===(g=x.data)||void 0===g?void 0:g.message,n.VideoEditedTimestamp=null===(w=x.data)||void 0===w?void 0:w.timestamp,n.CreateCurrentThumbnails(),delete n.global.PageDismissAct["modify-image"]});return function(x){return I.apply(this,arguments)}}(),yield n.WaitingCurrent(),n.global.ActLikeModal("portal/subscribes/chat-room/void-draw",{path:d.data.path||i,width:d.data.width,height:d.data.height,type:d.data.filetype,isDarkMode:d.data.isDarkMode,scrollHeight:d.data.scrollHeight,fromChat:!0,message:t,timestamp:d.data.timestamp,dismiss:"modify-image"}),n.CreateCurrentThumbnails(),void delete n.global.PageDismissAct["chatroom-ionicviewer"];case"text":n.selected_blobFile_callback_act(d.data.blob,d.data.contentRelated,"textedit"),n.CreateCurrentThumbnails();break;case"find":n.FindQoute(d.data.messageId,d.data.timestamp)}else n.CreateCurrentThumbnails();n.noti.Current=n.info.cnoti_id,delete n.global.PageDismissAct["chatroom-ionicviewer"]});return function(d){return r.apply(this,arguments)}}(),this.noti.Current="IonicViewerPage",this.global.ActLikeModal("portal/subscribes/chat-room/ionic-viewer",{info:t,path:i,alt_path:i,isOfficial:this.isOfficial,target:this.target,channel_id:this.info.id,relevance:o,local:this.info.local,dismiss:"chatroom-ionicviewer",message:t}))}voidDraw_fileAct_callback(t,i){var n=this;return(0,p.A)(function*(){n.userInput.file=yield n.global.voidDraw_fileAct_callback(t,"tmp_files/chatroom/",{user_id:n.info.local?"local":n.nakama.servers[n.isOfficial][n.target].session.user_id,display_name:n.nakama.users.self.display_name},i),n.CancelEditText(),n.inputPlaceholder=`(${n.lang.text.ChatRoom.attachments}: ${n.userInput.file.filename})`,n.p5loading.remove(t.data.loadingCtrl)})()}user_detail(t){if(!this.lock_modal_open)if(this.isOtherAct=!0,this.lock_modal_open=!0,t.is_me)this.nakama.open_profile_page({isOfficial:this.info.server.isOfficial,target:this.info.server.target}),this.noti.Current="GroupServerPage",this.lock_modal_open=!1;else{let i=this.nakama.load_other_user(t.sender_id,this.isOfficial,this.target),n=JSON.parse(JSON.stringify(this.info));delete n.update,this.nakama.open_others_profile({info:{user:i},group:n,has_admin:!1}),this.lock_modal_open=!1,this.noti.Current="OthersProfilePage"}}ionViewWillLeave(){this.p5loading.update({id:"chatroom",forceEnd:0},!0),this.p5loading.update({id:this.FileActId,forceEnd:0},!0),this.WillLeave=!0,this.noti.Current="",this.removeShortCutKey(),this.global.RestoreShortCutAct("chat-room"),delete this.global.windowOnFocusAct.chatroom,this.userInputTextArea.onpaste=null,this.userInputTextArea.onblur=null,this.userInputTextArea.onfocus=null}removeShortCutKey(){delete this.global.p5KeyShortCut.BottomTab,delete this.global.p5KeyShortCut.Backquote,delete this.global.p5KeyShortCut.Digit,delete this.global.p5KeyShortCut.EnterAct,delete this.global.p5KeyShortCut.Backspace}ngOnDestroy(){var t,i;null===(t=this.ChatManageMenu)||void 0===t||t.dismiss(),this.p5loading.update({id:"FindQoute",forceEnd:0},!0),this.useVoiceRecording&&this.StopAndSaveVoiceRecording(),this.global.NeedBackgroundMode&&(this.global.ArcadeWithFullScreen=!1),this.global.portalHint=!0,this.route.queryParams.unsubscribe();try{delete this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].update}catch{}this.nakama.rearrange_channels(),this.ChatLogs.onscroll=null,this.cont.abort("\ucc44\ub110 \ucc44\ud305 \ubc97\uc5b4\ub0a8"),this.cont=null,delete this.global.WindowOnBlurAct.chatroom,delete this.nakama.opened_page_info.channel,this.nakama.ChatroomLinkAct=null,delete this.info.is_new,null===(i=this.p5canvas)||void 0===i||i.remove(),this.nakama.OnTransferMessage={},delete this.nakama.StatusBarChangedCallback}ConnectToCurrentServer(){var t;if(!this.info.local)if(this.p5loading.toast(`${this.lang.text.Nakama.PendingLogin}: ${null===(t=this.nakama.servers[this.isOfficial])||void 0===t||null===(t=t[this.target])||void 0===t||null===(t=t.info)||void 0===t?void 0:t.name}`,"nakama_login"),"offline"==this.statusBar.groupServer[this.isOfficial][this.target])this.nakama.link_group(this.isOfficial,this.target).then(()=>{this.nakama.go_to_chatroom(this.nakama.channels_orig[this.isOfficial][this.target][this.info.id])});else try{this.nakama.servers[this.isOfficial][this.target].socket.disconnect(!0)}catch{this.nakama.OnSocketDisconnect(this.isOfficial,this.target)}}}return(l=c).\u0275fac=function(t){return new(t||l)(e.rXU(se.q9),e.rXU(U.nX),e.rXU(U.Ix),e.rXU(ee.X),e.rXU(le.r),e.rXU(re.j),e.rXU(ce.n),e.rXU(de.y),e.rXU(_e.up),e.rXU(te.z3),e.rXU(he.G),e.rXU(A.hG),e.rXU(ue.u),e.rXU(ge.f))},l.\u0275cmp=e.VBU({type:l,selectors:[["app-chat-room"]],decls:56,vars:28,consts:[[1,"ion-no-border"],["slot","start"],["defaultHref","portal/subscribes"],["slot","start","name","file-tray-full-outline","class","top_icon title_override",4,"ngIf"],["slot","start","name","flame-outline","class","top_icon title_override",4,"ngIf"],["slot","end","name","notifications-circle-outline",1,"top_icon",2,"margin-right","24px",3,"click"],["class","top_icon","style","margin-right: 68px;","slot","end","name","eye-outline",3,"click",4,"ngIf"],["class","top_icon","style","margin-right: 68px;","slot","end","name","eye-off-outline",3,"click",4,"ngIf"],[1,"header_online_circle",3,"click"],["scrollY","false"],["id","p5Drop_chatroom",2,"position","absolute","width","100%","height","100%","display","flex","pointer-events","none","z-index","500"],["id","main_table",2,"width","100%","height","100%","background-color","var(--chatroom-background)","background-position","center","background-repeat","no-repeat","background-size","cover"],[2,"height","100%"],[2,"vertical-align","top"],["id","chatroom_div",2,"max-width","100vw","width","100%","height","100%","padding","8px","overflow-x","hidden","overflow-y","auto","scroll-behavior","smooth"],["id","chatroom_content_div"],[2,"position","relative"],["class","shortcut_hint",4,"ngIf"],["button","",3,"click","disabled"],["class","msg_parent",3,"id","contextmenu","mousedown","touchstart",4,"ngFor","ngForOf"],["class","my_message_right href_thumbnail_self my_sending_msg",4,"ngFor","ngForOf"],[1,"thumbnails","borderRadiusBig","imageForm","cursor_pointer","backdrop_filter"],["class","cursor_pointer qoute_text",3,"click",4,"ngIf"],["class","thumbnail_parts cursor_pointer",4,"ngIf"],["class","thumbnail_parts",3,"click","contextmenu",4,"ngIf"],[2,"width","100%","background-color","var(--chatroom-input-background)"],["fill","clear","mode","md",1,"ion-text-center",3,"click"],["class","shortcut_hint shortcut_hint_menu",4,"ngIf"],["name","add"],[2,"width","100%","vertical-align","bottom","position","relative"],["class","shortcut_hint shortcut_hint_menu","style","z-index: 32;",4,"ngIf"],[1,"TextAreaInput","imageForm",2,"overflow","auto",3,"ngModelChange","keyup","keydown","focus","blur","paste","click","id","ngModel","placeholder"],["fill","clear","mode","md","expand","block",3,"click","disabled"],["name","send"],["id","ext_menu",3,"hidden"],[2,"height","240px","overflow-x","hidden","overflow-y","auto","scroll-behavior","smooth","text-align","center","background-color","var(--chatroom-background)","padding-bottom","24px"],["hidden","","type","file","id","local_channel","accept","image/*",3,"change"],["hidden","","type","file","id","backgroundImage_sel","accept","image/png",3,"change"],["hidden","","type","file","accept","*","multiple","",3,"change","id"],["style","display: inline-block;",4,"ngFor","ngForOf"],["slot","start","name","file-tray-full-outline",1,"top_icon","title_override"],["slot","start","name","flame-outline",1,"top_icon","title_override"],["slot","end","name","eye-outline",1,"top_icon",2,"margin-right","68px",3,"click"],["slot","end","name","eye-off-outline",1,"top_icon",2,"margin-right","68px",3,"click"],[1,"shortcut_hint"],[1,"msg_parent",3,"contextmenu","mousedown","touchstart","id"],[1,"msg_bg_form"],[1,"msg_bg_col","borderRadiusBig",3,"id"],["class","message_form",4,"ngIf"],["class","my_message_right",4,"ngIf"],["class","notice_form",3,"click",4,"ngIf"],[1,"message_form"],["class","dateLine",3,"click",4,"ngIf"],[1,"avatar_form"],["class","avatar_image cursor_pointer",3,"click",4,"ngIf"],[4,"ngIf"],["class","cursor_pointer qoute_text qoute_background borderRadiusBig imageForm",3,"click",4,"ngIf"],["class","file_message_form",4,"ngIf"],["class","message_content_form",4,"ngIf"],["class","file_message_form href_thumbnail",4,"ngIf"],[2,"width","100%","text-align","-webkit-center"],["class","read_last_here borderRadiusBig",4,"ngIf"],[1,"dateLine",3,"click"],[1,"dateText","borderRadiusBig"],[1,"avatar_image","cursor_pointer",3,"click"],["alt","img",1,"avatar_image","cursor_pointer",3,"src"],[1,"sender_form","borderRadiusBig"],[1,"cursor_pointer",3,"click"],[1,"time_form","message_span_form",3,"click"],[1,"cursor_pointer","qoute_text","qoute_background","borderRadiusBig","imageForm",3,"click"],[1,"qouteDiv","qouteOnChatBalloon"],["class","imageForm borderRadiusDefault qouteImageHeight",4,"ngIf"],["class","qouteDiv qouteOnChatBalloon qouteBalloonBottom",4,"ngIf"],[1,"imageForm","borderRadiusDefault","qouteImageHeight"],["alt","",1,"qouteImage","qouteImageHeight",3,"src"],[1,"qouteDiv","qouteOnChatBalloon","qouteBalloonBottom"],[1,"file_message_form"],["class","cursor_pointer file_button imageForm borderRadiusDefault",3,"style","click",4,"ngIf"],["class","file_name_form imageForm borderRadiusDefault",3,"click",4,"ngIf"],["style","align-self: flex-end; margin-left: 4px;",4,"ngIf"],[1,"cursor_pointer","file_button","imageForm","borderRadiusDefault",3,"click"],[1,"file_info"],["class","text_seperator",4,"ngIf"],["class","file_info file_text_thumbnail",4,"ngFor","ngForOf"],[1,"text_seperator"],[1,"file_info","file_text_thumbnail"],[1,"file_name_form","imageForm","borderRadiusDefault",3,"click"],[1,"file_thumbnail","imageForm","cursor_pointer",3,"src","alt"],[2,"align-self","flex-end","margin-left","4px"],[1,"message_content_form"],[1,"msg_balloon","borderRadiusBig","qouteOnChatBalloon"],["class","msg_inside_balloon",4,"ngFor","ngForOf"],["class","edited_form",4,"ngIf"],[1,"msg_inside_balloon"],[4,"ngFor","ngForOf"],["class","text_span",3,"style","click",4,"ngIf"],["target","_system","onclick","return false;",3,"href","click",4,"ngIf"],[1,"text_span",3,"click"],["target","_system","onclick","return false;",3,"click","href"],[1,"edited_form"],[1,"file_message_form","href_thumbnail"],[1,"quickShare_form","borderRadiusBig","qouteDiv","cursor_pointer","qouteOnChatBalloon",3,"click"],["class","qouteImage qouteImageHeight href_image_margin",3,"src","style","alt",4,"ngIf"],[1,"qouteImage","qouteImageHeight","href_image_margin",3,"src","alt"],[1,"read_last_here","borderRadiusBig"],[1,"my_message_right"],[2,"display","inline-flex"],["class","my_file_message_form",4,"ngIf"],["hidden","","type","file","accept","image/*",3,"change","id"],["class","message_content_form my_file_message_form",4,"ngIf"],[1,"avatar_form","my_avatar_form"],["class","my_file_message_form href_thumbnail_self",4,"ngIf"],["class","read_last_here borderRadiusBig",3,"click",4,"ngIf"],[1,"my_file_message_form"],[1,"time_form","message_span_form_me",3,"click"],[1,"message_content_form","my_file_message_form"],["alt","my_img",1,"avatar_image","cursor_pointer",3,"src"],[1,"my_file_message_form","href_thumbnail_self"],[1,"read_last_here","borderRadiusBig",3,"click"],[1,"notice_form",3,"click"],[1,"notice","borderRadiusDefault"],[1,"my_message_right","href_thumbnail_self","my_sending_msg"],["class","cursor_pointer file_button imageForm borderRadiusDefault",3,"style",4,"ngIf"],["class","file_name_form imageForm borderRadiusDefault",4,"ngIf"],[1,"cursor_pointer","file_button","imageForm","borderRadiusDefault"],[1,"file_name_form","imageForm","borderRadiusDefault"],["class","comp_local_content",3,"style","click",4,"ngIf"],["class","comp_local_content","onclick","return false;","target","_system",3,"href","click",4,"ngIf"],[1,"comp_local_content",3,"click"],["onclick","return false;","target","_system",1,"comp_local_content",3,"click","href"],[1,"cursor_pointer","qoute_text",3,"click"],[1,"qouteDiv"],["class","qouteDiv",4,"ngIf"],["class","imageForm borderRadiusDefault qouteImageHeight","style","max-height: 84px;",4,"ngIf"],[1,"imageForm","borderRadiusDefault","qouteImageHeight",2,"max-height","84px"],[1,"thumbnail_parts","cursor_pointer"],[3,"click"],[2,"text-align","center","margin","4px","max-width","95vw"],["style","display: grid;","class","thumbnail_parts",4,"ngIf"],["id","ChatroomSelectedImage","class","image_thumbnail",3,"src","alt",4,"ngIf"],["id","ChatroomSelectedImage",1,"image_thumbnail",3,"src","alt"],[1,"thumbnail_parts",2,"display","grid"],[1,"thumbnail_parts",3,"click","contextmenu"],[2,"text-align","center","padding","4px 0px","position","relative"],["class","shortcut_hint","style","border-radius: 4px;",4,"ngIf"],[1,"shortcut_hint",2,"border-radius","4px"],[1,"bottom_thumbnail","imageForm"],["class","text_span",3,"click",4,"ngIf"],[1,"shortcut_hint","shortcut_hint_menu"],[1,"shortcut_hint","shortcut_hint_menu",2,"z-index","32"],[2,"display","inline-block"],[1,"ext_button",3,"click","contextmenu","hidden"],["class","shortcut_hint shortcut_hint_ext_menu",4,"ngIf"],["slot","icon-only","style","width: 36px; height: 36px;",3,"name",4,"ngIf"],["class","ext_icon_img",3,"src","alt",4,"ngIf"],[1,"shortcut_hint","shortcut_hint_ext_menu"],["slot","icon-only",2,"width","36px","height","36px",3,"name"],[1,"ext_icon_img",3,"src","alt"]],template:function(t,i){1&t&&(e.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),e.EFF(3),e.k0s(),e.j41(4,"ion-buttons",1),e.nrm(5,"ion-back-button",2),e.k0s(),e.DNE(6,pe,1,0,"ion-icon",3)(7,ve,1,0,"ion-icon",4),e.j41(8,"ion-icon",5),e.bIt("click",function(){return i.nakama.CreateChannelFalseAlarm(i.isOfficial,i.target,i.info,i.messages[i.messages.length-1],!0)}),e.k0s(),e.DNE(9,be,1,0,"ion-icon",6)(10,xe,1,0,"ion-icon",7),e.j41(11,"div",8),e.bIt("click",function(){return i.ConnectToCurrentServer()}),e.k0s()()(),e.j41(12,"ion-content",9),e.nrm(13,"div",10),e.j41(14,"table",11)(15,"tr",12)(16,"td",13)(17,"div",14)(18,"div",15)(19,"div",16),e.DNE(20,ke,2,0,"div",17),e.j41(21,"ion-item",18),e.bIt("click",function(){return i.pull_msg_history()}),e.j41(22,"ion-label"),e.EFF(23),e.k0s()()(),e.DNE(24,pt,6,10,"div",19)(25,Ft,4,3,"div",20),e.k0s()(),e.j41(26,"table",21),e.DNE(27,Pt,5,3,"tr",22)(28,Lt,5,3,"tr",22)(29,Gt,4,2,"tr",22)(30,Ht,7,3,"tr",23)(31,Yt,4,2,"tr",24)(32,Jt,6,4,"tr",24),e.k0s()()(),e.j41(33,"tr")(34,"td")(35,"div")(36,"table",25)(37,"tr")(38,"td")(39,"ion-button",26),e.bIt("click",function(){return i.open_ext_with_delay()}),e.DNE(40,Kt,2,0,"div",27),e.nrm(41,"ion-icon",28),e.k0s()(),e.j41(42,"td",29),e.DNE(43,Zt,2,0,"div",30)(44,ei,2,0,"div",30),e.j41(45,"textarea",31),e.mxI("ngModelChange",function(o){return e.DH7(i.userInput.text,o)||(i.userInput.text=o),o}),e.bIt("keyup",function(o){return i.check_key(o)})("keydown",function(o){return i.check_key(o)})("focus",function(){return i.textAreaOnFocusAct()})("blur",function(){return i.textAreaOnBlurAct()})("paste",function(o){return i.textAreaOnPasteAct(o)})("click",function(){return i.make_ext_hidden()}),e.k0s()(),e.j41(46,"td")(47,"ion-button",32),e.bIt("click",function(){return i.send()}),e.nrm(48,"ion-icon",33),e.k0s()()()()()()(),e.j41(49,"tr",34)(50,"td")(51,"div",35)(52,"input",36),e.bIt("change",function(o){return i.LocalChannelImageChanged(o)}),e.k0s(),e.j41(53,"input",37),e.bIt("change",function(o){return i.ChangeBackgroundImage(o)}),e.k0s(),e.j41(54,"input",38),e.bIt("change",function(o){return i.inputFileSelected(o)}),e.k0s(),e.DNE(55,ai,7,7,"div",39),e.k0s()()()()()),2&t&&(e.R7$(3),e.SpI(" ",i.info.info?i.info.info.name||i.nakama.usernameOverride[i.info.info.isOfficial][i.info.info.target][i.info.info.id]||i.info.info.display_name||i.lang.text.ChatRoom.noname_chatroom:i.info.title||i.lang.text.ChatRoom.noname_chatroom,""),e.R7$(3),e.Y8G("ngIf",i.info.local&&!i.info.volatile),e.R7$(),e.Y8G("ngIf",i.info.volatile),e.R7$(2),e.Y8G("ngIf",!i.info.HideAutoThumbnail),e.R7$(),e.Y8G("ngIf",i.info.HideAutoThumbnail),e.R7$(),e.Aen("background-color: "+i.statusBar.colors[i.info.status||"offline"]),e.R7$(9),e.Y8G("ngIf",i.global.ShowHint&&!i.CheckIfFocusOnInput),e.R7$(),e.Y8G("disabled",!i.pullable||i.OnFinding),e.R7$(2),e.JRh(i.lang.text.ChatRoom.fetch_previous_chat),e.R7$(),e.Y8G("ngForOf",i.ViewableMessage),e.R7$(),e.Y8G("ngForOf",i.sending_msg),e.R7$(2),e.Y8G("ngIf",i.userInput.qoute),e.R7$(),e.Y8G("ngIf",i.userInput.memo),e.R7$(),e.Y8G("ngIf",i.IsMsgEditMode),e.R7$(),e.Y8G("ngIf",i.userInput.file),e.R7$(),e.Y8G("ngIf",i.ShowGoToBottom&&!i.last_message_viewer.user_id),e.R7$(),e.Y8G("ngIf",i.last_message_viewer.user_id),e.R7$(8),e.Y8G("ngIf",i.global.ShowHint&&!i.CheckIfFocusOnInput),e.R7$(3),e.Y8G("ngIf",i.global.ShowHint&&!i.CheckIfFocusOnInput),e.R7$(),e.Y8G("ngIf",i.global.ShowHint&&i.CheckIfFocusOnInput),e.R7$(),e.Y8G("id",i.ChannelUserInputId),e.R50("ngModel",i.userInput.text),e.Y8G("placeholder",i.inputPlaceholder),e.R7$(2),e.Y8G("disabled",!i.info.status||"missing"==i.info.status||"offline"==i.info.status),e.R7$(2),e.Y8G("hidden",i.isHidden),e.R7$(5),e.Y8G("id",i.file_sel_id),e.R7$(),e.Y8G("ngForOf",i.extended_buttons))},dependencies:[X.Sq,X.bT,D.me,D.BC,D.vS,A.Jm,A.QW,A.W9,A.eU,A.iq,A.uz,A.he,A.BC,A.ai,A.el],styles:[".title_override[_ngcontent-%COMP%]{cursor:initial;padding-right:initial;margin-right:-8px}.message_form[_ngcontent-%COMP%]{padding-bottom:4px}.sender_form[_ngcontent-%COMP%]{background-color:var(--chatroom-background-transparent);padding:0 8px;width:-moz-fit-content;width:fit-content}.message_span_form[_ngcontent-%COMP%]{margin-left:8px}.message_span_form_me[_ngcontent-%COMP%]{margin-right:4px}.my_message_right[_ngcontent-%COMP%]{text-align:end}.my_sending_msg[_ngcontent-%COMP%]{margin-bottom:0}.dateLine[_ngcontent-%COMP%]{text-align:center;font-size:16px;padding-top:8px}.dateText[_ngcontent-%COMP%]{background-color:var(--chatroom-background-transparent);color:var(--default-text-color-direction);padding:0 16px}.msg_balloon[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;border:16px;padding:5px 12px 8px}.msg_inside_balloon[_ngcontent-%COMP%]{text-align:start;min-height:16px}.time_form[_ngcontent-%COMP%]{font-size:12px;color:var(--chatroom-time-text)}.file_message_form[_ngcontent-%COMP%]{display:flex;flex-direction:column}.my_file_message_form[_ngcontent-%COMP%]{text-align:right;text-align:-webkit-right}.href_thumbnail[_ngcontent-%COMP%]{padding-left:56px;padding-bottom:4px}.href_thumbnail_self[_ngcontent-%COMP%]{padding-right:56px;padding-bottom:8px}.cursor_pointer[_ngcontent-%COMP%]{cursor:pointer}.file_name_form[_ngcontent-%COMP%]{margin-top:4px;width:-moz-fit-content;width:fit-content;height:-moz-fit-content;height:fit-content}.file_thumbnail[_ngcontent-%COMP%]{max-width:192px;max-height:192px;width:auto;height:auto;display:block}.file_info[_ngcontent-%COMP%]{margin:0 4px;text-align:start}.file_text_thumbnail[_ngcontent-%COMP%]{margin-top:2px;display:grid}.quickShare_form[_ngcontent-%COMP%]{max-width:156px;width:-moz-fit-content;width:fit-content;height:-moz-fit-content;height:fit-content;padding:8px 12px;margin:4px 0 0;text-align:center;vertical-align:middle;word-break:keep-all;background-color:var(--chatroom-system-bgcolor)}.qoute_text[_ngcontent-%COMP%]{text-align:initial;margin:4px 0 0}.msg_parent[_ngcontent-%COMP%]{position:relative}.msg_bg_form[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;pointer-events:none}.msg_bg_col[_ngcontent-%COMP%]{width:100%;height:100%}.qoute_background[_ngcontent-%COMP%]{background-color:rgba(var(--ion-color-primary-rgb),.5)}.qouteImage[_ngcontent-%COMP%]{width:100%;object-fit:cover;display:block}.qouteImageHeight[_ngcontent-%COMP%]{max-height:32px;display:block}.href_image_margin[_ngcontent-%COMP%]{margin-top:8px;max-height:40px;object-fit:cover;border-radius:12px}.qouteDiv[_ngcontent-%COMP%]{padding:8px 12px;max-width:95vw;color:var(--default-text-color-direction);font-size:14px}.qouteOnChatBalloon[_ngcontent-%COMP%]{max-width:65vw}.qouteBalloonBottom[_ngcontent-%COMP%]{padding-top:8px}.message_content_form[_ngcontent-%COMP%]{display:inline-flex;margin:4px 0 0;place-self:flex-end}.edited_form[_ngcontent-%COMP%]{color:#888;font-size:12px;margin:0 8px;align-self:flex-end;padding-bottom:2px}.avatar_form[_ngcontent-%COMP%]{width:56px;vertical-align:top;padding:12px 8px 0 0;max-width:56px}.my_avatar_form[_ngcontent-%COMP%]{padding:12px 0 0 8px}.avatar_image[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:64px;object-fit:cover}.comp_local_content[_ngcontent-%COMP%]{color:#888}.text_seperator[_ngcontent-%COMP%]{background-color:#fff;margin-top:2px;position:relative;width:100%;height:2px}.file_button[_ngcontent-%COMP%]{width:160px;height:112px;background-color:#808080bb;margin-top:4px}.bottom_thumbnail[_ngcontent-%COMP%]{width:100%;max-width:100vw;max-height:96px;padding:8px}.image_thumbnail[_ngcontent-%COMP%]{width:auto;max-height:96px;height:auto;object-fit:contain;display:block;margin:auto;padding:8px}.thumbnails[_ngcontent-%COMP%]{width:-webkit-fill-available;height:-moz-fit-content;height:fit-content;position:relative;transform:translateY(-100%);background:var(--chatroom-last-msg-viewer-bg);padding:8px;margin:0 8px;bottom:4px}.thumbnail_parts[_ngcontent-%COMP%]{max-height:96px;overflow-y:scroll;max-width:100vw;padding:8px;word-break:break-all}.notice_form[_ngcontent-%COMP%]{text-align:center;margin:12px}.notice[_ngcontent-%COMP%]{font-size:12px;display:inline;background:var(--chatroom-system-bgcolor);padding:4px 8px;color:var(--default-text-color-direction)}.read_last_here[_ngcontent-%COMP%]{padding:4px 8px;width:-moz-fit-content;width:fit-content;text-align:center;font-size:12px;background:var(--chatroom-system-bgcolor);margin:4px 0}.text_span[_ngcontent-%COMP%]{white-space:normal}.ext_icon_img[_ngcontent-%COMP%]{max-width:36px;max-height:36px}.TextAreaInput[_ngcontent-%COMP%]{width:100%;height:36px;max-height:156px;resize:none;padding:6px;margin-top:5px;border:0;background-color:var(--chatroom-input-background);z-index:31}.imageForm[_ngcontent-%COMP%]{overflow:hidden;position:relative}.borderRadiusDefault[_ngcontent-%COMP%]{border-radius:8px}.borderRadiusBig[_ngcontent-%COMP%]{border-radius:16px}ion-button[_ngcontent-%COMP%]{--padding-start: 12px;--padding-end: 12px}"],data:{animation:[(0,F.hZ)("chat_lifecycle",[(0,F.kY)(":enter",[(0,F.iF)({transform:"translateX({{ offset }})",opacity:0}),(0,F.i0)(".3s ease-out",(0,F.iF)({transform:"translateX(0)",opacity:1}))],{params:{offset:"0px"}}),(0,F.kY)(":leave",[(0,F.i0)(".3s ease-in",(0,F.iF)({transform:"translateX({{ offset }})",opacity:0,height:0}))],{params:{offset:"0px"}})]),(0,F.hZ)("link_info",[(0,F.kY)(":enter",[(0,F.iF)({opacity:0,height:0}),(0,F.i0)(".5s ease-out",(0,F.iF)({opacity:1,height:"*"}))])])]}}),c})()},{path:"ionic-viewer",loadChildren:()=>Promise.all([C.e(6042),C.e(4803),C.e(222)]).then(C.bind(C,4803)).then(l=>l.IonicViewerPageModule)},{path:"void-draw",loadChildren:()=>Promise.all([C.e(6042),C.e(4020),C.e(2655)]).then(C.bind(C,2655)).then(l=>l.VoidDrawPageModule)}];let si=(()=>{var l;class c{}return(l=c).\u0275fac=function(t){return new(t||l)},l.\u0275mod=e.$C({type:l}),l.\u0275inj=e.G2t({imports:[U.iI.forChild(oi),U.iI]}),c})(),li=(()=>{var l;class c{}return(l=c).\u0275fac=function(t){return new(t||l)},l.\u0275mod=e.$C({type:l}),l.\u0275inj=e.G2t({imports:[X.MD,D.YN,A.bv,si]}),c})()}}]);