"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7048],{5404:(ve,oe,x)=>{x.d(oe,{Gq:()=>G});var G=function(Y){return Y.UTF8="utf8",Y.ASCII="ascii",Y.UTF16="utf16",Y}(G||{})},8744:(ve,oe,x)=>{x.d(oe,{K:()=>f});var _=x(1528),G=x(5193),W=x(9352),Y=x(896),de=x(2272),t=x(4496),E=x(5624),i=x(9240),A=x(4668),ae=x(4500),N=x(544),Q=x(3824),B=x(5020),S=x(7136),z=x(7756),q=x(6819),ee=x(1368),le=x(4716);const me=["ShowContentInfoIonic"];function xe(l,g){if(1&l){const r=t.KQA();t.I0R(0,"ion-icon",22),t.qCj("click",function(){t.usT(r);const n=t.GaO();return t.CGJ(n.AutoPlayNext=!n.AutoPlayNext)}),t.C$Y()}}function Ie(l,g){if(1&l){const r=t.KQA();t.I0R(0,"ion-icon",23),t.qCj("click",function(){t.usT(r);const n=t.GaO();return t.CGJ(n.AutoPlayNext=!n.AutoPlayNext)}),t.C$Y()}}function ye(l,g){if(1&l){const r=t.KQA();t.I0R(0,"ion-icon",24),t.qCj("click",function(){t.usT(r);const n=t.GaO();return t.CGJ(n.ChangeToAnother(-1))}),t.C$Y()}}function Ce(l,g){if(1&l&&(t.I0R(0,"ion-label",25),t.OEk(1),t.C$Y()),2&l){const r=t.GaO();t.yG2(),t.cNF(r.RelevanceIndex+" / "+r.Relevances.length)}}function be(l,g){if(1&l){const r=t.KQA();t.I0R(0,"ion-icon",26),t.qCj("click",function(){t.usT(r);const n=t.GaO();return t.CGJ(n.ChangeToAnother(1))}),t.C$Y()}}function Fe(l,g){if(1&l&&(t.I0R(0,"ion-label",27),t.OEk(1),t.C$Y()),2&l){const r=t.GaO();t.yG2(),t.cNF(r.FileInfo.filename||r.FileInfo.name)}}function we(l,g){if(1&l){const r=t.KQA();t.I0R(0,"ion-input",28),t.iHE("ngModelChange",function(n){t.usT(r);const c=t.GaO();return t.kNx(c.NewTextFileName,n)||(c.NewTextFileName=n),t.CGJ(n)}),t.C$Y()}if(2&l){const r=t.GaO();t.OKB("ngModel",r.NewTextFileName),t.E7m("placeholder",r.FileInfo.filename||r.FileInfo.name)}}function De(l,g){if(1&l){const r=t.KQA();t.I0R(0,"ion-button",29),t.qCj("click",function(){t.usT(r);const n=t.GaO();return t.CGJ(n.close_text_edit())}),t.wR5(1,"ion-icon",30),t.C$Y()}}function Te(l,g){if(1&l){const r=t.KQA();t.I0R(0,"ion-button",29),t.qCj("click",function(){t.usT(r);const n=t.GaO();return t.CGJ(n.SaveText())}),t.wR5(1,"ion-icon",31),t.C$Y()}}function ke(l,g){if(1&l){const r=t.KQA();t.I0R(0,"ion-button",32),t.qCj("click",function(){t.usT(r);const n=t.GaO();return t.CGJ(n.DownloadAllListFiles())}),t.wR5(1,"ion-icon",33),t.C$Y()}if(2&l){const r=t.GaO();t.E7m("disabled",r.isDownloading||r.MessageInfo.content.transfer_index&&"download"==r.MessageInfo.content.transfer_index.OnTransfer)}}function Oe(l,g){1&l&&(t.I0R(0,"ion-button",34),t.wR5(1,"ion-icon",35),t.C$Y())}function Pe(l,g){if(1&l){const r=t.KQA();t.I0R(0,"ion-item",38),t.qCj("click",function(){t.usT(r);const n=t.GaO(3);return t.CGJ(n.open_text_editor())}),t.I0R(1,"ion-label"),t.OEk(2),t.C$Y()()}if(2&l){const r=t.GaO(3);t.yG2(2),t.cNF(r.lang.text.ContentViewer.EditText)}}function Re(l,g){if(1&l){const r=t.KQA();t.I0R(0,"ion-item",38),t.qCj("click",function(){t.usT(r);const n=t.GaO(3);return t.CGJ(n.modify_image())}),t.I0R(1,"ion-label"),t.OEk(2),t.C$Y()()}if(2&l){const r=t.GaO(3);t.yG2(2),t.cNF(r.lang.text.ContentViewer.Edit)}}function Ee(l,g){if(1&l){const r=t.KQA();t.I0R(0,"ion-item",38),t.qCj("click",function(){t.usT(r);const n=t.GaO(3);return t.CGJ(n.ShareContent())}),t.I0R(1,"ion-label"),t.OEk(2),t.C$Y()()}if(2&l){const r=t.GaO(3);t.yG2(2),t.cNF(r.lang.text.ContentViewer.ShareContent)}}function Ge(l,g){if(1&l){const r=t.KQA();t.I0R(0,"ion-item",38),t.qCj("click",function(){t.usT(r);const n=t.GaO(3);return t.CGJ(n.download_file())}),t.I0R(1,"ion-label"),t.OEk(2),t.C$Y()()}if(2&l){const r=t.GaO(3);t.yG2(2),t.cNF(r.lang.text.ContentViewer.Download)}}function Ue(l,g){if(1&l){const r=t.KQA();t.I0R(0,"ion-item",38),t.qCj("click",function(){t.usT(r);const n=t.GaO(3);return t.CGJ(n.RemoveFile())}),t.I0R(1,"ion-label"),t.OEk(2),t.C$Y()()}if(2&l){const r=t.GaO(3);t.yG2(2),t.cNF(r.lang.text.ContentViewer.RemoveFile)}}function Be(l,g){if(1&l){const r=t.KQA();t.I0R(0,"ion-content")(1,"ion-list"),t.yuY(2,Pe,3,1,"ion-item",37)(3,Re,3,1,"ion-item",37),t.I0R(4,"ion-item",38),t.qCj("click",function(){t.usT(r);const n=t.GaO(2);return t.CGJ(n.open_bottom_modal())}),t.I0R(5,"ion-label"),t.OEk(6),t.C$Y()(),t.yuY(7,Ee,3,1,"ion-item",37)(8,Ge,3,1,"ion-item",37)(9,Ue,3,1,"ion-item",37),t.C$Y()()}if(2&l){const r=t.GaO(2);t.yG2(2),t.E7m("ngIf",!r.NeedDownloadFile&&"text"==r.FileInfo.viewer),t.yG2(),t.E7m("ngIf",!r.NeedDownloadFile&&"audio"!=r.FileInfo.viewer),t.yG2(3),t.cNF(r.lang.text.ContentViewer.ContentInfo),t.yG2(),t.E7m("ngIf",!r.NeedDownloadFile),t.yG2(),t.E7m("ngIf",!r.NeedDownloadFile),t.yG2(),t.E7m("ngIf",!r.NeedDownloadFile&&r.OpenInChannelChat&&!r.FileInfo.url)}}function Le(l,g){1&l&&(t.I0R(0,"ion-popover",36),t.yuY(1,Be,10,6,"ng-template"),t.C$Y())}function Ae(l,g){if(1&l&&(t.I0R(0,"div")(1,"div",40),t.wR5(2,"ion-icon",41),t.I0R(3,"div")(4,"ion-label",42),t.OEk(5),t.C$Y()()()()),2&l){const r=t.GaO(2);t.yG2(5),t.cNF(r.lang.text.ContentViewer.OnLoadContent)}}function $e(l,g){if(1&l&&(t.I0R(0,"td"),t.yuY(1,Ae,6,1,"div",19),t.wR5(2,"div",39),t.C$Y()),2&l){const r=t.GaO();t.yG2(),t.E7m("ngIf",!r.ContentOnLoad)}}function Me(l,g){if(1&l){const r=t.KQA();t.I0R(0,"td")(1,"ion-grid")(2,"ion-row",43)(3,"ion-col",44)(4,"ion-button",45),t.qCj("click",function(){t.usT(r);const n=t.GaO();return t.CGJ(n.DownloadCurrentFile())}),t.OEk(5),t.C$Y()()()()()}if(2&l){const r=t.GaO();t.yG2(4),t.E7m("disabled",r.isDownloading||r.MessageInfo.content.transfer_index&&"download"==r.MessageInfo.content.transfer_index.OnTransfer),t.yG2(),t.oRS(" ",r.MessageInfo.content.transfer_index&&"download"==r.MessageInfo.content.transfer_index.OnTransfer?r.lang.text.ContentViewer.FileDownloading:r.lang.text.ContentViewer.DownloadThisFile," ")}}function Se(l,g){if(1&l){const r=t.KQA();t.I0R(0,"ion-item",38),t.qCj("click",function(){t.usT(r);const n=t.GaO(2);return t.CGJ(n.copy_url(n.content_creator.user_id))}),t.I0R(1,"ion-label"),t.OEk(2),t.C$Y(),t.I0R(3,"ion-label",47),t.OEk(4),t.C$Y()()}if(2&l){const r=t.GaO(2);t.yG2(2),t.cNF(r.lang.text.ContentInfo.LastPost),t.yG2(2),t.oRS(" ",r.content_creator.publisher||r.content_creator.display_name||r.lang.text.Profile.noname_user,"")}}function Ve(l,g){if(1&l&&(t.I0R(0,"ion-item",50)(1,"ion-label"),t.OEk(2),t.C$Y(),t.I0R(3,"ion-label",47),t.OEk(4),t.C$Y()()),2&l){const r=t.GaO(2);t.yG2(2),t.cNF(r.lang.text.ContentInfo.SourceFrom),t.yG2(2),t.cNF(r.content_creator.various_display)}}function Ye(l,g){if(1&l&&(t.I0R(0,"ion-item")(1,"ion-label"),t.OEk(2),t.C$Y(),t.I0R(3,"ion-label",47),t.OEk(4),t.C$Y()()),2&l){const r=t.GaO(2);t.yG2(2),t.cNF(r.lang.text.ContentInfo.FileSize),t.yG2(2),t.cNF(r.CurrentFileSize)}}function Ne(l,g){1&l&&t.wR5(0,"ion-icon",59)}function je(l,g){1&l&&t.wR5(0,"ion-icon",60)}function We(l,g){1&l&&t.wR5(0,"ion-icon",61)}function Ke(l,g){1&l&&t.wR5(0,"ion-icon",62)}function p(l,g){1&l&&t.wR5(0,"ion-icon",63)}function O(l,g){1&l&&t.wR5(0,"ion-icon",64)}function m(l,g){1&l&&(t.I0R(0,"ion-avatar"),t.wR5(1,"img",65),t.C$Y())}function o(l,g){if(1&l){const r=t.KQA();t.I0R(0,"div")(1,"div",51),t.OEk(2),t.I0R(3,"ion-chip",52),t.qCj("click",function(){const c=t.usT(r).$implicit,u=t.GaO(2);return t.CGJ(u.toast_info(c))}),t.yuY(4,Ne,1,0,"ion-icon",53)(5,je,1,0,"ion-icon",54)(6,We,1,0,"ion-icon",55)(7,Ke,1,0,"ion-icon",56)(8,p,1,0,"ion-icon",57)(9,O,1,0,"ion-icon",58)(10,m,2,0,"ion-avatar",19),t.I0R(11,"ion-label"),t.OEk(12),t.C$Y()()()()}if(2&l){const r=g.$implicit,e=t.GaO(2);t.yG2(2),t.oRS(" ",r.timeDisplay," "),t.yG2(2),t.E7m("ngIf","loaded"==r.various),t.yG2(),t.E7m("ngIf","camera"==r.various),t.yG2(),t.E7m("ngIf","link"==r.various),t.yG2(),t.E7m("ngIf","long_text"==r.various),t.yG2(),t.E7m("ngIf","textedit"==r.various),t.yG2(),t.E7m("ngIf","shared"==r.various),t.yG2(),t.E7m("ngIf","voidDraw"==r.various),t.yG2(2),t.cNF(r.publisher||r.display_name||e.lang.text.Profile.noname_user)}}function a(l,g){if(1&l){const r=t.KQA();t.I0R(0,"ion-content")(1,"ion-item-divider")(2,"ion-label"),t.OEk(3),t.C$Y()(),t.yuY(4,Se,5,2,"ion-item",37)(5,Ve,5,2,"ion-item",46)(6,Ye,5,2,"ion-item",19),t.I0R(7,"ion-item")(8,"ion-label"),t.OEk(9),t.C$Y(),t.I0R(10,"ion-label",47),t.OEk(11),t.C$Y()(),t.I0R(12,"ion-item-divider")(13,"ion-label"),t.OEk(14),t.C$Y()(),t.yuY(15,o,13,9,"div",48),t.I0R(16,"ion-item",38),t.qCj("click",function(){t.usT(r),t.GaO();const n=t.Gew(27);return t.CGJ(n.dismiss())}),t.I0R(17,"ion-label",49),t.OEk(18),t.C$Y()()()}if(2&l){const r=t.GaO();t.yG2(3),t.cNF(r.lang.text.ContentInfo.WorkLogs),t.yG2(),t.E7m("ngIf",!r.FromUserFsDir),t.yG2(),t.E7m("ngIf",r.content_creator.various),t.yG2(),t.E7m("ngIf",!r.FileInfo.url),t.yG2(3),t.cNF(r.lang.text.ContentInfo.TimeAt),t.yG2(2),t.cNF(r.content_creator.timeDisplay),t.yG2(3),t.cNF(r.lang.text.ContentInfo.WorkHistory),t.yG2(),t.E7m("ngForOf",r.content_related_creator),t.yG2(3),t.cNF(r.lang.text.ContentInfo.CloseModal)}}const d=()=>[.5,1];let f=(()=>{var l;class g{constructor(e,n,c,u,I,s,h,F,k,T,y,v){this.modalCtrl=e,this.navParams=n,this.indexed=c,this.lang=u,this.file=I,this.p5toast=s,this.alertCtrl=h,this.loadingCtrl=F,this.global=k,this.nakama=T,this.mClipboard=y,this.noti=v,this.useP5Navigator=!0,this.RelevanceIndex=0,this.HaveRelevances=!1,this.NeedDownloadFile=!1,this.ContentOnLoad=!1,this.isDownloading=!1,this.OpenInChannelChat=!1,this.isChannelOnline=!0,this.fromLocalChannel=!1,this.EventListenerAct=P=>{P.detail.register(120,w=>{})},this.BackButtonPressed=!1,this.ContentChanging=!1,this.AutoPlayNext=!1,this.isTextEditMode=!1,this.NewTextFileName="",this.image_info={},this.forceWrite=!1}InitBrowserBackButtonOverride(){window.history.replaceState(null,null,window.location.href),window.onpopstate=()=>{this.BackButtonPressed||(this.BackButtonPressed=!0,this.modalCtrl.dismiss())}}ngOnInit(){var e=this;return(0,_.c)(function*(){e.InitBrowserBackButtonOverride(),e.fromLocalChannel=e.navParams.get("local"),e.MessageInfo=e.navParams.get("info"),e.OpenInChannelChat=void 0!==e.MessageInfo.code,e.CurrentViewId=e.MessageInfo.message_id,e.FileInfo=e.MessageInfo.content,e.ContentBox=document.getElementById("ContentBox"),e.FileHeader=document.getElementById("FileHeader"),e.isOfficial=e.navParams.get("isOfficial"),e.target=e.navParams.get("target");try{e.isChannelOnline="online"==e.nakama.channels_orig[e.isOfficial][e.target][e.MessageInfo.channel_id].info.status,e.isChannelOnline=e.isChannelOnline||"online"==e.nakama.channels_orig[e.isOfficial][e.target][e.MessageInfo.channel_id].status||"pending"==e.nakama.channels_orig[e.isOfficial][e.target][e.MessageInfo.channel_id].status}catch{}if("text"===(e.targetDB=e.navParams.get("targetDB"),e.FromUserFsDir=e.navParams.get("no_edit")||!1,e.FileInfo.is_new));else{if(e.Relevances=e.navParams.get("relevance"),e.Relevances){for(let n=0,c=e.Relevances.length;n<c;n++)if(e.Relevances[n].message_id&&e.MessageInfo.message_id){if(e.Relevances[n].message_id==e.MessageInfo.message_id){e.RelevanceIndex=n+1;break}}else if(e.Relevances[n].content.path==e.MessageInfo.content.path){e.RelevanceIndex=n+1;break}e.HaveRelevances=e.Relevances.length>1}else e.HaveRelevances=!1;e.CreateContentInfo()}})()}reinit_content_data(e){var n=this;return(0,_.c)(function*(){n.NewTextFileName="",n.NeedDownloadFile=!0,n.ContentOnLoad=!1,n.isTextEditMode=!1,n.MessageInfo=e,n.CurrentViewId=n.MessageInfo.message_id,n.FileInfo=n.MessageInfo.content;let c=document.getElementById("content_viewer_canvas");if(c)for(let u=0,I=c.childNodes.length;u<I;u++)c.removeChild(c.childNodes[u]);if(URL.revokeObjectURL(n.FileURL),n.FileInfo.url)n.CreateContentInfo(),n.NeedDownloadFile=!1,n.ContentOnLoad=!0,n.ionViewDidEnter();else{let u=n.FileInfo.path||`servers/${n.isOfficial}/${n.target}/channels/${e.channel_id}/files/msg_${e.message_id}.${e.content.file_ext}`;n.image_info.path=u,n.NeedDownloadFile=yield n.indexed.checkIfFileExist(`${u}.history`,void 0,n.targetDB);try{n.blob=yield n.indexed.loadBlobFromUserPath(u,n.FileInfo.type,void 0,n.targetDB),n.CreateContentInfo(),n.ionViewDidEnter()}catch{n.FileURL=void 0,n.blob=void 0,n.isDownloading=!1,n.NeedDownloadFile=!0,n.ContentOnLoad=!1,n.CreateContentInfo(),n.p5canvas&&n.p5canvas.remove(),n.p5canvas=new W(s=>{s.setup=()=>{s.noCanvas()}}),n.ChangeContentWithKeyInput()}}})()}DownloadAllListFiles(){this.alertCtrl.create({header:this.lang.text.ContentViewer.DownloadAllFiles,message:this.lang.text.ContentViewer.DownloadLoadedList,buttons:[{text:this.lang.text.ContentViewer.DownloadThisFile,handler:()=>{this.DownloadInOrder()}}]}).then(e=>e.present())}DownloadInOrder(){var e=this;return(0,_.c)(function*(){("Android"==G.s1||"iOS"==G.s1)&&e.noti.noti.schedule({id:6,title:e.lang.text.ContentViewer.DownloadThisFile,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://diychat",color:"b0b0b0"});for(let n=0,c=e.Relevances.length;n<c;n++)e.nakama.OnTransfer[e.isOfficial]||(e.nakama.OnTransfer[e.isOfficial]={}),e.nakama.OnTransfer[e.isOfficial][e.target]||(e.nakama.OnTransfer[e.isOfficial][e.target]={}),e.nakama.OnTransfer[e.isOfficial][e.target][e.Relevances[n].channel_id]||(e.nakama.OnTransfer[e.isOfficial][e.target][e.Relevances[n].channel_id]={}),e.nakama.OnTransfer[e.isOfficial][e.target][e.Relevances[n].channel_id][e.Relevances[n].message_id]||(e.nakama.OnTransfer[e.isOfficial][e.target][e.Relevances[n].channel_id][e.Relevances[n].message_id]={});for(let n=0,c=e.Relevances.length;n<c;n++){("Android"==G.s1||"iOS"==G.s1)&&e.noti.noti.schedule({id:6,title:`${e.lang.text.ContentViewer.DownloadThisFile}: ${c-n}`,progressBar:{value:n,maxValue:c},sound:null,smallIcon:"res://diychat",color:"b0b0b0"});let u=`servers/${e.isOfficial}/${e.target}/channels/${e.Relevances[n].channel_id}/files/msg_${e.Relevances[n].message_id}.${e.Relevances[n].content.file_ext}`;if(!(yield e.indexed.checkIfFileExist(u,void 0,e.targetDB)))try{yield e.DownloadCurrentFile(n)}catch(s){console.log(s)}}e.noti.ClearNoti(6)})()}ChangeToAnother(e){if(this.ContentChanging)return;this.ContentChanging=!0;let n=this.RelevanceIndex+e;n<=0||n>this.Relevances.length||(this.p5canvas&&this.p5canvas.remove(),this.RelevanceIndex=n,this.FileInfo={file_ext:""},this.reinit_content_data(this.Relevances[this.RelevanceIndex-1]),this.ContentChanging=!1)}DownloadCurrentFile(e){var n=this;return(0,_.c)(function*(){n.isDownloading=!0;let c=0,u=n.Relevances[null!=e?e:n.RelevanceIndex-1],I=`servers/${n.isOfficial}/${n.target}/channels/${u.channel_id}/files/msg_${u.message_id}.${u.content.file_ext}`;try{let h=yield n.indexed.loadTextFromUserPath(`${I}.history`,void 0,n.targetDB);c=JSON.parse(h).index}catch{}let s=u.message_id;yield n.nakama.ReadStorage_From_channel(u,I,n.isOfficial,n.target,c),n.CurrentViewId==s&&n.reinit_content_data(u)})()}formatBytes(e,n=2){if(!+e)return"0 Bytes";const u=n<0?0:n,s=Math.floor(Math.log(e)/Math.log(1024));return`${parseFloat((e/Math.pow(1024,s)).toFixed(u))} ${["Bytes","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"][s]}`}CreateContentInfo(){try{if(this.FileInfo.url||(this.CurrentFileSize=this.formatBytes(this.FileInfo.size||this.FileInfo.filesize||this.blob.size)),this.content_creator=this.FileInfo.content_creator||{timestamp:this.FileInfo.timestamp},this.content_creator.timeDisplay=new Date(this.content_creator.timestamp).toLocaleString(),this.content_related_creator=this.FileInfo.content_related_creator||[],this.content_creator.user_id)try{this.content_creator.is_me=this.nakama.servers[this.isOfficial][this.target].session.user_id==this.content_creator.user_id}catch{}try{this.content_creator.publisher=this.content_creator.is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_creator.user_id].display_name}catch{}this.set_various_display(this.content_creator);for(let e=0,n=this.content_related_creator.length;e<n;e++){if(this.content_related_creator[e].user_id)try{this.content_related_creator[e].is_me=this.nakama.servers[this.isOfficial][this.target].session.user_id==this.content_related_creator[e].user_id}catch{}this.content_related_creator[e].timeDisplay=new Date(this.content_related_creator[e].timestamp).toLocaleString()}}catch{}try{this.content_related_creator[0].publisher=this.content_related_creator[0].is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_related_creator[0].user_id].display_name,this.content_related_creator[0].timestamp==this.content_related_creator[1].timestamp&&(this.content_related_creator[0].publisher=this.content_related_creator[1].is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_related_creator[1].user_id].display_name,this.content_related_creator.splice(1,1))}catch{try{this.content_related_creator[0].publisher=this.content_related_creator[1].display_name,this.content_related_creator[0].timestamp==this.content_related_creator[1].timestamp&&(this.content_related_creator[0].publisher=this.content_related_creator[1].display_name,this.content_related_creator.splice(1,1))}catch{}try{this.content_related_creator[0].publisher||(this.content_related_creator[0].publisher=this.content_related_creator[0].display_name)}catch{}}try{this.content_related_creator.sort((e,n)=>e.timestamp>n.timestamp?-1:e.timestamp<n.timestamp?1:0)}catch{}}set_various_display(e){switch(e.various){case"camera":e.various_display=this.lang.text.GlobalAct.FromCamera;break;case"link":e.various_display=this.lang.text.ChatRoom.ExternalLinkFile;break;case"loaded":e.various_display=this.lang.text.GlobalAct.variousCreator;break;case"voidDraw":e.various_display=this.lang.text.GlobalAct.FromVoidDraw;break;case"long_text":e.various_display=this.lang.text.GlobalAct.FromAutoLongText;break;case"textedit":e.various_display=this.lang.text.GlobalAct.FromTextEditor;break;case"shared":e.various_display=this.lang.text.GlobalAct.SharedContent;break;default:e.various_display=this.lang.text.GlobalAct.UnknownSource}}close_text_edit(){this.FileInfo.is_new?this.modalCtrl.dismiss():this.reinit_content_data(this.MessageInfo)}ionViewDidEnter(){var e=this;return(0,_.c)(function*(){e.FileInfo.url?e.FileURL=e.FileInfo.url:e.FileInfo.is_new||(e.blob||(e.blob=yield e.indexed.loadBlobFromUserPath(e.FileInfo.path||e.navParams.get("path"),e.FileInfo.type,void 0,e.targetDB)),e.FileURL=URL.createObjectURL(e.blob)),e.forceWrite=!1;let n=document.getElementById("content_viewer_canvas");switch(n&&(n.style.backgroundImage=""),document.removeEventListener("ionBackButton",e.EventListenerAct),e.p5canvas&&e.p5canvas.remove(),e.FileInfo.viewer){case"image":e.p5canvas=new W(s=>{s.setup=(0,_.c)(function*(){n.style.maxWidth="100%",n.style.overflow="hidden",e.ContentBox.style.overflow="hidden",s.noCanvas();let D=s.createElement("img");D.elt.hidden=!0,D.elt.src=e.FileURL,D.elt.onload=()=>{n.style.backgroundImage=`url('${e.FileURL}')`,n.style.backgroundRepeat="no-repeat",n.style.pointerEvents="none",e.image_info.width=D.elt.naturalWidth,e.image_info.height=D.elt.naturalHeight,F=s.createVector(D.elt.naturalWidth,D.elt.naturalHeight),h(),D.remove()},s.noLoop()});let h=()=>{if(e.image_info.width/e.image_info.height<n.clientWidth/n.clientHeight){let D=e.image_info.width*n.clientHeight/e.image_info.height;n.style.backgroundSize=`${D}px`,n.style.backgroundPositionX=(n.clientWidth-D)/2+"px",n.style.backgroundPositionY="0px"}else n.style.backgroundSize=`${n.clientWidth}px`,n.style.backgroundPositionX="0px",n.style.backgroundPositionY=n.clientHeight/2-F.y*(n.clientWidth/F.x)/2+"px";ie=!0};s.windowResized=()=>{setTimeout(()=>{h()},50)};let F,k=s.createVector(),T=s.createVector(),y=s.createVector(),v=1,P=()=>{n.style.backgroundPositionX=`${k.x+y.x}px`,n.style.backgroundPositionY=`${k.y+y.y}px`},w=(D,J)=>{let R=v,j=v*J,b=Number(n.style.backgroundPositionX.split("px")[0]),re=Number(n.style.backgroundPositionY.split("px")[0]),he=(R-j)*s.map(D.x,b,b+R,0,1),X=(R-j)/F.x*F.y*s.map(D.y,re,re+R/F.x*F.y,0,1);n.style.backgroundPositionX=`${b+he}px`,n.style.backgroundPositionY=`${re+X}px`,n.style.backgroundSize=`${j}px`};s.mousePressed=()=>{e.useP5Navigator&&(s.mouseButton==s.CENTER&&h(),"DesktopPWA"==G.s1&&(k=s.createVector(Number(n.style.backgroundPositionX.split("px")[0]),Number(n.style.backgroundPositionY.split("px")[0])),T=s.createVector(s.mouseX,s.mouseY)))},s.mouseWheel=D=>{e.useP5Navigator&&(v=Number(n.style.backgroundSize.split("px")[0]),w(s.createVector(n.clientWidth/2,n.clientHeight/2),1-D.delta/1e3))},s.mouseDragged=()=>{e.useP5Navigator&&"DesktopPWA"==G.s1&&(y=s.createVector(s.mouseX,s.mouseY),y.sub(T),P())};let U,C={},te=!1,ie=!0;s.touchStarted=D=>{if(e.useP5Navigator){for(let R=0,j=D.changedTouches.length;R<j;R++)C[D.changedTouches[R].identifier]=s.createVector(D.changedTouches[R].clientX,D.changedTouches[R].clientY);switch(Object.keys(C).length){case 1:k=s.createVector(Number(n.style.backgroundPositionX.split("px")[0]),Number(n.style.backgroundPositionY.split("px")[0])),T=C[D.changedTouches[0].identifier].copy();break;case 2:k=s.createVector(Number(n.style.backgroundPositionX.split("px")[0]),Number(n.style.backgroundPositionY.split("px")[0]));let R=C[0].copy();U=R.dist(C[1]),T=R.add(C[1]).div(2).copy(),v=Number(n.style.backgroundSize.split("px")[0]),P();break;default:te=!0,h()}}},s.touchMoved=D=>{if(e.useP5Navigator&&!te){for(let R=0,j=D.changedTouches.length;R<j;R++)C[D.changedTouches[R].identifier]=s.createVector(D.changedTouches[R].clientX,D.changedTouches[R].clientY);switch(Object.keys(C).length){case 1:y=C[D.changedTouches[0].identifier].copy(),y.sub(T),ie||P();break;case 2:ie=!1;let R=C[0].copy(),j=R.dist(C[1]);y=R.add(C[1]).div(2).copy();let b=y.copy();y.sub(T),P(),w(b,j/U)}}},s.touchEnded=D=>{if(e.useP5Navigator&&"changedTouches"in D){for(let R=0,j=D.changedTouches.length;R<j;R++)delete C[D.changedTouches[R].identifier];switch(Object.keys(C).length){case 1:k=s.createVector(Number(n.style.backgroundPositionX.split("px")[0]),Number(n.style.backgroundPositionY.split("px")[0])),T=C[Object.keys(C)[0]].copy();break;case 0:ie&&!te&&(y.x>50?e.ChangeToAnother(-1):y.x<-50&&e.ChangeToAnother(1)),te=!1}}}});break;case"audio":e.p5canvas=new W(s=>{var h;s.setup=()=>{s.noCanvas(),s.noLoop(),(h=s.createAudio([e.FileURL],()=>{n.appendChild(h.elt),h.elt.onended=()=>{e.AutoPlayNext&&e.ChangeToAnother(1)},setTimeout(()=>{F(),h.elt.hidden=!1},50),h.showControls(),h.play()})).elt.hidden=!0};let F=()=>{let v=e.ContentBox.offsetWidth;h.elt.setAttribute("style","position: relative; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%);"),h.size(v,25)};s.windowResized=()=>{setTimeout(()=>{F()},50)};let k=s.createVector(),T={};s.touchStarted=v=>{if(e.useP5Navigator&&!document.pictureInPictureElement&&"changedTouches"in v){for(let w=0,C=v.changedTouches.length;w<C;w++)T[v.changedTouches[w].identifier]=s.createVector(v.changedTouches[w].clientX,v.changedTouches[w].clientY);1===Object.keys(T).length&&(k=T[v.changedTouches[0].identifier].copy())}},s.touchEnded=v=>{if(e.useP5Navigator&&!document.pictureInPictureElement&&"changedTouches"in v){let P;for(let C=0,U=v.changedTouches.length;C<U;C++)P=s.createVector(v.changedTouches[C].clientX,v.changedTouches[C].clientY),delete T[v.changedTouches[C].identifier];0===Object.keys(T).length&&(P.sub(k),P.x>50?e.ChangeToAnother(-1):P.x<-50&&e.ChangeToAnother(1))}}});break;case"video":e.p5canvas=new W(s=>{var h;s.setup=(0,_.c)(function*(){s.noCanvas(),s.noLoop(),(h=s.createVideo([e.FileURL],()=>{e.global.PIPLinkedVideoElement?(h.elt.remove(),h.elt=e.global.PIPLinkedVideoElement,h.elt.setAttribute("src",e.FileURL)):e.global.PIPLinkedVideoElement=h.elt,n&&n.appendChild(h.elt),h.elt.onended=()=>{e.AutoPlayNext&&e.ChangeToAnother(1)},setTimeout(()=>{e.image_info.width=h.elt.videoWidth,e.image_info.height=h.elt.videoHeight,F(),h.elt.hidden=!1},50),h.showControls(),h.play()})).elt.hidden=!0,s.VideoMedia=h});let F=()=>{let v=e.ContentBox.offsetWidth,P=e.ContentBox.offsetHeight-e.FileHeader.offsetHeight,w=h.elt.videoWidth,C=h.elt.videoHeight;0!=w&&0!=C&&(v/P>w/C?(C=P,w=w/h.elt.videoHeight*C,h.elt.setAttribute("style","position: relative; left: 50%; transform: translateX(-50%);")):(w=v,C=C/h.elt.videoWidth*w||P/2,h.elt.setAttribute("style","position: relative; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%);")),h.size(w,C))};s.windowResized=()=>{setTimeout(()=>{F()},50)};let k=s.createVector(),T={};s.touchStarted=v=>{if(e.useP5Navigator&&!document.pictureInPictureElement&&"changedTouches"in v){for(let w=0,C=v.changedTouches.length;w<C;w++)T[v.changedTouches[w].identifier]=s.createVector(v.changedTouches[w].clientX,v.changedTouches[w].clientY);1===Object.keys(T).length&&(k=T[v.changedTouches[0].identifier].copy())}},s.touchEnded=v=>{if(e.useP5Navigator&&!document.pictureInPictureElement&&"changedTouches"in v){let P;for(let C=0,U=v.changedTouches.length;C<U;C++)P=s.createVector(v.changedTouches[C].clientX,v.changedTouches[C].clientY),delete T[v.changedTouches[C].identifier];0===Object.keys(T).length&&(P.sub(k),P.x>50?e.ChangeToAnother(-1):P.x<-50&&e.ChangeToAnother(1))}}});break;case"text":e.p5canvas=new W(s=>{s.setup=()=>{s.noCanvas(),s.noLoop();let h=s.createElement("textarea");h.elt.disabled=!0,h.elt.className="infobox",h.elt.setAttribute("style","height: 100%; display: block;"),h.elt.textContent="",n.appendChild(h.elt),s.TextArea=h.elt,e.FileInfo.is_new?e.open_text_editor(h.elt):s.loadStrings(e.FileURL,F=>{h.elt.textContent=F.join("\n")},F=>{n.textContent=e.lang.text.ContentViewer.CannotOpenText,e.FileInfo.else=!0})}});break;case"godot":document.addEventListener("ionBackButton",e.EventListenerAct);let c,u=e.MessageInfo.message_id;try{let s=yield e.indexed.loadBlobFromUserPath((e.FileInfo.path||e.navParams.get("path"))+"_thumbnail.png","",void 0,e.targetDB);c=URL.createObjectURL(s)}catch{}!e.NeedDownloadFile&&e.CurrentViewId==u&&setTimeout((0,_.c)(function*(){let s=!1;if(e.indexed.godotDB)try{let h=yield e.indexed.loadBlobFromUserPath(e.FileInfo.path||e.navParams.get("path"),"",void 0,e.indexed.ionicDB);yield e.indexed.GetGodotIndexedDB(),yield e.indexed.saveBlobToUserPath(h,"tmp_files/duplicate/viewer.pck",void 0,e.indexed.godotDB),s=!0}catch(h){console.log("\ub0b4\ubd80 \ud30c\uc77c \uc5c6\uc74c: ",h)}if(yield e.global.CreateGodotIFrame("content_viewer_canvas",{path:"tmp_files/duplicate/viewer.pck",alt_path:e.FileInfo.path||e.navParams.get("path"),ext:e.FileInfo.file_ext,url:e.FileInfo.url,background:c,receive_image:(h=(0,_.c)(function*(F,k,T){let y="tmp_files/modify_image.png";yield e.indexed.saveBase64ToUserPath(","+F,y),e.modalCtrl.dismiss({type:"image",path:y,width:k,height:T,msg:e.MessageInfo,index:e.RelevanceIndex-1})}),function(k,T,y){return h.apply(this,arguments)})},"start_load_pck"),!s){try{let h=yield e.indexed.loadBlobFromUserPath(e.FileInfo.path||e.navParams.get("path"),"",void 0,e.indexed.ionicDB);yield e.indexed.GetGodotIndexedDB(),yield e.indexed.saveBlobToUserPath(h,"tmp_files/duplicate/viewer.pck",void 0,e.indexed.godotDB)}catch{}yield e.global.CreateGodotIFrame("content_viewer_canvas",{path:"tmp_files/duplicate/viewer.pck",alt_path:e.FileInfo.path||e.navParams.get("path"),ext:e.FileInfo.file_ext,url:e.FileInfo.url,background:c,receive_image:function(){var h=(0,_.c)(function*(F,k,T){let y="tmp_files/modify_image.png";yield e.indexed.saveBase64ToUserPath(","+F,y),e.modalCtrl.dismiss({type:"image",path:y,width:k,height:T,msg:e.MessageInfo,index:e.RelevanceIndex-1})});return function(k,T,y){return h.apply(this,arguments)}}()},"start_load_pck")}var h;c&&URL.revokeObjectURL(c),e.FileInfo.url?e.global.godot_window.download_url():e.global.godot_window.start_load_pck()}),100);break;case"blender":let I=yield e.loadingCtrl.create({message:e.lang.text.ContentViewer.OnLoadContent});I.present(),e.p5canvas=new W(s=>{let y,h=[],F=[],T={};s.setup=(0,_.c)(function*(){let P,v=s.createCanvas(n.clientWidth,n.clientHeight,s.WEBGL);v.parent(n),s.canvas=v,s.textureMode(s.NORMAL),s.textureWrap(s.REPEAT),s.clear(255,255,255,0),s.pixelDensity(1);try{P=yield e.indexed.loadBlobFromUserPath(e.FileInfo.path,e.FileInfo.type||"")}catch{try{P=yield(yield fetch(e.FileInfo.url)).blob()}catch(U){console.log("\ubdf0\uc5b4\uc5d0\uc11c \ud30c\uc77c \ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",U)}}let w=s.createElement("iframe");w.elt.id="jsBlend",w.elt.setAttribute("src","assets/js.blend/index.html"),w.elt.setAttribute("frameborder","0"),w.elt.setAttribute("class","full_screen"),w.elt.setAttribute("allow","fullscreen; encrypted-media"),w.elt.setAttribute("scrolling","no"),w.elt.setAttribute("withCredentials","true"),w.elt.setAttribute("hidden","true"),n.appendChild(w.elt),w.elt.contentWindow.TARGET_FILE=P,w.elt.onload=(0,_.c)(function*(){if(!P)return e.p5toast.show({text:e.lang.text.ContentViewer.CannotOpenText}),void I.dismiss();y=s.createDiv(),y.parent(n),y.id("logDiv"),y.style("position","absolute"),y.style("width","100%"),y.style("height","100%"),y.style("max-height",`${n.clientHeight}px`),y.style("pointer-events","none");let C=yield w.elt.contentWindow.JSBLEND(P);const U=100;let te=C.file.AB;for(let j=0;j<C.file.objects.Object.length;j++){let b=C.file.objects.Object[j];I.message=`${e.lang.text.ContentViewer.ReadObject}: ${b.aname}`;let re=s.createVector(-b.loc[0]*U,-b.loc[2]*U,b.loc[1]*U),he=s.createVector(b.rot[0],b.rot[2],-b.rot[1]);switch(b.type){case 0:case 11:break;case 1:{let ce,X=(b.data.vdata.layers[0]||b.data.vdata.layers).data,_e=(b.data.edata.layers[0]||b.data.edata.layers).data,ze=(b.data.ldata.layers[0]||b.data.ldata.layers).data;s.beginGeometry(),s.push(),s.translate(re),s.scale(b.size[0],b.size[2],b.size[1]),b.rot[0]+b.rot[1]+b.rot[2]&&(y.elt.innerHTML+=`<div style="color: var(--ion-color-warning-shade)">${b.aname}: ${e.lang.text.ContentViewer.MayGimbalLock}</div>`,s.rotate(s.HALF_PI,he));try{let $=[];for(let M=0,Z=X.length;M<Z;M++)$.push([]);for(let M=0,Z=_e.length;M<Z;M++){var ie,se;let H=null!==(ie=_e[M].x)&&void 0!==ie?ie:_e[M].v1,V=null!==(se=_e[M].y)&&void 0!==se?se:_e[M].v2;$[H].push(V),$[V].push(H)}let fe=4==ze.length,L=[{u:0,v:1},{u:1,v:1},{u:1,v:0},{u:0,v:0}];for(let Z,H,M=ze.length-1;M>=0;M--){var D,J,R;let V=ze[M].i,ne=null!==(D=X[V].x)&&void 0!==D?D:X[V].co[0],ue=null!==(J=X[V].y)&&void 0!==J?J:X[V].co[1],pe=null!==(R=X[V].z)&&void 0!==R?R:X[V].co[2];if(void 0!==H){try{if(!$[H].includes(V))throw"\ub9c8\uc9c0\ub9c9 \uc810\uc73c\ub85c\ubd80\ud130 \uadf8\ub9b4 \uc218 \uc5c6\uc74c";fe?s.vertex(-ne*U,-pe*U,ue*U,L[M].u,L[M].v):s.vertex(-ne*U,-pe*U,ue*U);let Xe=!1;if(H!=Z&&(Xe=$[V].includes(Z)),Xe)throw"\ub3cc\uc544\uac08 \uc218 \uc788\ub294\ub370 \ub3cc\uc544\uac00\uc9c0 \uc54a\ub294\ub2e4\uba74 \uc0c8 \uc2dc\uc791\uc810\uc73c\ub85c \uc778\uc2dd"}catch{s.endShape(s.CLOSE),H=void 0;continue}H=V}else s.beginShape(),fe?s.vertex(-ne*U,-pe*U,ue*U,L[M].u,L[M].v):s.vertex(-ne*U,-pe*U,ue*U),Z=V,H=V}}catch($){console.log("\uba54\uc26c \uc815\ubcf4 \ubd88\ub7ec\uc624\uae30 \uc624\ub958: ",$)}s.pop(),ce=s.endGeometry();let ge,He,Qe,Je=0;try{if(!b.data.mat.length)throw"no_mat";for(let $=0,fe=b.data.mat.length;$<fe;$++){try{let L=b.data.mat[$].nodetree.nodes.first.next.inputs.first.default_value.value;He=s.color(255*L[0],255*L[1],255*L[2],255*L[3])}catch(L){console.log("\ubca0\uc774\uc2a4 \uc0c9\uc0c1 \uac00\uc838\uc624\uae30 \uc2e4\ud328: ",L)}try{let L=b.data.mat[$].nodetree.nodes.first.next.inputs.last.prev.default_value.value;Je=b.data.mat[$].nodetree.nodes.first.next.inputs.last.default_value.value,Qe=s.color(255*L[0],255*L[1],255*L[2],255*L[3])}catch(L){console.log("\uc774\ubbf8\uc158 \uc815\ubcf4 \uc218\uc9d1 \uc2e4\ud328: ",L)}if(b.data.mat[$].nodetree.nodes.last.id){let L=b.data.mat[$].nodetree.nodes.last.id.packedfile;if(!L)throw"unpacked";if(T[L.data.__data_address__])throw"duplicated";ge=L.data.__data_address__;let Z=te.slice(ge,ge+L.size),H=new Blob([Z]),V=URL.createObjectURL(H);s.loadImage(V,ne=>{T[L.data.__data_address__]=ne,y.elt.innerHTML+=`<div style="color: var(--ion-color-danger-shade)">${b.aname}: ${e.lang.text.ContentViewer.OnWorkReadUV}</div>`,URL.revokeObjectURL(V)},ne=>{console.log("\ud14d\uc2a4\uccd0 \ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",ne),URL.revokeObjectURL(V)})}}}catch($){switch($){case"unpacked":y.elt.innerHTML+=`<div style="color: var(--ion-color-warning-shade)">${b.aname}: ${e.lang.text.ContentViewer.LinkedTexFile}</div>`;break;case"duplicated":break;case"no_mat":y.elt.innerHTML+=`<div style="color: var(--ion-color-medium-shade)">${b.aname}: ${e.lang.text.ContentViewer.NoMaterial}</div>`;break;default:console.log(b.aname,"_\uc7ac\uc9c8 \uc815\ubcf4 \ubd88\ub7ec\uc624\uae30 \uc624\ub958: ",$),y.elt.innerHTML+=`<div style="color: var(--ion-color-danger-shade)">${b.aname}: ${$}</div>`}}ce.computeNormals(),F.push({id:b.data.address,name:b.data.aname,color:He,emissionColor:Qe,emissionStrength:Je,texture:ge,mesh:ce})}break;case 10:h.length<5?(y.elt.innerHTML+=`<div style="color: var(--ion-color-warning-shade)">${b.aname}: ${e.lang.text.ContentViewer.OnWorkReadLightMode}</div>`,h.push({type:"point",loc:re,rot:he,color:s.color(255,255,255)})):y.elt.innerHTML+=`<div style="color: var(--ion-color-medium-shade)">${b.aname}: ${e.lang.text.ContentViewer.ReachLightLimit}</div>`;break;default:y.elt.innerHTML+=`<div style="color: var(--ion-color-medium-shade)>${b.aname}: ${e.lang.text.ContentViewer.OnWorkObjectType}_${b.type}</div>`}yield new Promise(ce=>setTimeout(ce,0))}I.dismiss(),setTimeout(()=>{y.elt.remove()},8e3)})}),s.draw=()=>{if(s.clear(255,255,255,0),s.orbitControl(),h.length)for(let v=0,P=h.length;v<P;v++)"point"===h[v].type&&s.pointLight(h[v].color,h[v].loc);else s.lights();for(let v=0,P=F.length;v<P;v++)s.push(),F[v].texture?(s.noStroke(),T[F[v].texture]&&s.texture(T[F[v].texture])):F[v].color&&(s.noStroke(),s.ambientMaterial(F[v].color)),F[v].emissionStrength&&(s.noStroke(),s.emissiveMaterial(F[v].emissionColor)),s.model(F[v].mesh),s.pop()},s.windowResized=()=>{setTimeout(()=>{n.style.maxHeight=window.innerHeight-56-45+"px",y&&y.style("max-height",`${n.clientHeight}px`),s.resizeCanvas(n.clientWidth,n.clientHeight)},50)}});break;default:console.log("\uc815\uc758\ub418\uc9c0 \uc54a\uc740 \ud30c\uc77c \uc815\ubcf4: ",e.FileInfo.viewer);case"disabled":e.p5canvas=new W(s=>{s.setup=()=>{s.noCanvas()}})}e.ContentOnLoad=!0,e.ChangeContentWithKeyInput()})()}ChangeContentWithKeyInput(){this.p5canvas&&(this.p5canvas.keyPressed=e=>{if(!this.isTextEditMode)switch(e.code){case"KeyA":case"ArrowLeft":this.ChangeToAnother(-1);break;case"KeyS":this.download_file();break;case"KeyD":case"ArrowRight":this.ChangeToAnother(1);break;case"KeyS":this.NeedDownloadFile&&this.DownloadCurrentFile()}})}open_bottom_modal(){this.ShowContentInfoIonic.onDidDismiss().then(e=>{this.useP5Navigator=!0}),this.useP5Navigator=!1,this.ShowContentInfoIonic.present()}open_text_editor(e=this.p5canvas.TextArea){e.disabled=!1,setTimeout(()=>{this.isTextEditMode=!0,e.focus()},500)}SaveText(){var e=this;return(0,_.c)(function*(){let n=new Blob([e.p5canvas.TextArea.value],{type:e.FileInfo.type});if(n.name=e.NewTextFileName||e.FileInfo.filename||e.FileInfo.name,e.OpenInChannelChat)e.modalCtrl.dismiss({type:"text",blob:n,contentRelated:e.FileInfo.content_related_creator});else{let c=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});c.present();let u=`tmp_files/texteditor/${e.FileInfo.filename||e.FileInfo.name}`;e.FileInfo.path||(e.FileInfo.path=u),yield e.indexed.saveBlobToUserPath(n,u,void 0,e.targetDB),c.dismiss(),e.p5toast.show({text:e.lang.text.ContentViewer.fileSaved}),e.modalCtrl.dismiss({type:"text",blob:n,path:u,index:e.RelevanceIndex-1})}})()}modify_image(){var e=this;return(0,_.c)(function*(){switch(e.FileInfo.viewer){case"image":{let c=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});c.present();try{let u;e.image_info.path=e.FileInfo.path||e.navParams.get("path"),e.FileInfo.url&&(e.image_info.path="tmp_files/modify_image.png",u=yield fetch(e.FileInfo.url).then(I=>I.blob()),yield e.indexed.saveBlobToUserPath(u,e.image_info.path)),e.modalCtrl.dismiss({type:"image",...e.image_info,path:e.image_info.path,msg:e.MessageInfo,index:e.RelevanceIndex-1})}catch(u){e.p5toast.show({text:`${e.lang.text.ContentViewer.CannotEditFile}: ${u}`})}c.dismiss()}break;case"text":let n=e.p5canvas.TextArea.textContent.split("\n");e.modalCtrl.dismiss({type:"image",text:n,msg:e.MessageInfo,index:e.RelevanceIndex-1});break;case"video":try{let c=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});c.present(),e.p5canvas.pixelDensity(1),e.p5canvas.VideoMedia.pause(),e.p5canvas.VideoMedia.size(e.image_info.width,e.image_info.height);let u=e.p5canvas.createCanvas(e.image_info.width,e.image_info.height);e.p5canvas.image(e.p5canvas.VideoMedia,0,0,e.p5canvas.width,e.p5canvas.height);let I=u.elt.toDataURL("image/png").replace("image/png","image/octet-stream");try{c.dismiss(),e.image_info.path="tmp_files/modify_image.png",yield e.indexed.saveBase64ToUserPath(I,e.image_info.path),e.modalCtrl.dismiss({type:"image",...e.image_info,msg:e.MessageInfo,index:e.RelevanceIndex-1})}catch(s){console.log("\ud30c\uc77c \uc800\uc7a5 \uc624\ub958: ",s)}}catch(c){console.log("\uc7ac\uc0dd\uc911\uc778 \ube44\ub514\uc624 \uc774\ubbf8\uc9c0 \ucd94\ucd9c \uc624\ub958: ",c)}break;case"blender":try{let c=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});c.present(),e.p5canvas.pixelDensity(1);let u=e.p5canvas.canvas.elt.toDataURL("image/png").replace("image/png","image/octet-stream");try{c.dismiss(),e.image_info.path="tmp_files/modify_image.png",e.image_info.width=e.p5canvas.width,e.image_info.height=e.p5canvas.height,yield e.indexed.saveBase64ToUserPath(u,e.image_info.path),e.modalCtrl.dismiss({type:"image",...e.image_info,msg:e.MessageInfo,index:e.RelevanceIndex-1})}catch(I){console.log("\ud30c\uc77c \uc800\uc7a5 \uc624\ub958: ",I)}}catch(c){console.log("\uc7ac\uc0dd\uc911\uc778 \ube44\ub514\uc624 \uc774\ubbf8\uc9c0 \ucd94\ucd9c \uc624\ub958: ",c)}break;case"godot":e.global.godot_window.modify_image();break;default:console.log("\ud3b8\uc9d1 \ubd88\uac00 \ud30c\uc77c \uc815\ubcf4: ",e.FileInfo)}})()}download_file(){var e=this;return(0,_.c)(function*(){if("DesktopPWA"==G.s1||"MobilePWA"==G.s1)if(e.FileInfo.url)try{let n=yield fetch(e.FileInfo.url),c=yield n.blob();if(!n.ok)throw"\uc81c\ub300\ub85c \ub2e4\uc6b4\ubc1b\uc544\uc9c0\uc9c0 \uc54a\uc74c";yield e.indexed.saveBlobToUserPath(c,e.FileInfo.path),e.indexed.DownloadFileFromUserPath(e.FileInfo.path,e.FileInfo.type,e.FileInfo.filename||e.FileInfo.name,e.targetDB)}catch(n){console.log("\ub2e4\uc6b4\ubc1b\uae30 \uc2e4\ud328: ",n),e.p5toast.show({text:`${e.lang.text.Nakama.FailedDownload}: ${n}`})}else e.indexed.DownloadFileFromUserPath(e.FileInfo.path,e.FileInfo.type,e.FileInfo.filename||e.FileInfo.name,e.targetDB);else e.alertCtrl.create({header:e.lang.text.ContentViewer.Filename,inputs:[{name:"filename",placeholder:e.FileInfo.filename||e.FileInfo.name,type:"text"}],buttons:[{text:e.lang.text.ContentViewer.saveFile,handler:(n=(0,_.c)(function*(c){if(e.FileInfo.url)try{let u=yield fetch(e.FileInfo.url),I=yield u.blob();if(!u.ok)throw"\uc81c\ub300\ub85c \ub2e4\uc6b4\ubc1b\uc544\uc9c0\uc9c0 \uc54a\uc74c";yield e.indexed.saveBlobToUserPath(I,e.FileInfo.path),e.DownloadFileAct(c)}catch(u){console.log("\ub2e4\uc6b4\ubc1b\uae30 \uc2e4\ud328: ",u),e.p5toast.show({text:`${e.lang.text.Nakama.FailedDownload}: ${u}`})}else e.DownloadFileAct(c)}),function(u){return n.apply(this,arguments)})}]}).then(n=>n.present());var n})()}DownloadFileAct(e){var n=this;return(0,_.c)(function*(){let c=yield n.loadingCtrl.create({message:n.lang.text.TodoDetail.WIP});c.present();let u=e.filename?e.filename.replace(/:|\?|\/|\\|<|>/g,""):n.FileInfo.filename||n.FileInfo.name,I=yield n.indexed.loadBlobFromUserPath(n.FileInfo.path,n.FileInfo.type,void 0,n.targetDB);n.forceWrite&&!e.filename?n.file.writeExistingFile(n.file.externalDataDirectory,u,I).then(s=>{n.forceWrite=!1,c.dismiss(),n.p5toast.show({text:`${n.lang.text.ContentViewer.OverWriteFile}: ${u}`})}):n.file.writeFile(n.file.externalDataDirectory,u,I).then(s=>{c.dismiss(),n.p5toast.show({text:n.lang.text.ContentViewer.fileSaved})}).catch(s=>{12===(c.dismiss(),s.code)?(n.p5toast.show({text:n.lang.text.ContentViewer.AlreadyExist}),n.forceWrite=!0,n.download_file()):console.log("\uc900\ube44\ub418\uc9c0 \uc54a\uc740 \uc624\ub958 \ubc18\ud658: ",s)})})()}toast_info(e){e.various_display||this.set_various_display(e),this.p5toast.show({text:e.various_display})}ShareContent(){let e=this.nakama.rearrange_channels();for(let n=e.length-1;n>=0;n--)("missing"==e[n].status||"offline"==e[n].status)&&e.splice(n,1);e.length?this.modalCtrl.create({component:Y._,componentProps:{file:this.FileInfo,channels:e}}).then(n=>{n.onDidDismiss().then(c=>{c.data&&this.modalCtrl.dismiss()}),n.present()}):this.p5toast.show({text:this.lang.text.ShareContentToOther.NoChannelToShare})}RemoveFile(){this.alertCtrl.create({header:this.lang.text.ContentViewer.RemoveFile,message:this.FileInfo.path,buttons:[{text:this.lang.text.TodoDetail.remove,handler:()=>{this.RemoveFileAct()},cssClass:"red_font"}]}).then(e=>e.present())}RemoveFileAct(){var e=this;return(0,_.c)(function*(){URL.revokeObjectURL(e.FileURL),delete e.FileInfo.thumbnail,delete e.FileInfo.text,yield e.indexed.removeFileFromUserPath(e.FileInfo.path,void 0,e.targetDB),e.RelevanceIndex-=1,e.ChangeToAnother(1)})()}ionViewWillLeave(){var e=this;return(0,_.c)(function*(){switch(document.removeEventListener("ionBackButton",e.EventListenerAct),e.FileInfo.viewer){case"video":try{let u,I,c=e.p5canvas.VideoMedia.size();c.width>c.height?(u=192,I=c.height/c.width*192):(u=c.width/c.height*192,I=192);let s=e.p5canvas.createCanvas(u,I);e.p5canvas.pixelDensity(1),e.p5canvas.imageMode(e.p5canvas.CORNER),e.p5canvas.image(e.p5canvas.VideoMedia,0,0,u,I),e.p5canvas.fill(255,128),e.p5canvas.rect(0,0,u,I),e.p5canvas.textWrap(e.p5canvas.CHAR),e.p5canvas.textSize(16);let h=I/16;e.p5canvas.push(),e.p5canvas.translate(h/6,h/6),e.p5canvas.fill(0),e.p5canvas.text(e.FileInfo.filename||e.FileInfo.name,h,h,u-2*h,I-2*h),e.p5canvas.filter(e.p5canvas.BLUR,3),e.p5canvas.pop(),e.p5canvas.fill(255),e.p5canvas.text(e.FileInfo.filename||e.FileInfo.name,h,h,u-2*h,I-2*h);let F=s.elt.toDataURL("image/png").replace("image/png","image/octet-stream");try{yield e.indexed.saveBase64ToUserPath(F,`${e.FileInfo.path}_thumbnail.png`,void 0,e.targetDB),e.FileInfo.thumbnail=F,e.global.modulate_thumbnail(e.FileInfo,""),e.p5canvas&&e.p5canvas.remove()}catch(k){console.log("\uc378\ub124\uc77c \uc800\uc7a5 \uc624\ub958: ",k)}}catch(c){console.log("\ube44\ub514\uc624 \uc378\ub124\uc77c \uc0dd\uc131 \ucde8\uc18c: ",c)}break;case"godot":try{e.global.godot_window.filename=e.FileInfo.filename||e.FileInfo.name,e.global.godot_window.create_thumbnail(e.FileInfo),(yield e.indexed.GetFileListFromDB("tmp_files",void 0,e.indexed.godotDB)).forEach(u=>e.indexed.removeFileFromUserPath(u,void 0,e.indexed.godotDB)),e.p5canvas&&e.p5canvas.remove()}catch(c){console.log("godot \uc378\ub124\uc77c \uc800\uc7a5 \uc624\ub958: ",c)}break;case"blender":let n=e.p5canvas.canvas.elt.toDataURL("image/png").replace("image/png","image/octet-stream");try{new W(c=>{c.setup=()=>{c.loadImage(n,function(){var u=(0,_.c)(function*(I){let s,h;I.width>I.height?(s=192,h=I.height/I.width*192):(s=I.width/I.height*192,h=192);let F=c.createCanvas(s,h);c.pixelDensity(1),c.imageMode(c.CORNER),c.image(I,0,0,c.width,c.height),c.fill(255,128),c.rect(0,0,s,h),c.textWrap(c.CHAR),c.textSize(16);let k=h/16;c.push(),c.translate(k/6,k/6),c.fill(0),c.text(e.FileInfo.filename||e.FileInfo.name,k,k,s-2*k,h-2*k),c.filter(c.BLUR,3),c.pop(),c.fill(255),c.text(e.FileInfo.filename||e.FileInfo.name,k,k,s-2*k,h-2*k);let T=F.elt.toDataURL("image/png").replace("image/png","image/octet-stream");yield e.indexed.saveBase64ToUserPath(T,`${e.FileInfo.path}_thumbnail.png`,void 0,e.targetDB),e.FileInfo.thumbnail=T,e.global.modulate_thumbnail(e.FileInfo,""),c.remove(),e.p5canvas&&e.p5canvas.remove()});return function(I){return u.apply(this,arguments)}}(),u=>{console.log("\ube14\ub80c\ub354 \uc378\ub124\uc77c \ubc30\uacbd \ubc1b\uc544\uc624\uae30 \uc624\ub958: ",u),c.remove(),e.p5canvas&&e.p5canvas.remove()})}})}catch(c){console.log("blender \uc378\ub124\uc77c \uc800\uc7a5 \uc624\ub958: ",c)}break;default:e.p5canvas&&e.p5canvas.remove()}URL.revokeObjectURL(e.FileURL);try{(yield e.file.checkFile(e.file.externalDataDirectory,`viewer_tmp.${e.FileInfo.file_ext}`))&&(yield e.file.removeFile(e.file.externalDataDirectory,`viewer_tmp.${e.FileInfo.file_ext}`))}catch{}})()}copy_url(e){this.mClipboard.copy(e).catch(n=>de.c.write(e))}}return(l=g).\u0275fac=function(e){return new(e||l)(t.GI1(E.qS),t.GI1(i.a6),t.GI1(A.k),t.GI1(ae.o),t.GI1(N.S),t.GI1(Q.O),t.GI1(E.iW),t.GI1(E.Kg),t.GI1(B.A1),t.GI1(S.h),t.GI1(z._),t.GI1(q.s))},l.\u0275cmp=t.In1({type:l,selectors:[["app-ionic-viewer"]],viewQuery:function(e,n){if(1&e&&t.CC$(me,5),2&e){let c;t.wto(c=t.Gqi())&&(n.ShowContentInfoIonic=c.first)}},decls:29,vars:18,consts:[[1,"ion-no-border"],["id","Toolbar"],["slot","start",3,"click"],["defaultHref",""],["class","relevance_change","style","padding-right: 16px;","slot","end","name","pause-circle",3,"click",4,"ngIf"],["class","relevance_change","style","padding-right: 16px;","slot","end","name","play-circle",3,"click",4,"ngIf"],["class","relevance_change","style","padding-right: 4px;","slot","end","name","arrow-back-circle-outline",3,"click",4,"ngIf"],["slot","end",4,"ngIf"],["class","relevance_change","style","padding-right: 16px; padding-left: 4px;","slot","end","name","arrow-forward-circle-outline",3,"click",4,"ngIf"],["id","ContentBox"],[1,"main_table_elt"],[2,"height","0"],["id","FileHeader",2,"max-width","100vw"],["text-wrap","","style","overflow-x: auto;",4,"ngIf"],["type","text","text-warp","","style","overflow-x: auto; overflow-y: hidden;",3,"ngModel","placeholder","ngModelChange",4,"ngIf"],[3,"click",4,"ngIf"],["class","ion-align-items-center",3,"disabled","click",4,"ngIf"],["id","menu_trigger",4,"ngIf"],["trigger","menu_trigger","dismissOnSelect","",4,"ngIf"],[4,"ngIf"],[3,"initialBreakpoint","breakpoints"],["ShowContentInfoIonic",""],["slot","end","name","pause-circle",1,"relevance_change",2,"padding-right","16px",3,"click"],["slot","end","name","play-circle",1,"relevance_change",2,"padding-right","16px",3,"click"],["slot","end","name","arrow-back-circle-outline",1,"relevance_change",2,"padding-right","4px",3,"click"],["slot","end"],["slot","end","name","arrow-forward-circle-outline",1,"relevance_change",2,"padding-right","16px","padding-left","4px",3,"click"],["text-wrap","",2,"overflow-x","auto"],["type","text","text-warp","",2,"overflow-x","auto","overflow-y","hidden",3,"ngModel","placeholder","ngModelChange"],[3,"click"],["name","close-circle-outline"],["name","save-outline"],[1,"ion-align-items-center",3,"disabled","click"],["name","code-download-outline"],["id","menu_trigger"],["name","ellipsis-vertical"],["trigger","menu_trigger","dismissOnSelect",""],["button","",3,"click",4,"ngIf"],["button","",3,"click"],["id","content_viewer_canvas",1,"full_screen",2,"max-width","100vw"],[1,"disconnect_info"],["color","medium","name","attach-outline",2,"width","60px","height","60px"],["color","medium"],[1,"ion-align-items-center"],["size","12",1,"ion-text-center"],["color","warning","shape","round",1,"ion-align-items-center",3,"disabled","click"],["button","",4,"ngIf"],[1,"ion-text-end"],[4,"ngFor","ngForOf"],[1,"ion-text-center"],["button",""],[1,"history_center"],["color","secondary","mode","ios","outline","true",3,"click"],["name","document-attach-outline",4,"ngIf"],["name","camera-outline",4,"ngIf"],["name","link-outline",4,"ngIf"],["name","text-outline",4,"ngIf"],["name","document-text-outline",4,"ngIf"],["name","share-social-outline",4,"ngIf"],["name","document-attach-outline"],["name","camera-outline"],["name","link-outline"],["name","text-outline"],["name","document-text-outline"],["name","share-social-outline"],["src","assets/icon/voidDraw.png"]],template:function(e,n){1&e&&(t.I0R(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-title"),t.OEk(3),t.C$Y(),t.I0R(4,"ion-buttons",2),t.qCj("click",function(){return n.modalCtrl.dismiss()}),t.wR5(5,"ion-back-button",3),t.C$Y(),t.yuY(6,xe,1,0,"ion-icon",4)(7,Ie,1,0,"ion-icon",5)(8,ye,1,0,"ion-icon",6)(9,Ce,2,1,"ion-label",7)(10,be,1,0,"ion-icon",8),t.C$Y()(),t.I0R(11,"ion-content",9)(12,"table",10)(13,"tr",11)(14,"td")(15,"ion-list-header",12),t.yuY(16,Fe,2,1,"ion-label",13)(17,we,1,2,"ion-input",14)(18,De,2,0,"ion-button",15)(19,Te,2,0,"ion-button",15)(20,ke,2,1,"ion-button",16)(21,Oe,2,0,"ion-button",17)(22,Le,2,0,"ion-popover",18),t.C$Y()()(),t.I0R(23,"tr"),t.yuY(24,$e,3,1,"td",19)(25,Me,6,2,"td",19),t.C$Y()(),t.I0R(26,"ion-modal",20,21),t.yuY(28,a,19,9,"ng-template"),t.C$Y()()),2&e&&(t.yG2(3),t.cNF(n.lang.text.ContentViewer.Title),t.yG2(3),t.E7m("ngIf",("video"==n.FileInfo.viewer||"audio"==n.FileInfo.viewer)&&n.AutoPlayNext),t.yG2(),t.E7m("ngIf",("video"==n.FileInfo.viewer||"audio"==n.FileInfo.viewer)&&!n.AutoPlayNext),t.yG2(),t.E7m("ngIf",n.HaveRelevances),t.yG2(),t.E7m("ngIf",n.HaveRelevances),t.yG2(),t.E7m("ngIf",n.HaveRelevances),t.yG2(6),t.E7m("ngIf",!n.isTextEditMode),t.yG2(),t.E7m("ngIf",n.isTextEditMode),t.yG2(),t.E7m("ngIf",n.isTextEditMode),t.yG2(),t.E7m("ngIf",n.isTextEditMode),t.yG2(),t.E7m("ngIf",n.isChannelOnline&&n.HaveRelevances&&!n.isTextEditMode&&!n.fromLocalChannel),t.yG2(),t.E7m("ngIf",!n.isTextEditMode),t.yG2(),t.E7m("ngIf",!n.isTextEditMode),t.yG2(2),t.E7m("ngIf",!n.NeedDownloadFile),t.yG2(),t.E7m("ngIf",n.NeedDownloadFile),t.yG2(),t.E7m("initialBreakpoint",.5)("breakpoints",t.q4q(17,d)))},dependencies:[ee.ay,ee.u_,le.ue,le._G,E.O7,E.sn,E.GS,E.cz,E.Kk,E._i,E.YP,E.wB,E.Ko,E.A5,E.Yb,E.S8,E.QR,E.OC,E.zz,E.qo,E.tM,E.Md,E.yc,E.sW,E.qG,E.Im],styles:[".main_table_elt[_ngcontent-%COMP%]{width:100%;height:100%;border:0;margin:0}.relevance_change[_ngcontent-%COMP%]{width:25px;height:25px}.history_center[_ngcontent-%COMP%]{text-align:center}"]}),g})()},896:(ve,oe,x)=>{x.d(oe,{_:()=>ae});var _=x(4496),G=x(4500),W=x(9240),K=x(5624),Y=x(4180),de=x(7136),t=x(1368);function E(N,Q){1&N&&_.wR5(0,"div",12)}function i(N,Q){if(1&N&&_.wR5(0,"img",13),2&N){const B=_.GaO().$implicit;_.m_g("online"==B.status||3==B.redirect.type&&"pending"==B.status?"filter: grayscale(0) contrast(1)":"filter: grayscale(.9) contrast(1.4)"),_.E7m("src",B.info.img,_.K6U)}}function A(N,Q){if(1&N){const B=_.KQA();_.I0R(0,"ion-item",4),_.qCj("click",function(){const q=_.usT(B).$implicit,ee=_.GaO();return _.CGJ(ee.go_to_chatroom(q))}),_.I0R(1,"div",5),_.yuY(2,E,1,0,"div",6),_.C$Y(),_.I0R(3,"div",7),_.yuY(4,i,1,3,"img",8),_.C$Y(),_.I0R(5,"ion-label")(6,"div",9)(7,"table")(8,"tr")(9,"td"),_.OEk(10),_.C$Y(),_.I0R(11,"td",10),_.OEk(12),_.C$Y()()()(),_.I0R(13,"div",11),_.OEk(14),_.C$Y()()()}if(2&N){const B=Q.$implicit,S=_.GaO();_.yG2(),_.m_g("background-color: "+S.statusBar.colors[B.status||"offline"]),_.yG2(),_.E7m("ngIf",B.is_new),_.yG2(2),_.E7m("ngIf",B.info),_.yG2(6),_.oRS(" ",B.info?B.info.name||B.info.display_name||S.lang.text.ChatRoom.noname_chatroom:B.title||S.lang.text.ChatRoom.noname_chatroom," "),_.yG2(2),_.oRS(" ","("+B.server.target+")"," "),_.yG2(2),_.oRS(" ",B.last_comment||B.noti||S.lang.text.Subscribes.noMessageHistory," ")}}let ae=(()=>{var N;class Q{constructor(S,z,q,ee,le){this.lang=S,this.navParams=z,this.modalCtrl=q,this.statusBar=ee,this.nakama=le,this.BackButtonPressed=!1}InitBrowserBackButtonOverride(){window.history.replaceState(null,null,window.location.href),window.onpopstate=()=>{this.BackButtonPressed||(this.BackButtonPressed=!0,this.modalCtrl.dismiss())}}ngOnInit(){this.InitBrowserBackButtonOverride(),this.channels=this.navParams.get("channels")}go_to_chatroom(S){let z=this.navParams.get("file");delete z.db,this.nakama.go_to_chatroom_without_admob_act(S,z),this.modalCtrl.dismiss(!0)}}return(N=Q).\u0275fac=function(S){return new(S||N)(_.GI1(G.o),_.GI1(W.a6),_.GI1(K.qS),_.GI1(Y.Y),_.GI1(de.h))},N.\u0275cmp=_.In1({type:N,selectors:[["app-share-content-to-other"]],decls:11,vars:3,consts:[[1,"ion-no-border"],["slot","start",3,"click"],["defaultHref",""],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"],[1,"additional_form","status_bar_double"],["class","new_circle",4,"ngIf"],[1,"additional_form","bg_img_form"],["class","profile_img",3,"style","src",4,"ngIf"],[1,"form_margin","header"],[1,"server_target"],[1,"form_margin","content"],[1,"new_circle"],[1,"profile_img",3,"src"]],template:function(S,z){1&S&&(_.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),_.OEk(3),_.C$Y(),_.I0R(4,"ion-buttons",1),_.qCj("click",function(){return z.modalCtrl.dismiss()}),_.wR5(5,"ion-back-button",2),_.C$Y()()(),_.I0R(6,"ion-content")(7,"ion-item-divider")(8,"ion-label"),_.OEk(9),_.C$Y()(),_.yuY(10,A,15,7,"ion-item",3),_.C$Y()),2&S&&(_.yG2(3),_.cNF(z.lang.text.ShareContentToOther.Title),_.yG2(6),_.cNF(z.lang.text.ShareContentToOther.AvailableChannels),_.yG2(),_.E7m("ngForOf",z.channels))},dependencies:[t.ay,t.u_,K.GS,K._i,K.wB,K.Yb,K.S8,K.QR,K.tM,K.Md,K.Im],styles:[".server_target[_ngcontent-%COMP%]{color:#888;padding-left:4px}.content[_ngcontent-%COMP%]{color:#888;height:24px;display:table-cell;vertical-align:middle;padding:0 16px}"]}),Q})()},7048:(ve,oe,x)=>{x.d(oe,{w:()=>Ke});var _=x(1528),G=x(5193),W=x(8744),K=x(6400);x(5404);const de=(0,K.C_)("Filesystem",{web:()=>x.e(7688).then(x.bind(x,7688)).then(p=>new p.FilesystemWeb)});var t=x(9352),E=x(1052),i=x(4496),A=x(5624),ae=x(9240),N=x(4668),Q=x(4500),B=x(5020),S=x(3824),z=x(4476),q=x(544),ee=x(6819),le=x(7136),me=x(1368);const xe=["FileSel"];function Ie(p,O){if(1&p){const m=i.KQA();i.I0R(0,"ion-icon",8),i.qCj("click",function(){i.usT(m);const a=i.GaO();return i.CGJ(a.toggle_thumbnail())}),i.C$Y()}}function ye(p,O){if(1&p){const m=i.KQA();i.I0R(0,"ion-icon",9),i.qCj("click",function(){i.usT(m);const a=i.GaO();return i.CGJ(a.toggle_thumbnail())}),i.C$Y()}}function Ce(p,O){if(1&p){const m=i.KQA();i.I0R(0,"div")(1,"ion-item",18),i.qCj("click",function(){i.usT(m);const a=i.GaO(2);return i.CGJ(a.SelectImportFolder())}),i.wR5(2,"ion-icon",19),i.I0R(3,"ion-label"),i.OEk(4),i.C$Y()(),i.I0R(5,"input",20),i.qCj("change",function(a){i.usT(m);const d=i.GaO(2);return i.CGJ(d.inputImageSelected(a))}),i.C$Y()()}if(2&p){const m=i.GaO(2);i.yG2(4),i.oRS(" ",m.lang.text.UserFsDir.ImportFolder," ")}}function be(p,O){if(1&p){const m=i.KQA();i.I0R(0,"ion-button",13),i.qCj("click",function(){i.usT(m);const a=i.GaO(2);return i.CGJ(a.ExportDirectoryRecursive())}),i.OEk(1),i.C$Y()}if(2&p){const m=i.GaO(2);i.yG2(),i.oRS(" ",m.lang.text.UserFsDir.ExportDir," ")}}function Fe(p,O){if(1&p){const m=i.KQA();i.I0R(0,"ion-item",18),i.qCj("click",function(){i.usT(m);const a=i.GaO(2);return i.CGJ(a.MoveToUpDir())}),i.wR5(1,"ion-icon",11),i.I0R(2,"ion-label"),i.OEk(3,".."),i.C$Y()()}}function we(p,O){if(1&p){const m=i.KQA();i.I0R(0,"ion-item",18),i.qCj("click",function(){i.usT(m);const a=i.GaO().$implicit,d=i.GaO(2);return i.CGJ(d.SelectFolder(a))}),i.wR5(1,"ion-icon",11),i.I0R(2,"ion-label"),i.OEk(3),i.C$Y()()}if(2&p){const m=i.GaO().$implicit;i.yG2(3),i.cNF(m.name)}}function De(p,O){if(1&p&&(i.I0R(0,"div"),i.yuY(1,we,4,1,"ion-item",15),i.C$Y()),2&p){const m=O.$implicit,o=i.GaO(2);i.yG2(),i.E7m("ngIf",o.CurrentDir==m.dir)}}function Te(p,O){1&p&&i.wR5(0,"ion-icon",36)}function ke(p,O){1&p&&i.wR5(0,"ion-icon",37)}function Oe(p,O){1&p&&i.wR5(0,"ion-icon",38)}function Pe(p,O){1&p&&i.wR5(0,"ion-icon",39)}function Re(p,O){1&p&&i.wR5(0,"ion-icon",40)}function Ee(p,O){1&p&&i.wR5(0,"ion-icon",41)}function Ge(p,O){if(1&p&&(i.I0R(0,"ion-label",42),i.OEk(1),i.C$Y()),2&p){const m=i.GaO(2).$implicit;i.yG2(),i.cNF(m.name)}}function Ue(p,O){if(1&p&&(i.I0R(0,"ion-label"),i.OEk(1),i.C$Y()),2&p){const m=i.GaO(2).$implicit;i.yG2(),i.cNF(m.name)}}function Be(p,O){if(1&p){const m=i.KQA();i.I0R(0,"ion-button",43),i.qCj("click",function(){i.usT(m);const a=i.GaO(2).$implicit,d=i.GaO(2);return i.CGJ(d.OpenFile(a))}),i.OEk(1),i.C$Y()}if(2&p){const m=i.GaO(4);i.yG2(),i.oRS(" ",m.lang.text.UserFsDir.Open," ")}}function Le(p,O){if(1&p){const m=i.KQA();i.I0R(0,"ion-button",43),i.qCj("click",function(){i.usT(m);const a=i.GaO(2).$implicit,d=i.GaO(2);return i.CGJ(d.dismiss_page(a))}),i.OEk(1),i.C$Y()}if(2&p){const m=i.GaO(4);i.yG2(),i.oRS(" ",m.lang.text.UserFsDir.Select," ")}}function Ae(p,O){if(1&p){const m=i.KQA();i.I0R(0,"ion-button",43),i.qCj("click",function(){i.usT(m);const a=i.GaO(2).$implicit,d=i.GaO(2);return i.CGJ(d.DownloadFile(a))}),i.OEk(1),i.C$Y()}if(2&p){const m=i.GaO(4);i.yG2(),i.oRS(" ",m.lang.text.UserFsDir.Download," ")}}function $e(p,O){if(1&p){const m=i.KQA();i.I0R(0,"div",44),i.qCj("click",function(){i.usT(m);const a=i.GaO(2).$implicit,d=i.GaO(2);return i.CGJ(d.OpenFile(a))}),i.wR5(1,"img",45),i.C$Y()}if(2&p){const m=i.GaO(2).$implicit,o=i.GaO(2);i.yG2(),i.m_g(o.HideThumbnail?"filter: blur(6px);":""),i.E7m("src",m.thumbnail,i.K6U)("alt",m.name)}}function Me(p,O){if(1&p){const m=i.KQA();i.I0R(0,"ion-accordion",22)(1,"ion-item",23),i.yuY(2,Te,1,0,"ion-icon",24)(3,ke,1,0,"ion-icon",25)(4,Oe,1,0,"ion-icon",26)(5,Pe,1,0,"ion-icon",27)(6,Re,1,0,"ion-icon",28)(7,Ee,1,0,"ion-icon",29)(8,Ge,2,1,"ion-label",30)(9,Ue,2,1,"ion-label",7),i.wR5(10,"ion-icon",31),i.C$Y(),i.I0R(11,"div",32)(12,"ion-item",10)(13,"ion-label"),i.OEk(14),i.C$Y(),i.yuY(15,Be,2,1,"ion-button",33)(16,Le,2,1,"ion-button",33)(17,Ae,2,1,"ion-button",33),i.I0R(18,"ion-button",34),i.qCj("click",function(){i.usT(m);const a=i.GaO(),d=a.$implicit,f=a.index,l=i.GaO(2);return i.CGJ(l.RemoveFile(d,f))}),i.OEk(19),i.C$Y()(),i.yuY(20,$e,2,4,"div",35),i.C$Y()()}if(2&p){const m=i.GaO().$implicit;i.GaO();const o=i.Gew(17),a=i.GaO();i.E7m("value",m.path),i.yG2(2),i.E7m("ngIf","image"==m.viewer),i.yG2(),i.E7m("ngIf","audio"==m.viewer),i.yG2(),i.E7m("ngIf","video"==m.viewer),i.yG2(),i.E7m("ngIf","text"==m.viewer),i.yG2(),i.E7m("ngIf","godot"==m.viewer),i.yG2(),i.E7m("ngIf","disabled"==m.viewer),i.yG2(),i.E7m("ngIf",o.value==m.path),i.yG2(),i.E7m("ngIf",o.value!=m.path),i.yG2(5),i.cNF(a.lang.text.UserFsDir.Action),i.yG2(),i.E7m("ngIf","image"!=m.viewer),i.yG2(),i.E7m("ngIf",a.is_file_selector),i.yG2(),i.E7m("ngIf",a.cant_dedicated&&!a.is_file_selector),i.yG2(2),i.oRS(" ",a.lang.text.UserFsDir.Delete," "),i.yG2(),i.E7m("ngIf","image"==m.viewer)}}function Se(p,O){if(1&p&&(i.I0R(0,"div"),i.yuY(1,Me,21,15,"ion-accordion",21),i.C$Y()),2&p){const m=O.$implicit,o=i.GaO(2);i.yG2(),i.E7m("ngIf",o.CurrentDir==m.dir||o.is_file_selector)}}function Ve(p,O){if(1&p){const m=i.KQA();i.I0R(0,"ion-list"),i.yuY(1,Ce,6,1,"div",7),i.I0R(2,"div")(3,"ion-item",10),i.wR5(4,"ion-icon",11),i.I0R(5,"ion-label"),i.OEk(6,"."),i.C$Y(),i.yuY(7,be,2,1,"ion-button",12),i.I0R(8,"ion-button",13),i.qCj("click",function(){i.usT(m);const a=i.GaO();return i.CGJ(a.CreateNewFolder())}),i.OEk(9),i.C$Y(),i.I0R(10,"ion-button",13),i.qCj("click",function(){i.usT(m);const a=i.GaO();return i.CGJ(a.SelectFiles())}),i.OEk(11),i.C$Y(),i.I0R(12,"ion-button",14),i.qCj("click",function(){i.usT(m);const a=i.GaO();return i.CGJ(a.RemoveDirectoryRecursive())}),i.OEk(13),i.C$Y()(),i.yuY(14,Fe,4,0,"ion-item",15),i.C$Y(),i.yuY(15,De,2,1,"div",16),i.I0R(16,"ion-accordion-group",null,17),i.yuY(18,Se,2,1,"div",16),i.C$Y()()}if(2&p){const m=i.GaO();i.yG2(),i.E7m("ngIf",""==m.CurrentDir&&!m.is_file_selector&&m.CanImportFolder),i.yG2(6),i.E7m("ngIf",!m.cant_dedicated),i.yG2(2),i.oRS(" ",m.lang.text.UserFsDir.NewFolder," "),i.yG2(2),i.oRS(" ",m.lang.text.UserFsDir.AddFile," "),i.yG2(2),i.oRS(" ",m.lang.text.UserFsDir.RemoveCurrentDir," "),i.yG2(),i.E7m("ngIf",""!=m.CurrentDir),i.yG2(),i.E7m("ngForOf",m.DirList),i.yG2(3),i.E7m("ngForOf",m.FileList)}}function Ye(p,O){if(1&p){const m=i.KQA();i.I0R(0,"ion-item",18),i.qCj("click",function(){i.usT(m);const a=i.GaO().$implicit,d=i.GaO(2);return i.CGJ(d.importFolderMiddleAct(a))}),i.wR5(1,"ion-icon",11),i.I0R(2,"ion-label"),i.OEk(3),i.C$Y()()}if(2&p){const m=i.GaO().$implicit;i.yG2(3),i.cNF(m.name)}}function Ne(p,O){if(1&p&&(i.I0R(0,"ion-item",48),i.wR5(1,"ion-icon",41),i.I0R(2,"ion-label"),i.OEk(3),i.C$Y()()),2&p){const m=i.GaO().$implicit;i.yG2(3),i.cNF(m.name)}}function je(p,O){if(1&p&&(i.I0R(0,"div"),i.yuY(1,Ye,4,1,"ion-item",15)(2,Ne,4,1,"ion-item",47),i.C$Y()),2&p){const m=O.$implicit;i.yG2(),i.E7m("ngIf",m.isDirectory),i.yG2(),i.E7m("ngIf",m.isFile)}}function We(p,O){if(1&p){const m=i.KQA();i.I0R(0,"ion-list")(1,"ion-item",18),i.qCj("click",function(){i.usT(m);const a=i.GaO();return i.CGJ(a.InAppBrowser=!0)}),i.wR5(2,"ion-icon",11),i.I0R(3,"ion-label",46),i.OEk(4,"/sdcard/Android/data/org.pjcone.portal/files"),i.C$Y()(),i.yuY(5,je,3,2,"div",16),i.C$Y()}if(2&p){const m=i.GaO();i.yG2(5),i.E7m("ngForOf",m.ExternalFolder)}}let Ke=(()=>{var p;class O{constructor(o,a,d,f,l,g,r,e,n,c,u,I,s){this.modalCtrl=o,this.indexed=a,this.loadingCtrl=d,this.lang=f,this.global=l,this.p5toast=g,this.alertCtrl=r,this.sanitizer=e,this.file=n,this.navCtrl=c,this.noti=u,this.navParams=I,this.nakama=s,this.DirList=[],this.FileList=[],this.cant_dedicated=!1,this.InAppBrowser=!0,this.is_ready=!1,this.is_file_selector=!1,this.HideThumbnail=!1,this.CanImportFolder=!0,this.BackButtonPressed=!1,this.StopIndexing=!1,this.EventListenerAct=h=>{h.detail.register(110,F=>{this.is_ready?""==this.CurrentDir?F():this.MoveToUpDir():(this.initLoadingElement.dismiss(),this.is_ready=!0)})},this.isCreateFolderRecursive=!1,this.ExternalFolder=[]}toggle_thumbnail(){this.HideThumbnail=!this.HideThumbnail,localStorage.setItem("user-fs-thumbnail",this.HideThumbnail?"1":"0")}InitBrowserBackButtonOverride(){window.history.pushState(null,null,window.location.href),window.onpopstate=()=>{this.BackButtonPressed||(this.BackButtonPressed=!0,this.navCtrl.back())}}ngOnInit(){this.InitBrowserBackButtonOverride(),"DesktopPWA"==G.s1&&setTimeout(()=>{this.CreateDrop()},0),this.CanImportFolder="MobilePWA"!=G.s1}ionViewDidEnter(){this.global.p5key.KeyShortCut.Escape=()=>{this.is_ready?""==this.CurrentDir?this.navCtrl.pop():this.MoveToUpDir():(this.initLoadingElement.dismiss(),this.is_ready=!0)}}CreateDrop(){var o=this;let a=document.getElementById("p5Drop_userfs");this.p5canvas=new t(d=>{d.setup=()=>{let e=d.createCanvas(a.clientWidth,a.clientHeight);e.parent(a),d.pixelDensity(1),e.drop(n=>{let c=d.millis();g<c-400?(l=!1,r.length=0,r.push(n)):(l=!0,r.push(n)),g=c,clearTimeout(f),f=setTimeout((0,_.c)(function*(){if(l)o.MultipleDrops(r);else{let u=yield o.loadingCtrl.create({message:o.lang.text.TodoDetail.WIP});u.present(),o.importSelected(n.file),u.dismiss()}}),400)})};let f,l=!1,g=0,r=[];d.mouseMoved=e=>{e.dataTransfer?(a.style.pointerEvents="all",a.style.backgroundColor="#0008"):(a.style.pointerEvents="none",a.style.backgroundColor="transparent")}})}CreateNewFolder(){var a,o=this;this.alertCtrl.create({header:this.lang.text.UserFsDir.CreateFolder,inputs:[{type:"text",placeholder:this.lang.text.UserFsDir.FolderName}],buttons:[{text:this.lang.text.UserFsDir.Create,handler:(a=(0,_.c)(function*(d){if(d[0])try{let f=`${o.CurrentDir}/${d[0]}`;yield o.indexed.createDirectory(f);let l=yield o.indexed.GetFileInfoFromDB(f),g={path:f,mode:l.mode,timestamp:l.timestamp,db:o.indexed.ionicDB};g.name=d[0],g.dir=o.CurrentDir,o.DirList.push(g)}catch(f){console.error("\ud3f4\ub354 \uc0dd\uc131 \uc2e4\ud328: ",f),o.p5toast.show({text:`${o.lang.text.UserFsDir.FailedToCreateFolder}: ${f}`})}else o.p5toast.show({text:o.lang.text.UserFsDir.NeedFolderName})}),function(f){return a.apply(this,arguments)})}]}).then(a=>a.present())}SelectFiles(){document.getElementById("import_file").click()}MultipleDrops(o){var a=this;return(0,_.c)(function*(){let d=yield a.loadingCtrl.create({message:a.lang.text.TodoDetail.WIP});d.present();for(let f=0,l=o.length;f<l;f++)yield a.importSelected(o[f].file);d.dismiss()})()}inputFileSelected(o){var a=this;return(0,_.c)(function*(){if(o.target.files.length)if(1!=o.target.files.length){let f=yield a.loadingCtrl.create({message:a.lang.text.UserFsDir.MultipleSave});f.present(),a.noti.noti.schedule({id:4,title:a.lang.text.UserFsDir.MultipleSave,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://diychat",color:"b0b0b0"});for(let l=0,g=o.target.files.length;l<g;l++)f.message=`${a.lang.text.UserFsDir.MultipleSave}: ${g-l}`,a.noti.noti.schedule({id:4,title:a.lang.text.UserFsDir.MultipleSave,progressBar:{value:l,maxValue:g},sound:null,smallIcon:"res://diychat",color:"b0b0b0"}),yield a.importSelected(o.target.files[l]);a.noti.ClearNoti(4),f.dismiss()}else{let f=yield a.loadingCtrl.create({message:a.lang.text.TodoDetail.WIP});f.present(),yield a.importSelected(o.target.files[0]),f.dismiss()}})()}importSelected(o){var a=this;return(0,_.c)(function*(){try{let d=`${a.CurrentDir}/${o.name}`;yield a.indexed.saveBlobToUserPath(o,d);let f=yield a.indexed.GetFileInfoFromDB(d),l={path:d,mode:f.mode,timestamp:f.timestamp,db:a.indexed.ionicDB};l.name=o.name,l.dir=a.CurrentDir,l.file_ext=l.name.split(".").pop(),a.global.set_viewer_category_from_ext(l),"image"==l.viewer&&a.indexed.loadBlobFromUserPath(l.path,"",g=>{let r=URL.createObjectURL(g);l.thumbnail=a.sanitizer.bypassSecurityTrustUrl(r)});try{let g=l.path.split("/");if(5!=g.length||"groups"!=g[3])throw"\uadf8\ub8f9 \uc774\ubbf8\uc9c0 \ud30c\uc77c\uc774 \uc544\ub2d8";a.SetDisplayGroupImageName(l,g)}catch{}for(let g=0,r=a.FileList.length;g<r;g++)if(a.FileList[g].path==d){a.FileList.splice(g,1);break}a.FileList.push(l)}catch(d){console.log("importSelected error: ",d)}})()}ionViewWillEnter(){this.HideThumbnail="1"==localStorage.getItem("user-fs-thumbnail"),this.CurrentDir="",this.is_file_selector=!!this.navParams.data.modal,this.LoadAllIndexedFiles(),("DesktopPWA"==G.s1||"MobilePWA"==G.s1)&&(this.cant_dedicated=!0),document.addEventListener("ionBackButton",this.EventListenerAct)}dismiss_page(o){var a=this;return(0,_.c)(function*(){if(a.is_file_selector){let d;o&&(d=yield a.indexed.loadBlobFromUserPath(o.path,""),d.name=o.name,d.file_ext=o.file_ext),a.modalCtrl.dismiss(d)}})()}LoadAllIndexedFiles(){var o=this;return(0,_.c)(function*(){if(o.initLoadingElement=yield o.loadingCtrl.create({message:o.lang.text.UserFsDir.LoadingExplorer}),o.initLoadingElement.present(),o.DirList.length=0,o.FileList.length=0,("Android"==G.s1||"iOS"==G.s1)&&o.noti.noti.schedule({id:5,title:o.lang.text.UserFsDir.LoadingExplorer,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"}),o.is_file_selector)if(o.navParams.get("path")){let a=yield o.indexed.GetFileListFromDB(o.navParams.get("path"));yield o.ModulateIndexedFile(a)}else{let a=yield o.indexed.GetFileListFromDB("/files/"),d=yield o.indexed.GetFileListFromDB("/todo/");a.push.apply(a,d),yield o.ModulateIndexedFile(a)}else{if(o.indexed.godotDB){let d=yield o.indexed.GetFileListFromDB("/",void 0,o.indexed.godotDB);yield o.ModulateIndexedFile(d,o.indexed.godotDB)}let a=yield o.indexed.GetFileListFromDB("/");yield o.ModulateIndexedFile(a)}o.FileList.sort((a,d)=>a.path>d.path?1:a.path<d.path?-1:0),o.DirList.sort((a,d)=>a.path>d.path?1:a.path<d.path?-1:0),setTimeout(()=>{o.noti.ClearNoti(5)},100),o.initLoadingElement.dismiss(),o.is_ready=!0})()}ModulateIndexedFile(o,a=this.indexed.ionicDB){var d=this;return(0,_.c)(function*(){for(let f=0,l=o.length;f<l;f++){if(d.StopIndexing)return;let g=`${d.lang.text.UserFsDir.LoadingExplorer}: ${o.length-f}`;("Android"==G.s1||"iOS"==G.s1)&&d.noti.noti.schedule({id:5,title:g,progressBar:{value:f,maxValue:o.length},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"}),d.initLoadingElement.message=g,yield d.indexed.GetFileInfoFromDB(o[f],r=>{let e={path:o[f],mode:r.mode,timestamp:r.timestamp,db:a};switch(e.name=e.path.substring(e.path.lastIndexOf("/")+1),e.dir=o[f].substring(0,o[f].lastIndexOf("/")),e.mode){case 33206:e.file_ext=e.name.split(".").pop(),d.global.set_viewer_category_from_ext(e),"image"==e.viewer&&d.indexed.loadBlobFromUserPath(e.path,"",u=>{let I=URL.createObjectURL(u);e.thumbnail=d.sanitizer.bypassSecurityTrustUrl(I)},a);try{let u=e.path.split("/");if(5!=u.length||"groups"!=u[3])throw"\uadf8\ub8f9 \uc774\ubbf8\uc9c0 \ud30c\uc77c\uc774 \uc544\ub2d8";d.SetDisplayGroupImageName(e,u)}catch{}d.FileList.push(e);break;case 16893:0==e.path.indexOf("todo/")&&d.SetDisplayTodoName(e);let n=!1,c=e.path.split("/");try{if(5!=c.length||"channels"!=c[3])throw"\ucc44\ub110 \ud3f4\ub354\uac00 \uc544\ub2d8";d.SetDisplayChannelName(e,c),n=!0}catch{}try{if(n||5!=c.length||"users"!=c[3])throw"\uc0ac\uc6a9\uc790 \ud3f4\ub354\uac00 \uc544\ub2d8";d.SetDisplayUserName(e,c),n=!0}catch{}d.DirList.push(e);break;default:console.log("\uc608\uc0c1\ud558\uc9c0 \ubabb\ud55c \ud30c\uc77c \ubaa8\ub4dc: ",e)}},a)}})()}SetDisplayTodoName(o){var a=this;return(0,_.c)(function*(){try{let d=yield a.indexed.loadTextFromUserPath(`${o.path}/info.todo`),f=JSON.parse(d);o.name=f.title}catch(d){console.error("SetDisplayTodoName error: ",d)}})()}SetDisplayUserName(o,a){try{o.name=this.nakama.users[a[1]][a[2]][a[4]].display_name}catch{}}SetDisplayChannelName(o,a){try{o.name=this.nakama.channels_orig[a[1]][a[2]][o.name].title}catch{}}SetDisplayGroupImageName(o,a){try{o.name=`${this.nakama.groups[a[1]][a[2]][a[4].split(".").shift()].name}.img`}catch(d){console.error("SetDisplayGroupImageName error: ",d)}}MoveToUpDir(){this.CurrentDir=this.CurrentDir.substring(0,this.CurrentDir.lastIndexOf("/")),this.FileSel.value=void 0}SelectFolder(o){this.CurrentDir=o.path,this.FileSel.value=void 0}OpenFile(o){var a=this;return(0,_.c)(function*(){if(!a.CheckIfAccessable(o.path))return;document.removeEventListener("ionBackButton",a.EventListenerAct);let d=[];if(a.is_file_selector){if(a.navParams.data.path)for(let f=0,l=a.FileList.length;f<l;f++)d.push({content:a.FileList[f]})}else for(let f=0,l=a.FileList.length;f<l;f++)a.FileList[f].dir==a.CurrentDir&&d.push({content:a.FileList[f]});{let f=yield a.indexed.loadBlobFromUserPath(o.path,"");o.size=f.size}a.modalCtrl.create({component:W.K,componentProps:{info:{content:o},targetDB:a.indexed.ionicDB,no_edit:!0,path:o.path,relevance:d},cssClass:"fullscreen"}).then(f=>{delete a.global.p5key.KeyShortCut.Escape,delete a.global.p5key.KeyShortCut.Digit,f.onDidDismiss().then(l=>{if(l.data)switch(l.data.type){case"image":return void a.modalCtrl.create({component:E.S,componentProps:{path:l.data.path,width:l.data.width,height:l.data.height,text:l.data.text},cssClass:"fullscreen"}).then(g=>{g.onWillDismiss().then(function(){var r=(0,_.c)(function*(e){let n=a.global.Base64ToBlob(e.data.img,"image/png");n.name=e.data.name,yield a.importSelected(n),e.data.loadingCtrl.dismiss(),document.addEventListener("ionBackButton",a.EventListenerAct),a.ionViewDidEnter()});return function(e){return r.apply(this,arguments)}}()),g.present()});case"text":console.log(l),a.importSelected(l.data.blob)}else document.addEventListener("ionBackButton",a.EventListenerAct),a.ionViewDidEnter()}),f.present()})})()}CheckIfAccessable(o){switch(o){case"servers/webrtc_server.json":case"servers/self/profile.json":return this.p5toast.show({text:this.lang.text.UserFsDir.PrivateAccessDenied}),!1}return!0}DownloadFile(o){this.CheckIfAccessable(o.path)&&this.indexed.DownloadFileFromUserPath(o.path,"",o.name)}ExportDirectoryRecursive(){this.alertCtrl.create({header:this.lang.text.UserFsDir.ExportDirTitle,message:this.lang.text.UserFsDir.ExportDirMsg,buttons:[{text:this.lang.text.UserFsDir.ExportConfirm,handler:()=>{this.ExportDirectoryRecursiveAct()}}]}).then(o=>o.present())}ExportDirectoryRecursiveAct(){var o=this;return(0,_.c)(function*(){let a=yield o.loadingCtrl.create({message:o.lang.text.UserFsDir.ExportDirTitle});a.present();let d=yield o.indexed.GetFileListFromDB(o.CurrentDir);for(let f=0,l=d.length;f<l;f++){let g=yield o.indexed.GetFileInfoFromDB(d[f]),r=yield o.indexed.loadBlobFromUserPath(d[f],""),e=d[f].lastIndexOf("/"),n=d[f].substring(0,e),c=d[f].substring(e+1);o.isCreateFolderRecursive||(o.isCreateFolderRecursive=!0,yield o.CreateFolderRecursive(n));try{if(16893==g.mode)throw yield o.file.createDir(o.file.externalDataDirectory+n,c,!0),a.message=`${o.lang.text.UserFsDir.ExportDirTitle}: ${c}`,"\uc774\uac70 \ud3f4\ub354\uc784";if(!o.CheckIfAccessable(d[f]))throw"\uc5f4\ub78c \ubd88\uac00 \ud30c\uc77c \uc81c\uc678";a.message=`${o.lang.text.UserFsDir.ExportDirTitle}: ${c}`,yield o.file.writeFile(o.file.externalDataDirectory+n+"/",c,r,{replace:!0})}catch(u){console.error(d[f],": \ud30c\uc77c \uc800\uc7a5 \uc2e4\ud328: ",u)}}o.isCreateFolderRecursive=!1,a.dismiss()})()}CreateFolderRecursive(o){var a=this;return(0,_.c)(function*(){let d=o.lastIndexOf("/")+1,f=o.substring(0,d),l=o.substring(d);f&&(yield a.CreateFolderRecursive(o.substring(0,d-1)));try{yield a.file.createDir(a.file.externalDataDirectory+f,l,!0)}catch{}})()}BrowseExternalFiles(){var o=this;return(0,_.c)(function*(){o.ExternalFolder.length=0,o.InAppBrowser=!1,o.ExternalFolder=yield o.file.listDir(o.file.externalApplicationStorageDirectory,"files"),o.ExternalFolder.sort(),o.ExternalFolder.sort((a,d)=>a.isDirectory?-1:1)})()}importFolderMiddleAct(o){var a=this;return(0,_.c)(function*(){let d=yield a.loadingCtrl.create({message:a.lang.text.UserFsDir.Import});d.present(),yield a.importThisFolder(o,d),a.InAppBrowser=!0,d.dismiss(),a.p5toast.show({text:a.lang.text.UserFsDir.NeedResetToApply})})()}importThisFolder(o,a){var d=this;return(0,_.c)(function*(){let f=o.nativeURL.substring(0,o.nativeURL.length-1),l=f.lastIndexOf("/"),g=yield d.file.listDir(f.substring(0,l)+"/",f.substring(l+1));for(let r=0,e=g.length;r<e;r++)if(g[r].isDirectory)yield d.importThisFolder(g[r],a);else{let n=g[r].nativeURL.split("org.pjcone.portal/files/")[1];console.log("Now importing: ",n);try{let u=(yield de.readFile({path:g[r].nativeURL})).data.replace(/"|\\|=/g,"");yield d.indexed.saveBase64ToUserPath(","+u,decodeURIComponent(n)),a.message=`${d.lang.text.UserFsDir.Import}: ${g[r].name}`}catch(c){console.log("\ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",c),d.p5toast.show({text:`${d.lang.text.UserFsDir.ImportFailed}: ${c}`})}}})()}SelectImportFolder(){this.cant_dedicated?document.getElementById("folder_sel_id").click():this.BrowseExternalFiles()}inputImageSelected(o){var a=this;return(0,_.c)(function*(){let d=yield a.loadingCtrl.create({message:a.lang.text.UserFsDir.LoadingExplorer});d.present();for(let f=0,l=o.target.files.length;f<l;f++)yield a.indexed.saveBlobToUserPath(o.target.files[f],o.target.files[f].webkitRelativePath);a.LoadAllIndexedFiles(),d.dismiss(),a.p5toast.show({text:a.lang.text.UserFsDir.NeedResetToApply})})()}RemoveDirectoryRecursive(){var a,o=this;this.alertCtrl.create({header:this.CurrentDir.substring(this.CurrentDir.lastIndexOf("/")+1)||this.lang.text.UserFsDir.ResetDB,message:this.lang.text.UserFsDir.RemoveThisFolder,buttons:[{text:this.lang.text.UserFsDir.RemoveApply,handler:(a=(0,_.c)(function*(){let d=yield o.loadingCtrl.create({message:o.lang.text.UserFsDir.DeleteFile});d.present(),("Android"==G.s1||"iOS"==G.s1)&&o.noti.noti.schedule({id:4,title:o.lang.text.UserFsDir.DeleteFile,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"});let f=yield o.indexed.GetFileListFromDB(o.CurrentDir);for(let l=0,g=f.length;l<g;l++)("Android"==G.s1||"iOS"==G.s1)&&o.noti.noti.schedule({id:5,title:`${o.lang.text.UserFsDir.DeleteFile}: ${g-l}`,progressBar:{value:l,maxValue:g},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"}),d.message=`${o.lang.text.UserFsDir.DeleteFile}: ${g-l}`,yield o.indexed.removeFileFromUserPath(f[l]);for(let l=o.DirList.length-1;l>=0;l--)0==o.DirList[l].path.indexOf(o.CurrentDir)&&o.DirList.splice(l,1);for(let l=o.FileList.length-1;l>=0;l--)0==o.FileList[l].path.indexOf(o.CurrentDir)&&o.FileList.splice(l,1);f=yield o.indexed.GetFileListFromDB(o.CurrentDir);for(let l=0,g=f.length;l<g;l++)("Android"==G.s1||"iOS"==G.s1)&&o.noti.noti.schedule({id:5,title:`${o.lang.text.UserFsDir.DeleteFile}: ${g-l}`,progressBar:{value:l,maxValue:g},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"}),d.message=`${o.lang.text.UserFsDir.DeleteFile}: ${g-l}`,yield o.indexed.removeFileFromUserPath(f[l]);for(let l=o.DirList.length-1;l>=0;l--)0==o.DirList[l].path.indexOf(o.CurrentDir)&&o.DirList.splice(l,1);for(let l=o.FileList.length-1;l>=0;l--)0==o.FileList[l].path.indexOf(o.CurrentDir)&&o.FileList.splice(l,1);o.MoveToUpDir(),d.dismiss(),setTimeout(()=>{o.noti.ClearNoti(4)},100)}),function(){return a.apply(this,arguments)}),cssClass:"red_font"}]}).then(a=>a.present())}RemoveFile(o,a){this.alertCtrl.create({header:this.lang.text.UserFsDir.DeleteFile,message:this.lang.text.UserFsDir.CannotBeUndo,buttons:[{text:this.lang.text.UserFsDir.DeleteAccept,handler:()=>{this.indexed.removeFileFromUserPath(o.path,()=>{this.FileList.splice(a,1)})},cssClass:"red_font"}]}).then(d=>d.present())}ionViewDidLeave(){this.StopIndexing=!0,this.FileList.forEach(o=>{URL.revokeObjectURL(o.thumbnail)}),this.noti.ClearNoti(4),this.noti.ClearNoti(5)}ionViewWillLeave(){document.removeEventListener("ionBackButton",this.EventListenerAct),delete this.global.p5key.KeyShortCut.Escape,delete this.global.p5key.KeyShortCut.Digit}}return(p=O).\u0275fac=function(o){return new(o||p)(i.GI1(A.qS),i.GI1(N.k),i.GI1(A.Kg),i.GI1(Q.o),i.GI1(B.A1),i.GI1(S.O),i.GI1(A.iW),i.GI1(z.mI),i.GI1(q.S),i.GI1(ae.wX),i.GI1(ee.s),i.GI1(ae.a6),i.GI1(le.h))},p.\u0275cmp=i.In1({type:p,selectors:[["app-user-fs-dir"]],viewQuery:function(o,a){if(1&o&&i.CC$(xe,5),2&o){let d;i.wto(d=i.Gqi())&&(a.FileSel=d.first)}},decls:13,vars:5,consts:[[1,"ion-no-border"],["slot","start",3,"click"],["defaultHref",""],["class","top_icon","slot","end","name","eye-outline",3,"click",4,"ngIf"],["class","top_icon","slot","end","name","eye-off-outline",3,"click",4,"ngIf"],["id","p5Drop_userfs",2,"position","absolute","width","100%","height","100%","display","flex","pointer-events","none"],["hidden","","type","file","id","import_file","accept","*","multiple","",3,"change"],[4,"ngIf"],["slot","end","name","eye-outline",1,"top_icon",3,"click"],["slot","end","name","eye-off-outline",1,"top_icon",3,"click"],["button",""],["slot","start","name","folder"],["class","folder_button",3,"click",4,"ngIf"],[1,"folder_button",3,"click"],[3,"click"],["button","",3,"click",4,"ngIf"],[4,"ngFor","ngForOf"],["FileSel",""],["button","",3,"click"],["slot","start","name","arrow-down-circle"],["hidden","","type","file","id","folder_sel_id","webkitdirectory","",3,"change"],[3,"value",4,"ngIf"],[3,"value"],["slot","header"],["slot","start","name","image",4,"ngIf"],["slot","start","name","musical-notes",4,"ngIf"],["slot","start","name","play-circle",4,"ngIf"],["slot","start","name","reader",4,"ngIf"],["slot","start","name","extension-puzzle",4,"ngIf"],["slot","start","name","document",4,"ngIf"],["text-wrap","",4,"ngIf"],[1,"ion-accordion-toggle-icon","hide_accordion_icon"],["slot","content"],["class","ion-text-right button_dist",3,"click",4,"ngIf"],[1,"ion-text-end","button_dist",3,"click"],["class","image_front_form",3,"click",4,"ngIf"],["slot","start","name","image"],["slot","start","name","musical-notes"],["slot","start","name","play-circle"],["slot","start","name","reader"],["slot","start","name","extension-puzzle"],["slot","start","name","document"],["text-wrap",""],[1,"ion-text-right","button_dist",3,"click"],[1,"image_front_form",3,"click"],[1,"image_front_view",3,"src","alt"],["color","medium"],["button","","disabled","",4,"ngIf"],["button","","disabled",""]],template:function(o,a){1&o&&(i.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),i.OEk(3),i.C$Y(),i.I0R(4,"ion-buttons",1),i.qCj("click",function(){return a.dismiss_page()}),i.wR5(5,"ion-back-button",2),i.C$Y(),i.yuY(6,Ie,1,0,"ion-icon",3)(7,ye,1,0,"ion-icon",4),i.C$Y()(),i.I0R(8,"ion-content")(9,"div",5)(10,"input",6),i.qCj("change",function(f){return a.inputFileSelected(f)}),i.C$Y()(),i.yuY(11,Ve,19,8,"ion-list",7)(12,We,6,1,"ion-list",7),i.C$Y()),2&o&&(i.yG2(3),i.cNF(a.lang.text.Settings.InAppExplorer),i.yG2(3),i.E7m("ngIf",!a.HideThumbnail),i.yG2(),i.E7m("ngIf",a.HideThumbnail),i.yG2(4),i.E7m("ngIf",a.InAppBrowser),i.yG2(),i.E7m("ngIf",!a.InAppBrowser))},dependencies:[me.ay,me.u_,A.cm,A.qU,A.sn,A.GS,A._i,A.wB,A.Ko,A.Yb,A.QR,A.OC,A.tM,A.Md,A.Im],styles:[".item.sc-ion-label-md-h[_ngcontent-%COMP%], .item[_ngcontent-%COMP%]   .sc-ion-label-md-h[_ngcontent-%COMP%]{overflow:unset}.image_front_form[_ngcontent-%COMP%]{display:flex;justify-content:center;text-align:center}.image_front_view[_ngcontent-%COMP%]{max-height:233px}.top_icon[_ngcontent-%COMP%]{width:28px;height:28px;padding-right:28px;cursor:pointer}.button_dist[_ngcontent-%COMP%]{padding-left:2px}.folder_button[_ngcontent-%COMP%]{padding-right:4px}"]}),O})()}}]);