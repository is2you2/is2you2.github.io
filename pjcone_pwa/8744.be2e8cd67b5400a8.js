(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8744],{8744:(be,xe,d)=>{"use strict";d.d(xe,{K:()=>Ae});var r=d(1528),z=d(5193),Z=d(9352),te=d(896),me=d(2272),ue=d(7668),t=d(4496),G=d(5624),ve=d(9240),_e=d(4668),pe=d(4500),S=d(544),ne=d(3824),k=d(5020),V=d(7136),J=d(7756),he=d(6819),fe=d(1368),u=d(4716);const h=["FileMenu"],m=["ShowContentInfoIonic"];function x(l,T){if(1&l){const i=t.KQA();t.I0R(0,"ion-icon",21),t.qCj("click",function(){t.usT(i);const n=t.GaO();return t.CGJ(n.AutoPlayNext=!n.AutoPlayNext)}),t.C$Y()}}function O(l,T){if(1&l){const i=t.KQA();t.I0R(0,"ion-icon",22),t.qCj("click",function(){t.usT(i);const n=t.GaO();return t.CGJ(n.AutoPlayNext=!n.AutoPlayNext)}),t.C$Y()}}function P(l,T){if(1&l){const i=t.KQA();t.I0R(0,"ion-icon",23),t.qCj("click",function(){t.usT(i);const n=t.GaO();return t.CGJ(n.ChangeToAnother(-1))}),t.C$Y()}}function I(l,T){if(1&l&&(t.I0R(0,"ion-label",24),t.OEk(1),t.C$Y()),2&l){const i=t.GaO();t.yG2(),t.cNF(i.RelevanceIndex+" / "+i.Relevances.length)}}function C(l,T){if(1&l){const i=t.KQA();t.I0R(0,"ion-icon",25),t.qCj("click",function(){t.usT(i);const n=t.GaO();return t.CGJ(n.ChangeToAnother(1))}),t.C$Y()}}function K(l,T){if(1&l&&(t.I0R(0,"ion-label",26),t.OEk(1),t.C$Y()),2&l){const i=t.GaO();t.yG2(),t.cNF(i.FileInfo.filename||i.FileInfo.name)}}function ie(l,T){if(1&l){const i=t.KQA();t.I0R(0,"ion-input",27),t.iHE("ngModelChange",function(n){t.usT(i);const a=t.GaO();return t.kNx(a.NewTextFileName,n)||(a.NewTextFileName=n),t.CGJ(n)}),t.C$Y()}if(2&l){const i=t.GaO();t.OKB("ngModel",i.NewTextFileName),t.E7m("placeholder",i.FileInfo.filename||i.FileInfo.name)}}function $(l,T){if(1&l){const i=t.KQA();t.I0R(0,"ion-button",28),t.qCj("click",function(){t.usT(i);const n=t.GaO();return t.CGJ(n.close_text_edit())}),t.wR5(1,"ion-icon",29),t.C$Y()}}function de(l,T){if(1&l){const i=t.KQA();t.I0R(0,"ion-button",28),t.qCj("click",function(){t.usT(i);const n=t.GaO();return t.CGJ(n.SaveText())}),t.wR5(1,"ion-icon",30),t.C$Y()}}function Q(l,T){1&l&&(t.I0R(0,"ion-button",31),t.wR5(1,"ion-icon",32),t.C$Y())}function W(l,T){if(1&l){const i=t.KQA();t.I0R(0,"ion-item",36),t.qCj("click",function(){t.usT(i);const n=t.GaO(3);return t.CGJ(n.open_text_editor())}),t.I0R(1,"ion-label"),t.OEk(2),t.C$Y()()}if(2&l){const i=t.GaO(3);t.yG2(2),t.cNF(i.lang.text.ContentViewer.EditText)}}function q(l,T){if(1&l){const i=t.KQA();t.I0R(0,"ion-item",36),t.qCj("click",function(){t.usT(i);const n=t.GaO(3);return t.CGJ(n.modify_image())}),t.I0R(1,"ion-label"),t.OEk(2),t.C$Y()()}if(2&l){const i=t.GaO(3);t.yG2(2),t.cNF(i.lang.text.ContentViewer.Edit)}}function se(l,T){if(1&l){const i=t.KQA();t.I0R(0,"ion-item",36),t.qCj("click",function(){t.usT(i);const n=t.GaO(3);return t.CGJ(n.ShareContent())}),t.I0R(1,"ion-label"),t.OEk(2),t.C$Y()()}if(2&l){const i=t.GaO(3);t.yG2(2),t.cNF(i.lang.text.ContentViewer.ShareContent)}}function ee(l,T){if(1&l){const i=t.KQA();t.I0R(0,"ion-item",36),t.qCj("click",function(){t.usT(i);const n=t.GaO(3);return t.CGJ(n.download_file())}),t.I0R(1,"ion-label"),t.OEk(2),t.C$Y()()}if(2&l){const i=t.GaO(3);t.yG2(2),t.cNF(i.lang.text.ContentViewer.Download)}}function oe(l,T){if(1&l){const i=t.KQA();t.I0R(0,"ion-item",36),t.qCj("click",function(){t.usT(i);const n=t.GaO(3);return t.CGJ(n.RemoveFile())}),t.I0R(1,"ion-label"),t.OEk(2),t.C$Y()()}if(2&l){const i=t.GaO(3);t.yG2(2),t.cNF(i.lang.text.ContentViewer.RemoveFile)}}function _(l,T){if(1&l){const i=t.KQA();t.I0R(0,"ion-content")(1,"ion-list"),t.yuY(2,W,3,1,"ion-item",35)(3,q,3,1,"ion-item",35)(4,se,3,1,"ion-item",35)(5,ee,3,1,"ion-item",35),t.I0R(6,"ion-item",36),t.qCj("click",function(){t.usT(i);const n=t.GaO(2);return t.CGJ(n.open_bottom_modal())}),t.I0R(7,"ion-label"),t.OEk(8),t.C$Y()(),t.yuY(9,oe,3,1,"ion-item",35),t.C$Y()()}if(2&l){const i=t.GaO(2);t.yG2(2),t.E7m("ngIf",!i.NeedDownloadFile&&("text"==i.FileInfo.viewer||"code"==i.FileInfo.viewer)&&i.showEdit),t.yG2(),t.E7m("ngIf",!i.NeedDownloadFile&&"audio"!=i.FileInfo.viewer&&i.showEdit),t.yG2(),t.E7m("ngIf",!i.NeedDownloadFile),t.yG2(),t.E7m("ngIf",!i.NeedDownloadFile),t.yG2(3),t.cNF(i.lang.text.ContentViewer.ContentInfo),t.yG2(),t.E7m("ngIf",!i.NeedDownloadFile&&i.OpenInChannelChat&&!i.FileInfo.url)}}function b(l,T){1&l&&(t.I0R(0,"ion-popover",33,34),t.yuY(2,_,10,6,"ng-template"),t.C$Y())}function L(l,T){if(1&l&&(t.I0R(0,"div")(1,"div",38),t.wR5(2,"ion-icon",39),t.I0R(3,"div")(4,"ion-label",40),t.OEk(5),t.C$Y()()()()),2&l){const i=t.GaO(2);t.yG2(5),t.cNF(i.lang.text.ContentViewer.OnLoadContent)}}function F(l,T){if(1&l&&(t.I0R(0,"div")(1,"div",38),t.wR5(2,"ion-icon",41),t.I0R(3,"div")(4,"ion-label",40),t.OEk(5),t.C$Y()()()()),2&l){const i=t.GaO(2);t.yG2(5),t.cNF(i.lang.text.ContentViewer.OnFailedLoadContent)}}function j(l,T){if(1&l&&(t.I0R(0,"td"),t.yuY(1,L,6,1,"div",18)(2,F,6,1,"div",18),t.wR5(3,"div",37),t.C$Y()),2&l){const i=t.GaO();t.yG2(),t.E7m("ngIf",!i.ContentOnLoad),t.yG2(),t.E7m("ngIf",i.ContentOnLoad&&i.ContentFailedLoad)}}function ae(l,T){if(1&l){const i=t.KQA();t.I0R(0,"td")(1,"ion-grid")(2,"ion-row",42)(3,"ion-col",43)(4,"ion-button",44),t.qCj("click",function(){t.usT(i);const n=t.GaO();return t.CGJ(n.DownloadCurrentFile())}),t.OEk(5),t.C$Y()()()()()}if(2&l){const i=t.GaO();t.yG2(4),t.E7m("disabled",i.isDownloading||i.MessageInfo.content.transfer_index&&"download"==i.MessageInfo.content.transfer_index.OnTransfer),t.yG2(),t.oRS(" ",i.MessageInfo.content.transfer_index&&"download"==i.MessageInfo.content.transfer_index.OnTransfer?i.lang.text.ContentViewer.FileDownloading:i.lang.text.ContentViewer.DownloadThisFile," ")}}function ye(l,T){if(1&l){const i=t.KQA();t.I0R(0,"ion-item",36),t.qCj("click",function(){t.usT(i);const n=t.GaO(2);return t.CGJ(n.copy_url(n.content_creator.user_id))}),t.I0R(1,"ion-label"),t.OEk(2),t.C$Y(),t.I0R(3,"ion-label",46),t.OEk(4),t.C$Y()()}if(2&l){const i=t.GaO(2);t.yG2(2),t.cNF(i.lang.text.ContentInfo.LastPost),t.yG2(2),t.oRS(" ",i.content_creator.publisher||i.content_creator.display_name||i.lang.text.Profile.noname_user,"")}}function Ie(l,T){if(1&l&&(t.I0R(0,"ion-item",49)(1,"ion-label"),t.OEk(2),t.C$Y(),t.I0R(3,"ion-label",46),t.OEk(4),t.C$Y()()),2&l){const i=t.GaO(2);t.yG2(2),t.cNF(i.lang.text.ContentInfo.SourceFrom),t.yG2(2),t.cNF(i.content_creator.various_display)}}function re(l,T){if(1&l&&(t.I0R(0,"ion-item")(1,"ion-label"),t.OEk(2),t.C$Y(),t.I0R(3,"ion-label",46),t.OEk(4),t.C$Y()()),2&l){const i=t.GaO(2);t.yG2(2),t.cNF(i.lang.text.ContentInfo.FileSize),t.yG2(2),t.cNF(i.CurrentFileSize)}}function le(l,T){1&l&&t.wR5(0,"ion-icon",58)}function ge(l,T){1&l&&t.wR5(0,"ion-icon",59)}function Pe(l,T){1&l&&t.wR5(0,"ion-icon",60)}function Te(l,T){1&l&&t.wR5(0,"ion-icon",61)}function Ee(l,T){1&l&&t.wR5(0,"ion-icon",62)}function Oe(l,T){1&l&&t.wR5(0,"ion-icon",63)}function ke(l,T){1&l&&(t.I0R(0,"ion-avatar"),t.wR5(1,"img",64),t.C$Y())}function Fe(l,T){if(1&l){const i=t.KQA();t.I0R(0,"div")(1,"div",50),t.OEk(2),t.I0R(3,"ion-chip",51),t.qCj("click",function(){const a=t.usT(i).$implicit,c=t.GaO(2);return t.CGJ(c.toast_info(a))}),t.yuY(4,le,1,0,"ion-icon",52)(5,ge,1,0,"ion-icon",53)(6,Pe,1,0,"ion-icon",54)(7,Te,1,0,"ion-icon",55)(8,Ee,1,0,"ion-icon",56)(9,Oe,1,0,"ion-icon",57)(10,ke,2,0,"ion-avatar",18),t.I0R(11,"ion-label"),t.OEk(12),t.C$Y()()()()}if(2&l){const i=T.$implicit,e=t.GaO(2);t.yG2(2),t.oRS(" ",i.timeDisplay," "),t.yG2(2),t.E7m("ngIf","loaded"==i.various),t.yG2(),t.E7m("ngIf","camera"==i.various),t.yG2(),t.E7m("ngIf","link"==i.various),t.yG2(),t.E7m("ngIf","long_text"==i.various),t.yG2(),t.E7m("ngIf","textedit"==i.various),t.yG2(),t.E7m("ngIf","shared"==i.various),t.yG2(),t.E7m("ngIf","voidDraw"==i.various),t.yG2(2),t.cNF(i.publisher||i.display_name||e.lang.text.Profile.noname_user)}}function Re(l,T){if(1&l){const i=t.KQA();t.I0R(0,"ion-content")(1,"ion-item-divider")(2,"ion-label"),t.OEk(3),t.C$Y()(),t.yuY(4,ye,5,2,"ion-item",35)(5,Ie,5,2,"ion-item",45)(6,re,5,2,"ion-item",18),t.I0R(7,"ion-item")(8,"ion-label"),t.OEk(9),t.C$Y(),t.I0R(10,"ion-label",46),t.OEk(11),t.C$Y()(),t.I0R(12,"ion-item-divider")(13,"ion-label"),t.OEk(14),t.C$Y()(),t.yuY(15,Fe,13,9,"div",47),t.I0R(16,"ion-item",36),t.qCj("click",function(){t.usT(i),t.GaO();const n=t.Gew(26);return t.CGJ(n.dismiss())}),t.I0R(17,"ion-label",48),t.OEk(18),t.C$Y()()()}if(2&l){const i=t.GaO();t.yG2(3),t.cNF(i.lang.text.ContentInfo.WorkLogs),t.yG2(),t.E7m("ngIf",!i.FromUserFsDir),t.yG2(),t.E7m("ngIf",i.content_creator.various),t.yG2(),t.E7m("ngIf",!i.FileInfo.url),t.yG2(3),t.cNF(i.lang.text.ContentInfo.TimeAt),t.yG2(2),t.cNF(i.content_creator.timeDisplay),t.yG2(3),t.cNF(i.lang.text.ContentInfo.WorkHistory),t.yG2(),t.E7m("ngForOf",i.content_related_creator),t.yG2(3),t.cNF(i.lang.text.ContentInfo.CloseModal)}}const De=()=>[.5,1];let Ae=(()=>{var l;class T{constructor(e,n,a,c,o,s,g,M,p,E,w,R){this.modalCtrl=e,this.navParams=n,this.indexed=a,this.lang=c,this.file=o,this.p5toast=s,this.alertCtrl=g,this.loadingCtrl=M,this.global=p,this.nakama=E,this.mClipboard=w,this.noti=R,this.useP5Navigator=!0,this.RelevanceIndex=0,this.HaveRelevances=!1,this.NeedDownloadFile=!1,this.ContentOnLoad=!1,this.ContentFailedLoad=!0,this.isDownloading=!1,this.OpenInChannelChat=!1,this.isChannelOnline=!0,this.fromLocalChannel=!1,this.showEdit=!0,this.EventListenerAct=B=>{B.detail.register(120,f=>{})},this.BackButtonPressed=!1,this.ContentChanging=!1,this.AutoPlayNext=!1,this.isTextEditMode=!1,this.NewTextFileName="",this.image_info={},this.forceWrite=!1}InitBrowserBackButtonOverride(){window.history.replaceState(null,null,window.location.href),window.onpopstate=()=>{this.BackButtonPressed||(this.BackButtonPressed=!0,this.modalCtrl.dismiss())}}ngOnInit(){var e=this;return(0,r.c)(function*(){e.InitBrowserBackButtonOverride(),e.fromLocalChannel=e.navParams.get("local"),e.MessageInfo=e.navParams.get("info"),e.OpenInChannelChat=void 0!==e.MessageInfo.code,e.CurrentViewId=e.MessageInfo.message_id,e.FileInfo=e.MessageInfo.content,e.ContentBox=document.getElementById("ContentBox"),e.FileHeader=document.getElementById("FileHeader"),e.isOfficial=e.navParams.get("isOfficial"),e.target=e.navParams.get("target");try{e.isChannelOnline="online"==e.nakama.channels_orig[e.isOfficial][e.target][e.MessageInfo.channel_id].info.status,e.isChannelOnline=e.isChannelOnline||"online"==e.nakama.channels_orig[e.isOfficial][e.target][e.MessageInfo.channel_id].status||"pending"==e.nakama.channels_orig[e.isOfficial][e.target][e.MessageInfo.channel_id].status}catch{}switch(e.FromUserFsDir=e.navParams.get("no_edit")||!1,e.FileInfo.is_new){case"code":case"text":break;default:if(e.Relevances=e.navParams.get("relevance"),e.Relevances){for(let n=0,a=e.Relevances.length;n<a;n++)if(e.Relevances[n].message_id&&e.MessageInfo.message_id){if(e.Relevances[n].message_id==e.MessageInfo.message_id){e.RelevanceIndex=n+1;break}}else if(e.Relevances[n].content.path==e.MessageInfo.content.path){e.RelevanceIndex=n+1;break}e.HaveRelevances=e.Relevances.length>1}else e.HaveRelevances=!1;e.CreateContentInfo()}e.showEdit=!e.navParams.get("noEdit")})()}reinit_content_data(e){var n=this;return(0,r.c)(function*(){if(n.NewTextFileName="",n.NeedDownloadFile=!0,n.ContentOnLoad=!1,n.ContentFailedLoad=!0,n.isTextEditMode=!1,n.MessageInfo=e,n.CurrentViewId=n.MessageInfo.message_id,n.FileInfo=n.MessageInfo.content,n.p5canvas&&n.p5canvas.remove(),n.canvasDiv=document.getElementById("content_viewer_canvas"),n.canvasDiv)for(let a=0,c=n.canvasDiv.childNodes.length;a<c;a++)n.canvasDiv.removeChild(n.canvasDiv.childNodes[a]);if(URL.revokeObjectURL(n.FileURL),n.FileInfo.url)n.CreateContentInfo(),n.NeedDownloadFile=!1,n.ContentOnLoad=!0,n.ionViewDidEnter();else{let a=n.FileInfo.path||`servers/${n.isOfficial}/${n.target}/channels/${e.channel_id}/files/msg_${e.message_id}.${e.content.file_ext}`;n.image_info.path=a,n.NeedDownloadFile=yield n.indexed.checkIfFileExist(`${a}.history`);try{n.blob=yield n.indexed.loadBlobFromUserPath(a,n.FileInfo.type),n.CreateContentInfo(),n.ionViewDidEnter()}catch{n.FileURL=void 0,n.blob=void 0,n.isDownloading=!1,n.NeedDownloadFile=!0,n.ContentOnLoad=!0,n.ContentFailedLoad=!1,n.CreateContentInfo(),n.p5canvas&&n.p5canvas.remove(),n.p5canvas=new Z(o=>{o.setup=()=>{o.noCanvas()}}),n.ChangeContentWithKeyInput()}}})()}DownloadInOrder(){var e=this;return(0,r.c)(function*(){("Android"==z.s1||"iOS"==z.s1)&&e.noti.noti.schedule({id:6,title:e.lang.text.ContentViewer.DownloadThisFile,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://diychat",color:"b0b0b0"});for(let n=0,a=e.Relevances.length;n<a;n++)e.nakama.OnTransfer[e.isOfficial]||(e.nakama.OnTransfer[e.isOfficial]={}),e.nakama.OnTransfer[e.isOfficial][e.target]||(e.nakama.OnTransfer[e.isOfficial][e.target]={}),e.nakama.OnTransfer[e.isOfficial][e.target][e.Relevances[n].channel_id]||(e.nakama.OnTransfer[e.isOfficial][e.target][e.Relevances[n].channel_id]={}),e.nakama.OnTransfer[e.isOfficial][e.target][e.Relevances[n].channel_id][e.Relevances[n].message_id]||(e.nakama.OnTransfer[e.isOfficial][e.target][e.Relevances[n].channel_id][e.Relevances[n].message_id]={});for(let n=0,a=e.Relevances.length;n<a;n++){("Android"==z.s1||"iOS"==z.s1)&&e.noti.noti.schedule({id:6,title:`${e.lang.text.ContentViewer.DownloadThisFile}: ${a-n}`,progressBar:{value:n,maxValue:a},sound:null,smallIcon:"res://diychat",color:"b0b0b0"});let c=`servers/${e.isOfficial}/${e.target}/channels/${e.Relevances[n].channel_id}/files/msg_${e.Relevances[n].message_id}.${e.Relevances[n].content.file_ext}`;if(!(yield e.indexed.checkIfFileExist(c)))try{yield e.DownloadCurrentFile(n)}catch(s){console.log(s)}}e.noti.ClearNoti(6)})()}ChangeToAnother(e){if(this.ContentChanging)return;this.ContentChanging=!0;let n=this.RelevanceIndex+e;n<=0||n>this.Relevances.length||(this.p5canvas&&this.p5canvas.remove(),this.RelevanceIndex=n,this.FileInfo={file_ext:""},this.reinit_content_data(this.Relevances[this.RelevanceIndex-1])),this.ContentChanging=!1}DownloadCurrentFile(e){var n=this;return(0,r.c)(function*(){n.isDownloading=!0;let a=0,c=n.Relevances[null!=e?e:n.RelevanceIndex-1],o=`servers/${n.isOfficial}/${n.target}/channels/${c.channel_id}/files/msg_${c.message_id}.${c.content.file_ext}`;try{let g=yield n.indexed.loadTextFromUserPath(`${o}.history`);a=JSON.parse(g).index}catch{}let s=c.message_id;yield n.nakama.ReadStorage_From_channel(c,o,n.isOfficial,n.target,a),n.CurrentViewId==s&&n.reinit_content_data(c)})()}formatBytes(e,n=2){if(!+e)return"0 Bytes";const c=n<0?0:n,s=Math.floor(Math.log(e)/Math.log(1024));return`${parseFloat((e/Math.pow(1024,s)).toFixed(c))} ${["Bytes","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"][s]}`}CreateContentInfo(){try{if(this.FileInfo.url||(this.CurrentFileSize=this.formatBytes(this.FileInfo.size||this.FileInfo.filesize||this.blob.size)),this.content_creator=this.FileInfo.content_creator||{timestamp:this.FileInfo.timestamp},this.content_creator.timeDisplay=new Date(this.content_creator.timestamp).toLocaleString(),this.content_related_creator=this.FileInfo.content_related_creator||[],this.content_creator.user_id)try{this.content_creator.is_me=this.nakama.servers[this.isOfficial][this.target].session.user_id==this.content_creator.user_id}catch{}try{this.content_creator.publisher=this.content_creator.is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_creator.user_id].display_name}catch{}this.set_various_display(this.content_creator);for(let e=0,n=this.content_related_creator.length;e<n;e++){if(this.content_related_creator[e].user_id)try{this.content_related_creator[e].is_me=this.nakama.servers[this.isOfficial][this.target].session.user_id==this.content_related_creator[e].user_id}catch{}this.content_related_creator[e].timeDisplay=new Date(this.content_related_creator[e].timestamp).toLocaleString()}}catch{}try{this.content_related_creator[0].publisher=this.content_related_creator[0].is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_related_creator[0].user_id].display_name,this.content_related_creator[0].timestamp==this.content_related_creator[1].timestamp&&(this.content_related_creator[0].publisher=this.content_related_creator[1].is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_related_creator[1].user_id].display_name,this.content_related_creator.splice(1,1))}catch{try{this.content_related_creator[0].publisher=this.content_related_creator[1].display_name,this.content_related_creator[0].timestamp==this.content_related_creator[1].timestamp&&(this.content_related_creator[0].publisher=this.content_related_creator[1].display_name,this.content_related_creator.splice(1,1))}catch{}try{this.content_related_creator[0].publisher||(this.content_related_creator[0].publisher=this.content_related_creator[0].display_name)}catch{}}try{this.content_related_creator.sort((e,n)=>e.timestamp>n.timestamp?-1:e.timestamp<n.timestamp?1:0)}catch{}}set_various_display(e){switch(e.various){case"camera":e.various_display=this.lang.text.GlobalAct.FromCamera;break;case"link":e.various_display=this.lang.text.ChatRoom.ExternalLinkFile;break;case"loaded":e.various_display=this.lang.text.GlobalAct.variousCreator;break;case"voidDraw":e.various_display=this.lang.text.GlobalAct.FromVoidDraw;break;case"long_text":e.various_display=this.lang.text.GlobalAct.FromAutoLongText;break;case"textedit":e.various_display=this.lang.text.GlobalAct.FromTextEditor;break;case"shared":e.various_display=this.lang.text.GlobalAct.SharedContent;break;default:e.various_display=this.lang.text.GlobalAct.UnknownSource}}close_text_edit(){this.FileInfo.is_new?this.modalCtrl.dismiss():this.reinit_content_data(this.MessageInfo)}ionViewDidEnter(){var e=this;return(0,r.c)(function*(){if(e.FileInfo.url)e.FileURL=e.FileInfo.url;else if(!e.FileInfo.is_new)try{e.blob=yield e.indexed.loadBlobFromUserPath(e.FileInfo.path||e.navParams.get("path"),e.FileInfo.type),e.FileURL=URL.createObjectURL(e.blob)}catch(n){e.ContentOnLoad=!0,e.ContentFailedLoad=!0,console.log(n)}switch(e.forceWrite=!1,e.canvasDiv=document.getElementById("content_viewer_canvas"),null==e.canvasDiv.oncontextmenu&&(e.canvasDiv.oncontextmenu=()=>("blender"!=e.FileInfo.viewer&&e.FileMenu.present(),!1)),e.canvasDiv&&(e.canvasDiv.style.backgroundImage=""),document.removeEventListener("ionBackButton",e.EventListenerAct),e.p5canvas&&e.p5canvas.remove(),e.FileInfo.viewer){case"image":e.p5canvas=new Z(o=>{o.setup=(0,r.c)(function*(){e.canvasDiv.style.maxWidth="100%",e.canvasDiv.style.overflow="hidden",e.ContentBox.style.overflow="hidden",o.noCanvas();let v=o.createElement("img");v.elt.hidden=!0,v.elt.src=e.FileURL,v.elt.onload=()=>{e.canvasDiv.style.backgroundImage=`url('${e.FileURL}')`,e.canvasDiv.style.backgroundRepeat="no-repeat",e.image_info.width=v.elt.naturalWidth,e.image_info.height=v.elt.naturalHeight,g=o.createVector(v.elt.naturalWidth,v.elt.naturalHeight),s(),v.remove(),e.ContentOnLoad=!0,e.ContentFailedLoad=!1},o.noLoop()});let s=()=>{if(e.image_info.width/e.image_info.height<e.canvasDiv.clientWidth/e.canvasDiv.clientHeight){let v=e.image_info.width*e.canvasDiv.clientHeight/e.image_info.height;e.canvasDiv.style.backgroundSize=`${v}px`,e.canvasDiv.style.backgroundPositionX=(e.canvasDiv.clientWidth-v)/2+"px",e.canvasDiv.style.backgroundPositionY="0px"}else e.canvasDiv.style.backgroundSize=`${e.canvasDiv.clientWidth}px`,e.canvasDiv.style.backgroundPositionX="0px",e.canvasDiv.style.backgroundPositionY=e.canvasDiv.clientHeight/2-g.y*(e.canvasDiv.clientWidth/g.x)/2+"px";H=!0};o.windowResized=()=>{setTimeout(()=>{s()},50)};let g,M=o.createVector(),p=o.createVector(),E=o.createVector(),w=1,R=()=>{e.canvasDiv.style.backgroundPositionX=`${M.x+E.x}px`,e.canvasDiv.style.backgroundPositionY=`${M.y+E.y}px`},B=(v,N)=>{let A=w,y=w*N,U=Number(e.canvasDiv.style.backgroundPositionX.split("px")[0]),D=Number(e.canvasDiv.style.backgroundPositionY.split("px")[0]),Ge=(A-y)*o.map(v.x,U,U+A,0,1),Me=(A-y)/g.x*g.y*o.map(v.y,D,D+A/g.x*g.y,0,1);e.canvasDiv.style.backgroundPositionX=`${U+Ge}px`,e.canvasDiv.style.backgroundPositionY=`${D+Me}px`,e.canvasDiv.style.backgroundSize=`${y}px`};o.mousePressed=()=>{e.useP5Navigator&&(o.mouseButton==o.CENTER&&s(),"DesktopPWA"==z.s1&&(M=o.createVector(Number(e.canvasDiv.style.backgroundPositionX.split("px")[0]),Number(e.canvasDiv.style.backgroundPositionY.split("px")[0])),p=o.createVector(o.mouseX,o.mouseY)))},o.mouseWheel=v=>{e.useP5Navigator&&(w=Number(e.canvasDiv.style.backgroundSize.split("px")[0]),B(o.createVector(e.canvasDiv.clientWidth/2,e.canvasDiv.clientHeight/2),1-v.delta/1e3))},o.mouseDragged=()=>{e.useP5Navigator&&"DesktopPWA"==z.s1&&(E=o.createVector(o.mouseX,o.mouseY),E.sub(p),R())};let Y,f={},ce=!1,H=!0;o.touchStarted=v=>{if(e.useP5Navigator){for(let A=0,y=v.changedTouches.length;A<y;A++)f[v.changedTouches[A].identifier]=o.createVector(v.changedTouches[A].clientX,v.changedTouches[A].clientY);switch(Object.keys(f).length){case 1:M=o.createVector(Number(e.canvasDiv.style.backgroundPositionX.split("px")[0]),Number(e.canvasDiv.style.backgroundPositionY.split("px")[0])),p=f[v.changedTouches[0].identifier].copy();break;case 2:M=o.createVector(Number(e.canvasDiv.style.backgroundPositionX.split("px")[0]),Number(e.canvasDiv.style.backgroundPositionY.split("px")[0]));let A=f[0].copy();Y=A.dist(f[1]),p=A.add(f[1]).div(2).copy(),w=Number(e.canvasDiv.style.backgroundSize.split("px")[0]),R();break;default:ce=!0,s()}}},o.touchMoved=v=>{if(e.useP5Navigator&&!ce){for(let A=0,y=v.changedTouches.length;A<y;A++)f[v.changedTouches[A].identifier]=o.createVector(v.changedTouches[A].clientX,v.changedTouches[A].clientY);switch(Object.keys(f).length){case 1:E=f[v.changedTouches[0].identifier].copy(),E.sub(p),H||R();break;case 2:H=!1;let A=f[0].copy(),y=A.dist(f[1]);E=A.add(f[1]).div(2).copy();let U=E.copy();E.sub(p),R(),B(U,y/Y)}}},o.touchEnded=v=>{if(e.useP5Navigator&&"changedTouches"in v){for(let A=0,y=v.changedTouches.length;A<y;A++)delete f[v.changedTouches[A].identifier];switch(Object.keys(f).length){case 1:M=o.createVector(Number(e.canvasDiv.style.backgroundPositionX.split("px")[0]),Number(e.canvasDiv.style.backgroundPositionY.split("px")[0])),p=f[Object.keys(f)[0]].copy();break;case 0:H&&!ce&&(E.x>50?e.ChangeToAnother(-1):E.x<-50&&e.ChangeToAnother(1)),ce=!1}}}});break;case"audio":e.p5canvas=new Z(o=>{var s;o.setup=()=>{o.noCanvas(),o.noLoop(),(s=o.createAudio([e.FileURL],()=>{e.canvasDiv.appendChild(s.elt),s.elt.onended=()=>{e.AutoPlayNext&&e.ChangeToAnother(1)},setTimeout(()=>{g(),s.elt.hidden=!1},50),s.showControls(),s.play(),e.ContentOnLoad=!0,e.ContentFailedLoad=!1})).elt.hidden=!0};let g=()=>{let w=e.ContentBox.offsetWidth;s.elt.setAttribute("style","position: relative; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%);"),s.size(w,25)};o.windowResized=()=>{setTimeout(()=>{g()},50)};let M=o.createVector(),p={};o.touchStarted=w=>{if(e.useP5Navigator&&!document.pictureInPictureElement&&"changedTouches"in w){for(let B=0,f=w.changedTouches.length;B<f;B++)p[w.changedTouches[B].identifier]=o.createVector(w.changedTouches[B].clientX,w.changedTouches[B].clientY);1===Object.keys(p).length&&(M=p[w.changedTouches[0].identifier].copy())}},o.touchEnded=w=>{if(e.useP5Navigator&&!document.pictureInPictureElement&&"changedTouches"in w){let R;for(let f=0,Y=w.changedTouches.length;f<Y;f++)R=o.createVector(w.changedTouches[f].clientX,w.changedTouches[f].clientY),delete p[w.changedTouches[f].identifier];0===Object.keys(p).length&&(R.sub(M),R.x>50?e.ChangeToAnother(-1):R.x<-50&&e.ChangeToAnother(1))}}});break;case"video":e.p5canvas=new Z(o=>{var s;o.setup=(0,r.c)(function*(){o.noCanvas(),o.noLoop(),(s=o.createVideo([e.FileURL],()=>{e.global.PIPLinkedVideoElement?(s.elt.remove(),s.elt=e.global.PIPLinkedVideoElement,s.elt.setAttribute("src",e.FileURL)):e.global.PIPLinkedVideoElement=s.elt,e.canvasDiv&&e.canvasDiv.appendChild(s.elt),s.elt.onended=()=>{e.AutoPlayNext&&e.ChangeToAnother(1)},setTimeout(()=>{e.image_info.width=s.elt.videoWidth,e.image_info.height=s.elt.videoHeight,g(),s.elt.hidden=!1},50),s.showControls(),s.play(),e.ContentOnLoad=!0,e.ContentFailedLoad=!1})).elt.hidden=!0,o.VideoMedia=s});let g=()=>{let w=e.ContentBox.offsetWidth,R=e.ContentBox.offsetHeight-e.FileHeader.offsetHeight,B=s.elt.videoWidth,f=s.elt.videoHeight;0!=B&&0!=f&&(w/R>B/f?(f=R,B=B/s.elt.videoHeight*f,s.elt.setAttribute("style","position: relative; left: 50%; transform: translateX(-50%);")):(B=w,f=f/s.elt.videoWidth*B||R/2,s.elt.setAttribute("style","position: relative; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%);")),s.size(B,f))};o.windowResized=()=>{setTimeout(()=>{g()},50)};let M=o.createVector(),p={};o.touchStarted=w=>{if(e.useP5Navigator&&!document.pictureInPictureElement&&"changedTouches"in w){for(let B=0,f=w.changedTouches.length;B<f;B++)p[w.changedTouches[B].identifier]=o.createVector(w.changedTouches[B].clientX,w.changedTouches[B].clientY);1===Object.keys(p).length&&(M=p[w.changedTouches[0].identifier].copy())}},o.touchEnded=w=>{if(e.useP5Navigator&&!document.pictureInPictureElement&&"changedTouches"in w){let R;for(let f=0,Y=w.changedTouches.length;f<Y;f++)R=o.createVector(w.changedTouches[f].clientX,w.changedTouches[f].clientY),delete p[w.changedTouches[f].identifier];0===Object.keys(p).length&&(R.sub(M),R.x>50?e.ChangeToAnother(-1):R.x<-50&&e.ChangeToAnother(1))}}});break;case"code":case"text":e.p5canvas=new Z(o=>{o.setup=()=>{o.noCanvas(),o.noLoop();let s=o.createElement("textarea");s.elt.disabled=!0,s.elt.className="infobox",s.elt.setAttribute("style","height: 100%; display: block;"),s.elt.textContent="",e.canvasDiv.appendChild(s.elt),o.TextArea=s.elt,e.FileInfo.is_new?e.open_text_editor(s.elt):o.loadStrings(e.FileURL,g=>{s.elt.textContent=g.join("\n"),e.open_text_reader(o),e.ContentOnLoad=!0,e.ContentFailedLoad=!1},g=>{e.canvasDiv.textContent=e.lang.text.ContentViewer.CannotOpenText,e.FileInfo.else=!0,e.ContentOnLoad=!0})},o.windowResized=()=>{let s=window.innerHeight-45-56;o.SyntaxHighlightReader.setAttribute("style",`height: ${s}px; display: ${e.isTextEditMode?"none":"block"}; overflow-y: scroll;`)}});break;case"godot":document.addEventListener("ionBackButton",e.EventListenerAct);let n,a=e.MessageInfo.message_id;try{let o=yield e.indexed.loadBlobFromUserPath((e.FileInfo.path||e.navParams.get("path"))+"_thumbnail.png","");n=URL.createObjectURL(o)}catch{}!e.NeedDownloadFile&&e.CurrentViewId==a&&setTimeout((0,r.c)(function*(){let o=!1;if(e.indexed.godotDB)try{let s=yield e.indexed.loadBlobFromUserPath(e.FileInfo.path||e.navParams.get("path"),"",void 0,e.indexed.ionicDB);yield e.indexed.GetGodotIndexedDB(),yield e.indexed.saveBlobToUserPath(s,"tmp_files/duplicate/viewer.pck",void 0,e.indexed.godotDB),o=!0}catch(s){console.log("\ub0b4\ubd80 \ud30c\uc77c \uc5c6\uc74c: ",s)}if(yield e.global.CreateGodotIFrame("content_viewer_canvas",{path:"tmp_files/duplicate/viewer.pck",alt_path:e.FileInfo.path||e.navParams.get("path"),url:e.FileInfo.url,background:n,receive_image:(s=(0,r.c)(function*(g,M,p){let E="tmp_files/modify_image.png";yield e.indexed.saveBase64ToUserPath(","+g,E),e.modalCtrl.dismiss({type:"image",path:E,width:M,height:p,msg:e.MessageInfo,index:e.RelevanceIndex-1})}),function(M,p,E){return s.apply(this,arguments)})},"start_load_pck"),!o){try{let s=yield e.indexed.loadBlobFromUserPath(e.FileInfo.path||e.navParams.get("path"),"",void 0,e.indexed.ionicDB);yield e.indexed.GetGodotIndexedDB(),yield e.indexed.saveBlobToUserPath(s,"tmp_files/duplicate/viewer.pck",void 0,e.indexed.godotDB)}catch{}yield e.global.CreateGodotIFrame("content_viewer_canvas",{path:"tmp_files/duplicate/viewer.pck",alt_path:e.FileInfo.path||e.navParams.get("path"),url:e.FileInfo.url,background:n,receive_image:function(){var s=(0,r.c)(function*(g,M,p){let E="tmp_files/modify_image.png";yield e.indexed.saveBase64ToUserPath(","+g,E),e.modalCtrl.dismiss({type:"image",path:E,width:M,height:p,msg:e.MessageInfo,index:e.RelevanceIndex-1})});return function(M,p,E){return s.apply(this,arguments)}}()},"start_load_pck")}var s;e.ContentOnLoad=!0,e.ContentFailedLoad=!1,n&&URL.revokeObjectURL(n),e.FileInfo.url?e.global.godot_window.download_url():e.global.godot_window.start_load_pck()}),100);break;case"blender":let c=yield e.loadingCtrl.create({message:e.lang.text.ContentViewer.OnLoadContent});c.present(),e.p5canvas=e.global.load_blender_file(e.canvasDiv,e.FileInfo,c,()=>{e.ContentOnLoad=!0,e.ContentFailedLoad=!1},()=>{e.ContentFailedLoad=!0});break;default:console.log("\uc815\uc758\ub418\uc9c0 \uc54a\uc740 \ud30c\uc77c \uc815\ubcf4: ",e.FileInfo.viewer);case"disabled":e.p5canvas=new Z(o=>{o.setup=()=>{o.noCanvas()}}),e.ContentOnLoad=!0}e.ChangeContentWithKeyInput()})()}ChangeContentWithKeyInput(){this.p5canvas&&(this.p5canvas.keyPressed=e=>{if(!this.isTextEditMode)switch(e.code){case"KeyA":case"ArrowLeft":this.ChangeToAnother(-1);break;case"KeyS":this.NeedDownloadFile?this.DownloadCurrentFile():this.download_file();break;case"KeyD":case"ArrowRight":this.ChangeToAnother(1)}})}open_bottom_modal(){this.ShowContentInfoIonic.onDidDismiss().then(e=>{this.useP5Navigator=!0}),this.useP5Navigator=!1,this.ShowContentInfoIonic.present()}open_text_editor(e=this.p5canvas.TextArea){this.p5canvas.SyntaxHighlightReader.style.display="none",e.style.display="block",e.disabled=!1,setTimeout(()=>{this.isTextEditMode=!0,e.focus()},500)}open_text_reader(e=this.p5canvas){if(!e.SyntaxHighlightReader){let R=e.createDiv();R.elt.className="infobox",R.elt.setAttribute("style",`height: ${e.TextArea.clientHeight}px; display: block; overflow-y: auto;`),this.canvasDiv.appendChild(R.elt),e.SyntaxHighlightReader=R.elt}let a=e.TextArea.textContent.split("\n");const c=["void","static","import","export","interface","include","#include","using","from","as","public","protected","private","use","package","local","async","await","program","namespace","begin","end","puts","Private","Protected","Public","Sub","End","var","let","enum","String","char","Integer","Float","Boolean","Array","NULL","Resource","strings","integer","complex","byte","ubyte","int","uint","short","ushort","long","ulong","bvec2","bvec3","bvec4","ivec2","ivec3","ivec4","uvec2","uvec3","uvec4","mat2","mat3","mat4","Vector","Vector2","Vector3","PVector","PImage","PGraphics","float","double","number","color","bool","boolean","Arary","Object","Table","TableRow","HashMap","JSONObject","JSONArray","ArrayList","IntDict","IntList","FloatDict","FloatList","StringDict","StringList","null","undefined","data","function","func","fn","def","fun","class","extends","implements","object","override","partial"],o=["final","const"],s=["for","match","switch","if","else","elif","return","continue","pass","throw","loop","while","in","try","catch","and","or","do","then","yield"],g=["!=",">=","<=","==","<",">"],M=["#","##","\x3c!--","--\x3e","/**","*/","//"],p=["="],E=["{","}","<<",">>",":","(",")","[","]",">>>","->","<-","=>","<="],w=["SELECT","UPDATE","DELETE","INSERT INTO","CREATE DATABASE","ALTER DATABASE","CREATE TABLE","ALTER TABLE","DROP TABLE","CREATE INDEX","DROP INDEX","ECHO","FROM","WHERE","AND","OR","NOT","ALTER","ADD","echo","<?php","?>"];for(let R=0,B=a.length;R<B;R++){let f=e.createDiv(),Y=a[R].split(" "),ce=!1;for(let H=0,Ce=Y.length;H<Ce;H++){let v=this.HTMLEncode(Y[H]),N=!1;for(let y=0,U=M.length;y<U;y++)if(Y[H]==M[y]){ce=!0;break}if(!ce){for(let y=0,U=p.length;y<U;y++)if(Y[H]==p[y]){let D=e.createSpan(v+"&nbsp");D.style("color","var(--syntax-text-coding-equalmark)"),D.style("white-space","break-spaces"),D.parent(f),N=!0;break}if(N)continue;for(let y=0,U=o.length;y<U;y++)if(Y[H]==o[y]){let D=e.createSpan(v+"&nbsp");D.style("color","var(--syntax-text-coding-final)"),D.style("white-space","break-spaces"),D.parent(f),N=!0;break}for(let y=0,U=g.length;y<U;y++)if(Y[H]==g[y]){let D=e.createSpan(v+"&nbsp");D.style("color","var(--syntax-text-coding-comparion-op)"),D.style("white-space","break-spaces"),D.parent(f),N=!0;break}if(N||N)continue;for(let y=0,U=s.length;y<U;y++)if(Y[H]==s[y]){let D=e.createSpan(v+"&nbsp");D.style("color","var(--syntax-text-coding-operator)"),D.style("white-space","break-spaces"),D.parent(f),N=!0;break}if(N)continue;for(let y=0,U=E.length;y<U;y++)if(Y[H]==E[y]){let D=e.createSpan(v+"&nbsp");D.style("color","var(--syntax-text-coding-spechar)"),D.style("white-space","break-spaces"),D.parent(f),N=!0;break}if(N)continue;for(let y=0,U=w.length;y<U;y++)if(Y[H]==w[y]){let D=e.createSpan(v+"&nbsp");D.style("color","var(--syntax-text-coding-command)"),D.style("white-space","break-spaces"),D.parent(f),N=!0;break}if(N)continue;for(let y=0,U=c.length;y<U;y++)if(Y[H]==c[y]){let D=e.createSpan(v+"&nbsp");D.style("color","var(--syntax-text-coding-basic)"),D.style("white-space","break-spaces"),D.parent(f),N=!0;break}if(N)continue}let A=e.createSpan(v+"&nbsp");ce&&A.style("color","var(--syntax-text-coding-comments)"),A.style("white-space","break-spaces"),A.parent(f)}f.parent(e.SyntaxHighlightReader)}e.TextArea.style.display="none",e.SyntaxHighlightReader.style.display="block"}HTMLEncode(e){let n=(e=[...e]).length,a=[];for(;n--;){var c=e[n].codePointAt(0);a[n]=c<65||c>127||c>90&&c<97?"&#"+c+";":e[n]}return a.join("")}SaveText(){var e=this;return(0,r.c)(function*(){let n=new Blob([e.p5canvas.TextArea.value],{type:e.FileInfo.type});if(n.name=e.NewTextFileName||e.FileInfo.filename||e.FileInfo.name,e.OpenInChannelChat)e.modalCtrl.dismiss({type:"text",blob:n,contentRelated:e.FileInfo.content_related_creator});else{let a=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});a.present();let c=`tmp_files/texteditor/${e.FileInfo.filename||e.FileInfo.name}`;e.FileInfo.path||(e.FileInfo.path=c),yield e.indexed.saveBlobToUserPath(n,c),a.dismiss(),e.p5toast.show({text:e.lang.text.ContentViewer.fileSaved}),e.modalCtrl.dismiss({type:"text",blob:n,path:c,index:e.RelevanceIndex-1})}})()}modify_image(){var e=this;return(0,r.c)(function*(){switch(e.FileInfo.viewer){case"image":{let a=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});a.present();try{let c;e.image_info.path=e.FileInfo.path||e.navParams.get("path"),e.FileInfo.url&&(e.image_info.path="tmp_files/modify_image.png",c=yield fetch(e.FileInfo.url).then(o=>o.blob()),yield e.indexed.saveBlobToUserPath(c,e.image_info.path)),e.modalCtrl.dismiss({type:"image",...e.image_info,path:e.image_info.path,msg:e.MessageInfo,index:e.RelevanceIndex-1})}catch(c){e.p5toast.show({text:`${e.lang.text.ContentViewer.CannotEditFile}: ${c}`})}a.dismiss()}break;case"code":case"text":let n=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});n.present();try{e.p5canvas.SyntaxHighlightReader.style.height="fit-content";let a=yield ue.toBlob(e.p5canvas.SyntaxHighlightReader);e.image_info.width=e.p5canvas.SyntaxHighlightReader.clientWidth,e.image_info.height=e.p5canvas.SyntaxHighlightReader.clientHeight,e.image_info.path="tmp_files/modify_image.png",yield e.indexed.saveBlobToUserPath(a,e.image_info.path),e.modalCtrl.dismiss({type:"image",...e.image_info,path:e.image_info.path,msg:e.MessageInfo,index:e.RelevanceIndex-1,isDarkMode:e.global.GetExactDarkMode()})}catch(a){e.p5toast.show({text:`${e.lang.text.ContentViewer.CannotEditFile}: ${a}`})}n.dismiss();break;case"video":try{let a=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});a.present(),e.p5canvas.pixelDensity(1),e.p5canvas.VideoMedia.pause(),e.p5canvas.VideoMedia.size(e.image_info.width,e.image_info.height);let c=e.p5canvas.createCanvas(e.image_info.width,e.image_info.height);e.p5canvas.image(e.p5canvas.VideoMedia,0,0,e.p5canvas.width,e.p5canvas.height);let o=c.elt.toDataURL("image/png").replace("image/png","image/octet-stream");try{a.dismiss(),e.image_info.path="tmp_files/modify_image.png",yield e.indexed.saveBase64ToUserPath(o,e.image_info.path),e.modalCtrl.dismiss({type:"image",...e.image_info,msg:e.MessageInfo,index:e.RelevanceIndex-1})}catch(s){console.log("\ud30c\uc77c \uc800\uc7a5 \uc624\ub958: ",s)}}catch(a){console.log("\uc7ac\uc0dd\uc911\uc778 \ube44\ub514\uc624 \uc774\ubbf8\uc9c0 \ucd94\ucd9c \uc624\ub958: ",a)}break;case"blender":try{let a=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});a.present(),e.p5canvas.pixelDensity(1);let c=e.p5canvas.canvas.elt.toDataURL("image/png").replace("image/png","image/octet-stream");try{a.dismiss(),e.image_info.path="tmp_files/modify_image.png",e.image_info.width=e.p5canvas.width,e.image_info.height=e.p5canvas.height,yield e.indexed.saveBase64ToUserPath(c,e.image_info.path),e.modalCtrl.dismiss({type:"image",...e.image_info,msg:e.MessageInfo,index:e.RelevanceIndex-1,isDarkMode:e.global.GetExactDarkMode()})}catch(o){console.log("\ud30c\uc77c \uc800\uc7a5 \uc624\ub958: ",o)}}catch(a){console.log("\uc7ac\uc0dd\uc911\uc778 \ube44\ub514\uc624 \uc774\ubbf8\uc9c0 \ucd94\ucd9c \uc624\ub958: ",a)}break;case"godot":e.global.godot_window.modify_image();break;default:console.log("\ud3b8\uc9d1 \ubd88\uac00 \ud30c\uc77c \uc815\ubcf4: ",e.FileInfo)}})()}download_file(){var e=this;return(0,r.c)(function*(){if("DesktopPWA"==z.s1||"MobilePWA"==z.s1)if(e.FileInfo.url)try{let n=yield fetch(e.FileInfo.url),a=yield n.blob();if(!n.ok)throw"\uc81c\ub300\ub85c \ub2e4\uc6b4\ubc1b\uc544\uc9c0\uc9c0 \uc54a\uc74c";yield e.indexed.saveBlobToUserPath(a,e.FileInfo.path),e.indexed.DownloadFileFromUserPath(e.FileInfo.path,e.FileInfo.type,e.FileInfo.filename||e.FileInfo.name)}catch(n){console.log("\ub2e4\uc6b4\ubc1b\uae30 \uc2e4\ud328: ",n),e.p5toast.show({text:`${e.lang.text.Nakama.FailedDownload}: ${n}`})}else e.indexed.DownloadFileFromUserPath(e.FileInfo.path,e.FileInfo.type,e.FileInfo.filename||e.FileInfo.name);else e.alertCtrl.create({header:e.lang.text.ContentViewer.Filename,inputs:[{name:"filename",placeholder:e.FileInfo.filename||e.FileInfo.name,type:"text"}],buttons:[{text:e.lang.text.ContentViewer.saveFile,handler:(n=(0,r.c)(function*(a){if(e.FileInfo.url)try{let c=yield fetch(e.FileInfo.url),o=yield c.blob();if(!c.ok)throw"\uc81c\ub300\ub85c \ub2e4\uc6b4\ubc1b\uc544\uc9c0\uc9c0 \uc54a\uc74c";yield e.indexed.saveBlobToUserPath(o,e.FileInfo.path),e.DownloadFileAct(a)}catch(c){console.log("\ub2e4\uc6b4\ubc1b\uae30 \uc2e4\ud328: ",c),e.p5toast.show({text:`${e.lang.text.Nakama.FailedDownload}: ${c}`})}else e.DownloadFileAct(a)}),function(c){return n.apply(this,arguments)})}]}).then(n=>n.present());var n})()}DownloadFileAct(e){var n=this;return(0,r.c)(function*(){let a=yield n.loadingCtrl.create({message:n.lang.text.TodoDetail.WIP});a.present();let c=e.filename?e.filename.replace(/:|\?|\/|\\|<|>/g,""):n.FileInfo.filename||n.FileInfo.name,o=yield n.indexed.loadBlobFromUserPath(n.FileInfo.path,n.FileInfo.type);n.forceWrite&&!e.filename?n.file.writeExistingFile(n.file.externalDataDirectory,c,o).then(s=>{n.forceWrite=!1,a.dismiss(),n.p5toast.show({text:`${n.lang.text.ContentViewer.OverWriteFile}: ${c}`})}):n.file.writeFile(n.file.externalDataDirectory,c,o).then(s=>{a.dismiss(),n.p5toast.show({text:n.lang.text.ContentViewer.fileSaved})}).catch(s=>{12===(a.dismiss(),s.code)?(n.p5toast.show({text:n.lang.text.ContentViewer.AlreadyExist}),n.forceWrite=!0,n.download_file()):console.log("\uc900\ube44\ub418\uc9c0 \uc54a\uc740 \uc624\ub958 \ubc18\ud658: ",s)})})()}toast_info(e){e.various_display||this.set_various_display(e),this.p5toast.show({text:e.various_display})}ShareContent(){let e=this.nakama.rearrange_channels();for(let n=e.length-1;n>=0;n--)("missing"==e[n].status||"offline"==e[n].status)&&e.splice(n,1);e.length?this.modalCtrl.create({component:te._,componentProps:{file:this.FileInfo,channels:e}}).then(n=>{n.onDidDismiss().then(a=>{a.data&&this.modalCtrl.dismiss({share:!0})}),n.present()}):this.p5toast.show({text:this.lang.text.ShareContentToOther.NoChannelToShare})}RemoveFile(){this.alertCtrl.create({header:this.lang.text.ContentViewer.RemoveFile,message:this.FileInfo.path,buttons:[{text:this.lang.text.TodoDetail.remove,handler:()=>{this.RemoveFileAct()},cssClass:"redfont"}]}).then(e=>e.present())}RemoveFileAct(){var e=this;return(0,r.c)(function*(){URL.revokeObjectURL(e.FileURL),delete e.FileInfo.thumbnail,delete e.FileInfo.text,yield e.indexed.removeFileFromUserPath(e.FileInfo.path),e.RelevanceIndex-=1,e.ChangeToAnother(1)})()}ionViewWillLeave(){var e=this;return(0,r.c)(function*(){switch(document.removeEventListener("ionBackButton",e.EventListenerAct),e.FileInfo.viewer){case"video":try{let c,o,a=e.p5canvas.VideoMedia.size();a.width>a.height?(c=192,o=a.height/a.width*192):(c=a.width/a.height*192,o=192);let s=e.p5canvas.createCanvas(c,o);e.p5canvas.pixelDensity(1),e.p5canvas.imageMode(e.p5canvas.CORNER),e.p5canvas.image(e.p5canvas.VideoMedia,0,0,c,o),e.p5canvas.fill(255,128),e.p5canvas.rect(0,0,c,o),e.p5canvas.textWrap(e.p5canvas.CHAR),e.p5canvas.textSize(16);let g=o/16;e.p5canvas.push(),e.p5canvas.translate(g/6,g/6),e.p5canvas.fill(0),e.p5canvas.text(e.FileInfo.filename||e.FileInfo.name,g,g,c-2*g,o-2*g),e.p5canvas.filter(e.p5canvas.BLUR,3,!1),e.p5canvas.pop(),e.p5canvas.fill(255),e.p5canvas.text(e.FileInfo.filename||e.FileInfo.name,g,g,c-2*g,o-2*g);let M=s.elt.toDataURL("image/png").replace("image/png","image/octet-stream");try{yield e.indexed.saveBase64ToUserPath(M,`${e.FileInfo.path}_thumbnail.png`),e.FileInfo.thumbnail=M,e.global.modulate_thumbnail(e.FileInfo,""),e.p5canvas&&e.p5canvas.remove()}catch(p){console.log("\uc378\ub124\uc77c \uc800\uc7a5 \uc624\ub958: ",p)}}catch(a){console.log("\ube44\ub514\uc624 \uc378\ub124\uc77c \uc0dd\uc131 \ucde8\uc18c: ",a)}break;case"godot":try{e.global.godot_window.filename=e.FileInfo.filename||e.FileInfo.name,e.global.godot_window.create_thumbnail(e.FileInfo),(yield e.indexed.GetFileListFromDB("tmp_files",void 0,e.indexed.godotDB)).forEach(c=>e.indexed.removeFileFromUserPath(c,void 0,e.indexed.godotDB)),e.p5canvas&&e.p5canvas.remove()}catch(a){console.log("godot \uc378\ub124\uc77c \uc800\uc7a5 \uc624\ub958: ",a)}break;case"blender":let n=e.p5canvas.canvas.elt.toDataURL("image/png").replace("image/png","image/octet-stream");try{new Z(a=>{a.setup=()=>{a.loadImage(n,function(){var c=(0,r.c)(function*(o){let s,g;o.width>o.height?(s=192,g=o.height/o.width*192):(s=o.width/o.height*192,g=192);let M=a.createCanvas(s,g);a.pixelDensity(1),a.imageMode(a.CORNER),a.image(o,0,0,a.width,a.height),a.fill(255,128),a.rect(0,0,s,g),a.textWrap(a.CHAR),a.textSize(16);let p=g/16;a.push(),a.translate(p/6,p/6),a.fill(0),a.text(e.FileInfo.filename||e.FileInfo.name,p,p,s-2*p,g-2*p),a.filter(a.BLUR,3,!1),a.pop(),a.fill(255),a.text(e.FileInfo.filename||e.FileInfo.name,p,p,s-2*p,g-2*p);let E=M.elt.toDataURL("image/png").replace("image/png","image/octet-stream");yield e.indexed.saveBase64ToUserPath(E,`${e.FileInfo.path}_thumbnail.png`),e.FileInfo.thumbnail=E,e.global.modulate_thumbnail(e.FileInfo,""),a.remove(),e.p5canvas&&e.p5canvas.remove()});return function(o){return c.apply(this,arguments)}}(),c=>{console.log("\ube14\ub80c\ub354 \uc378\ub124\uc77c \ubc30\uacbd \ubc1b\uc544\uc624\uae30 \uc624\ub958: ",c),a.remove(),e.p5canvas&&e.p5canvas.remove()})}})}catch(a){console.log("blender \uc378\ub124\uc77c \uc800\uc7a5 \uc624\ub958: ",a)}break;default:e.p5canvas&&e.p5canvas.remove()}URL.revokeObjectURL(e.FileURL);try{(yield e.file.checkFile(e.file.externalDataDirectory,`viewer_tmp.${e.FileInfo.file_ext}`))&&(yield e.file.removeFile(e.file.externalDataDirectory,`viewer_tmp.${e.FileInfo.file_ext}`))}catch{}})()}ionViewDidLeave(){this.noti.ClearNoti(6)}copy_url(e){this.mClipboard.copy(e).catch(n=>{me.c.write(e).then(()=>{"DesktopPWA"==z.s1&&this.p5toast.show({text:`${this.lang.text.GlobalAct.PCClipboard}: ${e}`})})})}}return(l=T).\u0275fac=function(e){return new(e||l)(t.GI1(G.qS),t.GI1(ve.a6),t.GI1(_e.k),t.GI1(pe.o),t.GI1(S.S),t.GI1(ne.O),t.GI1(G.iW),t.GI1(G.Kg),t.GI1(k.A1),t.GI1(V.h),t.GI1(J._),t.GI1(he.s))},l.\u0275cmp=t.In1({type:l,selectors:[["app-ionic-viewer"]],viewQuery:function(e,n){if(1&e&&(t.CC$(h,5),t.CC$(m,5)),2&e){let a;t.wto(a=t.Gqi())&&(n.FileMenu=a.first),t.wto(a=t.Gqi())&&(n.ShowContentInfoIonic=a.first)}},decls:28,vars:17,consts:[[1,"ion-no-border"],["id","Toolbar"],["slot","start",3,"click"],["defaultHref",""],["class","relevance_change","style","padding-right: 16px;","slot","end","name","pause-circle",3,"click",4,"ngIf"],["class","relevance_change","style","padding-right: 16px;","slot","end","name","play-circle",3,"click",4,"ngIf"],["class","relevance_change","style","padding-right: 4px;","slot","end","name","arrow-back-circle-outline",3,"click",4,"ngIf"],["slot","end",4,"ngIf"],["class","relevance_change","style","padding-right: 16px; padding-left: 4px;","slot","end","name","arrow-forward-circle-outline",3,"click",4,"ngIf"],["id","ContentBox"],[1,"main_table_elt"],[2,"height","0"],["id","FileHeader",2,"max-width","100vw"],["text-wrap","","style","overflow-x: auto;",4,"ngIf"],["type","text","text-warp","","style","overflow-x: auto; overflow-y: hidden;",3,"ngModel","placeholder","ngModelChange",4,"ngIf"],[3,"click",4,"ngIf"],["id","menu_trigger",4,"ngIf"],["trigger","menu_trigger","dismissOnSelect","",4,"ngIf"],[4,"ngIf"],[3,"initialBreakpoint","breakpoints"],["ShowContentInfoIonic",""],["slot","end","name","pause-circle",1,"relevance_change",2,"padding-right","16px",3,"click"],["slot","end","name","play-circle",1,"relevance_change",2,"padding-right","16px",3,"click"],["slot","end","name","arrow-back-circle-outline",1,"relevance_change",2,"padding-right","4px",3,"click"],["slot","end"],["slot","end","name","arrow-forward-circle-outline",1,"relevance_change",2,"padding-right","16px","padding-left","4px",3,"click"],["text-wrap","",2,"overflow-x","auto"],["type","text","text-warp","",2,"overflow-x","auto","overflow-y","hidden",3,"ngModel","placeholder","ngModelChange"],[3,"click"],["name","close-circle-outline"],["name","save-outline"],["id","menu_trigger"],["name","ellipsis-vertical"],["trigger","menu_trigger","dismissOnSelect",""],["FileMenu",""],["button","",3,"click",4,"ngIf"],["button","",3,"click"],["id","content_viewer_canvas",1,"full_screen",2,"max-width","100vw","position","relative"],[1,"disconnect_info"],["color","medium","name","attach-outline",2,"width","60px","height","60px"],["color","medium"],["color","medium","name","close-circle-outline",2,"width","60px","height","60px"],[1,"ion-align-items-center"],["size","12",1,"ion-text-center"],["color","warning","shape","round",1,"ion-align-items-center",3,"disabled","click"],["button","",4,"ngIf"],[1,"ion-text-end"],[4,"ngFor","ngForOf"],[1,"ion-text-center"],["button",""],[1,"history_center"],["color","secondary","mode","ios","outline","true",3,"click"],["name","document-attach-outline",4,"ngIf"],["name","camera-outline",4,"ngIf"],["name","link-outline",4,"ngIf"],["name","text-outline",4,"ngIf"],["name","document-text-outline",4,"ngIf"],["name","share-social-outline",4,"ngIf"],["name","document-attach-outline"],["name","camera-outline"],["name","link-outline"],["name","text-outline"],["name","document-text-outline"],["name","share-social-outline"],["src","assets/icon/voidDraw.png"]],template:function(e,n){1&e&&(t.I0R(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-title"),t.OEk(3),t.C$Y(),t.I0R(4,"ion-buttons",2),t.qCj("click",function(){return n.modalCtrl.dismiss()}),t.wR5(5,"ion-back-button",3),t.C$Y(),t.yuY(6,x,1,0,"ion-icon",4)(7,O,1,0,"ion-icon",5)(8,P,1,0,"ion-icon",6)(9,I,2,1,"ion-label",7)(10,C,1,0,"ion-icon",8),t.C$Y()(),t.I0R(11,"ion-content",9)(12,"table",10)(13,"tr",11)(14,"td")(15,"ion-list-header",12),t.yuY(16,K,2,1,"ion-label",13)(17,ie,1,2,"ion-input",14)(18,$,2,0,"ion-button",15)(19,de,2,0,"ion-button",15)(20,Q,2,0,"ion-button",16)(21,b,3,0,"ion-popover",17),t.C$Y()()(),t.I0R(22,"tr"),t.yuY(23,j,4,2,"td",18)(24,ae,6,2,"td",18),t.C$Y()(),t.I0R(25,"ion-modal",19,20),t.yuY(27,Re,19,9,"ng-template"),t.C$Y()()),2&e&&(t.yG2(3),t.cNF(n.lang.text.ContentViewer.Title),t.yG2(3),t.E7m("ngIf",n.HaveRelevances&&("video"==n.FileInfo.viewer||"audio"==n.FileInfo.viewer)&&n.AutoPlayNext),t.yG2(),t.E7m("ngIf",n.HaveRelevances&&("video"==n.FileInfo.viewer||"audio"==n.FileInfo.viewer)&&!n.AutoPlayNext),t.yG2(),t.E7m("ngIf",n.HaveRelevances),t.yG2(),t.E7m("ngIf",n.HaveRelevances),t.yG2(),t.E7m("ngIf",n.HaveRelevances),t.yG2(6),t.E7m("ngIf",!n.isTextEditMode),t.yG2(),t.E7m("ngIf",n.isTextEditMode),t.yG2(),t.E7m("ngIf",n.isTextEditMode),t.yG2(),t.E7m("ngIf",n.isTextEditMode),t.yG2(),t.E7m("ngIf",!n.isTextEditMode),t.yG2(),t.E7m("ngIf",!n.isTextEditMode),t.yG2(2),t.E7m("ngIf",!n.NeedDownloadFile),t.yG2(),t.E7m("ngIf",n.NeedDownloadFile),t.yG2(),t.E7m("initialBreakpoint",.5)("breakpoints",t.q4q(16,De)))},dependencies:[fe.ay,fe.u_,u.ue,u._G,G.O7,G.sn,G.GS,G.cz,G.Kk,G._i,G.YP,G.wB,G.Ko,G.A5,G.Yb,G.S8,G.QR,G.OC,G.zz,G.qo,G.tM,G.Md,G.yc,G.sW,G.qG,G.Im],styles:[".main_table_elt[_ngcontent-%COMP%]{width:100%;height:100%;border:0;margin:0}.relevance_change[_ngcontent-%COMP%]{width:25px;height:25px}.history_center[_ngcontent-%COMP%]{text-align:center}"]}),T})()},896:(be,xe,d)=>{"use strict";d.d(xe,{_:()=>pe});var r=d(4496),z=d(4500),Z=d(9240),X=d(5624),te=d(4180),me=d(7136),ue=d(1368);function we(S,ne){if(1&S&&r.wR5(0,"img",12),2&S){const k=r.GaO().$implicit;r.m_g("online"==k.status||3==k.redirect.type&&"pending"==k.status?"filter: grayscale(0) contrast(1)":"filter: grayscale(.9) contrast(1.4)"),r.E7m("src",k.info.img||"assets/data/channel.svg",r.K6U)}}function t(S,ne){if(1&S&&r.wR5(0,"div",13),2&S){const k=r.GaO().$implicit,V=r.GaO();r.m_g("background-color: "+V.statusBar.colors[k.status||"offline"])}}function G(S,ne){if(1&S&&r.wR5(0,"div",14),2&S){const k=r.GaO().$implicit;r.m_g("background-image: linear-gradient(to right, #0000, #"+(k.color||"abcdef")+"44)")}}function ve(S,ne){if(1&S&&(r.I0R(0,"td",15),r.OEk(1),r.C$Y()),2&S){const k=r.GaO().$implicit,V=r.GaO();r.yG2(),r.oRS(" ","("+(k.local?V.lang.text.AddGroup.UseLocalStorage:k.server.name||k.server.target)+")"," ")}}function _e(S,ne){if(1&S){const k=r.KQA();r.I0R(0,"ion-item",4),r.qCj("click",function(){const he=r.usT(k).$implicit,fe=r.GaO();return r.CGJ(fe.go_to_chatroom(he))}),r.I0R(1,"div",5),r.yuY(2,we,1,3,"img",6)(3,t,1,2,"div",7),r.C$Y(),r.yuY(4,G,1,2,"div",8),r.I0R(5,"ion-label")(6,"div",9)(7,"table")(8,"tr")(9,"td"),r.OEk(10),r.C$Y(),r.yuY(11,ve,2,1,"td",10),r.C$Y()()(),r.I0R(12,"div",11),r.OEk(13),r.C$Y()()()}if(2&S){const k=ne.$implicit,V=r.GaO();r.yG2(2),r.E7m("ngIf",k.info),r.yG2(),r.E7m("ngIf",!k.local),r.yG2(),r.E7m("ngIf",k.is_new),r.yG2(6),r.oRS(" ",k.info?k.info.name||k.info.display_name||V.lang.text.ChatRoom.noname_chatroom:k.title||V.lang.text.ChatRoom.noname_chatroom," "),r.yG2(),r.E7m("ngIf",V.nakama.showServer),r.yG2(2),r.oRS(" ",k.last_comment||k.noti||V.lang.text.Subscribes.noMessageHistory," ")}}let pe=(()=>{var S;class ne{constructor(V,J,he,fe,u){this.lang=V,this.navParams=J,this.modalCtrl=he,this.statusBar=fe,this.nakama=u,this.BackButtonPressed=!1}InitBrowserBackButtonOverride(){window.history.replaceState(null,null,window.location.href),window.onpopstate=()=>{this.BackButtonPressed||(this.BackButtonPressed=!0,this.modalCtrl.dismiss())}}ngOnInit(){this.InitBrowserBackButtonOverride(),this.channels=this.navParams.get("channels")}go_to_chatroom(V){let J=this.navParams.get("file");delete J.db,this.nakama.go_to_chatroom_without_admob_act(V,J),this.modalCtrl.dismiss(!0)}}return(S=ne).\u0275fac=function(V){return new(V||S)(r.GI1(z.o),r.GI1(Z.a6),r.GI1(X.qS),r.GI1(te.Y),r.GI1(me.h))},S.\u0275cmp=r.In1({type:S,selectors:[["app-share-content-to-other"]],decls:11,vars:3,consts:[[1,"ion-no-border"],["slot","start",3,"click"],["defaultHref",""],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"],[1,"channel_image","channel_image_div"],["class","channel_image","alt","ch_img",3,"src","style",4,"ngIf"],["class","status_circle",3,"style",4,"ngIf"],["class","additional_form new_bg_form",3,"style",4,"ngIf"],[1,"channel_text_form","header"],["class","server_target",4,"ngIf"],[1,"channel_text_form","content"],["alt","ch_img",1,"channel_image",3,"src"],[1,"status_circle"],[1,"additional_form","new_bg_form"],[1,"server_target"]],template:function(V,J){1&V&&(r.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),r.OEk(3),r.C$Y(),r.I0R(4,"ion-buttons",1),r.qCj("click",function(){return J.modalCtrl.dismiss()}),r.wR5(5,"ion-back-button",2),r.C$Y()()(),r.I0R(6,"ion-content")(7,"ion-item-divider")(8,"ion-label"),r.OEk(9),r.C$Y()(),r.yuY(10,_e,14,6,"ion-item",3),r.C$Y()),2&V&&(r.yG2(3),r.cNF(J.lang.text.ShareContentToOther.Title),r.yG2(6),r.cNF(J.lang.text.ShareContentToOther.AvailableChannels),r.yG2(),r.E7m("ngForOf",J.channels))},dependencies:[ue.ay,ue.u_,X.GS,X._i,X.wB,X.Yb,X.S8,X.QR,X.tM,X.Md,X.Im],styles:[".header[_ngcontent-%COMP%]{padding-bottom:4px}.content[_ngcontent-%COMP%]{color:#888;height:24px;line-height:24px;vertical-align:middle;overflow:hidden}.channel_image_div[_ngcontent-%COMP%]{position:absolute}.channel_image[_ngcontent-%COMP%]{width:52px;height:52px;border-radius:64px;object-fit:cover}.status_circle[_ngcontent-%COMP%]{position:relative;top:-56px;left:38px;width:12px;height:12px;border-radius:12px}.channel_text_form[_ngcontent-%COMP%]{margin-left:64px}"]}),ne})()},7668:function(be){!function(xe){"use strict";var d=function V(){return{escape:function de(_){return _.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")},parseExtension:h,mimeType:function m(_){var b=h(_).toLowerCase();return function u(){var _="application/font-woff",b="image/jpeg";return{woff:_,woff2:_,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:b,jpeg:b,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}()[b]||""},dataAsUrl:function $(_,b){return"data:"+b+";base64,"+_},isDataUrl:function x(_){return-1!==_.search(/^(data:)/)},canvasToBlob:function P(_){return _.toBlob?new Promise(function(b){_.toBlob(b)}):function O(_){return new Promise(function(b){for(var L=window.atob(_.toDataURL().split(",")[1]),F=L.length,j=new Uint8Array(F),ae=0;ae<F;ae++)j[ae]=L.charCodeAt(ae);b(new Blob([j],{type:"image/png"}))})}(_)},resolveUrl:function I(_,b){var L=document.implementation.createHTMLDocument(),F=L.createElement("base");L.head.appendChild(F);var j=L.createElement("a");return L.body.appendChild(j),F.href=b,j.href=_,j.href},getAndEncode:function ie(_){return te.impl.options.cacheBust&&(_+=(/\?/.test(_)?"&":"?")+(new Date).getTime()),new Promise(function(L){var j,F=new XMLHttpRequest;if(F.onreadystatechange=function ye(){if(4===F.readyState){if(200!==F.status)return void(j?L(j):re("cannot fetch resource: "+_+", status: "+F.status));var le=new FileReader;le.onloadend=function(){var ge=le.result.split(/,/)[1];L(ge)},le.readAsDataURL(F.response)}},F.ontimeout=function Ie(){j?L(j):re("timeout of 30000ms occured while fetching resource: "+_)},F.responseType="blob",F.timeout=3e4,F.open("GET",_,!0),F.send(),te.impl.options.imagePlaceholder){var ae=te.impl.options.imagePlaceholder.split(/,/);ae&&ae[1]&&(j=ae[1])}function re(le){console.error(le),L("")}})},uid:function C(){var _=0;return function(){return"u"+function b(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}()+_++}}(),delay:function Q(_){return function(b){return new Promise(function(L){setTimeout(function(){L(b)},_)})}},asArray:function W(_){for(var b=[],L=_.length,F=0;F<L;F++)b.push(_[F]);return b},escapeXhtml:function q(_){return _.replace(/#/g,"%23").replace(/\n/g,"%0A")},makeImage:function K(_){return new Promise(function(b,L){var F=new Image;F.onload=function(){b(F)},F.onerror=L,F.src=_})},width:function se(_){var b=oe(_,"border-left-width"),L=oe(_,"border-right-width");return _.scrollWidth+b+L},height:function ee(_){var b=oe(_,"border-top-width"),L=oe(_,"border-bottom-width");return _.scrollHeight+b+L}};function h(_){var b=/\.([^\.\/]*?)$/g.exec(_);return b?b[1]:""}function oe(_,b){var L=window.getComputedStyle(_).getPropertyValue(b);return parseFloat(L.replace("px",""))}}(),r=function J(){var u=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:function O(P,I,C){return function K(){return!h(P)}()?Promise.resolve(P):Promise.resolve(P).then(m).then(function(ie){var $=Promise.resolve(P);return ie.forEach(function(de){$=$.then(function(Q){return x(Q,de,I,C)})}),$})},shouldProcess:h,impl:{readUrls:m,inline:x}};function h(P){return-1!==P.search(u)}function m(P){for(var C,I=[];null!==(C=u.exec(P));)I.push(C[1]);return I.filter(function(K){return!d.isDataUrl(K)})}function x(P,I,C,K){return Promise.resolve(I).then(function($){return C?d.resolveUrl($,C):$}).then(K||d.getAndEncode).then(function($){return d.dataAsUrl($,d.mimeType(I))}).then(function($){return P.replace(function ie($){return new RegExp("(url\\(['\"]?)("+d.escape($)+")(['\"]?\\))","g")}(I),"$1"+$+"$3")})}}(),z=function he(){return{resolveAll:function u(){return h(document).then(function(m){return Promise.all(m.map(function(x){return x.resolve()}))}).then(function(m){return m.join("\n")})},impl:{readAll:h}};function h(){return Promise.resolve(d.asArray(document.styleSheets)).then(function x(P){var I=[];return P.forEach(function(C){try{d.asArray(C.cssRules||[]).forEach(I.push.bind(I))}catch(K){console.log("Error while reading CSS rules from "+C.href,K.toString())}}),I}).then(function m(P){return P.filter(function(I){return I.type===CSSRule.FONT_FACE_RULE}).filter(function(I){return r.shouldProcess(I.style.getPropertyValue("src"))})}).then(function(P){return P.map(O)});function O(P){return{resolve:function(){return r.inlineAll(P.cssText,(P.parentStyleSheet||{}).href)},src:function(){return P.style.getPropertyValue("src")}}}}}(),Z=function fe(){return{inlineAll:function h(m){return m instanceof Element?function x(O){var P=O.style.getPropertyValue("background");return P?r.inlineAll(P).then(function(I){O.style.setProperty("background",I,O.style.getPropertyPriority("background"))}).then(function(){return O}):Promise.resolve(O)}(m).then(function(){return m instanceof HTMLImageElement?u(m).inline():Promise.all(d.asArray(m.childNodes).map(function(O){return h(O)}))}):Promise.resolve(m)},impl:{newImage:u}};function u(m){return{inline:function x(O){return d.isDataUrl(m.src)?Promise.resolve():Promise.resolve(m.src).then(O||d.getAndEncode).then(function(P){return d.dataAsUrl(P,d.mimeType(m.src))}).then(function(P){return new Promise(function(I,C){m.onload=I,m.onerror=C,m.src=P})})}}}}(),X={imagePlaceholder:void 0,cacheBust:!1},te={toSvg:me,toPng:function we(u,h){return _e(u,h||{}).then(function(m){return m.toDataURL()})},toJpeg:function t(u,h){return _e(u,h=h||{}).then(function(m){return m.toDataURL("image/jpeg",h.quality||1)})},toBlob:function G(u,h){return _e(u,h||{}).then(d.canvasToBlob)},toPixelData:function ue(u,h){return _e(u,h||{}).then(function(m){return m.getContext("2d").getImageData(0,0,d.width(u),d.height(u)).data})},impl:{fontFaces:z,images:Z,util:d,inliner:r,options:{}}};function me(u,h){return function ve(u){te.impl.options.imagePlaceholder=typeof u.imagePlaceholder>"u"?X.imagePlaceholder:u.imagePlaceholder,te.impl.options.cacheBust=typeof u.cacheBust>"u"?X.cacheBust:u.cacheBust}(h=h||{}),Promise.resolve(u).then(function(x){return pe(x,h.filter,!0)}).then(S).then(ne).then(function m(x){return h.bgcolor&&(x.style.backgroundColor=h.bgcolor),h.width&&(x.style.width=h.width+"px"),h.height&&(x.style.height=h.height+"px"),h.style&&Object.keys(h.style).forEach(function(O){x.style[O]=h.style[O]}),x}).then(function(x){return function k(u,h,m){return Promise.resolve(u).then(function(x){return x.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),(new XMLSerializer).serializeToString(x)}).then(d.escapeXhtml).then(function(x){return'<foreignObject x="0" y="0" width="100%" height="100%">'+x+"</foreignObject>"}).then(function(x){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+h+'" height="'+m+'">'+x+"</svg>"}).then(function(x){return"data:image/svg+xml;charset=utf-8,"+x})}(x,h.width||d.width(u),h.height||d.height(u))})}function _e(u,h){return me(u,h).then(d.makeImage).then(d.delay(100)).then(function(x){var O=function m(x){var O=document.createElement("canvas");if(O.width=h.width||d.width(x),O.height=h.height||d.height(x),h.bgcolor){var P=O.getContext("2d");P.fillStyle=h.bgcolor,P.fillRect(0,0,O.width,O.height)}return O}(u);return O.getContext("2d").drawImage(x,0,0),O})}function pe(u,h,m){return m||!h||h(u)?Promise.resolve(u).then(function x(I){return I instanceof HTMLCanvasElement?d.makeImage(I.toDataURL()):I.cloneNode(!1)}).then(function(I){return function O(I,C,K){var ie=I.childNodes;return 0===ie.length?Promise.resolve(C):function $(de,Q,W){var q=Promise.resolve();return Q.forEach(function(se){q=q.then(function(){return pe(se,W)}).then(function(ee){ee&&de.appendChild(ee)})}),q}(C,d.asArray(ie),K).then(function(){return C})}(u,I,h)}).then(function(I){return function P(I,C){return C instanceof Element?Promise.resolve().then(function K(){!function Q(W,q){W.cssText?q.cssText=W.cssText:function se(ee,oe){d.asArray(ee).forEach(function(_){oe.setProperty(_,ee.getPropertyValue(_),ee.getPropertyPriority(_))})}(W,q)}(window.getComputedStyle(I),C.style)}).then(function ie(){[":before",":after"].forEach(function(W){!function Q(W){var q=window.getComputedStyle(I,W),se=q.getPropertyValue("content");if(""!==se&&"none"!==se){var ee=d.uid();C.className=C.className+" "+ee;var oe=document.createElement("style");oe.appendChild(function _(b,L,F){var j="."+b+":"+L,ae=F.cssText?ye(F):Ie(F);return document.createTextNode(j+"{"+ae+"}");function ye(re){var le=re.getPropertyValue("content");return re.cssText+" content: "+le+";"}function Ie(re){return d.asArray(re).map(le).join("; ")+";";function le(ge){return ge+": "+re.getPropertyValue(ge)+(re.getPropertyPriority(ge)?" !important":"")}}}(ee,W,q)),C.appendChild(oe)}}(W)})}).then(function $(){I instanceof HTMLTextAreaElement&&(C.innerHTML=I.value),I instanceof HTMLInputElement&&C.setAttribute("value",I.value)}).then(function de(){C instanceof SVGElement&&(C.setAttribute("xmlns","http://www.w3.org/2000/svg"),C instanceof SVGRectElement&&["width","height"].forEach(function(Q){var W=C.getAttribute(Q);W&&C.style.setProperty(Q,W)}))}).then(function(){return C}):C}(u,I)}):Promise.resolve()}function S(u){return z.resolveAll().then(function(h){var m=document.createElement("style");return u.appendChild(m),m.appendChild(document.createTextNode(h)),u})}function ne(u){return Z.inlineAll(u).then(function(){return u})}be.exports=te}()}}]);