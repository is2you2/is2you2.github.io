"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[600],{8982:(L,M,a)=>{a.d(M,{s:()=>R});var f=a(6505),g=a(774),t=a(2096),s=a(3996),d=a(5742),x=a(3336),P=a(2313),y=a(3496),b=a(9912),I=a(4182),D=a(9808);const o=["Calendar"],m=["ImporantSel"];function u(r,h){if(1&r){const e=t.EpF();t.TgZ(0,"ion-button",25),t.NdJ("click",function(){return t.CHM(e),t.oxw().remove_attach()}),t._uU(1),t.qZA()}if(2&r){const e=t.oxw();t.xp6(1),t.hij(" ",e.lang.text.TodoDetail.delete_attach," ")}}function p(r,h){if(1&r){const e=t.EpF();t.TgZ(0,"img",26),t.NdJ("click",function(){return t.CHM(e),t.oxw().go_to_ionic_viewer()}),t.qZA()}if(2&r){const e=t.oxw();t.Q6J("src",e.ImageURL,t.LSH)}}function A(r,h){if(1&r&&(t.TgZ(0,"div",29),t._uU(1),t.qZA()),2&r){const e=h.$implicit;t.xp6(1),t.hij(" ",e.displayText," ")}}function E(r,h){if(1&r){const e=t.EpF();t.TgZ(0,"div")(1,"ion-item",8),t.NdJ("click",function(){return t.CHM(e),t.oxw().toggle_logs()}),t.TgZ(2,"ion-label"),t._uU(3),t.qZA()(),t.TgZ(4,"div",27),t.YNc(5,A,2,1,"div",28),t.qZA()()}if(2&r){const e=t.oxw();t.xp6(3),t.Oqu(e.lang.text.TodoDetail.logs),t.xp6(1),t.Q6J("hidden",e.isLogsHidden),t.xp6(1),t.Q6J("ngForOf",e.userInput.logs)}}function w(r,h){if(1&r){const e=t.EpF();t.TgZ(0,"td")(1,"ion-button",30),t.NdJ("click",function(){return t.CHM(e),t.oxw().deleteData()}),t._uU(2),t.qZA()()}if(2&r){const e=t.oxw();t.xp6(1),t.Q6J("disabled",e.isButtonClicked),t.xp6(1),t.hij(" ",e.lang.text.TodoDetail.remove," ")}}let R=(()=>{class r{constructor(e,i,n,l,_,c,C,O){this.navParams=e,this.modalCtrl=i,this.lang=n,this.p5toast=l,this.sanitizer=_,this.indexed=c,this.nakama=C,this.alertCtrl=O,this.userInput={id:void 0,title:void 0,create_at:void 0,written:void 0,limit:void 0,importance:"0",logs:[],description:void 0,remote:void 0,attach:{}},this.buttonDisplay={saveTodo:this.lang.text.TodoDetail.buttonDisplay_add},this.isOwner=!0,this.isModify=!1,this.isCalendarHidden=!0,this.isLogsHidden=!0,this.isLimitChangable=!1,this.normal_color="#888b",this.alert_color="#0bbb",this.AlertLerpStartFrom=.8,this.isButtonClicked=!1}ngOnInit(){}ionViewWillEnter(){if(this.received_data=this.navParams.get("data"),this.received_data)this.buttonDisplay.saveTodo=this.lang.text.TodoDetail.buttonDisplay_modify,this.isModify=!0;else{let i=new Date((new Date).getTime()+864e5);this.userInput.limit=i.getTime()}this.received_data&&(this.userInput=Object.assign(Object.assign({},this.userInput),JSON.parse(this.received_data))),this.userInput.attach.type&&this.indexed.loadBlobFromUserPath(`todo/${this.userInput.id}/${this.userInput.attach.filename}`,this.userInput.attach.type,i=>{this.ImageURL&&URL.revokeObjectURL(this.ImageURL),this.ImageURL=this.sanitizer.bypassSecurityTrustUrl(URL.createObjectURL(i))}),this.userInput.remote&&(this.isOwner=!1),this.userInput.logs.length&&this.userInput.logs.forEach(i=>i.displayText=this.lang.text.TodoDetail[i.translateCode]||i.translateCode);let e=new Date(this.userInput.limit);this.Calendar.value=new Date(e.getTime()-60*e.getTimezoneOffset()*1e3).toISOString(),this.limitDisplay=e.toLocaleString(this.lang.lang),this.limitDisplay=this.limitDisplay.substring(0,this.limitDisplay.lastIndexOf(":")),this.isLimitChangable=!0,this.follow_resize()}ionViewDidEnter(){this.show_count_timer()}toggle_calendar(){this.p5resize.windowResized(),this.isCalendarHidden=!this.isCalendarHidden}toggle_logs(){this.isLogsHidden=!this.isLogsHidden}limit_change(e){!this.isLimitChangable||(this.userInput.limit=e.detail.value,this.limitDisplay=new Date(e.detail.value).toLocaleString(this.lang.lang),this.limitDisplay=this.limitDisplay.substring(0,this.limitDisplay.lastIndexOf(":")),this.limitTimeP5Display=new Date(this.userInput.limit).getTime())}follow_resize(){setTimeout(()=>{this.p5resize=new f(i=>{let n=document.getElementById("main_table"),l=document.getElementById("main_div"),_=document.getElementById("bottom_buttons");i.setup=()=>{setTimeout(()=>{i.windowResized()},100),i.noLoop()},i.windowResized=()=>{setTimeout(()=>{l.setAttribute("style",`max-width: ${n.parentElement.offsetWidth}px; max-height: ${n.parentElement.clientHeight-_.offsetHeight}px`)},0)}})},50)}remove_attach(){this.indexed.removeFileFromUserPath("todo/add_tmp.attach"),delete this.userInput.attach,URL.revokeObjectURL(this.ImageURL),this.ImageURL=void 0,this.userInput.attach={}}show_count_timer(){this.p5timer=new f(e=>{let i=0,n=new Date(this.userInput.written).getTime();this.limitTimeP5Display=new Date(this.userInput.limit).getTime();let l,_=e.color(this.normal_color);e.setup=()=>{let T=document.getElementById("p5timer"),v=e.createCanvas(T.clientWidth,T.clientHeight);v.id("timer"),v.style("position","inherit"),v.style("width","100%"),v.style("height","100%"),v.parent(T),e.noStroke()};let c=0,C=()=>{l=(new Date).getTime(),c=this.limitTimeP5Display<l?1:e.map(l,n,this.limitTimeP5Display,0,1,!0),c<=this.AlertLerpStartFrom?_=e.color(this.normal_color):c>this.AlertLerpStartFrom&&(_=e.lerpColor(e.color(this.normal_color),e.color(this.alert_color),e.map(c,this.AlertLerpStartFrom,1,0,1)*i))};e.draw=()=>{C(),e.clear(255,255,255,255),e.push(),e.fill(_),i<1?(i+=.04,i>=1&&(i=1),e.rect(0,0,e.lerp(0,e.width,c*O(i)),e.height)):e.rect(0,0,e.lerp(0,e.width,c),e.height),e.pop()};let O=T=>Z(e.sq(Z(T))),Z=T=>1-T})}select_attach_image(){document.getElementById("file_sel").click()}ImporantSelClicked(){this.ImporantSel.open()}ImporantSelChanged(e){switch(this.userInput.importance=e.detail.value,this.userInput.importance){case"0":this.normal_color="#888b",this.alert_color="#0bbb",this.AlertLerpStartFrom=.8;break;case"1":this.normal_color="#888b",this.alert_color="#dddd0cbb",this.AlertLerpStartFrom=.5;break;case"2":this.normal_color="#dddd0cbb",this.alert_color="#800b",this.AlertLerpStartFrom=.4}}inputImageSelected(e){var i;let n=new FileReader;n=null!==(i=n._realReader)&&void 0!==i?i:n,this.userInput.attach.filename=e.target.files[0].name,this.userInput.attach.file_ext=e.target.files[0].name.substring(e.target.files[0].name.lastIndexOf(".")),this.userInput.attach.filesize=e.target.files[0].size,this.userInput.attach.type=e.target.files[0].type,this.userInput.attach.viewer="image",n.onload=l=>{this.userInput.attach.img=l.target.result.replace(/"|\\|=/g,""),this.indexed.saveFileToUserPath(this.userInput.attach.img,"todo/add_tmp.attach")},this.ImageURL&&URL.revokeObjectURL(this.ImageURL),this.ImageURL=this.sanitizer.bypassSecurityTrustUrl(URL.createObjectURL(e.target.files[0])),n.readAsDataURL(e.target.files[0])}go_to_ionic_viewer(){this.modalCtrl.create({component:g.B,componentProps:{info:this.userInput.attach,path:this.userInput.attach.img?"todo/add_tmp.attach":`todo/${this.userInput.id}/${this.userInput.attach.filename}`}}).then(e=>e.present())}saveData(){if(!this.userInput.title)return void this.p5toast.show({text:this.lang.text.TodoDetail.needDisplayName});this.isButtonClicked=!0;let e=this.userInput.attach.img;if(delete this.userInput.attach.img,this.userInput.logs.forEach(l=>{delete l.displayText}),JSON.stringify(this.userInput)==this.received_data)return void this.modalCtrl.dismiss();this.userInput.create_at||(this.userInput.create_at=(new Date).getTime()),this.userInput.id||(this.userInput.id=new Date(this.userInput.create_at).toISOString().replace(/[:|.]/g,"_"));let n=this.received_data?JSON.parse(this.received_data):void 0;e&&(n&&this.indexed.removeFileFromUserPath(`todo/${this.userInput.id}/${n.attach.filename}`),this.indexed.saveFileToUserPath(e,`todo/${this.userInput.id}/${this.userInput.attach.filename}`)),this.userInput.written=(new Date).getTime(),this.userInput.limit=new Date(this.userInput.limit).getTime(),this.userInput.logs.push({creator:this.userInput.remote?this.nakama.servers[this.userInput.remote.isOfficial][this.userInput.remote.target].session.user_id:"",createTime:(new Date).getTime(),translateCode:this.isModify?"ModifyTodo":"CreateTodo"}),this.isLogsHidden=!0,this.navParams.get("godot").add_todo(JSON.stringify(this.userInput)),this.indexed.saveTextFileToUserPath(JSON.stringify(this.userInput),`todo/${this.userInput.id}/info.todo`,()=>{this.modalCtrl.dismiss()})}taskUpdate(){console.log("\uc0c1\ud0dc\uac00 \uc5c5\ub370\uc774\ud2b8\ub428")}deleteData(){this.alertCtrl.create({header:this.lang.text.TodoDetail.removeTodo,message:this.lang.text.TodoDetail.terminateTodo,buttons:[{text:this.lang.text.TodoDetail.remove,handler:()=>{this.indexed.GetFileListFromDB(`todo/${this.userInput.id}`,e=>{e.forEach(i=>this.indexed.removeFileFromUserPath(i)),this.navParams.get("godot").remove_todo(JSON.stringify(this.userInput)),this.modalCtrl.dismiss()})}}]}).then(e=>e.present())}ionViewWillLeave(){this.indexed.removeFileFromUserPath("todo/add_tmp.attach"),this.ImageURL&&URL.revokeObjectURL(this.ImageURL),this.p5resize.remove(),this.p5timer.remove()}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(s.X1),t.Y36(s.IN),t.Y36(d.b),t.Y36(x.F),t.Y36(P.H7),t.Y36(y.H),t.Y36(b.a),t.Y36(s.Br))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-add-todo-menu"]],viewQuery:function(e,i){if(1&e&&(t.Gf(o,5),t.Gf(m,5)),2&e){let n;t.iGM(n=t.CRH())&&(i.Calendar=n.first),t.iGM(n=t.CRH())&&(i.ImporantSel=n.first)}},decls:56,vars:24,consts:[["slot","start",3,"click"],["defaultHref","main"],["id","main_table",2,"width","100%","height","100%"],[2,"height","100%"],[2,"vertical-align","top"],["id","p5timer",2,"position","absolute","width","100%","height","8px","z-index","2"],["id","main_div",1,"main"],[1,"ion-text-right",3,"ngModel","placeholder","ngModelChange"],["button","",3,"click"],[2,"pointer-events","none",3,"value","ionChange"],["ImporantSel",""],["value","2"],["value","1"],["value","0"],[1,"ion-text-right","uneditable_data"],[2,"display","inline",3,"hidden","locale","ionChange"],["Calendar",""],[3,"click",4,"ngIf"],[1,"infobox",3,"ngModel","placeholder","ngModelChange"],["alt","attach_image",3,"src","click",4,"ngIf"],["hidden","","type","file","id","file_sel","accept","image/*",3,"change"],[4,"ngIf"],[2,"width","100%"],["id","bottom_buttons",2,"width","100%","background-color","black"],["expand","block",3,"disabled","click"],[3,"click"],["alt","attach_image",3,"src","click"],[3,"hidden"],["class","logs",4,"ngFor","ngForOf"],[1,"logs"],["color","danger","expand","block",3,"disabled","click"]],template:function(e,i){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t._uU(3),t.qZA(),t.TgZ(4,"ion-buttons",0),t.NdJ("click",function(){return i.modalCtrl.dismiss()}),t._UZ(5,"ion-back-button",1),t.qZA()()(),t.TgZ(6,"ion-content")(7,"table",2)(8,"tr",3)(9,"td",4),t._UZ(10,"div",5),t.TgZ(11,"div",6)(12,"ion-item")(13,"ion-label"),t._uU(14),t.qZA(),t.TgZ(15,"ion-input",7),t.NdJ("ngModelChange",function(l){return i.userInput.title=l}),t.qZA()(),t.TgZ(16,"ion-item",8),t.NdJ("click",function(){return i.ImporantSelClicked()}),t.TgZ(17,"ion-label"),t._uU(18),t.qZA(),t.TgZ(19,"ion-select",9,10),t.NdJ("ionChange",function(l){return i.ImporantSelChanged(l)}),t.TgZ(21,"ion-select-option",11),t._uU(22),t.qZA(),t.TgZ(23,"ion-select-option",12),t._uU(24),t.qZA(),t.TgZ(25,"ion-select-option",13),t._uU(26),t.qZA()()(),t.TgZ(27,"ion-item",8),t.NdJ("click",function(){return i.toggle_calendar()}),t.TgZ(28,"ion-label"),t._uU(29),t.qZA(),t.TgZ(30,"ion-label",14),t._uU(31),t.qZA()(),t.TgZ(32,"ion-datetime",15,16),t.NdJ("ionChange",function(l){return i.limit_change(l)}),t.qZA(),t.TgZ(34,"ion-item")(35,"ion-label"),t._uU(36),t.qZA(),t.YNc(37,u,2,1,"ion-button",17),t.qZA(),t.TgZ(38,"textarea",18),t.NdJ("ngModelChange",function(l){return i.userInput.description=l}),t.qZA(),t.YNc(39,p,1,1,"img",19),t.TgZ(40,"ion-item",8),t.NdJ("click",function(){return i.select_attach_image()}),t.TgZ(41,"ion-label"),t._uU(42),t.qZA(),t.TgZ(43,"ion-label",14),t._uU(44),t.qZA()(),t.TgZ(45,"input",20),t.NdJ("change",function(l){return i.inputImageSelected(l)}),t.qZA(),t.YNc(46,E,6,3,"div",21),t.qZA()()(),t.TgZ(47,"tr")(48,"td")(49,"div",22)(50,"table",23)(51,"tr")(52,"td")(53,"ion-button",24),t.NdJ("click",function(){return i.saveData()}),t._uU(54),t.qZA()(),t.YNc(55,w,3,2,"td",21),t.qZA()()()()()()()),2&e&&(t.xp6(3),t.Oqu(i.lang.text.TodoDetail.Title),t.xp6(11),t.Oqu(i.lang.text.TodoDetail.DisplayName),t.xp6(1),t.Q6J("ngModel",i.userInput.title)("placeholder",i.lang.text.TodoDetail.DisplayName_placeholder),t.xp6(3),t.Oqu(i.lang.text.TodoDetail.Importance),t.xp6(1),t.Q6J("value",i.userInput.importance),t.xp6(3),t.Oqu(i.lang.text.TodoDetail.Importance_2),t.xp6(2),t.Oqu(i.lang.text.TodoDetail.Importance_1),t.xp6(2),t.Oqu(i.lang.text.TodoDetail.Importance_0),t.xp6(3),t.Oqu(i.lang.text.TodoDetail.limit),t.xp6(2),t.Oqu(i.limitDisplay),t.xp6(1),t.Q6J("hidden",i.isCalendarHidden)("locale",i.lang.lang),t.xp6(4),t.Oqu(i.lang.text.TodoDetail.description),t.xp6(1),t.Q6J("ngIf",i.ImageURL),t.xp6(1),t.Q6J("ngModel",i.userInput.description)("placeholder",i.lang.text.TodoDetail.description),t.xp6(1),t.Q6J("ngIf",i.ImageURL),t.xp6(3),t.Oqu(i.lang.text.TodoDetail.attachments),t.xp6(2),t.Oqu(i.userInput.attach.filename||i.lang.text.TodoDetail.attachments_none),t.xp6(2),t.Q6J("ngIf",i.userInput.logs.length),t.xp6(7),t.Q6J("disabled",i.isButtonClicked),t.xp6(1),t.hij(" ",i.buttonDisplay.saveTodo," "),t.xp6(1),t.Q6J("ngIf",i.isModify))},directives:[s.Gu,s.sr,s.wd,s.Sm,s.oU,s.cs,s.W2,s.Ie,s.Q$,s.pK,s.j9,I.JJ,I.On,s.t9,s.QI,s.n0,s.x4,D.O5,s.YG,I.Fj,D.sg],styles:[".uneditable_data[_ngcontent-%COMP%]{color:#888}.main[_ngcontent-%COMP%]{width:100%;padding:8px;overflow-x:hidden;overflow-y:auto;scroll-behavior:smooth}.logs[_ngcontent-%COMP%]{background:#444;border-radius:8px;margin:8px;padding:4px 8px;text-align:center}"]}),r})()},600:(L,M,a)=>{a.r(M),a.d(M,{MainPageModule:()=>D});var f=a(9808),U=a(4182),g=a(3996),t=a(501),s=a(8982),d=a(2096),x=a(1282),P=a(5742);const b=[{path:"",component:(()=>{class o{constructor(u,p,A){this.app=u,this.lang=p,this.modalCtrl=A}ngOnInit(){}ionViewWillEnter(){this.app.CreateGodotIFrame("godot-todo",{act:"godot-todo",title:"Todo",add_todo_menu:u=>{this.modalCtrl.create({component:s.s,componentProps:{godot:this.app.godot.contentWindow||this.app.godot.contentDocument,data:u}}).then(p=>p.present())}})}}return o.\u0275fac=function(u){return new(u||o)(d.Y36(x.A),d.Y36(P.b),d.Y36(g.IN))},o.\u0275cmp=d.Xpm({type:o,selectors:[["app-main"]],decls:6,vars:1,consts:[["id","godot-todo",1,"full_screen"]],template:function(u,p){1&u&&(d.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),d._uU(3),d.qZA()()(),d.TgZ(4,"ion-content"),d._UZ(5,"div",0),d.qZA()),2&u&&(d.xp6(3),d.Oqu(p.lang.text.Main.Title))},directives:[g.Gu,g.sr,g.wd,g.W2],styles:[""]}),o})()},{path:"add-todo-menu",loadChildren:()=>a.e(9817).then(a.bind(a,9817)).then(o=>o.AddTodoMenuPageModule)}];let I=(()=>{class o{}return o.\u0275fac=function(u){return new(u||o)},o.\u0275mod=d.oAB({type:o}),o.\u0275inj=d.cJS({imports:[[t.Bz.forChild(b)],t.Bz]}),o})(),D=(()=>{class o{}return o.\u0275fac=function(u){return new(u||o)},o.\u0275mod=d.oAB({type:o}),o.\u0275inj=d.cJS({imports:[[f.ez,U.u5,g.Pc,I]]}),o})()}}]);