"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5929],{9373:(A,S,u)=>{u.d(S,{I:()=>M});const M=(0,u(6400).C_)("SpeechRecognition",{web:()=>u.e(7384).then(u.bind(u,7384)).then(k=>new k.SpeechRecognitionWeb)})},8828:(A,S,u)=>{u.d(S,{_8:()=>G,on:()=>k,wd:()=>M});var G=function(w){return w.Prompt="PROMPT",w.Camera="CAMERA",w.Photos="PHOTOS",w}(G||{}),M=function(w){return w.Rear="REAR",w.Front="FRONT",w}(M||{}),k=function(w){return w.Uri="uri",w.Base64="base64",w.DataUrl="dataUrl",w}(k||{})},4120:(A,S,u)=>{u.d(S,{Ut:()=>k,_8:()=>M._8,on:()=>M.on});var G=u(6400),M=u(8828);const k=(0,G.C_)("Camera",{web:()=>u.e(9028).then(u.bind(u,9028)).then(w=>new w.CameraWeb)})},5929:(A,S,u)=>{u.r(S),u.d(S,{ChatRoomPageModule:()=>Dt});var G=u(1368),M=u(4716),k=u(5624),w=u(3332),g=u(1528),N=u(4708),Y=u(9352),z=u(4428),$=u(5193),U=u(3664),B=u(1052),j=u(5020),Q=u(6756),F=u(4120),J=u(340),H=u(2272);const K=(0,u(6400).C_)("TextToSpeech",{web:()=>u.e(2728).then(u.bind(u,2728)).then(s=>new s.TextToSpeechWeb)});"speechSynthesis"in window&&window;var X=u(9373),V=u(4712),e=u(4496),Z=u(9240),ee=u(7136),te=u(6819),ie=u(4180),ne=u(4668),ae=u(4500),se=u(4476),oe=u(8696),le=u(3824),re=u(7756);function ce(s,c){if(1&s){const a=e.KQA();e.I0R(0,"ion-icon",34),e.qCj("click",function(){e.usT(a);const i=e.GaO();return e.CGJ(i.toggle_thumbnail())}),e.C$Y()}}function _e(s,c){if(1&s){const a=e.KQA();e.I0R(0,"ion-icon",35),e.qCj("click",function(){e.usT(a);const i=e.GaO();return e.CGJ(i.toggle_thumbnail())}),e.C$Y()}}function de(s,c){if(1&s){const a=e.KQA();e.I0R(0,"div",49),e.qCj("click",function(){e.usT(a);const i=e.GaO(3);return e.CGJ(i.SetOtherAct())}),e.I0R(1,"font",50),e.OEk(2),e.C$Y()()}if(2&s){const a=e.GaO(2).$implicit;e.yG2(2),e.oRS(" ",a.displayDate," ")}}function ue(s,c){if(1&s){const a=e.KQA();e.I0R(0,"div",51),e.qCj("click",function(){e.usT(a);const i=e.GaO(2).$implicit,n=e.GaO();return e.CGJ(n.user_detail(i))}),e.wR5(1,"img",52),e.C$Y()}if(2&s){const a=e.GaO(2).$implicit,t=e.GaO();e.yG2(),e.m_g(t.nakama.users[t.isOfficial][t.target][a.sender_id].online?"filter: grayscale(0) contrast(1);":"filter: grayscale(.9) contrast(1.4);"),e.E7m("src",t.users_image[a.sender_id]||"assets/data/avatar.svg",e.K6U)}}function he(s,c){if(1&s){const a=e.KQA();e.I0R(0,"div",53)(1,"span",54),e.qCj("click",function(){e.usT(a);const i=e.GaO(2).$implicit,n=e.GaO();return e.CGJ(n.user_detail(i))}),e.I0R(2,"b")(3,"font",55),e.OEk(4),e.C$Y()()(),e.I0R(5,"span",56),e.qCj("click",function(){e.usT(a);const i=e.GaO(3);return e.CGJ(i.SetOtherAct())}),e.OEk(6),e.C$Y()()}if(2&s){const a=e.GaO(2).$implicit,t=e.GaO();e.yG2(3),e.CI5("color","#",t.nakama.users[t.isOfficial][t.target][a.sender_id].online?a.color:"888",""),e.yG2(),e.oRS(" ",a.user_display_name||t.lang.text.Profile.noname_user,""),e.yG2(2),e.cNF(a.msgTime)}}function me(s,c){if(1&s){const a=e.KQA();e.I0R(0,"div",57),e.qCj("click",function(){e.usT(a);const i=e.GaO(2).$implicit,n=e.GaO();return e.CGJ(n.JoinWebRTCMatch(i))}),e.OEk(1),e.C$Y()}if(2&s){const a=e.GaO(3);e.yG2(),e.oRS(" ",a.lang.text.ChatRoom.JoinWebRTCMatch," ")}}function ge(s,c){if(1&s&&(e.I0R(0,"div"),e.wR5(1,"img",61),e.C$Y()),2&s){const a=e.GaO(3).$implicit;e.yG2(),e.E7m("src",a.content.qoute.url,e.K6U)}}function fe(s,c){if(1&s&&(e.I0R(0,"div",59),e.OEk(1),e.C$Y()),2&s){const a=e.GaO(3).$implicit;e.yG2(),e.cNF(a.content.qoute.text)}}function pe(s,c){if(1&s){const a=e.KQA();e.I0R(0,"div",58),e.qCj("click",function(){e.usT(a);const i=e.GaO(2).$implicit,n=e.GaO();return e.CGJ(n.FindQoute(i.content.qoute.id,i.content.qoute.timestamp))}),e.I0R(1,"div",59),e.OEk(2),e.C$Y(),e.yuY(3,ge,2,1,"div",25)(4,fe,2,1,"div",60),e.C$Y()}if(2&s){const a=e.GaO(2).$implicit,t=e.GaO();e.yG2(2),e.cNF(t.lang.text.ChatRoom.qouteMsg),e.yG2(),e.E7m("ngIf",a.content.qoute.url),e.yG2(),e.E7m("ngIf",a.content.qoute.text)}}function xe(s,c){1&s&&e.wR5(0,"div",70)}function ve(s,c){if(1&s&&(e.I0R(0,"span",71),e.OEk(1),e.C$Y()),2&s){const a=c.$implicit;e.yG2(),e.oRS(" ",a," ")}}function Ce(s,c){if(1&s){const a=e.KQA();e.I0R(0,"div",66),e.qCj("click",function(){e.usT(a);const i=e.GaO(3).$implicit,n=e.GaO();return e.CGJ(n.file_detail(i))}),e.I0R(1,"p",67),e.OEk(2),e.C$Y(),e.yuY(3,xe,1,0,"div",68)(4,ve,2,1,"span",69),e.C$Y()}if(2&s){const a=e.GaO(3).$implicit,t=e.GaO();e.m_g(t.info.HideAutoThumbnail?"filter: blur(6px);":""),e.yG2(2),e.oRS(" ",a.content.filename," "),e.yG2(),e.E7m("ngIf",a.content.text),e.yG2(),e.E7m("ngForOf",a.content.text)}}function ye(s,c){if(1&s){const a=e.KQA();e.I0R(0,"div",72),e.qCj("click",function(){e.usT(a);const i=e.GaO(3).$implicit,n=e.GaO();return e.CGJ(n.file_detail(i))}),e.wR5(1,"img",73),e.C$Y()}if(2&s){const a=e.GaO(3).$implicit,t=e.GaO();e.yG2(),e.m_g(t.info.HideAutoThumbnail?"filter: blur(6px);":""),e.E7m("src",a.content.thumbnail,e.K6U)("alt",a.content.filename)}}function be(s,c){if(1&s&&(e.I0R(0,"div",74),e.OEk(1),e.C$Y()),2&s){const a=e.GaO(3).$implicit;e.yG2(),e.oRS(" ",a.content.transfer_index.index,"")}}function Ie(s,c){if(1&s&&(e.I0R(0,"div",62),e.yuY(1,Ce,5,5,"div",63)(2,ye,2,4,"div",64)(3,be,2,1,"div",65),e.C$Y()),2&s){const a=e.GaO(2).$implicit;e.yG2(),e.E7m("ngIf",!a.content.thumbnail),e.yG2(),e.E7m("ngIf",a.content.thumbnail),e.yG2(),e.E7m("ngIf",a.content.transfer_index)}}function Re(s,c){if(1&s){const a=e.KQA();e.I0R(0,"span",83),e.qCj("click",function(){e.usT(a);const i=e.GaO(6);return e.CGJ(i.SetOtherAct())}),e.OEk(1),e.C$Y()}if(2&s){const a=e.GaO().$implicit;e.m_g("font-size: "+(a.size||16)+"px"),e.yG2(),e.oRS(" ",a.text," ")}}function ke(s,c){if(1&s){const a=e.KQA();e.I0R(0,"a",84),e.qCj("click",function(){e.usT(a);const i=e.GaO().$implicit,n=e.GaO(5);return e.CGJ(n.open_url_link(i.text))}),e.OEk(1),e.C$Y()}if(2&s){const a=e.GaO().$implicit;e.E7m("href",a.text,e.K6U),e.yG2(),e.cNF(a.text)}}function we(s,c){if(1&s&&(e.I0R(0,"span"),e.yuY(1,Re,2,3,"span",81)(2,ke,2,2,"a",82),e.C$Y()),2&s){const a=c.$implicit;e.yG2(),e.E7m("ngIf",!a.href),e.yG2(),e.E7m("ngIf",a.href)}}function Oe(s,c){if(1&s&&(e.I0R(0,"div",79)(1,"span"),e.yuY(2,we,3,2,"span",80),e.C$Y()()),2&s){const a=c.$implicit;e.yG2(2),e.E7m("ngForOf",a)}}function Te(s,c){if(1&s&&(e.I0R(0,"div",85),e.OEk(1),e.C$Y()),2&s){const a=e.GaO(4);e.yG2(),e.oRS(" ","("+a.lang.text.ChatRoom.MsgEdited+")","")}}function Me(s,c){if(1&s&&(e.I0R(0,"div",75)(1,"div",76),e.yuY(2,Oe,3,1,"div",77),e.C$Y(),e.yuY(3,Te,2,1,"div",78),e.C$Y()),2&s){const a=e.GaO(2).$implicit;e.yG2(),e.m_g("background-color: #"+a.color+"88"),e.yG2(),e.E7m("ngForOf",a.content.msg),e.yG2(),e.E7m("ngIf",a.content.edited)}}function $e(s,c){if(1&s&&(e.I0R(0,"div",86),e.OEk(1),e.C$Y()),2&s){const a=e.GaO(3);e.yG2(),e.oRS(" ",a.lang.text.ChatRoom.YouReadHereLast,"")}}function Ge(s,c){if(1&s&&(e.I0R(0,"div"),e.yuY(1,de,3,1,"div",39),e.I0R(2,"table")(3,"tr")(4,"td",40),e.yuY(5,ue,2,3,"div",41),e.C$Y(),e.I0R(6,"td"),e.yuY(7,he,7,3,"div",42)(8,me,2,1,"div",43)(9,pe,5,3,"div",44)(10,Ie,4,3,"div",45)(11,Me,4,4,"div",46),e.C$Y()()(),e.I0R(12,"div",47),e.yuY(13,$e,2,1,"div",48),e.C$Y()()),2&s){const a=e.GaO().$implicit;e.yG2(),e.E7m("ngIf",a.showInfo&&a.showInfo.date),e.yG2(4),e.E7m("ngIf",a.showInfo&&a.showInfo.sender),e.yG2(2),e.E7m("ngIf",a.showInfo&&a.showInfo.sender),e.yG2(),e.E7m("ngIf",a.content.match),e.yG2(),e.E7m("ngIf",a.content.qoute),e.yG2(),e.E7m("ngIf",a.content.filename),e.yG2(),e.E7m("ngIf",a.content.msg),e.yG2(2),e.E7m("ngIf",a.isLastRead)}}function Pe(s,c){if(1&s){const a=e.KQA();e.I0R(0,"div",49),e.qCj("click",function(){e.usT(a);const i=e.GaO(3);return e.CGJ(i.SetOtherAct())}),e.I0R(1,"font",50),e.OEk(2),e.C$Y()()}if(2&s){const a=e.GaO(2).$implicit;e.yG2(2),e.oRS(" ",a.displayDate," ")}}function Ee(s,c){if(1&s){const a=e.KQA();e.I0R(0,"div",53)(1,"span",94),e.qCj("click",function(){e.usT(a);const i=e.GaO(3);return e.CGJ(i.SetOtherAct())}),e.OEk(2),e.C$Y(),e.I0R(3,"span",54),e.qCj("click",function(){e.usT(a);const i=e.GaO(2).$implicit,n=e.GaO();return e.CGJ(n.user_detail(i))}),e.I0R(4,"b")(5,"font",55),e.OEk(6),e.C$Y()()()()}if(2&s){const a=e.GaO(2).$implicit,t=e.GaO();e.yG2(2),e.cNF(a.msgTime),e.yG2(3),e.CI5("color","#",t.nakama.users.self.online?a.color:"888",""),e.yG2(),e.oRS(" ",a.user_display_name||t.lang.text.Profile.noname_user,"")}}function Se(s,c){if(1&s){const a=e.KQA();e.I0R(0,"div",95),e.qCj("click",function(){e.usT(a);const i=e.GaO(2).$implicit,n=e.GaO();return e.CGJ(n.JoinWebRTCMatch(i))}),e.I0R(1,"div",96),e.OEk(2),e.C$Y()()}if(2&s){const a=e.GaO(3);e.yG2(2),e.oRS(" ",a.lang.text.ChatRoom.JoinWebRTCMatch," ")}}function Ve(s,c){if(1&s&&(e.I0R(0,"div"),e.wR5(1,"img",61),e.C$Y()),2&s){const a=e.GaO(3).$implicit;e.yG2(),e.E7m("src",a.content.qoute.url,e.K6U)}}function De(s,c){if(1&s&&(e.I0R(0,"div",59),e.OEk(1),e.C$Y()),2&s){const a=e.GaO(3).$implicit;e.yG2(),e.cNF(a.content.qoute.text)}}function Ae(s,c){if(1&s){const a=e.KQA();e.I0R(0,"div",58),e.qCj("click",function(){e.usT(a);const i=e.GaO(2).$implicit,n=e.GaO();return e.CGJ(n.FindQoute(i.content.qoute.id,i.content.qoute.timestamp))}),e.I0R(1,"div",59),e.OEk(2),e.C$Y(),e.yuY(3,Ve,2,1,"div",25)(4,De,2,1,"div",60),e.C$Y()}if(2&s){const a=e.GaO(2).$implicit,t=e.GaO();e.yG2(2),e.cNF(t.lang.text.ChatRoom.qouteMsg),e.yG2(),e.E7m("ngIf",a.content.qoute.url),e.yG2(),e.E7m("ngIf",a.content.qoute.text)}}function Fe(s,c){1&s&&e.wR5(0,"div",70)}function Le(s,c){if(1&s&&(e.I0R(0,"span",71),e.OEk(1),e.C$Y()),2&s){const a=c.$implicit;e.yG2(),e.oRS(" ",a," ")}}function Ye(s,c){if(1&s){const a=e.KQA();e.I0R(0,"div",66),e.qCj("click",function(){e.usT(a);const i=e.GaO(3).$implicit,n=e.GaO();return e.CGJ(n.file_detail(i))}),e.I0R(1,"p",67),e.OEk(2),e.C$Y(),e.yuY(3,Fe,1,0,"div",68)(4,Le,2,1,"span",69),e.C$Y()}if(2&s){const a=e.GaO(3).$implicit,t=e.GaO();e.m_g(t.info.HideAutoThumbnail?"filter: blur(6px);":""),e.yG2(2),e.oRS(" ",a.content.filename," "),e.yG2(),e.E7m("ngIf",a.content.text),e.yG2(),e.E7m("ngForOf",a.content.text)}}function Ue(s,c){if(1&s){const a=e.KQA();e.I0R(0,"div",72),e.qCj("click",function(){e.usT(a);const i=e.GaO(3).$implicit,n=e.GaO();return e.CGJ(n.file_detail(i))}),e.wR5(1,"img",73),e.C$Y()}if(2&s){const a=e.GaO(3).$implicit,t=e.GaO();e.yG2(),e.m_g(t.info.HideAutoThumbnail?"filter: blur(6px);":""),e.E7m("src",a.content.thumbnail,e.K6U)("alt",a.content.filename)}}function Be(s,c){if(1&s&&(e.I0R(0,"div",74),e.OEk(1),e.C$Y()),2&s){const a=e.GaO(3).$implicit;e.yG2(),e.oRS(" ",a.content.transfer_index.index,"")}}function je(s,c){if(1&s&&(e.I0R(0,"div",97),e.yuY(1,Ye,5,5,"div",63)(2,Ue,2,4,"div",64)(3,Be,2,1,"div",65),e.C$Y()),2&s){const a=e.GaO(2).$implicit;e.yG2(),e.E7m("ngIf",!a.content.thumbnail),e.yG2(),e.E7m("ngIf",a.content.thumbnail),e.yG2(),e.E7m("ngIf",a.content.transfer_index)}}function He(s,c){if(1&s&&(e.I0R(0,"div",85),e.OEk(1),e.C$Y()),2&s){const a=e.GaO(4);e.yG2(),e.oRS(" ","("+a.lang.text.ChatRoom.MsgEdited+")","")}}function Ke(s,c){if(1&s){const a=e.KQA();e.I0R(0,"span",83),e.qCj("click",function(){e.usT(a);const i=e.GaO(6);return e.CGJ(i.SetOtherAct())}),e.OEk(1),e.C$Y()}if(2&s){const a=e.GaO().$implicit;e.m_g("font-size: "+(a.size||16)+"px"),e.yG2(),e.oRS(" ",a.text," ")}}function qe(s,c){if(1&s){const a=e.KQA();e.I0R(0,"a",84),e.qCj("click",function(){e.usT(a);const i=e.GaO().$implicit,n=e.GaO(5);return e.CGJ(n.open_url_link(i.text))}),e.OEk(1),e.C$Y()}if(2&s){const a=e.GaO().$implicit;e.E7m("href",a.text,e.K6U),e.yG2(),e.cNF(a.text)}}function Ne(s,c){if(1&s&&(e.I0R(0,"span"),e.yuY(1,Ke,2,3,"span",81)(2,qe,2,2,"a",82),e.C$Y()),2&s){const a=c.$implicit;e.yG2(),e.E7m("ngIf",!a.href),e.yG2(),e.E7m("ngIf",a.href)}}function ze(s,c){if(1&s&&(e.I0R(0,"div",79)(1,"span"),e.yuY(2,Ne,3,2,"span",80),e.C$Y()()),2&s){const a=c.$implicit;e.yG2(2),e.E7m("ngForOf",a)}}function Qe(s,c){if(1&s&&(e.I0R(0,"div",98),e.yuY(1,He,2,1,"div",78),e.I0R(2,"div",76),e.yuY(3,ze,3,1,"div",77),e.C$Y()()),2&s){const a=e.GaO(2).$implicit;e.yG2(),e.E7m("ngIf",a.content.edited),e.yG2(),e.m_g("background-color: #"+a.color+"88"),e.yG2(),e.E7m("ngForOf",a.content.msg)}}function Je(s,c){if(1&s){const a=e.KQA();e.I0R(0,"div",51),e.qCj("click",function(){e.usT(a);const i=e.GaO(2).$implicit,n=e.GaO();return e.CGJ(n.user_detail(i))}),e.wR5(1,"img",99),e.C$Y()}if(2&s){const a=e.GaO(3);e.yG2(),e.m_g(a.nakama.users.self.online?"filter: grayscale(0) contrast(1);":"filter: grayscale(.9) contrast(1.4);"),e.E7m("src",a.nakama.users.self.img||"assets/data/avatar.svg",e.K6U)}}function We(s,c){if(1&s){const a=e.KQA();e.I0R(0,"div",100),e.qCj("click",function(){e.usT(a);const i=e.GaO(3);return e.CGJ(i.SetOtherAct())}),e.OEk(1),e.C$Y()}if(2&s){const a=e.GaO(3);e.yG2(),e.oRS(" ",a.lang.text.ChatRoom.YouReadHereLast,"")}}function Xe(s,c){if(1&s&&(e.I0R(0,"div",87),e.yuY(1,Pe,3,1,"div",39),e.I0R(2,"table",88)(3,"tr")(4,"td"),e.yuY(5,Ee,7,3,"div",42)(6,Se,3,1,"div",89)(7,Ae,5,3,"div",44)(8,je,4,3,"div",90)(9,Qe,4,4,"div",91),e.C$Y(),e.I0R(10,"td",92),e.yuY(11,Je,2,3,"div",41),e.C$Y()()(),e.I0R(12,"div",47),e.yuY(13,We,2,1,"div",93),e.C$Y()()),2&s){const a=e.GaO().$implicit;e.yG2(),e.E7m("ngIf",a.showInfo&&a.showInfo.date),e.yG2(4),e.E7m("ngIf",a.showInfo&&a.showInfo.sender),e.yG2(),e.E7m("ngIf",a.content.match),e.yG2(),e.E7m("ngIf",a.content.qoute),e.yG2(),e.E7m("ngIf",a.content.filename),e.yG2(),e.E7m("ngIf",a.content.msg),e.yG2(2),e.E7m("ngIf",a.showInfo&&a.showInfo.sender),e.yG2(2),e.E7m("ngIf",a.isLastRead)}}function Ze(s,c){if(1&s){const a=e.KQA();e.I0R(0,"div",101),e.qCj("click",function(){e.usT(a);const i=e.GaO(2);return e.CGJ(i.SetOtherAct())}),e.I0R(1,"div",102),e.OEk(2),e.C$Y()()}if(2&s){const a=e.GaO().$implicit;e.yG2(2),e.oRS(" ",a.content.noti," ")}}function et(s,c){if(1&s&&(e.I0R(0,"div",36),e.yuY(1,Ge,14,8,"div",25)(2,Xe,14,8,"div",37)(3,Ze,3,1,"div",38),e.C$Y()),2&s){const a=c.$implicit;e.E7m("id",a.message_id),e.yG2(),e.E7m("ngIf",!a.is_me&&!a.content.noti),e.yG2(),e.E7m("ngIf",a.is_me&&!a.content.noti),e.yG2(),e.E7m("ngIf",a.content.noti)}}function tt(s,c){if(1&s&&(e.I0R(0,"div"),e.wR5(1,"img",61),e.C$Y()),2&s){const a=e.GaO(2).$implicit;e.yG2(),e.E7m("src",a.content.qoute.url,e.K6U)}}function it(s,c){if(1&s&&(e.I0R(0,"div",59),e.OEk(1),e.C$Y()),2&s){const a=e.GaO(2).$implicit;e.yG2(),e.cNF(a.content.qoute.text)}}function nt(s,c){if(1&s){const a=e.KQA();e.I0R(0,"div",58),e.qCj("click",function(){e.usT(a);const i=e.GaO().$implicit,n=e.GaO();return e.CGJ(n.FindQoute(i.content.qoute.id,i.content.qoute.timestamp))}),e.I0R(1,"div",59),e.OEk(2),e.C$Y(),e.yuY(3,tt,2,1,"div",25)(4,it,2,1,"div",60),e.C$Y()}if(2&s){const a=e.GaO().$implicit,t=e.GaO();e.yG2(2),e.cNF(t.lang.text.ChatRoom.qouteMsg),e.yG2(),e.E7m("ngIf",a.content.qoute.url),e.yG2(),e.E7m("ngIf",a.content.qoute.text)}}function at(s,c){1&s&&e.wR5(0,"div",70)}function st(s,c){if(1&s&&(e.I0R(0,"span",71),e.OEk(1),e.C$Y()),2&s){const a=c.$implicit;e.yG2(),e.oRS(" ",a," ")}}function ot(s,c){if(1&s&&(e.I0R(0,"div",106)(1,"p",67),e.OEk(2),e.C$Y(),e.yuY(3,at,1,0,"div",68)(4,st,2,1,"span",69),e.C$Y()),2&s){const a=e.GaO(2).$implicit,t=e.GaO();e.m_g(t.info.HideAutoThumbnail?"filter: blur(6px);":""),e.yG2(2),e.oRS(" ",a.content.filename," "),e.yG2(),e.E7m("ngIf",a.content.text),e.yG2(),e.E7m("ngForOf",a.content.text)}}function lt(s,c){if(1&s&&(e.I0R(0,"div",107),e.wR5(1,"img",73),e.C$Y()),2&s){const a=e.GaO(2).$implicit,t=e.GaO();e.yG2(),e.m_g(t.info.HideAutoThumbnail?"filter: blur(6px);":""),e.E7m("src",a.content.thumbnail,e.K6U)("alt",a.content.filename)}}function rt(s,c){if(1&s&&(e.I0R(0,"div",97),e.yuY(1,ot,5,5,"div",104)(2,lt,2,4,"div",105),e.C$Y()),2&s){const a=e.GaO().$implicit;e.yG2(),e.E7m("ngIf",!a.content.thumbnail),e.yG2(),e.E7m("ngIf",a.content.thumbnail)}}function ct(s,c){if(1&s){const a=e.KQA();e.I0R(0,"span",111),e.qCj("click",function(){e.usT(a);const i=e.GaO(5);return e.CGJ(i.SetOtherAct())}),e.OEk(1),e.C$Y()}if(2&s){const a=e.GaO().$implicit;e.m_g("font-size: "+(a.size||16)+"px"),e.yG2(),e.oRS(" ",a.text," ")}}function _t(s,c){if(1&s){const a=e.KQA();e.I0R(0,"a",112),e.qCj("click",function(){e.usT(a);const i=e.GaO().$implicit,n=e.GaO(4);return e.CGJ(n.open_url_link(i.text))}),e.OEk(1),e.C$Y()}if(2&s){const a=e.GaO().$implicit;e.E7m("href",a.text,e.K6U),e.yG2(),e.cNF(a.text)}}function dt(s,c){if(1&s&&(e.I0R(0,"span"),e.yuY(1,ct,2,3,"span",109)(2,_t,2,2,"a",110),e.C$Y()),2&s){const a=c.$implicit;e.yG2(),e.E7m("ngIf",!a.href),e.yG2(),e.E7m("ngIf",a.href)}}function ut(s,c){if(1&s&&(e.I0R(0,"div",79)(1,"span"),e.yuY(2,dt,3,2,"span",80),e.C$Y()()),2&s){const a=c.$implicit;e.yG2(2),e.E7m("ngForOf",a)}}function ht(s,c){if(1&s&&(e.I0R(0,"div",98)(1,"div",108),e.yuY(2,ut,3,1,"div",77),e.C$Y()()),2&s){const a=e.GaO().$implicit;e.yG2(2),e.E7m("ngForOf",a.content.msg)}}function mt(s,c){if(1&s&&(e.I0R(0,"div",103),e.yuY(1,nt,5,3,"div",44)(2,rt,3,2,"div",90)(3,ht,3,1,"div",91),e.C$Y()),2&s){const a=c.$implicit;e.yG2(),e.E7m("ngIf",a.content.qoute),e.yG2(),e.E7m("ngIf",a.content.filename),e.yG2(),e.E7m("ngIf",a.content.msg)}}function gt(s,c){if(1&s&&(e.I0R(0,"div"),e.wR5(1,"img",114),e.C$Y()),2&s){const a=e.GaO(2);e.yG2(),e.E7m("src",a.userInput.qoute.url,e.K6U)}}function ft(s,c){if(1&s&&(e.I0R(0,"div",59),e.OEk(1),e.C$Y()),2&s){const a=e.GaO(2);e.yG2(),e.cNF(a.userInput.qoute.text)}}function pt(s,c){if(1&s){const a=e.KQA();e.I0R(0,"tr",113),e.qCj("click",function(){e.usT(a);const i=e.GaO();return e.CGJ(i.RemoveQoute())}),e.I0R(1,"div",59),e.OEk(2),e.C$Y(),e.yuY(3,gt,2,1,"div",25)(4,ft,2,1,"div",60),e.C$Y()}if(2&s){const a=e.GaO();e.yG2(2),e.cNF(a.lang.text.ChatRoom.qouteMsg),e.yG2(),e.E7m("ngIf",a.userInput.qoute.url),e.yG2(),e.E7m("ngIf",a.userInput.qoute.text)}}function xt(s,c){if(1&s&&e.wR5(0,"img",121),2&s){const a=e.GaO(4);e.E7m("src",a.userInput.file.thumbnail,e.K6U)("alt",a.userInput.file.name)}}function vt(s,c){if(1&s&&(e.I0R(0,"div"),e.yuY(1,xt,1,2,"img",120),e.C$Y()),2&s){const a=e.GaO(3);e.yG2(),e.E7m("ngIf","image"==a.userInput.file.typeheader)}}function Ct(s,c){if(1&s&&(e.I0R(0,"span"),e.OEk(1),e.C$Y()),2&s){const a=c.$implicit;e.yG2(),e.oRS(" ",a," ")}}function yt(s,c){if(1&s&&(e.I0R(0,"div",122),e.yuY(1,Ct,2,1,"span",80),e.C$Y()),2&s){const a=e.GaO(3);e.yG2(),e.E7m("ngForOf",a.userInput.file.thumbnail)}}function bt(s,c){if(1&s){const a=e.KQA();e.I0R(0,"div",117),e.qCj("click",function(){e.usT(a);const i=e.GaO(2);return e.CGJ(i.removeAttach())}),e.I0R(1,"div",118),e.OEk(2),e.C$Y(),e.yuY(3,vt,2,1,"div",25)(4,yt,2,1,"div",119),e.C$Y()}if(2&s){const a=e.GaO(2);e.yG2(2),e.oRS(" ",a.userInput.file.filename," "),e.yG2(),e.E7m("ngIf",a.userInput.file.thumbnail),e.yG2(),e.E7m("ngIf","text"==a.userInput.file.typeheader)}}function It(s,c){if(1&s&&(e.I0R(0,"tr",115)(1,"td"),e.yuY(2,bt,5,3,"div",116),e.C$Y()()),2&s){const a=e.GaO();e.yG2(2),e.E7m("ngIf",a.userInput.file)}}function Rt(s,c){if(1&s){const a=e.KQA();e.I0R(0,"tr",123),e.qCj("click",function(){e.usT(a);const i=e.GaO();return e.CGJ(i.init_chatroom())}),e.I0R(1,"td",124),e.OEk(2),e.C$Y()()}if(2&s){const a=e.GaO();e.yG2(2),e.cNF(a.lang.text.ChatRoom.GoToRecent)}}function kt(s,c){if(1&s){const a=e.KQA();e.I0R(0,"span",83),e.qCj("click",function(){e.usT(a);const i=e.GaO(4);return e.CGJ(i.SetOtherAct())}),e.OEk(1),e.C$Y()}if(2&s){const a=e.GaO().$implicit;e.yG2(),e.oRS(" ",a.text," ")}}function wt(s,c){if(1&s){const a=e.KQA();e.I0R(0,"a",84),e.qCj("click",function(){e.usT(a);const i=e.GaO().$implicit,n=e.GaO(3);return e.CGJ(n.open_url_link(i.text))}),e.OEk(1),e.C$Y()}if(2&s){const a=e.GaO().$implicit;e.E7m("href",a.text,e.K6U),e.yG2(),e.cNF(a.text)}}function Ot(s,c){if(1&s&&(e.I0R(0,"span"),e.yuY(1,kt,2,1,"span",126)(2,wt,2,2,"a",82),e.C$Y()),2&s){const a=c.$implicit;e.yG2(),e.E7m("ngIf",!a.href),e.yG2(),e.E7m("ngIf",a.href)}}function Tt(s,c){if(1&s&&(e.I0R(0,"span"),e.yuY(1,Ot,3,2,"span",80),e.C$Y()),2&s){const a=c.$implicit;e.yG2(),e.E7m("ngForOf",a)}}function Mt(s,c){if(1&s){const a=e.KQA();e.I0R(0,"tr",123),e.qCj("click",function(){e.usT(a);const i=e.GaO();return e.CGJ(i.init_chatroom())}),e.I0R(1,"td",125)(2,"span")(3,"b"),e.OEk(4),e.C$Y()(),e.yuY(5,Tt,2,1,"span",80),e.C$Y()()}if(2&s){const a=e.GaO();e.yG2(2),e.m_g("margin-right: 8px; color: #"+a.last_message_viewer.color),e.yG2(2),e.cNF((a.last_message_viewer.is_me?a.nakama.users.self.display_name:a.nakama.users[a.isOfficial][a.target][a.last_message_viewer.user_id].display_name)||a.lang.text.Profile.noname_user),e.yG2(),e.E7m("ngForOf",a.last_message_viewer.message)}}function $t(s,c){if(1&s){const a=e.KQA();e.I0R(0,"td")(1,"ion-button",127),e.qCj("click",function(){e.usT(a);const i=e.GaO();return e.CGJ(i.GetSpeechToText())}),e.wR5(2,"ion-icon",128),e.C$Y()()}}function Gt(s,c){if(1&s&&e.wR5(0,"ion-icon",133),2&s){const a=e.GaO().$implicit;e.E7m("name",a.icon||"close-circle")}}function Pt(s,c){if(1&s&&e.wR5(0,"img",134),2&s){const a=e.GaO().$implicit;e.E7m("src","assets/icon/"+a.icon_img,e.K6U)("alt",a.title)}}function Et(s,c){if(1&s){const a=e.KQA();e.I0R(0,"div",129)(1,"div",130),e.qCj("click",function(){const n=e.usT(a).$implicit;return e.CGJ(n.act())}),e.yuY(2,Gt,1,1,"ion-icon",131)(3,Pt,1,2,"img",132),e.I0R(4,"div"),e.OEk(5),e.C$Y()()()}if(2&s){const a=c.$implicit;e.yG2(),e.m_g("cursor: "+(a.cursor||"pointer")+";"),e.E7m("hidden",a.isHide),e.yG2(),e.E7m("ngIf",a.icon),e.yG2(),e.E7m("ngIf",a.icon_img),e.yG2(2),e.cNF(a.name)}}const St=[{path:"",component:(()=>{var s;class c{constructor(t,i,n,o,l,d,_,m,p,y,f,O,v,b,E,T){var I,r=this;this.modalCtrl=t,this.navCtrl=i,this.route=n,this.router=o,this.nakama=l,this.noti=d,this.statusBar=_,this.indexed=m,this.lang=p,this.sanitizer=y,this.global=f,this.loadingCtrl=O,this.webrtc=v,this.p5toast=b,this.mClipboard=E,this.alertCtrl=T,this.info={},this.foundLastRead=!1,this.messages=[],this.sending_msg=[],this.temporary_open_thumbnail={},this.extended_buttons=[{icon:"settings-outline",name:this.lang.text.ChatRoom.ExtSettings,act:()=>{if(3!=this.info.redirect.type)this.extended_buttons[0].isHide=!0;else if(!this.lock_modal_open)try{this.lock_modal_open=!0,this.modalCtrl.create({component:Q.q,componentProps:{info:this.nakama.groups[this.isOfficial][this.target][this.info.group_id],server:{isOfficial:this.isOfficial,target:this.target}}}).then(I=>{I.onWillDismiss().then(h=>{h.data&&(this.extended_buttons.forEach(R=>{R.isHide=!0}),this.extended_buttons[0].isHide=!1,this.extended_buttons[12].isHide=!1)}),I.onDidDismiss().then(()=>{this.ionViewDidEnter()}),this.removeShortCutKey(),I.present(),this.lock_modal_open=!1})}catch{this.lock_modal_open=!1,this.p5toast.show({text:this.lang.text.ChatRoom.AlreadyRemoved})}}},{icon:"hammer-outline",name:this.lang.text.ChatRoom.ExtSoloImage,isHide:!0,act:()=>{this.info.info.img?(delete this.info.info.img,this.indexed.removeFileFromUserPath(`servers/${this.info.server.isOfficial}/${this.info.server.target}/groups/${this.info.id}.img`),this.p5toast.show({text:this.lang.text.ChatRoom.LocalImageRemoved})):document.getElementById("local_channel").click()}},{icon:"image-outline",name:this.lang.text.ChatRoom.BackgroundImage,act:()=>{this.HasBackgroundImage?this.RemoveChannelBackgroundImage():document.getElementById("backgroundImage_sel").click()}},{icon:"document-attach-outline",name:this.lang.text.ChatRoom.attachments,act:(I=(0,g.c)(function*(){r.userInputTextArea||(r.userInputTextArea=document.getElementById(r.ChannelUserInputId));try{return void(yield r.new_attach({detail:{value:"link"}}))}catch(h){"done"!=h&&r.new_attach({detail:{value:"load"}})}}),function(){return I.apply(this,arguments)})},{icon_img:"voidDraw.png",name:this.lang.text.ChatRoom.voidDraw,act:function(){var I=(0,g.c)(function*(){r.userInputTextArea||(r.userInputTextArea=document.getElementById(r.ChannelUserInputId));let R,h={};if(r.userInput.file)switch(r.userInput.file.typeheader){case"image":try{r.userInput.file.url&&(r.userInput.file.blob=yield fetch(r.userInput.file.url).then(P=>P.blob()));let x=`tmp_files/chatroom/attached.${r.userInput.file.file_ext}`;yield r.indexed.saveBlobToUserPath(r.userInput.file.blob,x);let C=document.getElementById("ChatroomSelectedImage");h.path=x,h.width=C.naturalWidth,h.height=C.naturalHeight,R=r.userInput.file.content_related_creator}catch(x){return void r.p5toast.show({text:`${r.lang.text.ContentViewer.CannotEditFile}: ${x}`})}break;case"text":h.text=r.userInput.file.thumbnail}r.modalCtrl.create({component:B.S,componentProps:h,cssClass:"fullscreen"}).then(x=>{x.onWillDismiss().then(function(){var C=(0,g.c)(function*(P){P.data&&(yield r.voidDraw_fileAct_callback(P,R))});return function(P){return C.apply(this,arguments)}}()),x.onDidDismiss().then(()=>{r.ionViewDidEnter()}),r.removeShortCutKey(),x.present()})});return function(){return I.apply(this,arguments)}}()},{icon:"reader-outline",name:this.lang.text.ChatRoom.newText,act:function(){var I=(0,g.c)(function*(){r.userInputTextArea||(r.userInputTextArea=document.getElementById(r.ChannelUserInputId));let h={info:{content:{is_new:void 0,type:"text/plain",viewer:"text",filename:void 0,path:void 0}},no_edit:void 0};if(r.userInput.file)switch(r.userInput.file.viewer){case"code":case"text":let R="tmp_files/chatroom/edit_text.txt";yield r.indexed.saveBlobToUserPath(r.userInput.file.blob,R),h.info.content.path=R,h.info.content.type=r.userInput.file.type,h.info.content.viewer=r.userInput.file.viewer,h.info.content.filename=r.userInput.file.filename||r.userInput.file.name}else{let R=new Date,x=R.getUTCFullYear(),C=("0"+(R.getMonth()+1)).slice(-2),P=("0"+R.getDate()).slice(-2),q=("0"+R.getHours()).slice(-2),L=("0"+R.getMinutes()).slice(-2),D=("0"+R.getSeconds()).slice(-2);h.info.content.is_new="text",h.info.content.filename=`texteditor_${x}-${C}-${P}_${q}-${L}-${D}.txt`,h.no_edit=!0}r.modalCtrl.create({component:U.K,componentProps:h}).then(R=>{R.onWillDismiss().then(x=>{if(x.data){let C={};C.content_creator={timestamp:(new Date).getTime(),display_name:r.nakama.users.self.display_name,various:"textedit"},C.content_related_creator=[],C.content_related_creator.push(C.content_creator),C.blob=x.data.blob,C.path=x.data.path,C.size=x.data.blob.size,C.filename=x.data.blob.name||h.info.content.filename,C.file_ext=C.filename.split(".").pop(),C.type="text/plain",C.viewer="text",r.userInput.file=C}}),R.onDidDismiss().then(()=>{r.ionViewDidEnter()}),r.removeShortCutKey(),R.present()})});return function(){return I.apply(this,arguments)}}()},{icon:"camera-outline",name:this.lang.text.ChatRoom.Camera,act:function(){var I=(0,g.c)(function*(){try{const h=yield F.Ut.getPhoto({quality:90,resultType:F.on.Base64,source:F._8.Camera});let R=yield r.loadingCtrl.create({message:r.lang.text.TodoDetail.WIP});R.present(),r.userInputTextArea||(r.userInputTextArea=document.getElementById(r.ChannelUserInputId)),r.userInput.file={},r.userInput.file.filename=`Camera_${(new Date).toLocaleString().replace(/:/g,"_")}.${h.format}`,r.userInput.file.file_ext=h.format,r.userInput.file.thumbnail=r.sanitizer.bypassSecurityTrustUrl("data:image/jpeg;base64,"+h.base64String),r.userInput.file.type=`image/${h.format}`,r.userInput.file.typeheader="image",r.userInput.file.content_related_creator=[{user_id:r.info.local?"local":r.nakama.servers[r.isOfficial][r.target].session.user_id,timestamp:(new Date).getTime(),display_name:r.nakama.users.self.display_name,various:"camera"}],r.userInput.file.content_creator={user_id:r.info.local?"local":r.nakama.servers[r.isOfficial][r.target].session.user_id,timestamp:(new Date).getTime(),display_name:r.nakama.users.self.display_name,various:"camera"},yield r.indexed.saveBase64ToUserPath("data:image/jpeg;base64,"+h.base64String,`tmp_files/chatroom/${r.userInput.file.filename}`,C=>{r.userInput.file.blob=new Blob([C],{type:r.userInput.file.type})}),R.dismiss()}catch{}});return function(){return I.apply(this,arguments)}}()},{icon:"mic-circle-outline",name:this.lang.text.ChatRoom.Voice,act:function(){var I=(0,g.c)(function*(){if(r.useVoiceRecording=!r.useVoiceRecording,r.useVoiceRecording)(yield V.G.hasAudioRecordingPermission()).value?(r.extended_buttons[7].icon="stop-circle-outline",yield V.G.startRecording(),r.p5toast.show({text:r.lang.text.ChatRoom.StartVRecord})):yield V.G.requestAudioRecordingPermission();else{let h=yield V.G.stopRecording(),R=r.global.Base64ToBlob(`${h.value.mimeType},${h.value.recordDataBase64}`);R.name=`${r.lang.text.ChatRoom.VoiceRecord}.${h.value.mimeType.split("/").pop().split(";")[0]}`,R.type_override=h.value.mimeType,r.selected_blobFile_callback_act(R),r.extended_buttons[7].icon="mic-circle-outline"}});return function(){return I.apply(this,arguments)}}()},{icon:"cloud-done-outline",name:this.lang.text.ChatRoom.Detour,act:()=>{this.toggle_custom_attach()}},{icon:"call-outline",name:this.lang.text.ChatRoom.VoiceChat,act:function(){var I=(0,g.c)(function*(){try{yield r.webrtc.initialize("audio",void 0,{isOfficial:r.isOfficial,target:r.target,channel_id:r.info.id,user_id:r.info.info.id||r.info.info.user_id}),r.webrtc.CurrentMatch=yield r.nakama.servers[r.isOfficial][r.target].socket.createMatch(),yield r.nakama.servers[r.isOfficial][r.target].socket.writeChatMessage(r.info.id,{match:r.webrtc.CurrentMatch.match_id}),r.scroll_down_logs(),r.webrtc.CreateOfffer()}catch(h){r.p5toast.show({text:`${r.lang.text.ChatRoom.JoinMatchFailed}: ${h}`})}});return function(){return I.apply(this,arguments)}}()},{icon:"volume-mute-outline",name:this.lang.text.ChatRoom.ReadText,act:function(){var I=(0,g.c)(function*(){r.toggle_speakermode()});return function(){return I.apply(this,arguments)}}()},{icon:"log-out-outline",name:this.lang.text.ChatRoom.LogOut,act:function(){var I=(0,g.c)(function*(){if(3!=r.info.redirect.type)try{yield r.nakama.servers[r.isOfficial][r.target].socket.leaveChat(r.info.id),r.nakama.channels_orig[r.isOfficial][r.target][r.info.id].status="missing",r.extended_buttons.forEach(h=>{h.isHide=!0}),r.extended_buttons[12].isHide=!1}catch(h){console.error("\ucc44\ub110\uc5d0\uc11c \ub098\uc624\uae30 \uc2e4\ud328: ",h)}else r.extended_buttons[11].isHide=!0;r.ionViewDidEnter()});return function(){return I.apply(this,arguments)}}()},{isHide:!0,name:this.lang.text.ChatRoom.RemoveHistory,icon:"close-circle-outline",act:()=>{this.alertCtrl.create({header:this.lang.text.ChatRoom.RemoveChannel,message:this.lang.text.ChatRoom.CannotUndone,buttons:[{text:this.lang.text.ChatRoom.Delete,handler:function(){var I=(0,g.c)(function*(){let h=yield r.loadingCtrl.create({message:r.lang.text.TodoDetail.WIP});h.present(),delete r.nakama.channels_orig[r.isOfficial][r.target][r.info.id];try{switch(r.info.redirect.type){case 3:yield r.nakama.remove_group_list(r.nakama.groups[r.isOfficial][r.target][r.info.group_id]||r.info.info,r.isOfficial,r.target);break;case 0:yield r.indexed.removeFileFromUserPath(`servers/${r.isOfficial}/${r.target}/groups/${r.info.id}.img`)}}catch(x){console.log("\uadf8\ub8f9 \uc774\ubbf8\uc9c0 \uc0ad\uc81c \uc624\ub958: ",x)}try{delete r.nakama.groups[r.isOfficial][r.target][r.info.group_id]}catch(x){console.log("DeleteGroupFailed: ",x)}r.nakama.save_groups_with_less_info();try{let x=localStorage.getItem("fallback_fs");if(!x)throw"\uc0ac\uc6a9\uc790 \uc9c0\uc815 \uc11c\ubc84 \uc5c6\uc74c";let C=x.split(":"),L=`${C[0].replace(/(\b25[0-5]|\b2[0-4][0-9]|\b[01]?[0-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}/g,"")?"https:":"http:"}//${C[0]}:${C[1]||9002}/`,D=`${r.info.id}_${r.nakama.users.self.display_name}`;try{D=`${r.info.info.id}_${r.nakama.servers[r.isOfficial][r.target].session.user_id}`}catch{}r.global.remove_files_from_storage_with_key(L,D)}catch{}try{r.global.remove_files_from_storage_with_key(`${[r.info.info.server.useSSL?"https:":"http:"]}//${r.info.info.server.address}:9002/`,`${r.info.info.id}_${r.nakama.servers[r.isOfficial][r.target].session.user_id}`)}catch{}let R=yield r.indexed.GetFileListFromDB(`servers/${r.isOfficial}/${r.target}/channels/${r.info.id}`);for(let x=0,C=R.length;x<C;x++)h.message=`${r.lang.text.UserFsDir.DeleteFile}: ${C-x}`,yield r.indexed.removeFileFromUserPath(R[x]);h.dismiss(),r.navCtrl.pop()});return function(){return I.apply(this,arguments)}}(),cssClass:"redfont"}]}).then(I=>{this.global.p5key.KeyShortCut.Escape=()=>{I.dismiss()},I.onDidDismiss().then(()=>{this.global.p5key.KeyShortCut.Escape=()=>{this.navCtrl.pop()}}),I.present()})}}],this.useVoiceRecording=!1,this.useFirstCustomCDN=0,this.HasBackgroundImage=!1,this.next_cursor="",this.prev_cursor="",this.file_sel_id="file_sel_id",this.ShowGoToBottom=!1,this.isMobile=!1,this.BackButtonPressed=!1,this.BlockAutoScrollDown=!1,this.last_message_viewer={user_id:void 0,message:void 0,color:void 0,is_me:void 0},this.users_image={},this.userInput={file:void 0,text:"",qoute:void 0},this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder,this.pullable=!0,this.ViewableMessage=[],this.ViewMsgIndex=0,this.RefreshCount=15,this.ViewCount=45,this.ShowRecentMsg=!1,this.useSpeaker=!1,this.isSpeeching=!1,this.SpeechThese=[],this.isHistoryLoaded=!1,this.LocalHistoryList=[],this.isHidden=!0,this.ChannelUserInputId="ChannelUserInputId",this.block_send=!1,this.isOtherAct=!1,this.lock_modal_open=!1}ionViewDidEnter(){V.G.getCurrentStatus().then(i=>{"RECORDING"==i.status&&(this.extended_buttons[7].isHide=!0)}),this.global.p5key.KeyShortCut.Escape=()=>{this.navCtrl.pop()},this.global.p5key.KeyShortCut.BottomTab=i=>{document.activeElement!=document.getElementById(this.ChannelUserInputId)&&"E"===i&&this.open_ext_with_delay()};let t=[];for(let i=0,n=this.extended_buttons.length;i<n;i++)this.extended_buttons[i].isHide||t.push(this.extended_buttons[i]);this.global.p5key.KeyShortCut.Digit=i=>{!this.isHidden&&document.activeElement!=document.getElementById(this.ChannelUserInputId)&&t.length>i&&t[i].act()},this.global.p5key.KeyShortCut.EnterAct=()=>{document.activeElement!=document.getElementById(this.ChannelUserInputId)&&setTimeout(()=>{this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId)),this.userInputTextArea.focus()},0)},this.noti.Current=this.info.cnoti_id,this.useFirstCustomCDN=Number(localStorage.getItem("useFFSCDN"))||0,this.toggle_custom_attach(this.useFirstCustomCDN)}new_attach(t,i=void 0){var n=this;return(0,g.c)(function*(){switch(void 0===i&&(i={}),t.detail.value){case"load":n.userInputTextArea||(n.userInputTextArea=document.getElementById(n.ChannelUserInputId)),document.getElementById(n.file_sel_id).click();break;case"link":try{let o=i.url;if(!n.userInput.file&&void 0===o)try{o=yield n.mClipboard.paste()}catch{try{o=yield H.c.read()}catch(m){throw m}}try{let _=n.global.Base64ToBlob(o),m=o.split(";")[0].split(":")[1],p=new File([_],`${n.lang.text.ChatRoom.FileLink}.${m.split("/").pop()}`,{type:m});throw yield n.selected_blobFile_callback_act(p),"done"}catch(_){if("done"===_)throw _}try{if(n.userInput.file&&void 0===i.filename)throw"\uc774\ubbf8 \ud30c\uc77c\uc774 \ucca8\ubd80\ub428, \ud1a0\uae00\ub9cc \uc2dc\ub3c4";if(!(yield fetch(o)).ok)throw"URL \uad6c\uc870\uac00 \uc815\uc0c1\uc774 \uc544\ub2d8"}catch(_){throw _}let l={};l.url=o,l.content_related_creator=[],i&&i.content_related_creator&&(l.content_related_creator=[...i.content_related_creator]),l.content_related_creator.push({user_id:n.info.local?"local":n.nakama.servers[n.isOfficial][n.target].session.user_id,timestamp:(new Date).getTime(),display_name:n.nakama.users.self.display_name,various:i.url?"shared":"link"}),l.content_creator={user_id:n.info.local?"local":n.nakama.servers[n.isOfficial][n.target].session.user_id,timestamp:(new Date).getTime(),display_name:n.nakama.users.self.display_name,various:i.url?"shared":"link"};let d=l.url.split(".");l.file_ext=i.file_ext||d.pop().split("?").shift(),l.filename=i.filename||decodeURIComponent(`${d.pop().split("/").pop()||n.lang.text.ChatRoom.ExternalLinkFile}.${l.file_ext}`),n.global.set_viewer_category_from_ext(l),l.type=i.type||"",l.typeheader=i.typeheader||l.viewer,n.global.modulate_thumbnail(l,l.url),n.NeedScrollDown()&&setTimeout(()=>{n.scroll_down_logs()},100),n.userInput.file=l,n.inputPlaceholder=`(${n.lang.text.ChatRoom.FileLink}: ${n.userInput.file.filename})`}catch(o){throw"done"==o?o:`\uc778\uc2dd \ubd88\uac00\ub2a5\ud55c URL \uc815\ubcf4: ${o}`}}})()}toggle_custom_attach(t){var i=this;return(0,g.c)(function*(){switch(i.useFirstCustomCDN=(null!=t?t:i.useFirstCustomCDN+1)%(0==i.info.redirect.type?2:3),"Android"==$.s1&&(i.useFirstCustomCDN=2,i.extended_buttons[8].isHide=!0),i.useFirstCustomCDN){case 0:i.extended_buttons[8].icon="cloud-offline-outline",i.extended_buttons[8].name=i.lang.text.ChatRoom.Detour;break;case 1:i.extended_buttons[8].icon="cloud-done-outline",i.extended_buttons[8].name=i.lang.text.ChatRoom.useFSS;break;case 2:i.extended_buttons[8].icon="server-outline",i.extended_buttons[8].name=i.lang.text.ChatRoom.forceSQL}localStorage.setItem("useFFSCDN",`${i.useFirstCustomCDN}`)})()}toggle_speakermode(t){var i=this;return(0,g.c)(function*(){if(i.useSpeaker=null!=t?t:!i.useSpeaker,i.extended_buttons[10].icon=i.useSpeaker?"volume-high-outline":"volume-mute-outline",i.useSpeaker?localStorage.setItem("useChannelSpeaker",`${i.useSpeaker}`):localStorage.removeItem("useChannelSpeaker"),!i.useSpeaker)try{yield K.stop()}catch{}})()}LoadChannelBackgroundImage(){var t=this;return(0,g.c)(function*(){try{let i=yield t.indexed.loadBlobFromUserPath(`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/backgroundImage.png`,"");t.ChangeBackgroundImage({target:{files:[i]}}),t.HasBackgroundImage=!0}catch{}})()}RemoveChannelBackgroundImage(){var t=this;return(0,g.c)(function*(){try{yield t.indexed.removeFileFromUserPath(`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/backgroundImage.png`),document.getElementById("main_table").style.backgroundImage='url("")'}catch{}t.HasBackgroundImage=!1})()}ChangeBackgroundImage(t){let i=document.getElementById("main_table"),n=t.target.files[0],o=URL.createObjectURL(n);i.style.backgroundImage=`url('${o}')`,this.indexed.saveBlobToUserPath(n,`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/backgroundImage.png`),this.HasBackgroundImage=!0,setTimeout(()=>{URL.revokeObjectURL(o)},100)}inputFileSelected(t){var i=this;return(0,g.c)(function*(){if(t.target.files.length)if(1!=t.target.files.length){let o=yield i.alertCtrl.create({header:i.lang.text.ChatRoom.MultipleSend,message:`${i.lang.text.ChatRoom.CountFile}: ${t.target.files.length}`,buttons:[{text:i.lang.text.ChatRoom.Send,handler:(l=(0,g.c)(function*(){let d=yield i.loadingCtrl.create({message:i.lang.text.ChatRoom.MultipleSend});d.present(),i.noti.noti.schedule({id:7,title:i.lang.text.ChatRoom.MultipleSend,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://diychat",color:"b0b0b0"});for(let _=0,m=t.target.files.length;_<m;_++)d.message=`${m-_}: ${t.target.files[_].name}`,i.noti.noti.schedule({id:7,title:`${i.lang.text.ChatRoom.MultipleSend}: ${t.target.files[_].name}`,progressBar:{value:_,maxValue:m},sound:null,smallIcon:"res://diychat",color:"b0b0b0"}),yield i.selected_blobFile_callback_act(t.target.files[_]),yield i.send();i.noti.ClearNoti(7),d.dismiss(),setTimeout(()=>{i.scroll_down_logs(),document.getElementById(i.file_sel_id).value=""},300)}),function(){return l.apply(this,arguments)})}]});i.global.p5key.KeyShortCut.Escape=()=>{o.dismiss()},o.onDidDismiss().then(()=>{i.global.p5key.KeyShortCut.Escape=()=>{i.navCtrl.pop()}}),o.present()}else{let o=yield i.loadingCtrl.create({message:i.lang.text.TodoDetail.WIP});o.present(),yield i.selected_blobFile_callback_act(t.target.files[0]),o.dismiss(),document.getElementById(i.file_sel_id).value=""}else delete i.userInput.file,i.inputPlaceholder=i.lang.text.ChatRoom.input_placeholder,document.getElementById(i.file_sel_id).value="";var l})()}LocalChannelImageChanged(t){var i=this;return(0,g.c)(function*(){let n=yield i.global.GetBase64ThroughFileReader(t.target.files[0]);i.nakama.limit_image_size(n,o=>{i.info.info.img=o.canvas.toDataURL(),i.indexed.saveTextFileToUserPath(i.info.info.img,`servers/${i.info.server.isOfficial}/${i.info.server.target}/groups/${i.info.id}.img`),i.p5toast.show({text:i.lang.text.ChatRoom.LocalImageChanged})})})()}InitBrowserBackButtonOverride(){window.history.pushState(null,null,window.location.href),window.onpopstate=()=>{this.BackButtonPressed||(this.BackButtonPressed=!0,this.navCtrl.back())}}ngOnInit(){var t=this;this.InitBrowserBackButtonOverride(),this.useSpeaker=!!localStorage.getItem("useChannelSpeaker"),this.toggle_speakermode(this.useSpeaker),this.ChatLogs=document.getElementById("chatroom_div"),this.ChatLogs.onscroll=i=>{this.ChatLogs.scrollHeight-(this.ChatLogs.scrollTop+this.ChatLogs.clientHeight)<1&&(this.ShowGoToBottom||this.ShowRecentMsg||this.init_last_message_viewer(),this.ShowRecentMsg&&!this.BlockAutoScrollDown&&this.pull_msg_history(!1)),this.ShowGoToBottom=this.ChatLogs.scrollHeight-220>this.ChatLogs.scrollTop+this.ChatLogs.clientHeight||this.ShowRecentMsg},this.nakama.ChatroomLinkAct=function(){var i=(0,g.c)(function*(n,o){delete t.nakama.channels_orig[t.isOfficial][t.target][t.info.id].update,t.info=n,yield t.init_chatroom(),t.userInput.file=o,t.userInput.file&&t.create_thumbnail_imported(o)});return function(n,o){return i.apply(this,arguments)}}(),this.route.queryParams.subscribe(function(){var i=(0,g.c)(function*(n){const o=t.router.getCurrentNavigation().extras.state;o&&(t.info=o.info),yield new Promise(l=>setTimeout(l,100)),yield t.init_chatroom(),t.userInput.file=o.file,t.userInput.file&&t.create_thumbnail_imported(o.file)});return function(n){return i.apply(this,arguments)}}()),setTimeout(()=>{this.CreateDrop()},0),this.isMobile="Android"==$.s1||"iOS"==$.s1,this.nakama.StatusBarChangedCallback=(0,g.c)(function*(){yield t.SetExtensionButtons()})}ionViewWillEnter(){this.ChatContDiv=document.getElementById("chatroom_content_div"),document.getElementById(this.ChannelUserInputId).onpaste=t=>{let i=[];for(const n of t.clipboardData.files)n.type.startsWith("image/")&&i.push({file:n});if(i.length)return 1==i.length?this.selected_blobFile_callback_act(i[0].file):this.alertCtrl.create({header:this.lang.text.ChatRoom.MultipleSend,message:`${this.lang.text.ChatRoom.CountFile}: ${i.length}`,buttons:[{text:this.lang.text.ChatRoom.Send,handler:()=>{this.DropSendAct(i)}}]}).then(n=>{this.global.p5key.KeyShortCut.Escape=()=>{n.dismiss()},n.onDidDismiss().then(()=>{this.global.p5key.KeyShortCut.Escape=()=>{this.navCtrl.pop()}}),n.present()}),!1}}GetSpeechToText(){var t=this;return(0,g.c)(function*(){yield V.G.requestAudioRecordingPermission();let i=yield X.I.start({language:t.lang.lang,maxResults:1,prompt:t.lang.text.ChatRoom.TalkMessage,partialResults:!0,popup:!0});t.userInput.text=i.matches[0]})()}CreateDrop(){var t=this;let i=document.getElementById("p5Drop_chatroom");this.p5canvas=new Y(n=>{n.setup=()=>{let v=n.createCanvas(i.clientWidth,i.clientHeight);v.parent(i),n.pixelDensity(.1),v.drop(b=>{let E=n.millis();d<E-400?(l=!1,_.length=0,_.push(b)):(l=!0,_.push(b)),d=E,clearTimeout(o),o=setTimeout((0,g.c)(function*(){if(l)t.alertCtrl.create({header:t.lang.text.ChatRoom.MultipleSend,message:`${t.lang.text.ChatRoom.CountFile}: ${_.length}`,buttons:[{text:t.lang.text.ChatRoom.Send,handler:()=>{t.DropSendAct(_)}}]}).then(T=>{t.global.p5key.KeyShortCut.Escape=()=>{T.dismiss()},T.onDidDismiss().then(()=>{t.global.p5key.KeyShortCut.Escape=()=>{t.navCtrl.pop()}}),T.present()});else{let T=yield t.loadingCtrl.create({message:t.lang.text.TodoDetail.WIP});T.present(),t.selected_blobFile_callback_act(b.file),T.dismiss()}}),400)}),this.p5canvas.ChatMsgDragAct=y};let o,l=!1,d=0,_=[];n.mouseMoved=v=>{v.dataTransfer?(i.style.pointerEvents="all",i.style.backgroundColor="#0008"):(i.style.pointerEvents="none",i.style.backgroundColor="transparent")};let p=0;n.mouseDragged=v=>{y(v.clientX)},n.touchMoved=v=>{try{y(v.touches[0].clientX)}catch{}};let y=v=>{this.MsgClickedStartPos&&this.TargetMessageObject&&(p=this.MsgClickedStartPos-v,this.IsQouteMyMessage?this.TargetMessageObject.style.paddingRight=`${p}px`:this.TargetMessageObject.style.marginLeft=-p+"px",this.TargetMessageObject.style.backgroundColor=50<p?"rgba(var(--ion-color-primary-rgb), .5)":null)};n.mouseReleased=()=>{O()},n.touchEnded=()=>{O()};let O=()=>{if(this.MsgClickedStartPos&&this.TargetMessageObject){if(50<p)try{let v;for(let T=0,r=this.ViewableMessage.length;T<r;T++)if(this.TargetMessageObject.id==this.ViewableMessage[T].message_id){v=T;break}if(void 0===v)throw"\uba54\uc2dc\uc9c0\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc74c";let b=this.ViewableMessage[v],E=this.deserialize_text(b);if(this.userInput.qoute={timestamp:b.create_time},E&&(this.userInput.qoute.text=((v,b)=>v.length>10?v.slice(0,9)+"\u2026":v)(E)),"image"==b.content.viewer)if(b.content.url)this.userInput.qoute.url=b.content.url;else if(b.content.path&&(this.userInput.qoute.path=b.content.path.split("/").pop(),!this.userInput.qoute.url)){let T=`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/${this.userInput.qoute.path}`;this.indexed.checkIfFileExist(T,r=>{r&&this.indexed.loadBlobFromUserPath(T,"",I=>{let h=URL.createObjectURL(I);this.userInput.qoute.url=h,setTimeout(()=>{URL.revokeObjectURL(h)},100)})})}this.userInput.qoute.id=b.message_id}catch(v){console.log("\uba54\uc2dc\uc9c0 \uc0c1\uc138\ubcf4\uae30 \uc2e4\ud328: ",v)}this.TargetMessageObject.style.backgroundColor=null,this.TargetMessageObject.style.paddingRight=null,this.TargetMessageObject.style.marginLeft=null,p=0}this.MsgClickedStartPos=void 0,this.TargetMessageObject=void 0,this.IsQouteMyMessage=void 0}})}FindQoute(t,i){var n=this;return(0,g.c)(function*(){let o;for(let d=n.ViewableMessage.length-1;d>=0;d--)if(t==n.ViewableMessage[d].message_id){o=document.getElementById(t);break}n.BlockAutoScrollDown=!0;let l=yield n.loadingCtrl.create({message:n.lang.text.TodoDetail.WIP});if(l.present(),!o){let d=!1;for(;!o&&n.pullable&&!d;){yield n.pull_msg_history(),yield new Promise(_=>setTimeout(_,200));for(let _=n.ViewableMessage.length-1;_>=0;_--){if(new Date(n.ViewableMessage[_].create_time).getTime()<new Date(i).getTime()){d=!0;break}if(t==n.ViewableMessage[_].message_id){o=document.getElementById(t);break}}}}o?(o.scrollIntoView({block:"center",behavior:"smooth"}),setTimeout(()=>{o.style.backgroundColor="rgba(var(--ion-color-primary-rgb), .5)"},100),setTimeout(()=>{o.style.backgroundColor=null},3500)):n.p5toast.show({text:n.lang.text.ChatRoom.LostOriginMsg}),n.BlockAutoScrollDown=!1,l.dismiss()})()}RemoveQoute(){delete this.userInput.qoute}DropSendAct(t){var i=this;return(0,g.c)(function*(){let n=yield i.loadingCtrl.create({message:i.lang.text.TodoDetail.WIP});n.present();for(let o=0,l=t.length;o<l;o++)yield i.selected_blobFile_callback_act(t[o].file),yield i.send();n.dismiss(),setTimeout(()=>{i.scroll_down_logs()},300)})()}selected_blobFile_callback_act(t,i=[],n="loaded",o){var l=this;return(0,g.c)(function*(){l.userInput.file={},l.userInput.file.filename=t.name,l.userInput.file.file_ext=t.name.split(".").pop()||t.type||l.lang.text.ChatRoom.unknown_ext,l.userInput.file.size=t.size,l.userInput.file.type=t.type||t.type_override,o&&(l.userInput.file.path=o),l.userInput.file.content_related_creator=[...i,{user_id:l.info.local?"local":l.nakama.servers[l.isOfficial][l.target].session.user_id,timestamp:(new Date).getTime(),display_name:l.nakama.users.self.display_name,various:n}],l.userInput.file.content_creator={user_id:l.info.local?"local":l.nakama.servers[l.isOfficial][l.target].session.user_id,timestamp:(new Date).getTime(),display_name:l.nakama.users.self.display_name,various:n},l.userInput.file.blob=t,l.create_selected_thumbnail(),l.inputPlaceholder=`(${l.lang.text.ChatRoom.attachments}: ${l.userInput.file.filename})`})()}create_thumbnail_imported(t){var i=this;return(0,g.c)(function*(){if(t.url)yield i.new_attach({detail:{value:"link"}},t);else{let n=yield i.indexed.loadBlobFromUserPath(t.path,t.type);n.name=t.filename||t.name,i.selected_blobFile_callback_act(n,t.content_related_creator,"shared",t.path)}})()}create_selected_thumbnail(){var t=this;return(0,g.c)(function*(){if(t.global.set_viewer_category_from_ext(t.userInput.file),t.userInput.file.url){try{(yield fetch(t.userInput.file.url)).ok&&(t.userInput.file.thumbnail=t.userInput.file.url)}catch{}return void(t.userInput.file.typeheader=t.userInput.file.viewer)}try{t.userInput.file.thumbnail=yield t.indexed.loadBlobFromUserPath(t.userInput.file.path,t.userInput.file.type)}catch{}let i=URL.createObjectURL(t.userInput.file.blob);switch(t.userInput.file.typeheader=t.userInput.file.blob.type.split("/")[0]||t.userInput.file.viewer,setTimeout(()=>{URL.revokeObjectURL(i)},0),t.userInput.file.thumbnail=void 0,t.userInput.file.typeheader){case"image":t.userInput.file.thumbnail=t.sanitizer.bypassSecurityTrustUrl(i);break;case"text":new Y(n=>{n.setup=()=>{n.noCanvas(),n.loadStrings(i,o=>{t.userInput.file.thumbnail=o,n.remove()},o=>{console.error("\ubb38\uc790\uc5f4 \ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",o),n.remove()})}})}})()}init_chatroom(){var t=this;return(0,g.c)(function*(){t.userInput.text="",delete t.userInput.file,delete t.userInput.qoute,t.ResizeTextArea(),t.nakama.OnTransferMessage={},t.ViewableMessage.length=0,t.ViewMsgIndex=0,t.ShowGoToBottom=!1,t.ShowRecentMsg=!1,t.isHistoryLoaded=!1,t.LocalHistoryList.length=0,t.messages.length=0,t.prev_cursor="",t.next_cursor="",t.pullable=!0,t.init_last_message_viewer(),t.file_sel_id=`chatroom_${t.info.id}_${(new Date).getTime()}`,t.ChannelUserInputId=`chatroom_input_${t.info.id}_${(new Date).getTime()}`,t.noti.Current=t.info.cnoti_id,t.info.cnoti_id&&t.noti.ClearNoti(t.info.cnoti_id),window.onfocus=()=>{t.info.cnoti_id&&t.noti.ClearNoti(t.info.cnoti_id)},t.noti.RemoveListener(`openchat${t.info.cnoti_id}`),t.isOfficial=t.info.server.isOfficial,t.target=t.info.server.target,t.info=t.nakama.channels_orig[t.isOfficial][t.target][t.info.id],t.users_image={};try{for(let i=0,n=t.info.info.users.length;i<n;i++)t.users_image[t.info.info.users[i].user.id]=t.info.info.users[i].user.img}catch{}try{t.users_image[t.info.info.id]=t.info.info.img}catch{}t.LoadChannelBackgroundImage(),t.nakama.opened_page_info.channel={isOfficial:t.isOfficial,target:t.target,id:t.info.id},t.foundLastRead=t.info.last_read_id==t.info.last_comment_id,yield t.SetExtensionButtons(),t.nakama.channels_orig[t.isOfficial][t.target]&&t.nakama.channels_orig[t.isOfficial][t.target][t.info.id]&&"missing"!=t.info.status&&(t.nakama.channels_orig[t.isOfficial][t.target][t.info.id].update=i=>{if(1==i.code){for(let o=0,l=t.messages.length;o<l;o++)if(t.messages[o].message_id==i.message_id){t.messages[o].content=i.content;break}return}let n="local"==i.sender_id;if(i.content.filename&&t.ModulateFileEmbedMessage(i),t.info.last_read_id=t.info.last_comment_id,n||t.check_if_send_msg(i),1==i.code||2==i.code||t.messages.push(i),2==i.code)for(let o=t.messages.length-1;o>=0;o--)if(t.messages[o].message_id==i.message_id){t.messages.splice(o,1);break}i.content.qoute&&i.content.qoute.path&&t.OpenQouteThumbnail(i),t.ViewMsgIndex+t.ViewCount==t.messages.length-1&&t.ViewMsgIndex++,t.ViewableMessage=t.messages.slice(t.ViewMsgIndex,t.ViewMsgIndex+t.ViewCount),t.modulate_chatmsg(0,t.ViewableMessage.length),t.modulate_chatmsg(t.ViewableMessage.length-1,t.ViewableMessage.length),t.ShowRecentMsg=t.messages.length>t.ViewMsgIndex+t.ViewCount,t.useSpeaker&&t.SpeechReceivedMessage(i),setTimeout(()=>{let o=document.getElementById(i.message_id);if(o&&("DesktopPWA"==$.s1?null==o.onmousedown&&(o.onmousedown=l=>{t.IsQouteMyMessage=i.is_me,t.MsgClickedStartPos=l.clientX,t.TargetMessageObject=o,2==l.which&&(t.MsgClickedStartPos=l.clientX+60,t.p5canvas.ChatMsgDragAct(l.clientX))}):null==o.ontouchstart&&(o.ontouchstart=l=>{try{t.IsQouteMyMessage=i.is_me,t.MsgClickedStartPos=l.touches[0].clientX,t.TargetMessageObject=o}catch{}}),null==o.oncontextmenu&&(o.oncontextmenu=()=>{try{let l;for(let d=0,_=t.ViewableMessage.length;d<_;d++)if(o.id==t.ViewableMessage[d].message_id){l=d;break}if(void 0===l)throw"\uba54\uc2dc\uc9c0\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc74c";t.CopyMessageText(t.ViewableMessage[l]),t.message_detail(i,l)}catch(l){console.log("\uba54\uc2dc\uc9c0 \uc0c1\uc138\ubcf4\uae30 \uc2e4\ud328: ",l)}return!1})),t.info.is_new=!1,t.nakama.has_new_channel_msg=!1,t.NeedScrollDown()&&!t.ShowRecentMsg)t.init_last_message_viewer(),t.ChatLogs.scrollTo({top:t.ChatLogs.scrollHeight,behavior:"smooth"});else if(2!=i.code){t.last_message_viewer.is_me=!!t.info.local||i.sender_id==t.nakama.servers[t.isOfficial][t.target].session.user_id,t.last_message_viewer.user_id=i.sender_id;let l=JSON.parse(JSON.stringify(i.content.msg));i.content.filename&&(l.length?l[0][0].text=`(${t.lang.text.ChatRoom.attachments}) ${l[0][0].text}`:l=[[{text:`(${t.lang.text.ChatRoom.attachments})`}]]),t.last_message_viewer.message=l,t.last_message_viewer.color=i.color}},100),t.global.godot_window&&t.global.godot_window.received_msg&&t.global.godot_window.received_msg({sender_id:i.sender_id,user_display_name:i.user_display_name,content:i.content})}),yield t.pull_msg_history(),setTimeout(()=>{t.ChatLogs.scrollTo({top:t.ChatLogs.scrollHeight,behavior:"smooth"})},500)})()}OpenQouteThumbnail(t){let i=`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/${t.content.qoute.path}`;this.indexed.checkIfFileExist(i,n=>{n&&this.indexed.loadBlobFromUserPath(i,"",o=>{let l=URL.createObjectURL(o);t.content.qoute.url=l,setTimeout(()=>{URL.revokeObjectURL(l)},100)})})}SetExtensionButtons(){var t=this;return(0,g.c)(function*(){switch(t.extended_buttons.forEach(i=>{i.isHide=!1}),t.info.redirect.type){case 2:"missing"!=t.info.status&&(t.info.redirect?"online"==t.statusBar.groupServer[t.isOfficial][t.target]&&(t.info.status=t.nakama.load_other_user(t.info.redirect.id,t.isOfficial,t.target).online?"online":"pending"):t.info.status=t.info.info.online?"online":"pending",t.extended_buttons[0].isHide=!0,t.extended_buttons[1].isHide=!0,t.extended_buttons[9].isHide=!1,t.extended_buttons[12].isHide=!0);break;case 3:"missing"!=t.info.status&&(yield t.nakama.load_groups(t.isOfficial,t.target,t.info.group_id)),t.extended_buttons[1].isHide=!0,t.extended_buttons[11].isHide=!0,delete t.extended_buttons[0].isHide,t.extended_buttons[9].isHide=!0,t.extended_buttons[12].isHide=!0;break;case 0:t.extended_buttons[0].isHide=!0,t.extended_buttons[9].isHide=!0,t.extended_buttons[11].isHide=!0}(void 0===t.info.status||"missing"==t.info.status)&&(t.extended_buttons.forEach(i=>{i.isHide=!0}),t.extended_buttons[12].isHide=!1,3==t.info.redirect.type&&(t.extended_buttons[0].isHide=!1)),t.extended_buttons[10].isHide=$.O$||"missing"==t.info.status})()}CopyMessageText(t){var i=this;return(0,g.c)(function*(){let n=i.deserialize_text(t),o=!1;if(!n)try{let l=t.content.path;n=yield i.indexed.loadBlobFromUserPath(l,t.content.type),o=!0}catch{t.content.url&&(n=t.content.url,o=!!n)}try{if(!o)throw"\ud14d\uc2a4\ud2b8 \ubcf5\uc0ac\ub85c \uc989\uc2dc \uc774\ub3d9";let l={};l[t.content.type]=n,yield navigator.clipboard.write([new ClipboardItem(l)]),"DesktopPWA"==$.s1&&i.p5toast.show({text:`${i.lang.text.GlobalAct.PCCopyImage}: ${t.content.filename}`})}catch{try{yield i.mClipboard.copy(n)}catch{try{yield H.c.write(n),"DesktopPWA"==$.s1&&i.p5toast.show({text:`${i.lang.text.GlobalAct.PCClipboard}: ${n}`})}catch(_){console.log("\ud074\ub9bd\ubcf4\ub4dc \ubcf5\uc0ac \uc2e4\ud328: ",_)}}}})()}init_last_message_viewer(){delete this.last_message_viewer.user_id,delete this.last_message_viewer.message,delete this.last_message_viewer.color,delete this.last_message_viewer.is_me}NeedScrollDown(){return this.ChatLogs.scrollHeight<this.ChatLogs.scrollTop+this.ChatLogs.clientHeight+200}scroll_down_logs(){this.ShowRecentMsg||this.init_last_message_viewer(),this.ChatLogs.scrollTo({top:this.ChatLogs.scrollHeight,behavior:"smooth"})}check_if_send_msg(t){for(let i=0,n=this.sending_msg.length;i<n;i++)if(t.sender_id==this.nakama.servers[this.isOfficial][this.target].session.user_id&&t.content.local_comp==this.sending_msg[i].content.local_comp){t.content.filename&&this.auto_open_thumbnail(t),this.sending_msg.splice(i,1);break}}auto_open_thumbnail(t){try{this.temporary_open_thumbnail[t.message_id]()}catch{this.temporary_open_thumbnail[t.message_id]=()=>{t.content.url?this.global.modulate_thumbnail(t.content,""):(this.indexed.loadBlobFromUserPath(`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${t.message_id}.${t.content.file_ext}`,t.content.type,n=>{t.content.path=`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${t.message_id}.${t.content.file_ext}`;let o=URL.createObjectURL(n);this.global.modulate_thumbnail(t.content,o),this.NeedScrollDown()&&setTimeout(()=>{this.scroll_down_logs()},100),this.nakama.WriteStorage_From_channel(t,t.content.path,this.isOfficial,this.target)}),delete this.temporary_open_thumbnail[t.message_id])}}}removeAttach(){delete this.userInput.file,this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder}pull_msg_history(t=!0){var i=this;return(0,g.c)(function*(){if(i.pullable||!t){if(i.pullable=!1,t){try{if(i.info.local)throw"Local channel";if(void 0===i.info.status||"missing"==i.info.status)throw"Channel missing";if(0!=i.ViewMsgIndex){let o=Math.min(i.ViewMsgIndex,i.RefreshCount);i.ViewMsgIndex-=o,i.ViewableMessage=i.messages.slice(i.ViewMsgIndex,i.ViewMsgIndex+i.ViewCount);for(let l=0;l<o;l++){let d;try{i.ViewableMessage[l].content.path=`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${i.ViewableMessage[l].message_id}.${i.ViewableMessage[l].content.file_ext}`;let _=yield i.indexed.loadBlobFromUserPath(i.ViewableMessage[l].content.path,i.ViewableMessage[l].content.file_ext);d=URL.createObjectURL(_)}catch{}i.global.modulate_thumbnail(i.ViewableMessage[l].content,d),i.modulate_chatmsg(l,o+1),i.ViewableMessage[l].content.qoute&&i.ViewableMessage[l].content.qoute.path&&i.OpenQouteThumbnail(i.ViewableMessage[l])}return i.modulate_chatmsg(0,i.ViewableMessage.length),i.ShowRecentMsg=i.messages.length>i.ViewMsgIndex+i.ViewCount,void(i.pullable=!0)}let n=yield i.nakama.servers[i.isOfficial][i.target].client.listChannelMessages(i.nakama.servers[i.isOfficial][i.target].session,i.info.id,i.RefreshCount,!1,i.next_cursor);i.info.is_new=!1,n.messages.forEach(o=>{o=i.nakama.modulation_channel_message(o,i.isOfficial,i.target),i.nakama.check_sender_and_show_name(o,i.isOfficial,i.target),i.info.last_comment||2!=o.code&&(i.info.last_comment=(o.content.filename?`(${i.lang.text.ChatRoom.attachments}) `:"")+(o.content.msg||o.content.noti||"")),!i.foundLastRead&&i.info.last_read_id?i.info.last_read_id==o.message_id&&(o.isLastRead=!0,i.foundLastRead=!0,i.info.last_read_id=i.info.last_comment_id,i.nakama.save_channels_with_less_info()):i.foundLastRead=!0,i.nakama.translate_updates(o),o.content.filename&&i.ModulateFileEmbedMessage(o),i.nakama.ModulateTimeDate(o),i.nakama.content_to_hyperlink(o),2!=o.code&&i.messages.unshift(o)}),i.ViewableMessage=i.messages.slice(i.ViewMsgIndex,i.ViewMsgIndex+i.ViewCount);for(let o=0,l=i.ViewableMessage.length;o<l;o++){let d;try{if(!i.ViewableMessage[o].content.file_ext)throw"\ud30c\uc77c\uc774 \uc5c6\ub294 \uba54\uc2dc\uc9c0";if(i.ViewableMessage[o].content.url)throw"\ub9c1\ud06c\ub41c \ud30c\uc77c";i.ViewableMessage[o].content.path=`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${i.ViewableMessage[o].message_id}.${i.ViewableMessage[o].content.file_ext}`,i.indexed.checkIfFileExist(i.ViewableMessage[o].content.path,_=>{_&&i.indexed.loadBlobFromUserPath(i.ViewableMessage[o].content.path,i.ViewableMessage[o].content.file_ext,m=>{d=URL.createObjectURL(m),i.global.modulate_thumbnail(i.ViewableMessage[o].content,d)})})}catch{i.global.modulate_thumbnail(i.ViewableMessage[o].content,"")}i.modulate_chatmsg(o,l+1),i.ViewableMessage[o].content.qoute&&i.ViewableMessage[o].content.qoute.path&&i.OpenQouteThumbnail(i.ViewableMessage[o])}i.modulate_chatmsg(0,i.ViewableMessage.length),i.ShowRecentMsg=i.messages.length>i.ViewMsgIndex+i.ViewCount,i.next_cursor=n.next_cursor,i.prev_cursor=n.prev_cursor,i.pullable=!0,i.nakama.saveListedMessage(i.messages,i.info,i.isOfficial,i.target)}catch{yield i.LoadLocalChatHistory()}setTimeout(()=>{void 0!==i.next_cursor&&i.ChatContDiv&&i.ChatContDiv.clientHeight<i.ChatLogs.clientHeight&&i.pull_msg_history()},0)}else{let n=i.messages.length-i.ViewMsgIndex-i.ViewCount;i.ShowRecentMsg=0!=n,i.ViewMsgIndex+=Math.min(i.RefreshCount,n),i.ViewableMessage=i.messages.slice(i.ViewMsgIndex,i.ViewMsgIndex+i.ViewCount);for(let o=i.ViewableMessage.length-1;o>=0;o--){let l;try{i.ViewableMessage[o].content.path=`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${i.ViewableMessage[o].message_id}.${i.ViewableMessage[o].content.file_ext}`;let d=yield i.indexed.loadBlobFromUserPath(i.ViewableMessage[o].content.path,i.ViewableMessage[o].content.file_ext);l=URL.createObjectURL(d)}catch{}i.global.modulate_thumbnail(i.ViewableMessage[o].content,l),i.modulate_chatmsg(o,i.ViewableMessage.length),i.ViewableMessage[o].content.qoute&&i.ViewableMessage[o].content.qoute.path&&i.OpenQouteThumbnail(i.ViewableMessage[o])}i.pullable=!0}i.MakeViewableMessagesHaveContextMenuAct()}})()}SpeechReceivedMessage(t){try{if(0!=t.code)throw"\uc77c\ubc18 \uc218\uc2e0 \uba54\uc2dc\uc9c0\uac00 \uc544\ub2d8";let i=JSON.parse(JSON.stringify(t.content.msg)),n="";for(let o=0,l=i.length;o<l;o++)for(let d=0,_=i[o].length;d<_;d++)n+=i[o][d].text+" ";n&&n.trim()&&this.SpeechThese.push(n),this.isSpeeching||this.SpeechingTexts()}catch{}}SpeechingTexts(){var t=this;return(0,g.c)(function*(){let i=t.SpeechThese.shift();t.isSpeeching=!0,i&&i.trim()&&(yield K.speak({text:i,lang:t.lang.lang})),t.SpeechThese.length?t.SpeechingTexts():t.isSpeeching=!1})()}LoadLocalChatHistory(){var t=this;return(0,g.c)(function*(){if(t.ViewMsgIndex>0){let i=Math.min(t.ViewableMessage.length,Math.min(t.ViewMsgIndex,t.RefreshCount));t.ViewMsgIndex-=i,t.ViewableMessage=t.messages.slice(t.ViewMsgIndex,t.ViewMsgIndex+t.ViewCount);for(let n=i-1;n>=0;n--){let o;try{t.ViewableMessage[n].content.path=`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/files/msg_${t.ViewableMessage[n].message_id}.${t.ViewableMessage[n].content.file_ext}`;let l=yield t.indexed.loadBlobFromUserPath(t.ViewableMessage[n].content.path,t.ViewableMessage[n].content.file_ext);o=URL.createObjectURL(l)}catch{}t.global.modulate_thumbnail(t.ViewableMessage[n].content,o),t.modulate_chatmsg(n,i+1),t.ViewableMessage[n].content.qoute&&t.ViewableMessage[n].content.qoute.path&&t.OpenQouteThumbnail(t.ViewableMessage[n])}return t.ShowRecentMsg=t.messages.length>t.ViewMsgIndex+t.ViewCount,t.pullable=0!=t.ViewMsgIndex||!!t.LocalHistoryList.length,t.pullable&&t.ViewableMessage.length&&t.ViewableMessage.length<t.RefreshCount&&(yield t.LoadLocalChatHistory()),void t.MakeViewableMessagesHaveContextMenuAct()}if(t.isHistoryLoaded){try{let i=t.LocalHistoryList.pop();if(!i)throw"\uae30\ub85d \uc5c6\uc74c";let n=yield t.indexed.loadTextFromUserPath(i);if(n){let o=JSON.parse(n.trim()),l=0;for(let _=o.length-1;_>=0;_--)t.nakama.translate_updates(o[_]),o[_]=t.nakama.modulation_channel_message(o[_],t.isOfficial,t.target),t.nakama.ModulateTimeDate(o[_]),o[_].content.path=`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/files/msg_${o[_].message_id}.${o[_].content.file_ext}`,2!=o[_].code&&(l++,t.messages.unshift(o[_]));t.ViewMsgIndex=Math.max(0,l-t.RefreshCount),t.ViewableMessage=t.messages.slice(t.ViewMsgIndex,t.ViewMsgIndex+t.ViewCount);let d=Math.min(Math.min(l,t.RefreshCount),t.ViewableMessage.length);for(let _=d-1;_>=0;_--){let m;try{let p=yield t.indexed.loadBlobFromUserPath(t.ViewableMessage[_].content.path,t.ViewableMessage[_].content.file_ext);m=URL.createObjectURL(p)}catch{}t.global.modulate_thumbnail(t.ViewableMessage[_].content,m),t.modulate_chatmsg(_,d),t.ViewableMessage[_].content.qoute&&t.ViewableMessage[_].content.qoute.path&&t.OpenQouteThumbnail(t.ViewableMessage[_])}t.ShowRecentMsg=t.messages.length>t.ViewMsgIndex+t.ViewCount}else yield t.LoadLocalChatHistory()}catch{}t.pullable=0!=t.ViewMsgIndex||!!t.LocalHistoryList.length,t.pullable&&t.ViewableMessage.length<t.RefreshCount&&t.LoadLocalChatHistory()}else{let i=yield t.indexed.GetFileListFromDB(`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/chats/`);t.LocalHistoryList=i;for(let n=i.length-1;n>=0;n--){let o=i[n].split("/");"chats"!=o[o.length-4]&&i.splice(n,1)}if(t.isHistoryLoaded=!0,!t.LocalHistoryList.length)return;t.LoadLocalChatHistory()}t.MakeViewableMessagesHaveContextMenuAct()})()}MakeViewableMessagesHaveContextMenuAct(){setTimeout(()=>{for(let t=0,i=this.ViewableMessage.length;t<i;t++){let n=document.getElementById(this.ViewableMessage[t].message_id);n&&("DesktopPWA"==$.s1?null==n.onmousedown&&(n.onmousedown=o=>{this.IsQouteMyMessage=this.ViewableMessage[t].is_me,this.MsgClickedStartPos=o.clientX,this.TargetMessageObject=n,2==o.which&&(this.MsgClickedStartPos=o.clientX+60,this.p5canvas.ChatMsgDragAct(o.clientX))}):null==n.ontouchstart&&(n.ontouchstart=o=>{try{this.IsQouteMyMessage=this.ViewableMessage[t].is_me,this.MsgClickedStartPos=o.touches[0].clientX,this.TargetMessageObject=n}catch{}}),null==n.oncontextmenu&&(n.oncontextmenu=()=>{try{let o;for(let l=0,d=this.ViewableMessage.length;l<d;l++)if(n.id==this.ViewableMessage[l].message_id){o=l;break}if(void 0===o)throw"\uba54\uc2dc\uc9c0\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc74c";this.CopyMessageText(this.ViewableMessage[o]),this.message_detail(this.ViewableMessage[o],o)}catch(o){console.log("\uba54\uc2dc\uc9c0 \uc0c1\uc138\ubcf4\uae30 \uc2e4\ud328: ",o)}return!1}))}},100)}open_ext_with_delay(){this.ScrollNearLogs(),this.isHidden=!this.isHidden}make_ext_hidden(){this.ScrollNearLogs(),"DesktopPWA"!=$.s1&&(this.isHidden=!0)}ScrollNearLogs(){this.NeedScrollDown()&&(this.ChatLogs.scrollTo({top:this.ChatLogs.scrollHeight,behavior:"smooth"}),setTimeout(()=>{this.ChatLogs.scrollTo({top:this.ChatLogs.scrollHeight,behavior:"smooth"})},150))}ResizeTextArea(){this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId)),this.userInputTextArea.style.height="36px"}check_key(t){this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId)),"DesktopPWA"==$.s1?"Enter"!=t.key||t.shiftKey||"keydown"!=t.type?setTimeout(()=>{this.ResizeTextArea(),this.userInputTextArea.style.height=this.userInputTextArea.scrollHeight+"px"},0):this.send(!0):setTimeout(()=>{this.ResizeTextArea(),this.userInputTextArea.style.height=this.userInputTextArea.scrollHeight+"px"},0)}send(t=!1){var i=this;return(0,g.c)(function*(){if(t&&("Android"==$.s1||"iOS"==$.s1))return;if(i.userInputTextArea||(i.userInputTextArea=document.getElementById(i.ChannelUserInputId)),!i.userInput.text.trim()&&!i.userInput.file)return void setTimeout(()=>{i.userInput.text="",i.ResizeTextArea()},0);if(i.block_send)return;i.block_send=!0,i.userInputTextArea.style.maxHeight=`${i.userInputTextArea.offsetHeight}px`,i.userInputTextArea.focus(),setTimeout(()=>{i.userInputTextArea.focus()},0),i.isHidden=!0;let n={};n.msg=i.userInput.text;let o=!1,l=!1,d="";if(i.userInput.qoute&&(i.userInput.qoute.path&&delete i.userInput.qoute.url,n.qoute=i.userInput.qoute),i.userInput.file){n.filename=i.userInput.file.filename,n.file_ext=i.userInput.file.file_ext,n.type=i.userInput.file.type;try{n.filesize=i.userInput.file.size||i.userInput.file.blob.size,n.partsize=Math.ceil(n.filesize/j.KY)}catch{n.url=i.userInput.file.url,l=!0}if(n.msg.length>700?(d=n.msg,delete n.msg):n.msg=n.msg,n.content_creator=i.userInput.file.content_creator,n.content_related_creator=i.userInput.file.content_related_creator,!l&&!i.info.local&&2!=i.useFirstCustomCDN)try{let m=i.nakama.servers[i.isOfficial][i.target].info.address,p=i.nakama.servers[i.isOfficial][i.target].info.useSSL?"https:":"http:",y=`${i.info.group_id||(i.info.user_id_one==i.nakama.servers[i.isOfficial][i.target].session.user_id?i.info.user_id_two:i.info.user_id_one)}_${i.nakama.servers[i.isOfficial][i.target].session.user_id}`,f=yield i.global.upload_file_to_storage(i.userInput.file,y,p,m,1==i.useFirstCustomCDN);if(l=!!f,!l)throw"\ub9c1\ud06c \ub9cc\ub4e4\uae30 \uc2e4\ud328";delete n.partsize,n.url=f}catch(m){console.log("cdn \uc5c5\ub85c\ub4dc \ucc98\ub9ac \uc2e4\ud328: ",m)}o=!0;for(let m=0,p=n.content_related_creator.length;m<p;m++)delete n.content_related_creator[m].is_me,delete n.content_related_creator[m].timeDisplay,delete n.content_related_creator[m].various_display}else if(n.msg.length>700)return void i.LongTextMessageAsFile(n);n.local_comp=Math.random();let _={content:JSON.parse(JSON.stringify(n))};if(i.nakama.content_to_hyperlink(_),i.info.local){let m=(new Date).getTime().toString();if(o&&!l)try{let f;if(1==i.useFirstCustomCDN&&(f=yield i.global.try_upload_to_user_custom_fs(i.userInput.file,`${i.info.id}_${i.nakama.users.self.display_name}`)),!f)throw"\uc5c5\ub85c\ub4dc \uc2e4\ud328";delete _.content.path,delete _.content.partsize,_.content.url=f}catch{let O=`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${m}.${i.userInput.file.file_ext}`;yield i.indexed.saveBlobToUserPath(i.userInput.file.blob,O)}delete i.userInput.file,delete i.userInput.qoute,d&&(_.msg=d,i.LongTextMessageAsFile(_));let p=(new Date).toISOString(),y={channel_id:i.info.id,code:0,color:"888888",..._,create_time:p,update_time:p,sender_id:"local",message_id:m,user_display_name:i.nakama.users.self.display_name,is_me:!0};return i.SendLocalMessage(y),i.userInputTextArea.style.maxHeight=null,void(i.block_send=!1)}i.sending_msg.push(_),setTimeout(()=>{i.scroll_down_logs()},0);try{setTimeout(()=>{i.userInput.text="",i.ResizeTextArea()},0);let m=yield i.nakama.servers[i.isOfficial][i.target].socket.writeChatMessage(i.info.id,n);o&&(l?i.auto_open_thumbnail({content:n,message_id:m.message_id}):i.indexed.saveBlobToUserPath(i.userInput.file.blob,`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${m.message_id}.${i.userInput.file.file_ext}`,()=>{i.auto_open_thumbnail({content:n,message_id:m.message_id})})),delete i.userInput.file,delete i.userInput.qoute,i.inputPlaceholder=i.lang.text.ChatRoom.input_placeholder,d&&(n.msg=d,i.LongTextMessageAsFile(n))}catch(m){3===m.code?i.p5toast.show({text:i.lang.text.ChatRoom.FailedToJoinChannel}):(console.log("\uc624\ub958 \uac80\ud1a0 \ud544\uc694: ",m),i.p5toast.show({text:`${i.lang.text.ChatRoom.FailedToSend}: ${"string"==typeof m?m:m.message}`})),setTimeout(()=>{i.userInput.text="",i.ResizeTextArea()},0),setTimeout(()=>{for(let p=i.sending_msg.length-1;p>=0;p--)i.sending_msg[p].content.local_comp==n.local_comp&&i.sending_msg.splice(p,1)},1500)}i.userInputTextArea.style.maxHeight=null,i.block_send=!1})()}open_url_link(t){var i=this;return(0,g.c)(function*(){if(0==t.indexOf("https://is2you2.github.io/pjcone_pwa/?")||0==t.indexOf("http://pjcone.ddns.net/?")){let n=i.global.CatchGETs(t)||{};i.global.initialize();try{yield i.nakama.AddressToQRCodeAct(n)}catch(o){i.p5toast.show({text:`${i.lang.text.ChatRoom.QRLinkFailed}: ${o}`})}}else window.open(t,"_system");i.userInputTextArea.focus(),i.SetOtherAct()})()}SendLocalMessage(t){let i=this.deserialize_text(t);this.nakama.ModulateTimeDate(t),this.nakama.channels_orig[this.isOfficial][this.target][t.channel_id].last_comment_time=t.update_time,this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].last_comment_id=t.message_id,this.nakama.rearrange_channels(),this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].update(t),this.nakama.saveListedMessage([t],this.info,this.isOfficial,this.target),2!=t.code&&(this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].last_comment=(t.content.filename?`(${this.lang.text.ChatRoom.attachments}) `:"")+(i||t.content.noti||(t.content.match?this.lang.text.ChatRoom.JoinWebRTCMatch:void 0)||"")),setTimeout(()=>{this.userInput.text="",this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId)),this.ResizeTextArea(),this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder},0)}LongTextMessageAsFile(t){var i=this;return(0,g.c)(function*(){let n=new Blob([t.msg]);yield i.indexed.saveBlobToUserPath(n,`tmp_files/chatroom/${i.lang.text.ChatRoom.LongText}_${t.msg.substring(0,10)}.txt`);let o={};o.blob=n,o.content_related_creator=[{user_id:i.info.local?"local":i.nakama.servers[i.isOfficial][i.target].session.user_id,timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"long_text"}],o.content_creator={user_id:i.info.local?"local":i.nakama.servers[i.isOfficial][i.target].session.user_id,timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"long_text"};let l=t.msg.substring(0,24);o.path=`tmp_files/chatroom/${i.lang.text.ChatRoom.LongText}_${l}~.txt`,o.file_ext="txt",o.filename=`[${i.lang.text.ChatRoom.LongText}] ${l}~.txt`,i.global.set_viewer_category_from_ext(o),o.type="text/plain",o.typeheader="text",delete t.msg,delete i.userInput.file,delete i.userInput.qoute,i.userInput.text="",i.ResizeTextArea(),i.inputPlaceholder=i.lang.text.ChatRoom.input_placeholder,i.userInput.file=o,i.inputPlaceholder=`(${i.lang.text.ChatRoom.attachments}: ${i.userInput.file.filename})`,i.create_selected_thumbnail(),i.p5toast.show({text:i.lang.text.ChatRoom.CreateAsTextFile}),i.block_send=!1})()}SetOtherAct(){this.isOtherAct=!0,setTimeout(()=>{this.isOtherAct=!1},0)}message_detail(t,i){var n=this;return(0,g.c)(function*(){if(n.isOtherAct||"offline"==n.info.status||"missing"==n.info.status||t.content.user_update||t.content.gupdate||!t.is_me)return;let o=n.deserialize_text(t),l=o,d=t.content.url;if(t.content.viewer){try{if("image"!=t.content.viewer)throw"\uc774\ubbf8\uc9c0 \ud30c\uc77c\uc774 \uc544\ub2d8";let y=yield n.indexed.loadBlobFromUserPath(t.content.path,t.content.type);d=URL.createObjectURL(y)}catch{try{let f=yield n.indexed.loadBlobFromUserPath(`${t.content.path}_thumbnail.png`,t.content.type);d=URL.createObjectURL(f)}catch{}}l=`(${n.lang.text.ChatRoom.attachments}) ${l}`}let _=d?`<div style="text-align: center;">${l}</div>`:`<div>${l}</div>`;var y;n.alertCtrl.create({header:n.lang.text.ChatRoom.ManageChat,message:new N.AF(d?`<div style="width: 100%;"><img src="${d}" alt="${t.content.filename}" style="border-radius: 8px; max-height: 230px; position: relative; left: 50%; transform: translateX(-50%); ${n.info.HideAutoThumbnail?"filter: blur(6px);":""}"></div>`+_:_),buttons:[{text:n.lang.text.ChatRoom.EditChat,handler:()=>{var y;n.alertCtrl.create({header:n.lang.text.ChatRoom.EditChat,inputs:[{type:"textarea",value:o,placeholder:l}],buttons:[{text:n.lang.text.ChatRoom.EditChat,handler:(y=(0,g.c)(function*(f){let O=f[0]||l,v=!1,b=JSON.parse(JSON.stringify(t));if(b.content.msg=O,b.content.edited=!0,b.update_time=(new Date).toISOString(),n.info.local)v=!0;else try{yield n.nakama.servers[n.isOfficial][n.target].socket.updateChatMessage(n.info.id,t.message_id,b.content),v=!0}catch(E){console.log("\uba54\uc2dc\uc9c0 \ud3b8\uc9d1 \uc694\uccad \uc624\ub958: ",E)}v&&(b.code=1,n.info.local&&(n.nakama.content_to_hyperlink(b),b.update_time=Date.now(),n.SendLocalMessage(b)))}),function(O){return y.apply(this,arguments)})}]}).then(y=>{y.onWillDismiss().then(()=>{n.ionViewDidEnter()}),n.removeShortCutKey(),n.global.p5key.KeyShortCut.Escape=()=>{y.dismiss()},y.present()})}},{text:n.lang.text.UserFsDir.Delete,cssClass:"redfont",handler:(y=(0,g.c)(function*(){if(n.info.local){if(d)if(t.content.url)n.global.remove_file_from_storage(t.content.url);else{let f=`servers/${n.isOfficial}/${n.target}/channels/${n.info.id}/files/msg_${t.message_id}.${t.content.file_ext}`;try{yield n.indexed.removeFileFromUserPath(f)}catch{}try{yield n.indexed.removeFileFromUserPath(`${f}_thumbnail.png`)}catch{}}}else try{if(yield n.nakama.servers[n.isOfficial][n.target].socket.removeChatMessage(n.info.id,t.message_id),d)if(t.content.url)n.global.remove_file_from_storage(t.content.url);else{let f=yield n.loadingCtrl.create({message:n.lang.text.UserFsDir.DeleteFile});f.present();for(let v=0;v<t.content.partsize;v++){try{yield n.nakama.servers[n.isOfficial][n.target].client.deleteStorageObjects(n.nakama.servers[n.isOfficial][n.target].session,{object_ids:[{collection:`file_${t.channel_id.replace(/[.]/g,"_")}`,key:`msg_${t.message_id}_${v}`}]})}catch{}f.message=`${n.lang.text.UserFsDir.DeleteFile}: ${t.content.filename}_${t.content.partsize-v}`}let O=`servers/${n.isOfficial}/${n.target}/channels/${n.info.id}/files/msg_${t.message_id}.${t.content.file_ext}`;yield n.indexed.removeFileFromUserPath(O),yield n.indexed.removeFileFromUserPath(`${O}_thumbnail.png`),f.dismiss()}}catch(f){console.error("\ucc44\ub110 \uba54\uc2dc\uc9c0 \uc0ad\uc81c \uc624\ub958: ",f)}n.ViewableMessage.splice(i,1);for(let f=0,O=n.messages.length;f<O;f++)if(n.messages[f].message_id==t.message_id){n.messages.splice(f,1);break}t.update_time=Date.now(),t.code=2,n.SendLocalMessage(t);for(let f=n.ViewableMessage.length-1;f>=0;f--)n.modulate_chatmsg(f,n.ViewableMessage.length);n.p5toast.show({text:n.lang.text.ChatRoom.MsgRemoved})}),function(){return y.apply(this,arguments)})}]}).then(y=>{n.global.p5key.KeyShortCut.Escape=()=>{y.dismiss()},y.onDidDismiss().then(()=>{n.global.p5key.KeyShortCut.Escape=()=>{n.navCtrl.pop()},URL.revokeObjectURL(d),n.isOtherAct=!1}),y.present()})})()}deserialize_text(t){let i="";if(!t.content.msg)return i;for(let n=0,o=t.content.msg.length;n<o;n++){for(let l=0,d=t.content.msg[n].length;l<d;l++)i+=t.content.msg[n][l].text;n+1<o&&(i+="\n")}return i}file_detail(t){var i=this;return(0,g.c)(function*(){if(i.isOtherAct=!0,t.content.url)return i.open_viewer(t,t.content.url),void setTimeout(()=>{i.isOtherAct=!1},0);let n=`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${t.message_id}.${t.content.file_ext}`;try{if(!(yield i.indexed.checkIfFileExist(`${n}.history`)))throw"\uc378\ub124\uc77c \uc5f4\uae30";t.content.text=[i.lang.text.TodoDetail.WIP];let l=yield i.indexed.loadTextFromUserPath(`${n}.history`),d=JSON.parse(l);switch(delete t.content.text,d.type){case"upload":if(t.content.text=[i.lang.text.ChatRoom.uploading],i.nakama.WriteStorage_From_channel(t,n,i.isOfficial,i.target,d.index),t.content.transfer_index&&i.nakama.OnTransfer[i.isOfficial][i.target][t.channel_id][t.message_id].OnTransfer)throw"\uc804\uc1a1\uc791\uc5c5 \uc911, \uc378\ub124\uc77c \uc5f4\uae30";break;case"download":t.content.text=[i.lang.text.TodoDetail.WIP],yield i.nakama.ReadStorage_From_channel(t,n,i.isOfficial,i.target,d.index),i.NeedScrollDown()&&setTimeout(()=>{i.scroll_down_logs()},100)}}catch{(yield i.indexed.checkIfFileExist(n))?(t.content.text||(t.content.text=[i.lang.text.ChatRoom.downloaded]),i.indexed.loadBlobFromUserPath(n,t.content.type,d=>{t.content.path=n;let _=URL.createObjectURL(d);i.global.modulate_thumbnail(t.content,_),i.NeedScrollDown()&&setTimeout(()=>{i.scroll_down_logs()},100)}),i.open_viewer(t,n)):i.isHistoryLoaded?i.p5toast.show({text:i.lang.text.ChatRoom.cannot_open_file}):(t.content.text=[i.lang.text.TodoDetail.WIP],yield i.nakama.ReadStorage_From_channel(t,n,i.isOfficial,i.target),i.NeedScrollDown()&&setTimeout(()=>{i.scroll_down_logs()},400))}i.isOtherAct=!1})()}JoinWebRTCMatch(t){this.SetOtherAct(),this.nakama.JoinWebRTCMatch(t,this.isOfficial,this.target,this.info)}modulate_chatmsg(t,i){var n=this;return(0,g.c)(function*(){if(0!=i){if(n.ViewableMessage[t].showInfo||(n.ViewableMessage[t].showInfo={}),n.ViewableMessage[t].showInfo.date=!!n.ViewableMessage[t].msgDate,n.ViewableMessage[t].showInfo.sender=!n.ViewableMessage[t].content.noti,t-1>=0&&(n.ViewableMessage[t].showInfo.date=!!n.ViewableMessage[t].msgDate&&n.ViewableMessage[t].msgDate!=n.ViewableMessage[t-1].msgDate,n.ViewableMessage[t].showInfo.sender=!n.ViewableMessage[t].content.noti&&(n.ViewableMessage[t-1].isLastRead||n.ViewableMessage[t].sender_id!=n.ViewableMessage[t-1].sender_id||n.ViewableMessage[t-1].content.noti||n.ViewableMessage[t].msgDate!=n.ViewableMessage[t-1].msgDate||n.ViewableMessage[t].msgTime!=n.ViewableMessage[t-1].msgTime)),n.ViewableMessage[t].content.url)try{let o=yield n.indexed.loadBlobFromUserPath(`${n.ViewableMessage[t].content.path}_thumbnail.png`,"image/png"),l=URL.createObjectURL(o);return n.ViewableMessage[t].content.thumbnail=n.sanitizer.bypassSecurityTrustUrl(l),void setTimeout(()=>{URL.revokeObjectURL(l)},100)}catch{"image"==n.ViewableMessage[t].content.viewer&&n.ViewableMessage[t].content.url&&(n.ViewableMessage[t].content.thumbnail=n.ViewableMessage[t].content.url)}try{t+1<i&&(n.ViewableMessage[t+1].showInfo.date=!!n.ViewableMessage[t].msgDate&&n.ViewableMessage[t].msgDate!=n.ViewableMessage[t+1].msgDate,n.ViewableMessage[t+1].showInfo.sender=!n.ViewableMessage[t+1].content.noti&&(n.ViewableMessage[t].isLastRead||n.ViewableMessage[t].sender_id!=n.ViewableMessage[t+1].sender_id||n.ViewableMessage[t].content.noti||n.ViewableMessage[t].msgDate!=n.ViewableMessage[t+1].msgDate||n.ViewableMessage[t].msgTime!=n.ViewableMessage[t+1].msgTime))}catch{}}})()}ModulateFileEmbedMessage(t){var i=this;t.content.url&&this.global.modulate_thumbnail(t.content,"");let n=`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${t.message_id}.${t.content.file_ext}`;t.content.path=n;try{t.content.transfer_index=this.nakama.OnTransfer[this.isOfficial][this.target][t.channel_id][t.message_id]}catch{}t.content.transfer_index||this.indexed.checkIfFileExist(`${n}.history`,o=>{o&&this.indexed.loadTextFromUserPath(`${n}.history`,(l,d)=>{if(l&&d){let _=JSON.parse(d);delete t.content.text,this.nakama.OnTransfer[this.isOfficial]||(this.nakama.OnTransfer[this.isOfficial]={}),this.nakama.OnTransfer[this.isOfficial][this.target]||(this.nakama.OnTransfer[this.isOfficial][this.target]={}),this.nakama.OnTransfer[this.isOfficial][this.target][t.channel_id]||(this.nakama.OnTransfer[this.isOfficial][this.target][t.channel_id]={}),this.nakama.OnTransfer[this.isOfficial][this.target][t.channel_id][t.message_id]||(this.nakama.OnTransfer[this.isOfficial][this.target][t.channel_id][t.message_id]={index:t.content.partsize-_.index}),t.content.transfer_index=this.nakama.OnTransfer[this.isOfficial][this.target][t.channel_id][t.message_id]}})}),this.global.set_viewer_category(t.content),this.indexed.checkIfFileExist(n,function(){var o=(0,g.c)(function*(l){if(l)t.content.text=[i.lang.text.ChatRoom.downloaded],i.indexed.loadBlobFromUserPath(n,t.content.type,d=>{t.content.path=n;let _=URL.createObjectURL(d);i.global.modulate_thumbnail(t.content,_),i.NeedScrollDown()&&setTimeout(()=>{i.scroll_down_logs()},100)});else try{let d=yield i.indexed.loadBlobFromUserPath(`${t.content.path}_thumbnail.png`,"image/png"),_=URL.createObjectURL(d);i.global.modulate_thumbnail(t.content,_)}catch{}});return function(l){return o.apply(this,arguments)}}())}toggle_thumbnail(){var t=this;return(0,g.c)(function*(){t.info.HideAutoThumbnail=!t.info.HideAutoThumbnail,t.nakama.save_channels_with_less_info()})()}open_viewer(t,i){var n=this;let o=[];for(let l=0,d=this.messages.length;l<d;l++)this.messages[l].content.filename&&o.push(this.messages[l]);this.lock_modal_open||(this.lock_modal_open=!0,this.removeShortCutKey(),this.modalCtrl.create({component:U.K,componentProps:{info:t,path:i,alt_path:i,isOfficial:this.isOfficial,target:this.target,relevance:o,local:this.info.local},cssClass:"fullscreen"}).then(l=>{l.onDidDismiss().then(d=>{if(this.lock_modal_open=!1,this.ionViewDidEnter(),d.data)switch(d.data.type){case"image":let _=[];if(d.data.msg.content.content_related_creator&&(_=[...d.data.msg.content.content_related_creator]),d.data.msg.content.content_creator){let m=!1;for(let p=0,y=_.length;p<y;p++)if(_[p].user_id==d.data.msg.content.content_creator.user_id){m=!0;break}m||_.push(d.data.msg.content.content_creator)}return void this.modalCtrl.create({component:B.S,componentProps:{path:d.data.path||i,width:d.data.width,height:d.data.height,isDarkMode:d.data.isDarkMode},cssClass:"fullscreen"}).then(m=>{m.onDidDismiss().then(()=>{this.ionViewDidEnter()}),m.onWillDismiss().then(function(){var p=(0,g.c)(function*(y){y.data&&(yield n.voidDraw_fileAct_callback(y,_))});return function(y){return p.apply(this,arguments)}}()),this.removeShortCutKey(),m.present()});case"text":this.selected_blobFile_callback_act(d.data.blob,d.data.contentRelated,"textedit")}this.noti.Current=this.info.cnoti_id,this.info.cnoti_id&&this.noti.ClearNoti(this.info.cnoti_id),this.noti.RemoveListener(`openchat${this.info.cnoti_id}`)}),this.removeShortCutKey(),this.noti.Current="IonicViewerPage",l.present()}))}voidDraw_fileAct_callback(t,i){var n=this;return(0,g.c)(function*(){try{n.userInput.file={},n.userInput.file.filename=t.data.name,n.userInput.file.file_ext="png",n.userInput.file.thumbnail=n.sanitizer.bypassSecurityTrustUrl(t.data.img),n.userInput.file.type="image/png",n.userInput.file.typeheader="image",i?(n.userInput.file.content_related_creator=i,n.userInput.file.content_creator={user_id:n.info.local?"local":n.nakama.servers[n.isOfficial][n.target].session.user_id,timestamp:(new Date).getTime(),display_name:n.nakama.users.self.display_name,various:"voidDraw"}):(n.userInput.file.content_related_creator=[{user_id:n.info.local?"local":n.nakama.servers[n.isOfficial][n.target].session.user_id,timestamp:(new Date).getTime(),display_name:n.nakama.users.self.display_name,various:"voidDraw"}],n.userInput.file.content_creator={user_id:n.info.local?"local":n.nakama.servers[n.isOfficial][n.target].session.user_id,timestamp:(new Date).getTime(),display_name:n.nakama.users.self.display_name,various:"voidDraw"}),yield n.indexed.saveBase64ToUserPath(t.data.img,`tmp_files/chatroom/${n.userInput.file.filename}`,o=>{n.userInput.file.blob=new Blob([o],{type:n.userInput.file.type})}),n.inputPlaceholder=`(${n.lang.text.ChatRoom.attachments}: ${n.userInput.file.filename})`}catch(o){console.error("godot-\uc774\ubbf8\uc9c0 \ud3b8\uc9d1 \uc0ac\uc6a9 \ubd88\uac00: ",o)}t.data.loadingCtrl.dismiss()})()}user_detail(t){this.lock_modal_open||(this.isOtherAct=!0,this.lock_modal_open=!0,t.is_me?this.modalCtrl.create({component:J.w,componentProps:{isOfficial:this.info.server.isOfficial,target:this.info.server.target}}).then(i=>{i.onDidDismiss().then(n=>{this.isOtherAct=!1,this.ionViewDidEnter(),this.noti.Current=this.info.cnoti_id,this.info.cnoti_id&&this.noti.ClearNoti(this.info.cnoti_id),this.noti.RemoveListener(`openchat${this.info.cnoti_id}`)}),this.removeShortCutKey(),this.noti.Current="GroupServerPage",i.present(),this.lock_modal_open=!1}):this.modalCtrl.create({component:z.y,componentProps:{info:{user:this.nakama.load_other_user(t.sender_id,this.isOfficial,this.target)},group:this.info,has_admin:!1}}).then(i=>{i.onDidDismiss().then(n=>{this.ionViewDidEnter(),this.isOtherAct=!1,this.noti.Current=this.info.cnoti_id,this.info.cnoti_id&&this.noti.ClearNoti(this.info.cnoti_id),this.noti.RemoveListener(`openchat${this.info.cnoti_id}`)}),this.noti.Current="OthersProfilePage",this.removeShortCutKey(),i.present(),this.lock_modal_open=!1}))}ionViewWillLeave(){this.nakama.rearrange_channels(),this.nakama.channels_orig[this.isOfficial][this.target]&&this.nakama.channels_orig[this.isOfficial][this.target][this.info.id]&&delete this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].update,this.noti.Current=void 0,this.removeShortCutKey(),window.onfocus=void 0}removeShortCutKey(){delete this.global.p5key.KeyShortCut.Escape,delete this.global.p5key.KeyShortCut.BottomTab,delete this.global.p5key.KeyShortCut.Digit,delete this.global.p5key.KeyShortCut.EnterAct}ngOnDestroy(){var t=this;return(0,g.c)(function*(){delete t.nakama.opened_page_info.channel,t.nakama.ChatroomLinkAct=void 0,t.p5canvas&&t.p5canvas.remove(),t.nakama.OnTransferMessage={};try{t.useVoiceRecording&&(yield V.G.stopRecording())}catch{}delete t.nakama.StatusBarChangedCallback})()}}return(s=c).\u0275fac=function(t){return new(t||s)(e.GI1(k.qS),e.GI1(Z.wX),e.GI1(w.gV),e.GI1(w.E5),e.GI1(ee.h),e.GI1(te.s),e.GI1(ie.Y),e.GI1(ne.k),e.GI1(ae.o),e.GI1(se.mI),e.GI1(j.A1),e.GI1(k.Kg),e.GI1(oe.C),e.GI1(le.O),e.GI1(re._),e.GI1(k.iW))},s.\u0275cmp=e.In1({type:s,selectors:[["app-chat-room"]],decls:47,vars:21,consts:[[1,"ion-no-border"],["slot","start"],["defaultHref","portal/subscribes"],["class","top_icon","slot","end","name","eye-outline",3,"click",4,"ngIf"],["class","top_icon","slot","end","name","eye-off-outline",3,"click",4,"ngIf"],[1,"header_online_circle"],["scrollY","false"],["id","p5Drop_chatroom",2,"position","absolute","width","100%","height","100%","display","flex","pointer-events","none"],["id","main_table",1,"channel_bg",2,"width","100%","height","100%","background-color","var(--chatroom-background)"],[2,"height","100%"],[2,"vertical-align","top"],["id","chatroom_div",1,"main",2,"max-width","100vw"],["id","chatroom_content_div"],["button","",3,"disabled","click"],[3,"id",4,"ngFor","ngForOf"],["class","my_message_right my_sending_msg",4,"ngFor","ngForOf"],[1,"thumnails"],["class","qoute_text",3,"click",4,"ngIf"],["class","thumnail_parts","style","cursor: pointer;",4,"ngIf"],["class","thumnail_parts",3,"click",4,"ngIf"],["id","input_table",2,"width","100%","background-color","var(--chatroom-input-background)"],["fill","clear","mode","md",1,"ion-text-center",3,"click"],["name","add"],[2,"width","100%","vertical-align","bottom"],[1,"TextAreaInput",3,"id","ngModel","placeholder","ngModelChange","keyup","keydown","click"],[4,"ngIf"],["fill","clear","mode","md","expand","block",3,"disabled","click"],["name","send"],["id","ext_menu",3,"hidden"],[1,"expanded"],["hidden","","type","file","id","local_channel","accept","image/*",3,"change"],["hidden","","type","file","id","backgroundImage_sel","accept","image/png",3,"change"],["hidden","","type","file","accept","*","multiple","",3,"id","change"],["style","display: inline-block;",4,"ngFor","ngForOf"],["slot","end","name","eye-outline",1,"top_icon",3,"click"],["slot","end","name","eye-off-outline",1,"top_icon",3,"click"],[3,"id"],["class","my_message_right",4,"ngIf"],["class","notice_form",3,"click",4,"ngIf"],["style","text-align: center; font-size: 16px; padding-top: 8px;",3,"click",4,"ngIf"],[1,"avatar_form"],["class","avatar_image",3,"click",4,"ngIf"],["class","message_form",4,"ngIf"],["class","quickShare_form",3,"click",4,"ngIf"],["class","qoute_text qoute_background",3,"click",4,"ngIf"],["class","file_message_form",4,"ngIf"],["class","message_content_form",4,"ngIf"],[2,"width","100%","text-align","-webkit-center"],["class","read_last_here",4,"ngIf"],[2,"text-align","center","font-size","16px","padding-top","8px",3,"click"],["color","#888"],[1,"avatar_image",3,"click"],["alt","img",1,"avatar_image",3,"src"],[1,"message_form"],[2,"cursor","pointer",3,"click"],[3,"color"],[1,"time_form","message_span_form",3,"click"],[1,"quickShare_form",3,"click"],[1,"qoute_text","qoute_background",3,"click"],[1,"qouteDiv"],["class","qouteDiv",4,"ngIf"],["alt","",1,"qouteImage",3,"src"],[1,"file_message_form"],["class","file_button",3,"style","click",4,"ngIf"],["class","file_name_form",3,"click",4,"ngIf"],["class","transfer_count",4,"ngIf"],[1,"file_button",3,"click"],[1,"file_info"],["class","text_seperator",4,"ngIf"],["class","file_info file_text_thumbnail",4,"ngFor","ngForOf"],[1,"text_seperator"],[1,"file_info","file_text_thumbnail"],[1,"file_name_form",3,"click"],[1,"file_thumbnail",3,"src","alt"],[1,"transfer_count"],[1,"message_content_form"],[1,"msg_balloon"],["class","msg_inside_balloon",4,"ngFor","ngForOf"],["class","edited_form",4,"ngIf"],[1,"msg_inside_balloon"],[4,"ngFor","ngForOf"],["class","text_span",3,"style","click",4,"ngIf"],["target","_system","onclick","return false;",3,"href","click",4,"ngIf"],[1,"text_span",3,"click"],["target","_system","onclick","return false;",3,"href","click"],[1,"edited_form"],[1,"read_last_here"],[1,"my_message_right"],[2,"display","inline-flex"],["class","my_file_message_form",3,"click",4,"ngIf"],["class","my_file_message_form",4,"ngIf"],["class","message_content_form my_file_message_form",4,"ngIf"],[1,"avatar_form","my_avatar_form"],["class","read_last_here",3,"click",4,"ngIf"],[1,"time_form","message_span_form_me",3,"click"],[1,"my_file_message_form",3,"click"],[1,"quickShare_form"],[1,"my_file_message_form"],[1,"message_content_form","my_file_message_form"],["alt","my_img",1,"avatar_image",3,"src"],[1,"read_last_here",3,"click"],[1,"notice_form",3,"click"],[1,"notice"],[1,"my_message_right","my_sending_msg"],["class","file_button",3,"style",4,"ngIf"],["class","file_name_form",4,"ngIf"],[1,"file_button"],[1,"file_name_form"],[1,"msg_balloon",2,"background-color","#8888"],["class","comp_local_content",3,"style","click",4,"ngIf"],["class","text_span","class","comp_local_content","onclick","return false;","target","_system",3,"href","click",4,"ngIf"],[1,"comp_local_content",3,"click"],["onclick","return false;","target","_system",1,"comp_local_content",3,"href","click"],[1,"qoute_text",3,"click"],["alt","",1,"qouteImage",2,"max-height","84px",3,"src"],[1,"thumnail_parts",2,"cursor","pointer"],[3,"click",4,"ngIf"],[3,"click"],[2,"text-align","center","margin","4px","max-width","100vw"],["style","display: grid;","class","thumnail_parts",4,"ngIf"],["id","ChatroomSelectedImage","class","image_thumbnail",3,"src","alt",4,"ngIf"],["id","ChatroomSelectedImage",1,"image_thumbnail",3,"src","alt"],[1,"thumnail_parts",2,"display","grid"],[1,"thumnail_parts",3,"click"],[2,"text-align","center","padding","4px 0px"],[1,"bottom_thumbnail"],["class","text_span",3,"click",4,"ngIf"],["fill","clear","expand","block",3,"click"],["name","mic-outline"],[2,"display","inline-block"],[1,"ext_button",3,"hidden","click"],["slot","icon-only","style","width: 36px; height: 36px;",3,"name",4,"ngIf"],["class","ext_icon_img",3,"src","alt",4,"ngIf"],["slot","icon-only",2,"width","36px","height","36px",3,"name"],[1,"ext_icon_img",3,"src","alt"]],template:function(t,i){1&t&&(e.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),e.OEk(3),e.C$Y(),e.I0R(4,"ion-buttons",1),e.wR5(5,"ion-back-button",2),e.C$Y(),e.yuY(6,ce,1,0,"ion-icon",3)(7,_e,1,0,"ion-icon",4),e.wR5(8,"div",5),e.C$Y()(),e.I0R(9,"ion-content",6),e.wR5(10,"div",7),e.I0R(11,"table",8)(12,"tr",9)(13,"td",10)(14,"div",11)(15,"div",12)(16,"ion-item",13),e.qCj("click",function(){return i.pull_msg_history()}),e.I0R(17,"ion-label"),e.OEk(18),e.C$Y()(),e.yuY(19,et,4,4,"div",14)(20,mt,4,3,"div",15),e.C$Y()(),e.I0R(21,"table",16),e.yuY(22,pt,5,3,"tr",17)(23,It,3,1,"tr",18)(24,Rt,3,1,"tr",19)(25,Mt,6,4,"tr",19),e.C$Y()()(),e.I0R(26,"tr")(27,"td")(28,"div")(29,"table",20)(30,"tr")(31,"td")(32,"ion-button",21),e.qCj("click",function(){return i.open_ext_with_delay()}),e.wR5(33,"ion-icon",22),e.C$Y()(),e.I0R(34,"td",23)(35,"textarea",24),e.iHE("ngModelChange",function(o){return e.kNx(i.userInput.text,o)||(i.userInput.text=o),o}),e.qCj("keyup",function(o){return i.check_key(o)})("keydown",function(o){return i.check_key(o)})("click",function(){return i.make_ext_hidden()}),e.C$Y()(),e.yuY(36,$t,3,0,"td",25),e.I0R(37,"td")(38,"ion-button",26),e.qCj("click",function(){return i.send(!1)}),e.wR5(39,"ion-icon",27),e.C$Y()()()()()()(),e.I0R(40,"tr",28)(41,"td")(42,"div",29)(43,"input",30),e.qCj("change",function(o){return i.LocalChannelImageChanged(o)}),e.C$Y(),e.I0R(44,"input",31),e.qCj("change",function(o){return i.ChangeBackgroundImage(o)}),e.C$Y(),e.I0R(45,"input",32),e.qCj("change",function(o){return i.inputFileSelected(o)}),e.C$Y(),e.yuY(46,Et,6,6,"div",33),e.C$Y()()()()()),2&t&&(e.yG2(3),e.cNF(i.info.title||i.lang.text.ChatRoom.noname_chatroom),e.yG2(3),e.E7m("ngIf",!i.info.HideAutoThumbnail),e.yG2(),e.E7m("ngIf",i.info.HideAutoThumbnail),e.yG2(),e.m_g("background-color: "+i.statusBar.colors[i.info.status||"offline"]),e.yG2(8),e.E7m("disabled",void 0===i.next_cursor&&!i.ViewMsgIndex||!i.pullable),e.yG2(2),e.cNF(i.lang.text.ChatRoom.fetch_previous_chat),e.yG2(),e.E7m("ngForOf",i.ViewableMessage),e.yG2(),e.E7m("ngForOf",i.sending_msg),e.yG2(2),e.E7m("ngIf",i.userInput.qoute),e.yG2(),e.E7m("ngIf",i.userInput.file),e.yG2(),e.E7m("ngIf",i.ShowGoToBottom&&!i.last_message_viewer.user_id),e.yG2(),e.E7m("ngIf",i.last_message_viewer.user_id),e.yG2(10),e.E7m("id",i.ChannelUserInputId),e.OKB("ngModel",i.userInput.text),e.E7m("placeholder",i.inputPlaceholder),e.yG2(),e.E7m("ngIf",i.isMobile),e.yG2(2),e.E7m("disabled",i.block_send||!i.info.status||"missing"==i.info.status||"offline"==i.info.status),e.yG2(2),e.E7m("hidden",i.isHidden),e.yG2(5),e.E7m("id",i.file_sel_id),e.yG2(),e.E7m("ngForOf",i.extended_buttons))},dependencies:[G.ay,G.u_,M.ot,M.ue,M._G,k.sn,k.GS,k._i,k.wB,k.Ko,k.Yb,k.QR,k.tM,k.Md,k.Im],styles:[".top_icon[_ngcontent-%COMP%]{width:28px;height:28px;padding-right:68px;cursor:pointer}.main[_ngcontent-%COMP%]{width:100%;height:100%;padding:8px;overflow-x:hidden;overflow-y:auto;scroll-behavior:smooth}.message_form[_ngcontent-%COMP%]{margin-top:8px;text-shadow:0px 0px 4px var(--chatroom-background),0px 0px 4px var(--chatroom-background),0px 0px 4px var(--chatroom-background)}.channel_bg[_ngcontent-%COMP%]{background-position:center;background-repeat:no-repeat;background-size:cover}.message_span_form[_ngcontent-%COMP%]{margin-left:8px}.message_span_form_me[_ngcontent-%COMP%]{margin-right:4px}.my_message_right[_ngcontent-%COMP%]{text-align:end;margin-bottom:-4px}.my_sending_msg[_ngcontent-%COMP%]{margin-bottom:0;padding-right:56px}.msg_balloon[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;border:16px;border-radius:16px;padding:5px 12px 8px;max-width:65vw}.msg_inside_balloon[_ngcontent-%COMP%]{text-align:start}.time_form[_ngcontent-%COMP%]{font-size:12px;color:#888}.file_message_form[_ngcontent-%COMP%]{display:flex;flex-direction:column}.my_file_message_form[_ngcontent-%COMP%]{text-align:right;text-align:-webkit-right}.file_name_form[_ngcontent-%COMP%]{margin-top:4px;max-width:192px;max-height:192px}.file_thumbnail[_ngcontent-%COMP%]{max-width:192px;max-height:192px;width:auto;height:auto;border-radius:8px;cursor:pointer}.file_info[_ngcontent-%COMP%]{margin:0 4px;text-align:start}.file_text_thumbnail[_ngcontent-%COMP%]{margin-top:2px;display:grid}.quickShare_form[_ngcontent-%COMP%]{border-radius:16px;max-width:156px;width:-moz-fit-content;width:fit-content;height:-moz-fit-content;height:fit-content;padding:8px 12px;margin:4px 0 0;text-align:center;vertical-align:middle;word-break:keep-all;overflow:hidden;background-color:var(--chatroom-you-read-here-backgruond)}.qoute_text[_ngcontent-%COMP%]{text-align:initial;margin:4px 0 0}.qoute_background[_ngcontent-%COMP%]{background-color:rgba(var(--ion-color-primary-rgb),.5);border-radius:16px}.qouteImage[_ngcontent-%COMP%]{width:100%;max-height:32px;object-fit:cover;border-radius:8px}.qouteDiv[_ngcontent-%COMP%]{padding:8px}.message_content_form[_ngcontent-%COMP%]{display:inline-flex;margin:4px 0 0;place-self:flex-end}.edited_form[_ngcontent-%COMP%]{color:#888;font-size:12px;margin:0 8px;align-self:flex-end;padding-bottom:2px}.avatar_form[_ngcontent-%COMP%]{width:56px;vertical-align:top;padding:12px 8px 0 0;max-width:56px}.my_avatar_form[_ngcontent-%COMP%]{padding:12px 0 0 8px}.avatar_image[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:64px;object-fit:cover;cursor:pointer}.comp_local_content[_ngcontent-%COMP%]{color:#888}.text_seperator[_ngcontent-%COMP%]{background-color:#fff;margin-top:2px;position:relative;width:100%;height:2px}.file_button[_ngcontent-%COMP%]{width:160px;height:112px;overflow:hidden;background-color:gray;margin-top:4px;border-radius:8px;cursor:pointer}#send_thumbnail[_ngcontent-%COMP%]{width:100%;max-width:100vw;height:-moz-fit-content;height:fit-content;max-height:160px;transform:translateY(-100%);position:relative;background:#bbbb;padding:8px;overflow:hidden}.bottom_thumbnail[_ngcontent-%COMP%]{width:100%;max-width:100vw;max-height:96px;overflow:hidden;padding:8px}.image_thumbnail[_ngcontent-%COMP%]{width:auto;max-height:96px;height:auto;object-fit:contain;display:block;margin:auto;padding:8px}.thumnails[_ngcontent-%COMP%]{width:-webkit-fill-available;height:-moz-fit-content;height:fit-content;position:relative;transform:translateY(-100%);background:var(--chatroom-last-msg-viewer-bg);padding:8px;border-radius:16px;margin:0 8px;bottom:4px}.thumnail_parts[_ngcontent-%COMP%]{max-height:96px;overflow-y:scroll;max-width:100vw}.transfer_count[_ngcontent-%COMP%]{align-self:flex-end;margin-left:4px}.notice_form[_ngcontent-%COMP%]{text-align:center;margin:12px}.notice[_ngcontent-%COMP%]{font-size:12px;display:inline;background:#444;border-radius:8px;padding:4px 8px;color:#fff}.read_last_here[_ngcontent-%COMP%]{border-radius:16px;padding:4px 8px;width:-moz-fit-content;width:fit-content;text-align:center;font-size:12px;background:var(--chatroom-you-read-here-backgruond);margin:4px 0}.text_span[_ngcontent-%COMP%]{white-space:normal}.ext_icon_img[_ngcontent-%COMP%]{max-width:36px;max-height:36px}.md[_ngcontent-%COMP%]   .TextAreaInput[_ngcontent-%COMP%]{width:100%;height:36px;max-height:156px;resize:none;padding:6px;margin-top:5px;border:0;overflow:hidden;background-color:var(--chatroom-input-background)}.ios[_ngcontent-%COMP%]   .TextAreaInput[_ngcontent-%COMP%]{width:100%;height:60px;max-height:156px;resize:none;padding:6px;margin-top:5px;border:0;overflow:hidden;background-color:var(--chatroom-input-background)}.expanded[_ngcontent-%COMP%]{height:240px;overflow-x:hidden;overflow-y:auto;scroll-behavior:smooth;text-align:center;background-color:var(--chatroom-input-background)}ion-button[_ngcontent-%COMP%]{--padding-start: 12px;--padding-end: 12px}"]}),c})()},{path:"ionic-viewer",loadChildren:()=>u.e(3136).then(u.bind(u,3136)).then(s=>s.IonicViewerPageModule)},{path:"void-draw",loadChildren:()=>u.e(2454).then(u.bind(u,2454)).then(s=>s.VoidDrawPageModule)}];let Vt=(()=>{var s;class c{}return(s=c).\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.a4G({type:s}),s.\u0275inj=e.s3X({imports:[w.qQ.forChild(St),w.qQ]}),c})(),Dt=(()=>{var s;class c{}return(s=c).\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.a4G({type:s}),s.\u0275inj=e.s3X({imports:[G.MD,M.y,k.wZ,Vt]}),c})()}}]);