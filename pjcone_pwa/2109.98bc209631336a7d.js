"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2109],{2109:(U,_,r)=>{r.r(_),r.d(_,{QrSharePageModule:()=>I});var u=r(9808),d=r(4182),n=r(3996),f=r(9705),p=r(5016),m=r(6505),Q=r(6069),e=r(9863),x=r(2855),k=r(3336),C=r(5742),R=r(1282),y=r(9645),T=r(261),Z=r(8947);function b(i,l){if(1&i&&(e.TgZ(0,"ion-select-option",12),e._uU(1),e.qZA()),2&i){const t=l.$implicit;e.Q6J("value",t),e.xp6(1),e.hij("",t.name+" ("+t.target+")"," ")}}function w(i,l){if(1&i&&(e.TgZ(0,"ion-select-option",12),e._uU(1),e.qZA()),2&i){const t=l.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t.name+" ("+t.server.target+")")}}function M(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"div")(1,"ion-item-divider")(2,"ion-label"),e._uU(3),e.qZA()(),e.TgZ(4,"ion-item",6),e.NdJ("click",function(){return e.CHM(t),e.oxw().ToggleShareUUID()}),e.TgZ(5,"ion-label"),e._uU(6),e.qZA(),e.TgZ(7,"ion-toggle",7),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw().select_uuid=o}),e.qZA()(),e.TgZ(8,"ion-item")(9,"ion-label"),e._uU(10),e.qZA(),e.TgZ(11,"ion-select",8),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw().selected_group_server=o})("ionChange",function(o){return e.CHM(t),e.oxw().SelectGroupServer(o)}),e.YNc(12,b,2,2,"ion-select-option",9),e.qZA()(),e.TgZ(13,"ion-item")(14,"ion-label"),e._uU(15),e.qZA(),e.TgZ(16,"ion-select",8),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw().selected_group=o})("ionChange",function(o){return e.CHM(t),e.oxw().SelectGroup(o)}),e.YNc(17,w,2,2,"ion-select-option",9),e.qZA()(),e.TgZ(18,"ion-item",10),e.NdJ("click",function(){return e.CHM(t),e.oxw().scanQRCode()}),e.TgZ(19,"ion-label",11),e._uU(20),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(3),e.Oqu(t.lang.text.QuickQRShare.SelectData),e.xp6(3),e.Oqu(t.lang.text.Settings.takeOverUser),e.xp6(1),e.Q6J("ngModel",t.select_uuid),e.xp6(3),e.Oqu(t.lang.text.QuickQRShare.GroupServer),e.xp6(1),e.Q6J("ngModel",t.selected_group_server)("placeholder",t.lang.text.QuickQRShare.EmptyData),e.xp6(1),e.Q6J("ngForOf",t.group_servers),e.xp6(3),e.Oqu(t.lang.text.QuickQRShare.Group),e.xp6(1),e.Q6J("ngModel",t.selected_group)("placeholder",t.lang.text.QuickQRShare.EmptyData),e.xp6(1),e.Q6J("ngForOf",t.group_list),e.xp6(1),e.Q6J("disabled",!t.ActKeyLength),e.xp6(2),e.Oqu(t.lang.text.QuickQRShare.SendData)}}function A(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-button",13),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return o.ShowQRInfo=!o.ShowQRInfo}),e._uU(1),e.qZA()}if(2&i){const t=e.oxw();e.xp6(1),e.hij(" ",t.lang.text.QuickQRShare.ShowQR," ")}}function P(i,l){if(1&i&&e._UZ(0,"img",14),2&i){const t=e.oxw();e.Q6J("src",t.QRCodeSRC,e.LSH)}}const v="QRShare",O=[{path:"",component:(()=>{class i{constructor(t,a,o,s,c,h,S,g,Y){this.wsc=t,this.p5toast=a,this.navCtrl=o,this.lang=s,this.global=c,this.codescan=h,this.nakama=S,this.weblink=g,this.modalCtrl=Y,this.HideSender=!1,this.ShowQRInfo=!1,this.ActKeyLength=0,this.select_uuid=!1,this.group_servers=[],this.selected_group_server=[],this.group_list=[],this.selected_group=[],this.selected_data={},this.ShowExceptionInfoYet=!0}ngOnInit(){this.read_info(),this.HideSender=!("DesktopPWA"==p.n$||"MobilePWA"==p.n$),this.HideSender&&(Object.keys(this.nakama.servers.unofficial).forEach(s=>this.group_servers.push(this.nakama.servers.unofficial[s].info)),Object.keys(this.nakama.groups).forEach(s=>{Object.keys(this.nakama.groups[s]).forEach(h=>{Object.keys(this.nakama.groups[s][h]).forEach(g=>{"missing"!=this.nakama.groups[s][h][g].online&&this.group_list.push(this.nakama.groups[s][h][g])})})})),this.wsc.disconnected[v]=()=>{this.navCtrl.back()},this.websocket=new WebSocket(`${this.wsc.socket_header}://${this.wsc.address_override||p.GA}:12020`),this.websocket.onmessage=a=>{a.data.text().then(o=>{try{if(!this.QRCodeSRC)throw new Error("QR\ucf54\ub4dc \uc0dd\uc131 \uc6b0\uc120\ucc98\ub9ac");let s=JSON.parse(o);this.nakama.act_from_QRInfo(s.value),setTimeout(()=>{this.navCtrl.back()},500)}catch(s){this.QRCodeSRC=this.global.readasQRCodeFromId({type:"QRShare",value:o})}})}}read_info(){new m(a=>{a.setup=()=>{a.loadStrings(`assets/data/infos/${this.lang.lang}/quick_datashare.txt`,o=>{this.lines=o.join("\n"),a.remove()},o=>{console.error("\ube60\ub978 QR \uc815\ubcf4 \uacf5\uc720 \uc124\uba85\uc11c \ud30c\uc77c \ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",o),a.remove()})}})}scanQRCode(){this.codescan.scan({disableSuccessBeep:!0,disableAnimations:!0,resultDisplayDuration:0}).then(t=>{if(!t.cancelled){let a=JSON.parse(t.text.trim())[0];if("QRShare"===a.type){let o=[];if(this.selected_data.uuid&&o.push({type:"link_reverse",value:this.selected_data.uuid}),this.selected_data.group_server)for(let s=0,c=this.selected_data.group_server.length;s<c;s++)o.push({type:"server",value:{address:this.selected_data.group_server[s].address,port:this.selected_data.group_server[s].port,key:this.selected_data.group_server[s].key,useSSL:this.selected_data.group_server[s].useSSL}});if(this.selected_data.group)for(let s=0,c=this.selected_data.group.length;s<c;s++)o.push({type:"group",id:this.selected_data.group[s].id,name:this.selected_data.group[s].name});this.weblink.initialize({pid:a.value,value:JSON.stringify(o)})}else this.modalCtrl.create({component:Q.R,componentProps:{result:t}}).then(s=>s.present());setTimeout(()=>{this.navCtrl.back()},500)}}).catch(t=>{console.error(t),this.p5toast.show({text:this.lang.text.Subscribes.CameraPermissionDenied})})}ToggleShareUUID(){this.select_uuid=!this.select_uuid,this.select_uuid?this.selected_data.uuid=this.nakama.uuid:delete this.selected_data.uuid,this.ActKeyLength=Object.keys(this.selected_data).length}SelectGroupServer(t){if(this.selected_group_server.length&&"string"!=typeof this.selected_group_server){this.selected_data.group_server=this.selected_group_server;let a=Object.keys(this.selected_data),o=!1;a.forEach(s=>{"group_server"!=s&&"uuid"!=s&&(o=!0)}),this.ShowExceptionInfoYet&&o&&(this.p5toast.show({text:this.lang.text.QuickQRShare.groupserver_dataonly}),this.ShowExceptionInfoYet=!1)}else delete this.selected_data.group_server;this.ActKeyLength=Object.keys(this.selected_data).length}SelectGroup(t){this.selected_group.length&&"string"!=typeof this.selected_group?(this.selected_data.group=this.selected_group,this.remove_groupserver_info()):delete this.selected_data.group,this.ActKeyLength=Object.keys(this.selected_data).length}remove_groupserver_info(){this.ShowExceptionInfoYet&&this.selected_data.group_server&&(this.p5toast.show({text:this.lang.text.QuickQRShare.groupserver_dataonly}),this.ShowExceptionInfoYet=!1)}ionViewWillLeave(){delete this.wsc.disconnected[v],this.websocket.close()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(x.Z),e.Y36(k.F),e.Y36(n.SH),e.Y36(C.b),e.Y36(R.A),e.Y36(y.m),e.Y36(T.a),e.Y36(Z.W),e.Y36(n.IN))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-qr-share"]],decls:17,vars:6,consts:[["slot","start"],["defaultHref","portal/settings"],["disabled","",1,"infobox",2,"height","24vh","display","block",3,"ngModel","ngModelChange"],[4,"ngIf"],["slot","end","fill","clear","shape","round",3,"click",4,"ngIf"],["style","width: 100%; height: auto;","alt","QRCodeSRC",3,"src",4,"ngIf"],["button","",3,"click"],["slot","end",2,"pointer-events","none",3,"ngModel","ngModelChange"],["multiple","true",3,"ngModel","placeholder","ngModelChange","ionChange"],[3,"value",4,"ngFor","ngForOf"],["button","",3,"disabled","click"],[1,"ion-text-center"],[3,"value"],["slot","end","fill","clear","shape","round",3,"click"],["alt","QRCodeSRC",2,"width","100%","height","auto",3,"src"]],template:function(t,a){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e._uU(3,"\ube60\ub978 QR\uacf5\uc720"),e.qZA(),e.TgZ(4,"ion-buttons",0),e._UZ(5,"ion-back-button",1),e.qZA()()(),e.TgZ(6,"ion-content")(7,"ion-item-divider")(8,"ion-label"),e._uU(9),e.qZA()(),e.TgZ(10,"textarea",2),e.NdJ("ngModelChange",function(s){return a.lines=s}),e.qZA(),e.YNc(11,M,21,13,"div",3),e.TgZ(12,"ion-item-divider")(13,"ion-label"),e._uU(14),e.qZA(),e.YNc(15,A,2,1,"ion-button",4),e.qZA(),e.YNc(16,P,1,1,"img",5),e.qZA()),2&t&&(e.xp6(9),e.Oqu(a.lang.text.Settings.quickQRshare),e.xp6(1),e.Q6J("ngModel",a.lines),e.xp6(1),e.Q6J("ngIf",a.HideSender),e.xp6(3),e.Oqu(a.lang.text.QuickQRShare.ReceiveData),e.xp6(1),e.Q6J("ngIf",!a.ShowQRInfo),e.xp6(1),e.Q6J("ngIf",a.ShowQRInfo))},directives:[n.Gu,n.sr,n.wd,n.Sm,n.oU,n.cs,n.W2,n.rH,n.Q$,d.Fj,d.JJ,d.On,u.O5,n.Ie,n.ho,n.w,n.t9,n.QI,u.sg,n.n0,n.YG],styles:[""]}),i})()}];let J=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[f.Bz.forChild(O)],f.Bz]}),i})(),I=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[u.ez,d.u5,n.Pc,J]]}),i})()}}]);