"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3832],{5346:(j,V,p)=>{p.d(V,{ez:()=>w});var w=function(k){return k.UTF8="utf8",k.ASCII="ascii",k.UTF16="utf16",k}(w||{})},9745:(j,V,p)=>{p.d(V,{B:()=>r});var _=p(5861),w=p(6845),y=p(9868),k=p(8049),J=p(9761),t=p(9468),i=p(1325),C=p(797),G=p(3857),O=p(2372),L=p(9376),T=p(6052),Z=p(9080),N=p(4663),R=p(4093),B=p(6814),$=p(95);const z=["ShowContentInfoIonic"];function X(s,c){if(1&s){const l=t.EpF();t.TgZ(0,"ion-icon",20),t.NdJ("click",function(){t.CHM(l);const n=t.oxw();return t.KtG(n.ChangeToAnother(-1))}),t.qZA()}}function ee(s,c){if(1&s&&(t.TgZ(0,"ion-label",21),t._uU(1),t.qZA()),2&s){const l=t.oxw();t.xp6(1),t.Oqu(l.RelevanceIndex+" / "+l.Relevances.length)}}function te(s,c){if(1&s){const l=t.EpF();t.TgZ(0,"ion-icon",22),t.NdJ("click",function(){t.CHM(l);const n=t.oxw();return t.KtG(n.ChangeToAnother(1))}),t.qZA()}}function ie(s,c){if(1&s&&(t.TgZ(0,"ion-label",23),t._uU(1),t.qZA()),2&s){const l=t.oxw();t.xp6(1),t.Oqu(l.FileInfo.filename||l.FileInfo.name)}}function ne(s,c){if(1&s){const l=t.EpF();t.TgZ(0,"ion-input",24),t.NdJ("ngModelChange",function(n){t.CHM(l);const m=t.oxw();return t.KtG(m.NewTextFileName=n)}),t.qZA()}if(2&s){const l=t.oxw();t.Q6J("ngModel",l.NewTextFileName)("placeholder",l.FileInfo.filename||l.FileInfo.name)}}function oe(s,c){if(1&s){const l=t.EpF();t.TgZ(0,"ion-button",25),t.NdJ("click",function(){t.CHM(l);const n=t.oxw();return t.KtG(n.close_text_edit())}),t._UZ(1,"ion-icon",26),t.qZA()}}function ae(s,c){if(1&s){const l=t.EpF();t.TgZ(0,"ion-button",25),t.NdJ("click",function(){t.CHM(l);const n=t.oxw();return t.KtG(n.SaveText())}),t._UZ(1,"ion-icon",27),t.qZA()}}function le(s,c){if(1&s){const l=t.EpF();t.TgZ(0,"ion-button",28),t.NdJ("click",function(){t.CHM(l);const n=t.oxw();return t.KtG(n.DownloadAllListFiles())}),t._UZ(1,"ion-icon",29),t.qZA()}if(2&s){const l=t.oxw();t.Q6J("disabled",l.isDownloading||l.MessageInfo.content.transfer_index&&"download"==l.MessageInfo.content.transfer_index.OnTransfer)}}function se(s,c){1&s&&(t.TgZ(0,"ion-button",30),t._UZ(1,"ion-icon",31),t.qZA())}function re(s,c){if(1&s){const l=t.EpF();t.TgZ(0,"ion-item",34),t.NdJ("click",function(){t.CHM(l);const n=t.oxw(3);return t.KtG(n.open_text_editor())}),t.TgZ(1,"ion-label"),t._uU(2),t.qZA()()}if(2&s){const l=t.oxw(3);t.xp6(2),t.Oqu(l.lang.text.ContentViewer.EditText)}}function ce(s,c){if(1&s){const l=t.EpF();t.TgZ(0,"ion-item",34),t.NdJ("click",function(){t.CHM(l);const n=t.oxw(3);return t.KtG(n.modify_image())}),t.TgZ(1,"ion-label"),t._uU(2),t.qZA()()}if(2&s){const l=t.oxw(3);t.xp6(2),t.Oqu(l.lang.text.ContentViewer.Edit)}}function _e(s,c){if(1&s){const l=t.EpF();t.TgZ(0,"ion-item",34),t.NdJ("click",function(){t.CHM(l);const n=t.oxw(3);return t.KtG(n.open_bottom_modal())}),t.TgZ(1,"ion-label"),t._uU(2),t.qZA()()}if(2&s){const l=t.oxw(3);t.xp6(2),t.Oqu(l.lang.text.ContentViewer.ContentInfo)}}function de(s,c){if(1&s){const l=t.EpF();t.TgZ(0,"ion-item",34),t.NdJ("click",function(){t.CHM(l);const n=t.oxw(3);return t.KtG(n.ShareContent())}),t.TgZ(1,"ion-label"),t._uU(2),t.qZA()()}if(2&s){const l=t.oxw(3);t.xp6(2),t.Oqu(l.lang.text.ContentViewer.ShareContent)}}function ge(s,c){if(1&s){const l=t.EpF();t.TgZ(0,"ion-item",34),t.NdJ("click",function(){t.CHM(l);const n=t.oxw(3);return t.KtG(n.download_file())}),t.TgZ(1,"ion-label"),t._uU(2),t.qZA()()}if(2&s){const l=t.oxw(3);t.xp6(2),t.Oqu(l.lang.text.ContentViewer.Download)}}function fe(s,c){if(1&s){const l=t.EpF();t.TgZ(0,"ion-item",34),t.NdJ("click",function(){t.CHM(l);const n=t.oxw(3);return t.KtG(n.RemoveFile())}),t.TgZ(1,"ion-label"),t._uU(2),t.qZA()()}if(2&s){const l=t.oxw(3);t.xp6(2),t.Oqu(l.lang.text.ContentViewer.RemoveFile)}}function me(s,c){if(1&s&&(t.TgZ(0,"ion-content")(1,"ion-list"),t.YNc(2,re,3,1,"ion-item",33),t.YNc(3,ce,3,1,"ion-item",33),t.YNc(4,_e,3,1,"ion-item",33),t.YNc(5,de,3,1,"ion-item",33),t.YNc(6,ge,3,1,"ion-item",33),t.YNc(7,fe,3,1,"ion-item",33),t.qZA()()),2&s){const l=t.oxw(2);t.xp6(2),t.Q6J("ngIf",!l.NeedDownloadFile&&"text"==l.FileInfo.viewer&&!l.HasNoEditButton),t.xp6(1),t.Q6J("ngIf",!l.NeedDownloadFile&&"audio"!=l.FileInfo.viewer&&!l.HasNoEditButton),t.xp6(1),t.Q6J("ngIf",l.FileInfo.content_creator),t.xp6(1),t.Q6J("ngIf",!l.NeedDownloadFile),t.xp6(1),t.Q6J("ngIf",!l.NeedDownloadFile&&!l.FileInfo.url),t.xp6(1),t.Q6J("ngIf",!l.NeedDownloadFile&&l.OpenInChannelChat)}}function he(s,c){1&s&&(t.TgZ(0,"ion-popover",32),t.YNc(1,me,8,6,"ng-template"),t.qZA())}function ue(s,c){if(1&s&&(t.TgZ(0,"div")(1,"div",36),t._UZ(2,"ion-icon",37),t.TgZ(3,"div")(4,"ion-label",38),t._uU(5),t.qZA()()()()),2&s){const l=t.oxw(2);t.xp6(5),t.Oqu(l.lang.text.ContentViewer.OnLoadContent)}}function pe(s,c){if(1&s&&(t.TgZ(0,"td"),t.YNc(1,ue,6,1,"div",17),t._UZ(2,"div",35),t.qZA()),2&s){const l=t.oxw();t.xp6(1),t.Q6J("ngIf",!l.ContentOnLoad)}}function xe(s,c){if(1&s){const l=t.EpF();t.TgZ(0,"td")(1,"ion-grid")(2,"ion-row",39)(3,"ion-col",40)(4,"ion-button",41),t.NdJ("click",function(){t.CHM(l);const n=t.oxw();return t.KtG(n.DownloadCurrentFile())}),t._uU(5),t.qZA()()()()()}if(2&s){const l=t.oxw();t.xp6(4),t.Q6J("disabled",l.isDownloading||l.MessageInfo.content.transfer_index&&"download"==l.MessageInfo.content.transfer_index.OnTransfer),t.xp6(1),t.hij(" ",l.MessageInfo.content.transfer_index&&"download"==l.MessageInfo.content.transfer_index.OnTransfer?l.lang.text.ContentViewer.FileDownloading:l.lang.text.ContentViewer.DownloadThisFile," ")}}function ve(s,c){if(1&s){const l=t.EpF();t.TgZ(0,"ion-item",34),t.NdJ("click",function(){t.CHM(l);const n=t.oxw(2);return t.KtG(n.copy_url(n.FileInfo.url))}),t.TgZ(1,"ion-label"),t._uU(2),t.qZA(),t.TgZ(3,"ion-label",42),t._uU(4),t.qZA()()}if(2&s){const l=t.oxw(2);t.xp6(2),t.Oqu(l.lang.text.ContentInfo.SourceFrom),t.xp6(2),t.Oqu(l.content_creator.various_display)}}function Fe(s,c){if(1&s&&(t.TgZ(0,"ion-item")(1,"ion-label"),t._uU(2),t.qZA(),t.TgZ(3,"ion-label",42),t._uU(4),t.qZA()()),2&s){const l=t.oxw(2);t.xp6(2),t.Oqu(l.lang.text.ContentInfo.FileSize),t.xp6(2),t.Oqu(l.CurrentFileSize)}}function Ie(s,c){1&s&&t._UZ(0,"ion-icon",53)}function be(s,c){1&s&&t._UZ(0,"ion-icon",54)}function we(s,c){1&s&&t._UZ(0,"ion-icon",55)}function De(s,c){1&s&&t._UZ(0,"ion-icon",56)}function Te(s,c){1&s&&t._UZ(0,"ion-icon",57)}function f(s,c){1&s&&t._UZ(0,"ion-icon",58)}function F(s,c){1&s&&(t.TgZ(0,"ion-avatar"),t._UZ(1,"img",59),t.qZA())}function d(s,c){if(1&s){const l=t.EpF();t.TgZ(0,"div")(1,"div",45),t._uU(2),t.TgZ(3,"ion-chip",46),t.NdJ("click",function(){const m=t.CHM(l).$implicit,h=t.oxw(2);return t.KtG(h.toast_info(m))}),t.YNc(4,Ie,1,0,"ion-icon",47),t.YNc(5,be,1,0,"ion-icon",48),t.YNc(6,we,1,0,"ion-icon",49),t.YNc(7,De,1,0,"ion-icon",50),t.YNc(8,Te,1,0,"ion-icon",51),t.YNc(9,f,1,0,"ion-icon",52),t.YNc(10,F,2,0,"ion-avatar",17),t.TgZ(11,"ion-label"),t._uU(12),t.qZA()()()()}if(2&s){const l=c.$implicit,e=t.oxw(2);t.xp6(2),t.hij(" ",l.timeDisplay," "),t.xp6(2),t.Q6J("ngIf","loaded"==l.various),t.xp6(1),t.Q6J("ngIf","camera"==l.various),t.xp6(1),t.Q6J("ngIf","link"==l.various),t.xp6(1),t.Q6J("ngIf","long_text"==l.various),t.xp6(1),t.Q6J("ngIf","textedit"==l.various),t.xp6(1),t.Q6J("ngIf","shared"==l.various),t.xp6(1),t.Q6J("ngIf","voidDraw"==l.various),t.xp6(2),t.Oqu(l.publisher||l.display_name||e.lang.text.Profile.noname_user)}}function o(s,c){if(1&s){const l=t.EpF();t.TgZ(0,"ion-content")(1,"ion-item-divider")(2,"ion-label"),t._uU(3),t.qZA()(),t.TgZ(4,"ion-item",34),t.NdJ("click",function(){t.CHM(l);const n=t.oxw();return t.KtG(n.copy_url(n.content_creator.user_id))}),t.TgZ(5,"ion-label"),t._uU(6),t.qZA(),t.TgZ(7,"ion-label",42),t._uU(8),t.qZA()(),t.YNc(9,ve,5,2,"ion-item",33),t.YNc(10,Fe,5,2,"ion-item",17),t.TgZ(11,"ion-item")(12,"ion-label"),t._uU(13),t.qZA(),t.TgZ(14,"ion-label",42),t._uU(15),t.qZA()(),t.TgZ(16,"ion-item-divider")(17,"ion-label"),t._uU(18),t.qZA()(),t.YNc(19,d,13,9,"div",43),t.TgZ(20,"ion-item",34),t.NdJ("click",function(){t.CHM(l),t.oxw();const n=t.MAs(25);return t.KtG(n.dismiss())}),t.TgZ(21,"ion-label",44),t._uU(22),t.qZA()()()}if(2&s){const l=t.oxw();t.xp6(3),t.Oqu(l.lang.text.ContentInfo.WorkLogs),t.xp6(3),t.Oqu(l.lang.text.ContentInfo.LastPost),t.xp6(2),t.hij(" ",l.content_creator.publisher||l.content_creator.display_name||l.lang.text.Profile.noname_user,""),t.xp6(1),t.Q6J("ngIf",l.content_creator.various),t.xp6(1),t.Q6J("ngIf",!l.FileInfo.url),t.xp6(3),t.Oqu(l.lang.text.ContentInfo.TimeAt),t.xp6(2),t.Oqu(l.content_creator.timeDisplay),t.xp6(3),t.Oqu(l.lang.text.ContentInfo.WorkHistory),t.xp6(1),t.Q6J("ngForOf",l.content_related_creator),t.xp6(3),t.Oqu(l.lang.text.ContentInfo.CloseModal)}}const a=function(){return[.5,1]};let r=(()=>{var s;class c{constructor(e,n,m,h,x,g,u,I,U,P,b,E){this.modalCtrl=e,this.navParams=n,this.indexed=m,this.lang=h,this.file=x,this.p5toast=g,this.alertCtrl=u,this.loadingCtrl=I,this.global=U,this.nakama=P,this.mClipboard=b,this.noti=E,this.useP5Navigator=!0,this.RelevanceIndex=0,this.HaveRelevances=!1,this.NeedDownloadFile=!1,this.ContentOnLoad=!1,this.isDownloading=!1,this.OpenInChannelChat=!1,this.isChannelOnline=!0,this.fromLocalChannel=!1,this.EventListenerAct=S=>{S.detail.register(120,W=>{})},this.isTextEditMode=!1,this.NewTextFileName="",this.image_info={},this.forceWrite=!1}ngOnInit(){var e=this;return(0,_.Z)(function*(){e.fromLocalChannel=e.navParams.get("local"),e.MessageInfo=e.navParams.get("info"),e.OpenInChannelChat=void 0!==e.MessageInfo.code,e.CurrentViewId=e.MessageInfo.message_id,e.FileInfo=e.MessageInfo.content,e.ContentBox=document.getElementById("ContentBox"),e.FileHeader=document.getElementById("FileHeader"),e.isOfficial=e.navParams.get("isOfficial"),e.target=e.navParams.get("target");try{e.isChannelOnline="online"==e.nakama.channels_orig[e.isOfficial][e.target][e.MessageInfo.channel_id].info.status,e.isChannelOnline=e.isChannelOnline||"online"==e.nakama.channels_orig[e.isOfficial][e.target][e.MessageInfo.channel_id].status||"pending"==e.nakama.channels_orig[e.isOfficial][e.target][e.MessageInfo.channel_id].status}catch{}if("text"===(e.targetDB=e.navParams.get("targetDB"),e.HasNoEditButton=e.navParams.get("no_edit")||!1,e.FileInfo.is_new));else{if(e.Relevances=e.navParams.get("relevance"),e.Relevances){for(let n=0,m=e.Relevances.length;n<m;n++)if(e.Relevances[n].message_id&&e.MessageInfo.message_id){if(e.Relevances[n].message_id==e.MessageInfo.message_id){e.RelevanceIndex=n+1;break}}else if(e.Relevances[n].content.path==e.MessageInfo.content.path){e.RelevanceIndex=n+1;break}e.HaveRelevances=e.Relevances.length>1}else e.HaveRelevances=!1;e.CreateContentInfo()}})()}reinit_content_data(e){var n=this;return(0,_.Z)(function*(){if(n.NewTextFileName="",n.NeedDownloadFile=!0,n.ContentOnLoad=!1,n.isTextEditMode=!1,n.MessageInfo=e,n.CurrentViewId=n.MessageInfo.message_id,n.FileInfo=n.MessageInfo.content,URL.revokeObjectURL(n.FileURL),n.FileInfo.url)n.FileURL=n.FileInfo.url,n.CreateContentInfo(),n.NeedDownloadFile=!1,n.ContentOnLoad=!0,n.ionViewDidEnter();else{let m=n.FileInfo.path||`servers/${n.isOfficial}/${n.target}/channels/${e.channel_id}/files/msg_${e.message_id}.${e.content.file_ext}`;n.image_info.path=m,n.NeedDownloadFile=yield n.indexed.checkIfFileExist(`${m}.history`,void 0,n.targetDB);try{n.blob=yield n.indexed.loadBlobFromUserPath(m,n.FileInfo.type,void 0,n.targetDB),n.CreateContentInfo(),n.ionViewDidEnter()}catch{n.FileURL=void 0,n.blob=void 0,n.isDownloading=!1,n.NeedDownloadFile=!0,n.ContentOnLoad=!1,n.CreateContentInfo(),n.p5canvas&&n.p5canvas.remove(),n.p5canvas=new y(x=>{x.setup=()=>{x.noCanvas()}}),n.ChangeContentWithKeyInput()}}})()}DownloadAllListFiles(){this.alertCtrl.create({header:this.lang.text.ContentViewer.DownloadAllFiles,message:this.lang.text.ContentViewer.DownloadLoadedList,buttons:[{text:this.lang.text.ContentViewer.DownloadThisFile,handler:()=>{this.DownloadInOrder()}}]}).then(e=>e.present())}DownloadInOrder(){var e=this;return(0,_.Z)(function*(){("Android"==w.n$||"iOS"==w.n$)&&e.noti.noti.schedule({id:6,title:e.lang.text.ContentViewer.DownloadThisFile,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://diychat",color:"b0b0b0"});for(let n=0,m=e.Relevances.length;n<m;n++)e.nakama.OnTransfer[e.isOfficial]||(e.nakama.OnTransfer[e.isOfficial]={}),e.nakama.OnTransfer[e.isOfficial][e.target]||(e.nakama.OnTransfer[e.isOfficial][e.target]={}),e.nakama.OnTransfer[e.isOfficial][e.target][e.Relevances[n].channel_id]||(e.nakama.OnTransfer[e.isOfficial][e.target][e.Relevances[n].channel_id]={}),e.nakama.OnTransfer[e.isOfficial][e.target][e.Relevances[n].channel_id][e.Relevances[n].message_id]||(e.nakama.OnTransfer[e.isOfficial][e.target][e.Relevances[n].channel_id][e.Relevances[n].message_id]={});for(let n=0,m=e.Relevances.length;n<m;n++){("Android"==w.n$||"iOS"==w.n$)&&e.noti.noti.schedule({id:6,title:`${e.lang.text.ContentViewer.DownloadThisFile}: ${m-n}`,progressBar:{value:n,maxValue:m},sound:null,smallIcon:"res://diychat",color:"b0b0b0"});let h=`servers/${e.isOfficial}/${e.target}/channels/${e.Relevances[n].channel_id}/files/msg_${e.Relevances[n].message_id}.${e.Relevances[n].content.file_ext}`;if(!(yield e.indexed.checkIfFileExist(h,void 0,e.targetDB)))try{yield e.DownloadCurrentFile(n)}catch(g){console.log(g)}}e.noti.ClearNoti(6)})()}ChangeToAnother(e){let n=this.RelevanceIndex+e;n<=0||n>this.Relevances.length||(this.p5canvas&&this.p5canvas.remove(),this.RelevanceIndex=n,this.FileInfo={file_ext:""},setTimeout(()=>{this.reinit_content_data(this.Relevances[this.RelevanceIndex-1])},100))}DownloadCurrentFile(e){var n=this;return(0,_.Z)(function*(){n.isDownloading=!0;let m=0,h=n.Relevances[null!=e?e:n.RelevanceIndex-1],x=`servers/${n.isOfficial}/${n.target}/channels/${h.channel_id}/files/msg_${h.message_id}.${h.content.file_ext}`;try{let u=yield n.indexed.loadTextFromUserPath(`${x}.history`,void 0,n.targetDB);m=JSON.parse(u).index}catch{}let g=h.message_id;yield n.nakama.ReadStorage_From_channel(h,x,n.isOfficial,n.target,m),n.CurrentViewId==g&&n.reinit_content_data(h)})()}formatBytes(e,n=2){if(!+e)return"0 Bytes";const h=n<0?0:n,g=Math.floor(Math.log(e)/Math.log(1024));return`${parseFloat((e/Math.pow(1024,g)).toFixed(h))} ${["Bytes","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"][g]}`}CreateContentInfo(){try{if(this.CurrentFileSize=this.formatBytes(this.FileInfo.size||this.FileInfo.filesize),this.content_creator=this.FileInfo.content_creator,this.content_creator.timeDisplay=new Date(this.content_creator.timestamp).toLocaleString(),this.content_related_creator=this.FileInfo.content_related_creator,this.content_creator.user_id)try{this.content_creator.is_me=this.nakama.servers[this.isOfficial][this.target].session.user_id==this.content_creator.user_id}catch{}try{this.content_creator.publisher=this.content_creator.is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_creator.user_id].display_name}catch{}this.set_various_display(this.content_creator);for(let e=0,n=this.content_related_creator.length;e<n;e++){if(this.content_related_creator[e].user_id)try{this.content_related_creator[e].is_me=this.nakama.servers[this.isOfficial][this.target].session.user_id==this.content_related_creator[e].user_id}catch{}this.content_related_creator[e].timeDisplay=new Date(this.content_related_creator[e].timestamp).toLocaleString()}}catch{}try{this.content_related_creator[0].publisher=this.content_related_creator[0].is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_related_creator[0].user_id].display_name,this.content_related_creator[0].timestamp==this.content_related_creator[1].timestamp&&(this.content_related_creator[0].publisher=this.content_related_creator[1].is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_related_creator[1].user_id].display_name,this.content_related_creator.splice(1,1))}catch{try{this.content_related_creator[0].publisher=this.content_related_creator[1].display_name,this.content_related_creator[0].timestamp==this.content_related_creator[1].timestamp&&(this.content_related_creator[0].publisher=this.content_related_creator[1].display_name,this.content_related_creator.splice(1,1))}catch{}try{this.content_related_creator[0].publisher||(this.content_related_creator[0].publisher=this.content_related_creator[0].display_name)}catch{}}try{this.content_related_creator.sort((e,n)=>e.timestamp>n.timestamp?-1:e.timestamp<n.timestamp?1:0)}catch{}}set_various_display(e){switch(e.various){case"camera":e.various_display=this.lang.text.GlobalAct.FromCamera;break;case"link":e.various_display=this.FileInfo.url;break;case"loaded":e.various_display=this.lang.text.GlobalAct.variousCreator;break;case"voidDraw":e.various_display=this.lang.text.GlobalAct.FromVoidDraw;break;case"long_text":e.various_display=this.lang.text.GlobalAct.FromAutoLongText;break;case"textedit":e.various_display=this.lang.text.GlobalAct.FromTextEditor;break;case"shared":e.various_display=this.lang.text.GlobalAct.SharedContent;break;default:e.various_display=this.lang.text.GlobalAct.UnknownSource}}close_text_edit(){this.FileInfo.is_new?this.modalCtrl.dismiss():this.reinit_content_data(this.MessageInfo)}ionViewDidEnter(){var e=this;return(0,_.Z)(function*(){e.FileInfo.url?e.FileURL=e.FileInfo.url:e.FileInfo.is_new||(e.blob||(e.blob=yield e.indexed.loadBlobFromUserPath(e.FileInfo.path||e.navParams.get("path"),e.FileInfo.type,void 0,e.targetDB)),e.FileURL=URL.createObjectURL(e.blob)),e.forceWrite=!1;let n=document.getElementById("content_viewer_canvas");switch(n&&(n.style.backgroundImage=""),document.removeEventListener("ionBackButton",e.EventListenerAct),e.p5canvas&&e.p5canvas.remove(),e.FileInfo.viewer){case"image":e.p5canvas=new y(g=>{g.setup=(0,_.Z)(function*(){n.style.maxWidth="100%",n.style.overflow="hidden",e.ContentBox.style.overflow="hidden",g.noCanvas();let v=g.createElement("img");v.elt.hidden=!0,v.elt.src=e.FileURL,v.elt.onload=()=>{n.style.backgroundImage=`url(${e.FileURL})`,n.style.backgroundRepeat="no-repeat",n.style.pointerEvents="none",e.image_info.width=v.elt.naturalWidth,e.image_info.height=v.elt.naturalHeight,I=g.createVector(v.elt.naturalWidth,v.elt.naturalHeight),u(),v.remove()},g.noLoop()});let u=()=>{if(e.image_info.width/e.image_info.height<n.clientWidth/n.clientHeight){let v=e.image_info.width*n.clientHeight/e.image_info.height;n.style.backgroundSize=`${v}px`,n.style.backgroundPositionX=(n.clientWidth-v)/2+"px",n.style.backgroundPositionY="0px"}else n.style.backgroundSize=`${n.clientWidth}px`,n.style.backgroundPositionX="0px",n.style.backgroundPositionY=n.clientHeight/2-I.y*(n.clientWidth/I.x)/2+"px";Q=!0};g.windowResized=()=>{setTimeout(()=>{u()},50)};let I,U=g.createVector(),P=g.createVector(),b=g.createVector(),E=1,S=()=>{n.style.backgroundPositionX=`${U.x+b.x}px`,n.style.backgroundPositionY=`${U.y+b.y}px`},W=(v,Y)=>{let D=E,M=E*Y,q=Number(n.style.backgroundPositionX.split("px")[0]),ye=Number(n.style.backgroundPositionY.split("px")[0]),Pe=(D-M)*g.map(v.x,q,q+D,0,1),Ze=(D-M)/I.x*I.y*g.map(v.y,ye,ye+D/I.x*I.y,0,1);n.style.backgroundPositionX=`${q+Pe}px`,n.style.backgroundPositionY=`${ye+Ze}px`,n.style.backgroundSize=`${M}px`};g.mousePressed=()=>{e.useP5Navigator&&(g.mouseButton==g.CENTER&&u(),"DesktopPWA"==w.n$&&(U=g.createVector(Number(n.style.backgroundPositionX.split("px")[0]),Number(n.style.backgroundPositionY.split("px")[0])),P=g.createVector(g.mouseX,g.mouseY)))},g.mouseWheel=v=>{e.useP5Navigator&&(E=Number(n.style.backgroundSize.split("px")[0]),W(g.createVector(n.clientWidth/2,n.clientHeight/2),1-v.delta/1e3))},g.mouseDragged=()=>{e.useP5Navigator&&"DesktopPWA"==w.n$&&(b=g.createVector(g.mouseX,g.mouseY),b.sub(P),S())};let Ce,A={},K=!1,Q=!0;g.touchStarted=v=>{if(e.useP5Navigator){for(let D=0,M=v.changedTouches.length;D<M;D++)A[v.changedTouches[D].identifier]=g.createVector(v.changedTouches[D].clientX,v.changedTouches[D].clientY);switch(Object.keys(A).length){case 1:U=g.createVector(Number(n.style.backgroundPositionX.split("px")[0]),Number(n.style.backgroundPositionY.split("px")[0])),P=A[v.changedTouches[0].identifier].copy();break;case 2:U=g.createVector(Number(n.style.backgroundPositionX.split("px")[0]),Number(n.style.backgroundPositionY.split("px")[0]));let D=A[0].copy();Ce=D.dist(A[1]),P=D.add(A[1]).div(2).copy(),E=Number(n.style.backgroundSize.split("px")[0]),S();break;default:K=!0,u()}}},g.touchMoved=v=>{if(e.useP5Navigator&&!K){for(let D=0,M=v.changedTouches.length;D<M;D++)A[v.changedTouches[D].identifier]=g.createVector(v.changedTouches[D].clientX,v.changedTouches[D].clientY);switch(Object.keys(A).length){case 1:b=A[v.changedTouches[0].identifier].copy(),b.sub(P),Q||S();break;case 2:Q=!1;let D=A[0].copy(),M=D.dist(A[1]);b=D.add(A[1]).div(2).copy();let q=b.copy();b.sub(P),S(),W(q,M/Ce)}}},g.touchEnded=v=>{if(e.useP5Navigator&&"changedTouches"in v){for(let D=0,M=v.changedTouches.length;D<M;D++)delete A[v.changedTouches[D].identifier];switch(Object.keys(A).length){case 1:U=g.createVector(Number(n.style.backgroundPositionX.split("px")[0]),Number(n.style.backgroundPositionY.split("px")[0])),P=A[Object.keys(A)[0]].copy();break;case 0:Q&&!K&&(b.x>50?e.ChangeToAnother(-1):b.x<-50&&e.ChangeToAnother(1)),K=!1}}}});break;case"audio":e.p5canvas=new y(g=>{var u;g.setup=()=>{g.noCanvas(),g.noLoop(),u=g.createAudio([e.FileURL],()=>{n.appendChild(u.elt),u.elt.hidden=!0,setTimeout(()=>{I(),u.elt.hidden=!1},50),u.showControls(),u.play()})};let I=()=>{let U=e.ContentBox.offsetWidth;u.elt.setAttribute("style","position: relative; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%);"),u.size(U,25)};g.windowResized=()=>{setTimeout(()=>{I()},50)}});break;case"video":e.p5canvas=new y(g=>{var u;g.setup=()=>{g.noCanvas(),g.noLoop(),u=g.createVideo([e.FileURL],()=>{n.appendChild(u.elt),u.elt.hidden=!0,setTimeout(()=>{e.image_info.width=u.elt.videoWidth,e.image_info.height=u.elt.videoHeight,I(),u.elt.hidden=!1},50),u.showControls(),u.play()}),g.VideoMedia=u};let I=()=>{let U=e.ContentBox.offsetWidth,P=e.ContentBox.offsetHeight-e.FileHeader.offsetHeight,b=u.elt.videoWidth,E=u.elt.videoHeight;0!=b&&0!=E&&(U/P>b/E?(E=P,b=b/u.elt.videoHeight*E,u.elt.setAttribute("style","position: relative; left: 50%; transform: translateX(-50%);")):(b=U,E=E/u.elt.videoWidth*b||P/2,u.elt.setAttribute("style","position: relative; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%);")),u.size(b,E))};g.windowResized=()=>{setTimeout(()=>{I()},50)}});break;case"text":e.p5canvas=new y(g=>{g.setup=()=>{g.noCanvas(),g.noLoop();let u=g.createElement("textarea");u.elt.disabled=!0,u.elt.className="infobox",u.elt.setAttribute("style","height: 100%; display: block;"),u.elt.textContent="",n.appendChild(u.elt),g.TextArea=u.elt,e.FileInfo.is_new?e.open_text_editor(u.elt):g.loadStrings(e.FileURL,I=>{u.elt.textContent=I.join("\n")},I=>{n.textContent=e.lang.text.ContentViewer.CannotOpenText,e.FileInfo.else=!0})}});break;case"godot":document.addEventListener("ionBackButton",e.EventListenerAct);let m,h=e.MessageInfo.message_id;try{let g=yield e.indexed.loadBlobFromUserPath((e.FileInfo.path||e.navParams.get("path"))+"_thumbnail.png","",void 0,e.targetDB);m=URL.createObjectURL(g)}catch{}!e.NeedDownloadFile&&e.CurrentViewId==h&&setTimeout((0,_.Z)(function*(){let g=!1;if(e.indexed.godotDB)try{let u=yield e.indexed.loadBlobFromUserPath(e.FileInfo.path||e.navParams.get("path"),"",void 0,e.indexed.ionicDB);yield e.indexed.GetGodotIndexedDB(),yield e.indexed.saveBlobToUserPath(u,"tmp_files/duplicate/viewer.pck",void 0,e.indexed.godotDB),g=!0}catch(u){console.log("\ub0b4\ubd80 \ud30c\uc77c \uc5c6\uc74c: ",u)}if(yield e.global.CreateGodotIFrame("content_viewer_canvas",{path:"tmp_files/duplicate/viewer.pck",alt_path:e.FileInfo.path||e.navParams.get("path"),ext:e.FileInfo.file_ext,url:e.FileInfo.url,background:m,receive_image:(u=(0,_.Z)(function*(I,U,P){let b="tmp_files/modify_image.png";yield e.indexed.saveBase64ToUserPath(","+I,b),e.modalCtrl.dismiss({type:"image",path:b,width:U,height:P,msg:e.MessageInfo,index:e.RelevanceIndex-1})}),function(U,P,b){return u.apply(this,arguments)})},"start_load_pck"),!g){try{let u=yield e.indexed.loadBlobFromUserPath(e.FileInfo.path||e.navParams.get("path"),"",void 0,e.indexed.ionicDB);yield e.indexed.GetGodotIndexedDB(),yield e.indexed.saveBlobToUserPath(u,"tmp_files/duplicate/viewer.pck",void 0,e.indexed.godotDB)}catch(u){console.log("\ub0b4\ubd80 \ud30c\uc77c \uc5c6\uc74c_dp: ",u)}yield e.global.CreateGodotIFrame("content_viewer_canvas",{path:"tmp_files/duplicate/viewer.pck",alt_path:e.FileInfo.path||e.navParams.get("path"),ext:e.FileInfo.file_ext,url:e.FileInfo.url,background:m,receive_image:function(){var u=(0,_.Z)(function*(I,U,P){let b="tmp_files/modify_image.png";yield e.indexed.saveBase64ToUserPath(","+I,b),e.modalCtrl.dismiss({type:"image",path:b,width:U,height:P,msg:e.MessageInfo,index:e.RelevanceIndex-1})});return function(U,P,b){return u.apply(this,arguments)}}()},"start_load_pck")}var u;m&&URL.revokeObjectURL(m),e.FileInfo.url?e.global.godot_window.download_url():e.global.godot_window.start_load_pck()}),100);break;case"disabled":e.p5canvas=new y(g=>{g.setup=()=>{g.noCanvas()}});let x=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});x.present(),x.dismiss(),e.download_file()}e.ContentOnLoad=!0,e.ChangeContentWithKeyInput()})()}ChangeContentWithKeyInput(){this.p5canvas&&(this.p5canvas.keyPressed=e=>{if(!this.isTextEditMode)switch(e.code){case"KeyA":case"ArrowLeft":this.ChangeToAnother(-1);break;case"KeyD":case"ArrowRight":this.ChangeToAnother(1);break;case"KeyS":this.NeedDownloadFile&&this.DownloadCurrentFile()}})}open_bottom_modal(){this.ShowContentInfoIonic.onDidDismiss().then(e=>{this.useP5Navigator=!0}),this.useP5Navigator=!1,this.ShowContentInfoIonic.present()}open_text_editor(e=this.p5canvas.TextArea){e.disabled=!1,setTimeout(()=>{this.isTextEditMode=!0,e.focus()},500)}SaveText(){var e=this;return(0,_.Z)(function*(){let n=new Blob([e.p5canvas.TextArea.value],{type:e.FileInfo.type});if(n.name=e.NewTextFileName||e.FileInfo.filename||e.FileInfo.name,e.OpenInChannelChat)e.modalCtrl.dismiss({type:"text",blob:n,contentRelated:e.FileInfo.content_related_creator});else{let m=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});m.present();let h=`tmp_files/texteditor/${e.FileInfo.filename||e.FileInfo.name}`;console.log(e.FileInfo),e.FileInfo.path||(e.FileInfo.path=h),yield e.indexed.saveBlobToUserPath(n,h,void 0,e.targetDB),m.dismiss(),e.p5toast.show({text:e.lang.text.ContentViewer.fileSaved}),e.modalCtrl.dismiss({type:"text",blob:n,path:h,index:e.RelevanceIndex-1})}})()}modify_image(){var e=this;return(0,_.Z)(function*(){switch(e.FileInfo.viewer){case"image":{let m=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});m.present();try{let h;e.image_info.path=e.FileInfo.path||e.navParams.get("path"),e.FileInfo.url&&(e.image_info.path="tmp_files/modify_image.png",h=yield fetch(e.FileInfo.url).then(x=>x.blob()),yield e.indexed.saveBlobToUserPath(h,e.image_info.path)),e.modalCtrl.dismiss({type:"image",...e.image_info,path:e.image_info.path,msg:e.MessageInfo,index:e.RelevanceIndex-1})}catch(h){e.p5toast.show({text:`${e.lang.text.ContentViewer.CannotEditFile}: ${h}`})}m.dismiss()}break;case"text":let n=e.p5canvas.TextArea.textContent.split("\n");e.modalCtrl.dismiss({type:"image",text:n,msg:e.MessageInfo,index:e.RelevanceIndex-1});break;case"video":try{let m=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});m.present(),e.p5canvas.pixelDensity(1),e.p5canvas.VideoMedia.pause(),e.p5canvas.VideoMedia.size(e.image_info.width,e.image_info.height),e.p5canvas.createCanvas(e.image_info.width,e.image_info.height),e.p5canvas.image(e.p5canvas.VideoMedia,0,0,e.p5canvas.width,e.p5canvas.height),e.p5canvas.saveFrames("","png",1,1,function(){var h=(0,_.Z)(function*(x){try{m.dismiss(),e.image_info.path="tmp_files/modify_image.png",yield e.indexed.saveBase64ToUserPath(x[0].imageData.replace(/"|=|\\/g,""),e.image_info.path),e.modalCtrl.dismiss({type:"image",...e.image_info,msg:e.MessageInfo,index:e.RelevanceIndex-1})}catch(g){console.log("\ud30c\uc77c \uc800\uc7a5 \uc624\ub958: ",g)}});return function(x){return h.apply(this,arguments)}}())}catch(m){console.log("\uc7ac\uc0dd\uc911\uc778 \ube44\ub514\uc624 \uc774\ubbf8\uc9c0 \ucd94\ucd9c \uc624\ub958: ",m)}break;case"godot":e.global.godot_window.modify_image();break;default:console.log("\ud3b8\uc9d1 \ubd88\uac00 \ud30c\uc77c \uc815\ubcf4: ",e.FileInfo)}})()}download_file(){console.log(this.FileInfo),"DesktopPWA"==w.n$||"MobilePWA"==w.n$?this.indexed.DownloadFileFromUserPath(this.FileInfo.path,this.FileInfo.type,this.FileInfo.filename||this.FileInfo.name,this.targetDB):this.alertCtrl.create({header:this.lang.text.ContentViewer.Filename,inputs:[{name:"filename",placeholder:this.FileInfo.filename||this.FileInfo.name,type:"text"}],buttons:[{text:this.lang.text.ContentViewer.saveFile,handler:e=>{this.DownloadFileAct(e)}}]}).then(e=>e.present())}DownloadFileAct(e){var n=this;return(0,_.Z)(function*(){let m=yield n.loadingCtrl.create({message:n.lang.text.TodoDetail.WIP});m.present();let h=e.filename?e.filename.replace(/:|\?|\/|\\|<|>/g,""):n.FileInfo.filename||n.FileInfo.name,x=yield n.indexed.loadBlobFromUserPath(n.FileInfo.path,n.FileInfo.type,void 0,n.targetDB);n.forceWrite&&!e.filename?n.file.writeExistingFile(n.file.externalDataDirectory,h,x).then(g=>{n.forceWrite=!1,m.dismiss(),n.p5toast.show({text:`${n.lang.text.ContentViewer.OverWriteFile}: ${h}`})}):n.file.writeFile(n.file.externalDataDirectory,h,x).then(g=>{m.dismiss(),n.p5toast.show({text:n.lang.text.ContentViewer.fileSaved})}).catch(g=>{12===(m.dismiss(),g.code)?(n.p5toast.show({text:n.lang.text.ContentViewer.AlreadyExist}),n.forceWrite=!0,n.download_file()):console.log("\uc900\ube44\ub418\uc9c0 \uc54a\uc740 \uc624\ub958 \ubc18\ud658: ",g)})})()}toast_info(e){e.various_display||this.set_various_display(e),this.p5toast.show({text:e.various_display})}ShareContent(){let e=this.nakama.rearrange_channels();for(let n=e.length-1;n>=0;n--)("missing"==e[n].status||"offline"==e[n].status)&&e.splice(n,1);e.length?this.modalCtrl.create({component:k.D,componentProps:{file:this.FileInfo,channels:e}}).then(n=>{n.onDidDismiss().then(m=>{m.data&&this.modalCtrl.dismiss()}),n.present()}):this.p5toast.show({text:this.lang.text.ShareContentToOther.NoChannelToShare})}RemoveFile(){this.alertCtrl.create({header:this.lang.text.ContentViewer.RemoveFile,message:this.FileInfo.path,buttons:[{text:this.lang.text.TodoDetail.remove,handler:()=>{this.RemoveFileAct()},cssClass:"red_font"}]}).then(e=>e.present())}RemoveFileAct(){var e=this;return(0,_.Z)(function*(){URL.revokeObjectURL(e.FileURL),delete e.FileInfo.thumbnail,delete e.FileInfo.text,yield e.indexed.removeFileFromUserPath(e.FileInfo.path,void 0,e.targetDB),e.RelevanceIndex-=1,e.ChangeToAnother(1)})()}ionViewWillLeave(){var e=this;return(0,_.Z)(function*(){switch(document.removeEventListener("ionBackButton",e.EventListenerAct),e.FileInfo.viewer){case"video":try{let m,h,n=e.p5canvas.VideoMedia.size();n.width>n.height?(m=192,h=n.height/n.width*192):(m=n.width/n.height*192,h=192),e.p5canvas.createCanvas(m,h),e.p5canvas.imageMode(e.p5canvas.CORNER),e.p5canvas.image(e.p5canvas.VideoMedia,0,0,m*e.image_info.width/n.width,h*e.image_info.height/n.height),e.p5canvas.fill(255,128),e.p5canvas.rect(0,0,m,h),e.p5canvas.textWrap(e.p5canvas.CHAR),e.p5canvas.textSize(16);let x=h/16;e.p5canvas.push(),e.p5canvas.translate(x/6,x/6),e.p5canvas.fill(0),e.p5canvas.text(e.FileInfo.filename||e.FileInfo.name,x,x,m-2*x,h-2*x),e.p5canvas.filter(e.p5canvas.BLUR,3),e.p5canvas.pop(),e.p5canvas.fill(255),e.p5canvas.text(e.FileInfo.filename||e.FileInfo.name,x,x,m-2*x,h-2*x),e.p5canvas.saveFrames("","png",1,1,function(){var g=(0,_.Z)(function*(u){try{let I=u[0].imageData.replace(/"|=|\\/g,"");yield e.indexed.saveBase64ToUserPath(I,`${e.FileInfo.path}_thumbnail.png`,void 0,e.targetDB),e.FileInfo.thumbnail=I,e.global.modulate_thumbnail(e.FileInfo,"")}catch(I){console.log("\uc378\ub124\uc77c \uc800\uc7a5 \uc624\ub958: ",I)}});return function(u){return g.apply(this,arguments)}}())}catch(n){console.log("\ube44\ub514\uc624 \uc378\ub124\uc77c \uc0dd\uc131 \ucde8\uc18c: ",n)}break;case"godot":try{e.global.godot_window.filename=e.FileInfo.filename||e.FileInfo.name,e.global.godot_window.create_thumbnail(e.FileInfo),(yield e.indexed.GetFileListFromDB("tmp_files",void 0,e.indexed.godotDB)).forEach(m=>e.indexed.removeFileFromUserPath(m,void 0,e.indexed.godotDB))}catch{}}e.p5canvas&&e.p5canvas.remove(),URL.revokeObjectURL(e.FileURL);try{(yield e.file.checkFile(e.file.externalDataDirectory,`viewer_tmp.${e.FileInfo.file_ext}`))&&(yield e.file.removeFile(e.file.externalDataDirectory,`viewer_tmp.${e.FileInfo.file_ext}`))}catch{}})()}copy_url(e){this.mClipboard.copy(e).catch(n=>J.Z.write(e))}}return(s=c).\u0275fac=function(e){return new(e||s)(t.Y36(i.IN),t.Y36(i.X1),t.Y36(C.H),t.Y36(G.b),t.Y36(O.$),t.Y36(L.F),t.Y36(i.Br),t.Y36(i.HT),t.Y36(T.AN),t.Y36(Z.a),t.Y36(N.T),t.Y36(R.J))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-ionic-viewer"]],viewQuery:function(e,n){if(1&e&&t.Gf(z,5),2&e){let m;t.iGM(m=t.CRH())&&(n.ShowContentInfoIonic=m.first)}},decls:27,vars:16,consts:[[1,"ion-no-border"],["id","Toolbar"],["slot","start",3,"click"],["defaultHref",""],["class","relevance_change","style","padding-right: 4px;","slot","end","name","arrow-back-circle-outline",3,"click",4,"ngIf"],["slot","end",4,"ngIf"],["class","relevance_change","style","padding-right: 16px; padding-left: 4px;","slot","end","name","arrow-forward-circle-outline",3,"click",4,"ngIf"],["id","ContentBox"],[1,"main_table_elt"],[2,"height","0"],["id","FileHeader",2,"max-width","100vw"],["text-wrap","","style","overflow-x: auto;",4,"ngIf"],["type","text","text-warp","","style","overflow-x: auto; overflow-y: hidden;",3,"ngModel","placeholder","ngModelChange",4,"ngIf"],[3,"click",4,"ngIf"],["class","ion-align-items-center",3,"disabled","click",4,"ngIf"],["id","menu_trigger",4,"ngIf"],["trigger","menu_trigger","dismissOnSelect","",4,"ngIf"],[4,"ngIf"],[3,"initialBreakpoint","breakpoints"],["ShowContentInfoIonic",""],["slot","end","name","arrow-back-circle-outline",1,"relevance_change",2,"padding-right","4px",3,"click"],["slot","end"],["slot","end","name","arrow-forward-circle-outline",1,"relevance_change",2,"padding-right","16px","padding-left","4px",3,"click"],["text-wrap","",2,"overflow-x","auto"],["type","text","text-warp","",2,"overflow-x","auto","overflow-y","hidden",3,"ngModel","placeholder","ngModelChange"],[3,"click"],["name","close-circle-outline"],["name","save-outline"],[1,"ion-align-items-center",3,"disabled","click"],["name","code-download-outline"],["id","menu_trigger"],["name","ellipsis-vertical"],["trigger","menu_trigger","dismissOnSelect",""],["button","",3,"click",4,"ngIf"],["button","",3,"click"],["id","content_viewer_canvas",1,"full_screen",2,"background-color","black"],[1,"disconnect_info"],["color","medium","name","attach-outline",2,"width","60px","height","60px"],["color","medium"],[1,"ion-align-items-center"],["size","12",1,"ion-text-center"],["color","warning","shape","round",1,"ion-align-items-center",3,"disabled","click"],[1,"ion-text-end"],[4,"ngFor","ngForOf"],[1,"ion-text-center"],[1,"history_center"],["color","secondary","mode","ios","outline","true",3,"click"],["name","document-attach-outline",4,"ngIf"],["name","camera-outline",4,"ngIf"],["name","link-outline",4,"ngIf"],["name","text-outline",4,"ngIf"],["name","document-text-outline",4,"ngIf"],["name","share-social-outline",4,"ngIf"],["name","document-attach-outline"],["name","camera-outline"],["name","link-outline"],["name","text-outline"],["name","document-text-outline"],["name","share-social-outline"],["src","assets/icon/voidDraw.png"]],template:function(e,n){1&e&&(t.TgZ(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-title"),t._uU(3),t.qZA(),t.TgZ(4,"ion-buttons",2),t.NdJ("click",function(){return n.modalCtrl.dismiss()}),t._UZ(5,"ion-back-button",3),t.qZA(),t.YNc(6,X,1,0,"ion-icon",4),t.YNc(7,ee,2,1,"ion-label",5),t.YNc(8,te,1,0,"ion-icon",6),t.qZA()(),t.TgZ(9,"ion-content",7)(10,"table",8)(11,"tr",9)(12,"td")(13,"ion-list-header",10),t.YNc(14,ie,2,1,"ion-label",11),t.YNc(15,ne,1,2,"ion-input",12),t.YNc(16,oe,2,0,"ion-button",13),t.YNc(17,ae,2,0,"ion-button",13),t.YNc(18,le,2,1,"ion-button",14),t.YNc(19,se,2,0,"ion-button",15),t.YNc(20,he,2,0,"ion-popover",16),t.qZA()()(),t.TgZ(21,"tr"),t.YNc(22,pe,3,1,"td",17),t.YNc(23,xe,6,2,"td",17),t.qZA()(),t.TgZ(24,"ion-modal",18,19),t.YNc(26,o,23,10,"ng-template"),t.qZA()()),2&e&&(t.xp6(3),t.Oqu(n.lang.text.ContentViewer.Title),t.xp6(3),t.Q6J("ngIf",n.HaveRelevances),t.xp6(1),t.Q6J("ngIf",n.HaveRelevances),t.xp6(1),t.Q6J("ngIf",n.HaveRelevances),t.xp6(6),t.Q6J("ngIf",!n.isTextEditMode),t.xp6(1),t.Q6J("ngIf",n.isTextEditMode),t.xp6(1),t.Q6J("ngIf",n.isTextEditMode),t.xp6(1),t.Q6J("ngIf",n.isTextEditMode),t.xp6(1),t.Q6J("ngIf",n.isChannelOnline&&n.HaveRelevances&&!n.isTextEditMode&&!n.fromLocalChannel),t.xp6(1),t.Q6J("ngIf",!n.isTextEditMode),t.xp6(1),t.Q6J("ngIf",!n.isTextEditMode),t.xp6(2),t.Q6J("ngIf",!n.NeedDownloadFile),t.xp6(1),t.Q6J("ngIf",n.NeedDownloadFile),t.xp6(1),t.Q6J("initialBreakpoint",.5)("breakpoints",t.DdM(15,a)))},dependencies:[B.sg,B.O5,$.JJ,$.On,i.BJ,i.oU,i.YG,i.Sm,i.hM,i.wI,i.W2,i.jY,i.Gu,i.gu,i.pK,i.Ie,i.rH,i.Q$,i.q_,i.yh,i.Nd,i.wd,i.sr,i.ki,i.d8,i.j9,i.cs],styles:[".main_table_elt[_ngcontent-%COMP%]{width:100%;height:100%;border:0;margin:0}.relevance_change[_ngcontent-%COMP%]{width:25px;height:25px}.history_center[_ngcontent-%COMP%]{text-align:center}"]}),c})()},8049:(j,V,p)=>{p.d(V,{D:()=>G});var _=p(9468),w=p(3857),y=p(1325),H=p(7488),k=p(9080),J=p(6814);function t(O,L){1&O&&_._UZ(0,"div",12)}function i(O,L){if(1&O&&_._UZ(0,"img",13),2&O){const T=_.oxw().$implicit;_.Akn("online"==T.status||3==T.redirect.type&&"pending"==T.status?"filter: grayscale(0) contrast(1)":"filter: grayscale(.9) contrast(1.4)"),_.Q6J("src",T.info.img,_.LSH)}}function C(O,L){if(1&O){const T=_.EpF();_.TgZ(0,"ion-item",4),_.NdJ("click",function(){const R=_.CHM(T).$implicit,B=_.oxw();return _.KtG(B.go_to_chatroom(R))}),_.TgZ(1,"div",5),_.YNc(2,t,1,0,"div",6),_.qZA(),_.TgZ(3,"div",7),_.YNc(4,i,1,3,"img",8),_.qZA(),_.TgZ(5,"ion-label")(6,"div",9)(7,"table")(8,"tr")(9,"td"),_._uU(10),_.qZA(),_.TgZ(11,"td",10),_._uU(12),_.qZA()()()(),_.TgZ(13,"div",11),_._uU(14),_.qZA()()()}if(2&O){const T=L.$implicit,Z=_.oxw();_.xp6(1),_.Akn("background-color: "+Z.statusBar.colors[T.status||"offline"]),_.xp6(1),_.Q6J("ngIf",T.is_new),_.xp6(2),_.Q6J("ngIf",T.info),_.xp6(6),_.hij(" ",T.info?T.info.name||T.info.display_name||Z.lang.text.ChatRoom.noname_chatroom:T.title||Z.lang.text.ChatRoom.noname_chatroom," "),_.xp6(2),_.hij(" ","("+T.server.target+")"," "),_.xp6(2),_.hij(" ",T.last_comment||T.noti||Z.lang.text.Subscribes.noMessageHistory," ")}}let G=(()=>{var O;class L{constructor(Z,N,R,B,$){this.lang=Z,this.navParams=N,this.modalCtrl=R,this.statusBar=B,this.nakama=$}ngOnInit(){this.channels=this.navParams.get("channels")}go_to_chatroom(Z){this.nakama.go_to_chatroom_without_admob_act(Z,this.navParams.get("file")),this.modalCtrl.dismiss(!0)}}return(O=L).\u0275fac=function(Z){return new(Z||O)(_.Y36(w.b),_.Y36(y.X1),_.Y36(y.IN),_.Y36(H.g),_.Y36(k.a))},O.\u0275cmp=_.Xpm({type:O,selectors:[["app-share-content-to-other"]],decls:11,vars:3,consts:[[1,"ion-no-border"],["slot","start",3,"click"],["defaultHref",""],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"],[1,"additional_form","status_bar_double"],["class","new_circle",4,"ngIf"],[1,"additional_form","bg_img_form"],["class","profile_img",3,"style","src",4,"ngIf"],[1,"form_margin","header"],[1,"server_target"],[1,"form_margin","content"],[1,"new_circle"],[1,"profile_img",3,"src"]],template:function(Z,N){1&Z&&(_.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),_._uU(3),_.qZA(),_.TgZ(4,"ion-buttons",1),_.NdJ("click",function(){return N.modalCtrl.dismiss()}),_._UZ(5,"ion-back-button",2),_.qZA()()(),_.TgZ(6,"ion-content")(7,"ion-item-divider")(8,"ion-label"),_._uU(9),_.qZA()(),_.YNc(10,C,15,7,"ion-item",3),_.qZA()),2&Z&&(_.xp6(3),_.Oqu(N.lang.text.ShareContentToOther.Title),_.xp6(6),_.Oqu(N.lang.text.ShareContentToOther.AvailableChannels),_.xp6(1),_.Q6J("ngForOf",N.channels))},dependencies:[J.sg,J.O5,y.oU,y.Sm,y.W2,y.Gu,y.Ie,y.rH,y.Q$,y.wd,y.sr,y.cs],styles:[".server_target[_ngcontent-%COMP%]{color:#888;padding-left:4px}.content[_ngcontent-%COMP%]{color:#888;height:24px;display:table-cell;vertical-align:middle;padding:0 16px}"]}),L})()},3832:(j,V,p)=>{p.d(V,{P:()=>Te});var _=p(5861),w=p(6845),y=p(9745),H=p(2726);p(5346);const J=(0,H.fo)("Filesystem",{web:()=>p.e(4522).then(p.bind(p,4522)).then(f=>new f.FilesystemWeb)});var t=p(9868),i=p(9468),C=p(1325),G=p(797),O=p(3857),L=p(6052),T=p(9376),Z=p(6593),N=p(2372),R=p(4093),B=p(9080),$=p(6814);const z=["FileSel"];function X(f,F){if(1&f){const d=i.EpF();i.TgZ(0,"ion-icon",8),i.NdJ("click",function(){i.CHM(d);const a=i.oxw();return i.KtG(a.toggle_thumbnail())}),i.qZA()}}function ee(f,F){if(1&f){const d=i.EpF();i.TgZ(0,"ion-icon",9),i.NdJ("click",function(){i.CHM(d);const a=i.oxw();return i.KtG(a.toggle_thumbnail())}),i.qZA()}}function te(f,F){if(1&f){const d=i.EpF();i.TgZ(0,"div")(1,"ion-item",18),i.NdJ("click",function(){i.CHM(d);const a=i.oxw(2);return i.KtG(a.SelectImportFolder())}),i._UZ(2,"ion-icon",19),i.TgZ(3,"ion-label"),i._uU(4),i.qZA()(),i.TgZ(5,"input",20),i.NdJ("change",function(a){i.CHM(d);const r=i.oxw(2);return i.KtG(r.inputImageSelected(a))}),i.qZA()()}if(2&f){const d=i.oxw(2);i.xp6(4),i.hij(" ",d.lang.text.UserFsDir.ImportFolder," ")}}function ie(f,F){if(1&f){const d=i.EpF();i.TgZ(0,"ion-button",13),i.NdJ("click",function(){i.CHM(d);const a=i.oxw(2);return i.KtG(a.ExportDirectoryRecursive())}),i._uU(1),i.qZA()}if(2&f){const d=i.oxw(2);i.xp6(1),i.hij(" ",d.lang.text.UserFsDir.ExportDir," ")}}function ne(f,F){if(1&f){const d=i.EpF();i.TgZ(0,"ion-item",18),i.NdJ("click",function(){i.CHM(d);const a=i.oxw(2);return i.KtG(a.MoveToUpDir())}),i._UZ(1,"ion-icon",11),i.TgZ(2,"ion-label"),i._uU(3,".."),i.qZA()()}}function oe(f,F){if(1&f){const d=i.EpF();i.TgZ(0,"ion-item",18),i.NdJ("click",function(){i.CHM(d);const a=i.oxw().$implicit,r=i.oxw(2);return i.KtG(r.SelectFolder(a))}),i._UZ(1,"ion-icon",11),i.TgZ(2,"ion-label"),i._uU(3),i.qZA()()}if(2&f){const d=i.oxw().$implicit;i.xp6(3),i.Oqu(d.name)}}function ae(f,F){if(1&f&&(i.TgZ(0,"div"),i.YNc(1,oe,4,1,"ion-item",15),i.qZA()),2&f){const d=F.$implicit,o=i.oxw(2);i.xp6(1),i.Q6J("ngIf",o.CurrentDir==d.dir)}}function le(f,F){1&f&&i._UZ(0,"ion-icon",37)}function se(f,F){1&f&&i._UZ(0,"ion-icon",38)}function re(f,F){1&f&&i._UZ(0,"ion-icon",39)}function ce(f,F){1&f&&i._UZ(0,"ion-icon",40)}function _e(f,F){1&f&&i._UZ(0,"ion-icon",41)}function de(f,F){1&f&&i._UZ(0,"ion-icon",42)}function ge(f,F){if(1&f&&(i.TgZ(0,"ion-label",43),i._uU(1),i.qZA()),2&f){const d=i.oxw(2).$implicit;i.xp6(1),i.Oqu(d.name)}}function fe(f,F){if(1&f&&(i.TgZ(0,"ion-label"),i._uU(1),i.qZA()),2&f){const d=i.oxw(2).$implicit;i.xp6(1),i.Oqu(d.name)}}function me(f,F){if(1&f){const d=i.EpF();i.TgZ(0,"ion-button",44),i.NdJ("click",function(){i.CHM(d);const a=i.oxw(2).$implicit,r=i.oxw(2);return i.KtG(r.OpenFile(a))}),i._uU(1),i.qZA()}if(2&f){const d=i.oxw(4);i.xp6(1),i.hij(" ",d.lang.text.UserFsDir.Open," ")}}function he(f,F){if(1&f){const d=i.EpF();i.TgZ(0,"ion-button",44),i.NdJ("click",function(){i.CHM(d);const a=i.oxw(2).$implicit,r=i.oxw(2);return i.KtG(r.dismiss_page(a))}),i._uU(1),i.qZA()}if(2&f){const d=i.oxw(4);i.xp6(1),i.hij(" ",d.lang.text.UserFsDir.Select," ")}}function ue(f,F){if(1&f){const d=i.EpF();i.TgZ(0,"ion-button",44),i.NdJ("click",function(){i.CHM(d);const a=i.oxw(2).$implicit,r=i.oxw(2);return i.KtG(r.DownloadFile(a))}),i._uU(1),i.qZA()}if(2&f){const d=i.oxw(4);i.xp6(1),i.hij(" ",d.lang.text.UserFsDir.Download," ")}}function pe(f,F){if(1&f){const d=i.EpF();i.TgZ(0,"div",45),i.NdJ("click",function(){i.CHM(d);const a=i.oxw(2).$implicit,r=i.oxw(2);return i.KtG(r.OpenFile(a))}),i._UZ(1,"img",46),i.qZA()}if(2&f){const d=i.oxw(2).$implicit,o=i.oxw(2);i.xp6(1),i.Akn(o.HideThumbnail?"filter: blur(6px);":""),i.Q6J("src",d.thumbnail,i.LSH)("alt",d.name)}}function xe(f,F){if(1&f){const d=i.EpF();i.TgZ(0,"ion-accordion",22)(1,"ion-item",23),i.YNc(2,le,1,0,"ion-icon",24),i.YNc(3,se,1,0,"ion-icon",25),i.YNc(4,re,1,0,"ion-icon",26),i.YNc(5,ce,1,0,"ion-icon",27),i.YNc(6,_e,1,0,"ion-icon",28),i.YNc(7,de,1,0,"ion-icon",29),i.YNc(8,ge,2,1,"ion-label",30),i.YNc(9,fe,2,1,"ion-label",7),i._UZ(10,"ion-icon",31),i.qZA(),i.TgZ(11,"div",32)(12,"ion-item",10)(13,"ion-label"),i._uU(14),i.qZA(),i.YNc(15,me,2,1,"ion-button",33),i.YNc(16,he,2,1,"ion-button",33),i.YNc(17,ue,2,1,"ion-button",33),i.TgZ(18,"ion-button",34),i.NdJ("click",function(){i.CHM(d);const a=i.oxw(),r=a.$implicit,s=a.index,c=i.oxw(2);return i.KtG(c.RemoveFile(r,s))}),i._uU(19),i.qZA()(),i.YNc(20,pe,2,4,"div",35),i.TgZ(21,"ion-item",10)(22,"ion-label"),i._uU(23),i.qZA(),i.TgZ(24,"ion-label",36),i._uU(25),i.qZA()()()()}if(2&f){const d=i.oxw().$implicit;i.oxw();const o=i.MAs(17),a=i.oxw();i.Q6J("value",d.path),i.xp6(2),i.Q6J("ngIf","image"==d.viewer),i.xp6(1),i.Q6J("ngIf","audio"==d.viewer),i.xp6(1),i.Q6J("ngIf","video"==d.viewer),i.xp6(1),i.Q6J("ngIf","text"==d.viewer),i.xp6(1),i.Q6J("ngIf","godot"==d.viewer),i.xp6(1),i.Q6J("ngIf","disabled"==d.viewer),i.xp6(1),i.Q6J("ngIf",o.value==d.path),i.xp6(1),i.Q6J("ngIf",o.value!=d.path),i.xp6(5),i.Oqu(a.lang.text.UserFsDir.Action),i.xp6(1),i.Q6J("ngIf","image"!=d.viewer),i.xp6(1),i.Q6J("ngIf",a.is_file_selector),i.xp6(1),i.Q6J("ngIf",a.cant_dedicated&&!a.is_file_selector),i.xp6(2),i.hij(" ",a.lang.text.UserFsDir.Delete," "),i.xp6(1),i.Q6J("ngIf","image"==d.viewer),i.xp6(3),i.Oqu(a.lang.text.UserFsDir.CreateAt),i.xp6(2),i.Oqu(d.timestamp)}}function ve(f,F){if(1&f&&(i.TgZ(0,"div"),i.YNc(1,xe,26,17,"ion-accordion",21),i.qZA()),2&f){const d=F.$implicit,o=i.oxw(2);i.xp6(1),i.Q6J("ngIf",o.CurrentDir==d.dir||o.is_file_selector)}}function Fe(f,F){if(1&f){const d=i.EpF();i.TgZ(0,"ion-list"),i.YNc(1,te,6,1,"div",7),i.TgZ(2,"div")(3,"ion-item",10),i._UZ(4,"ion-icon",11),i.TgZ(5,"ion-label"),i._uU(6,"."),i.qZA(),i.YNc(7,ie,2,1,"ion-button",12),i.TgZ(8,"ion-button",13),i.NdJ("click",function(){i.CHM(d);const a=i.oxw();return i.KtG(a.CreateNewFolder())}),i._uU(9),i.qZA(),i.TgZ(10,"ion-button",13),i.NdJ("click",function(){i.CHM(d);const a=i.oxw();return i.KtG(a.SelectFiles())}),i._uU(11),i.qZA(),i.TgZ(12,"ion-button",14),i.NdJ("click",function(){i.CHM(d);const a=i.oxw();return i.KtG(a.RemoveDirectoryRecursive())}),i._uU(13),i.qZA()(),i.YNc(14,ne,4,0,"ion-item",15),i.qZA(),i.YNc(15,ae,2,1,"div",16),i.TgZ(16,"ion-accordion-group",null,17),i.YNc(18,ve,2,1,"div",16),i.qZA()()}if(2&f){const d=i.oxw();i.xp6(1),i.Q6J("ngIf",""==d.CurrentDir&&!d.is_file_selector),i.xp6(6),i.Q6J("ngIf",!d.cant_dedicated),i.xp6(2),i.hij(" ",d.lang.text.UserFsDir.NewFolder," "),i.xp6(2),i.hij(" ",d.lang.text.UserFsDir.AddFile," "),i.xp6(2),i.hij(" ",d.lang.text.UserFsDir.RemoveCurrentDir," "),i.xp6(1),i.Q6J("ngIf",""!=d.CurrentDir),i.xp6(1),i.Q6J("ngForOf",d.DirList),i.xp6(3),i.Q6J("ngForOf",d.FileList)}}function Ie(f,F){if(1&f){const d=i.EpF();i.TgZ(0,"ion-item",18),i.NdJ("click",function(){i.CHM(d);const a=i.oxw().$implicit,r=i.oxw(2);return i.KtG(r.importFolderMiddleAct(a))}),i._UZ(1,"ion-icon",11),i.TgZ(2,"ion-label"),i._uU(3),i.qZA()()}if(2&f){const d=i.oxw().$implicit;i.xp6(3),i.Oqu(d.name)}}function be(f,F){if(1&f&&(i.TgZ(0,"ion-item",49),i._UZ(1,"ion-icon",42),i.TgZ(2,"ion-label"),i._uU(3),i.qZA()()),2&f){const d=i.oxw().$implicit;i.xp6(3),i.Oqu(d.name)}}function we(f,F){if(1&f&&(i.TgZ(0,"div"),i.YNc(1,Ie,4,1,"ion-item",15),i.YNc(2,be,4,1,"ion-item",48),i.qZA()),2&f){const d=F.$implicit;i.xp6(1),i.Q6J("ngIf",d.isDirectory),i.xp6(1),i.Q6J("ngIf",d.isFile)}}function De(f,F){if(1&f){const d=i.EpF();i.TgZ(0,"ion-list")(1,"ion-item",18),i.NdJ("click",function(){i.CHM(d);const a=i.oxw();return i.KtG(a.InAppBrowser=!0)}),i._UZ(2,"ion-icon",11),i.TgZ(3,"ion-label",47),i._uU(4,"/sdcard/Android/data/org.pjcone.portal/files"),i.qZA()(),i.YNc(5,we,3,2,"div",16),i.qZA()}if(2&f){const d=i.oxw();i.xp6(5),i.Q6J("ngForOf",d.ExternalFolder)}}let Te=(()=>{var f;class F{constructor(o,a,r,s,c,l,e,n,m,h,x,g,u){this.modalCtrl=o,this.indexed=a,this.loadingCtrl=r,this.lang=s,this.global=c,this.p5toast=l,this.alertCtrl=e,this.sanitizer=n,this.file=m,this.navCtrl=h,this.noti=x,this.navParams=g,this.nakama=u,this.DirList=[],this.FileList=[],this.cant_dedicated=!1,this.InAppBrowser=!0,this.is_ready=!1,this.is_file_selector=!1,this.HideThumbnail=!1,this.StopIndexing=!1,this.EventListenerAct=I=>{I.detail.register(110,U=>{this.is_ready?""==this.CurrentDir?U():this.MoveToUpDir():(this.initLoadingElement.dismiss(),this.is_ready=!0)})},this.isCreateFolderRecursive=!1,this.ExternalFolder=[]}toggle_thumbnail(){this.HideThumbnail=!this.HideThumbnail,localStorage.setItem("user-fs-thumbnail",this.HideThumbnail?"1":"0")}ngOnInit(){"DesktopPWA"==w.n$&&setTimeout(()=>{this.CreateDrop()},0)}ionViewDidEnter(){this.global.p5key.KeyShortCut.Escape=()=>{this.is_ready?""==this.CurrentDir?this.navCtrl.pop():this.MoveToUpDir():(this.initLoadingElement.dismiss(),this.is_ready=!0)}}CreateDrop(){var o=this;let a=document.getElementById("p5Drop_userfs");this.p5canvas=new t(r=>{r.setup=()=>{let n=r.createCanvas(a.clientWidth,a.clientHeight);n.parent(a),r.pixelDensity(1),n.drop(m=>{let h=r.millis();l<h-400?(c=!1,e.length=0,e.push(m)):(c=!0,e.push(m)),l=h,clearTimeout(s),s=setTimeout((0,_.Z)(function*(){if(c)o.MultipleDrops(e);else{let x=yield o.loadingCtrl.create({message:o.lang.text.TodoDetail.WIP});x.present(),o.importSelected(m.file),x.dismiss()}}),400)})};let s,c=!1,l=0,e=[];r.mouseMoved=n=>{n.dataTransfer?(a.style.pointerEvents="all",a.style.backgroundColor="#0008"):(a.style.pointerEvents="none",a.style.backgroundColor="transparent")}})}CreateNewFolder(){var a,o=this;this.alertCtrl.create({header:this.lang.text.UserFsDir.CreateFolder,inputs:[{type:"text",placeholder:this.lang.text.UserFsDir.FolderName}],buttons:[{text:this.lang.text.UserFsDir.Create,handler:(a=(0,_.Z)(function*(r){if(r[0])try{let s=`${o.CurrentDir}/${r[0]}`;yield o.indexed.createDirectory(s);let c=yield o.indexed.GetFileInfoFromDB(s),l={path:s,mode:c.mode,timestamp:new Date(c.timestamp).toLocaleString(),db:o.indexed.ionicDB};l.name=r[0],l.dir=o.CurrentDir,o.DirList.push(l)}catch(s){console.error("\ud3f4\ub354 \uc0dd\uc131 \uc2e4\ud328: ",s),o.p5toast.show({text:`${o.lang.text.UserFsDir.FailedToCreateFolder}: ${s}`})}else o.p5toast.show({text:o.lang.text.UserFsDir.NeedFolderName})}),function(s){return a.apply(this,arguments)})}]}).then(a=>a.present())}SelectFiles(){document.getElementById("import_file").click()}MultipleDrops(o){var a=this;return(0,_.Z)(function*(){let r=yield a.loadingCtrl.create({message:a.lang.text.TodoDetail.WIP});r.present();for(let s=0,c=o.length;s<c;s++)yield a.importSelected(o[s].file);r.dismiss()})()}inputFileSelected(o){var a=this;return(0,_.Z)(function*(){if(o.target.files.length)if(1!=o.target.files.length){let s=yield a.loadingCtrl.create({message:a.lang.text.UserFsDir.MultipleSave});s.present(),a.noti.noti.schedule({id:4,title:a.lang.text.UserFsDir.MultipleSave,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://diychat",color:"b0b0b0"});for(let c=0,l=o.target.files.length;c<l;c++)s.message=`${a.lang.text.UserFsDir.MultipleSave}: ${l-c}`,a.noti.noti.schedule({id:4,title:a.lang.text.UserFsDir.MultipleSave,progressBar:{value:c,maxValue:l},sound:null,smallIcon:"res://diychat",color:"b0b0b0"}),yield a.importSelected(o.target.files[c]);a.noti.ClearNoti(4),s.dismiss()}else{let s=yield a.loadingCtrl.create({message:a.lang.text.TodoDetail.WIP});s.present(),yield a.importSelected(o.target.files[0]),s.dismiss()}})()}importSelected(o){var a=this;return(0,_.Z)(function*(){try{let r=`${a.CurrentDir}/${o.name}`;yield a.indexed.saveBlobToUserPath(o,r);let s=yield a.indexed.GetFileInfoFromDB(r),c={path:r,mode:s.mode,timestamp:new Date(s.timestamp).toLocaleString(),db:a.indexed.ionicDB};c.name=o.name,c.dir=a.CurrentDir,c.file_ext=c.name.split(".").pop(),a.global.set_viewer_category_from_ext(c),"image"==c.viewer&&a.indexed.loadBlobFromUserPath(c.path,"",l=>{let e=URL.createObjectURL(l);c.thumbnail=a.sanitizer.bypassSecurityTrustUrl(e)});try{let l=c.path.split("/");if(5!=l.length||"groups"!=l[3])throw"\uadf8\ub8f9 \uc774\ubbf8\uc9c0 \ud30c\uc77c\uc774 \uc544\ub2d8";a.SetDisplayGroupImageName(c,l)}catch{}for(let l=0,e=a.FileList.length;l<e;l++)if(a.FileList[l].path==r){a.FileList.splice(l,1);break}a.FileList.push(c)}catch{}})()}ionViewWillEnter(){this.HideThumbnail="1"==localStorage.getItem("user-fs-thumbnail"),this.CurrentDir="",this.is_file_selector=!!this.navParams.data.modal,this.LoadAllIndexedFiles(),("DesktopPWA"==w.n$||"MobilePWA"==w.n$)&&(this.cant_dedicated=!0),document.addEventListener("ionBackButton",this.EventListenerAct)}dismiss_page(o){var a=this;return(0,_.Z)(function*(){if(a.is_file_selector){let r;o&&(r=yield a.indexed.loadBlobFromUserPath(o.path,""),r.name=o.name,r.file_ext=o.file_ext,r.user_fs=!0),a.modalCtrl.dismiss(r)}})()}LoadAllIndexedFiles(){var o=this;return(0,_.Z)(function*(){if(o.initLoadingElement=yield o.loadingCtrl.create({message:o.lang.text.UserFsDir.LoadingExplorer}),o.initLoadingElement.present(),o.DirList.length=0,o.FileList.length=0,("Android"==w.n$||"iOS"==w.n$)&&o.noti.noti.schedule({id:5,title:o.lang.text.UserFsDir.LoadingExplorer,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"}),o.is_file_selector)if(o.navParams.get("path")){let a=yield o.indexed.GetFileListFromDB(o.navParams.get("path"));yield o.ModulateIndexedFile(a)}else{let a=yield o.indexed.GetFileListFromDB("/files/"),r=yield o.indexed.GetFileListFromDB("/todo/");a.push.apply(a,r),yield o.ModulateIndexedFile(a)}else{if(o.indexed.godotDB){let r=yield o.indexed.GetFileListFromDB("/",void 0,o.indexed.godotDB);yield o.ModulateIndexedFile(r,o.indexed.godotDB)}let a=yield o.indexed.GetFileListFromDB("/");yield o.ModulateIndexedFile(a)}o.FileList.sort((a,r)=>a.path>r.path?1:a.path<r.path?-1:0),o.DirList.sort((a,r)=>a.path>r.path?1:a.path<r.path?-1:0),setTimeout(()=>{o.noti.ClearNoti(5)},100),o.initLoadingElement.dismiss(),o.is_ready=!0})()}ModulateIndexedFile(o,a=this.indexed.ionicDB){var r=this;return(0,_.Z)(function*(){for(let s=0,c=o.length;s<c;s++){if(r.StopIndexing)return;let l=`${r.lang.text.UserFsDir.LoadingExplorer}: ${o.length-s}`;("Android"==w.n$||"iOS"==w.n$)&&r.noti.noti.schedule({id:5,title:l,progressBar:{value:s,maxValue:o.length},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"}),r.initLoadingElement.message=l,yield r.indexed.GetFileInfoFromDB(o[s],e=>{let n={path:o[s],mode:e.mode,timestamp:new Date(e.timestamp).toLocaleString(),db:a};switch(n.name=n.path.substring(n.path.lastIndexOf("/")+1),n.dir=o[s].substring(0,o[s].lastIndexOf("/")),n.mode){case 33206:n.file_ext=n.name.split(".").pop(),r.global.set_viewer_category_from_ext(n),"image"==n.viewer&&r.indexed.loadBlobFromUserPath(n.path,"",x=>{let g=URL.createObjectURL(x);n.thumbnail=r.sanitizer.bypassSecurityTrustUrl(g)},a);try{let x=n.path.split("/");if(5!=x.length||"groups"!=x[3])throw"\uadf8\ub8f9 \uc774\ubbf8\uc9c0 \ud30c\uc77c\uc774 \uc544\ub2d8";r.SetDisplayGroupImageName(n,x)}catch{}r.FileList.push(n);break;case 16893:0==n.path.indexOf("todo/")&&r.SetDisplayTodoName(n);let m=!1,h=n.path.split("/");try{if(5!=h.length||"channels"!=h[3])throw"\ucc44\ub110 \ud3f4\ub354\uac00 \uc544\ub2d8";r.SetDisplayChannelName(n,h),m=!0}catch{}try{if(m||5!=h.length||"users"!=h[3])throw"\uc0ac\uc6a9\uc790 \ud3f4\ub354\uac00 \uc544\ub2d8";r.SetDisplayUserName(n,h),m=!0}catch{}r.DirList.push(n);break;default:console.log("\uc608\uc0c1\ud558\uc9c0 \ubabb\ud55c \ud30c\uc77c \ubaa8\ub4dc: ",n)}},a)}})()}SetDisplayTodoName(o){var a=this;return(0,_.Z)(function*(){try{let r=yield a.indexed.loadTextFromUserPath(`${o.path}/info.todo`),s=JSON.parse(r);o.name=s.title}catch(r){console.error("SetDisplayTodoName error: ",r)}})()}SetDisplayUserName(o,a){try{o.name=this.nakama.users[a[1]][a[2]][a[4]].display_name}catch(r){console.error("SetDisplayUserName error: ",r)}}SetDisplayChannelName(o,a){try{o.name=this.nakama.channels_orig[a[1]][a[2]][o.name].title}catch(r){console.error("SetDisplayChannelName error: ",r)}}SetDisplayGroupImageName(o,a){try{o.name=`${this.nakama.groups[a[1]][a[2]][a[4].split(".").shift()].name}.img`}catch(r){console.error("SetDisplayGroupImageName error: ",r)}}MoveToUpDir(){this.CurrentDir=this.CurrentDir.substring(0,this.CurrentDir.lastIndexOf("/")),this.FileSel.value=void 0}SelectFolder(o){this.CurrentDir=o.path,this.FileSel.value=void 0}OpenFile(o){if(!this.CheckIfAccessable(o.path))return;document.removeEventListener("ionBackButton",this.EventListenerAct);let a=[];if(this.is_file_selector){if(this.navParams.data.path)for(let r=0,s=this.FileList.length;r<s;r++)a.push({content:this.FileList[r]})}else for(let r=0,s=this.FileList.length;r<s;r++)this.FileList[r].dir==this.CurrentDir&&a.push({content:this.FileList[r]});this.modalCtrl.create({component:y.B,componentProps:{info:{content:{filename:o.name,file_ext:o.file_ext,type:"",viewer:o.viewer,path:o.path}},targetDB:this.indexed.ionicDB,no_edit:!0,path:o.path,relevance:a},cssClass:"fullscreen"}).then(r=>{delete this.global.p5key.KeyShortCut.Escape,delete this.global.p5key.KeyShortCut.Digit,r.onDidDismiss().then(s=>{document.addEventListener("ionBackButton",this.EventListenerAct),this.ionViewDidEnter()}),r.present()})}CheckIfAccessable(o){switch(o){case"servers/webrtc_server.json":case"servers/self/profile.json":return this.p5toast.show({text:this.lang.text.UserFsDir.PrivateAccessDenied}),!1}return!0}DownloadFile(o){this.CheckIfAccessable(o.path)&&this.indexed.DownloadFileFromUserPath(o.path,"",o.name)}ExportDirectoryRecursive(){this.alertCtrl.create({header:this.lang.text.UserFsDir.ExportDirTitle,message:this.lang.text.UserFsDir.ExportDirMsg,buttons:[{text:this.lang.text.UserFsDir.ExportConfirm,handler:()=>{this.ExportDirectoryRecursiveAct()}}]}).then(o=>o.present())}ExportDirectoryRecursiveAct(){var o=this;return(0,_.Z)(function*(){let a=yield o.loadingCtrl.create({message:o.lang.text.UserFsDir.ExportDirTitle});a.present();let r=yield o.indexed.GetFileListFromDB(o.CurrentDir);for(let s=0,c=r.length;s<c;s++){let l=yield o.indexed.GetFileInfoFromDB(r[s]),e=yield o.indexed.loadBlobFromUserPath(r[s],""),n=r[s].lastIndexOf("/"),m=r[s].substring(0,n),h=r[s].substring(n+1);o.isCreateFolderRecursive||(o.isCreateFolderRecursive=!0,yield o.CreateFolderRecursive(m));try{if(16893==l.mode)throw yield o.file.createDir(o.file.externalDataDirectory+m,h,!0),a.message=`${o.lang.text.UserFsDir.ExportDirTitle}: ${h}`,"\uc774\uac70 \ud3f4\ub354\uc784";if(!o.CheckIfAccessable(r[s]))throw"\uc5f4\ub78c \ubd88\uac00 \ud30c\uc77c \uc81c\uc678";a.message=`${o.lang.text.UserFsDir.ExportDirTitle}: ${h}`,yield o.file.writeFile(o.file.externalDataDirectory+m+"/",h,e,{replace:!0})}catch(x){console.error(r[s],": \ud30c\uc77c \uc800\uc7a5 \uc2e4\ud328: ",x)}}o.isCreateFolderRecursive=!1,a.dismiss()})()}CreateFolderRecursive(o){var a=this;return(0,_.Z)(function*(){let r=o.lastIndexOf("/")+1,s=o.substring(0,r),c=o.substring(r);s&&(yield a.CreateFolderRecursive(o.substring(0,r-1)));try{yield a.file.createDir(a.file.externalDataDirectory+s,c,!0)}catch{}})()}BrowseExternalFiles(){var o=this;return(0,_.Z)(function*(){o.ExternalFolder.length=0,o.InAppBrowser=!1,o.ExternalFolder=yield o.file.listDir(o.file.externalApplicationStorageDirectory,"files"),o.ExternalFolder.sort(),o.ExternalFolder.sort((a,r)=>a.isDirectory?-1:1)})()}importFolderMiddleAct(o){var a=this;return(0,_.Z)(function*(){let r=yield a.loadingCtrl.create({message:a.lang.text.UserFsDir.Import});r.present(),yield a.importThisFolder(o,r),a.InAppBrowser=!0,r.dismiss(),a.p5toast.show({text:a.lang.text.UserFsDir.NeedResetToApply})})()}importThisFolder(o,a){var r=this;return(0,_.Z)(function*(){let s=o.nativeURL.substring(0,o.nativeURL.length-1),c=s.lastIndexOf("/"),l=yield r.file.listDir(s.substring(0,c)+"/",s.substring(c+1));for(let e=0,n=l.length;e<n;e++)if(l[e].isDirectory)yield r.importThisFolder(l[e],a);else{let m=l[e].nativeURL.split("org.pjcone.portal/files/")[1];try{let x=(yield J.readFile({path:l[e].nativeURL})).data.replace(/"|\\|=/g,"");yield r.indexed.saveBase64ToUserPath(","+x,decodeURIComponent(m)),a.message=`${r.lang.text.UserFsDir.Import}: ${l[e].name}`}catch(h){console.log("\ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",h),r.p5toast.show({text:`${r.lang.text.UserFsDir.ImportFailed}: ${h}`})}}})()}SelectImportFolder(){this.cant_dedicated?document.getElementById("folder_sel_id").click():this.BrowseExternalFiles()}inputImageSelected(o){var a=this;return(0,_.Z)(function*(){let r=yield a.loadingCtrl.create({message:a.lang.text.UserFsDir.LoadingExplorer});r.present();for(let s=0,c=o.target.files.length;s<c;s++)yield a.indexed.saveBlobToUserPath(o.target.files[s],o.target.files[s].webkitRelativePath);a.LoadAllIndexedFiles(),r.dismiss(),a.p5toast.show({text:a.lang.text.UserFsDir.NeedResetToApply})})()}RemoveDirectoryRecursive(){var a,o=this;this.alertCtrl.create({header:this.CurrentDir.substring(this.CurrentDir.lastIndexOf("/")+1)||this.lang.text.UserFsDir.ResetDB,message:this.lang.text.UserFsDir.RemoveThisFolder,buttons:[{text:this.lang.text.UserFsDir.RemoveApply,handler:(a=(0,_.Z)(function*(){let r=yield o.loadingCtrl.create({message:o.lang.text.UserFsDir.DeleteFile});r.present(),("Android"==w.n$||"iOS"==w.n$)&&o.noti.noti.schedule({id:4,title:o.lang.text.UserFsDir.DeleteFile,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"});let s=yield o.indexed.GetFileListFromDB(o.CurrentDir);for(let c=0,l=s.length;c<l;c++)("Android"==w.n$||"iOS"==w.n$)&&o.noti.noti.schedule({id:5,title:`${o.lang.text.UserFsDir.DeleteFile}: ${l-c}`,progressBar:{value:c,maxValue:l},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"}),r.message=`${o.lang.text.UserFsDir.DeleteFile}: ${l-c}`,yield o.indexed.removeFileFromUserPath(s[c]);for(let c=o.DirList.length-1;c>=0;c--)0==o.DirList[c].path.indexOf(o.CurrentDir)&&o.DirList.splice(c,1);for(let c=o.FileList.length-1;c>=0;c--)0==o.FileList[c].path.indexOf(o.CurrentDir)&&o.FileList.splice(c,1);s=yield o.indexed.GetFileListFromDB(o.CurrentDir);for(let c=0,l=s.length;c<l;c++)("Android"==w.n$||"iOS"==w.n$)&&o.noti.noti.schedule({id:5,title:`${o.lang.text.UserFsDir.DeleteFile}: ${l-c}`,progressBar:{value:c,maxValue:l},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"}),r.message=`${o.lang.text.UserFsDir.DeleteFile}: ${l-c}`,yield o.indexed.removeFileFromUserPath(s[c]);for(let c=o.DirList.length-1;c>=0;c--)0==o.DirList[c].path.indexOf(o.CurrentDir)&&o.DirList.splice(c,1);for(let c=o.FileList.length-1;c>=0;c--)0==o.FileList[c].path.indexOf(o.CurrentDir)&&o.FileList.splice(c,1);o.MoveToUpDir(),r.dismiss(),setTimeout(()=>{o.noti.ClearNoti(4)},100)}),function(){return a.apply(this,arguments)}),cssClass:"red_font"}]}).then(a=>a.present())}RemoveFile(o,a){this.alertCtrl.create({header:this.lang.text.UserFsDir.DeleteFile,message:this.lang.text.UserFsDir.CannotBeUndo,buttons:[{text:this.lang.text.UserFsDir.DeleteAccept,handler:()=>{this.indexed.removeFileFromUserPath(o.path,()=>{this.FileList.splice(a,1)})},cssClass:"red_font"}]}).then(r=>r.present())}ionViewDidLeave(){this.StopIndexing=!0,this.FileList.forEach(o=>{URL.revokeObjectURL(o.thumbnail)}),this.noti.ClearNoti(4),this.noti.ClearNoti(5)}ionViewWillLeave(){document.removeEventListener("ionBackButton",this.EventListenerAct),delete this.global.p5key.KeyShortCut.Escape,delete this.global.p5key.KeyShortCut.Digit}}return(f=F).\u0275fac=function(o){return new(o||f)(i.Y36(C.IN),i.Y36(G.H),i.Y36(C.HT),i.Y36(O.b),i.Y36(L.AN),i.Y36(T.F),i.Y36(C.Br),i.Y36(Z.H7),i.Y36(N.$),i.Y36(C.SH),i.Y36(R.J),i.Y36(C.X1),i.Y36(B.a))},f.\u0275cmp=i.Xpm({type:f,selectors:[["app-user-fs-dir"]],viewQuery:function(o,a){if(1&o&&i.Gf(z,5),2&o){let r;i.iGM(r=i.CRH())&&(a.FileSel=r.first)}},decls:13,vars:5,consts:[[1,"ion-no-border"],["slot","start",3,"click"],["defaultHref",""],["class","top_icon","slot","end","name","eye-outline",3,"click",4,"ngIf"],["class","top_icon","slot","end","name","eye-off-outline",3,"click",4,"ngIf"],["id","p5Drop_userfs",2,"position","absolute","width","100%","height","100%","display","flex","pointer-events","none"],["hidden","","type","file","id","import_file","accept","*","multiple","",3,"change"],[4,"ngIf"],["slot","end","name","eye-outline",1,"top_icon",3,"click"],["slot","end","name","eye-off-outline",1,"top_icon",3,"click"],["button",""],["slot","start","name","folder"],["class","folder_button",3,"click",4,"ngIf"],[1,"folder_button",3,"click"],[3,"click"],["button","",3,"click",4,"ngIf"],[4,"ngFor","ngForOf"],["FileSel",""],["button","",3,"click"],["slot","start","name","arrow-down-circle"],["hidden","","type","file","id","folder_sel_id","webkitdirectory","",3,"change"],[3,"value",4,"ngIf"],[3,"value"],["slot","header"],["slot","start","name","image",4,"ngIf"],["slot","start","name","musical-notes",4,"ngIf"],["slot","start","name","play-circle",4,"ngIf"],["slot","start","name","reader",4,"ngIf"],["slot","start","name","extension-puzzle",4,"ngIf"],["slot","start","name","document",4,"ngIf"],["text-wrap","",4,"ngIf"],[1,"ion-accordion-toggle-icon","hide_accordion_icon"],["slot","content"],["class","ion-text-right button_dist",3,"click",4,"ngIf"],[1,"ion-text-end","button_dist",3,"click"],["class","image_front_form",3,"click",4,"ngIf"],[1,"ion-text-end"],["slot","start","name","image"],["slot","start","name","musical-notes"],["slot","start","name","play-circle"],["slot","start","name","reader"],["slot","start","name","extension-puzzle"],["slot","start","name","document"],["text-wrap",""],[1,"ion-text-right","button_dist",3,"click"],[1,"image_front_form",3,"click"],[1,"image_front_view",3,"src","alt"],["color","medium"],["button","","disabled","",4,"ngIf"],["button","","disabled",""]],template:function(o,a){1&o&&(i.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),i._uU(3),i.qZA(),i.TgZ(4,"ion-buttons",1),i.NdJ("click",function(){return a.dismiss_page()}),i._UZ(5,"ion-back-button",2),i.qZA(),i.YNc(6,X,1,0,"ion-icon",3),i.YNc(7,ee,1,0,"ion-icon",4),i.qZA()(),i.TgZ(8,"ion-content")(9,"div",5)(10,"input",6),i.NdJ("change",function(s){return a.inputFileSelected(s)}),i.qZA()(),i.YNc(11,Fe,19,8,"ion-list",7),i.YNc(12,De,6,1,"ion-list",7),i.qZA()),2&o&&(i.xp6(3),i.Oqu(a.lang.text.Settings.InAppExplorer),i.xp6(3),i.Q6J("ngIf",!a.HideThumbnail),i.xp6(1),i.Q6J("ngIf",a.HideThumbnail),i.xp6(4),i.Q6J("ngIf",a.InAppBrowser),i.xp6(1),i.Q6J("ngIf",!a.InAppBrowser))},dependencies:[$.sg,$.O5,C.We,C.eh,C.oU,C.YG,C.Sm,C.W2,C.Gu,C.gu,C.Ie,C.Q$,C.q_,C.wd,C.sr,C.cs],styles:[".item.sc-ion-label-md-h[_ngcontent-%COMP%], .item[_ngcontent-%COMP%]   .sc-ion-label-md-h[_ngcontent-%COMP%]{overflow:unset}.image_front_form[_ngcontent-%COMP%]{text-align:center}.image_front_view[_ngcontent-%COMP%]{max-height:233px}.top_icon[_ngcontent-%COMP%]{width:28px;height:28px;padding-right:28px;cursor:pointer}.button_dist[_ngcontent-%COMP%]{padding-left:2px}.folder_button[_ngcontent-%COMP%]{padding-right:4px}"]}),F})()}}]);