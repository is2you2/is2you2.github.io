"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4048],{4048:(W,M,m)=>{m.r(M),m.d(M,{CommunityPageModule:()=>c});var T=m(1368),G=m(4716),b=m(5624),E=m(3332),k=m(1528),D=m(340),n=m(416),x=m(4428),t=m(4496),S=m(4180),U=m(7136),A=m(4500),$=m(5020),L=m(9240),j=m(4668);function K(a,g){if(1&a&&t.wR5(0,"img",18),2&a){const d=t.GaO().$implicit;t.m_g(d.isNSFW?"filter: blur(16px);":""),t.E7m("src",d.mainImage.thumbnail,t.K6U)}}function B(a,g){if(1&a&&(t.I0R(0,"span",19),t.OEk(1),t.C$Y()),2&a){const d=t.GaO().$implicit,o=t.GaO(2);t.yG2(),t.oRS(" ","("+(d.server?d.server.name||d.server.target:o.lang.text.AddGroup.UseLocalStorage)+")"," ")}}function V(a,g){if(1&a){const d=t.KQA();t.I0R(0,"ion-card",11),t.qCj("click",function(){const i=t.usT(d),l=i.$implicit,s=i.index,_=t.GaO(2);return t.CGJ(_.open_post(l,s))}),t.yuY(1,K,1,3,"img",12),t.I0R(2,"ion-card-header")(3,"ion-card-subtitle",13)(4,"span",14),t.qCj("click",function(){const l=t.usT(d).$implicit,s=t.GaO(2);return t.CGJ(s.open_profile(l))}),t.OEk(5),t.C$Y(),t.yuY(6,B,2,1,"span",15),t.C$Y(),t.I0R(7,"ion-card-title",16),t.OEk(8),t.C$Y()(),t.I0R(9,"ion-card-content",17),t.OEk(10),t.C$Y()()}if(2&a){const d=g.$implicit,o=t.GaO(2);t.E7m("id",d.id),t.yG2(),t.E7m("ngIf",d.mainImage),t.yG2(3),t.m_g("color: #"+d.UserColor),t.yG2(),t.oRS(" ",d.creator_name," "),t.yG2(),t.E7m("ngIf",o.nakama.showServer),t.yG2(2),t.cNF(d.title),t.yG2(2),t.oRS(" ",d.content," ")}}function Y(a,g){1&a&&t.wR5(0,"div",20)}function F(a,g){if(1&a&&(t.I0R(0,"div",8),t.yuY(1,V,11,8,"ion-card",9)(2,Y,1,0,"div",10),t.C$Y()),2&a){const d=t.GaO();t.yG2(),t.E7m("ngForOf",d.nakama.posts),t.yG2(),t.E7m("ngIf",d.is_auto_load_end&&d.is_loadable)}}function C(a,g){if(1&a){const d=t.KQA();t.I0R(0,"div")(1,"div",21),t.qCj("click",function(){t.usT(d);const i=t.GaO();return t.CGJ(i.add_post())}),t.wR5(2,"ion-icon",22),t.I0R(3,"div")(4,"ion-label",23),t.OEk(5),t.C$Y()()()()}if(2&a){const d=t.GaO();t.yG2(5),t.cNF(d.lang.text.Community.NoPosts)}}const v=[{path:"",component:(()=>{var a;class g{constructor(o,i,l,s,_,h,y){this.statusBar=o,this.nakama=i,this.lang=l,this.global=s,this.navCtrl=_,this.indexed=h,this.modalCtrl=y,this.is_loadable=!0,this.is_auto_load_end=!1,this.isOpenProfile=!1}ngOnInit(){this.nakama.is_post_lock=!0,this.nakama.CommunityGoToEditPost=this.add_post}add_post(o){this.navCtrl.navigateForward("portal/community/add-post",{state:{data:o,act:!0}})}ionViewDidEnter(){var o=this;return(0,k.c)(function*(){o.is_loadable=!0,yield o.nakama.load_posts_counter(),o.nakama.has_new_post=!1,yield o.load_post_cycles(),o.is_auto_load_end=!0,o.try_add_shortcut(),o.ContentDiv&&o.ContentScroll&&o.ContentDiv.clientHeight-(o.ContentScroll.scrollTop+o.ContentScroll.clientHeight)<1&&o.load_post_cycles()})()}load_post_cycles(){var o=this;return(0,k.c)(function*(){o.is_loadable&&(yield o.load_posts()),setTimeout(()=>{o.ContentDiv||(o.ContentDiv=document.getElementById("CommunityMainContent")),o.ContentScroll||(o.ContentScroll=document.getElementById("CommunityScrollDiv"),o.ContentScroll.onscroll=i=>{o.ContentDiv.clientHeight-(o.ContentScroll.scrollTop+o.ContentScroll.clientHeight)<1&&o.load_post_cycles()}),o.is_loadable&&o.ContentDiv.clientHeight-(o.ContentScroll.scrollTop+o.ContentScroll.clientHeight)<1&&o.load_post_cycles()},100)})()}try_add_shortcut(){this.global.p5key&&this.global.p5key.KeyShortCut?this.AddShortcut():setTimeout(()=>{this.try_add_shortcut()},100)}load_posts(){var o=this;return(0,k.c)(function*(){let i=!1,l=Object.keys(o.nakama.post_counter);for(let s=0,_=l.length;s<_;s++){let h=Object.keys(o.nakama.post_counter[l[s]]);for(let y=0,R=h.length;y<R;y++){let f=Object.keys(o.nakama.post_counter[l[s]][h[y]]);for(let r=0,u=f.length;r<u;r++){let p="me"==f[r];try{"me"!=f[r]&&(p=f[r]==o.nakama.servers[l[s]][h[y]].session.user_id)}catch{}let P=o.nakama.post_counter[l[s]][h[y]][f[r]];yield o.load_post_step_by_step(P,l[s],h[y],f[r],p),!i&&o.nakama.post_counter[l[s]][h[y]][f[r]]>=0&&(i=!0)}}}o.is_loadable=i,o.nakama.rearrange_posts()})()}load_post_step_by_step(o,i,l,s,_){var h=this;return(0,k.c)(function*(){if(o<0)return;let y=yield h.nakama.load_local_post_with_id(`LocalPost_${o}`,i,l,s);if(!y&&"me"!=s)try{y=yield h.load_server_post_with_id(`ServerPost_${o}`,i,l,s,_)}catch{}h.nakama.post_counter[i][l][s]--,y||(yield h.load_post_step_by_step(h.nakama.post_counter[i][l][s],i,l,s,_))})()}load_server_post_with_id(o,i,l,s,_){var h=this;return(0,k.c)(function*(){try{let y={path:`servers/${i}/${l}/posts/${s}/${o}/info.json`,type:"text/plain"},R=yield h.nakama.sync_load_file(y,i,l,"server_post",s,o,!1),f=yield R.value.text(),r=JSON.parse(f);_&&(r.is_me=!0);let u=new Blob([JSON.stringify(r)],{type:"text/plain"});if(h.indexed.saveBlobToUserPath(u,y.path),r.server={name:h.nakama.servers[i][l].info.name,isOfficial:i,target:l},r.mainImage)if(r.mainImage.url)r.mainImage.thumbnail=r.mainImage.url;else{let p={path:`servers/${i}/${l}/posts/${s}/${o}/mainImage.png`,type:"image/png"},P=(yield h.nakama.sync_load_file(p,i,l,"server_post",s,`${o}_mainImage`,!1)).value;r.mainImage.blob=P;let I=URL.createObjectURL(P);r.mainImage.thumbnail=I,setTimeout(()=>{URL.revokeObjectURL(I)},100)}if(h.nakama.posts_orig[i][l]||(h.nakama.posts_orig[i][l]={}),h.nakama.posts_orig[i][l][s]||(h.nakama.posts_orig[i][l][s]={}),h.nakama.posts_orig[i][l][s][o]=r,"local"==R.from)try{if(!(yield h.nakama.servers[i][l].client.readStorageObjects(h.nakama.servers[i][l].session,{object_ids:[{collection:"server_post",key:o,user_id:s}]})).objects.length)throw"Not RemoteExist"}catch(p){if("Not RemoteExist"==p)throw"RemoveSelf"}return!0}catch(y){return"RemoveSelf"==y&&h.nakama.RemovePost(h.nakama.posts_orig[i][l][s][o],!0),!1}})()}open_profile(o){if(this.isOpenProfile=!0,"me"==o.creator_id)this.modalCtrl.create({component:D.w}).then(i=>i.present());else{let i=o.server.isOfficial,l=o.server.target,s=o.creator_id;o.is_me?this.modalCtrl.create({component:D.w,componentProps:{isOfficial:i,target:l}}).then(_=>_.present()):this.modalCtrl.create({component:x.y,componentProps:{info:{user:this.nakama.load_other_user(s,i,l)},group:{server:{isOfficial:i,target:l}}}}).then(_=>_.present())}setTimeout(()=>{this.isOpenProfile=!1},0)}open_post(o,i){this.isOpenProfile||(this.isOpenProfile=!0,this.modalCtrl.create({component:n.S,componentProps:{data:o,index:i+1}}).then(l=>{delete this.global.p5key.KeyShortCut.Digit,delete this.global.p5key.KeyShortCut.AddAct,l.onDidDismiss().then(s=>{s.data||this.AddShortcut()}),l.present()}),setTimeout(()=>{this.isOpenProfile=!1},0))}AddShortcut(){this.global.p5key&&this.global.p5key.KeyShortCut&&(this.global.p5key.KeyShortCut.Digit=o=>{this.nakama.posts.length>o?this.open_post(this.nakama.posts[o],o):this.add_post()}),this.global.p5key&&this.global.p5key.KeyShortCut&&!this.global.p5key.KeyShortCut.AddAct&&(this.global.p5key.KeyShortCut.AddAct=()=>{this.add_post()})}ionViewWillLeave(){delete this.global.p5key.KeyShortCut.Digit,delete this.global.p5key.KeyShortCut.AddAct,this.nakama.is_post_lock=!1}}return(a=g).\u0275fac=function(o){return new(o||a)(t.GI1(S.Y),t.GI1(U.h),t.GI1(A.o),t.GI1($.A1),t.GI1(L.wX),t.GI1(j.k),t.GI1(b.qS))},a.\u0275cmp=t.In1({type:a,selectors:[["app-community"]],decls:12,vars:5,consts:[[1,"ion-no-border"],[1,"add_post",3,"click"],["button","","name","add-circle-outline",2,"width","24px","height","24px"],[1,"header_online_circle",3,"click"],["id","CommunityScrollDiv",2,"height","100%","overflow-y","auto"],["id","CommunityMainContent"],["style","display: ruby-text","class","CardContainerDiv",4,"ngIf"],[4,"ngIf"],[1,"CardContainerDiv",2,"display","ruby-text"],["button","","class","card_style",3,"id","click",4,"ngFor","ngForOf"],["style","width:100%; height: 72px;",4,"ngIf"],["button","",1,"card_style",3,"id","click"],["class","thumbnail_image","alt","",3,"src","style",4,"ngIf"],[1,"cardCreator"],[3,"click"],["style","color: #888; font-weight: normal;",4,"ngIf"],[1,"cardTitle"],[1,"cardContent"],["alt","",1,"thumbnail_image",3,"src"],[2,"color","#888","font-weight","normal"],[2,"width","100%","height","72px"],[1,"disconnect_info",3,"click"],["color","medium","name","document-text-outline",2,"width","60px","height","60px"],["color","medium"]],template:function(o,i){1&o&&(t.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),t.OEk(3),t.C$Y(),t.I0R(4,"div",1),t.qCj("click",function(){return i.add_post()}),t.wR5(5,"ion-icon",2),t.C$Y(),t.I0R(6,"div",3),t.qCj("click",function(){return i.nakama.toggle_all_session(!0)}),t.C$Y()()(),t.I0R(7,"ion-content")(8,"div",4)(9,"div",5),t.yuY(10,F,3,2,"div",6)(11,C,6,1,"div",7),t.C$Y()()()),2&o&&(t.yG2(3),t.cNF(i.lang.text.Community.Title),t.yG2(3),t.m_g("background-color: "+i.statusBar.colors[i.statusBar.settings.groupServer]+"; cursor: pointer;"),t.yG2(4),t.E7m("ngIf",i.nakama.posts.length),t.yG2(),t.E7m("ngIf",!i.nakama.posts.length))},dependencies:[T.ay,T.u_,b.KC,b.Gg,b.YY,b.MN,b.I7,b._i,b.wB,b.Ko,b.QR,b.tM,b.Md],styles:[".md[_ngcontent-%COMP%]   .add_post[_ngcontent-%COMP%]{position:absolute;right:68px;top:16px;cursor:pointer}.ios[_ngcontent-%COMP%]   .add_post[_ngcontent-%COMP%]{position:absolute;right:68px;top:10px;cursor:pointer}.md[_ngcontent-%COMP%]   .CardContainerDiv[_ngcontent-%COMP%]{padding-top:14px}.ios[_ngcontent-%COMP%]   .CardContainerDiv[_ngcontent-%COMP%]{padding-top:20px}.card_style[_ngcontent-%COMP%]{width:90%;max-width:400px;margin-top:0}.md[_ngcontent-%COMP%]   .cardCreator[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;font-weight:700;max-height:20px;overflow-y:hidden}.md[_ngcontent-%COMP%]   .cardTitle[_ngcontent-%COMP%]{max-height:24px;overflow-y:hidden}.md[_ngcontent-%COMP%]   .cardContent[_ngcontent-%COMP%]{max-height:40px;overflow-y:hidden;padding-bottom:0;margin-bottom:13px}.ios[_ngcontent-%COMP%]   .cardCreator[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;font-weight:700;max-height:20px;overflow-y:hidden}.ios[_ngcontent-%COMP%]   .cardTitle[_ngcontent-%COMP%]{max-height:34px;overflow-y:hidden}.ios[_ngcontent-%COMP%]   .cardContent[_ngcontent-%COMP%]{max-height:40px;overflow-y:hidden;padding-bottom:0;margin-bottom:13px}.thumbnail_image[_ngcontent-%COMP%]{width:100%;max-height:240px;object-fit:cover}"]}),g})()},{path:"add-post",loadChildren:()=>Promise.all([m.e(1052),m.e(1592)]).then(m.bind(m,1592)).then(a=>a.AddPostPageModule)},{path:"post-viewer",loadChildren:()=>m.e(9368).then(m.bind(m,9368)).then(a=>a.PostViewerPageModule)}];let e=(()=>{var a;class g{}return(a=g).\u0275fac=function(o){return new(o||a)},a.\u0275mod=t.a4G({type:a}),a.\u0275inj=t.s3X({imports:[E.qQ.forChild(v),E.qQ]}),g})(),c=(()=>{var a;class g{}return(a=g).\u0275fac=function(o){return new(o||a)},a.\u0275mod=t.a4G({type:a}),a.\u0275inj=t.s3X({imports:[T.MD,G.y,b.wZ,e]}),g})()},416:(W,M,m)=>{m.d(M,{S:()=>F});var T=m(1528),G=m(9352),E=m(8744),k=m(340),D=m(4428),n=m(4496),x=m(5624),t=m(9240),S=m(4500),U=m(4668),A=m(7136),$=m(5020),L=m(1368);function j(C,O){if(1&C){const v=n.KQA();n.I0R(0,"ion-icon",10),n.qCj("click",function(){n.usT(v);const c=n.GaO();return n.CGJ(c.ChangeToAnother(-1))}),n.C$Y()}}function K(C,O){if(1&C&&(n.I0R(0,"ion-label",11),n.OEk(1),n.C$Y()),2&C){const v=n.GaO();n.yG2(),n.cNF(v.CurrentIndex+" / "+v.nakama.posts.length)}}function B(C,O){if(1&C){const v=n.KQA();n.I0R(0,"ion-icon",12),n.qCj("click",function(){n.usT(v);const c=n.GaO();return n.CGJ(c.ChangeToAnother(1))}),n.C$Y()}}function V(C,O){if(1&C&&n.wR5(0,"img",13),2&C){const v=n.GaO();n.E7m("src",v.PostInfo.mainImage.MainThumbnail,n.K6U)}}function Y(C,O){if(1&C){const v=n.KQA();n.I0R(0,"ion-footer")(1,"table",14)(2,"tr")(3,"td")(4,"ion-button",15),n.qCj("click",function(){n.usT(v);const c=n.GaO();return n.CGJ(c.EditPost())}),n.OEk(5),n.C$Y()(),n.I0R(6,"td")(7,"ion-button",16),n.qCj("click",function(){n.usT(v);const c=n.GaO();return n.CGJ(c.RemovePost())}),n.OEk(8),n.C$Y()()()()()}if(2&C){const v=n.GaO();n.yG2(5),n.oRS(" ",v.lang.text.AddPost.EditTitle," "),n.yG2(3),n.oRS(" ",v.lang.text.PostViewer.RemovePost," ")}}let F=(()=>{var C;class O{constructor(e,c,a,g,d,o,i){this.modalCtrl=e,this.navParam=c,this.lang=a,this.indexed=g,this.nakama=d,this.alertCtrl=o,this.global=i,this.isOwner=!1,this.HavePosts=!1,this.CurrentIndex=1,this.ContentChanging=!1}ngOnInit(){this.PostInfo=this.navParam.get("data"),this.CurrentIndex=this.navParam.get("index"),this.initialize()}ChangeContentWithKeyInput(){if(this.p5canvas){this.p5canvas.keyPressed=g=>{switch(g.code){case"KeyA":case"ArrowLeft":this.ChangeToAnother(-1);break;case"KeyD":case"ArrowRight":this.ChangeToAnother(1)}};let e=this.p5canvas.createVector(),c={};this.p5canvas.touchStarted=g=>{if("changedTouches"in g){for(let o=0,i=g.changedTouches.length;o<i;o++)c[g.changedTouches[o].identifier]=this.p5canvas.createVector(g.changedTouches[o].clientX,g.changedTouches[o].clientY);1===Object.keys(c).length&&(e=c[g.changedTouches[0].identifier].copy())}};const a=50;this.p5canvas.touchEnded=g=>{if("changedTouches"in g){let d;for(let i=0,l=g.changedTouches.length;i<l;i++)d=this.p5canvas.createVector(g.changedTouches[i].clientX,g.changedTouches[i].clientY),delete c[g.changedTouches[i].identifier];0===Object.keys(c).length&&(d.sub(e),d.x>a?this.ChangeToAnother(-1):d.x<-a&&this.ChangeToAnother(1))}}}}initialize(){if(this.PostInfo.mainImage){let e=this.PostInfo.mainImage.url;e||(e=URL.createObjectURL(this.PostInfo.mainImage.blob),setTimeout(()=>{URL.revokeObjectURL(e)},100)),this.PostInfo.mainImage.MainThumbnail=e}this.create_content(),this.isOwner="me"==this.PostInfo.creator_id||this.PostInfo.creator_id==this.nakama.servers[this.PostInfo.server.isOfficial][this.PostInfo.server.target].session.user_id,this.HavePosts=this.nakama.posts.length>1,this.ChangeContentWithKeyInput()}ChangeToAnother(e){if(this.ContentChanging)return;this.ContentChanging=!0;let c=this.CurrentIndex+e;c<=0||c>this.nakama.posts.length||(this.p5canvas&&this.p5canvas.remove(),this.CurrentIndex=c,this.PostInfo=this.nakama.posts[this.CurrentIndex-1],this.initialize()),this.ContentChanging=!1}create_content(){var e=this;let c=document.getElementById("PostContent");this.p5canvas=new G(a=>{a.setup=(0,T.c)(function*(){a.noCanvas();let g=a.createDiv(e.PostInfo.title);g.style("font-size","32px"),g.style("font-weight","bold"),g.parent(c);let d=a.createDiv();d.style("color","#888"),d.parent(c),a.createDiv(`${e.lang.text.PostViewer.CreateTime}: ${new Date(e.PostInfo.create_time).toLocaleString()}`).parent(d),e.PostInfo.create_time!=e.PostInfo.modify_time&&a.createDiv(`${e.lang.text.PostViewer.ModifyTime}: ${new Date(e.PostInfo.modify_time).toLocaleString()}`).parent(d);let i=a.createDiv();i.style("padding-bottom","8px"),i.parent(c);let l=a.createSpan(e.PostInfo.creator_name);if(l.style("color",`#${e.PostInfo.UserColor}`),l.style("font-weight","bold"),l.style("font-size","17px"),l.style("cursor","pointer"),l.elt.onclick=()=>{if("me"==e.PostInfo.creator_id)e.modalCtrl.create({component:k.w}).then(s=>s.present());else{let s=e.PostInfo.server.isOfficial,_=e.PostInfo.server.target,h=e.PostInfo.creator_id;h==e.nakama.servers[s][_].session.user_id?e.modalCtrl.create({component:k.w,componentProps:{isOfficial:s,target:_}}).then(y=>y.present()):e.modalCtrl.create({component:D.y,componentProps:{info:{user:e.nakama.load_other_user(h,s,_)},group:{server:{isOfficial:s,target:_}}}}).then(y=>y.present())}},l.parent(i),e.PostInfo.server.local)for(let s=0,_=e.PostInfo.attachments.length;s<_;s++){let h=yield e.indexed.loadBlobFromUserPath(e.PostInfo.attachments[s].path,e.PostInfo.attachments[s].type);e.PostInfo.attachments[s].blob=h}else for(let s=0,_=e.PostInfo.attachments.length;s<_;s++)try{let h=yield e.nakama.sync_load_file(e.PostInfo.attachments[s],e.PostInfo.server.isOfficial,e.PostInfo.server.target,"server_post",e.PostInfo.creator_id,`${e.PostInfo.id}_attach_${s}`,!1);e.PostInfo.attachments[s].blob=h.value}catch{}if(e.PostInfo.content){let s=e.PostInfo.content.split("\n");for(let _=0,h=s.length;_<h;_++){let y=!1,R=s[_].length-1,f=0;try{f=Number(s[_].substring(1,R)),y="["==s[_].charAt(0)&&"]"==s[_].charAt(R)&&!isNaN(f)}catch{}if(y)switch(e.PostInfo.attachments[f].viewer){case"image":{let r=e.PostInfo.attachments[f].url;if(!r)try{r=URL.createObjectURL(e.PostInfo.attachments[f].blob),setTimeout(()=>{URL.revokeObjectURL(r)},100)}catch(p){console.log("\uac8c\uc2dc\ubb3c image \ucca8\ubd80\ud30c\uc77c \ubd88\ub7ec\uc624\uae30 \uc624\ub958: ",p)}let u=a.createImg(r,`${f}`);u.style("cursor","pointer"),u.elt.onclick=()=>{let p=[];for(let P=0,I=e.PostInfo.attachments.length;P<I;P++)p.push({content:e.PostInfo.attachments[P]});e.modalCtrl.create({component:E.K,componentProps:{info:{content:e.PostInfo.attachments[f]},path:e.PostInfo.attachments[f].path,relevance:p,noEdit:!0},cssClass:"fullscreen"}).then(P=>{P.onDidDismiss().then(I=>{I.data&&I.data.share&&e.modalCtrl.dismiss()}),P.present()})},u.parent(c)}break;case"audio":{let r=e.PostInfo.attachments[f].url;if(!r)try{r=URL.createObjectURL(e.PostInfo.attachments[_].blob),setTimeout(()=>{URL.revokeObjectURL(r)},100)}catch(p){console.log("\uac8c\uc2dc\ubb3c audio \ucca8\ubd80\ud30c\uc77c \ubd88\ub7ec\uc624\uae30 \uc624\ub958: ",p)}let u=a.createAudio([r]);u.showControls(),u.parent(c)}break;case"video":{let r=e.PostInfo.attachments[f].url;if(!r)try{r=URL.createObjectURL(e.PostInfo.attachments[_].blob),setTimeout(()=>{URL.revokeObjectURL(r)},100)}catch(p){console.log("\uac8c\uc2dc\ubb3c video \ucca8\ubd80\ud30c\uc77c \ubd88\ub7ec\uc624\uae30 \uc624\ub958: ",p)}let u=a.createVideo([r]);u.style("width","100%"),u.style("height","auto"),u.showControls(),u.parent(c)}break;case"godot":{let r=`PostViewer_godot_pck_${f}`,u=a.createDiv();u.id(r),u.style("width","100%"),u.style("height","432px"),u.parent(c),setTimeout((0,T.c)(function*(){let p=!1;if(e.indexed.godotDB)try{yield e.indexed.GetGodotIndexedDB(),yield e.indexed.saveBlobToUserPath(e.PostInfo.attachments[_].blob,`tmp_files/duplicate/${e.PostInfo.attachments[f].filename}`,void 0,e.indexed.godotDB),p=!0}catch(P){console.log("\ub0b4\ubd80 \ud30c\uc77c \uc5c6\uc74c: ",P)}if(yield e.global.CreateGodotIFrame(r,{path:`tmp_files/duplicate/${e.PostInfo.attachments[f].filename}`,url:e.PostInfo.attachments[f].url},"start_load_pck",!0),!p){try{let P=yield e.indexed.loadBlobFromUserPath(e.PostInfo.attachments[f].path,"",void 0,e.indexed.ionicDB);yield e.indexed.GetGodotIndexedDB(),yield e.indexed.saveBlobToUserPath(P,`tmp_files/duplicate/${e.PostInfo.attachments[f].filename}`,void 0,e.indexed.godotDB)}catch{}yield e.global.CreateGodotIFrame(r,{path:`tmp_files/duplicate/${e.PostInfo.attachments[f].filename}`,url:e.PostInfo.attachments[f].url},"start_load_pck",!0)}e.PostInfo.attachments[f].url?e.global.godot_window.download_url():e.global.godot_window.start_load_pck()}),100)}break;default:{let r=a.createDiv();r.style("width","160px"),r.style("height","112px"),r.style("overflow","hidden"),r.style("background-color","grey"),r.style("margin-top","4px"),r.style("border-radius","8px"),r.style("cursor","pointer"),r.parent(c);let u=a.createP(e.PostInfo.attachments[f].filename);u.style("margin","0px 4px"),u.style("text-align","start"),u.parent(r);let p=a.createDiv();p.style("background-color","white"),p.style("margin-top","2px"),p.style("position","relative"),p.style("width","100%"),p.style("height","2px"),p.parent(r);let P=a.createSpan(e.lang.text.PostViewer.OpenFromViewer);P.style("margin","2px 4px 0px 4px"),P.style("text-align","start"),P.style("display","grid"),P.parent(r),r.elt.onclick=()=>{let I=[];for(let w=0,N=e.PostInfo.attachments.length;w<N;w++)I.push({content:e.PostInfo.attachments[w]});e.modalCtrl.create({component:E.K,componentProps:{info:{content:e.PostInfo.attachments[f]},path:e.PostInfo.attachments[f].path,relevance:I,noEdit:!0},cssClass:"fullscreen"}).then(w=>w.present())}}}else{let r=a.createDiv();r.parent(c);let u=s[_].split(" ");for(let p=0,P=u.length;p<P;p++)if(0==u[p].indexOf("http:")||0==u[p].indexOf("https:")){let I=a.createA(u[p],u[p]);I.attribute("target","_system"),I.parent(r),a.createSpan("&nbsp").parent(r)}else a.createSpan(u[p]+"&nbsp").parent(r)}}}})})}EditPost(){this.modalCtrl.dismiss({edit:!0}),this.nakama.EditPost(this.PostInfo)}RemovePost(){var c,e=this;this.alertCtrl.create({header:this.lang.text.PostViewer.RemovePost,message:this.lang.text.ChatRoom.CannotUndone,buttons:[{text:this.lang.text.TodoDetail.remove,cssClass:"redfont",handler:(c=(0,T.c)(function*(){yield e.nakama.RemovePost(e.PostInfo),e.modalCtrl.dismiss()}),function(){return c.apply(this,arguments)})}]}).then(c=>c.present())}ionViewDidLeave(){this.p5canvas&&this.p5canvas.remove()}}return(C=O).\u0275fac=function(e){return new(e||C)(n.GI1(x.qS),n.GI1(t.a6),n.GI1(S.o),n.GI1(U.k),n.GI1(A.h),n.GI1(x.iW),n.GI1($.A1))},C.\u0275cmp=n.In1({type:C,selectors:[["app-post-viewer"]],decls:13,vars:8,consts:[[3,"translucent"],["slot","start",3,"click"],["defaultHref",""],["class","relevance_change","style","padding-right: 4px;","slot","end","name","arrow-back-circle-outline",3,"click",4,"ngIf"],["slot","end",4,"ngIf"],["class","relevance_change","style","padding-right: 16px; padding-left: 4px;","slot","end","name","arrow-forward-circle-outline",3,"click",4,"ngIf"],[3,"fullscreen"],["style","width: 100%; height: auto;","alt","MainImage",3,"src",4,"ngIf"],["id","PostContent",2,"padding","16px"],[4,"ngIf"],["slot","end","name","arrow-back-circle-outline",1,"relevance_change",2,"padding-right","4px",3,"click"],["slot","end"],["slot","end","name","arrow-forward-circle-outline",1,"relevance_change",2,"padding-right","16px","padding-left","4px",3,"click"],["alt","MainImage",2,"width","100%","height","auto",3,"src"],[2,"width","100%","background-color","black"],["expand","block",3,"click"],["color","danger","expand","block",3,"click"]],template:function(e,c){1&e&&(n.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),n.OEk(3),n.C$Y(),n.I0R(4,"ion-buttons",1),n.qCj("click",function(){return c.modalCtrl.dismiss()}),n.wR5(5,"ion-back-button",2),n.C$Y(),n.yuY(6,j,1,0,"ion-icon",3)(7,K,2,1,"ion-label",4)(8,B,1,0,"ion-icon",5),n.C$Y()(),n.I0R(9,"ion-content",6),n.yuY(10,V,1,1,"img",7),n.wR5(11,"div",8),n.C$Y(),n.yuY(12,Y,9,2,"ion-footer",9)),2&e&&(n.E7m("translucent",!0),n.yG2(3),n.cNF(c.lang.text.PostViewer.Title),n.yG2(3),n.E7m("ngIf",c.HavePosts),n.yG2(),n.E7m("ngIf",c.HavePosts),n.yG2(),n.E7m("ngIf",c.HavePosts),n.yG2(),n.E7m("fullscreen",!0),n.yG2(),n.E7m("ngIf",c.PostInfo.mainImage&&c.PostInfo.mainImage.MainThumbnail),n.yG2(2),n.E7m("ngIf",c.isOwner))},dependencies:[L.u_,x.sn,x.GS,x._i,x.eV,x.wB,x.Ko,x.QR,x.tM,x.Md,x.Im],styles:[".relevance_change[_ngcontent-%COMP%]{width:25px;height:25px}"]}),O})()}}]);