"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5693],{5693:(me,L,h)=>{h.r(L),h.d(L,{MainPageModule:()=>re});var W=h(6814),_=h(95),M=h(1325),F=h(5877),w=h(5861),O=h(2156),q=h(3641),G=h(9868),s=h(9468),ee=h(6052),te=h(3857),ie=h(9080),oe=h(7488),se=h(797);function le(d,E){if(1&d){const S=s.EpF();s.TgZ(0,"div")(1,"div",4),s.NdJ("click",function(){s.CHM(S);const m=s.oxw();return s.KtG(m.nakama.open_add_todo_page())}),s._UZ(2,"ion-icon",5),s.TgZ(3,"div")(4,"ion-label",6),s._uU(5),s.qZA()()()()}if(2&d){const S=s.oxw();s.xp6(5),s.Oqu(S.lang.text.Main.NoTodo)}}const ne=[{path:"",component:(()=>{var d;class E{constructor(a,m,e,r,n){this.global=a,this.lang=m,this.nakama=e,this.statusBar=r,this.indexed=n,this.isEmptyTodo=!1}ngOnInit(){this.add_admob_banner()}add_admob_banner(){var a=this;return(0,w.Z)(function*(){O.TQ.addListener(O.Wp.SizeChanged,e=>{a.nakama.appMargin=e.height;const r=document.querySelector("ion-router-outlet");0===a.nakama.appMargin?r.style.marginBottom="":a.nakama.appMargin>0&&(r.style.marginBottom=a.nakama.appMargin+"px")});const m={adId:"ca-app-pub-6577630868247944/4829889344",adSize:O.ci.ADAPTIVE_BANNER,position:O.N4.BOTTOM_CENTER};try{if(a.nakama.isBannerShowing=!1,!(yield fetch(`${q.Oy}pjcone_ads/admob.txt`)).ok)throw"\uc900\ube44\ub41c \uad11\uace0\uac00 \uc5c6\uc2b5\ub2c8\ub2e4";O.TQ.showBanner(m).then(()=>{a.nakama.isBannerShowing=!0})}catch(e){console.log(e)}})()}ionViewWillEnter(){var a=this;return(0,w.Z)(function*(){a.global.p5todo?a.global.p5todo.PlayCanvas():a.CreateTodoManager(),a.indexed.GetFileListFromDB("acts_local",m=>{m.forEach(e=>a.indexed.removeFileFromUserPath(e,void 0,a.indexed.godotDB))},a.indexed.godotDB)})()}CreateTodoManager(){var a=this;let m=document.getElementById("todo");this.global.p5todo=new G(e=>{let g,r={},n=[],z=[],j=e.createVector(0,0),f=e.createVector(0,0),v=1,B=e.createVector(0,0),H=this.nakama,de=this.indexed,T=[],P=!1;e.setup=(0,w.Z)(function*(){e.createCanvas(m.clientWidth,m.clientHeight).parent(m),e.smooth(),e.noStroke(),e.pixelDensity(1),e.ellipseMode(e.CENTER),e.rectMode(e.CENTER),e.textAlign(e.CENTER,e.CENTER),e.textSize(20),e.textLeading(32),e.textWrap(e.CHAR),e.imageMode(e.CENTER),Y(),e.StopCanvas=()=>{P=!0,e.noLoop()},e.PlayCanvas=()=>{P=!1,e.windowResized(),e.loop()},e.add_todo=t=>{let i=JSON.parse(t);if(i.done){for(let l=0,c=n.length;l<c;l++)if(r[n[l]].json.id==i.id)return void r[n[l]].DoneAnim()}else r[i.id]=new X(i);e.count_todo()},e.count_todo=()=>{n=Object.keys(r),a.isEmptyTodo=!n.length,a.isEmptyTodo||(r.AddButton?1==n.length&&r.AddButton.DoneAnim():(r.AddButton=new X("",!0),n=Object.keys(r)))},e.remove_todo=t=>{let i=JSON.parse(t);for(let l=0,c=n.length;l<c;l++)if(r[n[l]].json.id==i.id){r[n[l]].RemoveTodo();break}a.isEmptyTodo=!Object.keys(n).length},e.ListUpdate=(0,w.Z)(function*(){r={},n.length=0;let t=yield a.indexed.GetFileListFromDB("todo/",void 0,a.indexed.godotDB);for(let i=0,l=t.length;i<l;i++)if(t[i].indexOf("/info.todo")>=0){let c=yield a.indexed.loadTextFromUserPath(t[i],void 0,a.indexed.godotDB);e.add_todo(c)}a.isEmptyTodo=!Object.keys(n).length}),yield e.ListUpdate()});let Y=()=>{B.x=e.width/2,B.y=e.height/2,f.x=0,f.y=0,v=1};e.draw=()=>{e.clear(255,255,255,255),e.push(),e.translate(B),e.scale(v),e.translate(f);for(let o=0,t=n.length;o<t;o++)r[n[o]].display();for(let o=z.length-1;o>=0;o--)z[o].display(),z[o].lifeTime<0&&z.splice(o,1);e.pop()},e.windowResized=()=>{P||setTimeout(()=>{let o=f.x/e.width,t=f.y/e.height;e.resizeCanvas(m.clientWidth,m.clientHeight),B.x=e.width/2,B.y=e.height/2,f.x=o*e.width,f.y=t*e.height},50)};let I=!0;class X{constructor(t,i=!1){this.isAddButton=!1,this.EllipseSize=96,this.Velocity=e.createVector(0,0),this.Accel=e.createVector(0,0),this.isGrabbed=!1,this.TextColor=e.color(255),this.ProgressWeight=8,this.json=t;let l=e.max(e.width,e.height),c=e.createVector(l/e.min(1,v),0).setHeading(e.random(0,e.PI));if(i)return this.isAddButton=i,this.position=j.copy(),this.defaultColor=e.color("#bbb"),void(this.json={id:"AddButton",written:0,limit:1,longSide:53,shortSide:11});if(this.position=c,!this.json.custom_color)switch(this.json.importance){case"0":this.defaultColor=e.color("#58a192");break;case"1":this.defaultColor=e.color("#ddbb41");break;case"2":this.defaultColor=e.color("#ff754e")}let u=Number(this.json.importance);switch(u){case 0:this.EllipseSize=96;break;case 1:this.EllipseSize=104;break;case 2:this.EllipseSize=112}if(!T[u]){T[u]=e.createImage(this.EllipseSize,this.EllipseSize),T[u].loadPixels();let k=e.createVector(T[u].width/2,T[u].height/2);for(let A=0,Z=T[u].height;A<Z;A++)for(let D=0,he=T[u].width;D<he;D++){let ue=e.createVector(D,A);k.dist(ue)<this.EllipseSize/2-1&&T[u].set(D,A,e.color(255,80))}T[u].updatePixels()}de.loadBlobFromUserPath(`todo/${this.json.id}/thumbnail.png`,"").then(k=>{let A=URL.createObjectURL(k);e.loadImage(A,Z=>{this.ThumbnailImage=Z,this.ThumbnailImage.mask(T[u]),URL.revokeObjectURL(A)})}).catch(k=>{})}display(){e.push(),this.isGrabbed||(this.CalcPosition(),this.OnCollider(),this.position=this.position.add(this.Velocity)),e.translate(this.position);let t=e.map(Date.now(),this.json.startFrom||this.json.written,this.json.limit,0,1,!0);0==t&&(t=1),e.fill((this.json.custom_color||this.defaultColor.toString("#rrggbb"))+e.hex(e.floor(e.lerp(34,180,t)),2)),e.ellipse(0,0,this.EllipseSize,this.EllipseSize),this.ThumbnailImage&&e.image(this.ThumbnailImage,0,0,this.EllipseSize,this.EllipseSize),e.push(),e.noFill(),this.isAddButton?(e.push(),e.noStroke(),e.fill(255),e.rect(0,0,this.json.shortSide,this.json.longSide),e.rect(0,0,this.json.longSide,this.json.shortSide),e.pop()):(e.stroke(this.json.custom_color||this.defaultColor),e.strokeWeight(this.ProgressWeight)),e.rotate(-e.PI/2);let i=this.EllipseSize-this.ProgressWeight;e.arc(0,0,i,i,0,t*e.TWO_PI),e.pop();let l=.9*this.EllipseSize;e.fill(this.TextColor),e.text(this.json.title,0,0,l,l),e.pop()}CalcPosition(){let t=this.position.dist(j),i=e.map(t,0,this.EllipseSize/8,0,1,!0),l=e.map(i,this.EllipseSize/4,0,1,.95,!0);this.Accel.x=i,this.Accel.y=0;let c=this.position.heading()-e.PI;this.Accel=this.Accel.setHeading(c),this.Velocity.add(this.Accel).mult(l)}OnCollider(){for(let t=0,i=n.length;t<i;t++)if(r[n[t]]!=this){let l=r[n[t]],c=this.position.dist(l.position),u=this.EllipseSize/2+l.EllipseSize/2;c<u&&(this.ReflectBounce(l,c/u),l.ReflectBounce(this,c/u))}}ReflectBounce(t,i){let l=G.Vector.sub(this.position,t.position);this.Velocity.add(l.mult(1-i)).mult(.85)}DoneAnim(){var t=this;return(0,w.Z)(function*(){let i=1;const l=k=>new Promise(A=>setTimeout(A,k));let c=t.EllipseSize,u=t.ProgressWeight;for(yield l(500),t.Velocity=j.copy(),t.Accel=j.copy();i>0;)yield l(14),i-=.04,t.EllipseSize=c*i,t.ProgressWeight=u*i,i<.5&&z.push(new J(t.position,t.json.custom_color||t.defaultColor)),t.TextColor=e.color(255,255*i),t.isAddButton&&(t.json.longSide*=i,t.json.shortSide*=i);t.RemoveTodo(),e.count_todo();for(let k=0;k<20;k++)z.push(new J(t.position,t.json.custom_color||t.defaultColor))})()}Clicked(){I&&(this.isAddButton?H.open_add_todo_page():H.open_add_todo_page(JSON.stringify(this.json)))}RemoveTodo(){for(let t=0,i=n.length;t<i;t++)if(n[t]==this.json.id){n.splice(t,1);break}delete r[this.json.id]}}class J{constructor(t,i){this.RectSize=4,this.rotate=0,this.pos=t.copy(),e.randomSeed(e.random(-255,255)),this.lifeTime=e.random(180,255),this.vel=e.createVector(e.random(-75,75),e.random(-40,-80)),this.acc=e.createVector(0,e.random(-1,-3)),e.push(),e.colorMode(e.HSB);let l=e.hue(i),c=e.saturation(i),u=e.brightness(i);this.color=e.color(e.random(l-20,l+20),e.random(c-20,c+20),e.random(u-20,u+20),this.lifeTime/255),e.pop(),this.RectSize=e.random(3,4),this.rotate=e.random(-e.PI,e.PI)}display(){this.color.setAlpha(this.lifeTime/255),e.fill(this.color),this.CalcPhysics(),e.push(),e.translate(this.pos),e.rotate(this.rotate),e.rect(0,0,this.RectSize,this.RectSize),e.pop(),this.lifeTime--}CalcPhysics(){this.acc.y+=.07,this.vel.add(this.acc),this.pos.add(this.vel.copy().div(100))}}let p,b,K,C,N=0;e.mousePressed=o=>{if(!P)switch(I=!0,o.which){case 1:b=e.createVector(e.mouseX,e.mouseY),C=f.copy(),p=e.createVector(e.mouseX,e.mouseY);for(let t=0,i=n.length;t<i;t++)if(r[n[t]].position.dist(x())<r[n[t]].EllipseSize/2){r[n[t]].isGrabbed=!0,g=r[n[t]],b=x();break}break;case 2:Y()}},e.mouseDragged=o=>{if(!P&&1===o.which){p=e.createVector(e.mouseX,e.mouseY);let t=0;g?(g.position=x(),t=b.dist(x())):(f=C.copy().add(p.sub(b).div(v)),t=C.dist(f)),t>15&&(I=!1)}},e.mouseReleased=o=>{P||1!==o.which||(p=void 0,$())};let x=(o,t)=>{let i=e.createVector(o||e.mouseX,t||e.mouseY);return i.sub(B),i.div(v),i.sub(f),i};e.mouseWheel=o=>{P||(ce(x()),v*=o.deltaY<0?1.1:.9)};let ce=o=>{B=e.createVector(e.mouseX,e.mouseY),f=o.mult(-1)},y=[],R=!1;const V=56;e.touchStarted=o=>{if(!P)switch(y=o.touches,R=!0,y.length){case 1:Q();break;case 2:let t=e.createVector(y[0].clientX,y[0].clientY-V),i=e.createVector(y[1].clientX,y[1].clientY-V);N=t.dist(i),b=t.copy().add(i).div(2),C=f.copy(),K=v,g&&(g.isGrabbed=!1,g.Velocity=j.copy(),g.Accel=j.copy(),g=void 0);break;default:R=!1,Y()}},e.touchMoved=o=>{if(!P)switch(y=o.touches,y.length){case 1:{if(!R)return;let i=o.touches[y[0].identifier],l=e.createVector(i.clientX,i.clientY-V),c=0;g?(g.position=x(),c=b.dist(x(l.x,l.y))):(f=C.copy().add(l.sub(b).div(v)),c=C.dist(f)),c>15&&(I=!1)}break;case 2:{if(!R)return;let t=e.createVector(y[0].clientX,y[0].clientY-V),i=e.createVector(y[1].clientX,y[1].clientY-V),l=t.copy().add(i).div(2);v=t.dist(i)/N*K,f=C.copy().add(l.sub(b).div(v))}}},e.touchEnded=o=>{if(!P)switch(y=o.touches,y.length){case 0:$(),R=!1;break;case 1:if(!R)return;Q(),N=0}};let Q=()=>{b=e.createVector(y[0].clientX,y[0].clientY-V),C=f.copy();for(let o=0,t=n.length;o<t;o++)if(r[n[o]].position.dist(x(b.x,b.y))<r[n[o]].EllipseSize/2){r[n[o]].isGrabbed=!0,g=r[n[o]];break}},$=()=>{if(g){let t=g.EllipseSize;g.isGrabbed=!1,g.Velocity=j.copy(),g.Accel=j.copy(),t=g.position.dist(b),g=void 0}if(b=void 0,C.dist(f)<15)for(let t=0,i=n.length;t<i;t++)if(r[n[t]].position.dist(x())<r[n[t]].EllipseSize/2){r[n[t]].Clicked();break}}})}ionViewDidEnter(){this.nakama.resumeBanner(),this.try_add_shortcut()}try_add_shortcut(){this.global.p5key&&this.global.p5key.KeyShortCut?this.global.p5key.KeyShortCut.AddAct=()=>{this.nakama.open_add_todo_page()}:setTimeout(()=>{this.try_add_shortcut()},100)}ionViewWillLeave(){this.global.p5todo.StopCanvas(),delete this.global.p5key.KeyShortCut.AddAct}}return(d=E).\u0275fac=function(a){return new(a||d)(s.Y36(ee.AN),s.Y36(te.b),s.Y36(ie.a),s.Y36(oe.g),s.Y36(se.H))},d.\u0275cmp=s.Xpm({type:d,selectors:[["app-main"]],decls:8,vars:4,consts:[[1,"ion-no-border"],[1,"header_online_circle",3,"click"],[4,"ngIf"],["id","todo",1,"full_screen",2,"display","flex"],[1,"disconnect_info",3,"click"],["color","medium","name","create-outline",2,"width","60px","height","60px"],["color","medium"]],template:function(a,m){1&a&&(s.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),s._uU(3),s.qZA(),s.TgZ(4,"div",1),s.NdJ("click",function(){return m.nakama.toggle_all_session()}),s.qZA()()(),s.TgZ(5,"ion-content"),s.YNc(6,le,6,1,"div",2),s._UZ(7,"div",3),s.qZA()),2&a&&(s.xp6(3),s.Oqu(m.lang.text.Main.Title),s.xp6(1),s.Akn("background-color: "+m.statusBar.colors[m.statusBar.settings.groupServer]),s.xp6(2),s.Q6J("ngIf",m.isEmptyTodo))},dependencies:[W.O5,M.W2,M.Gu,M.gu,M.Q$,M.wd,M.sr],styles:[".disconnect_info[_ngcontent-%COMP%]{text-align:center;position:absolute;top:50%;left:50%;transform:translate(-50%) translateY(-50%)}"]}),E})()},{path:"add-todo-menu",loadChildren:()=>Promise.all([h.e(9745),h.e(8592),h.e(2058)]).then(h.bind(h,2058)).then(d=>d.AddTodoMenuPageModule)}];let ae=(()=>{var d;class E{}return(d=E).\u0275fac=function(a){return new(a||d)},d.\u0275mod=s.oAB({type:d}),d.\u0275inj=s.cJS({imports:[F.Bz.forChild(ne),F.Bz]}),E})(),re=(()=>{var d;class E{}return(d=E).\u0275fac=function(a){return new(a||d)},d.\u0275mod=s.oAB({type:d}),d.\u0275inj=s.cJS({imports:[W.ez,_.u5,M.Pc,ae]}),E})()}}]);