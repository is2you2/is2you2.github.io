"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3978],{3978:(si,v,g)=>{g.r(v),g.d(v,{UserFsDirPageModule:()=>oi});var h=g(6814),Z=g(95),d=g(1325),D=g(5877),u=g(5861),U=g(3641),T=g(9745),i=g(9468),b=g(797),w=g(3857),P=g(6052),I=g(9376),y=g(6593),A=g(2372);const C=["FileSel"];function L(t,s){if(1&t){const n=i.EpF();i.TgZ(0,"ion-button",10),i.NdJ("click",function(){i.CHM(n);const r=i.oxw(3);return i.KtG(r.ExportDirectoryRecursive())}),i._uU(1),i.qZA()}if(2&t){const n=i.oxw(3);i.xp6(1),i.hij(" ",n.lang.text.UserFsDir.ExportDir," ")}}function E(t,s){if(1&t){const n=i.EpF();i.TgZ(0,"div")(1,"ion-item",5),i._UZ(2,"ion-icon",6),i.TgZ(3,"ion-label"),i._uU(4,"."),i.qZA(),i.YNc(5,L,2,1,"ion-button",7),i.TgZ(6,"ion-button",8),i.NdJ("click",function(){i.CHM(n);const r=i.oxw(2);return i.KtG(r.RemoveDirectoryRecursive())}),i._uU(7),i.qZA()(),i.TgZ(8,"ion-item",9),i.NdJ("click",function(){i.CHM(n);const r=i.oxw(2);return i.KtG(r.MoveToUpDir())}),i._UZ(9,"ion-icon",6),i.TgZ(10,"ion-label"),i._uU(11,".."),i.qZA()()()}if(2&t){const n=i.oxw(2);i.xp6(5),i.Q6J("ngIf",!n.cant_dedicated),i.xp6(2),i.hij(" ",n.lang.text.UserFsDir.RemoveCurrentDir," ")}}function J(t,s){if(1&t){const n=i.EpF();i.TgZ(0,"div")(1,"ion-item",9),i.NdJ("click",function(){i.CHM(n);const r=i.oxw(3);return i.KtG(r.SelectImportFolder())}),i._UZ(2,"ion-icon",11),i.TgZ(3,"ion-label"),i._uU(4),i.qZA()(),i.TgZ(5,"input",12),i.NdJ("change",function(r){i.CHM(n);const o=i.oxw(3);return i.KtG(o.inputImageSelected(r))}),i.qZA()()}if(2&t){const n=i.oxw(3);i.xp6(4),i.hij(" ",n.lang.text.UserFsDir.ImportFolder," ")}}function k(t,s){if(1&t){const n=i.EpF();i.TgZ(0,"div")(1,"ion-item",9),i.NdJ("click",function(){i.CHM(n);const r=i.oxw(3);return i.KtG(r.BrowseExternalFiles())}),i._UZ(2,"ion-icon",13),i.TgZ(3,"ion-label"),i._uU(4),i.qZA()()()}if(2&t){const n=i.oxw(3);i.xp6(4),i.Oqu(n.lang.text.UserFsDir.OpenExtFolder)}}function N(t,s){if(1&t&&(i.TgZ(0,"div"),i.YNc(1,J,6,1,"div",2),i.YNc(2,k,5,1,"div",2),i.qZA()),2&t){const n=i.oxw(2);i.xp6(1),i.Q6J("ngIf",n.cant_dedicated),i.xp6(1),i.Q6J("ngIf",!n.cant_dedicated)}}function O(t,s){if(1&t){const n=i.EpF();i.TgZ(0,"ion-item",9),i.NdJ("click",function(){i.CHM(n);const r=i.oxw().$implicit,o=i.oxw(2);return i.KtG(o.SelectFolder(r))}),i._UZ(1,"ion-icon",6),i.TgZ(2,"ion-label"),i._uU(3),i.qZA()()}if(2&t){const n=i.oxw().$implicit;i.xp6(3),i.Oqu(n.name)}}function M(t,s){if(1&t&&(i.TgZ(0,"div"),i.YNc(1,O,4,1,"ion-item",14),i.qZA()),2&t){const n=s.$implicit,e=i.oxw(2);i.xp6(1),i.Q6J("ngIf",e.CurrentDir==n.dir)}}function Y(t,s){1&t&&i._UZ(0,"ion-icon",30)}function B(t,s){1&t&&i._UZ(0,"ion-icon",31)}function Q(t,s){1&t&&i._UZ(0,"ion-icon",32)}function R(t,s){1&t&&i._UZ(0,"ion-icon",33)}function q(t,s){1&t&&i._UZ(0,"ion-icon",34)}function G(t,s){1&t&&i._UZ(0,"ion-icon",35)}function H(t,s){if(1&t&&(i.TgZ(0,"ion-label",36),i._uU(1),i.qZA()),2&t){const n=i.oxw(2).$implicit;i.xp6(1),i.Oqu(n.name)}}function S(t,s){if(1&t&&(i.TgZ(0,"ion-label"),i._uU(1),i.qZA()),2&t){const n=i.oxw(2).$implicit;i.xp6(1),i.Oqu(n.name)}}function $(t,s){if(1&t){const n=i.EpF();i.TgZ(0,"ion-button",37),i.NdJ("click",function(){i.CHM(n);const r=i.oxw(2).$implicit,o=i.oxw(2);return i.KtG(o.OpenFile(r))}),i._uU(1),i.qZA()}if(2&t){const n=i.oxw(4);i.xp6(1),i.hij(" ",n.lang.text.UserFsDir.Open," ")}}function j(t,s){if(1&t){const n=i.EpF();i.TgZ(0,"ion-button",37),i.NdJ("click",function(){i.CHM(n);const r=i.oxw(2).$implicit,o=i.oxw(2);return i.KtG(o.DownloadFile(r))}),i._uU(1),i.qZA()}if(2&t){const n=i.oxw(4);i.xp6(1),i.hij(" ",n.lang.text.UserFsDir.Download," ")}}function K(t,s){if(1&t){const n=i.EpF();i.TgZ(0,"div",38),i.NdJ("click",function(){i.CHM(n);const r=i.oxw(2).$implicit,o=i.oxw(2);return i.KtG(o.OpenFile(r))}),i._UZ(1,"img",39),i.qZA()}if(2&t){const n=i.oxw(2).$implicit;i.xp6(1),i.Q6J("src",n.thumbnail,i.LSH)("alt",n.name)}}function z(t,s){if(1&t){const n=i.EpF();i.TgZ(0,"ion-accordion",16)(1,"ion-item",17),i.YNc(2,Y,1,0,"ion-icon",18),i.YNc(3,B,1,0,"ion-icon",19),i.YNc(4,Q,1,0,"ion-icon",20),i.YNc(5,R,1,0,"ion-icon",21),i.YNc(6,q,1,0,"ion-icon",22),i.YNc(7,G,1,0,"ion-icon",23),i.YNc(8,H,2,1,"ion-label",24),i.YNc(9,S,2,1,"ion-label",2),i.qZA(),i.TgZ(10,"ion-list",25)(11,"ion-item",5)(12,"ion-label"),i._uU(13),i.qZA(),i.YNc(14,$,2,1,"ion-button",26),i.YNc(15,j,2,1,"ion-button",26),i.TgZ(16,"ion-button",27),i.NdJ("click",function(){i.CHM(n);const r=i.oxw(),o=r.$implicit,l=r.index,a=i.oxw(2);return i.KtG(a.RemoveFile(o,l))}),i._uU(17),i.qZA()(),i.YNc(18,K,2,2,"div",28),i.TgZ(19,"ion-item",5)(20,"ion-label"),i._uU(21),i.qZA(),i.TgZ(22,"ion-label",29),i._uU(23),i.qZA()()()()}if(2&t){const n=i.oxw().$implicit;i.oxw();const e=i.MAs(5),r=i.oxw();i.Q6J("value",n.path),i.xp6(2),i.Q6J("ngIf","image"==n.viewer),i.xp6(1),i.Q6J("ngIf","audio"==n.viewer),i.xp6(1),i.Q6J("ngIf","video"==n.viewer),i.xp6(1),i.Q6J("ngIf","text"==n.viewer),i.xp6(1),i.Q6J("ngIf","godot"==n.viewer),i.xp6(1),i.Q6J("ngIf","disabled"==n.viewer),i.xp6(1),i.Q6J("ngIf",e.value==n.path),i.xp6(1),i.Q6J("ngIf",e.value!=n.path),i.xp6(4),i.Oqu(r.lang.text.UserFsDir.Action),i.xp6(1),i.Q6J("ngIf","disabled"!=n.viewer&&"image"!=n.viewer),i.xp6(1),i.Q6J("ngIf",r.cant_dedicated),i.xp6(2),i.hij(" ",r.lang.text.UserFsDir.Delete," "),i.xp6(1),i.Q6J("ngIf","image"==n.viewer),i.xp6(3),i.Oqu(r.lang.text.UserFsDir.CreateAt),i.xp6(2),i.Oqu(n.timestamp)}}function W(t,s){if(1&t&&(i.TgZ(0,"div"),i.YNc(1,z,24,16,"ion-accordion",15),i.qZA()),2&t){const n=s.$implicit,e=i.oxw(2);i.xp6(1),i.Q6J("ngIf",e.CurrentDir==n.dir)}}function V(t,s){if(1&t&&(i.TgZ(0,"ion-list"),i.YNc(1,E,12,2,"div",2),i.YNc(2,N,3,2,"div",2),i.YNc(3,M,2,1,"div",3),i.TgZ(4,"ion-accordion-group",null,4),i.YNc(6,W,2,1,"div",3),i.qZA()()),2&t){const n=i.oxw();i.xp6(1),i.Q6J("ngIf",""!=n.CurrentDir),i.xp6(1),i.Q6J("ngIf",""==n.CurrentDir),i.xp6(1),i.Q6J("ngForOf",n.DirList),i.xp6(3),i.Q6J("ngForOf",n.FileList)}}function X(t,s){if(1&t){const n=i.EpF();i.TgZ(0,"ion-item",43),i.NdJ("click",function(){i.CHM(n);const r=i.oxw().$implicit,o=i.oxw(2);return i.KtG(o.importFolderMiddleAct(r))}),i._UZ(1,"ion-icon",6),i.TgZ(2,"ion-label"),i._uU(3),i.qZA()()}if(2&t){const n=i.oxw().$implicit;i.xp6(3),i.Oqu(n.name)}}function ii(t,s){if(1&t&&(i.TgZ(0,"ion-item",44),i._UZ(1,"ion-icon",35),i.TgZ(2,"ion-label"),i._uU(3),i.qZA()()),2&t){const n=i.oxw().$implicit;i.xp6(3),i.Oqu(n.name)}}function ei(t,s){if(1&t&&(i.TgZ(0,"div"),i.YNc(1,X,4,1,"ion-item",41),i.YNc(2,ii,4,1,"ion-item",42),i.qZA()),2&t){const n=s.$implicit;i.xp6(1),i.Q6J("ngIf",n.isDirectory),i.xp6(1),i.Q6J("ngIf",n.isFile)}}function ti(t,s){if(1&t){const n=i.EpF();i.TgZ(0,"ion-list")(1,"ion-item",9),i.NdJ("click",function(){i.CHM(n);const r=i.oxw();return i.KtG(r.InAppBrowser=!0)}),i._UZ(2,"ion-icon",6),i.TgZ(3,"ion-label",40),i._uU(4,"/sdcard/Android/data/org.pjcone.portal/files"),i.qZA()(),i.YNc(5,ei,3,2,"div",3),i.qZA()}if(2&t){const n=i.oxw();i.xp6(5),i.Q6J("ngForOf",n.ExternalFolder)}}const ni=[{path:"",component:(()=>{var t;class s{constructor(e,r,o,l,a,c,_,f,p,m){this.modalCtrl=e,this.indexed=r,this.loadingCtrl=o,this.lang=l,this.global=a,this.p5toast=c,this.alertCtrl=_,this.sanitizer=f,this.file=p,this.navCtrl=m,this.DirList=[],this.FileList=[],this.cant_dedicated=!1,this.InAppBrowser=!0,this.is_ready=!1,this.EventListenerAct=x=>{x.detail.register(110,F=>{this.is_ready?""==this.CurrentDir?F():this.MoveToUpDir():(this.initLoadingElement.dismiss(),"UserFsDirPageModule"!=this.modalCtrl.injector.source?this.modalCtrl.dismiss():this.navCtrl.back())})},this.ExternalFolder=[]}ngOnInit(){}ionViewWillEnter(){this.CurrentDir="",this.LoadAllIndexedFiles(),("DesktopPWA"==U.n$||"MobilePWA"==U.n$)&&(this.cant_dedicated=!0),document.addEventListener("ionBackButton",this.EventListenerAct)}LoadAllIndexedFiles(){var e=this;return(0,u.Z)(function*(){e.initLoadingElement=yield e.loadingCtrl.create({message:e.lang.text.UserFsDir.LoadingExplorer}),e.initLoadingElement.present(),e.DirList.length=0,e.FileList.length=0,yield e.indexed.GetFileListFromDB("/",function(){var r=(0,u.Z)(function*(o){for(let l=0,a=o.length;l<a;l++)yield e.indexed.GetFileInfoFromDB(o[l],c=>{let _={path:o[l],mode:c.mode,timestamp:new Date(c.timestamp).toLocaleString()};switch(_.name=_.path.substring(_.path.lastIndexOf("/")+1),_.dir=o[l].substring(0,o[l].lastIndexOf("/")),_.mode){case 33206:_.file_ext=_.name.split(".").pop(),e.global.set_viewer_category_from_ext(_),"image"==_.viewer&&e.indexed.loadBlobFromUserPath(_.path,"",f=>{let p=URL.createObjectURL(f);_.thumbnail=e.sanitizer.bypassSecurityTrustUrl(p)}),e.FileList.push(_);break;case 16893:e.DirList.push(_);break;default:console.log("\uc608\uc0c1\ud558\uc9c0 \ubabb\ud55c \ud30c\uc77c \ubaa8\ub4dc: ",_)}});e.FileList.sort((l,a)=>l.path>a.path?1:l.path<a.path?-1:0),e.DirList.sort((l,a)=>l.path>a.path?1:l.path<a.path?-1:0),e.initLoadingElement.dismiss(),e.is_ready=!0});return function(o){return r.apply(this,arguments)}}())})()}MoveToUpDir(){this.CurrentDir=this.CurrentDir.substring(0,this.CurrentDir.lastIndexOf("/")),this.FileSel.value=void 0}SelectFolder(e){this.CurrentDir=e.path,this.FileSel.value=void 0}OpenFile(e){"disabled"===e.viewer?this.p5toast.show({text:this.lang.text.UserFsDir.CannotOpenFile}):(document.removeEventListener("ionBackButton",this.EventListenerAct),this.modalCtrl.create({component:T.B,componentProps:{info:{content:{filename:e.name,file_ext:e.file_ext,type:"",viewer:e.viewer,path:e.path}},no_edit:!0,path:e.path}}).then(r=>{r.onDidDismiss().then(o=>document.addEventListener("ionBackButton",this.EventListenerAct)),r.present()}))}DownloadFile(e){this.indexed.DownloadFileFromUserPath(e.path,"",e.name)}ExportDirectoryRecursive(){var r,e=this;this.alertCtrl.create({header:this.lang.text.UserFsDir.ExportDirTitle,message:this.lang.text.UserFsDir.ExportDirMsg,buttons:[{text:this.lang.text.UserFsDir.ExportConfirm,handler:(r=(0,u.Z)(function*(){let o=yield e.loadingCtrl.create({message:e.lang.text.UserFsDir.LoadingExplorer});o.present(),e.indexed.GetFileListFromDB(e.CurrentDir,l=>{l.forEach(function(){var a=(0,u.Z)(function*(c){let _=yield e.indexed.GetFileInfoFromDB(c),f=yield e.indexed.loadBlobFromUserPath(c,""),p=c.lastIndexOf("/"),m=c.substring(0,p),x=c.substring(p+1);yield e.CreateFolderRecursive(m);try{if(16893==_.mode)throw"\uc774\uac70 \ud3f4\ub354\uc784";yield e.file.writeFile(e.file.externalDataDirectory+m+"/",x,f,{replace:!0})}catch(F){console.error(c,": \ud30c\uc77c \uc800\uc7a5 \uc2e4\ud328: ",F)}});return function(c){return a.apply(this,arguments)}}())}),o.dismiss()}),function(){return r.apply(this,arguments)})}]}).then(r=>r.present())}CreateFolderRecursive(e){var r=this;return(0,u.Z)(function*(){let o=e.lastIndexOf("/")+1,l=e.substring(0,o),a=e.substring(o);yield r.file.createDir(r.file.externalDataDirectory+l,a,!0)})()}BrowseExternalFiles(){var e=this;return(0,u.Z)(function*(){e.ExternalFolder.length=0,e.InAppBrowser=!1,e.ExternalFolder=yield e.file.listDir(e.file.externalApplicationStorageDirectory,"files"),e.ExternalFolder.sort(),e.ExternalFolder.sort((r,o)=>r.isDirectory?-1:1)})()}importFolderMiddleAct(e){var r=this;return(0,u.Z)(function*(){let o=yield r.loadingCtrl.create({message:r.lang.text.UserFsDir.LoadingExplorer});o.present(),yield r.importThisFolder(e),r.InAppBrowser=!0,o.dismiss()})()}importThisFolder(e){var r=this;return(0,u.Z)(function*(){let o=e.nativeURL.substring(0,e.nativeURL.length-1),l=o.lastIndexOf("/"),a=yield r.file.listDir(o.substring(0,l)+"/",o.substring(l+1));for(let c=0,_=a.length;c<_;c++)if(a[c].isDirectory)yield r.importThisFolder(a[c]);else{let f=a[c].nativeURL.split("org.pjcone.portal/files/")[1],p=a[c].nativeURL.lastIndexOf("/")+1,m=a[c].nativeURL.substring(0,p);console.log(f),console.log(m),console.log(a[c].name);try{let x=yield r.file.readAsDataURL(m,a[c].name);console.log("\ubd88\ub7ec\uc624\uae30 \uc131\uacf5: ",x)}catch(x){console.log("\ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",x)}}})()}SelectImportFolder(){this.cant_dedicated?document.getElementById("folder_sel_id").click():this.BrowseExternalFiles()}inputImageSelected(e){var r=this;return(0,u.Z)(function*(){let o=yield r.loadingCtrl.create({message:r.lang.text.UserFsDir.LoadingExplorer});o.present();for(let l=0,a=e.target.files.length;l<a;l++)yield r.indexed.saveBlobToUserPath(e.target.files[l],e.target.files[l].webkitRelativePath);r.LoadAllIndexedFiles(),o.dismiss()})()}RemoveDirectoryRecursive(){var e=this;this.alertCtrl.create({header:this.CurrentDir.substring(this.CurrentDir.lastIndexOf("/")+1),message:this.lang.text.UserFsDir.RemoveThisFolder,buttons:[{text:this.lang.text.UserFsDir.RemoveApply,handler:()=>{this.indexed.GetFileListFromDB(this.CurrentDir,r=>{r.forEach(function(){var o=(0,u.Z)(function*(l){return yield e.indexed.removeFileFromUserPath(l)});return function(l){return o.apply(this,arguments)}}());for(let o=this.DirList.length-1;o>=0;o--)0==this.DirList[o].path.indexOf(this.CurrentDir)&&this.DirList.splice(o,1);for(let o=this.FileList.length-1;o>=0;o--)0==this.FileList[o].path.indexOf(this.CurrentDir)&&this.FileList.splice(o,1);this.MoveToUpDir()})}}]}).then(r=>r.present())}RemoveFile(e,r){this.alertCtrl.create({header:this.lang.text.UserFsDir.DeleteFile,message:this.lang.text.UserFsDir.CannotBeUndo,buttons:[{text:this.lang.text.UserFsDir.DeleteAccept,handler:()=>{this.indexed.removeFileFromUserPath(e.path,()=>{this.FileList.splice(r,1)})}}]}).then(o=>o.present())}ionViewDidLeave(){this.FileList.forEach(e=>{URL.revokeObjectURL(e.thumbnail)})}ionViewWillLeave(){document.removeEventListener("ionBackButton",this.EventListenerAct)}}return(t=s).\u0275fac=function(e){return new(e||t)(i.Y36(d.IN),i.Y36(b.H),i.Y36(d.HT),i.Y36(w.b),i.Y36(P.AN),i.Y36(I.F),i.Y36(d.Br),i.Y36(y.H7),i.Y36(A.$),i.Y36(d.SH))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-user-fs-dir"]],viewQuery:function(e,r){if(1&e&&i.Gf(C,5),2&e){let o;i.iGM(o=i.CRH())&&(r.FileSel=o.first)}},decls:9,vars:3,consts:[["slot","start"],["defaultHref","portal/settings"],[4,"ngIf"],[4,"ngFor","ngForOf"],["FileSel",""],["button",""],["slot","start","name","folder"],["style","padding-right: 4px;",3,"click",4,"ngIf"],[3,"click"],["button","",3,"click"],[2,"padding-right","4px",3,"click"],["slot","start","name","arrow-down-circle"],["hidden","","type","file","id","folder_sel_id","webkitdirectory","",3,"change"],["slot","start","name","eye-outline"],["button","",3,"click",4,"ngIf"],[3,"value",4,"ngIf"],[3,"value"],["slot","header"],["slot","start","name","image",4,"ngIf"],["slot","start","name","musical-notes",4,"ngIf"],["slot","start","name","play-circle",4,"ngIf"],["slot","start","name","reader",4,"ngIf"],["slot","start","name","extension-puzzle",4,"ngIf"],["slot","start","name","document",4,"ngIf"],["text-wrap","",4,"ngIf"],["slot","content"],["class","ion-text-right",3,"click",4,"ngIf"],[1,"ion-text-end",3,"click"],["class","image_front_form",3,"click",4,"ngIf"],[1,"ion-text-end"],["slot","start","name","image"],["slot","start","name","musical-notes"],["slot","start","name","play-circle"],["slot","start","name","reader"],["slot","start","name","extension-puzzle"],["slot","start","name","document"],["text-wrap",""],[1,"ion-text-right",3,"click"],[1,"image_front_form",3,"click"],[1,"image_front_view",3,"src","alt"],["color","medium"],["button","","disabled","",3,"click",4,"ngIf"],["button","","disabled","",4,"ngIf"],["button","","disabled","",3,"click"],["button","","disabled",""]],template:function(e,r){1&e&&(i.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),i._uU(3),i.qZA(),i.TgZ(4,"ion-buttons",0),i._UZ(5,"ion-back-button",1),i.qZA()()(),i.TgZ(6,"ion-content"),i.YNc(7,V,7,4,"ion-list",2),i.YNc(8,ti,6,1,"ion-list",2),i.qZA()),2&e&&(i.xp6(3),i.Oqu(r.lang.text.Settings.InAppExplorer),i.xp6(4),i.Q6J("ngIf",r.InAppBrowser),i.xp6(1),i.Q6J("ngIf",!r.InAppBrowser))},dependencies:[h.sg,h.O5,d.We,d.eh,d.oU,d.YG,d.Sm,d.W2,d.Gu,d.gu,d.Ie,d.Q$,d.q_,d.wd,d.sr,d.cs],styles:[".item.sc-ion-label-md-h[_ngcontent-%COMP%], .item[_ngcontent-%COMP%]   .sc-ion-label-md-h[_ngcontent-%COMP%]{overflow:unset}.image_front_form[_ngcontent-%COMP%]{text-align:center}.image_front_view[_ngcontent-%COMP%]{max-height:233px}"]}),s})()}];let ri=(()=>{var t;class s{}return(t=s).\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[D.Bz.forChild(ni),D.Bz]}),s})(),oi=(()=>{var t;class s{}return(t=s).\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[h.ez,Z.u5,d.Pc,ri]}),s})()}}]);