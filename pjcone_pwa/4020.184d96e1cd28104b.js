"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4020],{4020:(Z,U,g)=>{g.d(U,{j:()=>Y});var P=g(467),w=g(8326),J=g(5402),x=g(7100),j=g(92),R=g(3953),G=g(9900),K=g(755),H=g(4234),Q=g(4237);!function F(){("http:"!=window.location.protocol||0==window.location.host.indexOf("localhost"))&&g.e(925).then(g.t.bind(g,925,23))}();let Y=(()=>{var b;class k{constructor(i,e,t,n,s){this.p5toast=i,this.indexed=e,this.lang=t,this.nakama=n,this.global=s,this.FocusedRemoteId=0,this.PeerGroups={},this.Peers={},this.OnUse=!1,this.StatusText="",this.initQueued=[],this.isInitQueued=!1,this.nakama.WebRTCService=this,this.global.WebRTCService=this}initialize(i,e,t){var n=this;return(0,P.A)(function*(){if(n.initQueued.push({type:i,actId:e,groupId:t}),n.isInitQueued)for(;n.isInitQueued;)yield new Promise(s=>setTimeout(s,0));else{for(n.isInitQueued=!0;n.initQueued.length;){const s=n.initQueued.shift();yield n.initialize_queue(s.type,s.actId,s.groupId)}n.isInitQueued=!1}})()}initialize_queue(i,e,t){var n=this;return(0,P.A)(function*(){if("data"!=i&&!(yield J.R.requestAudioRecordingPermission()).value)throw n.lang.text.WebRTCDevManager.SecurityError;if(n.Peers[e]||(n.Peers[e]={}),n.Peers[e].TypeIn=i,n.Peers[e].IceCandidates=[],n.Peers[e].ReceivedOfferPart="",n.Peers[e].ReceivedAnswerPart="",t&&(n.Peers[e].groupId=t,n.PeerGroups[t]||(n.PeerGroups[t]=[]),n.PeerGroups[t].push(e),n.FocusedRemoteId=n.PeerGroups[t].length-1),"data"!=i){n.createP5_panel(e,t);try{if(!n.localMedia&&(!n.global.useCCTV||!n.global.CCTVHost)&&(n.localMedia=document.createElement(i),n.localMedia.id="webrtc_video",n.localMedia.style.width="0px",n.localMedia.style.height="0px",n.localMedia.autoplay=!0,"video"==i&&(n.localMedia.playsInline=!0),n.localMedia.muted=!0,document.body.appendChild(n.localMedia)),(!n.global.useCCTV||n.global.CCTVHost)&&(n.Peers[e].remoteMedia=document.createElement(i),n.Peers[e].remoteMedia.id=e,n.Peers[e].remoteMedia.style.width="0px",n.Peers[e].remoteMedia.style.height="0px",n.Peers[e].remoteMedia.autoplay=!0,"video"==i&&(n.Peers[e].remoteMedia.playsInline=!0),document.body.appendChild(n.Peers[e].remoteMedia)),!n.localStream){const s=yield n.getMediaConst(i);try{n.localStream=yield navigator.mediaDevices.getUserMedia(s)}catch{"DesktopPWA"==j.aH&&(n.localStream=yield navigator.mediaDevices.getDisplayMedia({video:!0,audio:!n.global.useCCTV}))}n.localMedia&&n.localStream&&(n.localMedia.srcObject=n.localStream)}}catch(s){console.log("navigator.getUserMedia error: ",s),yield n.close_webrtc(e),n.p5toast.show({text:`${n.lang.text.WebRTCDevManager.InitErr}: ${(s.statusText?`${s.statusText}(${s.status})`:s.status)||s}`})}}yield n.createCall(e)})()}getMediaConst(i){var e=this;return(0,P.A)(function*(){var t,n;let o,l,s=yield e.getDeviceList(),h=Number(null!==(t=localStorage.getItem("VideoInputDev"))&&void 0!==t?t:NaN),f=Number(null!==(n=localStorage.getItem("AudioInputDev"))&&void 0!==n?n:NaN);for(let u=0,p=s.length,_=0,E=0;u<p&&(!o||!l);u++)!o&&"audioinput"==s[u].kind&&(Number.isNaN(f)?(o=s[u].deviceId,localStorage.setItem("AudioInputDev",`${E}`)):E==f&&(o=s[u].deviceId),E++),!l&&"videoinput"==s[u].kind&&(Number.isNaN(h)?(l=s[u].deviceId,localStorage.setItem("AudioInputDev",`${_}`)):_==h&&(l=s[u].deviceId),_++);let d={};return"video"==i?(d.video=!0,l&&(d.video={deviceId:l})):d.video=!1,d.audio=!e.global.useCCTV,e.global.useCCTV||o&&(d.audio={deviceId:o}),d})()}WEBRTC_INIT_REQ_SIGNAL(i,e,t,n,s=!1){var o=this;return(0,P.A)(function*(){try{o.Peers[e]||(yield o.initialize(t,e,n)),o.Peers[e].LocalOffer||(yield o.CreateOffer(e));const l=JSON.stringify(o.Peers[e].LocalOffer);o.Peers[e].LocalOfferPartArray=l.match(/(.{1,64})/g),s||o.WEBRTC_REPLY_INIT_SIGNAL_PART(i,e,t,n)}catch(l){console.warn("\ucd5c\ucd08 \uc5f0\uacb0\uc30d \uc9c1\ud6c4 \uad6c\uc131 \uc2e4\ud328: ",l)}})()}WEBRTC_REPLY_INIT_SIGNAL_PART(i,e,t,n){var s=this;return(0,P.A)(function*(){if(s.Peers[e].LocalOfferPartArray||(yield s.WEBRTC_INIT_REQ_SIGNAL(i,e,t,n,!0)),i.client&&i.client.readyState==i.client.OPEN){const o=s.Peers[e].LocalOfferPartArray.shift();i.client.send(o?JSON.stringify({type:"socket_react",channel:i.channel,act:"WEBRTC_REPLY_INIT_SIGNAL",data_str:o,send_to:e}):JSON.stringify({type:"socket_react",channel:i.channel,act:"WEBRTC_REPLY_INIT_SIGNAL",data_str:"EOL",send_to:e}))}})()}WEBRTC_RECEIVE_ANSWER_PART(i,e){if(i.client&&i.client.readyState==i.client.OPEN){const t=this.Peers[e].LocalAnswerPartArray.shift();t?i.client.send(JSON.stringify({type:"socket_react",channel:i.channel,act:"WEBRTC_RECEIVE_ANSWER",data_str:t,send_to:e})):(i.client.send(JSON.stringify({type:"socket_react",channel:i.channel,act:"WEBRTC_RECEIVE_ANSWER",data_str:"EOL",send_to:e})),this.Peers[e].JoinInited=!0)}}WEBRTC_REPLY_INIT_SIGNAL(i,e,t){"EOL"==i?(this.createRemoteOfferFromAnswer(JSON.parse(this.Peers[t].ReceivedOfferPart),t),delete this.Peers[t].ReceivedOfferPart,this.Peers[t].JoinInited=!0):(this.Peers[t].ReceivedOfferPart=(this.Peers[t].ReceivedOfferPart||"")+i,e.client&&e.client.readyState==e.client.OPEN&&e.client.send(JSON.stringify({type:"socket_react",channel:e.channel,act:"WEBRTC_REPLY_INIT_SIGNAL_PART",send_to:t})))}WEBRTC_RECEIVE_ANSWER(i,e,t){"EOL"==i?(this.ReceiveRemoteAnswer(JSON.parse(this.Peers[t].ReceivedAnswerPart),e,t),delete this.Peers[t].ReceivedAnswerPart):(this.Peers[t].ReceivedAnswerPart=(this.Peers[t].ReceivedAnswerPart||"")+i,e.client&&e.client.readyState==e.client.OPEN&&e.client.send(JSON.stringify({type:"socket_react",channel:e.channel,act:"WEBRTC_RECEIVE_ANSWER_PART",send_to:t})))}WEBRTC_ICE_CANDIDATES(i,e,t){this.ReceiveIceCandidate(JSON.parse(i),e,t)}createP5_panel(i,e){var t=this;this.OnUse||(this.OnUse=!0,this.p5canvas&&(clearTimeout(this.p5waitingAct),this.p5waitingAct=null,this.p5hangup=null,this.p5canvas.remove()),this.p5canvas=new w(n=>{let s,o,l,h,f,d,u,p,m,T,_=!0,E=!0,a=1;n.setup=()=>{if("http:"!=window.location.protocol||0==window.location.host.indexOf("localhost")){let r,c=()=>{this.Peers[i].JoinInited?(r.stop(.1),clearTimeout(this.p5waitingAct)):(r&&r.stop(.1),r=new w.Oscillator(380,"sine"),r.start(),r.amp(1,.15),r.amp(0,.75),this.p5waitingAct=setTimeout(()=>{c()},1200))};this.p5waitingAct=setTimeout(()=>{c()},0),this.p5hangup=()=>{r.stop(.1),clearTimeout(this.p5waitingAct),r=new w.Oscillator(380,"sine"),r.start(),r.freq(250,.35),r.amp(1,.15),r.amp(0,.25),r.amp(1,.35),r.amp(0,.45)}}n.noCanvas(),s=n.createDiv(),s.id("outterDiv"),s.style("position: absolute; left: 50%; top: 0px; z-index: 1"),s.style("transform: translateX(-50%)"),s.style("width: fit-content; height: fit-content"),s.style("padding: 8px 16px;"),s.style("display: flex; justify-content: center;"),l=n.createDiv(),l.parent(s),l.style("display: flex; justify-content: center;"),l.style("width: fit-content; height: fit-content"),l.style("border-radius: 24px"),l.style("background: var(--toast-background-color)"),l.style("padding: 6px 8px"),o=n.createDiv(),o.parent(l),o.id("webrtc_content"),o.style("display: flex; justify-content: center;"),o.style("flex-direction","column"),o.style("width: fit-content; height: fit-content"),o.style("word-break: break-all"),o.style("background: var(--toast-background-color)"),o.style("border-radius: 24px"),o.style("padding: 6px 8px"),o.style("color: "+(x.ud?"white":"black")),W(),h=n.createDiv(),h.parent(o),h.id("webrtc_content"),h.style("display: flex; justify-content: center;"),h.style("align-self","center"),h.style("width: fit-content; height: fit-content"),u=n.createButton('<ion-icon style="width: 32px; height: 32px;" name="mic-outline"></ion-icon>'),u.parent(h),u.style("padding","0px"),u.style("margin","4px"),u.style("border-radius","16px"),u.style("width","40px"),u.style("height","40px"),u.mouseClicked(()=>{const r=this.localStream.getAudioTracks();for(let c=0,y=r.length;c<y;c++)r[c].enabled=!1;p.show(),u.hide(),_=!1}),p=n.createButton('<ion-icon style="width: 32px; height: 32px;" name="mic-off-outline"></ion-icon>'),p.parent(h),p.style("background-color","grey"),p.style("padding","0px"),p.style("margin","4px"),p.style("border-radius","16px"),p.style("width","40px"),p.style("height","40px"),p.mouseClicked(()=>{const r=this.localStream.getAudioTracks();for(let c=0,y=r.length;c<y;c++)r[c].enabled=!0;u.show(),p.hide(),_=!0}),p.hide(),"video"==this.Peers[i].TypeIn&&!this.global.useCCTV&&(f=n.createButton('<ion-icon style="width: 32px; height: 32px;" name="videocam-outline"></ion-icon>'),f.parent(h),f.style("padding","0px"),f.style("margin","4px"),f.style("border-radius","16px"),f.style("width","40px"),f.style("height","40px"),f.mouseClicked(()=>{const r=this.localStream.getVideoTracks();for(let c=0,y=r.length;c<y;c++)r[c].enabled=!1;d.show(),f.hide(),E=!1}),d=n.createButton('<ion-icon style="width: 32px; height: 32px;" name="videocam-off-outline"></ion-icon>'),d.parent(h),d.style("background-color","grey"),d.style("padding","0px"),d.style("margin","4px"),d.style("border-radius","16px"),d.style("width","40px"),d.style("height","40px"),d.mouseClicked(()=>{const r=this.localStream.getVideoTracks();for(let c=0,y=r.length;c<y;c++)r[c].enabled=!0;f.show(),d.hide(),E=!0}),d.hide()),(!this.global.useCCTV||!this.global.CCTVHost)&&(m=n.createButton('<ion-icon style="width: 32px; height: 32px;" name="settings-outline"></ion-icon>'),m.parent(h),m.style("padding","0px"),m.style("margin","4px"),m.style("border-radius","16px"),m.style("width","40px"),m.style("height","40px"),m.mouseClicked((0,P.A)(function*(){m.elt.disabled=!0;let r=yield t.getDeviceList();t.global.PageDismissAct["webrtc-manage"]=function(){var c=(0,P.A)(function*(y){m.elt.disabled=!1;try{var D;if(!Object.keys(y).length)throw"\uc7a5\uce58 \ubcc0\uacbd \uc815\ubcf4\uac00 \ube44\uc5b4\uc788\uc74c";let O={};"video"==t.Peers[i].TypeIn&&y.data.videoinput&&(O.video={deviceId:{exact:y.data.videoinput.deviceId}}),t.global.useCCTV?O.audio=!1:y.data.audioinput&&(O.audio={deviceId:{exact:y.data.audioinput.deviceId}}),t.localStream.getTracks().forEach(v=>v.stop()),t.localStream="video"==t.Peers[i].TypeIn&&null!==(D=y.data.videoinput)&&void 0!==D&&D.useScr?yield navigator.mediaDevices.getDisplayMedia({video:!0,audio:!t.global.useCCTV}):yield navigator.mediaDevices.getUserMedia(O);const B=t.localStream.getAudioTracks();for(let v=0,A=B.length;v<A;v++)B[v].enabled=_;const V=t.localStream.getVideoTracks();for(let v=0,A=V.length;v<A;v++)V[v].enabled=E;t.localMedia.srcObject=t.localStream;const X=t.Peers[i].PeerConnection.getSenders();for(let v of X){var N,M;if("video"==(null===(N=v.track)||void 0===N?void 0:N.kind)){const A=t.localStream.getVideoTracks()[0];v?yield v.replaceTrack(A):t.Peers[i].PeerConnection.addTrack(A,t.localStream)}if("audio"==(null===(M=v.track)||void 0===M?void 0:M.kind)){const A=t.localStream.getAudioTracks()[0];v?yield v.replaceTrack(A):t.Peers[i].PeerConnection.addTrack(A,t.localStream)}}t.CreateOffer(i)}catch(O){console.log("\ubbf8\ub514\uc5b4 \uc2a4\ud2b8\ub9bc \ubcc0\uacbd \uc624\ub958: ",O)}t.global.RestoreShortCutAct("webrtc-manage"),delete t.global.PageDismissAct["webrtc-manage"]});return function(y){return c.apply(this,arguments)}}(),t.global.StoreShortCutAct("webrtc-manage"),t.global.ActLikeModal("webrtc-manage-io-dev",{list:JSON.parse(JSON.stringify(r)),typein:t.Peers[i].TypeIn,dismiss:"webrtc-manage"})}))),(!this.global.useCCTV||this.global.CCTVHost)&&(T=n.createButton('<ion-icon style="width: 32px; height: 32px;" name="close-circle-outline"></ion-icon>'),T.parent(h),T.style("background-color","red"),T.style("padding","0px"),T.style("margin","4px"),T.style("border-radius","16px"),T.style("width","40px"),T.style("height","40px"),T.mouseClicked((0,P.A)(function*(){var r,c;yield null===(r=t.Peers[i])||void 0===r||null===(c=r.HangUpCallBack)||void 0===c?void 0:c.call(r)})))};let L=!1;n.draw=()=>{a>0?a-=.03:a<=0&&(a=0),W(),this.OnUse||this.p5hangup&&!L&&(this.p5hangup(),s.hide(),setTimeout(()=>{this.OnUse||(clearTimeout(this.p5waitingAct),this.p5waitingAct=null,this.p5hangup=null,this.p5canvas.remove())},1e3),L=!0)};let W=()=>{let S=n.lerpColor(n.color("#"+(x.ud?"30564e88":"b9543788")),n.color("#ffd94ebb"),a).levels,r=4*a;l.style(`padding: ${r}px ${r}px`),o.style(`padding: ${n.lerp(6,2,a)}px ${n.lerp(8,3,a)}px`),l.style(`background: rgba(${S[0]}, ${S[1]}, ${S[2]}, ${S[3]/255})`)}}))}getDeviceList(){return(0,P.A)(function*(){return yield navigator.mediaDevices.enumerateDevices()})()}createCall(i){var e=this;return(0,P.A)(function*(){if(!e.Peers[i])return void e.close_webrtc(i);let t;e.Peers[i].isConnected=!0;try{let s=yield e.indexed.loadTextFromUserPath("servers/webrtc_server.json");t={},t.iceServers=JSON.parse(s)}catch{}var n;(!t||!t.iceServers||!t.iceServers.length)&&(e.p5toast.show({text:e.lang.text.WebRTCDevManager.NoRegServer}),t=null),e.Peers[i].PeerConnection=new RTCPeerConnection(t),e.Peers[i].PeerConnection.onicecandidate=s=>e.handleConnection(s,i),e.Peers[i].PeerConnection.oniceconnectionstatechange=s=>{console.log("ICE Connection state: ",e.Peers[i].PeerConnection.iceConnectionState)},e.Peers[i].PeerConnection.onconnectionstatechange=function(){var s=(0,P.A)(function*(o){switch(o.target.connectionState){case"failed":case"disconnected":yield e.close_webrtc(i);break;case"connected":e.p5waitingAct&&clearTimeout(e.p5waitingAct);break;default:console.log("\uc5f0\uacb0 \uc0c1\ud0dc \ubcc0\uacbd\ub428: ",o.target.connectionState)}});return function(o){return s.apply(this,arguments)}}(),"data"!=e.Peers[i].TypeIn?(null===(n=e.localStream)||void 0===n||n.getTracks().forEach(s=>e.Peers[i].PeerConnection.addTrack(s,e.localStream)),e.Peers[i].PeerConnection.ontrack=s=>{try{if(e.global.useCCTV&&!e.global.CCTVHost)throw"CCTV \ucc38\uac00\uc790\ub85c \uc0c1\ub300\ubc29 \ubbf8\ub514\uc5b4\ub97c \ubc1b\uc9c0 \uc54a\uc74c";e.Peers[i].remoteMedia.srcObject=s.streams[0]}catch{}}):e.createDataChannel(void 0,i),e.Peers[i].PeerConnection.ondatachannel=s=>{e.Peers[i].dataChannel=s.channel},e.Peers[i].PeerConnection.onnegotiationneeded=function(){var s=(0,P.A)(function*(o){if(e.Peers[i].JoinInited){yield e.Peers[i].PeerConnection.createOffer({offerToReceiveVideo:!0}).then(h=>e.createdOffer(h,i)).catch(h=>e.setSessionDescriptionError(h));const l=JSON.stringify(e.Peers[i].LocalOffer);e.Peers[i].LocalOfferPartArray=l.match(/(.{1,64})/g),e.WEBRTC_REPLY_INIT_SIGNAL_PART({client:e.Peers[i].signalingChannel,channel:e.Peers[i].signalChannelId},i,e.Peers[i].TypeIn,e.Peers[i].groupId)}});return function(o){return s.apply(this,arguments)}}()})()}createDataChannel(i,e){this.Peers[e].dataChannel=this.Peers[e].PeerConnection.createDataChannel(i),this.createDataChannelListener(e)}createDataChannelListener(i){this.Peers[i].dataChannel.onopen=e=>{this.Peers[i].dataChannelOpenAct&&this.Peers[i].dataChannelOpenAct()},this.Peers[i].dataChannel.onclose=e=>{if(this.Peers[i])try{var t,n;null===(t=(n=this.Peers[i]).dataChannelOnCloseAct)||void 0===t||t.call(n),this.Peers[i].dataChannelOpenAct=null,this.Peers[i].dataChannelOnMsgAct=null,this.Peers[i].dataChannelOnCloseAct=null}catch(s){console.log("\uc774\ubbf8 \uc0ad\uc81c\ub41c \ud1b5\uc2e0: ",s)}},this.Peers[i].dataChannel.onmessage=e=>{this.Peers[i].dataChannelOnMsgAct&&this.Peers[i].dataChannelOnMsgAct(e.data)}}CreateOffer(i){var e=this;return(0,P.A)(function*(){try{const t=yield e.Peers[i].PeerConnection.createOffer({offerToReceiveVideo:!0});e.createdOffer(t,i)}catch(t){e.setSessionDescriptionError(t)}})()}handleConnection(i,e){let t=i.candidate;t&&this.Peers[e].IceCandidates.push(new RTCIceCandidate(t))}ReceiveIceCandidate(i,e,t){var n=this;this.ReplyIceCandidate&&clearTimeout(this.ReplyIceCandidate),this.ReplyIceCandidate=setTimeout((0,P.A)(function*(){for(;null!==(s=n.Peers[t])&&void 0!==s&&null!==(s=s.IceCandidates)&&void 0!==s&&s.length;){var s;const o=n.Peers[t].IceCandidates.shift();e.client&&e.client.readyState==e.client.OPEN&&e.client.send(JSON.stringify({type:"socket_react",act:"WEBRTC_ICE_CANDIDATES",channel:e.channel,data_str:JSON.stringify(o),send_to:t})),yield new Promise(l=>setTimeout(l,n.global.WebsocketRetryTerm))}}),800),this.Peers[t].PeerConnection.addIceCandidate(i).then(()=>{console.log("Success to add new ice candidate")}).catch(s=>{console.error("failed to add ice candidate: ",s)})}createdOffer(i,e){this.Peers[e].LocalOffer=i,this.Peers[e].PeerConnection.setLocalDescription(i).then(()=>{this.setLocalDescriptionSuccess(this.Peers[e].PeerConnection)}).catch(t=>this.setSessionDescriptionError(t))}createRemoteOfferFromAnswer(i,e){this.Peers[e].PeerConnection.setRemoteDescription(i).then(()=>{this.setRemoteDescriptionSuccess(this.Peers[e].PeerConnection)}).catch(t=>this.setSessionDescriptionError(t))}CreateAnswer(i,e){this.Peers[e].PeerConnection.createAnswer().then(t=>this.createdAnswer(t,i,e)).catch(t=>this.setSessionDescriptionError(t))}setLocalDescriptionSuccess(i){this.setDescriptionSuccess(i,"setLocalDescription")}setRemoteDescriptionSuccess(i){this.setDescriptionSuccess(i,"setRemoteDescription")}createdAnswer(i,e,t){var n=this;return(0,P.A)(function*(){n.Peers[t].LocalAnswer=i,n.Peers[t].PeerConnection.setLocalDescription(i).then(()=>{n.setLocalDescriptionSuccess(n.Peers[t].PeerConnection)}).catch(o=>n.setSessionDescriptionError(o));const s=JSON.stringify(i);n.Peers[t].LocalAnswerPartArray=s.match(/(.{1,64})/g),n.WEBRTC_RECEIVE_ANSWER_PART(e,t)})()}ReceiveRemoteAnswer(i,e,t){var n=this;return(0,P.A)(function*(){for(n.Peers[t].PeerConnection.setRemoteDescription(i).then(()=>{n.setRemoteDescriptionSuccess(n.Peers[t].PeerConnection)}).catch(o=>n.setSessionDescriptionError(o));null!==(s=n.Peers[t])&&void 0!==s&&null!==(s=s.IceCandidates)&&void 0!==s&&s.length;){var s;const o=n.Peers[t].IceCandidates.shift();e.client&&e.client.readyState==e.client.OPEN&&(e.client.send(JSON.stringify({type:"socket_react",channel:e.channel,act:"WEBRTC_ICE_CANDIDATES",data_str:JSON.stringify(o),send_to:t})),yield new Promise(l=>setTimeout(l,n.global.WebsocketRetryTerm)))}})()}setSessionDescriptionError(i){console.error(`Failed to create session description: ${i}.`)}setDescriptionSuccess(i,e){console.log(`Local ${e} complete.`)}HangUpCall(i){this.Peers[i]&&(this.Peers[i].isConnected=!1,this.Peers[i].PeerConnection&&(this.Peers[i].PeerConnection.close(),this.Peers[i].PeerConnection.onicecandidate=null,this.Peers[i].PeerConnection.oniceconnectionstatechange=null,this.Peers[i].PeerConnection.onconnectionstatechange=null,this.Peers[i].PeerConnection.ontrack=null,this.Peers[i].PeerConnection.ondatachannel=null,this.Peers[i].PeerConnection.onnegotiationneeded=null),this.Peers[i].PeerConnection=null)}close_webrtc(i,e){var t=this;return(0,P.A)(function*(){var n,s;const o=e&&t.PeerGroups[e]||[i],l=e||(null===(n=t.Peers[i])||void 0===n?void 0:n.groupId),h=()=>{var a;null===(a=t.localMedia)||void 0===a||a.remove(),t.localStream&&(t.localStream.getVideoTracks().forEach(C=>{C.onended=null,C.stop()}),t.localStream.getAudioTracks().forEach(C=>C.stop())),t.localMedia=null,t.localStream=null};for(;o.length;){var f,d,u;const a=o.shift();if(t.HangUpCall(a),null===(f=t.Peers[a])||void 0===f||null===(f=f.remoteMedia)||void 0===f||f.remove(),t.Peers[a]&&(t.Peers[a].remoteMedia=null),null!==(d=t.Peers[a])&&void 0!==d&&d.dataChannel&&(t.Peers[a].dataChannel.onopen=null,t.Peers[a].dataChannel.onclose=null,t.Peers[a].dataChannel.onmessage=null,t.Peers[a].dataChannel=null),delete t.Peers[a],l){var p,E;for(let C=(null===(_=t.PeerGroups[l])||void 0===_?void 0:_.length)-1;C>=0;C--){var _;if(t.PeerGroups[l][C]==a){t.PeerGroups[l].splice(C,1);break}}null!==(p=t.PeerGroups[l])&&void 0!==p&&p.length||(delete t.PeerGroups[l],h(),null===(E=t.p5hangup)||void 0===E||E.call(t))}else if("data"!=(null===(u=t.Peers[a])||void 0===u?void 0:u.TypeIn)){var m;h(),null===(m=t.p5hangup)||void 0===m||m.call(t)}}const T=null===(s=t.PeerGroups[l])||void 0===s?void 0:s.length;t.FocusedRemoteId=T-1,t.OnUse=!!l&&!!T})()}}return(b=k).\u0275fac=function(i){return new(i||b)(R.KVO(G.G),R.KVO(K.n),R.KVO(H.y),R.KVO(Q.X),R.KVO(x.z3))},b.\u0275prov=R.jDH({token:b,factory:b.\u0275fac,providedIn:"root"}),k})()}}]);