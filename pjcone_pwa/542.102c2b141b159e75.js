"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[542],{1186:(Z,P,c)=>{c.d(P,{M:()=>_});const _=(0,c(2726).fo)("SpeechRecognition",{web:()=>c.e(4850).then(c.bind(c,7554)).then(A=>new A.SpeechRecognitionWeb)})},5961:(Z,P,c)=>{c.d(P,{GW:()=>_,dk:()=>A,oK:()=>E});var E=function(o){return o.Prompt="PROMPT",o.Camera="CAMERA",o.Photos="PHOTOS",o}(E||{}),_=function(o){return o.Rear="REAR",o.Front="FRONT",o}(_||{}),A=function(o){return o.Uri="uri",o.Base64="base64",o.DataUrl="dataUrl",o}(A||{})},8162:(Z,P,c)=>{c.d(P,{V1:()=>A,dk:()=>_.dk,oK:()=>_.oK});var E=c(2726),_=c(5961);const A=(0,E.fo)("Camera",{web:()=>c.e(6468).then(c.bind(c,6468)).then(o=>new o.CameraWeb)})},477:(Z,P,c)=>{c.d(P,{$:()=>le});var E=c(5861),_=c(9868),o=c(9468),ne=c(3857),y=c(1325),ae=c(6052),re=c(797);let le=(()=>{var S;class J{constructor(t,a,u,e,n,h,D){this.lang=t,this.modalCtrl=a,this.alertCtrl=u,this.loadingCtrl=e,this.global=n,this.navParams=h,this.indexed=D,this.initialized=!1,this.EventListenerAct=p=>{p.detail.register(130,L=>{})},this.WithoutSave=!0}ngOnInit(){}ionViewDidEnter(){var t=this;return(0,E.Z)(function*(){t.global.p5key.KeyShortCut.HistoryAct=a=>{switch(a){case"Z":t.act_history(-1);break;case"X":t.act_history(1);break;case"C":t.p5voidDraw.change_color();break;case"V":t.p5voidDraw.set_line_weight()}},t.global.p5key.KeyShortCut.AddAct=()=>{t.new_image()},t.global.p5key.KeyShortCut.DeleteAct=()=>{t.dismiss_draw()},t.global.p5key.KeyShortCut.SKeyAct=()=>{t.open_crop_tool()},document.addEventListener("ionBackButton",t.EventListenerAct),t.mainLoading=yield t.loadingCtrl.create({message:t.lang.text.voidDraw.UseThisImage}),t.create_new_canvas({width:t.navParams.data.width,height:t.navParams.data.height,path:t.navParams.data.path})})()}create_new_canvas(t){t.width=t.width||432,t.height=t.height||432,this.p5voidDraw&&this.p5voidDraw.remove(),this.create_p5voidDraw(t)}create_p5voidDraw(t){var a=this;let u=document.getElementById("voidDraw");this.p5voidDraw=new _(e=>{let n,h,D,p,L,O,U,q=e.createColorPicker("#000"),z=!1,ee=e.min(t.width,t.heigth),T=e.createSlider(1,ee/10,ee/100);e.setup=(0,E.Z)(function*(){T.parent(u),T.hide(),e.pixelDensity(1),e.smooth(),e.noLoop(),e.imageMode(e.CENTER),h=void 0,n&&n.remove(),n=void 0,D&&e.remove(),D=e.createCanvas(u.clientWidth,u.clientHeight),D.elt.addEventListener("contextmenu",s=>s.preventDefault()),w.x=e.width/2,w.y=e.height/2,D.parent(u),e.set_line_weight=()=>{z=!z,z?T.show():T.hide()},e.change_color=()=>{console.log("change_color")},e.save_image=()=>{new _(s=>{s.setup=()=>{s.createCanvas(n.width,n.height),h&&s.image(h,0,0),n&&s.image(n,0,0),s.saveFrames("","png",1,1,f=>{let m=f[0].imageData.replace(/"|=|\\/g,"");a.modalCtrl.dismiss({name:`voidDraw_${s.year()}-${s.nf(s.month(),2)}-${s.nf(s.day(),2)}_${s.nf(s.hour(),2)}-${s.nf(s.minute(),2)}-${s.nf(s.second(),2)}.png`,img:m,loadingCtrl:a.mainLoading}),s.remove()})}})},e.history_act=s=>{switch(b=e.min(e.max(0,b+s),v.length),s){case 1:O.style.fill="var(--ion-color-dark)",b==v.length&&(U.style.fill="var(--ion-color-medium)");for(let f=0,m=v[b-1].pos.length-B+1;f<m;f++)W(v[b-1],f);break;case-1:U.style.fill="var(--ion-color-dark)",b<1?(O.style.fill="var(--ion-color-medium)",n.background(255,0),e.redraw()):se()}},e.open_crop_tool=()=>{},p=e.createElement("table"),p.style("position: absolute; top: 0px;"),p.style(`width: 100%; height: ${g}px;`),p.style("background-color: var(--voidDraw-menu-background);"),p.parent(u);let i=p.elt.insertRow(0),l=i.insertCell(0);l.innerHTML='<ion-icon style="width: 27px; height: 27px" name="add"></ion-icon>',l.style.textAlign="center",l.style.cursor="pointer",l.onclick=()=>{a.new_image()};let r=i.insertCell(1);r.innerHTML='<ion-icon id="CropToolNotReady" style="width: 27px; height: 27px" name="crop"></ion-icon>',document.getElementById("CropToolNotReady").style.fill="var(--ion-color-medium)",r.style.textAlign="center",r.style.cursor="pointer",r.onclick=()=>{a.open_crop_tool()};let x=i.insertCell(2);x.innerHTML='<ion-icon style="width: 27px; height: 27px" name="checkmark"></ion-icon>',x.style.textAlign="center",x.style.cursor="pointer",x.onclick=()=>{a.dismiss_draw()},L=e.createElement("table"),L.style("position: absolute; bottom: 0px;"),L.style(`width: 100%; height: ${g}px;`),L.style("background-color: var(--voidDraw-menu-background);"),L.parent(u);let k=L.elt.insertRow(0),N=k.insertCell(0);N.innerHTML='<ion-icon id="undoIcon" style="width: 27px; height: 27px" name="arrow-undo"></ion-icon>',O=document.getElementById("undoIcon"),O.style.fill="var(--ion-color-medium)",N.style.textAlign="center",N.style.cursor="pointer",N.onclick=()=>{a.act_history(-1)};let X=k.insertCell(1);X.innerHTML='<ion-icon id="redoIcon" style="width: 27px; height: 27px" name="arrow-redo"></ion-icon>',U=document.getElementById("redoIcon"),U.style.fill="var(--ion-color-medium)",X.style.textAlign="center",X.style.cursor="pointer",X.onclick=()=>{a.act_history(1)};let j=k.insertCell(2);q.parent(j),j.style.textAlign="center",j.style.cursor="pointer";let $=k.insertCell(3);if($.innerHTML='<ion-icon style="width: 27px; height: 27px" name="pencil"></ion-icon>',$.style.textAlign="center",$.style.cursor="pointer",$.onclick=()=>{a.change_line_weight()},e.SetCanvasViewportInit=()=>{D.hide(),e.resizeCanvas(u.clientWidth,u.clientHeight),I.x=e.width/2,I.y=e.height/2,w.x=0,w.y=0;let s=u.clientHeight-112;C=u.clientWidth/s<n.width/n.height?u.clientWidth/n.width:s/n.height,D.show(),T.position(e.width-T.width,e.height-T.height-g),e.redraw()},n=e.createGraphics(t.width,t.height,e.WEBGL),n.smooth(),n.noLoop(),n.noFill(),n.pixelDensity(1),t.path){let s=yield a.indexed.loadBlobFromUserPath(t.path,""),f=URL.createObjectURL(s);e.loadImage(f,m=>{n.resizeCanvas(m.width,m.height),h=e.createGraphics(m.width,m.height,e.WEBGL),h.noLoop(),h.background(255),h.imageMode(e.CENTER),h.image(m,0,0),h.pixelDensity(1),URL.revokeObjectURL(f),e.SetCanvasViewportInit(),e.redraw()},m=>{console.error("\uadf8\ub9bc\ud310 \ubc30\uacbd \uc774\ubbf8\uc9c0 \ubd88\ub7ec\uc624\uae30 \uc624\ub958: ",m),URL.revokeObjectURL(f)})}else h=e.createGraphics(t.width,t.height,e.WEBGL),h.noLoop(),h.background(255),e.SetCanvasViewportInit(),e.redraw();a.initialized=!0});let w=e.createVector(),C=1,I=e.createVector(0,0),te=e.createVector();e.draw=()=>{e.clear(255,255,255,255),e.push(),e.translate(I),e.scale(C),e.translate(w),h&&(h.push(),h.translate(te),e.image(h,0,0),h.pop()),n&&(n.push(),n.translate(te),e.image(n,0,0),n.pop()),e.pop()};let v=[],b=0,se=()=>{n.background(255,0);for(let i=b-1;i>=0;i--)for(let l=0,r=v[i].pos.length-B+1;l<r;l++)W(v[i],l)};const B=2;let W=(i=M,l=i.pos.length-B)=>{let r=i.pos.slice(l,l+B);n.push(),n.stroke(i.color),n.strokeWeight(i.weight),n.line(r[0].x,r[0].y,r[1].x,r[1].y),n.pop(),n.redraw(),e.redraw()};e.windowResized=()=>{setTimeout(()=>{e.SetCanvasViewportInit()},0)};let M={};const g=56;let G,R,ie,Y,F=0;e.mousePressed=i=>{if(!(e.mouseY<g||e.mouseY>e.height-g))switch(v.length>b&&(v.length=b),i.which){case 1:oe();break;case 3:R=e.createVector(e.mouseX,e.mouseY),Y=w.copy(),G=e.createVector(e.mouseX,e.mouseY);break;case 2:e.SetCanvasViewportInit()}};let oe=(i,l)=>{O.style.fill="var(--ion-color-dark)",U.style.fill="var(--ion-color-medium)";let r=H(i,l),x={x:r.x,y:r.y};M={pos:[],color:q.color(),weight:Number(T.value())};for(let k=0;k<B;k++)M.pos.push(x);v.push(M),b=v.length,W()};e.mouseDragged=i=>{if(!(e.mouseY<g||e.mouseY>e.height-g))switch(i.which){case 1:let l=H();M.pos.push({x:l.x,y:l.y}),W();break;case 3:G=e.createVector(e.mouseX,e.mouseY),w=Y.copy().add(G.sub(R).div(C)),e.redraw()}},e.mouseWheel=i=>{e.mouseY<g||e.mouseY>e.height-g||(ce(H()),C*=i.deltaY<0?1.1:.9,e.redraw())};let ce=i=>{I=e.createVector(e.mouseX,e.mouseY),w=i.mult(-1)},H=(i,l)=>{let r=e.createVector(i||e.mouseX,l||e.mouseY);return r.sub(I),r.div(C),r.sub(w),r},d=[],V=!1;e.touchStarted=i=>{if(d=i.touches,!(i.changedTouches[0].clientY<g||i.changedTouches[0].clientY>e.height-g))switch(V=!0,d.length){case 1:oe(i.changedTouches[0].clientX,i.changedTouches[0].clientY-g);break;case 2:let l=e.createVector(d[0].clientX,d[0].clientY-56),r=e.createVector(d[1].clientX,d[1].clientY-56);F=l.dist(r),R=l.copy().add(r).div(2),Y=w.copy(),ie=C,v.pop();break;default:V=!1,e.SetCanvasViewportInit()}},e.touchMoved=i=>{if(d=i.touches,!(!V||i.changedTouches[0].clientY<g||i.changedTouches[0].clientY>e.height-g)){switch(d.length){case 1:{let l=H(i.changedTouches[0].clientX,i.changedTouches[0].clientY-g);M.pos.push({x:l.x,y:l.y}),W()}break;case 2:{let l=e.createVector(d[0].clientX,d[0].clientY-56),r=e.createVector(d[1].clientX,d[1].clientY-56),x=l.copy().add(r).div(2);C=l.dist(r)/F*ie,w=Y.copy().add(x.sub(R).div(C)),e.redraw()}}return!1}},e.touchEnded=i=>{if(i.changedTouches)switch(d=i.touches,V=!1,d.length){case 0:de();break;case 1:if(!V)return;he(),F=0}};let he=()=>{R=e.createVector(d[0].clientX,d[0].clientY-56),Y=w.copy()},de=()=>{R=void 0}})}change_color(){this.initialized&&this.p5voidDraw.change_color()}new_image(){if(!this.initialized)return;this.alertCtrl.create({header:this.lang.text.voidDraw.newDraw,inputs:[{name:"width",type:"number",placeholder:`${this.lang.text.voidDraw.width} (${this.lang.text.voidDraw.default_size}: 432)`},{name:"height",type:"number",placeholder:`${this.lang.text.voidDraw.height} (${this.lang.text.voidDraw.default_size}: 432)`}],buttons:[{text:this.lang.text.voidDraw.CreateNew,handler:a=>{a.width=a.width?Number(a.width):432,a.height=a.height?Number(a.height):432,this.create_new_canvas(a)}}]}).then(a=>a.present())}change_line_weight(){this.initialized&&this.p5voidDraw.set_line_weight()}act_history(t){this.p5voidDraw.history_act(t)}open_crop_tool(){this.initialized&&this.p5voidDraw.open_crop_tool()}dismiss_draw(){this.mainLoading.present(),this.WithoutSave=!1,this.p5voidDraw.save_image()}ionViewWillLeave(){delete this.global.p5key.KeyShortCut.HistoryAct,delete this.global.p5key.KeyShortCut.AddAct,delete this.global.p5key.KeyShortCut.DeleteAct,delete this.global.p5key.KeyShortCut.SKeyAct,this.p5voidDraw&&this.p5voidDraw.remove()}ionViewDidLeave(){document.removeEventListener("ionBackButton",this.EventListenerAct),this.indexed.removeFileFromUserPath("tmp_files/modify_image.png"),this.WithoutSave&&this.mainLoading.remove()}}return(S=J).\u0275fac=function(t){return new(t||S)(o.Y36(ne.b),o.Y36(y.IN),o.Y36(y.Br),o.Y36(y.HT),o.Y36(ae.AN),o.Y36(y.X1),o.Y36(re.H))},S.\u0275cmp=o.Xpm({type:S,selectors:[["app-void-draw"]],decls:8,vars:1,consts:[[1,"ion-no-border"],["slot","start",3,"click"],["defaultHref",""],["id","voidDraw",1,"full_screen",2,"display","flex","overflow","hidden"]],template:function(t,a){1&t&&(o.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),o._uU(3),o.qZA(),o.TgZ(4,"ion-buttons",1),o.NdJ("click",function(){return a.modalCtrl.dismiss()}),o._UZ(5,"ion-back-button",2),o.qZA()()(),o.TgZ(6,"ion-content"),o._UZ(7,"div",3),o.qZA()),2&t&&(o.xp6(3),o.Oqu(a.lang.text.ChatRoom.voidDraw))},dependencies:[y.oU,y.Sm,y.W2,y.Gu,y.wd,y.sr,y.cs]}),J})()}}]);