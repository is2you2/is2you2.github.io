"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4722],{4722:(A,I,c)=>{c.r(I),c.d(I,{OthersProfilePageModule:()=>Y});var C=c(177),S=c(4341),_=c(5374),P=c(9858),V=c(467),j=c(8326),t=c(3953),G=c(4237),N=c(8065),X=c(9900),L=c(4234),M=c(482),T=c(3656);function U(i,f){if(1&i){const a=t.RV6();t.j41(0,"td")(1,"ion-button",9),t.bIt("click",function(){t.eBV(a);const s=t.XpG(2);return t.Njj(s.notification_react(-5))}),t.EFF(2),t.k0s()()}if(2&i){const a=t.XpG(2);t.R7$(2),t.SpI(" ",a.lang.text.OtherProfile.add_to_group," ")}}function F(i,f){if(1&i){const a=t.RV6();t.j41(0,"td")(1,"ion-button",9),t.bIt("click",function(){t.eBV(a);const s=t.XpG(2);return t.Njj(s.notification_react(-2))}),t.EFF(2),t.k0s()()}if(2&i){const a=t.XpG(2);t.R7$(2),t.SpI(" ",a.lang.text.OtherProfile.add_friend," ")}}function B(i,f){if(1&i){const a=t.RV6();t.j41(0,"td")(1,"ion-button",10),t.bIt("click",function(){t.eBV(a);const s=t.XpG(2);return t.Njj(s.kick_user_from_group())}),t.EFF(2),t.k0s()()}if(2&i){const a=t.XpG(2);t.R7$(2),t.SpI(" ",a.lang.text.OtherProfile.kick_from_group," ")}}function Z(i,f){if(1&i){const a=t.RV6();t.j41(0,"div",5)(1,"table",6)(2,"tr"),t.DNE(3,U,3,1,"td",7)(4,F,3,1,"td",7),t.j41(5,"td")(6,"ion-button",8),t.bIt("click",function(){t.eBV(a);const s=t.XpG();return t.Njj(s.create_chat())}),t.EFF(7),t.k0s()(),t.DNE(8,B,3,1,"td",7),t.k0s()()()}if(2&i){const a=t.XpG();t.R7$(3),t.Y8G("ngIf",a.has_admin&&a.additional_buttons[-5]),t.R7$(),t.Y8G("ngIf",a.additional_buttons[-2]),t.R7$(2),t.Y8G("disabled",a.lock_create_chat),t.R7$(),t.SpI(" ",a.lang.text.OtherProfile.privacy_chat," "),t.R7$(),t.Y8G("ngIf",a.has_admin)}}const z=[{path:"",component:(()=>{var i;class f{constructor(e,s,o,r,l,h,m,v){this.nakama=e,this.statusBar=s,this.p5toast=o,this.lang=r,this.global=l,this.route=h,this.router=m,this.navCtrl=v,this.info={},this.group_info={},this.additional_buttons={},this.has_admin=!1,this.isClickDisplayNameEdit=!1,this.lock_create_chat=!1}ngOnInit(){this.route.queryParams.subscribe(e=>{try{const s=this.router.getCurrentNavigation().extras.state;this.info=s.info,this.has_admin=s.has_admin,this.group_info=s.group,this.isOfficial=this.group_info.server.isOfficial,this.target=this.group_info.server.target,this.nakama.load_other_user(this.info.user.id,this.isOfficial,this.target),this.nakama.socket_reactive["others-profile"]=o=>{this.p5canvas.ChangeImageSmooth(o)},this.nakama.socket_reactive["others-online"]=()=>{this.p5canvas.loop()},this.catch_user_noties()}catch(s){console.log("\ub2e4\ub978 \uc0ac\ub78c\uc758 \ud504\ub85c\ud544 \uc5f4\uae30 \uc2e4\ud328: ",s)}})}ionViewWillEnter(){this.OtherCanvasDiv=document.getElementById("OtherUserCanvasDiv"),this.p5canvas=new j(e=>{let o,r,l,h,v,n,m=1,b="0, 0, 0",x=0,E=!1;e.setup=()=>{let O=e.color(`#${(this.info.user.id.replace(/[^5-79a-b]/g,"")+"abcdef").substring(0,6)}`);b=`${e.red(O)}, ${e.green(O)}, ${e.blue(O)}`,v=e.createDiv(),v.style("width","100%"),v.style("height","100%"),v.style("background-image",`linear-gradient(to top, rgba(${b}, 0), rgba(${b}, 0))`),v.parent(this.OtherCanvasDiv),e.noCanvas(),e.pixelDensity(1),n=e.createDiv();const u="156px";n.style("width",u),n.style("height",u),n.style("position","absolute"),n.style("top","120px"),n.style("left","50%"),n.style("transform","translateX(-50%)"),n.style("border-radius",u),n.style("background-image","url(assets/data/avatar.svg)"),n.style("background-position","center"),n.style("background-repeat","no-repeat"),n.style("background-size","cover"),n.parent(this.OtherCanvasDiv);let g=e.createDiv();const $="36px";g.style("background-color",this.info.user.online?this.statusBar.colors.online:this.statusBar.colors.offline),g.style("width",$),g.style("height",$),g.style("position","absolute"),g.style("top","128px"),g.style("left",this.OtherCanvasDiv.clientWidth/2+38+"px"),g.style("border-radius",$),g.parent(this.OtherCanvasDiv),e.OnlineLamp=g,l=e.createImg(this.info.user.img,"profile_img"),l.style("width",u),l.style("height",u),l.style("border-radius",u),l.style("position","absolute"),l.style("object-fit","cover"),this.info.user.img||l.hide(),l.parent(n),h=e.createImg(void 0,"before_img"),h.style("width",u),h.style("height",u),h.style("border-radius",u),h.style("position","absolute"),h.style("object-fit","cover"),h.hide(),h.parent(n),e.ChangeImageSmooth=k=>{n.style("background-image","url(assets/data/avatar.svg)"),k?(h.elt.src=void 0,h.hide()):(h.elt.src=l.elt.src,h.show()),l.elt.src=k,m=1,e.loop(),this.info.user.img=k,k?l.show():l.hide()};const D="36px";let d=e.createDiv();d.style("width","100%"),d.style("position","absolute"),d.style("top","330px"),d.style("display","flex"),d.style("flex-direction","column"),d.parent(this.OtherCanvasDiv);let R=this.nakama.GetOverrideName(this.info.user.id,this.isOfficial,this.target);o=e.createDiv(),o.style("font-size",D),o.style("font-weight","bold"),o.style("align-self","center"),o.style("width","80%"),o.style("text-align","center");let w=e.createSpan(R||this.info.user.display_name||this.lang.text.Profile.noname_user);w.parent(o),e.createSpan('<ion-icon name="pencil-outline" style="width: 24px; height: 24px; margin-left: 8px"></ion-icon>').parent(o),o.elt.onclick=()=>{E=!0,r.value(w.html()),r.attribute("placeholder",this.info.user.display_name||this.lang.text.Profile.noname_user),r.show(),o.hide(),r.elt.focus(),this.isClickDisplayNameEdit=!0},o.parent(d),r=e.createInput(),r.style("font-size",D),r.style("font-weight","bold"),r.style("align-self","center"),r.style("width","80%"),r.style("text-align","center"),r.attribute("placeholder",this.lang.text.Profile.name_placeholder),o.style("text-align","center"),r.parent(d),r.hide(),r.elt.addEventListener("focusout",()=>{E=!1;let k=`${r.value()}`;this.nakama.SaveOverrideName(this.info.user.id,k,this.isOfficial,this.target),k?p.removeAttribute("hidden"):p.attribute("hidden","true"),w.html(`${k||this.info.user.display_name||this.lang.text.Profile.noname_user}`),r.hide(),o.show()});let p=e.createDiv(this.info.user.display_name||this.lang.text.Profile.noname_user);p.style("color","var(--ion-color-medium)"),p.style("align-self","center"),p.style("margin-top","36px"),p.style("width","80%"),p.style("text-align","center"),R||p.attribute("hidden","true"),p.parent(d);let y=e.createDiv(this.info.user.id);y.style("color","var(--ion-color-medium)"),y.style("align-self","center"),y.style("margin-top","36px"),y.style("width","80%"),y.style("text-align","center"),y.style("cursor","copy"),y.parent(d),y.elt.onclick=()=>{this.copy_id()},setTimeout(()=>{e.windowResized()},0)},e.draw=()=>{m>0&&(m-=.025,h.style("opacity",`${m}`),l.style("opacity",""+(1-m))),this.info.user.online?this.lerpVal<1?this.lerpVal+=.025:this.lerpVal=1:this.lerpVal>0?this.lerpVal-=.025:this.lerpVal=0,x<1&&(x+=.025),l.style("filter",`grayscale(${e.lerp(.9,0,this.lerpVal)}) contrast(${e.lerp(1.4,1,this.lerpVal)})`),h.style("filter",`grayscale(${e.lerp(.9,0,this.lerpVal)}) contrast(${e.lerp(1.4,1,this.lerpVal)})`),v.style("background-image",`linear-gradient(to top, rgba(${b}, ${e.min(1,x)/2}), rgba(${b}, 0))`),m<=0&&(this.lerpVal>=1||this.lerpVal<=0)&&x>=1&&(this.info.user.img&&n.style("background-image",""),this.p5canvas.OnlineLamp.style("background-color",this.info.user.online?this.statusBar.colors.online:this.statusBar.colors.offline),e.noLoop())},e.windowResized=()=>{e.OnlineLamp.style("left",this.OtherCanvasDiv.clientWidth/2+38+"px")},e.keyPressed=O=>{"Enter"==O.code&&E&&r.elt.blur()}})}ionViewDidEnter(){this.global.p5key.KeyShortCut.Escape=()=>{this.navCtrl.pop()}}catch_user_noties(){this.nakama.noti_origin[this.isOfficial]&&this.nakama.noti_origin[this.isOfficial][this.target]&&Object.keys(this.nakama.noti_origin[this.isOfficial][this.target]).forEach(o=>{this.nakama.noti_origin[this.isOfficial][this.target][o].sender_id==this.info.user.id&&(this.additional_buttons[this.nakama.noti_origin[this.isOfficial][this.target][o].code.toString()]=o)})}notification_react(e){switch(e){case 0:case-1:case-2:break;case-5:this.nakama.servers[this.isOfficial][this.target].client.addGroupUsers(this.nakama.servers[this.isOfficial][this.target].session,this.group_info.group_id||this.group_info.id,[this.info.user.id]).then(s=>{s||console.warn("\ubc34 \uc720\uc800\uc5d0 \ub300\ud55c\uac83 \uac19\uc74c, \ud655\uc778 \ud544\uc694"),this.p5toast.show({text:`${this.lang.text.OtherProfile.added_to_group}: ${this.info.user.display_name||this.lang.text.Profile.noname_user}`}),this.nakama.servers[this.isOfficial][this.target].client.deleteNotifications(this.nakama.servers[this.isOfficial][this.target].session,[this.additional_buttons[e.toString()]]).then(o=>{o||console.warn("\uc54c\ub9bc \ubd80\uc815 \uac80\ud1a0 \ud544\uc694"),delete this.additional_buttons[e.toString()],this.nakama.update_notifications(this.isOfficial,this.target),this.info.status="online",this.p5canvas.loop()})});break;default:console.warn("\uc608\uc0c1\ud558\uc9c0 \ubabb\ud55c \uc54c\ub9bc \ubc18\uc751: ",e)}}create_chat(){var e=this;return(0,V.A)(function*(){if(!e.lock_create_chat){e.lock_create_chat=!0;try{let s=yield e.nakama.join_chat_with_modulation(e.info.user.id,2,e.isOfficial,e.target,!0);e.nakama.go_to_chatroom_without_admob_act(s),e.lock_create_chat=!1,e.navCtrl.pop()}catch(s){e.lock_create_chat=!1,console.error(s)}}})()}kick_user_from_group(){switch(this.info.state){case 0:case 1:case 2:this.after_announce_kick();break;case 3:this.nakama.servers[this.isOfficial][this.target].client.deleteNotifications(this.nakama.servers[this.isOfficial][this.target].session,[this.additional_buttons[-5]]).then(e=>{e||console.warn("\uc54c\ub9bc \ubd80\uc815 \uac80\ud1a0 \ud544\uc694"),this.after_announce_kick(),delete this.additional_buttons[-5],this.nakama.update_notifications(this.isOfficial,this.target),this.info.status="missing",this.p5canvas.loop()});break;default:console.warn("\uc608\uc0c1\ud558\uc9c0 \ubabb\ud55c \uadf8\ub8f9 \uc0ac\uc6a9\uc790 \uc0c1\ud0dc: ",this.info)}}after_announce_kick(){this.nakama.servers[this.isOfficial][this.target].client.kickGroupUsers(this.nakama.servers[this.isOfficial][this.target].session,this.group_info.group_id||this.group_info.id,[this.info.user.id]).then(e=>{this.p5toast.show({text:`${this.lang.text.OtherProfile.kicked_from_group}: ${this.info.user.display_name||this.lang.text.Profile.noname_user}`}),this.navCtrl.pop()})}copy_id(){this.global.WriteValueToClipboard("text/plain",this.info.user.id)}ionViewWillLeave(){delete this.global.p5key.KeyShortCut.Escape}ngOnDestroy(){this.route.queryParams.unsubscribe(),delete this.nakama.socket_reactive["others-profile"],delete this.nakama.socket_reactive["others-online"],this.p5canvas.remove()}}return(i=f).\u0275fac=function(e){return new(e||i)(t.rXU(G.X),t.rXU(N.j),t.rXU(X.G),t.rXU(L.y),t.rXU(M.z3),t.rXU(P.nX),t.rXU(P.Ix),t.rXU(T.q9))},i.\u0275cmp=t.VBU({type:i,selectors:[["app-others-profile"]],decls:9,vars:2,consts:[[1,"ion-no-border"],["slot","start"],["defaultHref",""],["id","OtherUserCanvasDiv",2,"position","absolute","width","100%","height","100%","display","flex"],["style","width: 100%; position: absolute; bottom: 0;",4,"ngIf"],[2,"width","100%","position","absolute","bottom","0"],["id","input_table",2,"width","100%","background-color","black"],[4,"ngIf"],["expand","block",3,"click","disabled"],["expand","block",3,"click"],["color","danger","expand","block",3,"click"]],template:function(e,s){1&e&&(t.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),t.EFF(3),t.k0s(),t.j41(4,"ion-buttons",1),t.nrm(5,"ion-back-button",2),t.k0s()()(),t.j41(6,"ion-content"),t.nrm(7,"div",3),t.DNE(8,Z,9,5,"div",4),t.k0s()),2&e&&(t.R7$(3),t.JRh(s.lang.text.OtherProfile.Title),t.R7$(5),t.Y8G("ngIf","online"==s.statusBar.groupServer[s.isOfficial][s.target]))},dependencies:[C.bT,_.Jm,_.QW,_.W9,_.eU,_.BC,_.ai,_.el],styles:[".fore-gradient[_ngcontent-%COMP%]{position:relative;background-image:linear-gradient(to top,#000,#0000);width:100%;height:100%}.content_size[_ngcontent-%COMP%]{height:360px}"]}),f})()}];let W=(()=>{var i;class f{}return(i=f).\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.$C({type:i}),i.\u0275inj=t.G2t({imports:[P.iI.forChild(z),P.iI]}),f})(),Y=(()=>{var i;class f{}return(i=f).\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.$C({type:i}),i.\u0275inj=t.G2t({imports:[C.MD,S.YN,_.bv,W]}),f})()}}]);