"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7048],{5404:(X,Y,u)=>{u.d(Y,{Gq:()=>C});var C=function(R){return R.UTF8="utf8",R.ASCII="ascii",R.UTF16="utf16",R}(C||{})},8744:(X,Y,u)=>{u.d(Y,{K:()=>s});var d=u(1528),C=u(5193),$=u(9352),R=u(896),W=u(2272),t=u(4496),y=u(5624),i=u(9240),T=u(4668),V=u(4500),E=u(544),B=u(3824),D=u(5020),O=u(7136),k=u(7756),A=u(6819),M=u(1368),N=u(4716);const z=["ShowContentInfoIonic"];function Z(a,r){if(1&a){const l=t.KQA();t.I0R(0,"ion-icon",20),t.qCj("click",function(){t.usT(l);const n=t.GaO();return t.CGJ(n.ChangeToAnother(-1))}),t.C$Y()}}function q(a,r){if(1&a&&(t.I0R(0,"ion-label",21),t.OEk(1),t.C$Y()),2&a){const l=t.GaO();t.yG2(),t.cNF(l.RelevanceIndex+" / "+l.Relevances.length)}}function ee(a,r){if(1&a){const l=t.KQA();t.I0R(0,"ion-icon",22),t.qCj("click",function(){t.usT(l);const n=t.GaO();return t.CGJ(n.ChangeToAnother(1))}),t.C$Y()}}function te(a,r){if(1&a&&(t.I0R(0,"ion-label",23),t.OEk(1),t.C$Y()),2&a){const l=t.GaO();t.yG2(),t.cNF(l.FileInfo.filename||l.FileInfo.name)}}function ie(a,r){if(1&a){const l=t.KQA();t.I0R(0,"ion-input",24),t.iHE("ngModelChange",function(n){t.usT(l);const _=t.GaO();return t.kNx(_.NewTextFileName,n)||(_.NewTextFileName=n),t.CGJ(n)}),t.C$Y()}if(2&a){const l=t.GaO();t.OKB("ngModel",l.NewTextFileName),t.E7m("placeholder",l.FileInfo.filename||l.FileInfo.name)}}function ne(a,r){if(1&a){const l=t.KQA();t.I0R(0,"ion-button",25),t.qCj("click",function(){t.usT(l);const n=t.GaO();return t.CGJ(n.close_text_edit())}),t.wR5(1,"ion-icon",26),t.C$Y()}}function oe(a,r){if(1&a){const l=t.KQA();t.I0R(0,"ion-button",25),t.qCj("click",function(){t.usT(l);const n=t.GaO();return t.CGJ(n.SaveText())}),t.wR5(1,"ion-icon",27),t.C$Y()}}function ae(a,r){if(1&a){const l=t.KQA();t.I0R(0,"ion-button",28),t.qCj("click",function(){t.usT(l);const n=t.GaO();return t.CGJ(n.DownloadAllListFiles())}),t.wR5(1,"ion-icon",29),t.C$Y()}if(2&a){const l=t.GaO();t.E7m("disabled",l.isDownloading||l.MessageInfo.content.transfer_index&&"download"==l.MessageInfo.content.transfer_index.OnTransfer)}}function le(a,r){1&a&&(t.I0R(0,"ion-button",30),t.wR5(1,"ion-icon",31),t.C$Y())}function se(a,r){if(1&a){const l=t.KQA();t.I0R(0,"ion-item",34),t.qCj("click",function(){t.usT(l);const n=t.GaO(3);return t.CGJ(n.open_text_editor())}),t.I0R(1,"ion-label"),t.OEk(2),t.C$Y()()}if(2&a){const l=t.GaO(3);t.yG2(2),t.cNF(l.lang.text.ContentViewer.EditText)}}function re(a,r){if(1&a){const l=t.KQA();t.I0R(0,"ion-item",34),t.qCj("click",function(){t.usT(l);const n=t.GaO(3);return t.CGJ(n.modify_image())}),t.I0R(1,"ion-label"),t.OEk(2),t.C$Y()()}if(2&a){const l=t.GaO(3);t.yG2(2),t.cNF(l.lang.text.ContentViewer.Edit)}}function ce(a,r){if(1&a){const l=t.KQA();t.I0R(0,"ion-item",34),t.qCj("click",function(){t.usT(l);const n=t.GaO(3);return t.CGJ(n.ShareContent())}),t.I0R(1,"ion-label"),t.OEk(2),t.C$Y()()}if(2&a){const l=t.GaO(3);t.yG2(2),t.cNF(l.lang.text.ContentViewer.ShareContent)}}function _e(a,r){if(1&a){const l=t.KQA();t.I0R(0,"ion-item",34),t.qCj("click",function(){t.usT(l);const n=t.GaO(3);return t.CGJ(n.download_file())}),t.I0R(1,"ion-label"),t.OEk(2),t.C$Y()()}if(2&a){const l=t.GaO(3);t.yG2(2),t.cNF(l.lang.text.ContentViewer.Download)}}function de(a,r){if(1&a){const l=t.KQA();t.I0R(0,"ion-item",34),t.qCj("click",function(){t.usT(l);const n=t.GaO(3);return t.CGJ(n.RemoveFile())}),t.I0R(1,"ion-label"),t.OEk(2),t.C$Y()()}if(2&a){const l=t.GaO(3);t.yG2(2),t.cNF(l.lang.text.ContentViewer.RemoveFile)}}function me(a,r){if(1&a){const l=t.KQA();t.I0R(0,"ion-content")(1,"ion-list"),t.yuY(2,se,3,1,"ion-item",33)(3,re,3,1,"ion-item",33),t.I0R(4,"ion-item",34),t.qCj("click",function(){t.usT(l);const n=t.GaO(2);return t.CGJ(n.open_bottom_modal())}),t.I0R(5,"ion-label"),t.OEk(6),t.C$Y()(),t.yuY(7,ce,3,1,"ion-item",33)(8,_e,3,1,"ion-item",33)(9,de,3,1,"ion-item",33),t.C$Y()()}if(2&a){const l=t.GaO(2);t.yG2(2),t.E7m("ngIf",!l.NeedDownloadFile&&"text"==l.FileInfo.viewer),t.yG2(),t.E7m("ngIf",!l.NeedDownloadFile&&"audio"!=l.FileInfo.viewer),t.yG2(3),t.cNF(l.lang.text.ContentViewer.ContentInfo),t.yG2(),t.E7m("ngIf",!l.NeedDownloadFile),t.yG2(),t.E7m("ngIf",!l.NeedDownloadFile),t.yG2(),t.E7m("ngIf",!l.NeedDownloadFile&&l.OpenInChannelChat&&!l.FileInfo.url)}}function fe(a,r){1&a&&(t.I0R(0,"ion-popover",32),t.yuY(1,me,10,6,"ng-template"),t.C$Y())}function ge(a,r){if(1&a&&(t.I0R(0,"div")(1,"div",36),t.wR5(2,"ion-icon",37),t.I0R(3,"div")(4,"ion-label",38),t.OEk(5),t.C$Y()()()()),2&a){const l=t.GaO(2);t.yG2(5),t.cNF(l.lang.text.ContentViewer.OnLoadContent)}}function he(a,r){if(1&a&&(t.I0R(0,"td"),t.yuY(1,ge,6,1,"div",17),t.wR5(2,"div",35),t.C$Y()),2&a){const l=t.GaO();t.yG2(),t.E7m("ngIf",!l.ContentOnLoad)}}function ue(a,r){if(1&a){const l=t.KQA();t.I0R(0,"td")(1,"ion-grid")(2,"ion-row",39)(3,"ion-col",40)(4,"ion-button",41),t.qCj("click",function(){t.usT(l);const n=t.GaO();return t.CGJ(n.DownloadCurrentFile())}),t.OEk(5),t.C$Y()()()()()}if(2&a){const l=t.GaO();t.yG2(4),t.E7m("disabled",l.isDownloading||l.MessageInfo.content.transfer_index&&"download"==l.MessageInfo.content.transfer_index.OnTransfer),t.yG2(),t.oRS(" ",l.MessageInfo.content.transfer_index&&"download"==l.MessageInfo.content.transfer_index.OnTransfer?l.lang.text.ContentViewer.FileDownloading:l.lang.text.ContentViewer.DownloadThisFile," ")}}function pe(a,r){if(1&a){const l=t.KQA();t.I0R(0,"ion-item",34),t.qCj("click",function(){t.usT(l);const n=t.GaO(2);return t.CGJ(n.copy_url(n.content_creator.user_id))}),t.I0R(1,"ion-label"),t.OEk(2),t.C$Y(),t.I0R(3,"ion-label",43),t.OEk(4),t.C$Y()()}if(2&a){const l=t.GaO(2);t.yG2(2),t.cNF(l.lang.text.ContentInfo.LastPost),t.yG2(2),t.oRS(" ",l.content_creator.publisher||l.content_creator.display_name||l.lang.text.Profile.noname_user,"")}}function xe(a,r){if(1&a&&(t.I0R(0,"ion-item",46)(1,"ion-label"),t.OEk(2),t.C$Y(),t.I0R(3,"ion-label",43),t.OEk(4),t.C$Y()()),2&a){const l=t.GaO(2);t.yG2(2),t.cNF(l.lang.text.ContentInfo.SourceFrom),t.yG2(2),t.cNF(l.content_creator.various_display)}}function Ie(a,r){if(1&a&&(t.I0R(0,"ion-item")(1,"ion-label"),t.OEk(2),t.C$Y(),t.I0R(3,"ion-label",43),t.OEk(4),t.C$Y()()),2&a){const l=t.GaO(2);t.yG2(2),t.cNF(l.lang.text.ContentInfo.FileSize),t.yG2(2),t.cNF(l.CurrentFileSize)}}function ve(a,r){1&a&&t.wR5(0,"ion-icon",55)}function ye(a,r){1&a&&t.wR5(0,"ion-icon",56)}function Ce(a,r){1&a&&t.wR5(0,"ion-icon",57)}function Fe(a,r){1&a&&t.wR5(0,"ion-icon",58)}function be(a,r){1&a&&t.wR5(0,"ion-icon",59)}function De(a,r){1&a&&t.wR5(0,"ion-icon",60)}function g(a,r){1&a&&(t.I0R(0,"ion-avatar"),t.wR5(1,"img",61),t.C$Y())}function I(a,r){if(1&a){const l=t.KQA();t.I0R(0,"div")(1,"div",47),t.OEk(2),t.I0R(3,"ion-chip",48),t.qCj("click",function(){const _=t.usT(l).$implicit,h=t.GaO(2);return t.CGJ(h.toast_info(_))}),t.yuY(4,ve,1,0,"ion-icon",49)(5,ye,1,0,"ion-icon",50)(6,Ce,1,0,"ion-icon",51)(7,Fe,1,0,"ion-icon",52)(8,be,1,0,"ion-icon",53)(9,De,1,0,"ion-icon",54)(10,g,2,0,"ion-avatar",17),t.I0R(11,"ion-label"),t.OEk(12),t.C$Y()()()()}if(2&a){const l=r.$implicit,e=t.GaO(2);t.yG2(2),t.oRS(" ",l.timeDisplay," "),t.yG2(2),t.E7m("ngIf","loaded"==l.various),t.yG2(),t.E7m("ngIf","camera"==l.various),t.yG2(),t.E7m("ngIf","link"==l.various),t.yG2(),t.E7m("ngIf","long_text"==l.various),t.yG2(),t.E7m("ngIf","textedit"==l.various),t.yG2(),t.E7m("ngIf","shared"==l.various),t.yG2(),t.E7m("ngIf","voidDraw"==l.various),t.yG2(2),t.cNF(l.publisher||l.display_name||e.lang.text.Profile.noname_user)}}function m(a,r){if(1&a){const l=t.KQA();t.I0R(0,"ion-content")(1,"ion-item-divider")(2,"ion-label"),t.OEk(3),t.C$Y()(),t.yuY(4,pe,5,2,"ion-item",33)(5,xe,5,2,"ion-item",42)(6,Ie,5,2,"ion-item",17),t.I0R(7,"ion-item")(8,"ion-label"),t.OEk(9),t.C$Y(),t.I0R(10,"ion-label",43),t.OEk(11),t.C$Y()(),t.I0R(12,"ion-item-divider")(13,"ion-label"),t.OEk(14),t.C$Y()(),t.yuY(15,I,13,9,"div",44),t.I0R(16,"ion-item",34),t.qCj("click",function(){t.usT(l),t.GaO();const n=t.Gew(25);return t.CGJ(n.dismiss())}),t.I0R(17,"ion-label",45),t.OEk(18),t.C$Y()()()}if(2&a){const l=t.GaO();t.yG2(3),t.cNF(l.lang.text.ContentInfo.WorkLogs),t.yG2(),t.E7m("ngIf",!l.FromUserFsDir),t.yG2(),t.E7m("ngIf",l.content_creator.various),t.yG2(),t.E7m("ngIf",!l.FileInfo.url),t.yG2(3),t.cNF(l.lang.text.ContentInfo.TimeAt),t.yG2(2),t.cNF(l.content_creator.timeDisplay),t.yG2(3),t.cNF(l.lang.text.ContentInfo.WorkHistory),t.yG2(),t.E7m("ngForOf",l.content_related_creator),t.yG2(3),t.cNF(l.lang.text.ContentInfo.CloseModal)}}const o=()=>[.5,1];let s=(()=>{var a;class r{constructor(e,n,_,h,c,f,p,F,w,v,U,S){this.modalCtrl=e,this.navParams=n,this.indexed=_,this.lang=h,this.file=c,this.p5toast=f,this.alertCtrl=p,this.loadingCtrl=F,this.global=w,this.nakama=v,this.mClipboard=U,this.noti=S,this.useP5Navigator=!0,this.RelevanceIndex=0,this.HaveRelevances=!1,this.NeedDownloadFile=!1,this.ContentOnLoad=!1,this.isDownloading=!1,this.OpenInChannelChat=!1,this.isChannelOnline=!0,this.fromLocalChannel=!1,this.EventListenerAct=j=>{j.detail.register(120,P=>{})},this.isTextEditMode=!1,this.NewTextFileName="",this.image_info={},this.forceWrite=!1}ngOnInit(){var e=this;return(0,d.c)(function*(){e.fromLocalChannel=e.navParams.get("local"),e.MessageInfo=e.navParams.get("info"),e.OpenInChannelChat=void 0!==e.MessageInfo.code,e.CurrentViewId=e.MessageInfo.message_id,e.FileInfo=e.MessageInfo.content,e.ContentBox=document.getElementById("ContentBox"),e.FileHeader=document.getElementById("FileHeader"),e.isOfficial=e.navParams.get("isOfficial"),e.target=e.navParams.get("target");try{e.isChannelOnline="online"==e.nakama.channels_orig[e.isOfficial][e.target][e.MessageInfo.channel_id].info.status,e.isChannelOnline=e.isChannelOnline||"online"==e.nakama.channels_orig[e.isOfficial][e.target][e.MessageInfo.channel_id].status||"pending"==e.nakama.channels_orig[e.isOfficial][e.target][e.MessageInfo.channel_id].status}catch{}if("text"===(e.targetDB=e.navParams.get("targetDB"),e.FromUserFsDir=e.navParams.get("no_edit")||!1,e.FileInfo.is_new));else{if(e.Relevances=e.navParams.get("relevance"),e.Relevances){for(let n=0,_=e.Relevances.length;n<_;n++)if(e.Relevances[n].message_id&&e.MessageInfo.message_id){if(e.Relevances[n].message_id==e.MessageInfo.message_id){e.RelevanceIndex=n+1;break}}else if(e.Relevances[n].content.path==e.MessageInfo.content.path){e.RelevanceIndex=n+1;break}e.HaveRelevances=e.Relevances.length>1}else e.HaveRelevances=!1;e.CreateContentInfo()}})()}reinit_content_data(e){var n=this;return(0,d.c)(function*(){if(n.NewTextFileName="",n.NeedDownloadFile=!0,n.ContentOnLoad=!1,n.isTextEditMode=!1,n.MessageInfo=e,n.CurrentViewId=n.MessageInfo.message_id,n.FileInfo=n.MessageInfo.content,URL.revokeObjectURL(n.FileURL),n.FileInfo.url)n.FileURL=n.FileInfo.url,n.CreateContentInfo(),n.NeedDownloadFile=!1,n.ContentOnLoad=!0,n.ionViewDidEnter();else{let _=n.FileInfo.path||`servers/${n.isOfficial}/${n.target}/channels/${e.channel_id}/files/msg_${e.message_id}.${e.content.file_ext}`;n.image_info.path=_,n.NeedDownloadFile=yield n.indexed.checkIfFileExist(`${_}.history`,void 0,n.targetDB);try{n.blob=yield n.indexed.loadBlobFromUserPath(_,n.FileInfo.type,void 0,n.targetDB),n.CreateContentInfo(),n.ionViewDidEnter()}catch{n.FileURL=void 0,n.blob=void 0,n.isDownloading=!1,n.NeedDownloadFile=!0,n.ContentOnLoad=!1,n.CreateContentInfo(),n.p5canvas&&n.p5canvas.remove(),n.p5canvas=new $(c=>{c.setup=()=>{c.noCanvas()}}),n.ChangeContentWithKeyInput()}}})()}DownloadAllListFiles(){this.alertCtrl.create({header:this.lang.text.ContentViewer.DownloadAllFiles,message:this.lang.text.ContentViewer.DownloadLoadedList,buttons:[{text:this.lang.text.ContentViewer.DownloadThisFile,handler:()=>{this.DownloadInOrder()}}]}).then(e=>e.present())}DownloadInOrder(){var e=this;return(0,d.c)(function*(){("Android"==C.s1||"iOS"==C.s1)&&e.noti.noti.schedule({id:6,title:e.lang.text.ContentViewer.DownloadThisFile,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://diychat",color:"b0b0b0"});for(let n=0,_=e.Relevances.length;n<_;n++)e.nakama.OnTransfer[e.isOfficial]||(e.nakama.OnTransfer[e.isOfficial]={}),e.nakama.OnTransfer[e.isOfficial][e.target]||(e.nakama.OnTransfer[e.isOfficial][e.target]={}),e.nakama.OnTransfer[e.isOfficial][e.target][e.Relevances[n].channel_id]||(e.nakama.OnTransfer[e.isOfficial][e.target][e.Relevances[n].channel_id]={}),e.nakama.OnTransfer[e.isOfficial][e.target][e.Relevances[n].channel_id][e.Relevances[n].message_id]||(e.nakama.OnTransfer[e.isOfficial][e.target][e.Relevances[n].channel_id][e.Relevances[n].message_id]={});for(let n=0,_=e.Relevances.length;n<_;n++){("Android"==C.s1||"iOS"==C.s1)&&e.noti.noti.schedule({id:6,title:`${e.lang.text.ContentViewer.DownloadThisFile}: ${_-n}`,progressBar:{value:n,maxValue:_},sound:null,smallIcon:"res://diychat",color:"b0b0b0"});let h=`servers/${e.isOfficial}/${e.target}/channels/${e.Relevances[n].channel_id}/files/msg_${e.Relevances[n].message_id}.${e.Relevances[n].content.file_ext}`;if(!(yield e.indexed.checkIfFileExist(h,void 0,e.targetDB)))try{yield e.DownloadCurrentFile(n)}catch(f){console.log(f)}}e.noti.ClearNoti(6)})()}ChangeToAnother(e){let n=this.RelevanceIndex+e;n<=0||n>this.Relevances.length||(this.p5canvas&&this.p5canvas.remove(),this.RelevanceIndex=n,this.FileInfo={file_ext:""},setTimeout(()=>{this.reinit_content_data(this.Relevances[this.RelevanceIndex-1])},100))}DownloadCurrentFile(e){var n=this;return(0,d.c)(function*(){n.isDownloading=!0;let _=0,h=n.Relevances[null!=e?e:n.RelevanceIndex-1],c=`servers/${n.isOfficial}/${n.target}/channels/${h.channel_id}/files/msg_${h.message_id}.${h.content.file_ext}`;try{let p=yield n.indexed.loadTextFromUserPath(`${c}.history`,void 0,n.targetDB);_=JSON.parse(p).index}catch{}let f=h.message_id;yield n.nakama.ReadStorage_From_channel(h,c,n.isOfficial,n.target,_),n.CurrentViewId==f&&n.reinit_content_data(h)})()}formatBytes(e,n=2){if(!+e)return"0 Bytes";const h=n<0?0:n,f=Math.floor(Math.log(e)/Math.log(1024));return`${parseFloat((e/Math.pow(1024,f)).toFixed(h))} ${["Bytes","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"][f]}`}CreateContentInfo(){try{if(this.FileInfo.url||(this.CurrentFileSize=this.formatBytes(this.FileInfo.size||this.FileInfo.filesize||this.blob.size)),this.content_creator=this.FileInfo.content_creator||{timestamp:this.FileInfo.timestamp},this.content_creator.timeDisplay=new Date(this.content_creator.timestamp).toLocaleString(),this.content_related_creator=this.FileInfo.content_related_creator||[],this.content_creator.user_id)try{this.content_creator.is_me=this.nakama.servers[this.isOfficial][this.target].session.user_id==this.content_creator.user_id}catch{}try{this.content_creator.publisher=this.content_creator.is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_creator.user_id].display_name}catch{}this.set_various_display(this.content_creator);for(let e=0,n=this.content_related_creator.length;e<n;e++){if(this.content_related_creator[e].user_id)try{this.content_related_creator[e].is_me=this.nakama.servers[this.isOfficial][this.target].session.user_id==this.content_related_creator[e].user_id}catch{}this.content_related_creator[e].timeDisplay=new Date(this.content_related_creator[e].timestamp).toLocaleString()}}catch{}try{this.content_related_creator[0].publisher=this.content_related_creator[0].is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_related_creator[0].user_id].display_name,this.content_related_creator[0].timestamp==this.content_related_creator[1].timestamp&&(this.content_related_creator[0].publisher=this.content_related_creator[1].is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_related_creator[1].user_id].display_name,this.content_related_creator.splice(1,1))}catch{try{this.content_related_creator[0].publisher=this.content_related_creator[1].display_name,this.content_related_creator[0].timestamp==this.content_related_creator[1].timestamp&&(this.content_related_creator[0].publisher=this.content_related_creator[1].display_name,this.content_related_creator.splice(1,1))}catch{}try{this.content_related_creator[0].publisher||(this.content_related_creator[0].publisher=this.content_related_creator[0].display_name)}catch{}}try{this.content_related_creator.sort((e,n)=>e.timestamp>n.timestamp?-1:e.timestamp<n.timestamp?1:0)}catch{}}set_various_display(e){switch(e.various){case"camera":e.various_display=this.lang.text.GlobalAct.FromCamera;break;case"link":e.various_display=this.lang.text.ChatRoom.ExternalLinkFile;break;case"loaded":e.various_display=this.lang.text.GlobalAct.variousCreator;break;case"voidDraw":e.various_display=this.lang.text.GlobalAct.FromVoidDraw;break;case"long_text":e.various_display=this.lang.text.GlobalAct.FromAutoLongText;break;case"textedit":e.various_display=this.lang.text.GlobalAct.FromTextEditor;break;case"shared":e.various_display=this.lang.text.GlobalAct.SharedContent;break;default:e.various_display=this.lang.text.GlobalAct.UnknownSource}}close_text_edit(){this.FileInfo.is_new?this.modalCtrl.dismiss():this.reinit_content_data(this.MessageInfo)}ionViewDidEnter(){var e=this;return(0,d.c)(function*(){e.FileInfo.url?e.FileURL=e.FileInfo.url:e.FileInfo.is_new||(e.blob||(e.blob=yield e.indexed.loadBlobFromUserPath(e.FileInfo.path||e.navParams.get("path"),e.FileInfo.type,void 0,e.targetDB)),e.FileURL=URL.createObjectURL(e.blob)),e.forceWrite=!1;let n=document.getElementById("content_viewer_canvas");switch(n&&(n.style.backgroundImage=""),document.removeEventListener("ionBackButton",e.EventListenerAct),e.p5canvas&&e.p5canvas.remove(),e.FileInfo.viewer){case"image":e.p5canvas=new $(c=>{c.setup=(0,d.c)(function*(){n.style.maxWidth="100%",n.style.overflow="hidden",e.ContentBox.style.overflow="hidden",c.noCanvas();let x=c.createElement("img");x.elt.hidden=!0,x.elt.src=e.FileURL,x.elt.onload=()=>{n.style.backgroundImage=`url('${e.FileURL}')`,n.style.backgroundRepeat="no-repeat",n.style.pointerEvents="none",e.image_info.width=x.elt.naturalWidth,e.image_info.height=x.elt.naturalHeight,p=c.createVector(x.elt.naturalWidth,x.elt.naturalHeight),f(),x.remove()},c.noLoop()});let f=()=>{if(e.image_info.width/e.image_info.height<n.clientWidth/n.clientHeight){let x=e.image_info.width*n.clientHeight/e.image_info.height;n.style.backgroundSize=`${x}px`,n.style.backgroundPositionX=(n.clientWidth-x)/2+"px",n.style.backgroundPositionY="0px"}else n.style.backgroundSize=`${n.clientWidth}px`,n.style.backgroundPositionX="0px",n.style.backgroundPositionY=n.clientHeight/2-p.y*(n.clientWidth/p.x)/2+"px";J=!0};c.windowResized=()=>{setTimeout(()=>{f()},50)};let p,F=c.createVector(),w=c.createVector(),v=c.createVector(),U=1,S=()=>{n.style.backgroundPositionX=`${F.x+v.x}px`,n.style.backgroundPositionY=`${F.y+v.y}px`},j=(x,K)=>{let b=U,L=U*K,H=Number(n.style.backgroundPositionX.split("px")[0]),we=Number(n.style.backgroundPositionY.split("px")[0]),Re=(b-L)*c.map(x.x,H,H+b,0,1),Ee=(b-L)/p.x*p.y*c.map(x.y,we,we+b/p.x*p.y,0,1);n.style.backgroundPositionX=`${H+Re}px`,n.style.backgroundPositionY=`${we+Ee}px`,n.style.backgroundSize=`${L}px`};c.mousePressed=()=>{e.useP5Navigator&&(c.mouseButton==c.CENTER&&f(),"DesktopPWA"==C.s1&&(F=c.createVector(Number(n.style.backgroundPositionX.split("px")[0]),Number(n.style.backgroundPositionY.split("px")[0])),w=c.createVector(c.mouseX,c.mouseY)))},c.mouseWheel=x=>{e.useP5Navigator&&(U=Number(n.style.backgroundSize.split("px")[0]),j(c.createVector(n.clientWidth/2,n.clientHeight/2),1-x.delta/1e3))},c.mouseDragged=()=>{e.useP5Navigator&&"DesktopPWA"==C.s1&&(v=c.createVector(c.mouseX,c.mouseY),v.sub(w),S())};let Te,P={},Q=!1,J=!0;c.touchStarted=x=>{if(e.useP5Navigator){for(let b=0,L=x.changedTouches.length;b<L;b++)P[x.changedTouches[b].identifier]=c.createVector(x.changedTouches[b].clientX,x.changedTouches[b].clientY);switch(Object.keys(P).length){case 1:F=c.createVector(Number(n.style.backgroundPositionX.split("px")[0]),Number(n.style.backgroundPositionY.split("px")[0])),w=P[x.changedTouches[0].identifier].copy();break;case 2:F=c.createVector(Number(n.style.backgroundPositionX.split("px")[0]),Number(n.style.backgroundPositionY.split("px")[0]));let b=P[0].copy();Te=b.dist(P[1]),w=b.add(P[1]).div(2).copy(),U=Number(n.style.backgroundSize.split("px")[0]),S();break;default:Q=!0,f()}}},c.touchMoved=x=>{if(e.useP5Navigator&&!Q){for(let b=0,L=x.changedTouches.length;b<L;b++)P[x.changedTouches[b].identifier]=c.createVector(x.changedTouches[b].clientX,x.changedTouches[b].clientY);switch(Object.keys(P).length){case 1:v=P[x.changedTouches[0].identifier].copy(),v.sub(w),J||S();break;case 2:J=!1;let b=P[0].copy(),L=b.dist(P[1]);v=b.add(P[1]).div(2).copy();let H=v.copy();v.sub(w),S(),j(H,L/Te)}}},c.touchEnded=x=>{if(e.useP5Navigator&&"changedTouches"in x){for(let b=0,L=x.changedTouches.length;b<L;b++)delete P[x.changedTouches[b].identifier];switch(Object.keys(P).length){case 1:F=c.createVector(Number(n.style.backgroundPositionX.split("px")[0]),Number(n.style.backgroundPositionY.split("px")[0])),w=P[Object.keys(P)[0]].copy();break;case 0:J&&!Q&&(v.x>50?e.ChangeToAnother(-1):v.x<-50&&e.ChangeToAnother(1)),Q=!1}}}});break;case"audio":e.p5canvas=new $(c=>{var f;c.setup=()=>{c.noCanvas(),c.noLoop(),f=c.createAudio([e.FileURL],()=>{n.appendChild(f.elt),f.elt.hidden=!0,setTimeout(()=>{p(),f.elt.hidden=!1},50),f.showControls(),f.play()})};let p=()=>{let F=e.ContentBox.offsetWidth;f.elt.setAttribute("style","position: relative; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%);"),f.size(F,25)};c.windowResized=()=>{setTimeout(()=>{p()},50)}});break;case"video":e.p5canvas=new $(c=>{var f;c.setup=()=>{c.noCanvas(),c.noLoop(),f=c.createVideo([e.FileURL],()=>{n.appendChild(f.elt),f.elt.hidden=!0,setTimeout(()=>{e.image_info.width=f.elt.videoWidth,e.image_info.height=f.elt.videoHeight,p(),f.elt.hidden=!1},50),f.showControls(),f.play()}),c.VideoMedia=f};let p=()=>{let F=e.ContentBox.offsetWidth,w=e.ContentBox.offsetHeight-e.FileHeader.offsetHeight,v=f.elt.videoWidth,U=f.elt.videoHeight;0!=v&&0!=U&&(F/w>v/U?(U=w,v=v/f.elt.videoHeight*U,f.elt.setAttribute("style","position: relative; left: 50%; transform: translateX(-50%);")):(v=F,U=U/f.elt.videoWidth*v||w/2,f.elt.setAttribute("style","position: relative; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%);")),f.size(v,U))};c.windowResized=()=>{setTimeout(()=>{p()},50)}});break;case"text":e.p5canvas=new $(c=>{c.setup=()=>{c.noCanvas(),c.noLoop();let f=c.createElement("textarea");f.elt.disabled=!0,f.elt.className="infobox",f.elt.setAttribute("style","height: 100%; display: block;"),f.elt.textContent="",n.appendChild(f.elt),c.TextArea=f.elt,e.FileInfo.is_new?e.open_text_editor(f.elt):c.loadStrings(e.FileURL,p=>{f.elt.textContent=p.join("\n")},p=>{n.textContent=e.lang.text.ContentViewer.CannotOpenText,e.FileInfo.else=!0})}});break;case"godot":document.addEventListener("ionBackButton",e.EventListenerAct);let _,h=e.MessageInfo.message_id;try{let c=yield e.indexed.loadBlobFromUserPath((e.FileInfo.path||e.navParams.get("path"))+"_thumbnail.png","",void 0,e.targetDB);_=URL.createObjectURL(c)}catch{}!e.NeedDownloadFile&&e.CurrentViewId==h&&setTimeout((0,d.c)(function*(){let c=!1;if(e.indexed.godotDB)try{let f=yield e.indexed.loadBlobFromUserPath(e.FileInfo.path||e.navParams.get("path"),"",void 0,e.indexed.ionicDB);yield e.indexed.GetGodotIndexedDB(),yield e.indexed.saveBlobToUserPath(f,"tmp_files/duplicate/viewer.pck",void 0,e.indexed.godotDB),c=!0}catch(f){console.log("\ub0b4\ubd80 \ud30c\uc77c \uc5c6\uc74c: ",f)}if(yield e.global.CreateGodotIFrame("content_viewer_canvas",{path:"tmp_files/duplicate/viewer.pck",alt_path:e.FileInfo.path||e.navParams.get("path"),ext:e.FileInfo.file_ext,url:e.FileInfo.url,background:_,receive_image:(f=(0,d.c)(function*(p,F,w){let v="tmp_files/modify_image.png";yield e.indexed.saveBase64ToUserPath(","+p,v),e.modalCtrl.dismiss({type:"image",path:v,width:F,height:w,msg:e.MessageInfo,index:e.RelevanceIndex-1})}),function(F,w,v){return f.apply(this,arguments)})},"start_load_pck"),!c){try{let f=yield e.indexed.loadBlobFromUserPath(e.FileInfo.path||e.navParams.get("path"),"",void 0,e.indexed.ionicDB);yield e.indexed.GetGodotIndexedDB(),yield e.indexed.saveBlobToUserPath(f,"tmp_files/duplicate/viewer.pck",void 0,e.indexed.godotDB)}catch(f){console.log("\ub0b4\ubd80 \ud30c\uc77c \uc5c6\uc74c_dp: ",f)}yield e.global.CreateGodotIFrame("content_viewer_canvas",{path:"tmp_files/duplicate/viewer.pck",alt_path:e.FileInfo.path||e.navParams.get("path"),ext:e.FileInfo.file_ext,url:e.FileInfo.url,background:_,receive_image:function(){var f=(0,d.c)(function*(p,F,w){let v="tmp_files/modify_image.png";yield e.indexed.saveBase64ToUserPath(","+p,v),e.modalCtrl.dismiss({type:"image",path:v,width:F,height:w,msg:e.MessageInfo,index:e.RelevanceIndex-1})});return function(F,w,v){return f.apply(this,arguments)}}()},"start_load_pck")}var f;_&&URL.revokeObjectURL(_),e.FileInfo.url?e.global.godot_window.download_url():e.global.godot_window.start_load_pck()}),100);break;default:console.log("\uc815\uc758\ub418\uc9c0 \uc54a\uc740 \ud30c\uc77c \uc815\ubcf4: ",e.FileInfo.viewer);case"disabled":e.p5canvas=new $(c=>{c.setup=()=>{c.noCanvas()}})}e.ContentOnLoad=!0,e.ChangeContentWithKeyInput()})()}ChangeContentWithKeyInput(){this.p5canvas&&(this.p5canvas.keyPressed=e=>{if(!this.isTextEditMode)switch(e.code){case"KeyA":case"ArrowLeft":this.ChangeToAnother(-1);break;case"KeyS":this.download_file();break;case"KeyD":case"ArrowRight":this.ChangeToAnother(1);break;case"KeyS":this.NeedDownloadFile&&this.DownloadCurrentFile()}})}open_bottom_modal(){this.ShowContentInfoIonic.onDidDismiss().then(e=>{this.useP5Navigator=!0}),this.useP5Navigator=!1,this.ShowContentInfoIonic.present()}open_text_editor(e=this.p5canvas.TextArea){e.disabled=!1,setTimeout(()=>{this.isTextEditMode=!0,e.focus()},500)}SaveText(){var e=this;return(0,d.c)(function*(){let n=new Blob([e.p5canvas.TextArea.value],{type:e.FileInfo.type});if(n.name=e.NewTextFileName||e.FileInfo.filename||e.FileInfo.name,e.OpenInChannelChat)e.modalCtrl.dismiss({type:"text",blob:n,contentRelated:e.FileInfo.content_related_creator});else{let _=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});_.present();let h=`tmp_files/texteditor/${e.FileInfo.filename||e.FileInfo.name}`;e.FileInfo.path||(e.FileInfo.path=h),yield e.indexed.saveBlobToUserPath(n,h,void 0,e.targetDB),_.dismiss(),e.p5toast.show({text:e.lang.text.ContentViewer.fileSaved}),e.modalCtrl.dismiss({type:"text",blob:n,path:h,index:e.RelevanceIndex-1})}})()}modify_image(){var e=this;return(0,d.c)(function*(){switch(e.FileInfo.viewer){case"image":{let _=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});_.present();try{let h;e.image_info.path=e.FileInfo.path||e.navParams.get("path"),e.FileInfo.url&&(e.image_info.path="tmp_files/modify_image.png",h=yield fetch(e.FileInfo.url).then(c=>c.blob()),yield e.indexed.saveBlobToUserPath(h,e.image_info.path)),e.modalCtrl.dismiss({type:"image",...e.image_info,path:e.image_info.path,msg:e.MessageInfo,index:e.RelevanceIndex-1})}catch(h){e.p5toast.show({text:`${e.lang.text.ContentViewer.CannotEditFile}: ${h}`})}_.dismiss()}break;case"text":let n=e.p5canvas.TextArea.textContent.split("\n");e.modalCtrl.dismiss({type:"image",text:n,msg:e.MessageInfo,index:e.RelevanceIndex-1});break;case"video":try{let _=yield e.loadingCtrl.create({message:e.lang.text.TodoDetail.WIP});_.present(),e.p5canvas.pixelDensity(1),e.p5canvas.VideoMedia.pause(),e.p5canvas.VideoMedia.size(e.image_info.width,e.image_info.height),e.p5canvas.createCanvas(e.image_info.width,e.image_info.height),e.p5canvas.image(e.p5canvas.VideoMedia,0,0,e.p5canvas.width,e.p5canvas.height),e.p5canvas.saveFrames("","png",1,1,function(){var h=(0,d.c)(function*(c){try{_.dismiss(),e.image_info.path="tmp_files/modify_image.png",yield e.indexed.saveBase64ToUserPath(c[0].imageData.replace(/"|=|\\/g,""),e.image_info.path),e.modalCtrl.dismiss({type:"image",...e.image_info,msg:e.MessageInfo,index:e.RelevanceIndex-1})}catch(f){console.log("\ud30c\uc77c \uc800\uc7a5 \uc624\ub958: ",f)}});return function(c){return h.apply(this,arguments)}}())}catch(_){console.log("\uc7ac\uc0dd\uc911\uc778 \ube44\ub514\uc624 \uc774\ubbf8\uc9c0 \ucd94\ucd9c \uc624\ub958: ",_)}break;case"godot":e.global.godot_window.modify_image();break;default:console.log("\ud3b8\uc9d1 \ubd88\uac00 \ud30c\uc77c \uc815\ubcf4: ",e.FileInfo)}})()}download_file(){var e=this;return(0,d.c)(function*(){if("DesktopPWA"==C.s1||"MobilePWA"==C.s1)if(e.FileInfo.url)try{let n=yield fetch(e.FileInfo.url),_=yield n.blob();if(!n.ok)throw"\uc81c\ub300\ub85c \ub2e4\uc6b4\ubc1b\uc544\uc9c0\uc9c0 \uc54a\uc74c";yield e.indexed.saveBlobToUserPath(_,e.FileInfo.path),e.indexed.DownloadFileFromUserPath(e.FileInfo.path,e.FileInfo.type,e.FileInfo.filename||e.FileInfo.name,e.targetDB)}catch(n){console.log("\ub2e4\uc6b4\ubc1b\uae30 \uc2e4\ud328: ",n),e.p5toast.show({text:`${e.lang.text.Nakama.FailedDownload}: ${n}`})}else e.indexed.DownloadFileFromUserPath(e.FileInfo.path,e.FileInfo.type,e.FileInfo.filename||e.FileInfo.name,e.targetDB);else e.alertCtrl.create({header:e.lang.text.ContentViewer.Filename,inputs:[{name:"filename",placeholder:e.FileInfo.filename||e.FileInfo.name,type:"text"}],buttons:[{text:e.lang.text.ContentViewer.saveFile,handler:(n=(0,d.c)(function*(_){if(e.FileInfo.url)try{let h=yield fetch(e.FileInfo.url),c=yield h.blob();if(!h.ok)throw"\uc81c\ub300\ub85c \ub2e4\uc6b4\ubc1b\uc544\uc9c0\uc9c0 \uc54a\uc74c";yield e.indexed.saveBlobToUserPath(c,e.FileInfo.path),e.DownloadFileAct(_)}catch(h){console.log("\ub2e4\uc6b4\ubc1b\uae30 \uc2e4\ud328: ",h),e.p5toast.show({text:`${e.lang.text.Nakama.FailedDownload}: ${h}`})}else e.DownloadFileAct(_)}),function(h){return n.apply(this,arguments)})}]}).then(n=>n.present());var n})()}DownloadFileAct(e){var n=this;return(0,d.c)(function*(){let _=yield n.loadingCtrl.create({message:n.lang.text.TodoDetail.WIP});_.present();let h=e.filename?e.filename.replace(/:|\?|\/|\\|<|>/g,""):n.FileInfo.filename||n.FileInfo.name,c=yield n.indexed.loadBlobFromUserPath(n.FileInfo.path,n.FileInfo.type,void 0,n.targetDB);n.forceWrite&&!e.filename?n.file.writeExistingFile(n.file.externalDataDirectory,h,c).then(f=>{n.forceWrite=!1,_.dismiss(),n.p5toast.show({text:`${n.lang.text.ContentViewer.OverWriteFile}: ${h}`})}):n.file.writeFile(n.file.externalDataDirectory,h,c).then(f=>{_.dismiss(),n.p5toast.show({text:n.lang.text.ContentViewer.fileSaved})}).catch(f=>{12===(_.dismiss(),f.code)?(n.p5toast.show({text:n.lang.text.ContentViewer.AlreadyExist}),n.forceWrite=!0,n.download_file()):console.log("\uc900\ube44\ub418\uc9c0 \uc54a\uc740 \uc624\ub958 \ubc18\ud658: ",f)})})()}toast_info(e){e.various_display||this.set_various_display(e),this.p5toast.show({text:e.various_display})}ShareContent(){let e=this.nakama.rearrange_channels();for(let n=e.length-1;n>=0;n--)("missing"==e[n].status||"offline"==e[n].status)&&e.splice(n,1);e.length?this.modalCtrl.create({component:R._,componentProps:{file:this.FileInfo,channels:e}}).then(n=>{n.onDidDismiss().then(_=>{_.data&&this.modalCtrl.dismiss()}),n.present()}):this.p5toast.show({text:this.lang.text.ShareContentToOther.NoChannelToShare})}RemoveFile(){this.alertCtrl.create({header:this.lang.text.ContentViewer.RemoveFile,message:this.FileInfo.path,buttons:[{text:this.lang.text.TodoDetail.remove,handler:()=>{this.RemoveFileAct()},cssClass:"red_font"}]}).then(e=>e.present())}RemoveFileAct(){var e=this;return(0,d.c)(function*(){URL.revokeObjectURL(e.FileURL),delete e.FileInfo.thumbnail,delete e.FileInfo.text,yield e.indexed.removeFileFromUserPath(e.FileInfo.path,void 0,e.targetDB),e.RelevanceIndex-=1,e.ChangeToAnother(1)})()}ionViewWillLeave(){var e=this;return(0,d.c)(function*(){switch(document.removeEventListener("ionBackButton",e.EventListenerAct),e.FileInfo.viewer){case"video":try{let _,h,n=e.p5canvas.VideoMedia.size();n.width>n.height?(_=192,h=n.height/n.width*192):(_=n.width/n.height*192,h=192),e.p5canvas.createCanvas(_,h),e.p5canvas.imageMode(e.p5canvas.CORNER),e.p5canvas.image(e.p5canvas.VideoMedia,0,0,_*e.image_info.width/n.width,h*e.image_info.height/n.height),e.p5canvas.fill(255,128),e.p5canvas.rect(0,0,_,h),e.p5canvas.textWrap(e.p5canvas.CHAR),e.p5canvas.textSize(16);let c=h/16;e.p5canvas.push(),e.p5canvas.translate(c/6,c/6),e.p5canvas.fill(0),e.p5canvas.text(e.FileInfo.filename||e.FileInfo.name,c,c,_-2*c,h-2*c),e.p5canvas.filter(e.p5canvas.BLUR,3),e.p5canvas.pop(),e.p5canvas.fill(255),e.p5canvas.text(e.FileInfo.filename||e.FileInfo.name,c,c,_-2*c,h-2*c),e.p5canvas.saveFrames("","png",1,1,function(){var f=(0,d.c)(function*(p){try{let F=p[0].imageData.replace(/"|=|\\/g,"");yield e.indexed.saveBase64ToUserPath(F,`${e.FileInfo.path}_thumbnail.png`,void 0,e.targetDB),e.FileInfo.thumbnail=F,e.global.modulate_thumbnail(e.FileInfo,"")}catch(F){console.log("\uc378\ub124\uc77c \uc800\uc7a5 \uc624\ub958: ",F)}});return function(p){return f.apply(this,arguments)}}())}catch(n){console.log("\ube44\ub514\uc624 \uc378\ub124\uc77c \uc0dd\uc131 \ucde8\uc18c: ",n)}break;case"godot":try{e.global.godot_window.filename=e.FileInfo.filename||e.FileInfo.name,e.global.godot_window.create_thumbnail(e.FileInfo),(yield e.indexed.GetFileListFromDB("tmp_files",void 0,e.indexed.godotDB)).forEach(_=>e.indexed.removeFileFromUserPath(_,void 0,e.indexed.godotDB))}catch{}}e.p5canvas&&e.p5canvas.remove(),URL.revokeObjectURL(e.FileURL);try{(yield e.file.checkFile(e.file.externalDataDirectory,`viewer_tmp.${e.FileInfo.file_ext}`))&&(yield e.file.removeFile(e.file.externalDataDirectory,`viewer_tmp.${e.FileInfo.file_ext}`))}catch{}})()}copy_url(e){this.mClipboard.copy(e).catch(n=>W.c.write(e))}}return(a=r).\u0275fac=function(e){return new(e||a)(t.GI1(y.qS),t.GI1(i.a6),t.GI1(T.k),t.GI1(V.o),t.GI1(E.S),t.GI1(B.O),t.GI1(y.iW),t.GI1(y.Kg),t.GI1(D.A1),t.GI1(O.h),t.GI1(k._),t.GI1(A.s))},a.\u0275cmp=t.In1({type:a,selectors:[["app-ionic-viewer"]],viewQuery:function(e,n){if(1&e&&t.CC$(z,5),2&e){let _;t.wto(_=t.Gqi())&&(n.ShowContentInfoIonic=_.first)}},decls:27,vars:16,consts:[[1,"ion-no-border"],["id","Toolbar"],["slot","start",3,"click"],["defaultHref",""],["class","relevance_change","style","padding-right: 4px;","slot","end","name","arrow-back-circle-outline",3,"click",4,"ngIf"],["slot","end",4,"ngIf"],["class","relevance_change","style","padding-right: 16px; padding-left: 4px;","slot","end","name","arrow-forward-circle-outline",3,"click",4,"ngIf"],["id","ContentBox"],[1,"main_table_elt"],[2,"height","0"],["id","FileHeader",2,"max-width","100vw"],["text-wrap","","style","overflow-x: auto;",4,"ngIf"],["type","text","text-warp","","style","overflow-x: auto; overflow-y: hidden;",3,"ngModel","placeholder","ngModelChange",4,"ngIf"],[3,"click",4,"ngIf"],["class","ion-align-items-center",3,"disabled","click",4,"ngIf"],["id","menu_trigger",4,"ngIf"],["trigger","menu_trigger","dismissOnSelect","",4,"ngIf"],[4,"ngIf"],[3,"initialBreakpoint","breakpoints"],["ShowContentInfoIonic",""],["slot","end","name","arrow-back-circle-outline",1,"relevance_change",2,"padding-right","4px",3,"click"],["slot","end"],["slot","end","name","arrow-forward-circle-outline",1,"relevance_change",2,"padding-right","16px","padding-left","4px",3,"click"],["text-wrap","",2,"overflow-x","auto"],["type","text","text-warp","",2,"overflow-x","auto","overflow-y","hidden",3,"ngModel","placeholder","ngModelChange"],[3,"click"],["name","close-circle-outline"],["name","save-outline"],[1,"ion-align-items-center",3,"disabled","click"],["name","code-download-outline"],["id","menu_trigger"],["name","ellipsis-vertical"],["trigger","menu_trigger","dismissOnSelect",""],["button","",3,"click",4,"ngIf"],["button","",3,"click"],["id","content_viewer_canvas",1,"full_screen"],[1,"disconnect_info"],["color","medium","name","attach-outline",2,"width","60px","height","60px"],["color","medium"],[1,"ion-align-items-center"],["size","12",1,"ion-text-center"],["color","warning","shape","round",1,"ion-align-items-center",3,"disabled","click"],["button","",4,"ngIf"],[1,"ion-text-end"],[4,"ngFor","ngForOf"],[1,"ion-text-center"],["button",""],[1,"history_center"],["color","secondary","mode","ios","outline","true",3,"click"],["name","document-attach-outline",4,"ngIf"],["name","camera-outline",4,"ngIf"],["name","link-outline",4,"ngIf"],["name","text-outline",4,"ngIf"],["name","document-text-outline",4,"ngIf"],["name","share-social-outline",4,"ngIf"],["name","document-attach-outline"],["name","camera-outline"],["name","link-outline"],["name","text-outline"],["name","document-text-outline"],["name","share-social-outline"],["src","assets/icon/voidDraw.png"]],template:function(e,n){1&e&&(t.I0R(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-title"),t.OEk(3),t.C$Y(),t.I0R(4,"ion-buttons",2),t.qCj("click",function(){return n.modalCtrl.dismiss()}),t.wR5(5,"ion-back-button",3),t.C$Y(),t.yuY(6,Z,1,0,"ion-icon",4)(7,q,2,1,"ion-label",5)(8,ee,1,0,"ion-icon",6),t.C$Y()(),t.I0R(9,"ion-content",7)(10,"table",8)(11,"tr",9)(12,"td")(13,"ion-list-header",10),t.yuY(14,te,2,1,"ion-label",11)(15,ie,1,2,"ion-input",12)(16,ne,2,0,"ion-button",13)(17,oe,2,0,"ion-button",13)(18,ae,2,1,"ion-button",14)(19,le,2,0,"ion-button",15)(20,fe,2,0,"ion-popover",16),t.C$Y()()(),t.I0R(21,"tr"),t.yuY(22,he,3,1,"td",17)(23,ue,6,2,"td",17),t.C$Y()(),t.I0R(24,"ion-modal",18,19),t.yuY(26,m,19,9,"ng-template"),t.C$Y()()),2&e&&(t.yG2(3),t.cNF(n.lang.text.ContentViewer.Title),t.yG2(3),t.E7m("ngIf",n.HaveRelevances),t.yG2(),t.E7m("ngIf",n.HaveRelevances),t.yG2(),t.E7m("ngIf",n.HaveRelevances),t.yG2(6),t.E7m("ngIf",!n.isTextEditMode),t.yG2(),t.E7m("ngIf",n.isTextEditMode),t.yG2(),t.E7m("ngIf",n.isTextEditMode),t.yG2(),t.E7m("ngIf",n.isTextEditMode),t.yG2(),t.E7m("ngIf",n.isChannelOnline&&n.HaveRelevances&&!n.isTextEditMode&&!n.fromLocalChannel),t.yG2(),t.E7m("ngIf",!n.isTextEditMode),t.yG2(),t.E7m("ngIf",!n.isTextEditMode),t.yG2(2),t.E7m("ngIf",!n.NeedDownloadFile),t.yG2(),t.E7m("ngIf",n.NeedDownloadFile),t.yG2(),t.E7m("initialBreakpoint",.5)("breakpoints",t.q4q(15,o)))},dependencies:[M.ay,M.u_,N.ue,N._G,y.O7,y.sn,y.GS,y.cz,y.Kk,y._i,y.YP,y.wB,y.Ko,y.A5,y.Yb,y.S8,y.QR,y.OC,y.zz,y.qo,y.tM,y.Md,y.yc,y.sW,y.qG,y.Im],styles:[".main_table_elt[_ngcontent-%COMP%]{width:100%;height:100%;border:0;margin:0}.relevance_change[_ngcontent-%COMP%]{width:25px;height:25px}.history_center[_ngcontent-%COMP%]{text-align:center}"]}),r})()},896:(X,Y,u)=>{u.d(Y,{_:()=>V});var d=u(4496),C=u(4500),$=u(9240),G=u(5624),R=u(4180),W=u(7136),t=u(1368);function y(E,B){1&E&&d.wR5(0,"div",12)}function i(E,B){if(1&E&&d.wR5(0,"img",13),2&E){const D=d.GaO().$implicit;d.m_g("online"==D.status||3==D.redirect.type&&"pending"==D.status?"filter: grayscale(0) contrast(1)":"filter: grayscale(.9) contrast(1.4)"),d.E7m("src",D.info.img,d.K6U)}}function T(E,B){if(1&E){const D=d.KQA();d.I0R(0,"ion-item",4),d.qCj("click",function(){const A=d.usT(D).$implicit,M=d.GaO();return d.CGJ(M.go_to_chatroom(A))}),d.I0R(1,"div",5),d.yuY(2,y,1,0,"div",6),d.C$Y(),d.I0R(3,"div",7),d.yuY(4,i,1,3,"img",8),d.C$Y(),d.I0R(5,"ion-label")(6,"div",9)(7,"table")(8,"tr")(9,"td"),d.OEk(10),d.C$Y(),d.I0R(11,"td",10),d.OEk(12),d.C$Y()()()(),d.I0R(13,"div",11),d.OEk(14),d.C$Y()()()}if(2&E){const D=B.$implicit,O=d.GaO();d.yG2(),d.m_g("background-color: "+O.statusBar.colors[D.status||"offline"]),d.yG2(),d.E7m("ngIf",D.is_new),d.yG2(2),d.E7m("ngIf",D.info),d.yG2(6),d.oRS(" ",D.info?D.info.name||D.info.display_name||O.lang.text.ChatRoom.noname_chatroom:D.title||O.lang.text.ChatRoom.noname_chatroom," "),d.yG2(2),d.oRS(" ","("+D.server.target+")"," "),d.yG2(2),d.oRS(" ",D.last_comment||D.noti||O.lang.text.Subscribes.noMessageHistory," ")}}let V=(()=>{var E;class B{constructor(O,k,A,M,N){this.lang=O,this.navParams=k,this.modalCtrl=A,this.statusBar=M,this.nakama=N}ngOnInit(){this.channels=this.navParams.get("channels")}go_to_chatroom(O){let k=this.navParams.get("file");delete k.db,this.nakama.go_to_chatroom_without_admob_act(O,k),this.modalCtrl.dismiss(!0)}}return(E=B).\u0275fac=function(O){return new(O||E)(d.GI1(C.o),d.GI1($.a6),d.GI1(G.qS),d.GI1(R.Y),d.GI1(W.h))},E.\u0275cmp=d.In1({type:E,selectors:[["app-share-content-to-other"]],decls:11,vars:3,consts:[[1,"ion-no-border"],["slot","start",3,"click"],["defaultHref",""],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"],[1,"additional_form","status_bar_double"],["class","new_circle",4,"ngIf"],[1,"additional_form","bg_img_form"],["class","profile_img",3,"style","src",4,"ngIf"],[1,"form_margin","header"],[1,"server_target"],[1,"form_margin","content"],[1,"new_circle"],[1,"profile_img",3,"src"]],template:function(O,k){1&O&&(d.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),d.OEk(3),d.C$Y(),d.I0R(4,"ion-buttons",1),d.qCj("click",function(){return k.modalCtrl.dismiss()}),d.wR5(5,"ion-back-button",2),d.C$Y()()(),d.I0R(6,"ion-content")(7,"ion-item-divider")(8,"ion-label"),d.OEk(9),d.C$Y()(),d.yuY(10,T,15,7,"ion-item",3),d.C$Y()),2&O&&(d.yG2(3),d.cNF(k.lang.text.ShareContentToOther.Title),d.yG2(6),d.cNF(k.lang.text.ShareContentToOther.AvailableChannels),d.yG2(),d.E7m("ngForOf",k.channels))},dependencies:[t.ay,t.u_,G.GS,G._i,G.wB,G.Yb,G.S8,G.QR,G.tM,G.Md,G.Im],styles:[".server_target[_ngcontent-%COMP%]{color:#888;padding-left:4px}.content[_ngcontent-%COMP%]{color:#888;height:24px;display:table-cell;vertical-align:middle;padding:0 16px}"]}),B})()},7048:(X,Y,u)=>{u.d(Y,{w:()=>De});var d=u(1528),C=u(5193),$=u(8744),G=u(6400);u(5404);const W=(0,G.C_)("Filesystem",{web:()=>u.e(7688).then(u.bind(u,7688)).then(g=>new g.FilesystemWeb)});var t=u(9352),y=u(1052),i=u(4496),T=u(5624),V=u(9240),E=u(4668),B=u(4500),D=u(5020),O=u(3824),k=u(4476),A=u(544),M=u(6819),N=u(7136),z=u(1368);const Z=["FileSel"];function q(g,I){if(1&g){const m=i.KQA();i.I0R(0,"ion-icon",8),i.qCj("click",function(){i.usT(m);const s=i.GaO();return i.CGJ(s.toggle_thumbnail())}),i.C$Y()}}function ee(g,I){if(1&g){const m=i.KQA();i.I0R(0,"ion-icon",9),i.qCj("click",function(){i.usT(m);const s=i.GaO();return i.CGJ(s.toggle_thumbnail())}),i.C$Y()}}function te(g,I){if(1&g){const m=i.KQA();i.I0R(0,"div")(1,"ion-item",18),i.qCj("click",function(){i.usT(m);const s=i.GaO(2);return i.CGJ(s.SelectImportFolder())}),i.wR5(2,"ion-icon",19),i.I0R(3,"ion-label"),i.OEk(4),i.C$Y()(),i.I0R(5,"input",20),i.qCj("change",function(s){i.usT(m);const a=i.GaO(2);return i.CGJ(a.inputImageSelected(s))}),i.C$Y()()}if(2&g){const m=i.GaO(2);i.yG2(4),i.oRS(" ",m.lang.text.UserFsDir.ImportFolder," ")}}function ie(g,I){if(1&g){const m=i.KQA();i.I0R(0,"ion-button",13),i.qCj("click",function(){i.usT(m);const s=i.GaO(2);return i.CGJ(s.ExportDirectoryRecursive())}),i.OEk(1),i.C$Y()}if(2&g){const m=i.GaO(2);i.yG2(),i.oRS(" ",m.lang.text.UserFsDir.ExportDir," ")}}function ne(g,I){if(1&g){const m=i.KQA();i.I0R(0,"ion-item",18),i.qCj("click",function(){i.usT(m);const s=i.GaO(2);return i.CGJ(s.MoveToUpDir())}),i.wR5(1,"ion-icon",11),i.I0R(2,"ion-label"),i.OEk(3,".."),i.C$Y()()}}function oe(g,I){if(1&g){const m=i.KQA();i.I0R(0,"ion-item",18),i.qCj("click",function(){i.usT(m);const s=i.GaO().$implicit,a=i.GaO(2);return i.CGJ(a.SelectFolder(s))}),i.wR5(1,"ion-icon",11),i.I0R(2,"ion-label"),i.OEk(3),i.C$Y()()}if(2&g){const m=i.GaO().$implicit;i.yG2(3),i.cNF(m.name)}}function ae(g,I){if(1&g&&(i.I0R(0,"div"),i.yuY(1,oe,4,1,"ion-item",15),i.C$Y()),2&g){const m=I.$implicit,o=i.GaO(2);i.yG2(),i.E7m("ngIf",o.CurrentDir==m.dir)}}function le(g,I){1&g&&i.wR5(0,"ion-icon",36)}function se(g,I){1&g&&i.wR5(0,"ion-icon",37)}function re(g,I){1&g&&i.wR5(0,"ion-icon",38)}function ce(g,I){1&g&&i.wR5(0,"ion-icon",39)}function _e(g,I){1&g&&i.wR5(0,"ion-icon",40)}function de(g,I){1&g&&i.wR5(0,"ion-icon",41)}function me(g,I){if(1&g&&(i.I0R(0,"ion-label",42),i.OEk(1),i.C$Y()),2&g){const m=i.GaO(2).$implicit;i.yG2(),i.cNF(m.name)}}function fe(g,I){if(1&g&&(i.I0R(0,"ion-label"),i.OEk(1),i.C$Y()),2&g){const m=i.GaO(2).$implicit;i.yG2(),i.cNF(m.name)}}function ge(g,I){if(1&g){const m=i.KQA();i.I0R(0,"ion-button",43),i.qCj("click",function(){i.usT(m);const s=i.GaO(2).$implicit,a=i.GaO(2);return i.CGJ(a.OpenFile(s))}),i.OEk(1),i.C$Y()}if(2&g){const m=i.GaO(4);i.yG2(),i.oRS(" ",m.lang.text.UserFsDir.Open," ")}}function he(g,I){if(1&g){const m=i.KQA();i.I0R(0,"ion-button",43),i.qCj("click",function(){i.usT(m);const s=i.GaO(2).$implicit,a=i.GaO(2);return i.CGJ(a.dismiss_page(s))}),i.OEk(1),i.C$Y()}if(2&g){const m=i.GaO(4);i.yG2(),i.oRS(" ",m.lang.text.UserFsDir.Select," ")}}function ue(g,I){if(1&g){const m=i.KQA();i.I0R(0,"ion-button",43),i.qCj("click",function(){i.usT(m);const s=i.GaO(2).$implicit,a=i.GaO(2);return i.CGJ(a.DownloadFile(s))}),i.OEk(1),i.C$Y()}if(2&g){const m=i.GaO(4);i.yG2(),i.oRS(" ",m.lang.text.UserFsDir.Download," ")}}function pe(g,I){if(1&g){const m=i.KQA();i.I0R(0,"div",44),i.qCj("click",function(){i.usT(m);const s=i.GaO(2).$implicit,a=i.GaO(2);return i.CGJ(a.OpenFile(s))}),i.wR5(1,"img",45),i.C$Y()}if(2&g){const m=i.GaO(2).$implicit,o=i.GaO(2);i.yG2(),i.m_g(o.HideThumbnail?"filter: blur(6px);":""),i.E7m("src",m.thumbnail,i.K6U)("alt",m.name)}}function xe(g,I){if(1&g){const m=i.KQA();i.I0R(0,"ion-accordion",22)(1,"ion-item",23),i.yuY(2,le,1,0,"ion-icon",24)(3,se,1,0,"ion-icon",25)(4,re,1,0,"ion-icon",26)(5,ce,1,0,"ion-icon",27)(6,_e,1,0,"ion-icon",28)(7,de,1,0,"ion-icon",29)(8,me,2,1,"ion-label",30)(9,fe,2,1,"ion-label",7),i.wR5(10,"ion-icon",31),i.C$Y(),i.I0R(11,"div",32)(12,"ion-item",10)(13,"ion-label"),i.OEk(14),i.C$Y(),i.yuY(15,ge,2,1,"ion-button",33)(16,he,2,1,"ion-button",33)(17,ue,2,1,"ion-button",33),i.I0R(18,"ion-button",34),i.qCj("click",function(){i.usT(m);const s=i.GaO(),a=s.$implicit,r=s.index,l=i.GaO(2);return i.CGJ(l.RemoveFile(a,r))}),i.OEk(19),i.C$Y()(),i.yuY(20,pe,2,4,"div",35),i.C$Y()()}if(2&g){const m=i.GaO().$implicit;i.GaO();const o=i.Gew(17),s=i.GaO();i.E7m("value",m.path),i.yG2(2),i.E7m("ngIf","image"==m.viewer),i.yG2(),i.E7m("ngIf","audio"==m.viewer),i.yG2(),i.E7m("ngIf","video"==m.viewer),i.yG2(),i.E7m("ngIf","text"==m.viewer),i.yG2(),i.E7m("ngIf","godot"==m.viewer),i.yG2(),i.E7m("ngIf","disabled"==m.viewer),i.yG2(),i.E7m("ngIf",o.value==m.path),i.yG2(),i.E7m("ngIf",o.value!=m.path),i.yG2(5),i.cNF(s.lang.text.UserFsDir.Action),i.yG2(),i.E7m("ngIf","image"!=m.viewer),i.yG2(),i.E7m("ngIf",s.is_file_selector),i.yG2(),i.E7m("ngIf",s.cant_dedicated&&!s.is_file_selector),i.yG2(2),i.oRS(" ",s.lang.text.UserFsDir.Delete," "),i.yG2(),i.E7m("ngIf","image"==m.viewer)}}function Ie(g,I){if(1&g&&(i.I0R(0,"div"),i.yuY(1,xe,21,15,"ion-accordion",21),i.C$Y()),2&g){const m=I.$implicit,o=i.GaO(2);i.yG2(),i.E7m("ngIf",o.CurrentDir==m.dir||o.is_file_selector)}}function ve(g,I){if(1&g){const m=i.KQA();i.I0R(0,"ion-list"),i.yuY(1,te,6,1,"div",7),i.I0R(2,"div")(3,"ion-item",10),i.wR5(4,"ion-icon",11),i.I0R(5,"ion-label"),i.OEk(6,"."),i.C$Y(),i.yuY(7,ie,2,1,"ion-button",12),i.I0R(8,"ion-button",13),i.qCj("click",function(){i.usT(m);const s=i.GaO();return i.CGJ(s.CreateNewFolder())}),i.OEk(9),i.C$Y(),i.I0R(10,"ion-button",13),i.qCj("click",function(){i.usT(m);const s=i.GaO();return i.CGJ(s.SelectFiles())}),i.OEk(11),i.C$Y(),i.I0R(12,"ion-button",14),i.qCj("click",function(){i.usT(m);const s=i.GaO();return i.CGJ(s.RemoveDirectoryRecursive())}),i.OEk(13),i.C$Y()(),i.yuY(14,ne,4,0,"ion-item",15),i.C$Y(),i.yuY(15,ae,2,1,"div",16),i.I0R(16,"ion-accordion-group",null,17),i.yuY(18,Ie,2,1,"div",16),i.C$Y()()}if(2&g){const m=i.GaO();i.yG2(),i.E7m("ngIf",""==m.CurrentDir&&!m.is_file_selector&&m.CanImportFolder),i.yG2(6),i.E7m("ngIf",!m.cant_dedicated),i.yG2(2),i.oRS(" ",m.lang.text.UserFsDir.NewFolder," "),i.yG2(2),i.oRS(" ",m.lang.text.UserFsDir.AddFile," "),i.yG2(2),i.oRS(" ",m.lang.text.UserFsDir.RemoveCurrentDir," "),i.yG2(),i.E7m("ngIf",""!=m.CurrentDir),i.yG2(),i.E7m("ngForOf",m.DirList),i.yG2(3),i.E7m("ngForOf",m.FileList)}}function ye(g,I){if(1&g){const m=i.KQA();i.I0R(0,"ion-item",18),i.qCj("click",function(){i.usT(m);const s=i.GaO().$implicit,a=i.GaO(2);return i.CGJ(a.importFolderMiddleAct(s))}),i.wR5(1,"ion-icon",11),i.I0R(2,"ion-label"),i.OEk(3),i.C$Y()()}if(2&g){const m=i.GaO().$implicit;i.yG2(3),i.cNF(m.name)}}function Ce(g,I){if(1&g&&(i.I0R(0,"ion-item",48),i.wR5(1,"ion-icon",41),i.I0R(2,"ion-label"),i.OEk(3),i.C$Y()()),2&g){const m=i.GaO().$implicit;i.yG2(3),i.cNF(m.name)}}function Fe(g,I){if(1&g&&(i.I0R(0,"div"),i.yuY(1,ye,4,1,"ion-item",15)(2,Ce,4,1,"ion-item",47),i.C$Y()),2&g){const m=I.$implicit;i.yG2(),i.E7m("ngIf",m.isDirectory),i.yG2(),i.E7m("ngIf",m.isFile)}}function be(g,I){if(1&g){const m=i.KQA();i.I0R(0,"ion-list")(1,"ion-item",18),i.qCj("click",function(){i.usT(m);const s=i.GaO();return i.CGJ(s.InAppBrowser=!0)}),i.wR5(2,"ion-icon",11),i.I0R(3,"ion-label",46),i.OEk(4,"/sdcard/Android/data/org.pjcone.portal/files"),i.C$Y()(),i.yuY(5,Fe,3,2,"div",16),i.C$Y()}if(2&g){const m=i.GaO();i.yG2(5),i.E7m("ngForOf",m.ExternalFolder)}}let De=(()=>{var g;class I{constructor(o,s,a,r,l,e,n,_,h,c,f,p,F){this.modalCtrl=o,this.indexed=s,this.loadingCtrl=a,this.lang=r,this.global=l,this.p5toast=e,this.alertCtrl=n,this.sanitizer=_,this.file=h,this.navCtrl=c,this.noti=f,this.navParams=p,this.nakama=F,this.DirList=[],this.FileList=[],this.cant_dedicated=!1,this.InAppBrowser=!0,this.is_ready=!1,this.is_file_selector=!1,this.HideThumbnail=!1,this.CanImportFolder=!0,this.StopIndexing=!1,this.EventListenerAct=w=>{w.detail.register(110,v=>{this.is_ready?""==this.CurrentDir?v():this.MoveToUpDir():(this.initLoadingElement.dismiss(),this.is_ready=!0)})},this.isCreateFolderRecursive=!1,this.ExternalFolder=[]}toggle_thumbnail(){this.HideThumbnail=!this.HideThumbnail,localStorage.setItem("user-fs-thumbnail",this.HideThumbnail?"1":"0")}ngOnInit(){"DesktopPWA"==C.s1&&setTimeout(()=>{this.CreateDrop()},0),this.CanImportFolder="MobilePWA"!=C.s1}ionViewDidEnter(){this.global.p5key.KeyShortCut.Escape=()=>{this.is_ready?""==this.CurrentDir?this.navCtrl.pop():this.MoveToUpDir():(this.initLoadingElement.dismiss(),this.is_ready=!0)}}CreateDrop(){var o=this;let s=document.getElementById("p5Drop_userfs");this.p5canvas=new t(a=>{a.setup=()=>{let _=a.createCanvas(s.clientWidth,s.clientHeight);_.parent(s),a.pixelDensity(1),_.drop(h=>{let c=a.millis();e<c-400?(l=!1,n.length=0,n.push(h)):(l=!0,n.push(h)),e=c,clearTimeout(r),r=setTimeout((0,d.c)(function*(){if(l)o.MultipleDrops(n);else{let f=yield o.loadingCtrl.create({message:o.lang.text.TodoDetail.WIP});f.present(),o.importSelected(h.file),f.dismiss()}}),400)})};let r,l=!1,e=0,n=[];a.mouseMoved=_=>{_.dataTransfer?(s.style.pointerEvents="all",s.style.backgroundColor="#0008"):(s.style.pointerEvents="none",s.style.backgroundColor="transparent")}})}CreateNewFolder(){var s,o=this;this.alertCtrl.create({header:this.lang.text.UserFsDir.CreateFolder,inputs:[{type:"text",placeholder:this.lang.text.UserFsDir.FolderName}],buttons:[{text:this.lang.text.UserFsDir.Create,handler:(s=(0,d.c)(function*(a){if(a[0])try{let r=`${o.CurrentDir}/${a[0]}`;yield o.indexed.createDirectory(r);let l=yield o.indexed.GetFileInfoFromDB(r),e={path:r,mode:l.mode,timestamp:l.timestamp,db:o.indexed.ionicDB};e.name=a[0],e.dir=o.CurrentDir,o.DirList.push(e)}catch(r){console.error("\ud3f4\ub354 \uc0dd\uc131 \uc2e4\ud328: ",r),o.p5toast.show({text:`${o.lang.text.UserFsDir.FailedToCreateFolder}: ${r}`})}else o.p5toast.show({text:o.lang.text.UserFsDir.NeedFolderName})}),function(r){return s.apply(this,arguments)})}]}).then(s=>s.present())}SelectFiles(){document.getElementById("import_file").click()}MultipleDrops(o){var s=this;return(0,d.c)(function*(){let a=yield s.loadingCtrl.create({message:s.lang.text.TodoDetail.WIP});a.present();for(let r=0,l=o.length;r<l;r++)yield s.importSelected(o[r].file);a.dismiss()})()}inputFileSelected(o){var s=this;return(0,d.c)(function*(){if(o.target.files.length)if(1!=o.target.files.length){let r=yield s.loadingCtrl.create({message:s.lang.text.UserFsDir.MultipleSave});r.present(),s.noti.noti.schedule({id:4,title:s.lang.text.UserFsDir.MultipleSave,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://diychat",color:"b0b0b0"});for(let l=0,e=o.target.files.length;l<e;l++)r.message=`${s.lang.text.UserFsDir.MultipleSave}: ${e-l}`,s.noti.noti.schedule({id:4,title:s.lang.text.UserFsDir.MultipleSave,progressBar:{value:l,maxValue:e},sound:null,smallIcon:"res://diychat",color:"b0b0b0"}),yield s.importSelected(o.target.files[l]);s.noti.ClearNoti(4),r.dismiss()}else{let r=yield s.loadingCtrl.create({message:s.lang.text.TodoDetail.WIP});r.present(),yield s.importSelected(o.target.files[0]),r.dismiss()}})()}importSelected(o){var s=this;return(0,d.c)(function*(){try{let a=`${s.CurrentDir}/${o.name}`;yield s.indexed.saveBlobToUserPath(o,a);let r=yield s.indexed.GetFileInfoFromDB(a),l={path:a,mode:r.mode,timestamp:r.timestamp,db:s.indexed.ionicDB};l.name=o.name,l.dir=s.CurrentDir,l.file_ext=l.name.split(".").pop(),s.global.set_viewer_category_from_ext(l),"image"==l.viewer&&s.indexed.loadBlobFromUserPath(l.path,"",e=>{let n=URL.createObjectURL(e);l.thumbnail=s.sanitizer.bypassSecurityTrustUrl(n)});try{let e=l.path.split("/");if(5!=e.length||"groups"!=e[3])throw"\uadf8\ub8f9 \uc774\ubbf8\uc9c0 \ud30c\uc77c\uc774 \uc544\ub2d8";s.SetDisplayGroupImageName(l,e)}catch{}for(let e=0,n=s.FileList.length;e<n;e++)if(s.FileList[e].path==a){s.FileList.splice(e,1);break}s.FileList.push(l)}catch(a){console.log("importSelected error: ",a)}})()}ionViewWillEnter(){this.HideThumbnail="1"==localStorage.getItem("user-fs-thumbnail"),this.CurrentDir="",this.is_file_selector=!!this.navParams.data.modal,this.LoadAllIndexedFiles(),("DesktopPWA"==C.s1||"MobilePWA"==C.s1)&&(this.cant_dedicated=!0),document.addEventListener("ionBackButton",this.EventListenerAct)}dismiss_page(o){var s=this;return(0,d.c)(function*(){if(s.is_file_selector){let a;o&&(a=yield s.indexed.loadBlobFromUserPath(o.path,""),a.name=o.name,a.file_ext=o.file_ext),s.modalCtrl.dismiss(a)}})()}LoadAllIndexedFiles(){var o=this;return(0,d.c)(function*(){if(o.initLoadingElement=yield o.loadingCtrl.create({message:o.lang.text.UserFsDir.LoadingExplorer}),o.initLoadingElement.present(),o.DirList.length=0,o.FileList.length=0,("Android"==C.s1||"iOS"==C.s1)&&o.noti.noti.schedule({id:5,title:o.lang.text.UserFsDir.LoadingExplorer,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"}),o.is_file_selector)if(o.navParams.get("path")){let s=yield o.indexed.GetFileListFromDB(o.navParams.get("path"));yield o.ModulateIndexedFile(s)}else{let s=yield o.indexed.GetFileListFromDB("/files/"),a=yield o.indexed.GetFileListFromDB("/todo/");s.push.apply(s,a),yield o.ModulateIndexedFile(s)}else{if(o.indexed.godotDB){let a=yield o.indexed.GetFileListFromDB("/",void 0,o.indexed.godotDB);yield o.ModulateIndexedFile(a,o.indexed.godotDB)}let s=yield o.indexed.GetFileListFromDB("/");yield o.ModulateIndexedFile(s)}o.FileList.sort((s,a)=>s.path>a.path?1:s.path<a.path?-1:0),o.DirList.sort((s,a)=>s.path>a.path?1:s.path<a.path?-1:0),setTimeout(()=>{o.noti.ClearNoti(5)},100),o.initLoadingElement.dismiss(),o.is_ready=!0})()}ModulateIndexedFile(o,s=this.indexed.ionicDB){var a=this;return(0,d.c)(function*(){for(let r=0,l=o.length;r<l;r++){if(a.StopIndexing)return;let e=`${a.lang.text.UserFsDir.LoadingExplorer}: ${o.length-r}`;("Android"==C.s1||"iOS"==C.s1)&&a.noti.noti.schedule({id:5,title:e,progressBar:{value:r,maxValue:o.length},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"}),a.initLoadingElement.message=e,yield a.indexed.GetFileInfoFromDB(o[r],n=>{let _={path:o[r],mode:n.mode,timestamp:n.timestamp,db:s};switch(_.name=_.path.substring(_.path.lastIndexOf("/")+1),_.dir=o[r].substring(0,o[r].lastIndexOf("/")),_.mode){case 33206:_.file_ext=_.name.split(".").pop(),a.global.set_viewer_category_from_ext(_),"image"==_.viewer&&a.indexed.loadBlobFromUserPath(_.path,"",f=>{let p=URL.createObjectURL(f);_.thumbnail=a.sanitizer.bypassSecurityTrustUrl(p)},s);try{let f=_.path.split("/");if(5!=f.length||"groups"!=f[3])throw"\uadf8\ub8f9 \uc774\ubbf8\uc9c0 \ud30c\uc77c\uc774 \uc544\ub2d8";a.SetDisplayGroupImageName(_,f)}catch{}a.FileList.push(_);break;case 16893:0==_.path.indexOf("todo/")&&a.SetDisplayTodoName(_);let h=!1,c=_.path.split("/");try{if(5!=c.length||"channels"!=c[3])throw"\ucc44\ub110 \ud3f4\ub354\uac00 \uc544\ub2d8";a.SetDisplayChannelName(_,c),h=!0}catch{}try{if(h||5!=c.length||"users"!=c[3])throw"\uc0ac\uc6a9\uc790 \ud3f4\ub354\uac00 \uc544\ub2d8";a.SetDisplayUserName(_,c),h=!0}catch{}a.DirList.push(_);break;default:console.log("\uc608\uc0c1\ud558\uc9c0 \ubabb\ud55c \ud30c\uc77c \ubaa8\ub4dc: ",_)}},s)}})()}SetDisplayTodoName(o){var s=this;return(0,d.c)(function*(){try{let a=yield s.indexed.loadTextFromUserPath(`${o.path}/info.todo`),r=JSON.parse(a);o.name=r.title}catch(a){console.error("SetDisplayTodoName error: ",a)}})()}SetDisplayUserName(o,s){try{o.name=this.nakama.users[s[1]][s[2]][s[4]].display_name}catch{}}SetDisplayChannelName(o,s){try{o.name=this.nakama.channels_orig[s[1]][s[2]][o.name].title}catch{}}SetDisplayGroupImageName(o,s){try{o.name=`${this.nakama.groups[s[1]][s[2]][s[4].split(".").shift()].name}.img`}catch(a){console.error("SetDisplayGroupImageName error: ",a)}}MoveToUpDir(){this.CurrentDir=this.CurrentDir.substring(0,this.CurrentDir.lastIndexOf("/")),this.FileSel.value=void 0}SelectFolder(o){this.CurrentDir=o.path,this.FileSel.value=void 0}OpenFile(o){var s=this;return(0,d.c)(function*(){if(!s.CheckIfAccessable(o.path))return;document.removeEventListener("ionBackButton",s.EventListenerAct);let a=[];if(s.is_file_selector){if(s.navParams.data.path)for(let r=0,l=s.FileList.length;r<l;r++)a.push({content:s.FileList[r]})}else for(let r=0,l=s.FileList.length;r<l;r++)s.FileList[r].dir==s.CurrentDir&&a.push({content:s.FileList[r]});{let r=yield s.indexed.loadBlobFromUserPath(o.path,"");o.size=r.size}s.modalCtrl.create({component:$.K,componentProps:{info:{content:o},targetDB:s.indexed.ionicDB,no_edit:!0,path:o.path,relevance:a},cssClass:"fullscreen"}).then(r=>{delete s.global.p5key.KeyShortCut.Escape,delete s.global.p5key.KeyShortCut.Digit,r.onDidDismiss().then(l=>{if(l.data)switch(l.data.type){case"image":return void s.modalCtrl.create({component:y.S,componentProps:{path:l.data.path,width:l.data.width,height:l.data.height,text:l.data.text},cssClass:"fullscreen"}).then(e=>{e.onWillDismiss().then(function(){var n=(0,d.c)(function*(_){let h=s.global.Base64ToBlob(_.data.img,"image/png");h.name=_.data.name,yield s.importSelected(h),_.data.loadingCtrl.dismiss(),document.addEventListener("ionBackButton",s.EventListenerAct),s.ionViewDidEnter()});return function(_){return n.apply(this,arguments)}}()),e.present()});case"text":console.log(l),s.importSelected(l.data.blob)}else document.addEventListener("ionBackButton",s.EventListenerAct),s.ionViewDidEnter()}),r.present()})})()}CheckIfAccessable(o){switch(o){case"servers/webrtc_server.json":case"servers/self/profile.json":return this.p5toast.show({text:this.lang.text.UserFsDir.PrivateAccessDenied}),!1}return!0}DownloadFile(o){this.CheckIfAccessable(o.path)&&this.indexed.DownloadFileFromUserPath(o.path,"",o.name)}ExportDirectoryRecursive(){this.alertCtrl.create({header:this.lang.text.UserFsDir.ExportDirTitle,message:this.lang.text.UserFsDir.ExportDirMsg,buttons:[{text:this.lang.text.UserFsDir.ExportConfirm,handler:()=>{this.ExportDirectoryRecursiveAct()}}]}).then(o=>o.present())}ExportDirectoryRecursiveAct(){var o=this;return(0,d.c)(function*(){let s=yield o.loadingCtrl.create({message:o.lang.text.UserFsDir.ExportDirTitle});s.present();let a=yield o.indexed.GetFileListFromDB(o.CurrentDir);for(let r=0,l=a.length;r<l;r++){let e=yield o.indexed.GetFileInfoFromDB(a[r]),n=yield o.indexed.loadBlobFromUserPath(a[r],""),_=a[r].lastIndexOf("/"),h=a[r].substring(0,_),c=a[r].substring(_+1);o.isCreateFolderRecursive||(o.isCreateFolderRecursive=!0,yield o.CreateFolderRecursive(h));try{if(16893==e.mode)throw yield o.file.createDir(o.file.externalDataDirectory+h,c,!0),s.message=`${o.lang.text.UserFsDir.ExportDirTitle}: ${c}`,"\uc774\uac70 \ud3f4\ub354\uc784";if(!o.CheckIfAccessable(a[r]))throw"\uc5f4\ub78c \ubd88\uac00 \ud30c\uc77c \uc81c\uc678";s.message=`${o.lang.text.UserFsDir.ExportDirTitle}: ${c}`,yield o.file.writeFile(o.file.externalDataDirectory+h+"/",c,n,{replace:!0})}catch(f){console.error(a[r],": \ud30c\uc77c \uc800\uc7a5 \uc2e4\ud328: ",f)}}o.isCreateFolderRecursive=!1,s.dismiss()})()}CreateFolderRecursive(o){var s=this;return(0,d.c)(function*(){let a=o.lastIndexOf("/")+1,r=o.substring(0,a),l=o.substring(a);r&&(yield s.CreateFolderRecursive(o.substring(0,a-1)));try{yield s.file.createDir(s.file.externalDataDirectory+r,l,!0)}catch{}})()}BrowseExternalFiles(){var o=this;return(0,d.c)(function*(){o.ExternalFolder.length=0,o.InAppBrowser=!1,o.ExternalFolder=yield o.file.listDir(o.file.externalApplicationStorageDirectory,"files"),o.ExternalFolder.sort(),o.ExternalFolder.sort((s,a)=>s.isDirectory?-1:1)})()}importFolderMiddleAct(o){var s=this;return(0,d.c)(function*(){let a=yield s.loadingCtrl.create({message:s.lang.text.UserFsDir.Import});a.present(),yield s.importThisFolder(o,a),s.InAppBrowser=!0,a.dismiss(),s.p5toast.show({text:s.lang.text.UserFsDir.NeedResetToApply})})()}importThisFolder(o,s){var a=this;return(0,d.c)(function*(){let r=o.nativeURL.substring(0,o.nativeURL.length-1),l=r.lastIndexOf("/"),e=yield a.file.listDir(r.substring(0,l)+"/",r.substring(l+1));for(let n=0,_=e.length;n<_;n++)if(e[n].isDirectory)yield a.importThisFolder(e[n],s);else{let h=e[n].nativeURL.split("org.pjcone.portal/files/")[1];try{let f=(yield W.readFile({path:e[n].nativeURL})).data.replace(/"|\\|=/g,"");yield a.indexed.saveBase64ToUserPath(","+f,decodeURIComponent(h)),s.message=`${a.lang.text.UserFsDir.Import}: ${e[n].name}`}catch(c){console.log("\ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",c),a.p5toast.show({text:`${a.lang.text.UserFsDir.ImportFailed}: ${c}`})}}})()}SelectImportFolder(){this.cant_dedicated?document.getElementById("folder_sel_id").click():this.BrowseExternalFiles()}inputImageSelected(o){var s=this;return(0,d.c)(function*(){let a=yield s.loadingCtrl.create({message:s.lang.text.UserFsDir.LoadingExplorer});a.present();for(let r=0,l=o.target.files.length;r<l;r++)yield s.indexed.saveBlobToUserPath(o.target.files[r],o.target.files[r].webkitRelativePath);s.LoadAllIndexedFiles(),a.dismiss(),s.p5toast.show({text:s.lang.text.UserFsDir.NeedResetToApply})})()}RemoveDirectoryRecursive(){var s,o=this;this.alertCtrl.create({header:this.CurrentDir.substring(this.CurrentDir.lastIndexOf("/")+1)||this.lang.text.UserFsDir.ResetDB,message:this.lang.text.UserFsDir.RemoveThisFolder,buttons:[{text:this.lang.text.UserFsDir.RemoveApply,handler:(s=(0,d.c)(function*(){let a=yield o.loadingCtrl.create({message:o.lang.text.UserFsDir.DeleteFile});a.present(),("Android"==C.s1||"iOS"==C.s1)&&o.noti.noti.schedule({id:4,title:o.lang.text.UserFsDir.DeleteFile,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"});let r=yield o.indexed.GetFileListFromDB(o.CurrentDir);for(let l=0,e=r.length;l<e;l++)("Android"==C.s1||"iOS"==C.s1)&&o.noti.noti.schedule({id:5,title:`${o.lang.text.UserFsDir.DeleteFile}: ${e-l}`,progressBar:{value:l,maxValue:e},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"}),a.message=`${o.lang.text.UserFsDir.DeleteFile}: ${e-l}`,yield o.indexed.removeFileFromUserPath(r[l]);for(let l=o.DirList.length-1;l>=0;l--)0==o.DirList[l].path.indexOf(o.CurrentDir)&&o.DirList.splice(l,1);for(let l=o.FileList.length-1;l>=0;l--)0==o.FileList[l].path.indexOf(o.CurrentDir)&&o.FileList.splice(l,1);r=yield o.indexed.GetFileListFromDB(o.CurrentDir);for(let l=0,e=r.length;l<e;l++)("Android"==C.s1||"iOS"==C.s1)&&o.noti.noti.schedule({id:5,title:`${o.lang.text.UserFsDir.DeleteFile}: ${e-l}`,progressBar:{value:l,maxValue:e},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"}),a.message=`${o.lang.text.UserFsDir.DeleteFile}: ${e-l}`,yield o.indexed.removeFileFromUserPath(r[l]);for(let l=o.DirList.length-1;l>=0;l--)0==o.DirList[l].path.indexOf(o.CurrentDir)&&o.DirList.splice(l,1);for(let l=o.FileList.length-1;l>=0;l--)0==o.FileList[l].path.indexOf(o.CurrentDir)&&o.FileList.splice(l,1);o.MoveToUpDir(),a.dismiss(),setTimeout(()=>{o.noti.ClearNoti(4)},100)}),function(){return s.apply(this,arguments)}),cssClass:"red_font"}]}).then(s=>s.present())}RemoveFile(o,s){this.alertCtrl.create({header:this.lang.text.UserFsDir.DeleteFile,message:this.lang.text.UserFsDir.CannotBeUndo,buttons:[{text:this.lang.text.UserFsDir.DeleteAccept,handler:()=>{this.indexed.removeFileFromUserPath(o.path,()=>{this.FileList.splice(s,1)})},cssClass:"red_font"}]}).then(a=>a.present())}ionViewDidLeave(){this.StopIndexing=!0,this.FileList.forEach(o=>{URL.revokeObjectURL(o.thumbnail)}),this.noti.ClearNoti(4),this.noti.ClearNoti(5)}ionViewWillLeave(){document.removeEventListener("ionBackButton",this.EventListenerAct),delete this.global.p5key.KeyShortCut.Escape,delete this.global.p5key.KeyShortCut.Digit}}return(g=I).\u0275fac=function(o){return new(o||g)(i.GI1(T.qS),i.GI1(E.k),i.GI1(T.Kg),i.GI1(B.o),i.GI1(D.A1),i.GI1(O.O),i.GI1(T.iW),i.GI1(k.mI),i.GI1(A.S),i.GI1(V.wX),i.GI1(M.s),i.GI1(V.a6),i.GI1(N.h))},g.\u0275cmp=i.In1({type:g,selectors:[["app-user-fs-dir"]],viewQuery:function(o,s){if(1&o&&i.CC$(Z,5),2&o){let a;i.wto(a=i.Gqi())&&(s.FileSel=a.first)}},decls:13,vars:5,consts:[[1,"ion-no-border"],["slot","start",3,"click"],["defaultHref",""],["class","top_icon","slot","end","name","eye-outline",3,"click",4,"ngIf"],["class","top_icon","slot","end","name","eye-off-outline",3,"click",4,"ngIf"],["id","p5Drop_userfs",2,"position","absolute","width","100%","height","100%","display","flex","pointer-events","none"],["hidden","","type","file","id","import_file","accept","*","multiple","",3,"change"],[4,"ngIf"],["slot","end","name","eye-outline",1,"top_icon",3,"click"],["slot","end","name","eye-off-outline",1,"top_icon",3,"click"],["button",""],["slot","start","name","folder"],["class","folder_button",3,"click",4,"ngIf"],[1,"folder_button",3,"click"],[3,"click"],["button","",3,"click",4,"ngIf"],[4,"ngFor","ngForOf"],["FileSel",""],["button","",3,"click"],["slot","start","name","arrow-down-circle"],["hidden","","type","file","id","folder_sel_id","webkitdirectory","",3,"change"],[3,"value",4,"ngIf"],[3,"value"],["slot","header"],["slot","start","name","image",4,"ngIf"],["slot","start","name","musical-notes",4,"ngIf"],["slot","start","name","play-circle",4,"ngIf"],["slot","start","name","reader",4,"ngIf"],["slot","start","name","extension-puzzle",4,"ngIf"],["slot","start","name","document",4,"ngIf"],["text-wrap","",4,"ngIf"],[1,"ion-accordion-toggle-icon","hide_accordion_icon"],["slot","content"],["class","ion-text-right button_dist",3,"click",4,"ngIf"],[1,"ion-text-end","button_dist",3,"click"],["class","image_front_form",3,"click",4,"ngIf"],["slot","start","name","image"],["slot","start","name","musical-notes"],["slot","start","name","play-circle"],["slot","start","name","reader"],["slot","start","name","extension-puzzle"],["slot","start","name","document"],["text-wrap",""],[1,"ion-text-right","button_dist",3,"click"],[1,"image_front_form",3,"click"],[1,"image_front_view",3,"src","alt"],["color","medium"],["button","","disabled","",4,"ngIf"],["button","","disabled",""]],template:function(o,s){1&o&&(i.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),i.OEk(3),i.C$Y(),i.I0R(4,"ion-buttons",1),i.qCj("click",function(){return s.dismiss_page()}),i.wR5(5,"ion-back-button",2),i.C$Y(),i.yuY(6,q,1,0,"ion-icon",3)(7,ee,1,0,"ion-icon",4),i.C$Y()(),i.I0R(8,"ion-content")(9,"div",5)(10,"input",6),i.qCj("change",function(r){return s.inputFileSelected(r)}),i.C$Y()(),i.yuY(11,ve,19,8,"ion-list",7)(12,be,6,1,"ion-list",7),i.C$Y()),2&o&&(i.yG2(3),i.cNF(s.lang.text.Settings.InAppExplorer),i.yG2(3),i.E7m("ngIf",!s.HideThumbnail),i.yG2(),i.E7m("ngIf",s.HideThumbnail),i.yG2(4),i.E7m("ngIf",s.InAppBrowser),i.yG2(),i.E7m("ngIf",!s.InAppBrowser))},dependencies:[z.ay,z.u_,T.cm,T.qU,T.sn,T.GS,T._i,T.wB,T.Ko,T.Yb,T.QR,T.OC,T.tM,T.Md,T.Im],styles:[".item.sc-ion-label-md-h[_ngcontent-%COMP%], .item[_ngcontent-%COMP%]   .sc-ion-label-md-h[_ngcontent-%COMP%]{overflow:unset}.image_front_form[_ngcontent-%COMP%]{display:flex;justify-content:center;text-align:center}.image_front_view[_ngcontent-%COMP%]{max-height:233px}.top_icon[_ngcontent-%COMP%]{width:28px;height:28px;padding-right:28px;cursor:pointer}.button_dist[_ngcontent-%COMP%]{padding-left:2px}.folder_button[_ngcontent-%COMP%]{padding-right:4px}"]}),I})()}}]);