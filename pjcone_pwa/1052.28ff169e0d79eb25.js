"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1052],{1052:(Ce,ue,_)=>{_.d(ue,{S:()=>ve});var z=_(1528),j=_(9352),ge=_(5193),Z=_(5020),d=_(4496),we=_(4500),p=_(5624),me=_(9240),ye=_(4668),_e=_(3824);let ve=(()=>{var O;class ae{constructor(r,o,m,e,s,f,h,B){this.lang=r,this.modalCtrl=o,this.alertCtrl=m,this.loadingCtrl=e,this.global=s,this.navParams=f,this.indexed=h,this.p5toast=B,this.BackButtonPressed=!1,this.EventListenerAct=E=>{E.detail.register(130,I=>{})},this.isMobile=!1,this.isCropMode=!1,this.WithoutSave=!0}InitBrowserBackButtonOverride(){window.history.replaceState(null,null,window.location.href),window.onpopstate=()=>{this.BackButtonPressed||(this.BackButtonPressed=!0,this.modalCtrl.dismiss())}}ngOnInit(){this.InitBrowserBackButtonOverride()}ionViewDidEnter(){var r=this;return(0,z.c)(function*(){r.AddShortCut(),document.addEventListener("ionBackButton",r.EventListenerAct),r.mainLoading=yield r.loadingCtrl.create({message:r.lang.text.voidDraw.UseThisImage}),r.create_new_canvas({width:r.navParams.data.width,height:r.navParams.data.height,path:r.navParams.data.path}),r.isMobile="DesktopPWA"!=ge.s1})()}AddShortCut(){delete this.global.p5key.KeyShortCut.Digit,this.global.p5key.KeyShortCut.HistoryAct=r=>{switch(r){case"Z":this.p5voidDraw.history_act(-1);break;case"X":this.p5voidDraw.history_act(1);break;case"C":this.isCropMode?this.p5voidDraw.apply_crop():this.p5voidDraw.change_color();break;case"V":this.p5voidDraw.set_line_weight()}},this.global.p5key.KeyShortCut.AddAct=()=>{this.p5toast.show({text:this.lang.text.voidDraw.Preparing})},this.global.p5key.KeyShortCut.SKeyAct=()=>{this.open_crop_tool()},this.global.p5key.KeyShortCut.DeleteAct=()=>{this.isCropMode?this.p5voidDraw.apply_crop():this.dismiss_draw()},this.global.p5key.KeyShortCut.FKeyAct=()=>{}}create_new_canvas(r){var o=this;return(0,z.c)(function*(){r.width=r.width||432,r.height=r.height||432,o.p5voidDraw&&o.p5voidDraw.remove(),o.create_p5voidDraw(r)})()}waiting(r){return new Promise(o=>setTimeout(()=>{o(void 0)},r))}create_p5voidDraw(r){var o=this;let m=document.getElementById("voidDraw");this.isCropMode=!1,this.p5voidDraw=new j(e=>{let s,f,h,B,E,I,U,W,A=e.createColorPicker("#000"),J=Math.min(r.width,r.height)/100,Q=1;e.setup=(0,z.c)(function*(){e.pixelDensity(1),e.noLoop(),e.noFill(),e.imageMode(e.CENTER),B=e.createCanvas(m.clientWidth,m.clientHeight),B.parent(m),v.x=e.width/2,v.y=e.height/2,e.set_line_weight=()=>{o.alertCtrl.create({header:o.lang.text.voidDraw.changeWeight,inputs:[{label:o.lang.text.voidDraw.weight,name:"weight",placeholder:`${Q}`,type:"number"}],buttons:[{text:o.lang.text.voidDraw.apply,handler:l=>{l.weight&&(Q=Number(l.weight))}}]}).then(l=>{k=!1,l.onWillDismiss().then(()=>{k=!0}),l.present()})},e.change_color=()=>{A.elt.click()},e.save_image=()=>{new j(l=>{l.setup=()=>{let S=l.createCanvas(s.width,s.height);l.pixelDensity(1),h&&l.image(h,0,0),s&&l.image(s,0,0);let L=S.elt.toDataURL("image/png").replace("image/png","image/octet-stream");o.modalCtrl.dismiss({name:`voidDraw_${l.year()}-${l.nf(l.month(),2)}-${l.nf(l.day(),2)}_${l.nf(l.hour(),2)}-${l.nf(l.minute(),2)}-${l.nf(l.second(),2)}.png`,img:L,loadingCtrl:o.mainLoading}),l.remove()}})},e.history_act=l=>{switch(M=e.min(e.max(0,M+l),e.DrawingStack.length),l){case 1:e.DrawingStack.length&&(U.style.fill="var(--ion-color-dark)"),M==e.DrawingStack.length&&(W.style.fill="var(--ion-color-medium)"),q(s,e.DrawingStack[M-1]);break;case-1:e.DrawingStack.length&&(W.style.fill="var(--ion-color-dark)"),M<1?(U.style.fill="var(--ion-color-medium)",s.clear(255,255,255,255),e.redraw()):se()}},e.open_crop_tool=()=>{o.isCropMode?(o.isCropMode=!1,e.redraw()):(o.isCropMode=!0,n.x=s.width,n.y=s.height,b.x=0,b.y=0,e.redraw())},e.apply_crop=()=>{o.isMobile&&b.div(u),s.resizeCanvas(n.x,n.y),f=e.createVector(s.width/2,s.height/2),D.sub(b),se(),h.resizeCanvas(n.x,n.y),h.push(),h.background(Z.Mp?26:255),h.translate(D),e.BaseImage&&h.image(e.BaseImage,0,0),h.pop(),h.redraw(),o.isCropMode=!1,e.SetCanvasViewportInit()},E=e.createElement("table"),E.style("position: absolute; top: 0px;"),E.style(`width: 100%; height: ${y}px;`),E.style("background-color: var(--voidDraw-menu-background);"),E.parent(m);let t=E.elt.insertRow(0),i=t.insertCell(0);i.innerHTML='<ion-icon id="AddTextIcon" style="width: 27px; height: 27px" name="text"></ion-icon>',document.getElementById("AddTextIcon").style.fill="var(--ion-color-medium)",i.style.textAlign="center",i.style.cursor="pointer",i.onclick=()=>{o.p5toast.show({text:o.lang.text.voidDraw.Preparing})};let a=t.insertCell(1);a.innerHTML='<ion-icon style="width: 27px; height: 27px" name="crop"></ion-icon>',a.style.textAlign="center",a.style.cursor="pointer",a.onclick=()=>{o.open_crop_tool()};let w=t.insertCell(2);w.innerHTML='<ion-icon style="width: 27px; height: 27px" name="checkmark"></ion-icon>',w.style.textAlign="center",w.style.cursor="pointer",w.onclick=()=>{o.dismiss_draw()},I=e.createElement("table"),I.style("position: absolute; bottom: 0px;"),I.style(`width: 100%; height: ${y}px;`),I.style("background-color: var(--voidDraw-menu-background);"),I.parent(m);let x=I.elt.insertRow(0),P=x.insertCell(0);P.innerHTML='<ion-icon id="undoIcon" style="width: 27px; height: 27px" name="arrow-undo"></ion-icon>',U=document.getElementById("undoIcon"),U.style.fill="var(--ion-color-medium)",P.style.textAlign="center",P.style.cursor="pointer",P.onclick=()=>{o.p5voidDraw.history_act(-1)};let F=x.insertCell(1);F.innerHTML='<ion-icon id="redoIcon" style="width: 27px; height: 27px" name="arrow-redo"></ion-icon>',W=document.getElementById("redoIcon"),W.style.fill="var(--ion-color-medium)",F.style.textAlign="center",F.style.cursor="pointer",F.onclick=()=>{o.p5voidDraw.history_act(1)};let R=x.insertCell(2);R.innerHTML='<ion-icon style="width: 27px; height: 27px" name="color-palette"></ion-icon>',A.style("width: 0px; height: 0px; opacity: 0;"),A.parent(R),A.elt.oninput=()=>{let l=A.color().levels,S=`#${e.hex(l[0],2)}${e.hex(l[1],2)}${e.hex(l[2],2)}`;R.childNodes[0].style.color=S},R.style.textAlign="center",R.style.cursor="pointer",R.onclick=()=>{A.elt.click()};let N=x.insertCell(3);if(N.innerHTML='<ion-icon style="width: 27px; height: 27px" name="pencil"></ion-icon>',N.style.textAlign="center",N.style.cursor="pointer",N.onclick=()=>{o.change_line_weight()},e.SetCanvasViewportInit=()=>{B.hide(),e.resizeCanvas(m.clientWidth,m.clientHeight),Y.x=e.width/2,Y.y=e.height/2,v.x=0,v.y=0;let l=m.clientHeight-112;u=m.clientWidth/l<s.width/s.height?m.clientWidth/s.width:l/s.height,B.show(),e.redraw()},s=e.createGraphics(r.width,r.height),f=e.createVector(s.width/2,s.height/2),s.pixelDensity(1),s.noLoop(),s.noFill(),e.ActualCanvas=s,h=e.createGraphics(r.width,r.height),h.pixelDensity(1),h.noLoop(),h.noFill(),h.background(Z.Mp?26:255),e.ImageCanvas=h,r.path){let l=yield o.indexed.loadBlobFromUserPath(r.path,""),S=URL.createObjectURL(l);e.loadImage(S,L=>{e.BaseImage=L,h.image(e.BaseImage,0,0),h.redraw(),URL.revokeObjectURL(S),e.SetCanvasViewportInit()},L=>{console.error("\uadf8\ub9bc\ud310 \ubc30\uacbd \uc774\ubbf8\uc9c0 \ubd88\ub7ec\uc624\uae30 \uc624\ub958: ",L),h.redraw(),URL.revokeObjectURL(S),e.SetCanvasViewportInit()})}else h.redraw(),e.SetCanvasViewportInit();r.width<r.height&&(J/=u)});let v=e.createVector(),u=1,Y=e.createVector(0,0),D=e.createVector(),b=e.createVector(),n=e.createVector();e.draw=()=>{if(e.clear(255,255,255,255),e.push(),e.translate(Y),e.scale(u),e.translate(v),e.image(h,0,0),e.image(h,0,0),s&&e.image(h,0,0),s&&e.image(s,0,0),this.isCropMode)e.push(),e.translate(-s.width/2,-s.height/2),e.translate(b),e.noStroke(),e.fill(0,100),e.rect(0,0,n.x,n.y),e.stroke(255,0,0),e.strokeWeight(8),e.beginShape(e.LINES),e.vertex(0,0),e.vertex(n.x,0),e.vertex(n.x,0),e.vertex(n.x,.8*n.y),e.vertex(0,0),e.vertex(0,n.y),e.vertex(0,n.y),e.vertex(.8*n.x,n.y),e.stroke(255,255,0),e.vertex(.8*n.x,n.y),e.vertex(n.x,n.y),e.vertex(n.x,.8*n.y),e.vertex(n.x,n.y),e.endShape(),e.pop();else if(c&&c.pos&&c.pos.length){e.push(),e.translate(D),e.stroke(c.color),e.strokeWeight(c.weight),e.beginShape();for(let t=0,i=c.pos.length;t<i;t++)e.curveVertex(c.pos[t].x-f.x,c.pos[t].y-f.y);e.endShape(),e.pop()}e.pop()},e.DrawingStack=[];let M=0,se=()=>{s.clear(255,255,255,255);for(let t=0;t<M;t++)q(s,e.DrawingStack[t])},q=(t,i=c)=>{if(i.color){t.push(),t.translate(D),t.stroke(i.color),t.strokeWeight(i.weight),t.beginShape();for(let a=0,w=i.pos.length;a<w;a++)t.curveVertex(i.pos[a].x,i.pos[a].y);t.endShape(),t.pop(),t.redraw(),e.redraw()}};e.windowResized=()=>{setTimeout(()=>{e.SetCanvasViewportInit()},0)};let c={};const y=56;let ee,V,te,ie,ne,K,re,oe=0,G=!1,C=!1;e.mousePressed=t=>{if(k){if(e.mouseY<y||e.mouseY>e.height-y)return void(C=!0);switch(t.which){case 1:this.isCropMode?ce():he();break;case 3:V=e.createVector(e.mouseX,e.mouseY),K=v.copy(),ee=e.createVector(e.mouseX,e.mouseY);break;case 2:e.SetCanvasViewportInit()}}};let ce=(t,i)=>{let a=T(t,i),w=b.copy().add(n).sub(e.createVector(s.width/2,s.height/2)),x=a.dist(w),P=.2*e.max(n.x,n.y);G=x<P,G?(ie=e.createVector(e.mouseX,e.mouseY),re=n.copy()):te=e.createVector(e.mouseX,e.mouseY).sub(b.mult(u))},he=(t,i)=>{U.style.fill="var(--ion-color-dark)",W.style.fill="var(--ion-color-medium)";let a=T(t,i);a.sub(D),a.add(f);let w={x:a.x,y:a.y},x=A.color().levels,P=`#${e.hex(x[0],2)}${e.hex(x[1],2)}${e.hex(x[2],2)}`;c={pos:[],color:P,weight:J*Q},c.pos.push(w),c.pos.push(w),e.redraw()};e.mouseDragged=t=>{if(k)switch(t.which){case 1:if(this.isCropMode&&!C){let i=e.createVector(e.mouseX,e.mouseY);G?n=re.copy().add(ie.copy().sub(i).div(-u)):b=te.copy().sub(i).div(-u),e.redraw()}else{let i=T();i.sub(D),i.add(f),c&&c.pos&&c.pos.push({x:i.x,y:i.y}),e.redraw()}break;case 3:ee=e.createVector(e.mouseX,e.mouseY),v=K.copy().add(ee.sub(V).div(u)),e.redraw()}},e.mouseWheel=t=>{k&&(e.mouseY<y||e.mouseY>e.height-y?C=!0:(fe(T()),u*=t.deltaY<0?1.1:.9,e.redraw()))},e.mouseReleased=t=>{if(k){if(1===t.which&&!this.isCropMode&&!C){let i=T();i.sub(D),i.add(f);let a={x:i.x,y:i.y};if(c)try{c.pos.push(a),c.pos.push(a)}catch{}de()}C=!1}};let fe=t=>{Y=e.createVector(e.mouseX,e.mouseY),v=t.mult(-1)},T=(t,i)=>{let a=e.createVector(t||e.mouseX,i||e.mouseY);return a.sub(Y),a.div(u),a.sub(v),a},g=[],$=!1,k=!0;e.touchStarted=t=>{if(k){if(g=t.touches,t.changedTouches[0].clientY<y||t.changedTouches[0].clientY>e.height-y)return void(C=!0);switch($=!0,g.length){case 1:this.isCropMode?ce(t.changedTouches[0].clientX,t.changedTouches[0].clientY-y):he(t.changedTouches[0].clientX,t.changedTouches[0].clientY-y);break;case 2:let i=e.createVector(g[0].clientX,g[0].clientY-56),a=e.createVector(g[1].clientX,g[1].clientY-56);oe=i.dist(a),V=i.copy().add(a).div(2),K=v.copy(),ne=u,c=void 0;break;default:$=!1,e.SetCanvasViewportInit()}}},e.touchMoved=t=>{if(k&&$){switch(g=t.touches,g.length){case 1:if(this.isCropMode&&!C){let i=e.createVector(t.changedTouches[0].clientX,t.changedTouches[0].clientY-y);G?n=re.copy().add(ie.copy().sub(i).div(-u)):b=te.copy().sub(i).div(-u),e.redraw()}else{let i=T(t.changedTouches[0].clientX,t.changedTouches[0].clientY-y);i.sub(D),i.add(f),c&&c.pos&&c.pos.push({x:i.x,y:i.y}),e.redraw()}break;case 2:{let i=e.createVector(g[0].clientX,g[0].clientY-56),a=e.createVector(g[1].clientX,g[1].clientY-56),w=i.copy().add(a).div(2);u=i.dist(a)/oe*ne,v=K.copy().add(w.sub(V).div(u)),e.redraw()}}return!1}},e.touchEnded=t=>{if(k&&t.changedTouches){switch(g=t.touches,$=!1,g.length){case 0:if(!this.isCropMode&&!C&&c){let i=T(t.changedTouches[0].clientX,t.changedTouches[0].clientY-y);i.sub(D),i.add(f);let a={x:i.x,y:i.y};c.pos.push(a),c.pos.push(a),de()}break;case 1:if(!$)return;xe(),oe=0,c=void 0}C=!1}};let xe=()=>{V=e.createVector(g[0].clientX,g[0].clientY-56),K=v.copy()},de=()=>{e.DrawingStack.length=M,c&&(e.DrawingStack.push(c),q(s,c)),M=e.DrawingStack.length,V=void 0,C=!1,c=void 0,e.redraw()}})}new_image(){this.alertCtrl.create({header:this.lang.text.voidDraw.newDraw,inputs:[{name:"width",type:"number",placeholder:`${this.lang.text.voidDraw.width} (${this.lang.text.voidDraw.default_size}: 432)`},{name:"height",type:"number",placeholder:`${this.lang.text.voidDraw.height} (${this.lang.text.voidDraw.default_size}: 432)`}],buttons:[{text:this.lang.text.voidDraw.CreateNew,handler:o=>{o.width=o.width?Number(o.width):432,o.height=o.height?Number(o.height):432,this.create_new_canvas(o)}}]}).then(o=>o.present())}change_line_weight(){this.p5voidDraw.set_line_weight()}open_crop_tool(){this.p5voidDraw.open_crop_tool()}dismiss_draw(){this.isCropMode?this.p5voidDraw.apply_crop():(this.mainLoading.present(),this.WithoutSave=!1,this.p5voidDraw.save_image())}RemoveShortCut(){delete this.global.p5key.KeyShortCut.HistoryAct,delete this.global.p5key.KeyShortCut.AddAct,delete this.global.p5key.KeyShortCut.DeleteAct,delete this.global.p5key.KeyShortCut.SKeyAct,delete this.global.p5key.KeyShortCut.FKeyAct}ionViewWillLeave(){this.RemoveShortCut(),this.p5voidDraw&&this.p5voidDraw.remove()}ionViewDidLeave(){document.removeEventListener("ionBackButton",this.EventListenerAct),this.WithoutSave&&this.mainLoading.remove()}}return(O=ae).\u0275fac=function(r){return new(r||O)(d.GI1(we.o),d.GI1(p.qS),d.GI1(p.iW),d.GI1(p.Kg),d.GI1(Z.A1),d.GI1(me.a6),d.GI1(ye.k),d.GI1(_e.O))},O.\u0275cmp=d.In1({type:O,selectors:[["app-void-draw"]],decls:8,vars:1,consts:[[1,"ion-no-border"],["slot","start",3,"click"],["defaultHref",""],["oncontextmenu","return false;"],["id","voidDraw",1,"full_screen",2,"display","flex","overflow","hidden","background-color","black"]],template:function(r,o){1&r&&(d.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),d.OEk(3),d.C$Y(),d.I0R(4,"ion-buttons",1),d.qCj("click",function(){return o.modalCtrl.dismiss()}),d.wR5(5,"ion-back-button",2),d.C$Y()()(),d.I0R(6,"ion-content",3),d.wR5(7,"div",4),d.C$Y()),2&r&&(d.yG2(3),d.cNF(o.lang.text.ChatRoom.voidDraw))},dependencies:[p.GS,p._i,p.wB,p.tM,p.Md,p.Im]}),ae})()}}]);