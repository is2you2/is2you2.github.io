(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8696,4712],{8696:(P,A,f)=>{"use strict";f.d(A,{C:()=>V});var _=f(1528),p=f(9352),l=(f(4616),f(9596)),a=f(7136),h=f(4712),m=f(5020),T=f(4496),S=f(5624),k=f(3824),x=f(4668),I=f(4500),R=f(7756);let V=(()=>{var N;class ${constructor(b,v,E,B,w,U){this.modalCtrl=b,this.p5toast=v,this.indexed=E,this.lang=B,this.nakama=w,this.mClipboard=U,this.OnUse=!1,this.isCallable=!1,this.isConnected=!1,this.JoinInited=!1,this.ReceivedOfferPart="",this.ReceivedAnswerPart="",this.IceCandidates=[],this.dataChannel={},this.dataChannelOpenAct={},this.dataChannelOnMsgAct={},this.dataChannelOnCloseAct={},this.nakama.WebRTCService=this}initialize(b,v,E,B){var w=this;return(0,_.c)(function*(){if("http:"==window.location.protocol&&0!=window.location.host.indexOf("localhost")){let D=w.nakama.get_all_online_server(),F="https://is2you2.github.io/pjcone_pwa/";F+=`?tmp_user=${w.nakama.users.self.email},${w.nakama.users.self.password},${w.nakama.users.self.display_name}`;for(let M=0,W=D.length;M<W;M++)F+=`&server=${D[M].info.name||""},${D[M].info.address||""},${D[M].info.useSSL||""},${D[M].info.port||""},${D[M].info.key||""}`;F+=`&open_prv_channel=${E.user_id},${E.isOfficial||"official"},${E.target||"DevTestServer"}`;try{let M=yield w.indexed.loadTextFromUserPath("servers/webrtc_server.json"),W=JSON.parse(M);for(let K=0,Y=W.length;K<Y;K++)F+=`&rtcserver=[${W[K].urls}],${W[K].username},${W[K].credential}`}catch{}try{yield w.mClipboard.copy(F)}catch{}throw window.open(F,"_system"),"\ubaa8\ubc14\uc77c \uad8c\ud55c \uc624\ub958"}if(yield h.G.requestAudioRecordingPermission(),w.OnUse)throw w.p5toast.show({text:w.lang.text.WebRTCDevManager.AlreadyCalling}),w.lang.text.WebRTCDevManager.AlreadyCalling;if(yield w.close_webrtc(B),w.TypeIn=b,w.nakama.socket_reactive.WEBRTC_INIT_REQ_SIGNAL=(0,_.c)(function*(){let F=JSON.stringify(w.LocalOffer).match(/(.{1,64})/g);for(let M=0,W=F.length;M<W;M++)yield w.nakama.servers[w.isOfficial][w.target].socket.sendMatchState(w.CurrentMatch.match_id,a.i.WEBRTC_REPLY_INIT_SIGNAL,encodeURIComponent(F[M]));yield w.nakama.servers[w.isOfficial][w.target].socket.sendMatchState(w.CurrentMatch.match_id,a.i.WEBRTC_REPLY_INIT_SIGNAL,encodeURIComponent("EOL"))}),w.nakama.socket_reactive.WEBRTC_REPLY_INIT_SIGNAL=D=>{"EOL"==D?(w.createRemoteOfferFromAnswer(JSON.parse(w.ReceivedOfferPart)),w.ReceivedOfferPart=""):w.ReceivedOfferPart+=D},w.nakama.socket_reactive.WEBRTC_RECEIVE_ANSWER=D=>{"EOL"==D?(w.ReceiveRemoteAnswer(JSON.parse(w.ReceivedAnswerPart)),w.ReceivedAnswerPart=""):w.ReceivedAnswerPart+=D},w.nakama.socket_reactive.WEBRTC_ICE_CANDIDATES=D=>{w.ReceiveIceCandidate(JSON.parse(D))},w.nakama.socket_reactive.WEBRTC_NEGOCIATENEEDED=D=>{"EOL"==D?(w.createRemoteOfferFromAnswer(JSON.parse(w.ReceivedOfferPart)),w.ReceivedOfferPart="",w.CreateAnswer()):w.ReceivedOfferPart+=D},w.nakama.socket_reactive.WEBRTC_RECEIVED_CALL_SELF=D=>{w.close_webrtc(!1)},E&&(w.isOfficial=E.isOfficial,w.target=E.target,w.user_id=E.user_id,w.channel_id=E.channel_id),"data"!=b){w.createP5_panel();try{var U,G;w.localMedia=document.createElement(b),w.localMedia.id="webrtc_video",w.localMedia.style.width="100%",w.localMedia.style.height="fit-content",w.localMedia.autoplay=!0,"video"==b&&(w.localMedia.playsInline=!0),w.localMedia.muted=!0,document.body.appendChild(w.localMedia),w.remoteMedia=document.createElement(b),w.remoteMedia.id="webrtc_video_remote",w.remoteMedia.style.width="100%",w.remoteMedia.style.height="fit-content",w.remoteMedia.autoplay=!0,"video"==b&&(w.remoteMedia.playsInline=!0),document.body.appendChild(w.remoteMedia);let F,M,D=yield w.getDeviceList(),W=Number(null!==(U=localStorage.getItem("VideoInputDev"))&&void 0!==U?U:NaN),K=Number(null!==(G=localStorage.getItem("AudioInputDev"))&&void 0!==G?G:NaN);for(let Y=0,z=D.length,te=0,re=0;Y<z&&(!F||!M);Y++)!F&&"audioinput"==D[Y].kind&&(Number.isNaN(K)?(F=D[Y].deviceId,localStorage.setItem("AudioInputDev",`${re}`)):re==K&&(F=D[Y].deviceId),re++),!M&&"videoinput"==D[Y].kind&&(Number.isNaN(W)?(M=D[Y].deviceId,localStorage.setItem("AudioInputDev",`${te}`)):te==W&&(M=D[Y].deviceId),te++);v||(v={},"video"==b?(v.video=!0,M&&(v.video={deviceId:M})):v.video=!1,v.audio=!0,F&&(v.audio={deviceId:F})),w.localStream=yield navigator.mediaDevices.getUserMedia(v),w.localMedia.srcObject=w.localStream,w.isCallable=!0}catch(D){console.log("navigator.getUserMedia error: ",D),yield w.close_webrtc(),w.p5toast.show({text:`${w.lang.text.WebRTCDevManager.InitErr}: ${D}`})}}yield w.createCall(),w.p5canvas&&(w.p5canvas.call_button.elt.disabled=!1)})()}createP5_panel(){var b=this;this.OnUse=!0,this.p5canvas&&(clearTimeout(this.p5canvas.waiting_act),this.p5canvas.remove()),this.p5canvas=new p(v=>{let E,B,w,U,G,D,F,M,W,K,Y=1;v.setup=()=>{let q,ne=()=>{this.JoinInited?(q.stop(.1),clearTimeout(v.waiting_act)):(q&&q.stop(.1),q=new p.Oscillator(380,"sine"),q.start(),q.amp(1,.15),q.amp(0,.75),v.waiting_act=setTimeout(()=>{ne()},1200))};v.waiting_act=setTimeout(()=>{ne()},0),v.hangup=(H=!1)=>{!this.isConnected&&!H||(q.stop(.1),clearTimeout(v.waiting_act),q=new p.Oscillator(380,"sine"),q.start(),q.freq(250,.35),q.amp(1,.15),q.amp(0,.25),q.amp(1,.35),q.amp(0,.45))},v.noCanvas(),E=v.createDiv(),E.id("outterDiv"),E.style("position: absolute; left: 50%; top: 0px; z-index: 1"),E.style("transform: translateX(-50%)"),E.style("width: fit-content; height: fit-content"),E.style("padding: 8px 16px;"),E.style("display: flex; justify-content: center;"),U=v.createDiv(),U.parent(E),U.style("display: flex; justify-content: center;"),U.style("width: fit-content; height: fit-content"),U.style("border-radius: 32px"),U.style("background: #"+(m.Mp?"30564e88":"ff754e88")),U.style("padding: 6px 12px"),B=v.createDiv(),B.parent(U),B.id("webrtc_content"),B.style("display: flex; justify-content: center;"),B.style("flex-direction","column"),B.style("width: fit-content; height: fit-content"),B.style("word-break: break-all"),B.style("background: #"+(m.Mp?"30564e88":"ff754e88")),B.style("border-radius: 32px"),B.style("padding: 6px 12px"),B.style("color: "+(m.Mp?"white":"black")),re(),this.isOfficial&&this.target&&(this.user_id&&(w=v.createDiv(this.nakama.users[this.isOfficial][this.target][this.user_id].display_name)),w.parent(B),w.style("text-align","center"),w.style("align-self","center"),w.style("width","100%"),w.style("height","fit-content"),w.style("pointer-events","none")),G=v.createDiv(),G.parent(B),G.id("webrtc_content"),G.style("display: flex; justify-content: center;"),G.style("align-self","center"),G.style("width: fit-content; height: fit-content"),D=v.createButton('<ion-icon style="width: 32px; height: 32px;" name="call-outline"></ion-icon>'),D.parent(G),D.style("padding","0px"),D.style("margin","4px"),D.style("border-radius","16px"),D.style("width","40px"),D.style("height","40px"),D.mouseClicked(()=>{this.CreateAnswer()}),D.elt.disabled=!0,v.call_button=D,F=v.createButton('<ion-icon style="width: 32px; height: 32px;" name="mic-outline"></ion-icon>'),F.parent(G),F.style("padding","0px"),F.style("margin","4px"),F.style("border-radius","16px"),F.style("width","40px"),F.style("height","40px"),F.mouseClicked(()=>{const H=this.localStream.getAudioTracks();for(let J=0,ue=H.length;J<ue;J++)H[J].enabled=!1;M.show(),F.hide()}),M=v.createButton('<ion-icon style="width: 32px; height: 32px;" name="mic-off-outline"></ion-icon>'),M.parent(G),M.style("background-color","grey"),M.style("padding","0px"),M.style("margin","4px"),M.style("border-radius","16px"),M.style("width","40px"),M.style("height","40px"),M.mouseClicked(()=>{const H=this.localStream.getAudioTracks();for(let J=0,ue=H.length;J<ue;J++)H[J].enabled=!0;F.show(),M.hide()}),M.hide(),W=v.createButton('<ion-icon style="width: 32px; height: 32px;" name="settings-outline"></ion-icon>'),W.parent(G),W.style("padding","0px"),W.style("margin","4px"),W.style("border-radius","16px"),W.style("width","40px"),W.style("height","40px"),W.mouseClicked((0,_.c)(function*(){W.elt.disabled=!0;let H=yield b.getDeviceList();b.modalCtrl.create({component:l.I,componentProps:{list:H}}).then(J=>{J.onDidDismiss().then(function(){var ue=(0,_.c)(function*(oe){W.elt.disabled=!1;try{let Z={};oe.data.videoinput&&(Z.video={deviceId:oe.data.videoinput.deviceId}),oe.data.audioinput&&(Z.audio={deviceId:oe.data.audioinput.deviceId}),b.PeerConnection.removeStream(b.localStream),b.localStream=yield navigator.mediaDevices.getUserMedia(Z),b.localMedia.srcObject=b.localStream,b.localStream.getTracks().forEach(He=>b.PeerConnection.addTrack(He,b.localStream))}catch{}});return function(oe){return ue.apply(this,arguments)}}()),J.present()})})),K=v.createButton('<ion-icon style="width: 32px; height: 32px;" name="close-circle-outline"></ion-icon>'),K.parent(G),K.style("background-color","red"),K.style("padding","0px"),K.style("margin","4px"),K.style("border-radius","16px"),K.style("width","40px"),K.style("height","40px"),K.mouseClicked((0,_.c)(function*(){yield b.close_webrtc()}))};let te=!1;v.draw=()=>{Y>0&&(Y-=.03),re(),this.OnUse||this.p5canvas&&!te&&(this.p5canvas.hangup(),E.hide(),setTimeout(()=>{this.OnUse||this.p5canvas.remove()},1e3),te=!0)};let re=()=>{let q=v.lerpColor(v.color("#"+(m.Mp?"30564e88":"ff754e88")),v.color("#ffd94ebb"),Y).levels,ne=4*Y;U.style(`padding: ${ne}px ${ne}px`),B.style(`padding: ${v.lerp(6,2,Y)}px ${v.lerp(12,8,Y)}px`),U.style(`background: rgba(${q[0]}, ${q[1]}, ${q[2]}, ${q[3]/255})`)}})}getDeviceList(){return(0,_.c)(function*(){return yield navigator.mediaDevices.enumerateDevices()})()}createCall(){var b=this;return(0,_.c)(function*(){let v;b.isCallable=!1,b.isConnected=!0,b.startTime=window.performance.now();try{let E=yield b.indexed.loadTextFromUserPath("servers/webrtc_server.json");v={},v.iceServers=JSON.parse(E)}catch{}"data"!=b.TypeIn&&(!v||!v.iceServers||!v.iceServers.length)&&(b.p5toast.show({text:b.lang.text.WebRTCDevManager.NoRegServer}),v=void 0),b.PeerConnection=new RTCPeerConnection(v),b.PeerConnection.addEventListener("icecandidate",E=>b.handleConnection(E)),b.PeerConnection.addEventListener("connectionstatechange",function(){var E=(0,_.c)(function*(B){switch(B.target.connectionState){case"failed":case"disconnected":yield b.close_webrtc();break;case"connected":b.p5canvas&&clearTimeout(b.p5canvas.waiting_act);break;default:console.log("\uc5f0\uacb0 \uc0c1\ud0dc \ubcc0\uacbd\ub428: ",B.target.connectionState)}});return function(B){return E.apply(this,arguments)}}()),"data"!=b.TypeIn&&(b.localStream.getTracks().forEach(E=>b.PeerConnection.addTrack(E,b.localStream)),b.PeerConnection.addEventListener("addstream",E=>{b.remoteMedia.srcObject=E.stream})),b.PeerConnection.addEventListener("datachannel",E=>{b.dataChannel[E.channel.label]=E.channel,b.createDataChannelListener(E.channel.label)}),b.PeerConnection.addEventListener("negotiationneeded",function(){var E=(0,_.c)(function*(B){if(b.JoinInited&&(yield b.PeerConnection.createOffer({offerToReceiveVideo:1}).then(w=>b.createdOffer(w)).catch(w=>b.setSessionDescriptionError(w)),"data"!=b.TypeIn)){let U=JSON.stringify(b.LocalOffer).match(/(.{1,64})/g);for(let G=0,D=U.length;G<D;G++)yield b.nakama.servers[b.isOfficial][b.target].socket.sendMatchState(b.CurrentMatch.match_id,a.i.WEBRTC_NEGOCIATENEEDED,encodeURIComponent(U[G]));yield b.nakama.servers[b.isOfficial][b.target].socket.sendMatchState(b.CurrentMatch.match_id,a.i.WEBRTC_NEGOCIATENEEDED,encodeURIComponent("EOL"))}});return function(B){return E.apply(this,arguments)}}())})()}createDataChannel(b,v){this.dataChannel[b]=this.PeerConnection.createDataChannel(b,v),this.createDataChannelListener(b)}createDataChannelListener(b){this.dataChannel[b].addEventListener("open",v=>{this.dataChannelOpenAct[b]&&this.dataChannelOpenAct[b]()}),this.dataChannel[b].addEventListener("close",v=>{this.dataChannelOnCloseAct[b]&&this.dataChannelOnCloseAct[b]()}),this.dataChannel[b].addEventListener("message",v=>{this.dataChannelOnMsgAct[b]&&this.dataChannelOnMsgAct[b](v.data)})}send(b,v){try{this.dataChannel[b].send(v)}catch(E){console.log("WebRTC \uba54\uc2dc\uc9c0 \ubc1c\uc1a1 \uc2e4\ud328: ",E)}}CreateOfffer(){this.p5canvas&&this.p5canvas.call_button.hide(),this.PeerConnection.createOffer({offerToReceiveVideo:1}).then(b=>this.createdOffer(b)).catch(b=>this.setSessionDescriptionError(b))}handleConnection(b){let v=b.candidate;v&&this.IceCandidates.push(new RTCIceCandidate(v))}ReceiveIceCandidate(b){var v=this;this.ReplyIceCandidate&&clearTimeout(this.ReplyIceCandidate),this.ReplyIceCandidate=setTimeout((0,_.c)(function*(){if("data"!=v.TypeIn)for(let E=0,B=v.IceCandidates.length;E<B;E++)yield v.nakama.servers[v.isOfficial][v.target].socket.sendMatchState(v.CurrentMatch.match_id,a.i.WEBRTC_ICE_CANDIDATES,encodeURIComponent(JSON.stringify(v.IceCandidates[E])));v.IceCandidates.length=0}),800),this.PeerConnection.addIceCandidate(b).then(()=>{console.log("Success to add new ice candidate")}).catch(E=>{console.error("failed to add ice candidate: ",E)})}createdOffer(b){this.LocalOffer=b,this.PeerConnection.setLocalDescription(b).then(()=>{this.setLocalDescriptionSuccess(this.PeerConnection)}).catch(v=>this.setSessionDescriptionError(v))}createRemoteOfferFromAnswer(b){this.PeerConnection.setRemoteDescription(b).then(()=>{this.setRemoteDescriptionSuccess(this.PeerConnection)}).catch(v=>this.setSessionDescriptionError(v))}CreateAnswer(){this.PeerConnection.createAnswer().then(b=>this.createdAnswer(b)).catch(b=>this.setSessionDescriptionError(b))}setLocalDescriptionSuccess(b){this.setDescriptionSuccess(b,"setLocalDescription")}setRemoteDescriptionSuccess(b){this.setDescriptionSuccess(b,"setRemoteDescription")}createdAnswer(b){var v=this;return(0,_.c)(function*(){if(v.p5canvas&&v.p5canvas.call_button.hide(),v.LocalAnswer=b,v.PeerConnection.setLocalDescription(b).then(()=>{v.setLocalDescriptionSuccess(v.PeerConnection)}).catch(E=>v.setSessionDescriptionError(E)),"data"!=v.TypeIn){let B=JSON.stringify(b).match(/(.{1,64})/g);for(let w=0,U=B.length;w<U;w++)yield v.nakama.servers[v.isOfficial][v.target].socket.sendMatchState(v.CurrentMatch.match_id,a.i.WEBRTC_RECEIVE_ANSWER,encodeURIComponent(B[w]));yield v.nakama.servers[v.isOfficial][v.target].socket.sendMatchState(v.CurrentMatch.match_id,a.i.WEBRTC_RECEIVE_ANSWER,encodeURIComponent("EOL"))}yield v.nakama.servers[v.isOfficial][v.target].socket.sendMatchState(v.nakama.self_match[v.isOfficial][v.target].match_id,a.i.WEBRTC_RECEIVED_CALL_SELF,encodeURIComponent("")),v.JoinInited=!0})()}ReceiveRemoteAnswer(b){var v=this;return(0,_.c)(function*(){if(v.PeerConnection.setRemoteDescription(b).then(()=>{v.setRemoteDescriptionSuccess(v.PeerConnection)}).catch(E=>v.setSessionDescriptionError(E)),"data"!=v.TypeIn){for(let E=0,B=v.IceCandidates.length;E<B;E++)yield v.nakama.servers[v.isOfficial][v.target].socket.sendMatchState(v.CurrentMatch.match_id,a.i.WEBRTC_ICE_CANDIDATES,encodeURIComponent(JSON.stringify(v.IceCandidates[E])));v.IceCandidates.length=0}})()}setSessionDescriptionError(b){console.error(`Failed to create session description: ${b}.`)}setDescriptionSuccess(b,v){console.log(`Local ${v} complete.`)}HangUpCall(b){var v=this;return(0,_.c)(function*(){v.p5canvas&&v.p5canvas.hangup(),v.isCallable=!0,v.isConnected=!1,v.PeerConnection&&v.PeerConnection.close(),v.PeerConnection=void 0;try{b&&(yield v.nakama.servers[v.isOfficial][v.target].socket.sendMatchState(v.CurrentMatch.match_id,a.i.WEBRTC_HANGUP,""),yield v.nakama.servers[v.isOfficial][v.target].socket.leaveMatch(v.CurrentMatch.match_id))}catch{}})()}close_webrtc(b=!0){var v=this;return(0,_.c)(function*(){yield v.HangUpCall(b),v.localMedia&&v.localMedia.remove(),v.remoteMedia&&v.remoteMedia.remove(),v.OnUse=!1,v.isCallable=!1,v.isConnected=!1,v.localStream&&(v.localStream.getVideoTracks().forEach(E=>E.stop()),v.localStream.getAudioTracks().forEach(E=>E.stop())),v.localMedia=void 0,v.localStream=void 0,v.remoteMedia=void 0,v.dataChannelOpenAct={},v.dataChannelOnCloseAct={},v.dataChannelOnMsgAct={},v.dataChannel={},v.ReceivedOfferPart="",v.ReceivedAnswerPart="",v.JoinInited=!1,delete v.nakama.socket_reactive.WEBRTC_INIT_REQ_SIGNAL,delete v.nakama.socket_reactive.WEBRTC_REPLY_INIT_SIGNAL,delete v.nakama.socket_reactive.WEBRTC_RECEIVE_ANSWER,delete v.nakama.socket_reactive.WEBRTC_ICE_CANDIDATES,delete v.nakama.socket_reactive.WEBRTC_NEGOCIATENEEDED,delete v.nakama.socket_reactive.WEBRTC_RECEIVED_CALL_SELF,v.IceCandidates.length=0})()}}return(N=$).\u0275fac=function(b){return new(b||N)(T.CoB(S.qS),T.CoB(k.O),T.CoB(x.k),T.CoB(I.o),T.CoB(a.h),T.CoB(R._))},N.\u0275prov=T.wxM({token:N,factory:N.\u0275fac,providedIn:"root"}),$})()},4712:(P,A,f)=>{"use strict";f.d(A,{G:()=>p});const p=(0,f(6400).C_)("VoiceRecorder",{web:()=>f.e(5840).then(f.bind(f,5840)).then(s=>new s.VoiceRecorderWeb)})},4616:()=>{!function(P){var A={};function f(_){if(A[_])return A[_].exports;var p=A[_]={i:_,l:!1,exports:{}};return P[_].call(p.exports,p,p.exports,f),p.l=!0,p.exports}f.m=P,f.c=A,f.d=function(_,p,s){f.o(_,p)||Object.defineProperty(_,p,{enumerable:!0,get:s})},f.r=function(_){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(_,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(_,"__esModule",{value:!0})},f.t=function(_,p){if(1&p&&(_=f(_)),8&p||4&p&&"object"==typeof _&&_&&_.__esModule)return _;var s=Object.create(null);if(f.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:_}),2&p&&"string"!=typeof _)for(var r in _)f.d(s,r,function(c){return _[c]}.bind(null,r));return s},f.n=function(_){var p=_&&_.__esModule?function(){return _.default}:function(){return _};return f.d(p,"a",p),p},f.o=function(_,p){return Object.prototype.hasOwnProperty.call(_,p)},f.p="",f(f.s=40)}([function(P,A,f){var _;_=function(){"use strict";function p(r,c){this.isUndef(r)||1===r?this.input=this.context.createGain():1<r&&(this.input=new Array(r)),this.isUndef(c)||1===c?this.output=this.context.createGain():1<c&&(this.output=new Array(r))}var s;return p.prototype.set=function(r,c,l){if(this.isObject(r))l=c;else if(this.isString(r)){var a={};a[r]=c,r=a}e:for(var h in r){c=r[h];var m=this;if(-1!==h.indexOf(".")){for(var T=h.split("."),S=0;S<T.length-1;S++)if((m=m[T[S]])instanceof p){T.splice(0,S+1);var k=T.join(".");m.set(k,c);continue e}h=T[T.length-1]}var x=m[h];this.isUndef(x)||(p.Signal&&x instanceof p.Signal||p.Param&&x instanceof p.Param?x.value!==c&&(this.isUndef(l)?x.value=c:x.rampTo(c,l)):x instanceof AudioParam?x.value!==c&&(x.value=c):x instanceof p?x.set(c):x!==c&&(m[h]=c))}return this},p.prototype.get=function(r){this.isUndef(r)?r=this._collectDefaults(this.constructor):this.isString(r)&&(r=[r]);for(var c={},l=0;l<r.length;l++){var a=r[l],h=this,m=c;if(-1!==a.indexOf(".")){for(var T=a.split("."),S=0;S<T.length-1;S++){var k=T[S];m[k]=m[k]||{},m=m[k],h=h[k]}a=T[T.length-1]}var x=h[a];this.isObject(r[a])?m[a]=x.get():p.Signal&&x instanceof p.Signal||p.Param&&x instanceof p.Param||x instanceof AudioParam?m[a]=x.value:x instanceof p?m[a]=x.get():this.isFunction(x)||this.isUndef(x)||(m[a]=x)}return c},p.prototype._collectDefaults=function(r){var c=[];if(this.isUndef(r.defaults)||(c=Object.keys(r.defaults)),!this.isUndef(r._super))for(var l=this._collectDefaults(r._super),a=0;a<l.length;a++)-1===c.indexOf(l[a])&&c.push(l[a]);return c},p.prototype.toString=function(){for(var r in p){var c=r[0].match(/^[A-Z]$/),l=p[r]===this.constructor;if(this.isFunction(p[r])&&c&&l)return r}return"Tone"},Object.defineProperty(p.prototype,"numberOfInputs",{get:function(){return this.input?this.isArray(this.input)?this.input.length:1:0}}),Object.defineProperty(p.prototype,"numberOfOutputs",{get:function(){return this.output?this.isArray(this.output)?this.output.length:1:0}}),p.prototype.dispose=function(){return this.isUndef(this.input)||(this.input instanceof AudioNode&&this.input.disconnect(),this.input=null),this.isUndef(this.output)||(this.output instanceof AudioNode&&this.output.disconnect(),this.output=null),this},p.prototype.connect=function(r,c,l){return Array.isArray(this.output)?(c=this.defaultArg(c,0),this.output[c].connect(r,0,l)):this.output.connect(r,c,l),this},p.prototype.disconnect=function(r,c,l){this.isArray(this.output)?this.isNumber(r)?this.output[r].disconnect():(c=this.defaultArg(c,0),this.output[c].disconnect(r,0,l)):this.output.disconnect.apply(this.output,arguments)},p.prototype.connectSeries=function(){if(1<arguments.length)for(var r=arguments[0],c=1;c<arguments.length;c++){var l=arguments[c];r.connect(l),r=l}return this},p.prototype.chain=function(){if(0<arguments.length)for(var r=this,c=0;c<arguments.length;c++){var l=arguments[c];r.connect(l),r=l}return this},p.prototype.fan=function(){if(0<arguments.length)for(var r=0;r<arguments.length;r++)this.connect(arguments[r]);return this},AudioNode.prototype.chain=p.prototype.chain,AudioNode.prototype.fan=p.prototype.fan,p.prototype.defaultArg=function(r,c){if(this.isObject(r)&&this.isObject(c)){var l={};for(var a in r)l[a]=this.defaultArg(c[a],r[a]);for(var h in c)l[h]=this.defaultArg(r[h],c[h]);return l}return this.isUndef(r)?c:r},p.prototype.optionsObject=function(r,c,l){var a={};if(1===r.length&&this.isObject(r[0]))a=r[0];else for(var h=0;h<c.length;h++)a[c[h]]=r[h];return this.isUndef(l)?a:this.defaultArg(a,l)},p.prototype.isUndef=function(r){return void 0===r},p.prototype.isFunction=function(r){return"function"==typeof r},p.prototype.isNumber=function(r){return"number"==typeof r},p.prototype.isObject=function(r){return"[object Object]"===Object.prototype.toString.call(r)&&r.constructor===Object},p.prototype.isBoolean=function(r){return"boolean"==typeof r},p.prototype.isArray=function(r){return Array.isArray(r)},p.prototype.isString=function(r){return"string"==typeof r},p.noOp=function(){},p.prototype._readOnly=function(r){if(Array.isArray(r))for(var c=0;c<r.length;c++)this._readOnly(r[c]);else Object.defineProperty(this,r,{writable:!1,enumerable:!0})},p.prototype._writable=function(r){if(Array.isArray(r))for(var c=0;c<r.length;c++)this._writable(r[c]);else Object.defineProperty(this,r,{writable:!0})},p.State={Started:"started",Stopped:"stopped",Paused:"paused"},p.prototype.equalPowerScale=function(r){var c=.5*Math.PI;return Math.sin(r*c)},p.prototype.dbToGain=function(r){return Math.pow(2,r/6)},p.prototype.gainToDb=function(r){return Math.log(r)/Math.LN10*20},p.prototype.intervalToFrequencyRatio=function(r){return Math.pow(2,r/12)},p.prototype.now=function(){return p.context.now()},p.now=function(){return p.context.now()},p.extend=function(r,c){function l(){}p.prototype.isUndef(c)&&(c=p),l.prototype=c.prototype,r.prototype=new l,(r.prototype.constructor=r)._super=c},Object.defineProperty(p,"context",{get:function(){return s},set:function(r){s=p.Context&&r instanceof p.Context?r:new p.Context(r),p.Context&&p.Context.emit("init",s)}}),Object.defineProperty(p.prototype,"context",{get:function(){return p.context}}),p.setContext=function(r){p.context=r},Object.defineProperty(p.prototype,"blockTime",{get:function(){return 128/this.context.sampleRate}}),Object.defineProperty(p.prototype,"sampleTime",{get:function(){return 1/this.context.sampleRate}}),Object.defineProperty(p,"supported",{get:function(){var r=window.hasOwnProperty("AudioContext")||window.hasOwnProperty("webkitAudioContext"),c=window.hasOwnProperty("Promise"),l=window.hasOwnProperty("Worker");return r&&c&&l}}),p.version="r10",window.TONE_SILENCE_VERSION_LOGGING||console.log("%c * Tone.js "+p.version+" * ","background: #000; color: #fff"),p}.call(A,f,A,P),void 0!==_&&(P.exports=_)},function(P,A,f){var _,p;_=[f(0),f(2),f(10)],void 0!==(p=function(s){"use strict";return s.Multiply=function(r){this.createInsOuts(2,0),this._mult=this.input[0]=this.output=new s.Gain,this._param=this.input[1]=this.output.gain,this._param.value=this.defaultArg(r,0)},s.extend(s.Multiply,s.Signal),s.Multiply.prototype.dispose=function(){return s.prototype.dispose.call(this),this._mult.dispose(),this._mult=null,this._param=null,this},s.Multiply}.apply(A,_))&&(P.exports=p)},function(P,A,f){var _,p;_=[f(0),f(6),f(9),f(18),f(10)],p=function(s){"use strict";return s.Signal=function(){var r=this.optionsObject(arguments,["value","units"],s.Signal.defaults);this.output=this._gain=this.context.createGain(),r.param=this._gain.gain,s.Param.call(this,r),this.input=this._param=this._gain.gain,this.context.getConstant(1).chain(this._gain)},s.extend(s.Signal,s.Param),s.Signal.defaults={value:0,units:s.Type.Default,convert:!0},s.Signal.prototype.connect=s.SignalBase.prototype.connect,s.Signal.prototype.dispose=function(){return s.Param.prototype.dispose.call(this),this._param=null,this._gain.disconnect(),this._gain=null,this},s.Signal}.apply(A,_),void 0!==p&&(P.exports=p)},function(P,A,f){"use strict";(function(_){f.d(A,"b",function(){return m}),f.d(A,"c",function(){return T});var p=f(22),s=f.n(p),r=f(0),c=f.n(r),l=f(12);f.n(l),_.TONE_SILENCE_VERSION_LOGGING=!0;var h=new window.AudioContext;function m(){return h}function T(S,k){var x=S;return S instanceof p5.Element?x=S.elt:S instanceof Array&&S[0]instanceof p5.Element&&(x=S.map(function(I){return I.elt})),s()(h,x,k)}c.a.setContext(h),A.a=h}).call(this,f(26))},function(P,A,f){var _,p;_=[f(0),f(2),f(10)],void 0!==(p=function(s){"use strict";return s.Add=function(r){this.createInsOuts(2,0),this._sum=this.input[0]=this.input[1]=this.output=new s.Gain,this._param=this.input[1]=new s.Signal(r),this._param.connect(this._sum)},s.extend(s.Add,s.Signal),s.Add.prototype.dispose=function(){return s.prototype.dispose.call(this),this._sum.dispose(),this._sum=null,this._param.dispose(),this._param=null,this},s.Add}.apply(A,_))&&(P.exports=p)},function(P,A){P.exports={recorderProcessor:"recorder-processor",soundFileProcessor:"sound-file-processor",amplitudeProcessor:"amplitude-processor"}},function(P,A,f){var _,p;_=[f(0),f(15)],void 0!==(p=function(s){"use strict";return s.WaveShaper=function(r,c){this._shaper=this.input=this.output=this.context.createWaveShaper(),this._curve=null,Array.isArray(r)?this.curve=r:isFinite(r)||this.isUndef(r)?this._curve=new Float32Array(this.defaultArg(r,1024)):this.isFunction(r)&&(this._curve=new Float32Array(this.defaultArg(c,1024)),this.setMap(r))},s.extend(s.WaveShaper,s.SignalBase),s.WaveShaper.prototype.setMap=function(r){for(var c=0,l=this._curve.length;c<l;c++)this._curve[c]=r(c/(l-1)*2-1,c);return this._shaper.curve=this._curve,this},Object.defineProperty(s.WaveShaper.prototype,"curve",{get:function(){return this._shaper.curve},set:function(r){this._curve=new Float32Array(r),this._shaper.curve=this._curve}}),Object.defineProperty(s.WaveShaper.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(r){if(-1===["none","2x","4x"].indexOf(r))throw new RangeError("Tone.WaveShaper: oversampling must be either 'none', '2x', or '4x'");this._shaper.oversample=r}}),s.WaveShaper.prototype.dispose=function(){return s.prototype.dispose.call(this),this._shaper.disconnect(),this._shaper=null,this._curve=null,this},s.WaveShaper}.apply(A,_))&&(P.exports=p)},function(P,A,f){var _,p;_=[f(0),f(2),f(19)],p=function(s){"use strict";return s.TimelineSignal=function(){var r=this.optionsObject(arguments,["value","units"],s.Signal.defaults);this._events=new s.Timeline(10),s.Signal.apply(this,r),r.param=this._param,s.Param.call(this,r),this._initial=this._fromUnits(this._param.value)},s.extend(s.TimelineSignal,s.Param),s.TimelineSignal.Type={Linear:"linear",Exponential:"exponential",Target:"target",Curve:"curve",Set:"set"},Object.defineProperty(s.TimelineSignal.prototype,"value",{get:function(){var r=this.now(),c=this.getValueAtTime(r);return this._toUnits(c)},set:function(r){var c=this._fromUnits(r);this._initial=c,this.cancelScheduledValues(),this._param.value=c}}),s.TimelineSignal.prototype.setValueAtTime=function(r,c){return r=this._fromUnits(r),c=this.toSeconds(c),this._events.add({type:s.TimelineSignal.Type.Set,value:r,time:c}),this._param.setValueAtTime(r,c),this},s.TimelineSignal.prototype.linearRampToValueAtTime=function(r,c){return r=this._fromUnits(r),c=this.toSeconds(c),this._events.add({type:s.TimelineSignal.Type.Linear,value:r,time:c}),this._param.linearRampToValueAtTime(r,c),this},s.TimelineSignal.prototype.exponentialRampToValueAtTime=function(r,c){c=this.toSeconds(c);var l=this._searchBefore(c);l&&0===l.value&&this.setValueAtTime(this._minOutput,l.time),r=this._fromUnits(r);var a=Math.max(r,this._minOutput);return this._events.add({type:s.TimelineSignal.Type.Exponential,value:a,time:c}),r<this._minOutput?(this._param.exponentialRampToValueAtTime(this._minOutput,c-this.sampleTime),this.setValueAtTime(0,c)):this._param.exponentialRampToValueAtTime(r,c),this},s.TimelineSignal.prototype.setTargetAtTime=function(r,c,l){return r=this._fromUnits(r),r=Math.max(this._minOutput,r),l=Math.max(this._minOutput,l),c=this.toSeconds(c),this._events.add({type:s.TimelineSignal.Type.Target,value:r,time:c,constant:l}),this._param.setTargetAtTime(r,c,l),this},s.TimelineSignal.prototype.setValueCurveAtTime=function(r,c,l,a){a=this.defaultArg(a,1);for(var h=new Array(r.length),m=0;m<h.length;m++)h[m]=this._fromUnits(r[m])*a;c=this.toSeconds(c),l=this.toSeconds(l),this._events.add({type:s.TimelineSignal.Type.Curve,value:h,time:c,duration:l}),this._param.setValueAtTime(h[0],c);for(var T=1;T<h.length;T++)this._param.linearRampToValueAtTime(h[T],c+T/(h.length-1)*l);return this},s.TimelineSignal.prototype.cancelScheduledValues=function(r){return r=this.toSeconds(r),this._events.cancel(r),this._param.cancelScheduledValues(r),this},s.TimelineSignal.prototype.setRampPoint=function(r){r=this.toSeconds(r);var c=this._toUnits(this.getValueAtTime(r)),l=this._searchBefore(r);if(l&&l.time===r)this.cancelScheduledValues(r+this.sampleTime);else if(l&&l.type===s.TimelineSignal.Type.Curve&&l.time+l.duration>r)this.cancelScheduledValues(r),this.linearRampToValueAtTime(c,r);else{var a=this._searchAfter(r);a&&(this.cancelScheduledValues(r),a.type===s.TimelineSignal.Type.Linear?this.linearRampToValueAtTime(c,r):a.type===s.TimelineSignal.Type.Exponential&&this.exponentialRampToValueAtTime(c,r)),this.setValueAtTime(c,r)}return this},s.TimelineSignal.prototype.linearRampToValueBetween=function(r,c,l){return this.setRampPoint(c),this.linearRampToValueAtTime(r,l),this},s.TimelineSignal.prototype.exponentialRampToValueBetween=function(r,c,l){return this.setRampPoint(c),this.exponentialRampToValueAtTime(r,l),this},s.TimelineSignal.prototype._searchBefore=function(r){return this._events.get(r)},s.TimelineSignal.prototype._searchAfter=function(r){return this._events.getAfter(r)},s.TimelineSignal.prototype.getValueAtTime=function(r){r=this.toSeconds(r);var c=this._searchAfter(r),l=this._searchBefore(r),a=this._initial;if(null===l)a=this._initial;else if(l.type===s.TimelineSignal.Type.Target){var m=this._events.getBefore(l.time);a=this._exponentialApproach(l.time,null===m?this._initial:m.value,l.value,l.constant,r)}else a=l.type===s.TimelineSignal.Type.Curve?this._curveInterpolate(l.time,l.value,l.duration,r):null===c?l.value:c.type===s.TimelineSignal.Type.Linear?this._linearInterpolate(l.time,l.value,c.time,c.value,r):c.type===s.TimelineSignal.Type.Exponential?this._exponentialInterpolate(l.time,l.value,c.time,c.value,r):l.value;return a},s.TimelineSignal.prototype.connect=s.SignalBase.prototype.connect,s.TimelineSignal.prototype._exponentialApproach=function(r,c,l,a,h){return l+(c-l)*Math.exp(-(h-r)/a)},s.TimelineSignal.prototype._linearInterpolate=function(r,c,l,a,h){return c+(h-r)/(l-r)*(a-c)},s.TimelineSignal.prototype._exponentialInterpolate=function(r,c,l,a,h){return(c=Math.max(this._minOutput,c))*Math.pow(a/c,(h-r)/(l-r))},s.TimelineSignal.prototype._curveInterpolate=function(r,c,l,a){var h=c.length;if(r+l<=a)return c[h-1];if(a<=r)return c[0];var m=(a-r)/l,T=Math.floor((h-1)*m),S=Math.ceil((h-1)*m),k=c[T];return S===T?k:this._linearInterpolate(T,k,S,c[S],m*(h-1))},s.TimelineSignal.prototype.dispose=function(){s.Signal.prototype.dispose.call(this),s.Param.prototype.dispose.call(this),this._events.dispose(),this._events=null},s.TimelineSignal}.apply(A,_),void 0!==p&&(P.exports=p)},function(P,A,f){var _,p;_=[f(0),f(4),f(1),f(2)],void 0!==(p=function(s){"use strict";return s.Scale=function(r,c){this._outputMin=this.defaultArg(r,0),this._outputMax=this.defaultArg(c,1),this._scale=this.input=new s.Multiply(1),this._add=this.output=new s.Add(0),this._scale.connect(this._add),this._setRange()},s.extend(s.Scale,s.SignalBase),Object.defineProperty(s.Scale.prototype,"min",{get:function(){return this._outputMin},set:function(r){this._outputMin=r,this._setRange()}}),Object.defineProperty(s.Scale.prototype,"max",{get:function(){return this._outputMax},set:function(r){this._outputMax=r,this._setRange()}}),s.Scale.prototype._setRange=function(){this._add.value=this._outputMin,this._scale.value=this._outputMax-this._outputMin},s.Scale.prototype.dispose=function(){return s.prototype.dispose.call(this),this._add.dispose(),this._add=null,this._scale.dispose(),this._scale=null,this},s.Scale}.apply(A,_))&&(P.exports=p)},function(P,A,f){var _,p;_=[f(0),f(16),f(30),f(31),f(12)],void 0!==(p=function(s){return s.Type={Default:"number",Time:"time",Frequency:"frequency",TransportTime:"transportTime",Ticks:"ticks",NormalRange:"normalRange",AudioRange:"audioRange",Decibels:"db",Interval:"interval",BPM:"bpm",Positive:"positive",Cents:"cents",Degrees:"degrees",MIDI:"midi",BarsBeatsSixteenths:"barsBeatsSixteenths",Samples:"samples",Hertz:"hertz",Note:"note",Milliseconds:"milliseconds",Seconds:"seconds",Notation:"notation"},s.prototype.toSeconds=function(r){return this.isNumber(r)?r:this.isUndef(r)?this.now():this.isString(r)?new s.Time(r).toSeconds():r instanceof s.TimeBase?r.toSeconds():void 0},s.prototype.toFrequency=function(r){return this.isNumber(r)?r:this.isString(r)||this.isUndef(r)?new s.Frequency(r).valueOf():r instanceof s.TimeBase?r.toFrequency():void 0},s.prototype.toTicks=function(r){return this.isNumber(r)||this.isString(r)?new s.TransportTime(r).toTicks():this.isUndef(r)?s.Transport.ticks:r instanceof s.TimeBase?r.toTicks():void 0},s}.apply(A,_))&&(P.exports=p)},function(P,A,f){var _,p;_=[f(0),f(18),f(9)],p=function(s){"use strict";return window.GainNode&&!AudioContext.prototype.createGain&&(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),s.Gain=function(){var r=this.optionsObject(arguments,["gain","units"],s.Gain.defaults);this.input=this.output=this._gainNode=this.context.createGain(),this.gain=new s.Param({param:this._gainNode.gain,units:r.units,value:r.gain,convert:r.convert}),this._readOnly("gain")},s.extend(s.Gain),s.Gain.defaults={gain:1,convert:!0},s.Gain.prototype.dispose=function(){s.Param.prototype.dispose.call(this),this._gainNode.disconnect(),this._gainNode=null,this._writable("gain"),this.gain.dispose(),this.gain=null},s.prototype.createInsOuts=function(r,c){1===r?this.input=new s.Gain:1<r&&(this.input=new Array(r)),1===c?this.output=new s.Gain:1<c&&(this.output=new Array(r))},s.Gain}.apply(A,_),void 0!==p&&(P.exports=p)},function(P,A,f){var _,p;_=[f(0),f(7),f(39),f(14),f(12)],p=function(s){"use strict";return s.Clock=function(){s.Emitter.call(this);var r=this.optionsObject(arguments,["callback","frequency"],s.Clock.defaults);this.callback=r.callback,this._nextTick=0,this._lastState=s.State.Stopped,this.frequency=new s.TimelineSignal(r.frequency,s.Type.Frequency),this._readOnly("frequency"),this.ticks=0,this._state=new s.TimelineState(s.State.Stopped),this._boundLoop=this._loop.bind(this),this.context.on("tick",this._boundLoop)},s.extend(s.Clock,s.Emitter),s.Clock.defaults={callback:s.noOp,frequency:1,lookAhead:"auto"},Object.defineProperty(s.Clock.prototype,"state",{get:function(){return this._state.getValueAtTime(this.now())}}),s.Clock.prototype.start=function(r,c){return r=this.toSeconds(r),this._state.getValueAtTime(r)!==s.State.Started&&this._state.add({state:s.State.Started,time:r,offset:c}),this},s.Clock.prototype.stop=function(r){return r=this.toSeconds(r),this._state.cancel(r),this._state.setStateAtTime(s.State.Stopped,r),this},s.Clock.prototype.pause=function(r){return r=this.toSeconds(r),this._state.getValueAtTime(r)===s.State.Started&&this._state.setStateAtTime(s.State.Paused,r),this},s.Clock.prototype._loop=function(){for(var r=this.now()+this.context.lookAhead+this.context.updateInterval+2*this.context.lag;r>this._nextTick&&this._state;){var c=this._state.getValueAtTime(this._nextTick);if(c!==this._lastState){this._lastState=c;var l=this._state.get(this._nextTick);c===s.State.Started?(this._nextTick=l.time,this.isUndef(l.offset)||(this.ticks=l.offset),this.emit("start",l.time,this.ticks)):c===s.State.Stopped?(this.ticks=0,this.emit("stop",l.time)):c===s.State.Paused&&this.emit("pause",l.time)}var a=this._nextTick;this.frequency&&(this._nextTick+=1/this.frequency.getValueAtTime(this._nextTick),c===s.State.Started&&(this.callback(a),this.ticks++))}},s.Clock.prototype.getStateAtTime=function(r){return r=this.toSeconds(r),this._state.getValueAtTime(r)},s.Clock.prototype.dispose=function(){s.Emitter.prototype.dispose.call(this),this.context.off("tick",this._boundLoop),this._writable("frequency"),this.frequency.dispose(),this.frequency=null,this._boundLoop=null,this._nextTick=1/0,this.callback=null,this._state.dispose(),this._state=null},s.Clock}.apply(A,_),void 0!==p&&(P.exports=p)},function(P,A,f){var _,p;_=[f(0),f(14)],p=function(s){function r(a,h,m){if(a.input)Array.isArray(a.input)?(s.prototype.isUndef(m)&&(m=0),this.connect(a.input[m])):this.connect(a.input,h,m);else try{a instanceof AudioNode?c.call(this,a,h,m):c.call(this,a,h)}catch(T){throw new Error("error connecting to node: "+a+"\n"+T)}}var c,l;return!window.hasOwnProperty("AudioContext")&&window.hasOwnProperty("webkitAudioContext")&&(window.AudioContext=window.webkitAudioContext),s.Context=function(a){for(var h in s.Emitter.call(this),a=a||new window.AudioContext,this._context=a,this._context)this._defineProperty(this._context,h);this._latencyHint="interactive",this._lookAhead=.1,this._updateInterval=this._lookAhead/3,this._computedUpdateInterval=0,this._worker=this._createWorker(),this._constants={}},s.extend(s.Context,s.Emitter),s.Emitter.mixin(s.Context),s.Context.prototype._defineProperty=function(a,h){this.isUndef(this[h])&&Object.defineProperty(this,h,{get:function(){return"function"==typeof a[h]?a[h].bind(a):a[h]},set:function(m){a[h]=m}})},s.Context.prototype.now=function(){return this._context.currentTime},s.Context.prototype._createWorker=function(){window.URL=window.URL||window.webkitURL;var a=new Blob(["var timeoutTime = "+(1e3*this._updateInterval).toFixed(1)+";self.onmessage = function(msg){\ttimeoutTime = parseInt(msg.data);};function tick(){\tsetTimeout(tick, timeoutTime);\tself.postMessage('tick');}tick();"]),h=URL.createObjectURL(a),m=new Worker(h);return m.addEventListener("message",function(){this.emit("tick")}.bind(this)),m.addEventListener("message",function(){var T=this.now();this.isNumber(this._lastUpdate)&&(this._computedUpdateInterval=Math.max(T-this._lastUpdate,.97*this._computedUpdateInterval)),this._lastUpdate=T}.bind(this)),m},s.Context.prototype.getConstant=function(a){if(this._constants[a])return this._constants[a];for(var h=this._context.createBuffer(1,128,this._context.sampleRate),m=h.getChannelData(0),T=0;T<m.length;T++)m[T]=a;var S=this._context.createBufferSource();return S.channelCount=1,S.channelCountMode="explicit",S.buffer=h,S.loop=!0,S.start(0),this._constants[a]=S},Object.defineProperty(s.Context.prototype,"lag",{get:function(){return Math.max(this._computedUpdateInterval-this._updateInterval,0)}}),Object.defineProperty(s.Context.prototype,"lookAhead",{get:function(){return this._lookAhead},set:function(a){this._lookAhead=a}}),Object.defineProperty(s.Context.prototype,"updateInterval",{get:function(){return this._updateInterval},set:function(a){this._updateInterval=Math.max(a,s.prototype.blockTime),this._worker.postMessage(Math.max(1e3*a,1))}}),Object.defineProperty(s.Context.prototype,"latencyHint",{get:function(){return this._latencyHint},set:function(a){var h=a;if(this._latencyHint=a,this.isString(a))switch(a){case"interactive":h=.1,this._context.latencyHint=a;break;case"playback":h=.8,this._context.latencyHint=a;break;case"balanced":h=.25,this._context.latencyHint=a;break;case"fastest":h=.01}this.lookAhead=h,this.updateInterval=h/3}}),s.supported?(c=AudioNode.prototype.connect,l=AudioNode.prototype.disconnect,AudioNode.prototype.connect!==r&&(AudioNode.prototype.connect=r,AudioNode.prototype.disconnect=function(a,h,m){if(a&&a.input&&Array.isArray(a.input))s.prototype.isUndef(m)&&(m=0),this.disconnect(a.input[m],h,m);else if(a&&a.input)this.disconnect(a.input,h,m);else try{l.apply(this,arguments)}catch(T){throw new Error("error disconnecting node: "+a+"\n"+T)}}),s.context=new s.Context):console.warn("This browser does not support Tone.js"),s.Context}.apply(A,_),void 0!==p&&(P.exports=p)},function(P,A,f){var _,p;_=[f(0),f(4),f(20),f(2),f(10)],void 0!==(p=function(s){"use strict";return s.Subtract=function(r){this.createInsOuts(2,0),this._sum=this.input[0]=this.output=new s.Gain,this._neg=new s.Negate,this._param=this.input[1]=new s.Signal(r),this._param.chain(this._neg,this._sum)},s.extend(s.Subtract,s.Signal),s.Subtract.prototype.dispose=function(){return s.prototype.dispose.call(this),this._neg.dispose(),this._neg=null,this._sum.disconnect(),this._sum=null,this._param.dispose(),this._param=null,this},s.Subtract}.apply(A,_))&&(P.exports=p)},function(P,A,f){var _,p;_=[f(0)],p=function(s){"use strict";return s.Emitter=function(){this._events={}},s.extend(s.Emitter),s.Emitter.prototype.on=function(r,c){for(var l=r.split(/\W+/),a=0;a<l.length;a++){var h=l[a];this._events.hasOwnProperty(h)||(this._events[h]=[]),this._events[h].push(c)}return this},s.Emitter.prototype.off=function(r,c){for(var l=r.split(/\W+/),a=0;a<l.length;a++)if(this._events.hasOwnProperty(r=l[a]))if(s.prototype.isUndef(c))this._events[r]=[];else for(var h=this._events[r],m=0;m<h.length;m++)h[m]===c&&h.splice(m,1);return this},s.Emitter.prototype.emit=function(r){if(this._events){var c=Array.apply(null,arguments).slice(1);if(this._events.hasOwnProperty(r))for(var l=this._events[r],a=0,h=l.length;a<h;a++)l[a].apply(this,c)}return this},s.Emitter.mixin=function(r){var c=["on","off","emit"];r._events={};for(var l=0;l<c.length;l++){var a=c[l];r[a]=s.Emitter.prototype[a]}},s.Emitter.prototype.dispose=function(){return s.prototype.dispose.call(this),this._events=null,this},s.Emitter}.apply(A,_),void 0!==p&&(P.exports=p)},function(P,A,f){var _,p;_=[f(0)],void 0!==(p=function(s){"use strict";return s.SignalBase=function(){},s.extend(s.SignalBase),s.SignalBase.prototype.connect=function(r,c,l){return s.Signal&&s.Signal===r.constructor||s.Param&&s.Param===r.constructor||s.TimelineSignal&&s.TimelineSignal===r.constructor?(r._param.cancelScheduledValues(0),r._param.value=0,r.overridden=!0):r instanceof AudioParam&&(r.cancelScheduledValues(0),r.value=0),s.prototype.connect.call(this,r,c,l),this},s.SignalBase}.apply(A,_))&&(P.exports=p)},function(P,A,f){var _,p;_=[f(0),f(17)],void 0!==(p=function(s){return s.Time=function(r,c){if(!(this instanceof s.Time))return new s.Time(r,c);this._plusNow=!1,s.TimeBase.call(this,r,c)},s.extend(s.Time,s.TimeBase),s.Time.prototype._unaryExpressions=Object.create(s.TimeBase.prototype._unaryExpressions),s.Time.prototype._unaryExpressions.quantize={regexp:/^@/,method:function(r){return s.Transport.nextSubdivision(r())}},s.Time.prototype._unaryExpressions.now={regexp:/^\+/,method:function(r){return this._plusNow=!0,r()}},s.Time.prototype.quantize=function(r,c){return c=this.defaultArg(c,1),this._expr=function(l,a,h){return l=l(),a=a.toSeconds(),l+(Math.round(l/a)*a-l)*h}.bind(this,this._expr,new this.constructor(r),c),this},s.Time.prototype.addNow=function(){return this._plusNow=!0,this},s.Time.prototype._defaultExpr=function(){return this._plusNow=!0,this._noOp},s.Time.prototype.copy=function(r){return s.TimeBase.prototype.copy.call(this,r),this._plusNow=r._plusNow,this},s.Time.prototype.toNotation=function(){var r=this.toSeconds(),c=this._toNotationHelper(r,["1m","2n","4n","8n","16n","32n","64n","128n"]),l=this._toNotationHelper(r,["1m","2n","2t","4n","4t","8n","8t","16n","16t","32n","32t","64n","64t","128n"]);return l.split("+").length<c.split("+").length?l:c},s.Time.prototype._toNotationHelper=function(r,c){for(var l=this._notationToUnits(c[c.length-1]),a="",h=0;h<c.length;h++){var m=this._notationToUnits(c[h]),T=r/m;if(1-T%1<1e-6&&(T+=1e-6),0<(T=Math.floor(T))){if(a+=1===T?c[h]:T.toString()+"*"+c[h],(r-=T*m)<l)break;a+=" + "}}return""===a&&(a="0"),a},s.Time.prototype._notationToUnits=function(r){for(var c=this._primaryExpressions,l=[c.n,c.t,c.m],a=0;a<l.length;a++){var h=l[a],m=r.match(h.regexp);if(m)return h.method.call(this,m[1])}},s.Time.prototype.toBarsBeatsSixteenths=function(){var r=this._beatsToUnits(1),c=this.toSeconds()/r,l=Math.floor(c/this._timeSignature()),a=c%1*4;return c=Math.floor(c)%this._timeSignature(),3<(a=a.toString()).length&&(a=parseFloat(a).toFixed(3)),[l,c,a].join(":")},s.Time.prototype.toTicks=function(){var r=this._beatsToUnits(1),c=this.valueOf()/r;return Math.floor(c*s.Transport.PPQ)},s.Time.prototype.toSamples=function(){return this.toSeconds()*this.context.sampleRate},s.Time.prototype.toFrequency=function(){return 1/this.toSeconds()},s.Time.prototype.toSeconds=function(){return this.valueOf()},s.Time.prototype.toMilliseconds=function(){return 1e3*this.toSeconds()},s.Time.prototype.valueOf=function(){return this._expr()+(this._plusNow?this.now():0)},s.Time}.apply(A,_))&&(P.exports=p)},function(P,A,f){var _,p;_=[f(0)],void 0!==(p=function(s){return s.TimeBase=function(r,c){if(!(this instanceof s.TimeBase))return new s.TimeBase(r,c);this._expr=this._noOp,r instanceof s.TimeBase?this.copy(r):!this.isUndef(c)||this.isNumber(r)?(c=this.defaultArg(c,this._defaultUnits),this._expr=this._primaryExpressions[c].method.bind(this,r)):this.isString(r)?this.set(r):this.isUndef(r)&&(this._expr=this._defaultExpr())},s.extend(s.TimeBase),s.TimeBase.prototype.set=function(r){return this._expr=this._parseExprString(r),this},s.TimeBase.prototype.clone=function(){var r=new this.constructor;return r.copy(this),r},s.TimeBase.prototype.copy=function(r){var c=r._expr();return this.set(c)},s.TimeBase.prototype._primaryExpressions={n:{regexp:/^(\d+)n/i,method:function(r){return 1===(r=parseInt(r))?this._beatsToUnits(this._timeSignature()):this._beatsToUnits(4/r)}},t:{regexp:/^(\d+)t/i,method:function(r){return r=parseInt(r),this._beatsToUnits(8/(3*parseInt(r)))}},m:{regexp:/^(\d+)m/i,method:function(r){return this._beatsToUnits(parseInt(r)*this._timeSignature())}},i:{regexp:/^(\d+)i/i,method:function(r){return this._ticksToUnits(parseInt(r))}},hz:{regexp:/^(\d+(?:\.\d+)?)hz/i,method:function(r){return this._frequencyToUnits(parseFloat(r))}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method:function(r,c,l){var a=0;return r&&"0"!==r&&(a+=this._beatsToUnits(this._timeSignature()*parseFloat(r))),c&&"0"!==c&&(a+=this._beatsToUnits(parseFloat(c))),l&&"0"!==l&&(a+=this._beatsToUnits(parseFloat(l)/4)),a}},s:{regexp:/^(\d+(?:\.\d+)?s)/,method:function(r){return this._secondsToUnits(parseFloat(r))}},samples:{regexp:/^(\d+)samples/,method:function(r){return parseInt(r)/this.context.sampleRate}},default:{regexp:/^(\d+(?:\.\d+)?)/,method:function(r){return this._primaryExpressions[this._defaultUnits].method.call(this,r)}}},s.TimeBase.prototype._binaryExpressions={"+":{regexp:/^\+/,precedence:2,method:function(r,c){return r()+c()}},"-":{regexp:/^\-/,precedence:2,method:function(r,c){return r()-c()}},"*":{regexp:/^\*/,precedence:1,method:function(r,c){return r()*c()}},"/":{regexp:/^\//,precedence:1,method:function(r,c){return r()/c()}}},s.TimeBase.prototype._unaryExpressions={neg:{regexp:/^\-/,method:function(r){return-r()}}},s.TimeBase.prototype._syntaxGlue={"(":{regexp:/^\(/},")":{regexp:/^\)/}},s.TimeBase.prototype._tokenize=function(r){for(var c=-1,l=[];0<r.length;){var a=h(r=r.trim(),this);l.push(a),r=r.substr(a.value.length)}function h(m,T){for(var S=["_binaryExpressions","_unaryExpressions","_primaryExpressions","_syntaxGlue"],k=0;k<S.length;k++){var x=T[S[k]];for(var I in x){var R=x[I],N=m.match(R.regexp);if(null!==N)return{method:R.method,precedence:R.precedence,regexp:R.regexp,value:N[0]}}}throw new SyntaxError("Tone.TimeBase: Unexpected token "+m)}return{next:function(){return l[++c]},peek:function(){return l[c+1]}}},s.TimeBase.prototype._matchGroup=function(r,c,l){if(!this.isUndef(r))for(var a in c){var h=c[a];if(h.regexp.test(r.value)&&(this.isUndef(l)||h.precedence===l))return h}return!1},s.TimeBase.prototype._parseBinary=function(r,c){var l;this.isUndef(c)&&(c=2),l=c<0?this._parseUnary(r):this._parseBinary(r,c-1);for(var a=r.peek();a&&this._matchGroup(a,this._binaryExpressions,c);)l=(a=r.next()).method.bind(this,l,this._parseBinary(r,c-1)),a=r.peek();return l},s.TimeBase.prototype._parseUnary=function(r){var c,l;c=r.peek();var a=this._matchGroup(c,this._unaryExpressions);return a?(c=r.next(),l=this._parseUnary(r),a.method.bind(this,l)):this._parsePrimary(r)},s.TimeBase.prototype._parsePrimary=function(r){var c,l;if(c=r.peek(),this.isUndef(c))throw new SyntaxError("Tone.TimeBase: Unexpected end of expression");if(this._matchGroup(c,this._primaryExpressions)){var a=(c=r.next()).value.match(c.regexp);return c.method.bind(this,a[1],a[2],a[3])}if(c&&"("===c.value){if(r.next(),l=this._parseBinary(r),!(c=r.next())||")"!==c.value)throw new SyntaxError("Expected )");return l}throw new SyntaxError("Tone.TimeBase: Cannot process token "+c.value)},s.TimeBase.prototype._parseExprString=function(r){this.isString(r)||(r=r.toString());var c=this._tokenize(r);return this._parseBinary(c)},s.TimeBase.prototype._noOp=function(){return 0},s.TimeBase.prototype._defaultExpr=function(){return this._noOp},s.TimeBase.prototype._defaultUnits="s",s.TimeBase.prototype._frequencyToUnits=function(r){return 1/r},s.TimeBase.prototype._beatsToUnits=function(r){return 60/s.Transport.bpm.value*r},s.TimeBase.prototype._secondsToUnits=function(r){return r},s.TimeBase.prototype._ticksToUnits=function(r){return r*(this._beatsToUnits(1)/s.Transport.PPQ)},s.TimeBase.prototype._timeSignature=function(){return s.Transport.timeSignature},s.TimeBase.prototype._pushExpr=function(r,c,l){return r instanceof s.TimeBase||(r=new this.constructor(r,l)),this._expr=this._binaryExpressions[c].method.bind(this,this._expr,r._expr),this},s.TimeBase.prototype.add=function(r,c){return this._pushExpr(r,"+",c)},s.TimeBase.prototype.sub=function(r,c){return this._pushExpr(r,"-",c)},s.TimeBase.prototype.mult=function(r,c){return this._pushExpr(r,"*",c)},s.TimeBase.prototype.div=function(r,c){return this._pushExpr(r,"/",c)},s.TimeBase.prototype.valueOf=function(){return this._expr()},s.TimeBase.prototype.dispose=function(){this._expr=null},s.TimeBase}.apply(A,_))&&(P.exports=p)},function(P,A,f){var _,p;_=[f(0),f(9)],p=function(s){"use strict";return s.Param=function(){var r=this.optionsObject(arguments,["param","units","convert"],s.Param.defaults);this._param=this.input=r.param,this.units=r.units,this.convert=r.convert,this.overridden=!1,this._lfo=null,this.isObject(r.lfo)?this.value=r.lfo:this.isUndef(r.value)||(this.value=r.value)},s.extend(s.Param),s.Param.defaults={units:s.Type.Default,convert:!0,param:void 0},Object.defineProperty(s.Param.prototype,"value",{get:function(){return this._toUnits(this._param.value)},set:function(r){if(this.isObject(r)){if(this.isUndef(s.LFO))throw new Error("Include 'Tone.LFO' to use an LFO as a Param value.");this._lfo&&this._lfo.dispose(),this._lfo=new s.LFO(r).start(),this._lfo.connect(this.input)}else{var c=this._fromUnits(r);this._param.cancelScheduledValues(0),this._param.value=c}}}),s.Param.prototype._fromUnits=function(r){if(!this.convert&&!this.isUndef(this.convert))return r;switch(this.units){case s.Type.Time:return this.toSeconds(r);case s.Type.Frequency:return this.toFrequency(r);case s.Type.Decibels:return this.dbToGain(r);case s.Type.NormalRange:return Math.min(Math.max(r,0),1);case s.Type.AudioRange:return Math.min(Math.max(r,-1),1);case s.Type.Positive:return Math.max(r,0);default:return r}},s.Param.prototype._toUnits=function(r){return(this.convert||this.isUndef(this.convert))&&this.units===s.Type.Decibels?this.gainToDb(r):r},s.Param.prototype._minOutput=1e-5,s.Param.prototype.setValueAtTime=function(r,c){return r=this._fromUnits(r),(c=this.toSeconds(c))<=this.now()+this.blockTime?this._param.value=r:this._param.setValueAtTime(r,c),this},s.Param.prototype.setRampPoint=function(r){r=this.defaultArg(r,this.now());var c=this._param.value;return 0===c&&(c=this._minOutput),this._param.setValueAtTime(c,r),this},s.Param.prototype.linearRampToValueAtTime=function(r,c){return r=this._fromUnits(r),this._param.linearRampToValueAtTime(r,this.toSeconds(c)),this},s.Param.prototype.exponentialRampToValueAtTime=function(r,c){return r=this._fromUnits(r),r=Math.max(this._minOutput,r),this._param.exponentialRampToValueAtTime(r,this.toSeconds(c)),this},s.Param.prototype.exponentialRampToValue=function(r,c,l){return l=this.toSeconds(l),this.setRampPoint(l),this.exponentialRampToValueAtTime(r,l+this.toSeconds(c)),this},s.Param.prototype.linearRampToValue=function(r,c,l){return l=this.toSeconds(l),this.setRampPoint(l),this.linearRampToValueAtTime(r,l+this.toSeconds(c)),this},s.Param.prototype.setTargetAtTime=function(r,c,l){return r=this._fromUnits(r),r=Math.max(this._minOutput,r),l=Math.max(this._minOutput,l),this._param.setTargetAtTime(r,this.toSeconds(c),l),this},s.Param.prototype.setValueCurveAtTime=function(r,c,l){for(var a=0;a<r.length;a++)r[a]=this._fromUnits(r[a]);return this._param.setValueCurveAtTime(r,this.toSeconds(c),this.toSeconds(l)),this},s.Param.prototype.cancelScheduledValues=function(r){return this._param.cancelScheduledValues(this.toSeconds(r)),this},s.Param.prototype.rampTo=function(r,c,l){return c=this.defaultArg(c,0),this.units===s.Type.Frequency||this.units===s.Type.BPM||this.units===s.Type.Decibels?this.exponentialRampToValue(r,c,l):this.linearRampToValue(r,c,l),this},Object.defineProperty(s.Param.prototype,"lfo",{get:function(){return this._lfo}}),s.Param.prototype.dispose=function(){return s.prototype.dispose.call(this),this._param=null,this._lfo&&(this._lfo.dispose(),this._lfo=null),this},s.Param}.apply(A,_),void 0!==p&&(P.exports=p)},function(P,A,f){var _,p;_=[f(0),f(9)],p=function(s){"use strict";return s.Timeline=function(){var r=this.optionsObject(arguments,["memory"],s.Timeline.defaults);this._timeline=[],this._toRemove=[],this._iterating=!1,this.memory=r.memory},s.extend(s.Timeline),s.Timeline.defaults={memory:1/0},Object.defineProperty(s.Timeline.prototype,"length",{get:function(){return this._timeline.length}}),s.Timeline.prototype.add=function(r){if(this.isUndef(r.time))throw new Error("Tone.Timeline: events must have a time attribute");if(this._timeline.length){var c=this._search(r.time);this._timeline.splice(c+1,0,r)}else this._timeline.push(r);return this.length>this.memory&&this._timeline.splice(0,this.length-this.memory),this},s.Timeline.prototype.remove=function(r){if(this._iterating)this._toRemove.push(r);else{var c=this._timeline.indexOf(r);-1!==c&&this._timeline.splice(c,1)}return this},s.Timeline.prototype.get=function(r){var c=this._search(r);return-1!==c?this._timeline[c]:null},s.Timeline.prototype.peek=function(){return this._timeline[0]},s.Timeline.prototype.shift=function(){return this._timeline.shift()},s.Timeline.prototype.getAfter=function(r){var c=this._search(r);return c+1<this._timeline.length?this._timeline[c+1]:null},s.Timeline.prototype.getBefore=function(r){var c=this._timeline.length;if(0<c&&this._timeline[c-1].time<r)return this._timeline[c-1];var l=this._search(r);return 0<=l-1?this._timeline[l-1]:null},s.Timeline.prototype.cancel=function(r){if(1<this._timeline.length){var c=this._search(r);if(0<=c)if(this._timeline[c].time===r){for(var l=c;0<=l&&this._timeline[l].time===r;l--)c=l;this._timeline=this._timeline.slice(0,c)}else this._timeline=this._timeline.slice(0,c+1);else this._timeline=[]}else 1===this._timeline.length&&this._timeline[0].time>=r&&(this._timeline=[]);return this},s.Timeline.prototype.cancelBefore=function(r){if(this._timeline.length){var c=this._search(r);0<=c&&(this._timeline=this._timeline.slice(c+1))}return this},s.Timeline.prototype._search=function(r){var c=0,l=this._timeline.length,a=l;if(0<l&&this._timeline[l-1].time<=r)return l-1;for(;c<a;){var h=Math.floor(c+(a-c)/2),m=this._timeline[h],T=this._timeline[h+1];if(m.time===r){for(var S=h;S<this._timeline.length;S++)this._timeline[S].time===r&&(h=S);return h}if(m.time<r&&T.time>r)return h;m.time>r?a=h:m.time<r&&(c=h+1)}return-1},s.Timeline.prototype._iterate=function(r,c,l){this._iterating=!0,c=this.defaultArg(c,0),l=this.defaultArg(l,this._timeline.length-1);for(var a=c;a<=l;a++)r(this._timeline[a]);if(this._iterating=!1,0<this._toRemove.length){for(var h=0;h<this._toRemove.length;h++){var m=this._timeline.indexOf(this._toRemove[h]);-1!==m&&this._timeline.splice(m,1)}this._toRemove=[]}},s.Timeline.prototype.forEach=function(r){return this._iterate(r),this},s.Timeline.prototype.forEachBefore=function(r,c){var l=this._search(r);return-1!==l&&this._iterate(c,0,l),this},s.Timeline.prototype.forEachAfter=function(r,c){var l=this._search(r);return this._iterate(c,l+1),this},s.Timeline.prototype.forEachFrom=function(r,c){for(var l=this._search(r);0<=l&&this._timeline[l].time>=r;)l--;return this._iterate(c,l+1),this},s.Timeline.prototype.forEachAtTime=function(r,c){var l=this._search(r);return-1!==l&&this._iterate(function(a){a.time===r&&c(a)},0,l),this},s.Timeline.prototype.dispose=function(){s.prototype.dispose.call(this),this._timeline=null,this._toRemove=null},s.Timeline}.apply(A,_),void 0!==p&&(P.exports=p)},function(P,A,f){var _,p;_=[f(0),f(1),f(2)],void 0!==(p=function(s){"use strict";return s.Negate=function(){this._multiply=this.input=this.output=new s.Multiply(-1)},s.extend(s.Negate,s.SignalBase),s.Negate.prototype.dispose=function(){return s.prototype.dispose.call(this),this._multiply.dispose(),this._multiply=null,this},s.Negate}.apply(A,_))&&(P.exports=p)},function(P,A,f){var _,p;_=[f(0),f(2),f(1),f(6)],void 0!==(p=function(s){"use strict";return s.GreaterThanZero=function(){this._thresh=this.output=new s.WaveShaper(function(r){return r<=0?0:1},127),this._scale=this.input=new s.Multiply(1e4),this._scale.connect(this._thresh)},s.extend(s.GreaterThanZero,s.SignalBase),s.GreaterThanZero.prototype.dispose=function(){return s.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._thresh.dispose(),this._thresh=null,this},s.GreaterThanZero}.apply(A,_))&&(P.exports=p)},function(P,A,f){var _,s;void 0!==(s="function"==typeof(_=function(){var r=function(l,a){this._dragged=!1,this._element=l,this._bindedMove=this._moved.bind(this),this._bindedEnd=this._ended.bind(this,a),l.addEventListener("touchstart",this._bindedEnd),l.addEventListener("touchmove",this._bindedMove),l.addEventListener("touchend",this._bindedEnd),l.addEventListener("mouseup",this._bindedEnd)};function c(l){return"running"===l.state}return r.prototype._moved=function(l){this._dragged=!0},r.prototype._ended=function(l){var a,h,m;this._dragged||(h=(a=l).createBuffer(1,1,a.sampleRate),(m=a.createBufferSource()).buffer=h,m.connect(a.destination),m.start(0),a.resume&&a.resume()),this._dragged=!1},r.prototype.dispose=function(){this._element.removeEventListener("touchstart",this._bindedEnd),this._element.removeEventListener("touchmove",this._bindedMove),this._element.removeEventListener("touchend",this._bindedEnd),this._element.removeEventListener("mouseup",this._bindedEnd),this._bindedMove=null,this._bindedEnd=null,this._element=null},function(l,a,h){var m=new Promise(function(S){var k,x;x=S,c(k=l)?x():function I(){c(k)?x():(requestAnimationFrame(I),k.resume&&k.resume())}()}),T=[];return function S(k,x,I){if(Array.isArray(k)||NodeList&&k instanceof NodeList)for(var R=0;R<k.length;R++)S(k[R],x,I);else if("string"==typeof k)S(document.querySelectorAll(k),x,I);else if(k.jquery&&"function"==typeof k.toArray)S(k.toArray(),x,I);else if(Element&&k instanceof Element){var V=new r(k,I);x.push(V)}}(a=a||document.body,T,l),m.then(function(){for(var S=0;S<T.length;S++)T[S].dispose();T=null,h&&h()}),m}})?_.apply(A,[]):_)&&(P.exports=s)},function(P,A,f){var _,p;_=[f(0),f(2),f(32),f(38),f(10)],void 0!==(p=function(s){"use strict";return s.CrossFade=function(r){this.createInsOuts(2,1),this.a=this.input[0]=new s.Gain,this.b=this.input[1]=new s.Gain,this.fade=new s.Signal(this.defaultArg(r,.5),s.Type.NormalRange),this._equalPowerA=new s.EqualPowerGain,this._equalPowerB=new s.EqualPowerGain,this._invert=new s.Expr("1 - $0"),this.a.connect(this.output),this.b.connect(this.output),this.fade.chain(this._equalPowerB,this.b.gain),this.fade.chain(this._invert,this._equalPowerA,this.a.gain),this._readOnly("fade")},s.extend(s.CrossFade),s.CrossFade.prototype.dispose=function(){return s.prototype.dispose.call(this),this._writable("fade"),this._equalPowerA.dispose(),this._equalPowerA=null,this._equalPowerB.dispose(),this._equalPowerB=null,this.fade.dispose(),this.fade=null,this._invert.dispose(),this._invert=null,this.a.dispose(),this.a=null,this.b.dispose(),this.b=null,this},s.CrossFade}.apply(A,_))&&(P.exports=p)},function(P,A){!function(){var f,_=[];function p(l){var a=this,h={},m=-1;this.parameters.forEach(function(k,x){var I=_[++m]||(_[m]=new Float32Array(a.bufferSize));I.fill(k.value),h[x]=I}),this.processor.realm.exec("self.sampleRate=sampleRate="+this.context.sampleRate+";self.currentTime=currentTime="+this.context.currentTime);var T=s(l.inputBuffer),S=s(l.outputBuffer);this.instance.process([T],[S],h)}function s(l){for(var a=[],h=0;h<l.numberOfChannels;h++)a[h]=l.getChannelData(h);return a}function r(l){return l.$$processors||(l.$$processors={})}function c(l){this.$$context=l}"function"!=typeof AudioWorkletNode&&(self.AudioWorkletNode=function(l,a,h){var m=r(l)[a],T=l.createScriptProcessor(void 0,2,h&&h.outputChannelCount?h.outputChannelCount[0]:2);if(T.parameters=new Map,m.properties)for(var S=0;S<m.properties.length;S++){var k=m.properties[S],x=l.createGain().gain;x.value=k.defaultValue,T.parameters.set(k.name,x)}var I=new MessageChannel;f=I.port2;var R=new m.Processor(h||{});return f=null,T.port=I.port1,T.processor=m,T.instance=R,T.onaudioprocess=p,T},Object.defineProperty((self.AudioContext||self.webkitAudioContext).prototype,"audioWorklet",{get:function(){return this.$$audioWorklet||(this.$$audioWorklet=new self.AudioWorklet(this))}}),self.AudioWorklet=(c.prototype.addModule=function(l,a){var h=this;return fetch(l).then(function(m){if(!m.ok)throw Error(m.status);return m.text()}).then(function(m){var T={sampleRate:0,currentTime:0,AudioWorkletProcessor:function(){this.port=f},registerProcessor:function(k,x){r(h.$$context)[k]={realm:S,context:T,Processor:x,properties:x.parameterDescriptors||[]}}},S=new function(k,x){var I=document.createElement("iframe");I.style.cssText="position:absolute;left:0;top:-999px;width:1px;height:1px;",x.appendChild(I);var R=I.contentWindow,V=R.document,N="var window,$hook";for(var $ in R)$ in k||"eval"===$||(N+=",",N+=$);for(var j in k)N+=",",N+=j,N+="=self.",N+=j;var b=V.createElement("script");b.appendChild(V.createTextNode('function $hook(self,console) {"use strict";\n        '+N+";return function() {return eval(arguments[0])}}")),V.body.appendChild(b),this.exec=R.$hook(k,console)}(T.self=T,document.documentElement);return S.exec((a&&a.transpile||String)(m)),null})},c))}()},function(P,A){(function(){function l(a){a&&(a.setTargetAtTime||(a.setTargetAtTime=a.setTargetValueAtTime))}window.hasOwnProperty("webkitAudioContext")&&!window.hasOwnProperty("AudioContext")&&(window.AudioContext=window.webkitAudioContext,"function"!=typeof AudioContext.prototype.createGain&&(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),"function"!=typeof AudioContext.prototype.createDelay&&(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode),"function"!=typeof AudioContext.prototype.createScriptProcessor&&(AudioContext.prototype.createScriptProcessor=AudioContext.prototype.createJavaScriptNode),"function"!=typeof AudioContext.prototype.createPeriodicWave&&(AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable),AudioContext.prototype.internal_createGain=AudioContext.prototype.createGain,AudioContext.prototype.createGain=function(){var a=this.internal_createGain();return l(a.gain),a},AudioContext.prototype.internal_createDelay=AudioContext.prototype.createDelay,AudioContext.prototype.createDelay=function(a){var h=a?this.internal_createDelay(a):this.internal_createDelay();return l(h.delayTime),h},AudioContext.prototype.internal_createBufferSource=AudioContext.prototype.createBufferSource,AudioContext.prototype.createBufferSource=function(){var a=this.internal_createBufferSource();return a.start?(a.internal_start=a.start,a.start=function(h,m,T){typeof T<"u"?a.internal_start(h||0,m,T):a.internal_start(h||0,m||0)}):a.start=function(h,m,T){m||T?this.noteGrainOn(h||0,m,T):this.noteOn(h||0)},a.stop?(a.internal_stop=a.stop,a.stop=function(h){a.internal_stop(h||0)}):a.stop=function(h){this.noteOff(h||0)},l(a.playbackRate),a},AudioContext.prototype.internal_createDynamicsCompressor=AudioContext.prototype.createDynamicsCompressor,AudioContext.prototype.createDynamicsCompressor=function(){var a=this.internal_createDynamicsCompressor();return l(a.threshold),l(a.knee),l(a.ratio),l(a.reduction),l(a.attack),l(a.release),a},AudioContext.prototype.internal_createBiquadFilter=AudioContext.prototype.createBiquadFilter,AudioContext.prototype.createBiquadFilter=function(){var a=this.internal_createBiquadFilter();return l(a.frequency),l(a.detune),l(a.Q),l(a.gain),a},"function"!=typeof AudioContext.prototype.createOscillator&&(AudioContext.prototype.internal_createOscillator=AudioContext.prototype.createOscillator,AudioContext.prototype.createOscillator=function(){var a=this.internal_createOscillator();return a.start?(a.internal_start=a.start,a.start=function(h){a.internal_start(h||0)}):a.start=function(h){this.noteOn(h||0)},a.stop?(a.internal_stop=a.stop,a.stop=function(h){a.internal_stop(h||0)}):a.stop=function(h){this.noteOff(h||0)},a.setPeriodicWave||(a.setPeriodicWave=a.setWaveTable),l(a.frequency),l(a.detune),a})),window.hasOwnProperty("webkitOfflineAudioContext")&&!window.hasOwnProperty("OfflineAudioContext")&&(window.OfflineAudioContext=window.webkitOfflineAudioContext)})(window),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var f=document.createElement("audio");p5.prototype.isSupported=function(){return!!f.canPlayType},p5.prototype.isFileSupported=function(l){switch(l.toLowerCase()){case"mp3":return!!f.canPlayType&&f.canPlayType("audio/mpeg;");case"wav":return!!f.canPlayType&&f.canPlayType('audio/wav; codecs="1"');case"ogg":return!!f.canPlayType&&f.canPlayType('audio/ogg; codecs="vorbis"');case"aac":case"m4a":case"mp4":return!!f.canPlayType&&(f.canPlayType("audio/x-m4a;")||f.canPlayType("audio/aac;"));case"aif":case"aiff":return!!f.canPlayType&&f.canPlayType("audio/x-aiff;");default:return!1}}},function(P,A){var f;f=function(){return this}();try{f=f||new Function("return this")()}catch{"object"==typeof window&&(f=window)}P.exports=f},function(P,A,f){"use strict";f.r(A),A.default='function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called"); } return self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _wrapNativeSuper(Class) { var _cache = typeof Map === "function" ? new Map() : undefined; _wrapNativeSuper = function _wrapNativeSuper(Class) { if (Class === null || !_isNativeFunction(Class)) return Class; if (typeof Class !== "function") { throw new TypeError("Super expression must either be null or a function"); } if (typeof _cache !== "undefined") { if (_cache.has(Class)) return _cache.get(Class); _cache.set(Class, Wrapper); } function Wrapper() { return _construct(Class, arguments, _getPrototypeOf(this).constructor); } Wrapper.prototype = Object.create(Class.prototype, { constructor: { value: Wrapper, enumerable: false, writable: true, configurable: true } }); return _setPrototypeOf(Wrapper, Class); }; return _wrapNativeSuper(Class); }\n\nfunction isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _construct(Parent, args, Class) { if (isNativeReflectConstruct()) { _construct = Reflect.construct; } else { _construct = function _construct(Parent, args, Class) { var a = [null]; a.push.apply(a, args); var Constructor = Function.bind.apply(Parent, a); var instance = new Constructor(); if (Class) _setPrototypeOf(instance, Class.prototype); return instance; }; } return _construct.apply(null, arguments); }\n\nfunction _isNativeFunction(fn) { return Function.toString.call(fn).indexOf("[native code]") !== -1; }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\n// import dependencies via preval.require so that they\'re available as values at compile time\nvar processorNames = {\n  "recorderProcessor": "recorder-processor",\n  "soundFileProcessor": "sound-file-processor",\n  "amplitudeProcessor": "amplitude-processor"\n};\nvar RingBuffer = {\n  "default":\n  /*#__PURE__*/\n  function () {\n    /**\n     * @constructor\n     * @param  {number} length Buffer length in frames.\n     * @param  {number} channelCount Buffer channel count.\n     */\n    function RingBuffer(length, channelCount) {\n      _classCallCheck(this, RingBuffer);\n\n      this._readIndex = 0;\n      this._writeIndex = 0;\n      this._framesAvailable = 0;\n      this._channelCount = channelCount;\n      this._length = length;\n      this._channelData = [];\n\n      for (var i = 0; i < this._channelCount; ++i) {\n        this._channelData[i] = new Float32Array(length);\n      }\n    }\n    /**\n     * Getter for Available frames in buffer.\n     *\n     * @return {number} Available frames in buffer.\n     */\n\n\n    _createClass(RingBuffer, [{\n      key: "push",\n\n      /**\n       * Push a sequence of Float32Arrays to buffer.\n       *\n       * @param  {array} arraySequence A sequence of Float32Arrays.\n       */\n      value: function push(arraySequence) {\n        // The channel count of arraySequence and the length of each channel must\n        // match with this buffer obejct.\n        // Transfer data from the |arraySequence| storage to the internal buffer.\n        var sourceLength = arraySequence[0] ? arraySequence[0].length : 0;\n\n        for (var i = 0; i < sourceLength; ++i) {\n          var writeIndex = (this._writeIndex + i) % this._length;\n\n          for (var channel = 0; channel < this._channelCount; ++channel) {\n            this._channelData[channel][writeIndex] = arraySequence[channel][i];\n          }\n        }\n\n        this._writeIndex += sourceLength;\n\n        if (this._writeIndex >= this._length) {\n          this._writeIndex = 0;\n        } // For excessive frames, the buffer will be overwritten.\n\n\n        this._framesAvailable += sourceLength;\n\n        if (this._framesAvailable > this._length) {\n          this._framesAvailable = this._length;\n        }\n      }\n      /**\n       * Pull data out of buffer and fill a given sequence of Float32Arrays.\n       *\n       * @param  {array} arraySequence An array of Float32Arrays.\n       */\n\n    }, {\n      key: "pull",\n      value: function pull(arraySequence) {\n        // The channel count of arraySequence and the length of each channel must\n        // match with this buffer obejct.\n        // If the FIFO is completely empty, do nothing.\n        if (this._framesAvailable === 0) {\n          return;\n        }\n\n        var destinationLength = arraySequence[0].length; // Transfer data from the internal buffer to the |arraySequence| storage.\n\n        for (var i = 0; i < destinationLength; ++i) {\n          var readIndex = (this._readIndex + i) % this._length;\n\n          for (var channel = 0; channel < this._channelCount; ++channel) {\n            arraySequence[channel][i] = this._channelData[channel][readIndex];\n          }\n        }\n\n        this._readIndex += destinationLength;\n\n        if (this._readIndex >= this._length) {\n          this._readIndex = 0;\n        }\n\n        this._framesAvailable -= destinationLength;\n\n        if (this._framesAvailable < 0) {\n          this._framesAvailable = 0;\n        }\n      }\n    }, {\n      key: "framesAvailable",\n      get: function get() {\n        return this._framesAvailable;\n      }\n    }]);\n\n    return RingBuffer;\n  }()\n}["default"];\n\nvar RecorderProcessor =\n/*#__PURE__*/\nfunction (_AudioWorkletProcesso) {\n  _inherits(RecorderProcessor, _AudioWorkletProcesso);\n\n  function RecorderProcessor(options) {\n    var _this;\n\n    _classCallCheck(this, RecorderProcessor);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(RecorderProcessor).call(this));\n    var processorOptions = options.processorOptions || {};\n    _this.numOutputChannels = options.outputChannelCount || 2;\n    _this.numInputChannels = processorOptions.numInputChannels || 2;\n    _this.bufferSize = processorOptions.bufferSize || 1024;\n    _this.recording = false;\n\n    _this.clear();\n\n    _this.port.onmessage = function (event) {\n      var data = event.data;\n\n      if (data.name === \'start\') {\n        _this.record(data.duration);\n      } else if (data.name === \'stop\') {\n        _this.stop();\n      }\n    };\n\n    return _this;\n  }\n\n  _createClass(RecorderProcessor, [{\n    key: "process",\n    value: function process(inputs) {\n      if (!this.recording) {\n        return true;\n      } else if (this.sampleLimit && this.recordedSamples >= this.sampleLimit) {\n        this.stop();\n        return true;\n      }\n\n      var input = inputs[0];\n      this.inputRingBuffer.push(input);\n\n      if (this.inputRingBuffer.framesAvailable >= this.bufferSize) {\n        this.inputRingBuffer.pull(this.inputRingBufferArraySequence);\n\n        for (var channel = 0; channel < this.numOutputChannels; ++channel) {\n          var inputChannelCopy = this.inputRingBufferArraySequence[channel].slice();\n\n          if (channel === 0) {\n            this.leftBuffers.push(inputChannelCopy);\n\n            if (this.numInputChannels === 1) {\n              this.rightBuffers.push(inputChannelCopy);\n            }\n          } else if (channel === 1 && this.numInputChannels > 1) {\n            this.rightBuffers.push(inputChannelCopy);\n          }\n        }\n\n        this.recordedSamples += this.bufferSize;\n      }\n\n      return true;\n    }\n  }, {\n    key: "record",\n    value: function record(duration) {\n      if (duration) {\n        this.sampleLimit = Math.round(duration * sampleRate);\n      }\n\n      this.recording = true;\n    }\n  }, {\n    key: "stop",\n    value: function stop() {\n      this.recording = false;\n      var buffers = this.getBuffers();\n      var leftBuffer = buffers[0].buffer;\n      var rightBuffer = buffers[1].buffer;\n      this.port.postMessage({\n        name: \'buffers\',\n        leftBuffer: leftBuffer,\n        rightBuffer: rightBuffer\n      }, [leftBuffer, rightBuffer]);\n      this.clear();\n    }\n  }, {\n    key: "getBuffers",\n    value: function getBuffers() {\n      var buffers = [];\n      buffers.push(this.mergeBuffers(this.leftBuffers));\n      buffers.push(this.mergeBuffers(this.rightBuffers));\n      return buffers;\n    }\n  }, {\n    key: "mergeBuffers",\n    value: function mergeBuffers(channelBuffer) {\n      var result = new Float32Array(this.recordedSamples);\n      var offset = 0;\n      var lng = channelBuffer.length;\n\n      for (var i = 0; i < lng; i++) {\n        var buffer = channelBuffer[i];\n        result.set(buffer, offset);\n        offset += buffer.length;\n      }\n\n      return result;\n    }\n  }, {\n    key: "clear",\n    value: function clear() {\n      var _this2 = this;\n\n      this.leftBuffers = [];\n      this.rightBuffers = [];\n      this.inputRingBuffer = new RingBuffer(this.bufferSize, this.numInputChannels);\n      this.inputRingBufferArraySequence = new Array(this.numInputChannels).fill(null).map(function () {\n        return new Float32Array(_this2.bufferSize);\n      });\n      this.recordedSamples = 0;\n      this.sampleLimit = null;\n    }\n  }]);\n\n  return RecorderProcessor;\n}(_wrapNativeSuper(AudioWorkletProcessor));\n\nregisterProcessor(processorNames.recorderProcessor, RecorderProcessor);'},function(P,A,f){"use strict";f.r(A),A.default='function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called"); } return self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _wrapNativeSuper(Class) { var _cache = typeof Map === "function" ? new Map() : undefined; _wrapNativeSuper = function _wrapNativeSuper(Class) { if (Class === null || !_isNativeFunction(Class)) return Class; if (typeof Class !== "function") { throw new TypeError("Super expression must either be null or a function"); } if (typeof _cache !== "undefined") { if (_cache.has(Class)) return _cache.get(Class); _cache.set(Class, Wrapper); } function Wrapper() { return _construct(Class, arguments, _getPrototypeOf(this).constructor); } Wrapper.prototype = Object.create(Class.prototype, { constructor: { value: Wrapper, enumerable: false, writable: true, configurable: true } }); return _setPrototypeOf(Wrapper, Class); }; return _wrapNativeSuper(Class); }\n\nfunction isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _construct(Parent, args, Class) { if (isNativeReflectConstruct()) { _construct = Reflect.construct; } else { _construct = function _construct(Parent, args, Class) { var a = [null]; a.push.apply(a, args); var Constructor = Function.bind.apply(Parent, a); var instance = new Constructor(); if (Class) _setPrototypeOf(instance, Class.prototype); return instance; }; } return _construct.apply(null, arguments); }\n\nfunction _isNativeFunction(fn) { return Function.toString.call(fn).indexOf("[native code]") !== -1; }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\n// import dependencies via preval.require so that they\'re available as values at compile time\nvar processorNames = {\n  "recorderProcessor": "recorder-processor",\n  "soundFileProcessor": "sound-file-processor",\n  "amplitudeProcessor": "amplitude-processor"\n};\nvar RingBuffer = {\n  "default":\n  /*#__PURE__*/\n  function () {\n    /**\n     * @constructor\n     * @param  {number} length Buffer length in frames.\n     * @param  {number} channelCount Buffer channel count.\n     */\n    function RingBuffer(length, channelCount) {\n      _classCallCheck(this, RingBuffer);\n\n      this._readIndex = 0;\n      this._writeIndex = 0;\n      this._framesAvailable = 0;\n      this._channelCount = channelCount;\n      this._length = length;\n      this._channelData = [];\n\n      for (var i = 0; i < this._channelCount; ++i) {\n        this._channelData[i] = new Float32Array(length);\n      }\n    }\n    /**\n     * Getter for Available frames in buffer.\n     *\n     * @return {number} Available frames in buffer.\n     */\n\n\n    _createClass(RingBuffer, [{\n      key: "push",\n\n      /**\n       * Push a sequence of Float32Arrays to buffer.\n       *\n       * @param  {array} arraySequence A sequence of Float32Arrays.\n       */\n      value: function push(arraySequence) {\n        // The channel count of arraySequence and the length of each channel must\n        // match with this buffer obejct.\n        // Transfer data from the |arraySequence| storage to the internal buffer.\n        var sourceLength = arraySequence[0] ? arraySequence[0].length : 0;\n\n        for (var i = 0; i < sourceLength; ++i) {\n          var writeIndex = (this._writeIndex + i) % this._length;\n\n          for (var channel = 0; channel < this._channelCount; ++channel) {\n            this._channelData[channel][writeIndex] = arraySequence[channel][i];\n          }\n        }\n\n        this._writeIndex += sourceLength;\n\n        if (this._writeIndex >= this._length) {\n          this._writeIndex = 0;\n        } // For excessive frames, the buffer will be overwritten.\n\n\n        this._framesAvailable += sourceLength;\n\n        if (this._framesAvailable > this._length) {\n          this._framesAvailable = this._length;\n        }\n      }\n      /**\n       * Pull data out of buffer and fill a given sequence of Float32Arrays.\n       *\n       * @param  {array} arraySequence An array of Float32Arrays.\n       */\n\n    }, {\n      key: "pull",\n      value: function pull(arraySequence) {\n        // The channel count of arraySequence and the length of each channel must\n        // match with this buffer obejct.\n        // If the FIFO is completely empty, do nothing.\n        if (this._framesAvailable === 0) {\n          return;\n        }\n\n        var destinationLength = arraySequence[0].length; // Transfer data from the internal buffer to the |arraySequence| storage.\n\n        for (var i = 0; i < destinationLength; ++i) {\n          var readIndex = (this._readIndex + i) % this._length;\n\n          for (var channel = 0; channel < this._channelCount; ++channel) {\n            arraySequence[channel][i] = this._channelData[channel][readIndex];\n          }\n        }\n\n        this._readIndex += destinationLength;\n\n        if (this._readIndex >= this._length) {\n          this._readIndex = 0;\n        }\n\n        this._framesAvailable -= destinationLength;\n\n        if (this._framesAvailable < 0) {\n          this._framesAvailable = 0;\n        }\n      }\n    }, {\n      key: "framesAvailable",\n      get: function get() {\n        return this._framesAvailable;\n      }\n    }]);\n\n    return RingBuffer;\n  }()\n}["default"];\n\nvar SoundFileProcessor =\n/*#__PURE__*/\nfunction (_AudioWorkletProcesso) {\n  _inherits(SoundFileProcessor, _AudioWorkletProcesso);\n\n  function SoundFileProcessor(options) {\n    var _this;\n\n    _classCallCheck(this, SoundFileProcessor);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(SoundFileProcessor).call(this));\n    var processorOptions = options.processorOptions || {};\n    _this.bufferSize = processorOptions.bufferSize || 256;\n    _this.inputRingBuffer = new RingBuffer(_this.bufferSize, 1);\n    _this.inputRingBufferArraySequence = [new Float32Array(_this.bufferSize)];\n    return _this;\n  }\n\n  _createClass(SoundFileProcessor, [{\n    key: "process",\n    value: function process(inputs) {\n      var input = inputs[0]; // we only care about the first input channel, because that contains the position data\n\n      this.inputRingBuffer.push([input[0]]);\n\n      if (this.inputRingBuffer.framesAvailable >= this.bufferSize) {\n        this.inputRingBuffer.pull(this.inputRingBufferArraySequence);\n        var inputChannel = this.inputRingBufferArraySequence[0];\n        var position = inputChannel[inputChannel.length - 1] || 0;\n        this.port.postMessage({\n          name: \'position\',\n          position: position\n        });\n      }\n\n      return true;\n    }\n  }]);\n\n  return SoundFileProcessor;\n}(_wrapNativeSuper(AudioWorkletProcessor));\n\nregisterProcessor(processorNames.soundFileProcessor, SoundFileProcessor);'},function(P,A,f){"use strict";f.r(A),A.default='function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called"); } return self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _wrapNativeSuper(Class) { var _cache = typeof Map === "function" ? new Map() : undefined; _wrapNativeSuper = function _wrapNativeSuper(Class) { if (Class === null || !_isNativeFunction(Class)) return Class; if (typeof Class !== "function") { throw new TypeError("Super expression must either be null or a function"); } if (typeof _cache !== "undefined") { if (_cache.has(Class)) return _cache.get(Class); _cache.set(Class, Wrapper); } function Wrapper() { return _construct(Class, arguments, _getPrototypeOf(this).constructor); } Wrapper.prototype = Object.create(Class.prototype, { constructor: { value: Wrapper, enumerable: false, writable: true, configurable: true } }); return _setPrototypeOf(Wrapper, Class); }; return _wrapNativeSuper(Class); }\n\nfunction isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _construct(Parent, args, Class) { if (isNativeReflectConstruct()) { _construct = Reflect.construct; } else { _construct = function _construct(Parent, args, Class) { var a = [null]; a.push.apply(a, args); var Constructor = Function.bind.apply(Parent, a); var instance = new Constructor(); if (Class) _setPrototypeOf(instance, Class.prototype); return instance; }; } return _construct.apply(null, arguments); }\n\nfunction _isNativeFunction(fn) { return Function.toString.call(fn).indexOf("[native code]") !== -1; }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\n// import dependencies via preval.require so that they\'re available as values at compile time\nvar processorNames = {\n  "recorderProcessor": "recorder-processor",\n  "soundFileProcessor": "sound-file-processor",\n  "amplitudeProcessor": "amplitude-processor"\n};\nvar RingBuffer = {\n  "default":\n  /*#__PURE__*/\n  function () {\n    /**\n     * @constructor\n     * @param  {number} length Buffer length in frames.\n     * @param  {number} channelCount Buffer channel count.\n     */\n    function RingBuffer(length, channelCount) {\n      _classCallCheck(this, RingBuffer);\n\n      this._readIndex = 0;\n      this._writeIndex = 0;\n      this._framesAvailable = 0;\n      this._channelCount = channelCount;\n      this._length = length;\n      this._channelData = [];\n\n      for (var i = 0; i < this._channelCount; ++i) {\n        this._channelData[i] = new Float32Array(length);\n      }\n    }\n    /**\n     * Getter for Available frames in buffer.\n     *\n     * @return {number} Available frames in buffer.\n     */\n\n\n    _createClass(RingBuffer, [{\n      key: "push",\n\n      /**\n       * Push a sequence of Float32Arrays to buffer.\n       *\n       * @param  {array} arraySequence A sequence of Float32Arrays.\n       */\n      value: function push(arraySequence) {\n        // The channel count of arraySequence and the length of each channel must\n        // match with this buffer obejct.\n        // Transfer data from the |arraySequence| storage to the internal buffer.\n        var sourceLength = arraySequence[0] ? arraySequence[0].length : 0;\n\n        for (var i = 0; i < sourceLength; ++i) {\n          var writeIndex = (this._writeIndex + i) % this._length;\n\n          for (var channel = 0; channel < this._channelCount; ++channel) {\n            this._channelData[channel][writeIndex] = arraySequence[channel][i];\n          }\n        }\n\n        this._writeIndex += sourceLength;\n\n        if (this._writeIndex >= this._length) {\n          this._writeIndex = 0;\n        } // For excessive frames, the buffer will be overwritten.\n\n\n        this._framesAvailable += sourceLength;\n\n        if (this._framesAvailable > this._length) {\n          this._framesAvailable = this._length;\n        }\n      }\n      /**\n       * Pull data out of buffer and fill a given sequence of Float32Arrays.\n       *\n       * @param  {array} arraySequence An array of Float32Arrays.\n       */\n\n    }, {\n      key: "pull",\n      value: function pull(arraySequence) {\n        // The channel count of arraySequence and the length of each channel must\n        // match with this buffer obejct.\n        // If the FIFO is completely empty, do nothing.\n        if (this._framesAvailable === 0) {\n          return;\n        }\n\n        var destinationLength = arraySequence[0].length; // Transfer data from the internal buffer to the |arraySequence| storage.\n\n        for (var i = 0; i < destinationLength; ++i) {\n          var readIndex = (this._readIndex + i) % this._length;\n\n          for (var channel = 0; channel < this._channelCount; ++channel) {\n            arraySequence[channel][i] = this._channelData[channel][readIndex];\n          }\n        }\n\n        this._readIndex += destinationLength;\n\n        if (this._readIndex >= this._length) {\n          this._readIndex = 0;\n        }\n\n        this._framesAvailable -= destinationLength;\n\n        if (this._framesAvailable < 0) {\n          this._framesAvailable = 0;\n        }\n      }\n    }, {\n      key: "framesAvailable",\n      get: function get() {\n        return this._framesAvailable;\n      }\n    }]);\n\n    return RingBuffer;\n  }()\n}["default"];\n\nvar AmplitudeProcessor =\n/*#__PURE__*/\nfunction (_AudioWorkletProcesso) {\n  _inherits(AmplitudeProcessor, _AudioWorkletProcesso);\n\n  function AmplitudeProcessor(options) {\n    var _this;\n\n    _classCallCheck(this, AmplitudeProcessor);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(AmplitudeProcessor).call(this));\n    var processorOptions = options.processorOptions || {};\n    _this.numOutputChannels = options.outputChannelCount || 1;\n    _this.numInputChannels = processorOptions.numInputChannels || 2;\n    _this.normalize = processorOptions.normalize || false;\n    _this.smoothing = processorOptions.smoothing || 0;\n    _this.bufferSize = processorOptions.bufferSize || 2048;\n    _this.inputRingBuffer = new RingBuffer(_this.bufferSize, _this.numInputChannels);\n    _this.outputRingBuffer = new RingBuffer(_this.bufferSize, _this.numOutputChannels);\n    _this.inputRingBufferArraySequence = new Array(_this.numInputChannels).fill(null).map(function () {\n      return new Float32Array(_this.bufferSize);\n    });\n    _this.stereoVol = [0, 0];\n    _this.stereoVolNorm = [0, 0];\n    _this.volMax = 0.001;\n\n    _this.port.onmessage = function (event) {\n      var data = event.data;\n\n      if (data.name === \'toggleNormalize\') {\n        _this.normalize = data.normalize;\n      } else if (data.name === \'smoothing\') {\n        _this.smoothing = Math.max(0, Math.min(1, data.smoothing));\n      }\n    };\n\n    return _this;\n  } // TO DO make this stereo / dependent on # of audio channels\n\n\n  _createClass(AmplitudeProcessor, [{\n    key: "process",\n    value: function process(inputs, outputs) {\n      var input = inputs[0];\n      var output = outputs[0];\n      var smoothing = this.smoothing;\n      this.inputRingBuffer.push(input);\n\n      if (this.inputRingBuffer.framesAvailable >= this.bufferSize) {\n        this.inputRingBuffer.pull(this.inputRingBufferArraySequence);\n\n        for (var channel = 0; channel < this.numInputChannels; ++channel) {\n          var inputBuffer = this.inputRingBufferArraySequence[channel];\n          var bufLength = inputBuffer.length;\n          var sum = 0;\n\n          for (var i = 0; i < bufLength; i++) {\n            var x = inputBuffer[i];\n\n            if (this.normalize) {\n              sum += Math.max(Math.min(x / this.volMax, 1), -1) * Math.max(Math.min(x / this.volMax, 1), -1);\n            } else {\n              sum += x * x;\n            }\n          } // ... then take the square root of the sum.\n\n\n          var rms = Math.sqrt(sum / bufLength);\n          this.stereoVol[channel] = Math.max(rms, this.stereoVol[channel] * smoothing);\n          this.volMax = Math.max(this.stereoVol[channel], this.volMax);\n        } // calculate stero normalized volume and add volume from all channels together\n\n\n        var volSum = 0;\n\n        for (var index = 0; index < this.stereoVol.length; index++) {\n          this.stereoVolNorm[index] = Math.max(Math.min(this.stereoVol[index] / this.volMax, 1), 0);\n          volSum += this.stereoVol[index];\n        } // volume is average of channels\n\n\n        var volume = volSum / this.stereoVol.length; // normalized value\n\n        var volNorm = Math.max(Math.min(volume / this.volMax, 1), 0);\n        this.port.postMessage({\n          name: \'amplitude\',\n          volume: volume,\n          volNorm: volNorm,\n          stereoVol: this.stereoVol,\n          stereoVolNorm: this.stereoVolNorm\n        }); // pass input through to output\n\n        this.outputRingBuffer.push(this.inputRingBufferArraySequence);\n      } // pull 128 frames out of the ring buffer\n      // if the ring buffer does not have enough frames, the output will be silent\n\n\n      this.outputRingBuffer.pull(output);\n      return true;\n    }\n  }]);\n\n  return AmplitudeProcessor;\n}(_wrapNativeSuper(AudioWorkletProcessor));\n\nregisterProcessor(processorNames.amplitudeProcessor, AmplitudeProcessor);'},function(P,A,f){var _,p;_=[f(0),f(17)],void 0!==(p=function(s){s.Frequency=function(l,a){if(!(this instanceof s.Frequency))return new s.Frequency(l,a);s.TimeBase.call(this,l,a)},s.extend(s.Frequency,s.TimeBase),s.Frequency.prototype._primaryExpressions=Object.create(s.TimeBase.prototype._primaryExpressions),s.Frequency.prototype._primaryExpressions.midi={regexp:/^(\d+(?:\.\d+)?midi)/,method:function(l){return this.midiToFrequency(l)}},s.Frequency.prototype._primaryExpressions.note={regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method:function(l,a){var h=r[l.toLowerCase()]+12*(parseInt(a)+1);return this.midiToFrequency(h)}},s.Frequency.prototype._primaryExpressions.tr={regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method:function(l,a,h){var m=1;return l&&"0"!==l&&(m*=this._beatsToUnits(this._timeSignature()*parseFloat(l))),a&&"0"!==a&&(m*=this._beatsToUnits(parseFloat(a))),h&&"0"!==h&&(m*=this._beatsToUnits(parseFloat(h)/4)),m}},s.Frequency.prototype.transpose=function(l){return this._expr=function(a,h){return a()*this.intervalToFrequencyRatio(h)}.bind(this,this._expr,l),this},s.Frequency.prototype.harmonize=function(l){return this._expr=function(a,h){for(var m=a(),T=[],S=0;S<h.length;S++)T[S]=m*this.intervalToFrequencyRatio(h[S]);return T}.bind(this,this._expr,l),this},s.Frequency.prototype.toMidi=function(){return this.frequencyToMidi(this.valueOf())},s.Frequency.prototype.toNote=function(){var l=this.valueOf(),a=Math.log(l/s.Frequency.A4)/Math.LN2,h=Math.round(12*a)+57,m=Math.floor(h/12);return m<0&&(h+=-12*m),c[h%12]+m.toString()},s.Frequency.prototype.toSeconds=function(){return 1/this.valueOf()},s.Frequency.prototype.toFrequency=function(){return this.valueOf()},s.Frequency.prototype.toTicks=function(){var l=this._beatsToUnits(1),a=this.valueOf()/l;return Math.floor(a*s.Transport.PPQ)},s.Frequency.prototype._frequencyToUnits=function(l){return l},s.Frequency.prototype._ticksToUnits=function(l){return 1/(60*l/(s.Transport.bpm.value*s.Transport.PPQ))},s.Frequency.prototype._beatsToUnits=function(l){return 1/s.TimeBase.prototype._beatsToUnits.call(this,l)},s.Frequency.prototype._secondsToUnits=function(l){return 1/l},s.Frequency.prototype._defaultUnits="hz";var r={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},c=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return s.Frequency.A4=440,s.Frequency.prototype.midiToFrequency=function(l){return s.Frequency.A4*Math.pow(2,(l-69)/12)},s.Frequency.prototype.frequencyToMidi=function(l){return 69+12*Math.log(l/s.Frequency.A4)/Math.LN2},s.Frequency}.apply(A,_))&&(P.exports=p)},function(P,A,f){var _,p;_=[f(0),f(16)],void 0!==(p=function(s){return s.TransportTime=function(r,c){if(!(this instanceof s.TransportTime))return new s.TransportTime(r,c);s.Time.call(this,r,c)},s.extend(s.TransportTime,s.Time),s.TransportTime.prototype._unaryExpressions=Object.create(s.Time.prototype._unaryExpressions),s.TransportTime.prototype._unaryExpressions.quantize={regexp:/^@/,method:function(r){var c=this._secondsToTicks(r()),l=Math.ceil(s.Transport.ticks/c);return this._ticksToUnits(l*c)}},s.TransportTime.prototype._secondsToTicks=function(r){var c=r/this._beatsToUnits(1);return Math.round(c*s.Transport.PPQ)},s.TransportTime.prototype.valueOf=function(){return this._secondsToTicks(this._expr())+(this._plusNow?s.Transport.ticks:0)},s.TransportTime.prototype.toTicks=function(){return this.valueOf()},s.TransportTime.prototype.toSeconds=function(){return this._expr()+(this._plusNow?s.Transport.seconds:0)},s.TransportTime.prototype.toFrequency=function(){return 1/this.toSeconds()},s.TransportTime}.apply(A,_))&&(P.exports=p)},function(P,A,f){var _,p;_=[f(0),f(4),f(13),f(1),f(33),f(21),f(34),f(20),f(35),f(36),f(37)],p=function(s){"use strict";function r(h,m,T){var S=new h;return T._eval(m[0]).connect(S,0,0),T._eval(m[1]).connect(S,0,1),S}function c(h,m,T){var S=new h;return T._eval(m[0]).connect(S,0,0),S}function l(h){return h?parseFloat(h):void 0}function a(h){return h&&h.args?parseFloat(h.args):void 0}return s.Expr=function(){var h=this._replacements(Array.prototype.slice.call(arguments)),m=this._parseInputs(h);this._nodes=[],this.input=new Array(m);for(var T=0;T<m;T++)this.input[T]=this.context.createGain();var S,k=this._parseTree(h);try{S=this._eval(k)}catch{throw this._disposeNodes(),new Error("Tone.Expr: Could evaluate expression: "+h)}this.output=S},s.extend(s.Expr,s.SignalBase),s.Expr._Expressions={value:{signal:{regexp:/^\d+\.\d+|^\d+/,method:function(h){return new s.Signal(l(h))}},input:{regexp:/^\$\d/,method:function(h,m){return m.input[l(h.substr(1))]}}},glue:{"(":{regexp:/^\(/},")":{regexp:/^\)/},",":{regexp:/^,/}},func:{abs:{regexp:/^abs/,method:c.bind(this,s.Abs)},mod:{regexp:/^mod/,method:function(h,m){var T=a(h[1]),S=new s.Modulo(T);return m._eval(h[0]).connect(S),S}},pow:{regexp:/^pow/,method:function(h,m){var T=a(h[1]),S=new s.Pow(T);return m._eval(h[0]).connect(S),S}},a2g:{regexp:/^a2g/,method:function(h,m){var T=new s.AudioToGain;return m._eval(h[0]).connect(T),T}}},binary:{"+":{regexp:/^\+/,precedence:1,method:r.bind(this,s.Add)},"-":{regexp:/^\-/,precedence:1,method:function(h,m){return 1===h.length?c(s.Negate,h,m):r(s.Subtract,h,m)}},"*":{regexp:/^\*/,precedence:0,method:r.bind(this,s.Multiply)}},unary:{"-":{regexp:/^\-/,method:c.bind(this,s.Negate)},"!":{regexp:/^\!/,method:c.bind(this,s.NOT)}}},s.Expr.prototype._parseInputs=function(h){var m=h.match(/\$\d/g),T=0;if(null!==m)for(var S=0;S<m.length;S++){var k=parseInt(m[S].substr(1))+1;T=Math.max(T,k)}return T},s.Expr.prototype._replacements=function(h){for(var m=h.shift(),T=0;T<h.length;T++)m=m.replace(/\%/i,h[T]);return m},s.Expr.prototype._tokenize=function(h){for(var m=-1,T=[];0<h.length;){var S=k(h=h.trim());T.push(S),h=h.substr(S.value.length)}function k(x){for(var I in s.Expr._Expressions){var R=s.Expr._Expressions[I];for(var V in R){var N=R[V],j=x.match(N.regexp);if(null!==j)return{type:I,value:j[0],method:N.method}}}throw new SyntaxError("Tone.Expr: Unexpected token "+x)}return{next:function(){return T[++m]},peek:function(){return T[m+1]}}},s.Expr.prototype._parseTree=function(h){var m=this._tokenize(h),T=this.isUndef.bind(this);function S(R,V){return!T(R)&&"glue"===R.type&&R.value===V}function k(R,V,N){var $=s.Expr._Expressions[V];if(!T(R))for(var j in $){var b=$[j];if(b.regexp.test(R.value)&&(T(N)||b.precedence===N))return!0}return!1}return function x(R){var V;T(R)&&(R=5),V=R<0?function $(){var j,b;return k(j=m.peek(),"unary")?(j=m.next(),b=$(),{operator:j.value,method:j.method,args:[b]}):function I(){var R,V;if(R=m.peek(),T(R))throw new SyntaxError("Tone.Expr: Unexpected termination of expression");if("func"===R.type)return function(N){var $=[];if(!S(m.next(),"("))throw new SyntaxError('Tone.Expr: Expected ( in a function call "'+N.value+'"');if(S(m.peek(),")")||($=function(){for(var j,b=[];j=x(),!T(j)&&(b.push(j),S(m.peek(),","));)m.next();return b}()),S(m.next(),")"))return{method:N.method,args:$,name};throw new SyntaxError('Tone.Expr: Expected ) in a function call "'+N.value+'"')}(R=m.next());if("value"===R.type)return{method:(R=m.next()).method,args:R.value};if(S(R,"(")){if(m.next(),V=x(),!S(R=m.next(),")"))throw new SyntaxError("Expected )");return V}throw new SyntaxError("Tone.Expr: Parse error, cannot process token "+R.value)}()}():x(R-1);for(var N=m.peek();k(N,"binary",R);)V={operator:(N=m.next()).value,method:N.method,args:[V,x(R-1)]},N=m.peek();return V}()},s.Expr.prototype._eval=function(h){if(!this.isUndef(h)){var m=h.method(h.args,this);return this._nodes.push(m),m}},s.Expr.prototype._disposeNodes=function(){for(var h=0;h<this._nodes.length;h++){var m=this._nodes[h];this.isFunction(m.dispose)?m.dispose():this.isFunction(m.disconnect)&&m.disconnect(),m=null,this._nodes[h]=null}this._nodes=null},s.Expr.prototype.dispose=function(){s.prototype.dispose.call(this),this._disposeNodes()},s.Expr}.apply(A,_),void 0!==p&&(P.exports=p)},function(P,A,f){var _,p;_=[f(0),f(21),f(13),f(2)],void 0!==(p=function(s){"use strict";return s.GreaterThan=function(r){this.createInsOuts(2,0),this._param=this.input[0]=new s.Subtract(r),this.input[1]=this._param.input[1],this._gtz=this.output=new s.GreaterThanZero,this._param.connect(this._gtz)},s.extend(s.GreaterThan,s.Signal),s.GreaterThan.prototype.dispose=function(){return s.prototype.dispose.call(this),this._param.dispose(),this._param=null,this._gtz.dispose(),this._gtz=null,this},s.GreaterThan}.apply(A,_))&&(P.exports=p)},function(P,A,f){var _,p;_=[f(0),f(6),f(15)],void 0!==(p=function(s){"use strict";return s.Abs=function(){this._abs=this.input=this.output=new s.WaveShaper(function(r){return 0===r?0:Math.abs(r)},127)},s.extend(s.Abs,s.SignalBase),s.Abs.prototype.dispose=function(){return s.prototype.dispose.call(this),this._abs.dispose(),this._abs=null,this},s.Abs}.apply(A,_))&&(P.exports=p)},function(P,A,f){var _,p;_=[f(0),f(6),f(1),f(13)],void 0!==(p=function(s){"use strict";return s.Modulo=function(r){this.createInsOuts(1,0),this._shaper=new s.WaveShaper(Math.pow(2,16)),this._multiply=new s.Multiply,this._subtract=this.output=new s.Subtract,this._modSignal=new s.Signal(r),this.input.fan(this._shaper,this._subtract),this._modSignal.connect(this._multiply,0,0),this._shaper.connect(this._multiply,0,1),this._multiply.connect(this._subtract,0,1),this._setWaveShaper(r)},s.extend(s.Modulo,s.SignalBase),s.Modulo.prototype._setWaveShaper=function(r){this._shaper.setMap(function(c){return Math.floor((c+1e-4)/r)})},Object.defineProperty(s.Modulo.prototype,"value",{get:function(){return this._modSignal.value},set:function(r){this._modSignal.value=r,this._setWaveShaper(r)}}),s.Modulo.prototype.dispose=function(){return s.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this._multiply.dispose(),this._multiply=null,this._subtract.dispose(),this._subtract=null,this._modSignal.dispose(),this._modSignal=null,this},s.Modulo}.apply(A,_))&&(P.exports=p)},function(P,A,f){var _,p;_=[f(0),f(6)],void 0!==(p=function(s){"use strict";return s.Pow=function(r){this._exp=this.defaultArg(r,1),this._expScaler=this.input=this.output=new s.WaveShaper(this._expFunc(this._exp),8192)},s.extend(s.Pow,s.SignalBase),Object.defineProperty(s.Pow.prototype,"value",{get:function(){return this._exp},set:function(r){this._exp=r,this._expScaler.setMap(this._expFunc(this._exp))}}),s.Pow.prototype._expFunc=function(r){return function(c){return Math.pow(Math.abs(c),r)}},s.Pow.prototype.dispose=function(){return s.prototype.dispose.call(this),this._expScaler.dispose(),this._expScaler=null,this},s.Pow}.apply(A,_))&&(P.exports=p)},function(P,A,f){var _,p;_=[f(0),f(6),f(2)],void 0!==(p=function(s){"use strict";return s.AudioToGain=function(){this._norm=this.input=this.output=new s.WaveShaper(function(r){return(r+1)/2})},s.extend(s.AudioToGain,s.SignalBase),s.AudioToGain.prototype.dispose=function(){return s.prototype.dispose.call(this),this._norm.dispose(),this._norm=null,this},s.AudioToGain}.apply(A,_))&&(P.exports=p)},function(P,A,f){var _,p;_=[f(0),f(6)],void 0!==(p=function(s){"use strict";return s.EqualPowerGain=function(){this._eqPower=this.input=this.output=new s.WaveShaper(function(r){return Math.abs(r)<.001?0:this.equalPowerScale(r)}.bind(this),4096)},s.extend(s.EqualPowerGain,s.SignalBase),s.EqualPowerGain.prototype.dispose=function(){return s.prototype.dispose.call(this),this._eqPower.dispose(),this._eqPower=null,this},s.EqualPowerGain}.apply(A,_))&&(P.exports=p)},function(P,A,f){var _,p;_=[f(0),f(19),f(9)],void 0!==(p=function(s){"use strict";return s.TimelineState=function(r){s.Timeline.call(this),this._initial=r},s.extend(s.TimelineState,s.Timeline),s.TimelineState.prototype.getValueAtTime=function(r){var c=this.get(r);return null!==c?c.state:this._initial},s.TimelineState.prototype.setStateAtTime=function(r,c){this.add({state:r,time:c})},s.TimelineState}.apply(A,_))&&(P.exports=p)},function(P,A,f){"use strict";f.r(A),f(24),f(25);var s=f(3),l=new function i(){(function r(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")})(this,i),this.input=s.a.createGain(),this.output=s.a.createGain(),this.limiter=s.a.createDynamicsCompressor(),this.limiter.threshold.value=-3,this.limiter.ratio.value=20,this.limiter.knee.value=1,this.audiocontext=s.a,this.output.disconnect(),this.input.connect(this.limiter),this.limiter.connect(this.output),this.meter=s.a.createGain(),this.fftMeter=s.a.createGain(),this.output.connect(this.meter),this.output.connect(this.fftMeter),this.output.connect(this.audiocontext.destination),this.soundArray=[],this.parts=[],this.extensions=[]};p5.prototype.getOutputVolume=function(){return l.output.gain.value},p5.prototype.outputVolume=function(i){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if("number"==typeof i){var n=l.audiocontext.currentTime,o=l.output.gain.value;l.output.gain.cancelScheduledValues(n+e),l.output.gain.linearRampToValueAtTime(o,n+e),l.output.gain.linearRampToValueAtTime(i,n+e+t)}else{if(!i)return l.output.gain;i.connect(l.output.gain)}},p5.prototype.soundOut=p5.soundOut=l,p5.soundOut._silentNode=l.audiocontext.createGain(),p5.soundOut._silentNode.gain.value=0,p5.soundOut._silentNode.connect(l.audiocontext.destination);var a=l,h=f(5),m=f.n(h);function T(i){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(i)}function k(i){var t=Math.log(i/440)/Math.log(2);return Math.round(12*t)+69}function x(i){return 440*Math.pow(2,(i-69)/12)}function I(i){if("string"!=typeof i)return i;var e={A:21,B:23,C:24,D:26,E:28,F:29,G:31}[i[0].toUpperCase()];switch(e+=12*(~~i.slice(-1)-1),i[1]){case"#":e+=1;break;case"b":e-=1}return x(e)}function j(i){var t,n=b(t=i.getChannelData(0),i.numberOfChannels>1?i.getChannelData(1):t),o=new window.ArrayBuffer(44+2*n.length),u=new window.DataView(o);v(u,0,"RIFF"),u.setUint32(4,36+2*n.length,!0),v(u,8,"WAVE"),v(u,12,"fmt "),u.setUint32(16,16,!0),u.setUint16(20,1,!0),u.setUint16(22,2,!0),u.setUint32(24,a.audiocontext.sampleRate,!0),u.setUint32(28,4*a.audiocontext.sampleRate,!0),u.setUint16(32,4,!0),u.setUint16(34,16,!0),v(u,36,"data"),u.setUint32(40,2*n.length,!0);for(var d=n.length,y=44,C=0;C<d;C++)u.setInt16(y,32767*n[C],!0),y+=2;return u}function b(i,t){for(var e=i.length+t.length,n=new Float32Array(e),o=0,u=0;u<e;)n[u++]=i[o],n[u++]=t[o],o++;return n}function v(i,t,e){for(var n=e.length,o=0;o<n;o++)i.setUint8(t+o,e.charCodeAt(o))}function E(i){var t=i,e=new AudioWorkletNode(a.audiocontext,m.a.soundFileProcessor);return e instanceof ScriptProcessorNode&&(t=e.bufferSize),e.disconnect(),e=null,t}var U=function(t,e,n){var u,d,o=new Error;return o.name=t,o.originalStack=o.stack+e,u=o.stack+e,o.failedPath=n,d=u.split("\n").filter(function(y){return!y.match(/(p5.|native code|globalInit)/g)}),o.stack=d.join("\n"),o},G=[f(27).default,f(28).default,f(29).default],D=a.audiocontext,F=!1;function W(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function K(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Y(i,t,e){return t&&K(i.prototype,t),e&&K(i,e),i}p5.prototype.registerMethod("init",function(){if(!F){!this.preload&&!window.preload&&(this.preload=function(){}),this._incrementPreload();var i=function(){F=!0,this._decrementPreload()}.bind(this);(function M(){return Promise.all(G.map(function(i){var t=new Blob([i],{type:"application/javascript"}),e=URL.createObjectURL(t);return D.audioWorklet.addModule(e)}))})().then(i)}});var z=a.audiocontext,ne=typeof z.createStereoPanner<"u"?function(){function i(t,e){W(this,i),this.stereoPanner=this.input=z.createStereoPanner(),t.connect(this.stereoPanner),this.stereoPanner.connect(e)}return Y(i,[{key:"pan",value:function(e,n){this.stereoPanner.pan.linearRampToValueAtTime(e,z.currentTime+(n||0))}},{key:"inputChannels",value:function(){}},{key:"connect",value:function(e){this.stereoPanner.connect(e)}},{key:"disconnect",value:function(){this.stereoPanner&&this.stereoPanner.disconnect()}}]),i}():function(){function i(t,e,n){W(this,i),this.input=z.createGain(),t.connect(this.input),this.left=z.createGain(),this.right=z.createGain(),this.left.channelInterpretation="discrete",this.right.channelInterpretation="discrete",n>1?(this.splitter=z.createChannelSplitter(2),this.input.connect(this.splitter),this.splitter.connect(this.left,1),this.splitter.connect(this.right,0)):(this.input.connect(this.left),this.input.connect(this.right)),this.output=z.createChannelMerger(2),this.left.connect(this.output,0,1),this.right.connect(this.output,0,0),this.output.connect(e)}return Y(i,[{key:"pan",value:function(e,n){var u=z.currentTime+(n||0),d=(e+1)/2,y=Math.cos(d*Math.PI/2),g=Math.sin(d*Math.PI/2);this.left.gain.linearRampToValueAtTime(g,u),this.right.gain.linearRampToValueAtTime(y,u)}},{key:"inputChannels",value:function(e){1===e?(this.input.disconnect(),this.input.connect(this.left),this.input.connect(this.right)):2===e&&(typeof this.splitter>"u"&&(this.splitter=z.createChannelSplitter(2)),this.input.disconnect(),this.input.connect(this.splitter),this.splitter.connect(this.left,1),this.splitter.connect(this.right,0))}},{key:"connect",value:function(e){this.output.connect(e)}},{key:"disconnect",value:function(){this.output&&this.output.disconnect()}}]),i}();function H(i){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(i)}function J(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function oe(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var Z=a.audiocontext,fn=function i(t,e,n,o){oe(this,i),this.callback=t,this.time=e,this.id=n,this.val=o};function hn(i){var t=i.target,e=this;t._playing=!1,t.removeEventListener("ended",e._clearOnEnd),e._onended(e),e.bufferSourceNodes.map(function(n,o){return o}).reverse().forEach(function(n){!1===e.bufferSourceNodes[n]._playing&&e.bufferSourceNodes.splice(n,1)}),0===e.bufferSourceNodes.length&&(e._playing=!1)}var gt=function(){function i(t,e,n,o){if(oe(this,i),typeof t<"u"){if("string"==typeof t||"string"==typeof t[0]){var u=p5.prototype._checkFileFormats(t);this.url=u}else if("object"===H(t)&&!(window.File&&window.FileReader&&window.FileList&&window.Blob))throw"Unable to load file because the File API is not supported";t.file&&(t=t.file),this.file=t}this._onended=function(){},this._looping=!1,this._playing=!1,this._paused=!1,this._pauseTime=0,this._cues=[],this._cueIDCounter=0,this._lastPos=0,this._counterNode=null,this._workletNode=null,this.bufferSourceNodes=[],this.bufferSourceNode=null,this.buffer=null,this.playbackRate=1,this.input=a.audiocontext.createGain(),this.output=a.audiocontext.createGain(),this.reversed=!1,this.startTime=0,this.endTime=null,this.pauseTime=0,this.mode="sustain",this.startMillis=null,this.panPosition=0,this.panner=new ne(this.output,a.input,2),(this.url||this.file)&&this.load(e,n),a.soundArray.push(this),this._whileLoading="function"==typeof o?o:function(){},this._clearOnEnd=hn.bind(this),this.amp=this.setVolume,this.fade=this.setVolume}return function ue(i,t,e){t&&J(i.prototype,t),e&&J(i,e)}(i,[{key:"load",value:function(e,n){var o=this,u=(new Error).stack;if(void 0!==this.url&&""!==this.url){var d=new XMLHttpRequest;d.addEventListener("progress",function(g){o._updateProgress(g)},!1),d.open("GET",this.url,!0),d.responseType="arraybuffer",d.onload=function(){if(200===d.status){if(!o.panner)return;Z.decodeAudioData(d.response,function(O){o.panner&&(o.buffer=O,o.panner.inputChannels(O.numberOfChannels),e&&e(o))},function(){if(o.panner){var O=new U("decodeAudioData",u,o.url),L="AudioContext error at decodeAudioData for "+o.url;n?(O.msg=L,n(O)):console.error(L+"\n The error stack trace includes: \n"+O.stack)}})}else{if(!o.panner)return;var g=new U("loadSound",u,o.url),C="Unable to load "+o.url+". The request status was: "+d.status+" ("+d.statusText+")";n?(g.message=C,n(g)):console.error(C+"\n The error stack trace includes: \n"+g.stack)}},d.onerror=function(){var g=new U("loadSound",u,o.url),C="There was no response from the server at "+o.url+". Check the url and internet connectivity.";n?(g.message=C,n(g)):console.error(C+"\n The error stack trace includes: \n"+g.stack)},d.send()}else if(void 0!==this.file){var y=new FileReader;y.onload=function(){o.panner&&Z.decodeAudioData(y.result,function(g){o.panner&&(o.buffer=g,o.panner.inputChannels(g.numberOfChannels),e&&e(o))})},y.onerror=function(g){o.panner&&onerror&&onerror(g)},y.readAsArrayBuffer(this.file)}}},{key:"_updateProgress",value:function(e){e.lengthComputable?this._whileLoading(e.loaded/e.total*.99,e):this._whileLoading("size unknown")}},{key:"isLoaded",value:function(){return!!this.buffer}},{key:"play",value:function(e,n,o,u,d){if(this.output){var g,C,O=e||0;if(O<0&&(O=0),O+=a.audiocontext.currentTime,typeof n<"u"&&this.rate(n),typeof o<"u"&&this.setVolume(o),!this.buffer)throw"not ready to play file, buffer has yet to load. Try preload()";if(this._pauseTime=0,"restart"===this.mode&&this.buffer&&this.bufferSourceNode&&(this.bufferSourceNode.stop(O),this._counterNode.stop(O)),"untildone"!==this.mode||!this.isPlaying()){if(this.bufferSourceNode=this._initSourceNode(),delete this._counterNode,this._counterNode=this._initCounterNode(),u){if(!(u>=0&&u<this.buffer.duration))throw"start time out of range";g=u}else g=0;d&&(d=d<=this.buffer.duration-g?d:this.buffer.duration),this._paused?(this.bufferSourceNode.start(O,this.pauseTime,d),this._counterNode.start(O,this.pauseTime,d)):(this.bufferSourceNode.start(O,g,d),this._counterNode.start(O,g,d)),this._playing=!0,this._paused=!1,this.bufferSourceNodes.push(this.bufferSourceNode),this.bufferSourceNode._arrayIndex=this.bufferSourceNodes.length-1,this.bufferSourceNode.addEventListener("ended",this._clearOnEnd),this.bufferSourceNode.loop=this._looping,this._counterNode.loop=this._looping,!0===this._looping&&(C=d||g-1e-15,this.bufferSourceNode.loopStart=g,this.bufferSourceNode.loopEnd=C,this._counterNode.loopStart=g,this._counterNode.loopEnd=C)}}else console.warn("SoundFile.play() called after dispose")}},{key:"playMode",value:function(e){var n=e.toLowerCase();if("restart"===n&&this.buffer&&this.bufferSourceNode)for(var o=0;o<this.bufferSourceNodes.length-1;o++)this.bufferSourceNodes[o].stop(a.audiocontext.currentTime);if("restart"!==n&&"sustain"!==n&&"untildone"!==n)throw'Invalid play mode. Must be either "restart" or "sustain"';this.mode=n}},{key:"pause",value:function(e){var u=(e||0)+a.audiocontext.currentTime;this.isPlaying()&&this.buffer&&this.bufferSourceNode?(this._paused=!0,this._playing=!1,this.pauseTime=this.currentTime(),this.bufferSourceNode.stop(u),this._counterNode.stop(u),this._pauseTime=this.currentTime()):this._pauseTime=0}},{key:"loop",value:function(e,n,o,u,d){this._looping=!0,this.play(e,n,o,u,d)}},{key:"setLoop",value:function(e){if(!0===e)this._looping=!0;else{if(!1!==e)throw"Error: setLoop accepts either true or false";this._looping=!1}this.bufferSourceNode&&(this.bufferSourceNode.loop=this._looping,this._counterNode.loop=this._looping)}},{key:"isLooping",value:function(){return!!this.bufferSourceNode&&!0===this._looping&&!0===this.isPlaying()}},{key:"isPlaying",value:function(){return this._playing}},{key:"isPaused",value:function(){return this._paused}},{key:"stop",value:function(e){var n=e||0;if("sustain"===this.mode||"untildone"===this.mode)this.stopAll(n),this._playing=!1,this.pauseTime=0,this._paused=!1;else if(this.buffer&&this.bufferSourceNode){var o=a.audiocontext.currentTime,u=n||0;this.pauseTime=0,this.bufferSourceNode.stop(o+u),this._counterNode.stop(o+u),this._playing=!1,this._paused=!1}}},{key:"stopAll",value:function(e){var n=a.audiocontext.currentTime,o=e||0;if(this.buffer&&this.bufferSourceNode){for(var u in this.bufferSourceNodes){var d=this.bufferSourceNodes[u];if(d)try{d.stop(n+o)}catch{}}this._counterNode.stop(n+o)}}},{key:"getVolume",value:function(){return this.output.gain.value}},{key:"pan",value:function(e,n){this.panPosition=e,this.panner.pan(e,n)}},{key:"getPan",value:function(){return this.panPosition}},{key:"rate",value:function(e){var n=!1;if(typeof e>"u")return this.playbackRate;if(this.playbackRate=e,0===e?e=1e-13:e<0&&!this.reversed?(e=Math.abs(e),n=!0):e>0&&this.reversed&&(n=!0),this.bufferSourceNode){var o=a.audiocontext.currentTime;this.bufferSourceNode.playbackRate.cancelScheduledValues(o),this.bufferSourceNode.playbackRate.linearRampToValueAtTime(Math.abs(e),o),this._counterNode.playbackRate.cancelScheduledValues(o),this._counterNode.playbackRate.linearRampToValueAtTime(Math.abs(e),o)}return n&&this.reverseBuffer(),this.playbackRate}},{key:"setPitch",value:function(e){var n=x(e)/x(60);this.rate(n)}},{key:"getPlaybackRate",value:function(){return this.playbackRate}},{key:"setVolume",value:function(e,n,o){if("number"==typeof e){var u=n||0,d=o||0,y=a.audiocontext.currentTime,g=this.output.gain.value;this.output.gain.cancelScheduledValues(y+d),this.output.gain.linearRampToValueAtTime(g,y+d),this.output.gain.linearRampToValueAtTime(e,y+d+u)}else{if(!e)return this.output.gain;e.connect(this.output.gain)}}},{key:"duration",value:function(){return this.buffer?this.buffer.duration:0}},{key:"currentTime",value:function(){return this.reversed?Math.abs(this._lastPos-this.buffer.length)/Z.sampleRate:this._lastPos/Z.sampleRate}},{key:"jump",value:function(e,n){if(e<0||e>this.buffer.duration)throw"jump time out of range";if(n>this.buffer.duration-e)throw"end time out of range";var o=e||0,u=n||void 0;this.isPlaying()&&(this.stop(0),this.play(0,this.playbackRate,this.output.gain.value,o,u))}},{key:"channels",value:function(){return this.buffer.numberOfChannels}},{key:"sampleRate",value:function(){return this.buffer.sampleRate}},{key:"frames",value:function(){return this.buffer.length}},{key:"getPeaks",value:function(e){if(!this.buffer)throw"Cannot load peaks yet, buffer is not loaded";if(e||(e=5*window.width),this.buffer){for(var n=this.buffer,o=n.length/e,u=~~(o/10)||1,d=n.numberOfChannels,y=new Float32Array(Math.round(e)),g=0;g<d;g++)for(var C=n.getChannelData(g),O=0;O<e;O++){for(var L=~~(O*o),ee=~~(L+o),X=0,Q=L;Q<ee;Q+=u){var ie=C[Q];(ie>X||-ie>X)&&(X=ie)}(0===g||Math.abs(X)>y[O])&&(y[O]=X)}return y}}},{key:"reverseBuffer",value:function(){if(!this.buffer)throw"SoundFile is not done loading";var e=this._lastPos/Z.sampleRate,n=this.getVolume();this.setVolume(0,.001);for(var o=this.buffer.numberOfChannels,u=0;u<o;u++)this.buffer.getChannelData(u).reverse();this.reversed=!this.reversed,this.isPlaying()&&e&&this.jump(this.duration()-e),this.setVolume(n,.001)}},{key:"onended",value:function(e){return this._onended=e,this}},{key:"add",value:function(){}},{key:"dispose",value:function(){var e=a.audiocontext.currentTime,n=a.soundArray.indexOf(this);if(a.soundArray.splice(n,1),this.stop(e),this.buffer&&this.bufferSourceNode){for(var o=0;o<this.bufferSourceNodes.length-1;o++)if(null!==this.bufferSourceNodes[o]){this.bufferSourceNodes[o].disconnect();try{this.bufferSourceNodes[o].stop(e)}catch{console.warn("no buffer source node to dispose")}this.bufferSourceNodes[o]=null}if(this.isPlaying()){try{this._counterNode.stop(e)}catch(u){console.log(u)}this._counterNode=null}}this.output&&(this.output.disconnect(),this.output=null),this.panner&&(this.panner.disconnect(),this.panner=null)}},{key:"connect",value:function(e){e?e.hasOwnProperty("input")?this.panner.connect(e.input):this.panner.connect(e):this.panner.connect(a.input)}},{key:"disconnect",value:function(){this.panner&&this.panner.disconnect()}},{key:"getLevel",value:function(){console.warn("p5.SoundFile.getLevel has been removed from the library. Use p5.Amplitude instead")}},{key:"setPath",value:function(e,n){var o=p5.prototype._checkFileFormats(e);this.url=o,this.load(n)}},{key:"setBuffer",value:function(e){var n=e.length,u=Z.createBuffer(n,e[0].length,Z.sampleRate);e[0]instanceof Float32Array||(e[0]=new Float32Array(e[0]));for(var d=0;d<n;d++)u.getChannelData(d).set(e[d]);this.buffer=u,this.panner.inputChannels(n)}},{key:"_initCounterNode",value:function(){var e=this,n=this,o=Z.currentTime,u=Z.createBufferSource(),d=E(256);return n._workletNode&&(n._workletNode.disconnect(),delete n._workletNode),n._workletNode=new AudioWorkletNode(Z,m.a.soundFileProcessor,{processorOptions:{bufferSize:d}}),n._workletNode.port.onmessage=function(y){if("position"===y.data.name){if(0===y.data.position)return;e._lastPos=y.data.position,e._onTimeUpdate(n._lastPos)}},u.buffer=function(t){for(var e=t.length,n=Z.createBuffer(1,t.length,Z.sampleRate),o=n.getChannelData(0),u=0;u<e;u++)o[u]=u;return n}(n.buffer),u.playbackRate.setValueAtTime(n.playbackRate,o),u.connect(n._workletNode),n._workletNode.connect(p5.soundOut._silentNode),u}},{key:"_initSourceNode",value:function(){var e=Z.createBufferSource();return e.buffer=this.buffer,e.playbackRate.value=this.playbackRate,e.connect(this.output),e}},{key:"processPeaks",value:function(e,n,o,u){console.warn("processPeaks is deprecated")}},{key:"addCue",value:function(e,n,o){var u=this._cueIDCounter++,d=new fn(n,e,u,o);return this._cues.push(d),u}},{key:"removeCue",value:function(e){for(var n=this._cues.length,o=0;o<n;o++)if(this._cues[o].id===e){this._cues.splice(o,1);break}}},{key:"clearCues",value:function(){this._cues=[]}},{key:"_onTimeUpdate",value:function(e){for(var n=e/this.buffer.sampleRate,o=this._cues.length,u=0;u<o;u++){var d=this._cues[u],y=d.time;(this._prevUpdateTime||0)<=y&&y<=n&&d.callback(d.val)}this._prevUpdateTime=n}},{key:"save",value:function(e){p5.prototype.saveSound(this,e,"wav")}},{key:"getBlob",value:function(){var e=j(this.buffer);return new Blob([e],{type:"audio/wav"})}}]),i}(),dn=gt;function bt(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}var Tt=function(){function i(t){(function mn(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")})(this,i),this.bufferSize=E(2048),this.audiocontext=a.audiocontext,this._workletNode=new AudioWorkletNode(this.audiocontext,m.a.amplitudeProcessor,{outputChannelCount:[1],parameterData:{smoothing:t||0},processorOptions:{normalize:!1,smoothing:t||0,numInputChannels:2,bufferSize:this.bufferSize}}),this._workletNode.port.onmessage=function(e){"amplitude"===e.data.name&&(this.volume=e.data.volume,this.volNorm=e.data.volNorm,this.stereoVol=e.data.stereoVol,this.stereoVolNorm=e.data.stereoVolNorm)}.bind(this),this.input=this._workletNode,this.output=this.audiocontext.createGain(),this.volume=0,this.volNorm=0,this.stereoVol=[0,0],this.stereoVolNorm=[0,0],this.normalize=!1,this._workletNode.connect(this.output),this.output.gain.value=0,this.output.connect(this.audiocontext.destination),a.meter.connect(this._workletNode),a.soundArray.push(this)}return function yn(i,t,e){t&&bt(i.prototype,t),e&&bt(i,e)}(i,[{key:"setInput",value:function(e,n){a.meter.disconnect(),n&&(this._workletNode.parameters.get("smoothing").value=n),null==e?(console.log("Amplitude input source is not ready! Connecting to main output instead"),a.meter.connect(this._workletNode)):e?(e.connect(this._workletNode),this._workletNode.disconnect(),this._workletNode.connect(this.output)):a.meter.connect(this._workletNode)}},{key:"connect",value:function(e){e?e.hasOwnProperty("input")?this.output.connect(e.input):this.output.connect(e):this.output.connect(this.panner.connect(a.input))}},{key:"disconnect",value:function(){this.output&&this.output.disconnect()}},{key:"getLevel",value:function(e){return typeof e<"u"?this.normalize?this.stereoVolNorm[e]:this.stereoVol[e]:this.normalize?this.volNorm:this.volume}},{key:"toggleNormalize",value:function(e){this.normalize="boolean"==typeof e?e:!this.normalize,this._workletNode.port.postMessage({name:"toggleNormalize",normalize:this.normalize})}},{key:"smooth",value:function(e){e>=0&&e<1?this._workletNode.port.postMessage({name:"smoothing",smoothing:e}):console.log("Error: smoothing must be between 0 and 1")}},{key:"dispose",value:function(){var e=a.soundArray.indexOf(this);a.soundArray.splice(e,1),this.input&&(this.input.disconnect(),delete this.input),this.output&&(this.output.disconnect(),delete this.output),this._workletNode.disconnect(),delete this._workletNode}}]),i}();function St(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}var bn=function(){function i(t,e){(function _n(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")})(this,i),this.input=this.analyser=a.audiocontext.createAnalyser(),Object.defineProperties(this,{bins:{get:function(){return this.analyser.fftSize/2},set:function(o){this.analyser.fftSize=2*o},configurable:!0,enumerable:!0},smoothing:{get:function(){return this.analyser.smoothingTimeConstant},set:function(o){this.analyser.smoothingTimeConstant=o},configurable:!0,enumerable:!0}}),this.smooth(t),this.bins=e||1024,a.fftMeter.connect(this.analyser),this.freqDomain=new Uint8Array(this.analyser.frequencyBinCount),this.timeDomain=new Uint8Array(this.analyser.frequencyBinCount),this.bass=[20,140],this.lowMid=[140,400],this.mid=[400,2600],this.highMid=[2600,5200],this.treble=[5200,14e3],a.soundArray.push(this)}return function gn(i,t,e){t&&St(i.prototype,t),e&&St(i,e)}(i,[{key:"setInput",value:function(e){e?(e.output?e.output.connect(this.analyser):e.connect&&e.connect(this.analyser),a.fftMeter.disconnect()):a.fftMeter.connect(this.analyser)}},{key:"waveform",value:function(){for(var n,o=new Array,u=0;u<arguments.length;u++)"number"==typeof arguments[u]&&(this.analyser.fftSize=2*arguments[u]),"string"==typeof arguments[u]&&(n=arguments[u]);if(n&&!p5.prototype._isSafari())return function wn(i){i.timeDomain instanceof Float32Array||(i.timeDomain=new Float32Array(i.analyser.frequencyBinCount))}(this),this.analyser.getFloatTimeDomainData(this.timeDomain),this.timeDomain;(function An(i){i.timeDomain instanceof Uint8Array||(i.timeDomain=new Uint8Array(i.analyser.frequencyBinCount))})(this),this.analyser.getByteTimeDomainData(this.timeDomain);for(var d=0;d<this.timeDomain.length;d++){var y=p5.prototype.map(this.timeDomain[d],0,255,-1,1);o.push(y)}return o}},{key:"analyze",value:function(){for(var e,n=0;n<arguments.length;n++)"number"==typeof arguments[n]&&(this.bins=arguments[n],this.analyser.fftSize=2*this.bins),"string"==typeof arguments[n]&&(e=arguments[n]);return e&&"db"===e.toLowerCase()?(function Tn(i){i.freqDomain instanceof Float32Array||(i.freqDomain=new Float32Array(i.analyser.frequencyBinCount))}(this),this.analyser.getFloatFrequencyData(this.freqDomain),this.freqDomain):(function Sn(i){i.freqDomain instanceof Uint8Array||(i.freqDomain=new Uint8Array(i.analyser.frequencyBinCount))}(this),this.analyser.getByteFrequencyData(this.freqDomain),Array.apply([],this.freqDomain))}},{key:"getEnergy",value:function(e,n){var o=a.audiocontext.sampleRate/2;if("bass"===e?(e=this.bass[0],n=this.bass[1]):"lowMid"===e?(e=this.lowMid[0],n=this.lowMid[1]):"mid"===e?(e=this.mid[0],n=this.mid[1]):"highMid"===e?(e=this.highMid[0],n=this.highMid[1]):"treble"===e&&(e=this.treble[0],n=this.treble[1]),"number"!=typeof e)throw"invalid input for getEnergy()";if(n){if(e&&n){if(e>n){var d=n;n=e,e=d}for(var y=Math.round(e/o*this.freqDomain.length),g=Math.round(n/o*this.freqDomain.length),C=0,O=0,L=y;L<=g;L++)C+=this.freqDomain[L],O+=1;return C/O}throw"invalid input for getEnergy()"}var u=Math.round(e/o*this.freqDomain.length);return this.freqDomain[u]}},{key:"getFreq",value:function(e,n){return console.log("getFreq() is deprecated. Please use getEnergy() instead."),this.getEnergy(e,n)}},{key:"getCentroid",value:function(){for(var e=a.audiocontext.sampleRate/2,n=0,o=0,u=0;u<this.freqDomain.length;u++)n+=u*this.freqDomain[u],o+=this.freqDomain[u];var d=0;return 0!==o&&(d=n/o),d*(e/this.freqDomain.length)}},{key:"smooth",value:function(e){return typeof e<"u"&&(this.smoothing=e),this.smoothing}},{key:"dispose",value:function(){var e=a.soundArray.indexOf(this);a.soundArray.splice(e,1),this.analyser&&(this.analyser.disconnect(),delete this.analyser)}},{key:"linAverages",value:function(e){for(var n=e||16,o=this.freqDomain,u=o.length,d=Math.floor(u/n),y=new Array(n),g=0,C=0;C<u;C++)y[g]=void 0!==y[g]?(y[g]+o[C])/2:o[C],C%d==d-1&&g++;return y}},{key:"logAverages",value:function(e){for(var n=a.audiocontext.sampleRate/2,o=this.freqDomain,u=o.length,d=new Array(e.length),y=0,g=0;g<u;g++)Math.round(g*n/this.freqDomain.length)>e[y].hi&&y++,d[y]=void 0!==d[y]?(d[y]+o[g])/2:o[g];return d}},{key:"getOctaveBands",value:function(e,n){var o=e||3,u=n||15.625,d=[],y={lo:u/Math.pow(2,1/(2*o)),ctr:u,hi:u*Math.pow(2,1/(2*o))};d.push(y);for(var g=a.audiocontext.sampleRate/2;y.hi<g;){var C={};C.lo=y.hi,C.ctr=y.ctr*Math.pow(2,1/o),C.hi=C.ctr*Math.pow(2,1/(2*o)),d.push(C),y=C}return d}}]),i}(),Pn=bn,xn=f(4),Te=f.n(xn),En=f(1),le=f.n(En),Cn=f(8),Se=f.n(Cn);function we(i){return(we="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(i)}function Ae(i,t){return!t||"object"!==we(t)&&"function"!=typeof t?function On(i){if(void 0===i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}(i):t}function fe(i){return(fe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(i)}function Pe(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),t&&Qe(i,t)}function Qe(i,t){return(Qe=Object.setPrototypeOf||function(n,o){return n.__proto__=o,n})(i,t)}function he(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function wt(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Je(i,t,e,n,o){var u=i.oscillator;for(var d in i.mathOps)i.mathOps[d]instanceof o&&(u.disconnect(),i.mathOps[d].dispose(),(e=d)<i.mathOps.length-2&&(n=i.mathOps[d+1]));return e===i.mathOps.length-1&&i.mathOps.push(n),d>0&&(u=i.mathOps[d-1]),u.disconnect(),u.connect(t),t.connect(n),i.mathOps[e]=t,i}var pe=function(){function i(t,e){if(he(this,i),"string"==typeof t){var n=e;e=t,t=n}if("number"==typeof e){var o=e;e=t,t=o}this.started=!1,this.phaseAmount=void 0,this.oscillator=a.audiocontext.createOscillator(),this.f=t||440,this.oscillator.type=e||"sine",this.oscillator.frequency.setValueAtTime(this.f,a.audiocontext.currentTime),this.output=a.audiocontext.createGain(),this._freqMods=[],this.output.gain.value=.5,this.output.gain.setValueAtTime(.5,a.audiocontext.currentTime),this.oscillator.connect(this.output),this.panPosition=0,this.connection=a.input,this.panner=new ne(this.output,this.connection,1),this.mathOps=[this.output],a.soundArray.push(this),this.fade=this.amp}return function kn(i,t,e){t&&wt(i.prototype,t),e&&wt(i,e)}(i,[{key:"start",value:function(e,n){if(this.started&&this.stop(a.audiocontext.currentTime),!this.started){var u=n||this.f,d=this.oscillator.type;for(var y in this.oscillator&&(this.oscillator.disconnect(),delete this.oscillator),this.oscillator=a.audiocontext.createOscillator(),this.oscillator.frequency.value=Math.abs(u),this.oscillator.type=d,this.oscillator.connect(this.output),this.oscillator.start((e=e||0)+a.audiocontext.currentTime),this.freqNode=this.oscillator.frequency,this._freqMods)typeof this._freqMods[y].connect<"u"&&this._freqMods[y].connect(this.oscillator.frequency);this.started=!0}}},{key:"stop",value:function(e){this.started&&(this.oscillator.stop((e||0)+a.audiocontext.currentTime),this.started=!1)}},{key:"amp",value:function(e){if("number"==typeof e)this.output.gain.linearRampToValueAtTime(e,a.audiocontext.currentTime+(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)+(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0));else{if(!e)return this.output.gain;e.connect(this.output.gain)}}},{key:"getAmp",value:function(){return this.output.gain.value}},{key:"freq",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if("number"!=typeof e||isNaN(e)){if(!e)return this.oscillator.frequency;e.output&&(e=e.output),e.connect(this.oscillator.frequency),this._freqMods.push(e)}else{this.f=e;var u=a.audiocontext.currentTime;0===n?this.oscillator.frequency.setValueAtTime(e,o+u):e>0?this.oscillator.frequency.exponentialRampToValueAtTime(e,o+n+u):this.oscillator.frequency.linearRampToValueAtTime(e,o+n+u),this.phaseAmount&&this.phase(this.phaseAmount)}}},{key:"getFreq",value:function(){return this.oscillator.frequency.value}},{key:"setType",value:function(e){this.oscillator.type=e}},{key:"getType",value:function(){return this.oscillator.type}},{key:"connect",value:function(e){e?e.hasOwnProperty("input")?(this.panner.connect(e.input),this.connection=e.input):(this.panner.connect(e),this.connection=e):this.panner.connect(a.input)}},{key:"disconnect",value:function(){this.output&&this.output.disconnect(),this.panner&&(this.panner.disconnect(),this.output&&this.output.connect(this.panner)),this.oscMods=[]}},{key:"pan",value:function(e,n){this.panPosition=e,this.panner.pan(e,n)}},{key:"getPan",value:function(){return this.panPosition}},{key:"dispose",value:function(){var e=a.soundArray.indexOf(this);a.soundArray.splice(e,1),this.oscillator&&(this.stop(a.audiocontext.currentTime),this.disconnect(),this.panner=null,this.oscillator=null),this.osc2&&this.osc2.dispose()}},{key:"phase",value:function(e){var n=p5.prototype.map(e,0,1,0,1/this.f),o=a.audiocontext.currentTime;this.phaseAmount=e,this.dNode||(this.dNode=a.audiocontext.createDelay(),this.oscillator.disconnect(),this.oscillator.connect(this.dNode),this.dNode.connect(this.output)),this.dNode.delayTime.setValueAtTime(n,o)}},{key:"add",value:function(e){return Je(this,new Te.a(e),this.mathOps.length-1,this.output,Te.a)}},{key:"mult",value:function(e){return Je(this,new le.a(e),this.mathOps.length-1,this.output,le.a)}},{key:"scale",value:function(e,n,o,u){var d,y;return 4===arguments.length?(d=p5.prototype.map(o,e,n,0,1)-.5,y=p5.prototype.map(u,e,n,0,1)-.5):(d=arguments[0],y=arguments[1]),Je(this,new Se.a(d,y),this.mathOps.length-1,this.output,Se.a)}}]),i}(),Rn=function(i){function t(e){return he(this,t),Ae(this,fe(t).call(this,e,"sine"))}return Pe(t,i),t}(pe),Dn=function(i){function t(e){return he(this,t),Ae(this,fe(t).call(this,e,"triangle"))}return Pe(t,i),t}(pe),At=function(i){function t(e){return he(this,t),Ae(this,fe(t).call(this,e,"sawtooth"))}return Pe(t,i),t}(pe),Mn=function(i){function t(e){return he(this,t),Ae(this,fe(t).call(this,e,"square"))}return Pe(t,i),t}(pe),xe=pe,Nn=f(7),et=f.n(Nn);p5.Envelope=function(i,t,e,n,o,u){this.aTime=i||.1,this.aLevel=t||1,this.dTime=e||.5,this.dLevel=n||0,this.rTime=o||0,this.rLevel=u||0,this._rampHighPercentage=.98,this._rampLowPercentage=.02,this.output=a.audiocontext.createGain(),this.control=new et.a,this._init(),this.control.connect(this.output),this.connection=null,this.mathOps=[this.control],this.isExponential=!1,this.sourceToClear=null,this.wasTriggered=!1,a.soundArray.push(this)},p5.Envelope.prototype._init=function(){this.control.setTargetAtTime(1e-5,a.audiocontext.currentTime,.001),this._setRampAD(this.aTime,this.dTime)},p5.Envelope.prototype.set=function(i,t,e,n,o,u){this.aTime=i,this.aLevel=t,this.dTime=e||0,this.dLevel=n||0,this.rTime=o||0,this.rLevel=u||0,this._setRampAD(i,e)},p5.Envelope.prototype.setADSR=function(i,t,e,n){this.aTime=i,this.dTime=t||0,this.sPercent=e||0,this.dLevel=typeof e<"u"?e*(this.aLevel-this.rLevel)+this.rLevel:0,this.rTime=n||0,this._setRampAD(i,t)},p5.Envelope.prototype.setRange=function(i,t){this.aLevel=i||1,this.rLevel=t||0},p5.Envelope.prototype._setRampAD=function(i,t){this._rampAttackTime=this.checkExpInput(i),this._rampDecayTime=this.checkExpInput(t);var e=1;e=Math.log(1/this.checkExpInput(1-this._rampHighPercentage)),this._rampAttackTC=i/this.checkExpInput(e),e=Math.log(1/this._rampLowPercentage),this._rampDecayTC=t/this.checkExpInput(e)},p5.Envelope.prototype.setRampPercentages=function(i,t){this._rampHighPercentage=this.checkExpInput(i),this._rampLowPercentage=this.checkExpInput(t);var e=1;e=Math.log(1/this.checkExpInput(1-this._rampHighPercentage)),this._rampAttackTC=this._rampAttackTime/this.checkExpInput(e),e=Math.log(1/this._rampLowPercentage),this._rampDecayTC=this._rampDecayTime/this.checkExpInput(e)},p5.Envelope.prototype.setInput=function(){for(var i=0;i<arguments.length;i++)this.connect(arguments[i])},p5.Envelope.prototype.setExp=function(i){this.isExponential=i},p5.Envelope.prototype.checkExpInput=function(i){return i<=0&&(i=1e-8),i},p5.Envelope.prototype.play=function(i,t,e){var n=t||0;i&&this.connection!==i&&this.connect(i),this.triggerAttack(i,n),this.triggerRelease(i,n+this.aTime+this.dTime+~~e)},p5.Envelope.prototype.triggerAttack=function(i,t){var o=a.audiocontext.currentTime+(t||0);this.lastAttack=o,this.wasTriggered=!0,i&&this.connection!==i&&this.connect(i);var u=this.control.getValueAtTime(o);!0===this.isExponential?this.control.exponentialRampToValueAtTime(this.checkExpInput(u),o):this.control.linearRampToValueAtTime(u,o),o+=this.aTime,!0===this.isExponential?(this.control.exponentialRampToValueAtTime(this.checkExpInput(this.aLevel),o),u=this.checkExpInput(this.control.getValueAtTime(o)),this.control.cancelScheduledValues(o),this.control.exponentialRampToValueAtTime(u,o)):(this.control.linearRampToValueAtTime(this.aLevel,o),u=this.control.getValueAtTime(o),this.control.cancelScheduledValues(o),this.control.linearRampToValueAtTime(u,o)),o+=this.dTime,!0===this.isExponential?(this.control.exponentialRampToValueAtTime(this.checkExpInput(this.dLevel),o),u=this.checkExpInput(this.control.getValueAtTime(o)),this.control.cancelScheduledValues(o),this.control.exponentialRampToValueAtTime(u,o)):(this.control.linearRampToValueAtTime(this.dLevel,o),u=this.control.getValueAtTime(o),this.control.cancelScheduledValues(o),this.control.linearRampToValueAtTime(u,o))},p5.Envelope.prototype.triggerRelease=function(i,t){if(this.wasTriggered){var o=a.audiocontext.currentTime+(t||0);i&&this.connection!==i&&this.connect(i);var u=this.control.getValueAtTime(o);!0===this.isExponential?this.control.exponentialRampToValueAtTime(this.checkExpInput(u),o):this.control.linearRampToValueAtTime(u,o),o+=this.rTime,!0===this.isExponential?(this.control.exponentialRampToValueAtTime(this.checkExpInput(this.rLevel),o),u=this.checkExpInput(this.control.getValueAtTime(o)),this.control.cancelScheduledValues(o),this.control.exponentialRampToValueAtTime(u,o)):(this.control.linearRampToValueAtTime(this.rLevel,o),u=this.control.getValueAtTime(o),this.control.cancelScheduledValues(o),this.control.linearRampToValueAtTime(u,o)),this.wasTriggered=!1}},p5.Envelope.prototype.ramp=function(i,t,e,n){var d=a.audiocontext.currentTime+(t||0),y=this.checkExpInput(e),g=typeof n<"u"?this.checkExpInput(n):void 0;i&&this.connection!==i&&this.connect(i);var C=this.checkExpInput(this.control.getValueAtTime(d));y>C?(this.control.setTargetAtTime(y,d,this._rampAttackTC),d+=this._rampAttackTime):y<C&&(this.control.setTargetAtTime(y,d,this._rampDecayTC),d+=this._rampDecayTime),void 0!==g&&(g>y?this.control.setTargetAtTime(g,d,this._rampAttackTC):g<y&&this.control.setTargetAtTime(g,d,this._rampDecayTC))},p5.Envelope.prototype.connect=function(i){this.connection=i,(i instanceof p5.Oscillator||i instanceof p5.SoundFile||i instanceof p5.AudioIn||i instanceof p5.Reverb||i instanceof p5.Noise||i instanceof p5.Filter||i instanceof p5.Delay)&&(i=i.output.gain),i instanceof AudioParam&&i.setValueAtTime(0,a.audiocontext.currentTime),this.output.connect(i)},p5.Envelope.prototype.disconnect=function(){this.output&&this.output.disconnect()},p5.Envelope.prototype.add=function(i){var t=new Te.a(i);return p5.prototype._mathChain(this,t,this.mathOps.length,this.output,Te.a)},p5.Envelope.prototype.mult=function(i){var t=new le.a(i);return p5.prototype._mathChain(this,t,this.mathOps.length,this.output,le.a)},p5.Envelope.prototype.scale=function(i,t,e,n){var o=new Se.a(i,t,e,n);return p5.prototype._mathChain(this,o,this.mathOps.length,this.output,Se.a)},p5.Envelope.prototype.dispose=function(){var i=a.soundArray.indexOf(this);a.soundArray.splice(i,1),this.disconnect(),this.control&&(this.control.dispose(),this.control=null);for(var t=1;t<this.mathOps.length;t++)this.mathOps[t].dispose()},p5.Env=function(i,t,e,n,o,u){console.warn("WARNING: p5.Env is now deprecated and may be removed in future versions. Please use the new p5.Envelope instead."),p5.Envelope.call(this,i,t,e,n,o,u)},p5.Env.prototype=Object.create(p5.Envelope.prototype);var In=p5.Envelope;function Ee(i){return(Ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(i)}function Pt(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function tt(i){return(tt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(i)}function nt(i,t){return(nt=Object.setPrototypeOf||function(n,o){return n.__proto__=o,n})(i,t)}var it=function(){for(var i=2*a.audiocontext.sampleRate,t=a.audiocontext.createBuffer(1,i,a.audiocontext.sampleRate),e=t.getChannelData(0),n=0;n<i;n++)e[n]=2*Math.random()-1;return t.type="white",t}(),xt=function(){var n,o,u,d,y,g,C,i=2*a.audiocontext.sampleRate,t=a.audiocontext.createBuffer(1,i,a.audiocontext.sampleRate),e=t.getChannelData(0);n=o=u=d=y=g=C=0;for(var O=0;O<i;O++){var L=2*Math.random()-1;e[O]=(n=.99886*n+.0555179*L)+(o=.99332*o+.0750759*L)+(u=.969*u+.153852*L)+(d=.8665*d+.3104856*L)+(y=.55*y+.5329522*L)+(g=-.7616*g-.016898*L)+C+.5362*L,e[O]*=.11,C=.115926*L}return t.type="pink",t}(),Et=function(){for(var i=2*a.audiocontext.sampleRate,t=a.audiocontext.createBuffer(1,i,a.audiocontext.sampleRate),e=t.getChannelData(0),n=0,o=0;o<i;o++){var u=2*Math.random()-1;e[o]=(n+.02*u)/1.02,n=e[o],e[o]*=3.5}return t.type="brown",t}(),qn=function(i){function t(e){var n;return function Fn(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),delete(n=function Un(i,t){return!t||"object"!==Ee(t)&&"function"!=typeof t?function Vn(i){if(void 0===i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}(i):t}(this,tt(t).call(this))).f,delete n.freq,delete n.oscillator,n.buffer="brown"===e?Et:"pink"===e?xt:it,n}return function Wn(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),t&&nt(i,t)}(t,i),function Ln(i,t,e){t&&Pt(i.prototype,t),e&&Pt(i,e)}(t,[{key:"setType",value:function(n){switch(n){case"white":default:this.buffer=it;break;case"pink":this.buffer=xt;break;case"brown":this.buffer=Et}if(this.started){var o=a.audiocontext.currentTime;this.stop(o),this.start(o+.01)}}},{key:"getType",value:function(){return this.buffer.type}},{key:"start",value:function(){this.started&&this.stop(),this.noise=a.audiocontext.createBufferSource(),this.noise.buffer=this.buffer,this.noise.loop=!0,this.noise.connect(this.output),this.noise.start(a.audiocontext.currentTime),this.started=!0}},{key:"stop",value:function(){this.noise&&(this.noise.stop(a.audiocontext.currentTime),this.started=!1)}},{key:"dispose",value:function(){var n=a.audiocontext.currentTime,o=a.soundArray.indexOf(this);a.soundArray.splice(o,1),this.noise&&(this.noise.disconnect(),this.stop(n)),this.output&&this.output.disconnect(),this.panner&&this.panner.disconnect(),this.output=null,this.panner=null,this.buffer=null,this.noise=null}}]),t}(xe),Gn=f(2),Kn=f.n(Gn);function Ce(i){return(Ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(i)}function Ct(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function rt(i){return(rt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(i)}function ot(i,t){return(ot=Object.setPrototypeOf||function(n,o){return n.__proto__=o,n})(i,t)}var Hn=function(i){function t(e,n){var o;return function Yn(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function $n(i,t){return!t||"object"!==Ce(t)&&"function"!=typeof t?function Zn(i){if(void 0===i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}(i):t}(this,rt(t).call(this,e,"sawtooth"))).w=n||0,o.osc2=new At(e),o.dNode=a.audiocontext.createDelay(),o.dcOffset=Ot(),o.dcGain=a.audiocontext.createGain(),o.dcOffset.connect(o.dcGain),o.dcGain.connect(o.output),o.f=e||440,o.dNode.delayTime.value=o.w/o.oscillator.frequency.value,o.dcGain.gain.value=1.7*(.5-o.w),o.osc2.disconnect(),o.osc2.panner.disconnect(),o.osc2.amp(-1),o.osc2.output.connect(o.dNode),o.dNode.connect(o.output),o.output.gain.value=1,o.output.connect(o.panner),o}return function Xn(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),t&&ot(i,t)}(t,i),function zn(i,t,e){t&&Ct(i.prototype,t),e&&Ct(i,e)}(t,[{key:"width",value:function(n){if("number"==typeof n)n<=1&&n>=0&&(this.w=n,this.dNode.delayTime.value=this.w/this.oscillator.frequency.value),this.dcGain.gain.value=1.7*(.5-this.w);else{n.connect(this.dNode.delayTime);var u=new Kn.a(-.5);n.connect(u);var d=new le.a(-1),y=new le.a(1.7);(u=u.connect(d).connect(y)).connect(this.dcGain.gain)}}},{key:"start",value:function(n,o){var u=a.audiocontext.currentTime,d=o||0;if(!this.started){var y=n||this.f,g=this.oscillator.type;this.oscillator=a.audiocontext.createOscillator(),this.oscillator.frequency.setValueAtTime(y,u),this.oscillator.type=g,this.oscillator.connect(this.output),this.oscillator.start(d+u),this.osc2.oscillator=a.audiocontext.createOscillator(),this.osc2.oscillator.frequency.setValueAtTime(y,d+u),this.osc2.oscillator.type=g,this.osc2.oscillator.connect(this.osc2.output),this.osc2.start(d+u),this.freqNode=[this.oscillator.frequency,this.osc2.oscillator.frequency],this.dcOffset=Ot(),this.dcOffset.connect(this.dcGain),this.dcOffset.start(d+u),void 0!==this.mods&&void 0!==this.mods.frequency&&(this.mods.frequency.connect(this.freqNode[0]),this.mods.frequency.connect(this.freqNode[1])),this.started=!0,this.osc2.started=!0}}},{key:"stop",value:function(n){if(this.started){var o=n||0,u=a.audiocontext.currentTime;this.oscillator.stop(o+u),this.osc2.oscillator&&this.osc2.oscillator.stop(o+u),this.dcOffset.stop(o+u),this.started=!1,this.osc2.started=!1}}},{key:"freq",value:function(n){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if("number"==typeof n){this.f=n;var d=a.audiocontext.currentTime,y=this.oscillator.frequency.value;this.oscillator.frequency.cancelScheduledValues(d),this.oscillator.frequency.setValueAtTime(y,d+u),this.oscillator.frequency.exponentialRampToValueAtTime(n,u+o+d),this.osc2.oscillator.frequency.cancelScheduledValues(d),this.osc2.oscillator.frequency.setValueAtTime(y,d+u),this.osc2.oscillator.frequency.exponentialRampToValueAtTime(n,u+o+d),this.freqMod&&(this.freqMod.output.disconnect(),this.freqMod=null)}else n.output&&(n.output.disconnect(),n.output.connect(this.oscillator.frequency),n.output.connect(this.osc2.oscillator.frequency),this.freqMod=n)}}]),t}(xe);function Ot(){for(var i=a.audiocontext,t=i.createBuffer(1,2048,i.sampleRate),e=t.getChannelData(0),n=0;n<2048;n++)e[n]=1;var o=i.createBufferSource();return o.buffer=t,o.loop=!0,o}var Qn=Hn;function kt(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}a.inputSources=[];var ni=function(){function i(t){(function Jn(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")})(this,i),this.input=a.audiocontext.createGain(),this.output=a.audiocontext.createGain(),this.stream=null,this.mediaStream=null,this.currentSource=null,this.enabled=!1,this.amplitude=new Tt,this.output.connect(this.amplitude.input),(!window.MediaStreamTrack||!window.navigator.mediaDevices||!window.navigator.mediaDevices.getUserMedia)&&(t?t():window.alert("This browser does not support MediaStreamTrack and mediaDevices")),a.soundArray.push(this)}return function ei(i,t,e){t&&kt(i.prototype,t),e&&kt(i,e)}(i,[{key:"start",value:function(e,n){var o=this;this.stream&&this.stop();var d={audio:{sampleRate:a.audiocontext.sampleRate,echoCancellation:!1}};a.inputSources[this.currentSource]&&(d.audio.deviceId=a.inputSources[o.currentSource].deviceId),window.navigator.mediaDevices.getUserMedia(d).then(function(y){o.stream=y,o.enabled=!0,o.mediaStream=a.audiocontext.createMediaStreamSource(y),o.mediaStream.connect(o.output),o.amplitude.setInput(o.output),e&&e()}).catch(function(y){n?n(y):console.error(y)})}},{key:"stop",value:function(){this.stream&&(this.stream.getTracks().forEach(function(e){e.stop()}),this.mediaStream.disconnect(),delete this.mediaStream,delete this.stream)}},{key:"connect",value:function(e){e?e.hasOwnProperty("input")?this.output.connect(e.input):e.hasOwnProperty("analyser")?this.output.connect(e.analyser):this.output.connect(e):this.output.connect(a.input)}},{key:"disconnect",value:function(){this.output&&(this.output.disconnect(),this.output.connect(this.amplitude.input))}},{key:"getLevel",value:function(e){return e&&(this.amplitude.smoothing=e),this.amplitude.getLevel()}},{key:"amp",value:function(e,n){if(n){var o=n||0,u=this.output.gain.value;this.output.gain.cancelScheduledValues(a.audiocontext.currentTime),this.output.gain.setValueAtTime(u,a.audiocontext.currentTime),this.output.gain.linearRampToValueAtTime(e,o+a.audiocontext.currentTime)}else this.output.gain.cancelScheduledValues(a.audiocontext.currentTime),this.output.gain.setValueAtTime(e,a.audiocontext.currentTime)}},{key:"getSources",value:function(e,n){return new Promise(function(o,u){window.navigator.mediaDevices.enumerateDevices().then(function(d){a.inputSources=d.filter(function(y){return"audioinput"===y.kind}),o(a.inputSources),e&&e(a.inputSources)}).catch(function(d){u(d),n?n(d):console.error("This browser does not support MediaStreamTrack.getSources()")})})}},{key:"setSource",value:function(e){a.inputSources.length>0&&e<a.inputSources.length?(this.currentSource=e,console.log("set source to ",a.inputSources[this.currentSource])):console.log("unable to set input source"),this.stream&&this.stream.active&&this.start()}},{key:"dispose",value:function(){var e=a.soundArray.indexOf(this);a.soundArray.splice(e,1),this.stop(),this.output&&this.output.disconnect(),this.amplitude&&this.amplitude.disconnect(),delete this.amplitude,delete this.output}}]),i}(),ii=f(23),ri=f.n(ii);function Rt(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}var ai=function(){function i(){(function oi(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")})(this,i),this.ac=a.audiocontext,this.input=this.ac.createGain(),this.output=this.ac.createGain(),this._drywet=new ri.a(1),this.wet=this.ac.createGain(),this.input.connect(this._drywet.a),this.wet.connect(this._drywet.b),this._drywet.connect(this.output),this.connect(),a.soundArray.push(this)}return function si(i,t,e){t&&Rt(i.prototype,t),e&&Rt(i,e)}(i,[{key:"amp",value:function(e){var u=a.audiocontext.currentTime,d=u+(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0),y=d+(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)+.001,g=this.output.gain.value;this.output.gain.cancelScheduledValues(u),this.output.gain.linearRampToValueAtTime(g,d+.001),this.output.gain.linearRampToValueAtTime(e,y)}},{key:"chain",value:function(){if(arguments.length>0){this.connect(arguments[0]);for(var e=1;e<arguments.length;e+=1)arguments[e-1].connect(arguments[e])}return this}},{key:"drywet",value:function(e){return typeof e<"u"&&(this._drywet.fade.value=e),this._drywet.fade.value}},{key:"connect",value:function(e){var n=e||p5.soundOut.input;this.output.connect(n.input?n.input:n)}},{key:"disconnect",value:function(){this.output&&this.output.disconnect()}},{key:"dispose",value:function(){var e=a.soundArray.indexOf(this);a.soundArray.splice(e,1),this.input&&(this.input.disconnect(),delete this.input),this.output&&(this.output.disconnect(),delete this.output),this._drywet&&(this._drywet.disconnect(),delete this._drywet),this.wet&&(this.wet.disconnect(),delete this.wet),this.ac=void 0}}]),i}(),se=ai;function Oe(i){return(Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(i)}function ke(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function Dt(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Re(i,t){return!t||"object"!==Oe(t)&&"function"!=typeof t?function ci(i){if(void 0===i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}(i):t}function De(i,t,e){return De=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(o,u,d){var y=function li(i,t){for(;!Object.prototype.hasOwnProperty.call(i,t)&&null!==(i=ae(i)););return i}(o,u);if(y){var g=Object.getOwnPropertyDescriptor(y,u);return g.get?g.get.call(d):g.value}},De(i,t,e||i)}function ae(i){return(ae=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(i)}function Me(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),t&&st(i,t)}function st(i,t){return(st=Object.setPrototypeOf||function(n,o){return n.__proto__=o,n})(i,t)}var Ne=function(i){function t(e){var n;return ke(this,t),(n=Re(this,ae(t).call(this))).biquad=n.ac.createBiquadFilter(),n.input.connect(n.biquad),n.biquad.connect(n.wet),e&&n.setType(e),n._on=!0,n._untoggledType=n.biquad.type,n}return Me(t,i),function ui(i,t,e){t&&Dt(i.prototype,t),e&&Dt(i,e)}(t,[{key:"process",value:function(n,o,u,d){n.connect(this.input),this.set(o,u,d)}},{key:"set",value:function(n,o,u){n&&this.freq(n,u),o&&this.res(o,u)}},{key:"freq",value:function(n,o){var u=o||0;return n<=0&&(n=1),"number"==typeof n?(this.biquad.frequency.cancelScheduledValues(this.ac.currentTime+.01+u),this.biquad.frequency.exponentialRampToValueAtTime(n,this.ac.currentTime+.02+u)):n&&n.connect(this.biquad.frequency),this.biquad.frequency.value}},{key:"res",value:function(n,o){var u=o||0;return"number"==typeof n?(this.biquad.Q.value=n,this.biquad.Q.cancelScheduledValues(this.ac.currentTime+.01+u),this.biquad.Q.linearRampToValueAtTime(n,this.ac.currentTime+.02+u)):n&&n.connect(this.biquad.Q),this.biquad.Q.value}},{key:"gain",value:function(n,o){var u=o||0;return"number"==typeof n?(this.biquad.gain.value=n,this.biquad.gain.cancelScheduledValues(this.ac.currentTime+.01+u),this.biquad.gain.linearRampToValueAtTime(n,this.ac.currentTime+.02+u)):n&&n.connect(this.biquad.gain),this.biquad.gain.value}},{key:"toggle",value:function(){return this._on=!this._on,!0===this._on?this.biquad.type=this._untoggledType:!1===this._on&&(this.biquad.type="allpass"),this._on}},{key:"setType",value:function(n){this.biquad.type=n,this._untoggledType=this.biquad.type}},{key:"dispose",value:function(){De(ae(t.prototype),"dispose",this).call(this),this.biquad&&(this.biquad.disconnect(),delete this.biquad)}}]),t}(se),fi=function(i){function t(){return ke(this,t),Re(this,ae(t).call(this,"lowpass"))}return Me(t,i),t}(Ne),hi=function(i){function t(){return ke(this,t),Re(this,ae(t).call(this,"highpass"))}return Me(t,i),t}(Ne),pi=function(i){function t(){return ke(this,t),Re(this,ae(t).call(this,"bandpass"))}return Me(t,i),t}(Ne),Be=Ne;function Ie(i){return(Ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(i)}function Mt(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function at(i){return(at=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(i)}function ut(i,t){return(ut=Object.setPrototypeOf||function(n,o){return n.__proto__=o,n})(i,t)}var bi=function(i){function t(e,n){var o;return function di(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function yi(i,t){return!t||"object"!==Ie(t)&&"function"!=typeof t?function vi(i){if(void 0===i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}(i):t}(this,at(t).call(this,"peaking"))).disconnect(),o.set(e,n),o.biquad.gain.value=0,delete o.input,delete o.output,delete o._drywet,delete o.wet,o}return function _i(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),t&&ut(i,t)}(t,i),function mi(i,t,e){t&&Mt(i.prototype,t),e&&Mt(i,e)}(t,[{key:"amp",value:function(){console.warn("`amp()` is not available for p5.EQ bands. Use `.gain()`")}},{key:"drywet",value:function(){console.warn("`drywet()` is not available for p5.EQ bands.")}},{key:"connect",value:function(n){var o=n||p5.soundOut.input;this.biquad?this.biquad.connect(o.input?o.input:o):this.output.connect(o.input?o.input:o)}},{key:"disconnect",value:function(){this.biquad&&this.biquad.disconnect()}},{key:"dispose",value:function(){var n=a.soundArray.indexOf(this);a.soundArray.splice(n,1),this.disconnect(),delete this.biquad}}]),t}(Be);function Fe(i){return(Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(i)}function Nt(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Le(i,t,e){return Le=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(o,u,d){var y=function Pi(i,t){for(;!Object.prototype.hasOwnProperty.call(i,t)&&null!==(i=de(i)););return i}(o,u);if(y){var g=Object.getOwnPropertyDescriptor(y,u);return g.get?g.get.call(d):g.value}},Le(i,t,e||i)}function de(i){return(de=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(i)}function ct(i,t){return(ct=Object.setPrototypeOf||function(n,o){return n.__proto__=o,n})(i,t)}var Ei=function(i){function t(e){var n,o;(function Ti(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")})(this,t),n=function wi(i,t){return!t||"object"!==Fe(t)&&"function"!=typeof t?function Ai(i){if(void 0===i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}(i):t}(this,de(t).call(this)),o=3===(e=3===e||8===e?e:3)?Math.pow(2,3):2,n.bands=[];for(var u,d,y=0;y<e;y++)y===e-1?(u=21e3,d=.01):0===y?(u=100,d=.1):1===y?(u=3===e?360*o:360,d=1):(u=n.bands[y-1].freq()*o,d=1),n.bands[y]=n._newBand(u,d),y>0?n.bands[y-1].connect(n.bands[y].biquad):n.input.connect(n.bands[y].biquad);return n.bands[e-1].connect(n.output),n}return function xi(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),t&&ct(i,t)}(t,i),function Si(i,t,e){t&&Nt(i.prototype,t),e&&Nt(i,e)}(t,[{key:"process",value:function(n){n.connect(this.input)}},{key:"set",value:function(){if(arguments.length===2*this.bands.length)for(var n=0;n<arguments.length;n+=2)this.bands[n/2].freq(arguments[n]),this.bands[n/2].gain(arguments[n+1]);else console.error("Argument mismatch. .set() should be called with "+2*this.bands.length+" arguments. (one frequency and gain value pair for each band of the eq)")}},{key:"_newBand",value:function(n,o){return new bi(n,o)}},{key:"dispose",value:function(){if(Le(de(t.prototype),"dispose",this).call(this),this.bands){for(;this.bands.length>0;)this.bands.pop().dispose();delete this.bands}}}]),t}(se),Ci=Ei;function Bt(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}var Ri=function(){function i(t){(function Oi(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")})(this,i),this.ac=a.audiocontext,this.listener=this.ac.listener}return function ki(i,t,e){t&&Bt(i.prototype,t),e&&Bt(i,e)}(i,[{key:"process",value:function(e){e.connect(this.input)}},{key:"position",value:function(e,n,o,u){return this.positionX(e,u),this.positionY(n,u),this.positionZ(o,u),[this.listener.positionX.value,this.listener.positionY.value,this.listener.positionZ.value]}},{key:"positionX",value:function(e,n){var o=n||0;return"number"==typeof e?(this.listener.positionX.value=e,this.listener.positionX.cancelScheduledValues(this.ac.currentTime+.01+o),this.listener.positionX.linearRampToValueAtTime(e,this.ac.currentTime+.02+o)):e&&e.connect(this.listener.positionX),this.listener.positionX.value}},{key:"positionY",value:function(e,n){var o=n||0;return"number"==typeof e?(this.listener.positionY.value=e,this.listener.positionY.cancelScheduledValues(this.ac.currentTime+.01+o),this.listener.positionY.linearRampToValueAtTime(e,this.ac.currentTime+.02+o)):e&&e.connect(this.listener.positionY),this.listener.positionY.value}},{key:"positionZ",value:function(e,n){var o=n||0;return"number"==typeof e?(this.listener.positionZ.value=e,this.listener.positionZ.cancelScheduledValues(this.ac.currentTime+.01+o),this.listener.positionZ.linearRampToValueAtTime(e,this.ac.currentTime+.02+o)):e&&e.connect(this.listener.positionZ),this.listener.positionZ.value}},{key:"orient",value:function(e,n,o,u,d,y,g){return 3===arguments.length||4===arguments.length?this.orientForward(e,n,o,g=arguments[3]):(6===arguments.length||7===arguments)&&(this.orientForward(e,n,o),this.orientUp(u,d,y,g)),[this.listener.forwardX.value,this.listener.forwardY.value,this.listener.forwardZ.value,this.listener.upX.value,this.listener.upY.value,this.listener.upZ.value]}},{key:"orientForward",value:function(e,n,o,u){return this.forwardX(e,u),this.forwardY(n,u),this.forwardZ(o,u),[this.listener.forwardX,this.listener.forwardY,this.listener.forwardZ]}},{key:"orientUp",value:function(e,n,o,u){return this.upX(e,u),this.upY(n,u),this.upZ(o,u),[this.listener.upX,this.listener.upY,this.listener.upZ]}},{key:"forwardX",value:function(e,n){var o=n||0;return"number"==typeof e?(this.listener.forwardX.value=e,this.listener.forwardX.cancelScheduledValues(this.ac.currentTime+.01+o),this.listener.forwardX.linearRampToValueAtTime(e,this.ac.currentTime+.02+o)):e&&e.connect(this.listener.forwardX),this.listener.forwardX.value}},{key:"forwardY",value:function(e,n){var o=n||0;return"number"==typeof e?(this.listener.forwardY.value=e,this.listener.forwardY.cancelScheduledValues(this.ac.currentTime+.01+o),this.listener.forwardY.linearRampToValueAtTime(e,this.ac.currentTime+.02+o)):e&&e.connect(this.listener.forwardY),this.listener.forwardY.value}},{key:"forwardZ",value:function(e,n){var o=n||0;return"number"==typeof e?(this.listener.forwardZ.value=e,this.listener.forwardZ.cancelScheduledValues(this.ac.currentTime+.01+o),this.listener.forwardZ.linearRampToValueAtTime(e,this.ac.currentTime+.02+o)):e&&e.connect(this.listener.forwardZ),this.listener.forwardZ.value}},{key:"upX",value:function(e,n){var o=n||0;return"number"==typeof e?(this.listener.upX.value=e,this.listener.upX.cancelScheduledValues(this.ac.currentTime+.01+o),this.listener.upX.linearRampToValueAtTime(e,this.ac.currentTime+.02+o)):e&&e.connect(this.listener.upX),this.listener.upX.value}},{key:"upY",value:function(e,n){var o=n||0;return"number"==typeof e?(this.listener.upY.value=e,this.listener.upY.cancelScheduledValues(this.ac.currentTime+.01+o),this.listener.upY.linearRampToValueAtTime(e,this.ac.currentTime+.02+o)):e&&e.connect(this.listener.upY),this.listener.upY.value}},{key:"upZ",value:function(e,n){var o=n||0;return"number"==typeof e?(this.listener.upZ.value=e,this.listener.upZ.cancelScheduledValues(this.ac.currentTime+.01+o),this.listener.upZ.linearRampToValueAtTime(e,this.ac.currentTime+.02+o)):e&&e.connect(this.listener.upZ),this.listener.upZ.value}}]),i}(),Di=Ri;function Ue(i){return(Ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(i)}function It(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Ve(i,t,e){return Ve=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(o,u,d){var y=function Fi(i,t){for(;!Object.prototype.hasOwnProperty.call(i,t)&&null!==(i=me(i)););return i}(o,u);if(y){var g=Object.getOwnPropertyDescriptor(y,u);return g.get?g.get.call(d):g.value}},Ve(i,t,e||i)}function me(i){return(me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(i)}function lt(i,t){return(lt=Object.setPrototypeOf||function(n,o){return n.__proto__=o,n})(i,t)}var Vi=function(i){function t(){var e;return function Mi(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function Bi(i,t){return!t||"object"!==Ue(t)&&"function"!=typeof t?function Ii(i){if(void 0===i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}(i):t}(this,me(t).call(this))).panner=e.ac.createPanner(),e.panner.panningModel="HRTF",e.panner.distanceModel="linear",e.panner.connect(e.output),e.input.connect(e.panner),e}return function Li(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),t&&lt(i,t)}(t,i),function Ni(i,t,e){t&&It(i.prototype,t),e&&It(i,e)}(t,[{key:"process",value:function(n){n.connect(this.input)}},{key:"set",value:function(n,o,u,d){return this.positionX(n,d),this.positionY(o,d),this.positionZ(u,d),[this.panner.positionX.value,this.panner.positionY.value,this.panner.positionZ.value]}},{key:"positionX",value:function(n,o){var u=o||0;return"number"==typeof n?(this.panner.positionX.value=n,this.panner.positionX.cancelScheduledValues(this.ac.currentTime+.01+u),this.panner.positionX.linearRampToValueAtTime(n,this.ac.currentTime+.02+u)):n&&n.connect(this.panner.positionX),this.panner.positionX.value}},{key:"positionY",value:function(n,o){var u=o||0;return"number"==typeof n?(this.panner.positionY.value=n,this.panner.positionY.cancelScheduledValues(this.ac.currentTime+.01+u),this.panner.positionY.linearRampToValueAtTime(n,this.ac.currentTime+.02+u)):n&&n.connect(this.panner.positionY),this.panner.positionY.value}},{key:"positionZ",value:function(n,o){var u=o||0;return"number"==typeof n?(this.panner.positionZ.value=n,this.panner.positionZ.cancelScheduledValues(this.ac.currentTime+.01+u),this.panner.positionZ.linearRampToValueAtTime(n,this.ac.currentTime+.02+u)):n&&n.connect(this.panner.positionZ),this.panner.positionZ.value}},{key:"orient",value:function(n,o,u,d){return this.orientX(n,d),this.orientY(o,d),this.orientZ(u,d),[this.panner.orientationX.value,this.panner.orientationY.value,this.panner.orientationZ.value]}},{key:"orientX",value:function(n,o){var u=o||0;return"number"==typeof n?(this.panner.orientationX.value=n,this.panner.orientationX.cancelScheduledValues(this.ac.currentTime+.01+u),this.panner.orientationX.linearRampToValueAtTime(n,this.ac.currentTime+.02+u)):n&&n.connect(this.panner.orientationX),this.panner.orientationX.value}},{key:"orientY",value:function(n,o){var u=o||0;return"number"==typeof n?(this.panner.orientationY.value=n,this.panner.orientationY.cancelScheduledValues(this.ac.currentTime+.01+u),this.panner.orientationY.linearRampToValueAtTime(n,this.ac.currentTime+.02+u)):n&&n.connect(this.panner.orientationY),this.panner.orientationY.value}},{key:"orientZ",value:function(n,o){var u=o||0;return"number"==typeof n?(this.panner.orientationZ.value=n,this.panner.orientationZ.cancelScheduledValues(this.ac.currentTime+.01+u),this.panner.orientationZ.linearRampToValueAtTime(n,this.ac.currentTime+.02+u)):n&&n.connect(this.panner.orientationZ),this.panner.orientationZ.value}},{key:"setFalloff",value:function(n,o){this.maxDist(n),this.rolloff(o)}},{key:"maxDist",value:function(n){return"number"==typeof n&&(this.panner.maxDistance=n),this.panner.maxDistance}},{key:"rolloff",value:function(n){return"number"==typeof n&&(this.panner.rolloffFactor=n),this.panner.rolloffFactor}},{key:"dispose",value:function(){Ve(me(t.prototype),"dispose",this).call(this),this.panner&&(this.panner.disconnect(),delete this.panner)}}]),t}(se);function We(i){return(We="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(i)}function Ft(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function je(i,t,e){return je=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(o,u,d){var y=function Ki(i,t){for(;!Object.prototype.hasOwnProperty.call(i,t)&&null!==(i=ye(i)););return i}(o,u);if(y){var g=Object.getOwnPropertyDescriptor(y,u);return g.get?g.get.call(d):g.value}},je(i,t,e||i)}function ye(i){return(ye=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(i)}function ft(i,t){return(ft=Object.setPrototypeOf||function(n,o){return n.__proto__=o,n})(i,t)}var $i=function(i){function t(){var e;return function Wi(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function qi(i,t){return!t||"object"!==We(t)&&"function"!=typeof t?function Gi(i){if(void 0===i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}(i):t}(this,ye(t).call(this)))._split=e.ac.createChannelSplitter(2),e._merge=e.ac.createChannelMerger(2),e._leftGain=e.ac.createGain(),e._rightGain=e.ac.createGain(),e.leftDelay=e.ac.createDelay(),e.rightDelay=e.ac.createDelay(),e._leftFilter=new Be,e._rightFilter=new Be,e._leftFilter.disconnect(),e._rightFilter.disconnect(),e._leftFilter.biquad.frequency.setValueAtTime(1200,e.ac.currentTime),e._rightFilter.biquad.frequency.setValueAtTime(1200,e.ac.currentTime),e._leftFilter.biquad.Q.setValueAtTime(.3,e.ac.currentTime),e._rightFilter.biquad.Q.setValueAtTime(.3,e.ac.currentTime),e.input.connect(e._split),e.leftDelay.connect(e._leftGain),e.rightDelay.connect(e._rightGain),e._leftGain.connect(e._leftFilter.input),e._rightGain.connect(e._rightFilter.input),e._merge.connect(e.wet),e._leftFilter.biquad.gain.setValueAtTime(1,e.ac.currentTime),e._rightFilter.biquad.gain.setValueAtTime(1,e.ac.currentTime),e.setType(0),e._maxDelay=e.leftDelay.delayTime.maxValue,e.feedback(.5),e}return function Yi(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),t&&ft(i,t)}(t,i),function ji(i,t,e){t&&Ft(i.prototype,t),e&&Ft(i,e)}(t,[{key:"process",value:function(n,o,u,d){var y=u||0,g=o||0;if(y>=1)throw new Error("Feedback value will force a positive feedback loop.");if(g>=this._maxDelay)throw new Error("Delay Time exceeds maximum delay time of "+this._maxDelay+" second.");n.connect(this.input),this.leftDelay.delayTime.setValueAtTime(g,this.ac.currentTime),this.rightDelay.delayTime.setValueAtTime(g,this.ac.currentTime),this._leftGain.gain.value=y,this._rightGain.gain.value=y,d&&(this._leftFilter.freq(d),this._rightFilter.freq(d))}},{key:"delayTime",value:function(n){"number"!=typeof n?(n.connect(this.leftDelay.delayTime),n.connect(this.rightDelay.delayTime)):(this.leftDelay.delayTime.cancelScheduledValues(this.ac.currentTime),this.rightDelay.delayTime.cancelScheduledValues(this.ac.currentTime),this.leftDelay.delayTime.linearRampToValueAtTime(n,this.ac.currentTime),this.rightDelay.delayTime.linearRampToValueAtTime(n,this.ac.currentTime))}},{key:"feedback",value:function(n){if(n&&"number"!=typeof n)n.connect(this._leftGain.gain),n.connect(this._rightGain.gain);else{if(n>=1)throw new Error("Feedback value will force a positive feedback loop.");"number"==typeof n&&(this._leftGain.gain.value=n,this._rightGain.gain.value=n)}return this._leftGain.gain.value}},{key:"filter",value:function(n,o){this._leftFilter.set(n,o),this._rightFilter.set(n,o)}},{key:"setType",value:function(n){"pingPong"===(1===n&&(n="pingPong"),this._split.disconnect(),this._leftFilter.disconnect(),this._rightFilter.disconnect(),this._split.connect(this.leftDelay,0),this._split.connect(this.rightDelay,1),n)?(this._rightFilter.setType(this._leftFilter.biquad.type),this._leftFilter.output.connect(this._merge,0,0),this._rightFilter.output.connect(this._merge,0,1),this._leftFilter.output.connect(this.rightDelay),this._rightFilter.output.connect(this.leftDelay)):(this._leftFilter.output.connect(this._merge,0,0),this._rightFilter.output.connect(this._merge,0,1),this._leftFilter.output.connect(this.leftDelay),this._rightFilter.output.connect(this.rightDelay))}},{key:"dispose",value:function(){je(ye(t.prototype),"dispose",this).call(this),this._split.disconnect(),this._leftFilter.dispose(),this._rightFilter.dispose(),this._merge.disconnect(),this._leftGain.disconnect(),this._rightGain.disconnect(),this.leftDelay.disconnect(),this.rightDelay.disconnect(),this._split=void 0,this._leftFilter=void 0,this._rightFilter=void 0,this._merge=void 0,this._leftGain=void 0,this._rightGain=void 0,this.leftDelay=void 0,this.rightDelay=void 0}}]),t}(se);function qe(i){return(qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(i)}function Lt(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function Ut(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Vt(i,t,e){return t&&Ut(i.prototype,t),e&&Ut(i,e),i}function Wt(i,t){return!t||"object"!==qe(t)&&"function"!=typeof t?function Zi(i){if(void 0===i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}(i):t}function ve(i,t,e){return ve=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(o,u,d){var y=function Xi(i,t){for(;!Object.prototype.hasOwnProperty.call(i,t)&&null!==(i=ce(i)););return i}(o,u);if(y){var g=Object.getOwnPropertyDescriptor(y,u);return g.get?g.get.call(d):g.value}},ve(i,t,e||i)}function ce(i){return(ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(i)}function jt(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),t&&ht(i,t)}function ht(i,t){return(ht=Object.setPrototypeOf||function(n,o){return n.__proto__=o,n})(i,t)}var qt=function(i){function t(){var e;return Lt(this,t),(e=Wt(this,ce(t).call(this)))._initConvolverNode(),e.input.gain.value=.5,e._seconds=3,e._decay=2,e._reverse=!1,e._buildImpulse(),e}return jt(t,i),Vt(t,[{key:"_initConvolverNode",value:function(){this.convolverNode=this.ac.createConvolver(),this.input.connect(this.convolverNode),this.convolverNode.connect(this.wet)}},{key:"_teardownConvolverNode",value:function(){this.convolverNode&&(this.convolverNode.disconnect(),delete this.convolverNode)}},{key:"_setBuffer",value:function(n){this._teardownConvolverNode(),this._initConvolverNode(),this.convolverNode.buffer=n}},{key:"process",value:function(n,o,u,d){n.connect(this.input);var y=!1;o&&(this._seconds=o,y=!0),u&&(this._decay=u),d&&(this._reverse=d),y&&this._buildImpulse()}},{key:"set",value:function(n,o,u){var d=!1;n&&(this._seconds=n,d=!0),o&&(this._decay=o),u&&(this._reverse=u),d&&this._buildImpulse()}},{key:"_buildImpulse",value:function(){var C,O,n=this.ac.sampleRate,o=n*this._seconds,u=this._decay,d=this.ac.createBuffer(2,o,n),y=d.getChannelData(0),g=d.getChannelData(1);for(O=0;O<o;O++)C=this._reverse?o-O:O,y[O]=(2*Math.random()-1)*Math.pow(1-C/o,u),g[O]=(2*Math.random()-1)*Math.pow(1-C/o,u);this._setBuffer(d)}},{key:"dispose",value:function(){ve(ce(t.prototype),"dispose",this).call(this),this._teardownConvolverNode()}}]),t}(se),Gt=function(i){function t(e,n,o){var u;return Lt(this,t),(u=Wt(this,ce(t).call(this)))._initConvolverNode(),u.input.gain.value=.5,e?(u.impulses=[],u._loadBuffer(e,n,o)):(u._seconds=3,u._decay=2,u._reverse=!1,u._buildImpulse()),u.impulses=[],u.set=null,u}return jt(t,i),Vt(t,[{key:"_loadBuffer",value:function(n,o,u){var d=p5.prototype._checkFileFormats(n),y=this,g=(new Error).stack,C=Object(s.b)(),O=new XMLHttpRequest;O.open("GET",d,!0),O.responseType="arraybuffer",O.onload=function(){if(200===O.status)C.decodeAudioData(O.response,function(X){var Q={},ie=d.split("/");Q.name=ie[ie.length-1],Q.audioBuffer=X,y.impulses.push(Q),y._setBuffer(Q.audioBuffer),o&&o(Q)},function(){var X=new U("decodeAudioData",g,y.url),Q="AudioContext error at decodeAudioData for "+y.url;u?(X.msg=Q,u(X)):console.error(Q+"\n The error stack trace includes: \n"+X.stack)});else{var L=new U("loadConvolver",g,y.url),ee="Unable to load "+y.url+". The request status was: "+O.status+" ("+O.statusText+")";u?(L.message=ee,u(L)):console.error(ee+"\n The error stack trace includes: \n"+L.stack)}},O.onerror=function(){var L=new U("loadConvolver",g,y.url),ee="There was no response from the server at "+y.url+". Check the url and internet connectivity.";u?(L.message=ee,u(L)):console.error(ee+"\n The error stack trace includes: \n"+L.stack)},O.send()}},{key:"process",value:function(n){n.connect(this.input)}},{key:"addImpulse",value:function(n,o,u){window.location.origin.indexOf("file://")>-1&&"undefined"===window.cordova&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS"),this._loadBuffer(n,o,u)}},{key:"resetImpulse",value:function(n,o,u){window.location.origin.indexOf("file://")>-1&&"undefined"===window.cordova&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS"),this.impulses=[],this._loadBuffer(n,o,u)}},{key:"toggleImpulse",value:function(n){if("number"==typeof n&&n<this.impulses.length&&this._setBuffer(this.impulses[n].audioBuffer),"string"==typeof n)for(var o=0;o<this.impulses.length;o++)if(this.impulses[o].name===n){this._setBuffer(this.impulses[o].audioBuffer);break}}},{key:"dispose",value:function(){for(var n in ve(ce(t.prototype),"dispose",this).call(this),this.impulses)this.impulses[n]&&(this.impulses[n]=null)}}]),t}(qt),Qi=f(11),Kt=f.n(Qi);function Yt(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}var tr=function(){function i(){(function Ji(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")})(this,i),this.clock=new Kt.a({callback:this.ontick.bind(this)}),this.syncedParts=[],this.bpm=120,this._init(),this.prevTick=0,this.tatumTime=0,this.tickCallback=function(){}}return function er(i,t,e){t&&Yt(i.prototype,t),e&&Yt(i,e)}(i,[{key:"ontick",value:function(e){var o=e-a.audiocontext.currentTime;if(!(e-this.prevTick-this.tatumTime<=-.02)){this.prevTick=e;var u=this;this.syncedParts.forEach(function(d){d.isPlaying&&(d.incrementStep(o),d.phrases.forEach(function(y){var g=y.sequence,C=u.metroTicks%g.length;0!==g[C]&&(u.metroTicks<g.length||!y.looping)&&y.callback(o,g[C])}))}),this.metroTicks+=1,this.tickCallback(o)}}},{key:"setBPM",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=a.audiocontext.currentTime;this.tatumTime=60/(e*this.tatums),this.clock.frequency.setValueAtTime(this.clock.frequency.value,u),this.clock.frequency.linearRampToValueAtTime(e,u+n),this.bpm=e}},{key:"getBPM",value:function(){return this.clock.getRate()/this.tatums*60}},{key:"_init",value:function(){this.metroTicks=0}},{key:"resetSync",value:function(e){this.syncedParts=[e]}},{key:"pushSync",value:function(e){this.syncedParts.push(e)}},{key:"start",value:function(e){this.clock.start(a.audiocontext.currentTime+(e||0)),this.setBPM(this.bpm)}},{key:"stop",value:function(e){this.clock.stop(a.audiocontext.currentTime+(e||0))}},{key:"beatLength",value:function(e){this.tatums=1/e/4}}]),i}(),zt=tr;function $t(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Zt(i,t,e){return t&&$t(i.prototype,t),e&&$t(i,e),i}function pt(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var Xt=120;p5.prototype.setBPM=function(i,t){for(var e in Xt=i,a.parts)a.parts[e]&&a.parts[e].setBPM(i,t)};var dt=function i(t,e,n){pt(this,i),this.phraseStep=0,this.name=t,this.callback=e,this.sequence=n},nr=function(){function i(t,e){pt(this,i),this.length=t||0,this.partStep=0,this.phrases=[],this.isPlaying=!1,this.noLoop(),this.tatums=e||.0625,this.metro=new zt,this.metro._init(),this.metro.beatLength(this.tatums),this.metro.setBPM(Xt),a.parts.push(this),this.callback=function(){}}return Zt(i,[{key:"setBPM",value:function(e,n){this.metro.setBPM(e,n)}},{key:"getBPM",value:function(){return this.metro.getBPM()}},{key:"start",value:function(e){this.isPlaying||(this.isPlaying=!0,this.metro.resetSync(this),this.metro.start(e||0))}},{key:"loop",value:function(e){this.looping=!0,this.onended=function(){this.partStep=0},this.start(e||0)}},{key:"noLoop",value:function(){this.looping=!1,this.onended=function(){this.stop()}}},{key:"stop",value:function(e){this.partStep=0,this.pause(e)}},{key:"pause",value:function(e){this.isPlaying=!1,this.metro.stop(e||0)}},{key:"addPhrase",value:function(e,n,o){var u;if(3===arguments.length)u=new dt(e,n,o);else{if(!(arguments[0]instanceof dt))throw"invalid input. addPhrase accepts name, callback, array or a p5.Phrase";u=arguments[0]}this.phrases.push(u),u.sequence.length>this.length&&(this.length=u.sequence.length)}},{key:"removePhrase",value:function(e){for(var n in this.phrases)this.phrases[n].name===e&&this.phrases.splice(n,1)}},{key:"getPhrase",value:function(e){for(var n in this.phrases)if(this.phrases[n].name===e)return this.phrases[n]}},{key:"replaceSequence",value:function(e,n){for(var o in this.phrases)this.phrases[o].name===e&&(this.phrases[o].sequence=n)}},{key:"incrementStep",value:function(e){this.partStep<this.length-1?(this.callback(e),this.partStep+=1):!this.looping&&this.partStep===this.length-1&&this.onended()}},{key:"onStep",value:function(e){this.callback=e}}]),i}(),ir=function(){function i(){pt(this,i),this.parts=[],this.currentPart=new Array(arguments.length);var t=this;for(var e in arguments)this.parts[e]=arguments[e],this.parts[e].nextPart=this.parts[e+1],this.parts[e].onended=function(){t.resetPart(e),rr(t)};this.looping=!1}return Zt(i,[{key:"onended",value:function(){this.looping?this.parts[0].start():this.parts[this.parts.length-1].onended=function(){this.stop(),this.resetParts()},this.currentPart=0}},{key:"start",value:function(){this.parts[this.currentPart].start(),this.scoreStep=0}},{key:"stop",value:function(){this.parts[this.currentPart].stop(),this.currentPart=0,this.scoreStep=0}},{key:"pause",value:function(){this.parts[this.currentPart].stop()}},{key:"loop",value:function(){this.looping=!0,this.start()}},{key:"noLoop",value:function(){this.looping=!1}},{key:"resetParts",value:function(){this.parts.forEach(function(n){})}},{key:"resetPart",value:function(e){for(var n in this.parts[e].stop(),this.parts[e].partStep=0,this.parts[e].phrases)this.parts[e]&&(this.parts[e].phrases[n].phraseStep=0)}},{key:"setBPM",value:function(e,n){for(var o in this.parts)this.parts[o]&&this.parts[o].setBPM(e,n)}}]),i}();function rr(i){i.currentPart++,i.currentPart>=i.parts.length?(i.scoreStep=0,i.onended()):(i.scoreStep=0,i.parts[i.currentPart-1].stop(),i.parts[i.currentPart].start())}function Ht(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}var ur=function(){function i(t,e){(function or(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")})(this,i),Object.defineProperty(this,"bpm",{get:function(){return this._bpm},set:function(u){this.musicalTimeMode||console.warn('Changing the BPM in "seconds" mode has no effect. BPM is only relevant in musicalTimeMode when the interval is specified as a string ("2n", "4n", "1m"...etc)'),this._bpm=u,this._update()}}),Object.defineProperty(this,"timeSignature",{get:function(){return this._timeSignature},set:function(u){this.musicalTimeMode||console.warn('Changing the timeSignature in "seconds" mode has no effect. BPM is only relevant in musicalTimeMode when the interval is specified as a string ("2n", "4n", "1m"...etc)'),this._timeSignature=u,this._update()}}),Object.defineProperty(this,"interval",{get:function(){return this._interval},set:function(u){this.musicalTimeMode="number"!=typeof u,this._interval=u,this._update()}}),Object.defineProperty(this,"iterations",{get:function(){return this.clock.ticks}}),this.callback=t,this.musicalTimeMode="number"!=typeof this._interval,this._interval=e||1,this._timeSignature=4,this._bpm=60,this.isPlaying=!1,this.maxIterations=1/0;var n=this;this.clock=new Kt.a({callback:function(u){var d=u-a.audiocontext.currentTime;d>0&&n.iterations<=n.maxIterations&&n.callback(d)},frequency:this._calcFreq()})}return function sr(i,t,e){t&&Ht(i.prototype,t),e&&Ht(i,e)}(i,[{key:"start",value:function(e){this.isPlaying||(this.clock.start(a.audiocontext.currentTime+(e||0)),this.isPlaying=!0)}},{key:"stop",value:function(e){this.isPlaying&&(this.clock.stop(a.audiocontext.currentTime+(e||0)),this.isPlaying=!1)}},{key:"pause",value:function(e){this.isPlaying&&(this.clock.pause(a.audiocontext.currentTime+(e||0)),this.isPlaying=!1)}},{key:"syncedStart",value:function(e,n){var o=n||0,u=a.audiocontext.currentTime;e.isPlaying?e.isPlaying&&(this.clock.start(u+(e.clock._nextTick-a.audiocontext.currentTime)),this.isPlaying=!0):(e.clock.start(u+o),e.isPlaying=!0,this.clock.start(u+o),this.isPlaying=!0)}},{key:"_update",value:function(){this.clock.frequency.value=this._calcFreq()}},{key:"_calcFreq",value:function(){return"number"==typeof this._interval?(this.musicalTimeMode=!1,1/this._interval):"string"==typeof this._interval?(this.musicalTimeMode=!0,this._bpm/60/this._convertNotation(this._interval)*(this._timeSignature/4)):void 0}},{key:"_convertNotation",value:function(e){var n=e.slice(-1);switch(e=Number(e.slice(0,-1)),n){case"m":return this._measure(e);case"n":return this._note(e);default:console.warn("Specified interval is not formatted correctly. See Tone.js timing reference for more info: https://github.com/Tonejs/Tone.js/wiki/Time")}}},{key:"_measure",value:function(e){return e*this._timeSignature}},{key:"_note",value:function(e){return this._timeSignature/e}}]),i}();function Ge(i){return(Ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(i)}function Qt(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Ke(i,t,e){return Ke=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(o,u,d){var y=function pr(i,t){for(;!Object.prototype.hasOwnProperty.call(i,t)&&null!==(i=_e(i)););return i}(o,u);if(y){var g=Object.getOwnPropertyDescriptor(y,u);return g.get?g.get.call(d):g.value}},Ke(i,t,e||i)}function _e(i){return(_e=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(i)}function mt(i,t){return(mt=Object.setPrototypeOf||function(n,o){return n.__proto__=o,n})(i,t)}var yr=function(i){function t(){var e;return function cr(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function fr(i,t){return!t||"object"!==Ge(t)&&"function"!=typeof t?function hr(i){if(void 0===i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}(i):t}(this,_e(t).call(this))).compressor=e.ac.createDynamicsCompressor(),e.input.connect(e.compressor),e.compressor.connect(e.wet),e}return function dr(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),t&&mt(i,t)}(t,i),function lr(i,t,e){t&&Qt(i.prototype,t),e&&Qt(i,e)}(t,[{key:"process",value:function(n,o,u,d,y,g){n.connect(this.input),this.set(o,u,d,y,g)}},{key:"set",value:function(n,o,u,d,y){typeof n<"u"&&this.attack(n),typeof o<"u"&&this.knee(o),typeof u<"u"&&this.ratio(u),typeof d<"u"&&this.threshold(d),typeof y<"u"&&this.release(y)}},{key:"attack",value:function(n,o){var u=o||0;return"number"==typeof n?(this.compressor.attack.value=n,this.compressor.attack.cancelScheduledValues(this.ac.currentTime+.01+u),this.compressor.attack.linearRampToValueAtTime(n,this.ac.currentTime+.02+u)):typeof n<"u"&&n.connect(this.compressor.attack),this.compressor.attack.value}},{key:"knee",value:function(n,o){var u=o||0;return"number"==typeof n?(this.compressor.knee.value=n,this.compressor.knee.cancelScheduledValues(this.ac.currentTime+.01+u),this.compressor.knee.linearRampToValueAtTime(n,this.ac.currentTime+.02+u)):typeof n<"u"&&n.connect(this.compressor.knee),this.compressor.knee.value}},{key:"ratio",value:function(n,o){var u=o||0;return"number"==typeof n?(this.compressor.ratio.value=n,this.compressor.ratio.cancelScheduledValues(this.ac.currentTime+.01+u),this.compressor.ratio.linearRampToValueAtTime(n,this.ac.currentTime+.02+u)):typeof n<"u"&&n.connect(this.compressor.ratio),this.compressor.ratio.value}},{key:"threshold",value:function(n,o){var u=o||0;return"number"==typeof n?(this.compressor.threshold.value=n,this.compressor.threshold.cancelScheduledValues(this.ac.currentTime+.01+u),this.compressor.threshold.linearRampToValueAtTime(n,this.ac.currentTime+.02+u)):typeof n<"u"&&n.connect(this.compressor.threshold),this.compressor.threshold.value}},{key:"release",value:function(n,o){var u=o||0;return"number"==typeof n?(this.compressor.release.value=n,this.compressor.release.cancelScheduledValues(this.ac.currentTime+.01+u),this.compressor.release.linearRampToValueAtTime(n,this.ac.currentTime+.02+u)):typeof number<"u"&&n.connect(this.compressor.release),this.compressor.release.value}},{key:"reduction",value:function(){return this.compressor.reduction.value}},{key:"dispose",value:function(){Ke(_e(t.prototype),"dispose",this).call(this),this.compressor&&(this.compressor.disconnect(),delete this.compressor)}}]),t}(se);function Jt(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}var en=function(){function i(t,e,n,o){(function vr(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")})(this,i),this.framesPerPeak=o||20,this.framesSinceLastPeak=0,this.decayRate=.95,this.threshold=n||.35,this.cutoff=0,this.cutoffMult=1.5,this.energy=0,this.penergy=0,this.currentValue=0,this.isDetected=!1,this.f1=t||40,this.f2=e||2e4,this._onPeak=function(){}}return function _r(i,t,e){t&&Jt(i.prototype,t),e&&Jt(i,e)}(i,[{key:"update",value:function(e){var n=this.energy=e.getEnergy(this.f1,this.f2)/255;n>this.cutoff&&n>this.threshold&&n-this.penergy>0?(this._onPeak(),this.isDetected=!0,this.cutoff=n*this.cutoffMult,this.framesSinceLastPeak=0):(this.isDetected=!1,this.framesSinceLastPeak<=this.framesPerPeak?this.framesSinceLastPeak++:(this.cutoff*=this.decayRate,this.cutoff=Math.max(this.cutoff,this.threshold))),this.currentValue=n,this.penergy=n}},{key:"onPeak",value:function(e,n){var o=this;o._onPeak=function(){e(o.energy,n)}}}]),i}();function tn(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}var Ye=a.audiocontext,wr=function(){function i(){(function br(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")})(this,i),this.input=Ye.createGain(),this.output=Ye.createGain(),this._inputChannels=2,this._outputChannels=2;var t=E(1024);this._workletNode=new AudioWorkletNode(Ye,m.a.recorderProcessor,{outputChannelCount:[this._outputChannels],processorOptions:{numInputChannels:this._inputChannels,bufferSize:t}}),this._workletNode.port.onmessage=function(e){if("buffers"===e.data.name){var n=[new Float32Array(e.data.leftBuffer),new Float32Array(e.data.rightBuffer)];this._callback(n)}}.bind(this),this._callback=function(){},this._workletNode.connect(p5.soundOut._silentNode),this.setInput(),a.soundArray.push(this)}return function Tr(i,t,e){t&&tn(i.prototype,t),e&&tn(i,e)}(i,[{key:"setInput",value:function(e){this.input.disconnect(),this.input=null,this.input=Ye.createGain(),this.input.connect(this._workletNode),this.input.connect(this.output),e?e.connect(this.input):p5.soundOut.output.connect(this.input)}},{key:"record",value:function(e,n,o){this._workletNode.port.postMessage({name:"start",duration:n}),e&&o?this._callback=function(u){e.setBuffer(u),o()}:e&&(this._callback=function(u){e.setBuffer(u)})}},{key:"stop",value:function(){this._workletNode.port.postMessage({name:"stop"})}},{key:"dispose",value:function(){var e=a.soundArray.indexOf(this);a.soundArray.splice(e,1),this._callback=function(){},this.input&&this.input.disconnect(),this.input=null,this._workletNode=null}}]),i}();function ze(i){return(ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(i)}function nn(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function $e(i,t,e){return $e=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(o,u,d){var y=function Cr(i,t){for(;!Object.prototype.hasOwnProperty.call(i,t)&&null!==(i=ge(i)););return i}(o,u);if(y){var g=Object.getOwnPropertyDescriptor(y,u);return g.get?g.get.call(d):g.value}},$e(i,t,e||i)}function ge(i){return(ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(i)}function yt(i,t){return(yt=Object.setPrototypeOf||function(n,o){return n.__proto__=o,n})(i,t)}function rn(i){for(var d,t="number"==typeof i?i:50,e=44100,n=new Float32Array(e),o=Math.PI/180,u=0;u<e;++u)n[u]=(3+t)*(d=2*u/e-1)*20*o/(Math.PI+t*Math.abs(d));return n}var Rr=function(i){function t(e,n){var o;if(function Ar(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=function xr(i,t){return!t||"object"!==ze(t)&&"function"!=typeof t?function Er(i){if(void 0===i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}(i):t}(this,ge(t).call(this)),typeof e>"u"&&(e=.25),"number"!=typeof e)throw new Error("amount must be a number");if(typeof n>"u"&&(n="2x"),"string"!=typeof n)throw new Error("oversample must be a String");var u=p5.prototype.map(e,0,1,0,2e3);return o.waveShaperNode=o.ac.createWaveShaper(),o.amount=u,o.waveShaperNode.curve=rn(u),o.waveShaperNode.oversample=n,o.input.connect(o.waveShaperNode),o.waveShaperNode.connect(o.wet),o}return function Or(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),t&&yt(i,t)}(t,i),function Pr(i,t,e){t&&nn(i.prototype,t),e&&nn(i,e)}(t,[{key:"process",value:function(n,o,u){n.connect(this.input),this.set(o,u)}},{key:"set",value:function(n,o){if(n){var u=p5.prototype.map(n,0,1,0,2e3);this.amount=u,this.waveShaperNode.curve=rn(u)}o&&(this.waveShaperNode.oversample=o)}},{key:"getAmount",value:function(){return this.amount}},{key:"getOversample",value:function(){return this.waveShaperNode.oversample}},{key:"dispose",value:function(){$e(ge(t.prototype),"dispose",this).call(this),this.waveShaperNode&&(this.waveShaperNode.disconnect(),this.waveShaperNode=null)}}]),t}(se);function on(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}var Nr=function(){function i(){(function Dr(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")})(this,i),this.ac=a.audiocontext,this.input=this.ac.createGain(),this.output=this.ac.createGain(),this.input.gain.value=.5,this.input.connect(this.output),a.soundArray.push(this)}return function Mr(i,t,e){t&&on(i.prototype,t),e&&on(i,e)}(i,[{key:"setInput",value:function(e){e.connect(this.input)}},{key:"connect",value:function(e){var n=e||p5.soundOut.input;this.output.connect(n.input?n.input:n)}},{key:"disconnect",value:function(){this.output&&this.output.disconnect()}},{key:"amp",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,u=a.audiocontext.currentTime,d=this.output.gain.value;this.output.gain.cancelScheduledValues(u),this.output.gain.linearRampToValueAtTime(d,u+o),this.output.gain.linearRampToValueAtTime(e,u+o+n)}},{key:"dispose",value:function(){var e=a.soundArray.indexOf(this);a.soundArray.splice(e,1),this.output&&(this.output.disconnect(),delete this.output),this.input&&(this.input.disconnect(),delete this.input)}}]),i}(),Br=Nr;function sn(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}var an=function(){function i(){(function Ir(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")})(this,i),this.ac=a.audiocontext,this.output=this.ac.createGain(),this.connect(),a.soundArray.push(this)}return function Fr(i,t,e){t&&sn(i.prototype,t),e&&sn(i,e)}(i,[{key:"play",value:function(e,n,o,u){}},{key:"triggerAttack",value:function(e,n,o){}},{key:"triggerRelease",value:function(e){}},{key:"amp",value:function(e,n){}},{key:"connect",value:function(e){var n=e||a.input;this.output.connect(n.input?n.input:n)}},{key:"disconnect",value:function(){this.output.disconnect()}},{key:"dispose",value:function(){this.output&&(this.output.disconnect(),delete this.output)}}]),i}();function Ze(i){return(Ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(i)}function un(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function vt(i){if(void 0===i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function Xe(i,t,e){return Xe=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(o,u,d){var y=function jr(i,t){for(;!Object.prototype.hasOwnProperty.call(i,t)&&null!==(i=be(i)););return i}(o,u);if(y){var g=Object.getOwnPropertyDescriptor(y,u);return g.get?g.get.call(d):g.value}},Xe(i,t,e||i)}function be(i){return(be=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(i)}function _t(i,t){return(_t=Object.setPrototypeOf||function(n,o){return n.__proto__=o,n})(i,t)}var Kr=function(i){function t(){var e;return function Ur(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=function Wr(i,t){return!t||"object"!==Ze(t)&&"function"!=typeof t?vt(i):t}(this,be(t).call(this)),e.oscillator=new xe,e.env=new In,e.env.setRange(1,0),e.env.setExp(!0),e.setADSR(.02,.25,.05,.35),e.oscillator.disconnect(),e.oscillator.connect(e.output),e.env.disconnect(),e.env.setInput(e.output.gain),e.oscillator.output.gain.value=1,e.oscillator.start(),e.connect(),a.soundArray.push(vt(e)),Object.defineProperties(vt(e),{attack:{get:function(){return this.env.aTime},set:function(o){this.env.setADSR(o,this.env.dTime,this.env.sPercent,this.env.rTime)}},decay:{get:function(){return this.env.dTime},set:function(o){this.env.setADSR(this.env.aTime,o,this.env.sPercent,this.env.rTime)}},sustain:{get:function(){return this.env.sPercent},set:function(o){this.env.setADSR(this.env.aTime,this.env.dTime,o,this.env.rTime)}},release:{get:function(){return this.env.rTime},set:function(o){this.env.setADSR(this.env.aTime,this.env.dTime,this.env.sPercent,o)}}}),e}return function qr(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),t&&_t(i,t)}(t,i),function Vr(i,t,e){t&&un(i.prototype,t),e&&un(i,e)}(t,[{key:"play",value:function(n,o,u,d){this.triggerAttack(n,o,~~u),this.triggerRelease(~~u+(d||.15))}},{key:"triggerAttack",value:function(n,o){var u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=I(n),y=o||.1;this.oscillator.freq(d,0,u),this.env.ramp(this.output.gain,u,y)}},{key:"triggerRelease",value:function(){this.env.ramp(this.output.gain,arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,0)}},{key:"setADSR",value:function(n,o,u,d){this.env.setADSR(n,o,u,d)}},{key:"amp",value:function(n,o){return typeof n<"u"&&this.oscillator.amp(n,o||0),this.oscillator.amp().value}},{key:"connect",value:function(n){var o=n||a.input;this.output.connect(o.input?o.input:o)}},{key:"disconnect",value:function(){this.output&&this.output.disconnect()}},{key:"dispose",value:function(){Xe(be(t.prototype),"dispose",this).call(this),this.env&&this.env.dispose(),this.oscillator&&this.oscillator.dispose()}}]),t}(an),Yr=Kr;function cn(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}var Xr=function(){function i(t,e,n,o){(function zr(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")})(this,i),this.isDetected=!1,this.freqLow=t,this.freqHigh=e,this.treshold=n,this.energy=0,this.penergy=0,this.sensitivity=500,this.callback=o}return function $r(i,t,e){t&&cn(i.prototype,t),e&&cn(i,e)}(i,[{key:"update",value:function(e,n){if(this.energy=e.getEnergy(this.freqLow,this.freqHigh)/255,!1===this.isDetected&&this.energy-this.penergy>this.treshold){this.isDetected=!0,this.callback?this.callback(this.energy):n&&n(this.energy);var o=this;setTimeout(function(){o.isDetected=!1},this.sensitivity)}this.penergy=this.energy}}]),i}();function ln(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}var Jr=function(){function i(t,e){(function Hr(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")})(this,i),this.audiovoices=[],this.notes={},this._newest=0,this._oldest=0,this.maxVoices=e||8,this.AudioVoice=void 0===t?p5.MonoSynth:t,this._voicesInUse=new et.a(0),this.output=a.audiocontext.createGain(),this.connect(),this._allocateVoices(),a.soundArray.push(this)}return function Qr(i,t,e){t&&ln(i.prototype,t),e&&ln(i,e)}(i,[{key:"_allocateVoices",value:function(){for(var e=0;e<this.maxVoices;e++)this.audiovoices.push(new this.AudioVoice),this.audiovoices[e].disconnect(),this.audiovoices[e].connect(this.output)}},{key:"play",value:function(e,n,o){var u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.noteAttack(e,n,o),this.noteRelease(e,o+u)}},{key:"noteADSR",value:function(e,n,o,u,d){this.audiovoices[this.notes[e].getValueAtTime(a.audiocontext.currentTime+(arguments.length>5&&void 0!==arguments[5]?arguments[5]:0))].setADSR(n,o,u,d)}},{key:"setADSR",value:function(e,n,o,u){this.audiovoices.forEach(function(d){d.setADSR(e,n,o,u)})}},{key:"noteAttack",value:function(e,n){var g,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,u=a.audiocontext.currentTime+o,d=I(e),y=n||.1;this.notes[d]&&null!==this.notes[d].getValueAtTime(u)&&this.noteRelease(d,0),this._voicesInUse.getValueAtTime(u)<this.maxVoices?g=Math.max(~~this._voicesInUse.getValueAtTime(u),0):(g=this._oldest,oldestNote=k(this.audiovoices[this._oldest].oscillator.freq().value),this.noteRelease(oldestNote),this._oldest=(this._oldest+1)%(this.maxVoices-1)),this.notes[d]=new et.a,this.notes[d].setValueAtTime(g,u);var C=null===this._voicesInUse._searchBefore(u)?0:this._voicesInUse._searchBefore(u).value;if(this._voicesInUse.setValueAtTime(C+1,u),this._updateAfter(u,1),this._newest=g,"number"==typeof y){var O=1/this._voicesInUse.getValueAtTime(u)*2;y=y>O?O:y}this.audiovoices[g].triggerAttack(d,y,o)}},{key:"_updateAfter",value:function(e,n){if(null!==this._voicesInUse._searchAfter(e)){this._voicesInUse._searchAfter(e).value+=n;var o=this._voicesInUse._searchAfter(e).time;this._updateAfter(o,n)}}},{key:"noteRelease",value:function(e,n){var u=n||0,d=a.audiocontext.currentTime+u;if(e){var g=I(e);if(this.notes[g]&&null!==this.notes[g].getValueAtTime(d)){var C=Math.max(~~this._voicesInUse.getValueAtTime(d).value,1);this._voicesInUse.setValueAtTime(C-1,d),C>0&&this._updateAfter(d,-1),this.audiovoices[this.notes[g].getValueAtTime(d)].triggerRelease(u),this.notes[g].dispose(),delete this.notes[g],this._newest=0===this._newest?0:(this._newest-1)%(this.maxVoices-1)}else console.warn("Cannot release a note that is not already playing")}else for(var y in this.audiovoices.forEach(function(O){O.triggerRelease(u)}),this._voicesInUse.setValueAtTime(0,d),this.notes)this.notes[y].dispose(),delete this.notes[y]}},{key:"connect",value:function(e){var n=e||a.input;this.output.connect(n.input?n.input:n)}},{key:"disconnect",value:function(){this.output&&this.output.disconnect()}},{key:"dispose",value:function(){this.audiovoices.forEach(function(e){e.dispose()}),this.output&&(this.output.disconnect(),delete this.output)}}]),i}(),eo=Jr;p5.prototype.getAudioContext=s.b,p5.prototype.userStartAudio=s.c,p5.prototype.sampleRate=function S(){return a.audiocontext.sampleRate},p5.prototype.freqToMidi=k,p5.prototype.midiToFreq=x,p5.prototype.noteToFreq=I,p5.prototype.soundFormats=function R(){a.extensions=[];for(var i=0;i<arguments.length;i++){if(arguments[i]=arguments[i].toLowerCase(),!(["mp3","wav","ogg","m4a","aac"].indexOf(arguments[i])>-1))throw arguments[i]+" is not a valid sound format!";a.extensions.push(arguments[i])}},p5.prototype.disposeSound=function V(){for(var i=0;i<a.soundArray.length;i++)a.soundArray[i].dispose()},p5.prototype._checkFileFormats=function N(i){var t;if("string"==typeof i){var e=(t=i).split(".").pop();if(["mp3","wav","ogg","m4a","aac"].indexOf(e)>-1){if(!p5.prototype.isFileSupported(e))for(var n=t.split("."),o=n[n.length-1],u=0;u<a.extensions.length;u++){var d=a.extensions[u];if(p5.prototype.isFileSupported(d)){o="",2===n.length&&(o+=n[0]);for(var g=1;g<=n.length-2;g++)o+="."+n[g];t=o+=".",t=t+=d;break}}}else for(var O=0;O<a.extensions.length;O++){var L=a.extensions[O];if(p5.prototype.isFileSupported(L)){t=t+"."+L;break}}}else if("object"===T(i))for(var X=0;X<i.length;X++){var Q=i[X].split(".").pop();if(p5.prototype.isFileSupported(Q)){t=i[X];break}}return t},p5.prototype._mathChain=function $(i,t,e,n,o){for(var u in i.mathOps)i.mathOps[u]instanceof o&&(i.mathOps[u].dispose(),(e=u)<i.mathOps.length-1&&(n=i.mathOps[u+1]));return i.mathOps[e-1].disconnect(),i.mathOps[e-1].connect(t),t.connect(n),i.mathOps[e]=t,i},p5.prototype.convertToWav=j,p5.prototype.interleave=b,p5.prototype.writeUTFBytes=v,p5.prototype.safeBufferSize=E,p5.prototype.saveSound=function B(i,t){var e=j(i.buffer);p5.prototype.writeFile([e],t,"wav")},p5.prototype.registerMethod("remove",p5.prototype.disposeSound),p5.Panner=ne,p5.SoundFile=dn,p5.prototype.loadSound=function pn(i,t,e,n){window.location.origin.indexOf("file://")>-1&&"undefined"===window.cordova&&window.alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS");var o=this,u=new gt(i,function(){"function"==typeof t&&t.apply(o,arguments),"function"==typeof o._decrementPreload&&o._decrementPreload()},e,n);return u},p5.prototype.registerPreloadMethod("loadSound",p5.prototype),p5.Amplitude=Tt,p5.FFT=Pn,p5.Oscillator=xe,p5.SinOsc=Rn,p5.TriOsc=Dn,p5.SawOsc=At,p5.SqrOsc=Mn,p5.Noise=qn,p5.Pulse=Qn,p5.AudioIn=ni,p5.Effect=se,p5.Filter=Be,p5.LowPass=fi,p5.HighPass=hi,p5.BandPass=pi,p5.EQ=Ci,p5.listener3D=Di,p5.Panner3D=Vi,p5.Delay=$i,p5.Reverb=qt,p5.Convolver=Gt,p5.prototype.createConvolver=function Hi(i,t,e){window.location.origin.indexOf("file://")>-1&&"undefined"===window.cordova&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS");var n=this,o=new Gt(i,function(u){"function"==typeof t&&t(u),"function"==typeof n._decrementPreload&&n._decrementPreload()},e);return o.impulses=[],o},p5.prototype.registerPreloadMethod("createConvolver",p5.prototype),p5.Metro=zt,p5.Phrase=dt,p5.Part=nr,p5.Score=ir,p5.SoundLoop=ur,p5.Compressor=yr,p5.peakDetect=en,p5.SoundRecorder=wr,p5.Distortion=Rr,p5.Gain=Br,p5.AudioVoice=an,p5.MonoSynth=Yr,p5.OnsetDetect=Xr,p5.PolySynth=eo,p5.PeakDetect=en,p5.Signal=function i(){(function to(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")})(this,i),console.warn("p5.Signal is deprecated , Use Tone.js Signal instead ")}}])}}]);