"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[774],{774:(H,Z,h)=>{h.d(Z,{B:()=>ae});var n=h(655),_=h(3996),g=h(5016),T=h(6505),A=h(549),U=h(3260),e=h(9863),M=h(3496),V=h(5742),x=h(4433),y=h(3336),c=h(6690),b=h(1282),O=h(9912),F=h(4299),R=h(9808);function Y(o,m){if(1&o){const t=e.EpF();e.TgZ(0,"ion-icon",16),e.NdJ("click",function(){return e.CHM(t),e.oxw().ChangeToAnother(-1)}),e.qZA()}}function S(o,m){if(1&o&&(e.TgZ(0,"ion-label",17),e._uU(1),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Oqu(t.RelevanceIndex+" / "+t.Relevances.length)}}function $(o,m){if(1&o){const t=e.EpF();e.TgZ(0,"ion-icon",18),e.NdJ("click",function(){return e.CHM(t),e.oxw().ChangeToAnother(1)}),e.qZA()}}function q(o,m){if(1&o){const t=e.EpF();e.TgZ(0,"ion-item",21),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).modify_image()}),e.TgZ(1,"ion-label"),e._uU(2),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(2),e.Oqu(t.lang.text.ContentViewer.Edit)}}function j(o,m){if(1&o){const t=e.EpF();e.TgZ(0,"ion-item",22),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).open_bottom_modal()}),e.TgZ(1,"ion-label"),e._uU(2),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(2),e.Oqu(t.lang.text.ContentViewer.ContentInfo)}}function J(o,m){if(1&o){const t=e.EpF();e.TgZ(0,"ion-item",21),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).download_file()}),e.TgZ(1,"ion-label"),e._uU(2),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(2),e.Oqu(t.lang.text.ContentViewer.Download)}}function z(o,m){if(1&o){const t=e.EpF();e.TgZ(0,"ion-content")(1,"ion-list"),e.YNc(2,q,3,1,"ion-item",19),e.YNc(3,j,3,1,"ion-item",20),e.TgZ(4,"ion-item",21),e.NdJ("click",function(){return e.CHM(t),e.oxw().ShareContent()}),e.TgZ(5,"ion-label"),e._uU(6),e.qZA()(),e.YNc(7,J,3,1,"ion-item",19),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(2),e.Q6J("ngIf","audio"!=t.FileInfo.viewer&&!t.HasNoEditButton),e.xp6(1),e.Q6J("ngIf",t.FileInfo.content_creator),e.xp6(3),e.Oqu(t.lang.text.ContentViewer.ShareContent),e.xp6(1),e.Q6J("ngIf",!t.FileInfo.url)}}function G(o,m){1&o&&e._UZ(0,"div",25)}function K(o,m){1&o&&e._UZ(0,"div",26)}function Q(o,m){if(1&o&&(e.TgZ(0,"td"),e.YNc(1,G,1,0,"div",23),e.YNc(2,K,1,0,"div",24),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf","pck"!=t.FileInfo.file_ext),e.xp6(1),e.Q6J("ngIf","pck"==t.FileInfo.file_ext)}}function X(o,m){if(1&o){const t=e.EpF();e.TgZ(0,"td")(1,"ion-grid")(2,"ion-row",27)(3,"ion-col",28)(4,"ion-button",29),e.NdJ("click",function(){return e.CHM(t),e.oxw().DownloadCurrentFile()}),e._uU(5),e.qZA()()()()()}if(2&o){const t=e.oxw();e.xp6(4),e.Q6J("disabled",t.isDownloading),e.xp6(1),e.hij(" ",t.lang.text.ContentViewer.DownloadThisFile," ")}}function ee(o,m){if(1&o){const t=e.EpF();e.TgZ(0,"ion-item",21),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).copy_url()}),e.TgZ(1,"ion-label"),e._uU(2),e.qZA(),e.TgZ(3,"ion-label",30),e._uU(4),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(2),e.Oqu(t.lang.text.ContentInfo.SourceFrom),e.xp6(2),e.Oqu(t.content_creator.various_display)}}function te(o,m){if(1&o){const t=e.EpF();e.TgZ(0,"div")(1,"ion-item-divider")(2,"div",33),e._uU(3),e.qZA()(),e.TgZ(4,"ion-item")(5,"ion-label"),e._uU(6),e.qZA(),e.TgZ(7,"ion-label",30),e._uU(8),e.qZA()(),e.TgZ(9,"ion-item",21),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).copy_url()}),e.TgZ(10,"ion-label"),e._uU(11),e.qZA(),e.TgZ(12,"ion-label",30),e._uU(13),e.qZA()()()}if(2&o){const t=m.$implicit,a=e.oxw(2);e.xp6(3),e.Oqu(t.timeDisplay),e.xp6(3),e.Oqu(a.lang.text.ContentInfo.Publisher),e.xp6(2),e.Oqu(t.publisher||t.display_name||a.lang.text.Profile.noname_user),e.xp6(3),e.Oqu(a.lang.text.ContentInfo.SourceFrom),e.xp6(2),e.Oqu(t.various_display)}}function ie(o,m){if(1&o){const t=e.EpF();e.TgZ(0,"ion-content")(1,"ion-item-divider")(2,"ion-label"),e._uU(3),e.qZA()(),e.TgZ(4,"ion-item")(5,"ion-label"),e._uU(6),e.qZA(),e.TgZ(7,"ion-label",30),e._uU(8),e.qZA()(),e.YNc(9,ee,5,2,"ion-item",19),e.TgZ(10,"ion-item")(11,"ion-label"),e._uU(12),e.qZA(),e.TgZ(13,"ion-label",30),e._uU(14),e.qZA()(),e.YNc(15,te,14,5,"div",31),e.TgZ(16,"ion-item",21),e.NdJ("click",function(){return e.CHM(t),e.oxw().ShowContentInfoIonic.dismiss()}),e.TgZ(17,"ion-label",32),e._uU(18),e.qZA()()()}if(2&o){const t=e.oxw();e.xp6(3),e.Oqu(t.lang.text.ContentInfo.WorkLogs),e.xp6(3),e.Oqu(t.lang.text.ContentInfo.LastPost),e.xp6(2),e.hij(" ",(t.content_creator.user_id?t.content_creator.is_me?t.nakama.users.self.display_name:t.nakama.users[t.isOfficial][t.target][t.content_creator.user_id].display_name:t.content_creator.display_name)||t.lang.text.Profile.noname_user,""),e.xp6(1),e.Q6J("ngIf",t.content_creator.various),e.xp6(3),e.Oqu(t.lang.text.ContentInfo.TimeAt),e.xp6(2),e.Oqu(t.content_creator.timeDisplay),e.xp6(1),e.Q6J("ngForOf",t.content_related_creator),e.xp6(3),e.Oqu(t.lang.text.ContentInfo.CloseModal)}}const ne=function(){return[.5,1]};let ae=(()=>{class o{constructor(t,a,i,s,l,f,I,v,p,P,C,D){this.modalCtrl=t,this.navParams=a,this.indexed=i,this.lang=s,this.file=l,this.p5toast=f,this.alertCtrl=I,this.loadingCtrl=v,this.fileOpener=p,this.global=P,this.nakama=C,this.mClipboard=D,this.useP5Navigator=!0,this.RelevanceIndex=0,this.HaveRelevances=!1,this.NeedDownloadFile=!1,this.isDownloading=!1,this.EventListenerAct=u=>{u.detail.register(120,N=>{})},this.image_info={},this.forceWrite=!1}ngOnInit(){return(0,n.mG)(this,void 0,void 0,function*(){if(this.MessageInfo=this.navParams.get("info"),this.FileInfo=this.MessageInfo.content,this.ContentBox=document.getElementById("ContentBox"),this.FileHeader=document.getElementById("FileHeader"),this.isOfficial=this.navParams.get("isOfficial"),this.target=this.navParams.get("target"),this.HasNoEditButton=this.navParams.get("no_edit")||!1,this.Relevances=this.navParams.get("relevance"),this.Relevances){for(let t=0,a=this.Relevances.length;t<a;t++)if(this.Relevances[t].message_id&&this.MessageInfo.message_id){if(this.Relevances[t].message_id==this.MessageInfo.message_id){this.RelevanceIndex=t+1;break}}else if(this.Relevances[t].content.path==this.MessageInfo.content.path){this.RelevanceIndex=t+1;break}this.HaveRelevances=Boolean(this.Relevances.length>1)}else this.HaveRelevances=!1;this.FileInfo.url?this.FileURL=this.FileInfo.url:(this.blob=yield this.indexed.loadBlobFromUserPath(this.navParams.get("path"),this.FileInfo.type),this.FileURL=URL.createObjectURL(this.blob)),this.CreateContentInfo()})}reinit_content_data(t){return(0,n.mG)(this,void 0,void 0,function*(){if(this.NeedDownloadFile=!1,this.FileInfo=t.content,this.FileInfo.url)this.FileURL=this.FileInfo.url;else{let a=this.FileInfo.path||`servers/${this.isOfficial}/${this.target}/channels/${t.channel_id}/files/msg_${t.message_id}.${t.content.file_ext}`;this.image_info.path=a;try{this.blob=yield this.indexed.loadBlobFromUserPath(a,this.FileInfo.type),this.FileURL=URL.createObjectURL(this.blob)}catch(i){this.isDownloading=!1,this.NeedDownloadFile=!0}}this.CreateContentInfo(),this.ionViewDidEnter()})}ChangeToAnother(t){let a=this.RelevanceIndex+t;a<=0||a>this.Relevances.length||(this.RelevanceIndex=a,this.reinit_content_data(this.Relevances[this.RelevanceIndex-1]))}DownloadCurrentFile(){return(0,n.mG)(this,void 0,void 0,function*(){this.isDownloading=!0,yield this.nakama.ReadStorage_From_channel(this.Relevances[this.RelevanceIndex-1],this.image_info.path,this.isOfficial,this.target),this.reinit_content_data(this.Relevances[this.RelevanceIndex-1])})}CreateContentInfo(){try{this.content_creator=this.FileInfo.content_creator,this.content_creator.timeDisplay=new Date(this.content_creator.timestamp).toLocaleString(),this.content_related_creator=this.FileInfo.content_related_creator,this.content_creator.user_id&&(this.content_creator.is_me=this.nakama.servers[this.isOfficial][this.target].session.user_id==this.content_creator.user_id),this.set_various_display(this.content_creator);for(let t=0,a=this.content_related_creator.length;t<a;t++)this.content_related_creator[t].user_id&&(this.content_related_creator[t].is_me=this.nakama.servers[this.isOfficial][this.target].session.user_id==this.content_related_creator[t].user_id),this.content_related_creator[t].timeDisplay=new Date(this.content_related_creator[t].timestamp).toLocaleString(),this.set_various_display(this.content_related_creator[t])}catch(t){}try{this.content_related_creator[0].publisher=this.content_related_creator[0].is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_related_creator[0].user_id].display_name,this.content_related_creator[0].timestamp==this.content_related_creator[1].timestamp&&(this.content_related_creator[0].publisher=this.content_related_creator[1].is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_related_creator[1].user_id].display_name,this.content_related_creator.splice(1,1))}catch(t){try{this.content_related_creator[0].publisher=this.content_related_creator[1].display_name,this.content_related_creator[0].timestamp==this.content_related_creator[1].timestamp&&(this.content_related_creator[0].publisher=this.content_related_creator[1].display_name,this.content_related_creator.splice(1,1))}catch(a){}try{this.content_related_creator[0].publisher||(this.content_related_creator[0].publisher=this.content_related_creator[0].display_name)}catch(a){}}try{this.content_related_creator.sort((t,a)=>t.timestamp>a.timestamp?-1:t.timestamp<a.timestamp?1:0)}catch(t){}}set_various_display(t){switch(t.various_display=this.lang.text.GlobalAct.UnknownSource,t.various){case"camera":t.various_display=this.lang.text.GlobalAct.FromCamera;break;case"link":t.various_display=this.FileInfo.url;break;case"loaded":t.various_display=this.lang.text.GlobalAct.variousCreator;break;case"voidDraw":t.various_display=this.lang.text.GlobalAct.FromVoidDraw;break;case"long_text":t.various_display=this.lang.text.GlobalAct.FromAutoLongText}}ionViewDidEnter(){return(0,n.mG)(this,void 0,void 0,function*(){this.forceWrite=!1;let t=document.getElementById("content_viewer_canvas");switch(t.style.backgroundImage="",document.removeEventListener("ionBackButton",this.EventListenerAct),this.p5canvas&&this.p5canvas.remove(),this.FileInfo.viewer){case"image":this.p5canvas=new T(i=>{let s;i.setup=()=>(0,n.mG)(this,void 0,void 0,function*(){t.style.maxWidth="100%",t.style.overflow="hidden",this.ContentBox.style.overflow="hidden",i.noCanvas();let r=i.createElement("img");r.elt.hidden=!0,r.elt.src=this.FileURL,r.elt.onload=()=>{t.style.backgroundImage=`url(${this.FileURL})`,t.style.backgroundRepeat="no-repeat",t.style.pointerEvents="none",this.image_info.width=r.elt.naturalWidth,this.image_info.height=r.elt.naturalHeight,f=i.createVector(r.elt.naturalWidth,r.elt.naturalHeight),l(),r.remove()},("Android"==g.n$||"iOS"==g.n$)&&(s=i.createElement("iframe"),s.elt.setAttribute("src",this.FileURL),s.elt.setAttribute("frameborder","0"),s.elt.setAttribute("class","full_screen"),s.elt.setAttribute("style","position: relative; pointer-events: all"),s.elt.hidden=!0,t.appendChild(s.elt)),i.noLoop()});let l=()=>{if(this.image_info.width/this.image_info.height<t.clientWidth/t.clientHeight){let r=this.image_info.width*t.clientHeight/this.image_info.height;t.style.backgroundSize=`${r}px`,t.style.backgroundPositionX=(t.clientWidth-r)/2+"px",t.style.backgroundPositionY="0px"}else t.style.backgroundSize=`${t.clientWidth}px`,t.style.backgroundPositionX="0px",t.style.backgroundPositionY=t.clientHeight/2-f.y*(t.clientWidth/f.x)/2+"px"};i.windowResized=()=>{setTimeout(()=>{l()},50)};let f,I=i.createVector(),v=i.createVector(),p=i.createVector(),P=1,C=()=>{t.style.backgroundPositionX=`${I.x+p.x}px`,t.style.backgroundPositionY=`${I.y+p.y}px`},D=(r,k)=>{let d=P,w=P*k,E=Number(t.style.backgroundPositionX.split("px")[0]),B=Number(t.style.backgroundPositionY.split("px")[0]),se=(d-w)*i.map(r.x,E,E+d,0,1),oe=(d-w)/f.x*f.y*i.map(r.y,B,B+d/f.x*f.y,0,1);t.style.backgroundPositionX=`${E+se}px`,t.style.backgroundPositionY=`${B+oe}px`,t.style.backgroundSize=`${w}px`};i.mousePressed=()=>{!this.useP5Navigator||(i.mouseButton==i.CENTER&&l(),"DesktopPWA"==g.n$&&(I=i.createVector(Number(t.style.backgroundPositionX.split("px")[0]),Number(t.style.backgroundPositionY.split("px")[0])),v=i.createVector(i.mouseX,i.mouseY)))},i.mouseWheel=r=>{!this.useP5Navigator||(P=Number(t.style.backgroundSize.split("px")[0]),D(i.createVector(t.clientWidth/2,t.clientHeight/2),1-r.delta/1e3))},i.mouseDragged=()=>{!this.useP5Navigator||"DesktopPWA"==g.n$&&(p=i.createVector(i.mouseX,i.mouseY),p.sub(v),C())};let N,u={},L=!1;i.touchStarted=r=>{if(this.useP5Navigator){for(let d=0,w=r.changedTouches.length;d<w;d++)u[r.changedTouches[d].identifier]=i.createVector(r.changedTouches[d].clientX,r.changedTouches[d].clientY);switch(Object.keys(u).length){case 1:I=i.createVector(Number(t.style.backgroundPositionX.split("px")[0]),Number(t.style.backgroundPositionY.split("px")[0])),v=u[r.changedTouches[0].identifier].copy();break;case 2:I=i.createVector(Number(t.style.backgroundPositionX.split("px")[0]),Number(t.style.backgroundPositionY.split("px")[0]));let d=u[0].copy();N=d.dist(u[1]),v=d.add(u[1]).div(2).copy(),P=Number(t.style.backgroundSize.split("px")[0]),C();break;default:L=!0,l()}}},i.touchMoved=r=>{if(this.useP5Navigator&&!L){for(let d=0,w=r.changedTouches.length;d<w;d++)u[r.changedTouches[d].identifier]=i.createVector(r.changedTouches[d].clientX,r.changedTouches[d].clientY);switch(Object.keys(u).length){case 1:p=u[r.changedTouches[0].identifier].copy(),p.sub(v),C();break;case 2:let d=u[0].copy(),w=d.dist(u[1]);p=d.add(u[1]).div(2).copy();let E=p.copy();p.sub(v),C(),D(E,w/N)}}},i.touchEnded=r=>{if(this.useP5Navigator&&"changedTouches"in r){for(let d=0,w=r.changedTouches.length;d<w;d++)delete u[r.changedTouches[d].identifier];switch(Object.keys(u).length){case 1:I=i.createVector(Number(t.style.backgroundPositionX.split("px")[0]),Number(t.style.backgroundPositionY.split("px")[0])),v=u[Object.keys(u)[0]].copy();break;case 0:L=!1}}}});break;case"audio":this.p5canvas=new T(i=>{var s;i.setup=()=>{i.noCanvas(),i.noLoop(),s=i.createAudio([this.FileURL],()=>{t.appendChild(s.elt),s.elt.hidden=!0,setTimeout(()=>{l(),s.elt.hidden=!1},50),s.showControls(),s.play()})};let l=()=>{let f=this.ContentBox.offsetWidth;s.elt.setAttribute("style","position: relative; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%);"),s.size(f,25)};i.windowResized=()=>{setTimeout(()=>{l()},50)}});break;case"video":this.p5canvas=new T(i=>{var s;i.setup=()=>{i.noCanvas(),i.noLoop(),s=i.createVideo([this.FileURL],()=>{t.appendChild(s.elt),s.elt.hidden=!0,setTimeout(()=>{this.image_info.width=s.elt.videoWidth,this.image_info.height=s.elt.videoHeight,l(),s.elt.hidden=!1},50),s.showControls(),s.play()}),i.VideoMedia=s};let l=()=>{let f=this.ContentBox.offsetWidth,I=this.ContentBox.offsetHeight-this.FileHeader.offsetHeight,v=s.width,p=s.height;s.elt.setAttribute("style","position: relative; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%);"),v<p?(p=I,v=v/s.height*p):(v=f,p=p/s.width*v||I/2),s.size(v,p)};i.windowResized=()=>{setTimeout(()=>{l()},50)}});break;case"text":this.p5canvas=new T(i=>{i.setup=()=>{i.noCanvas(),i.noLoop(),i.loadStrings(this.FileURL,s=>{let l=i.createElement("textarea");l.elt.disabled=!0,l.elt.className="infobox",l.elt.setAttribute("style","height: 100%; display: block;"),l.elt.textContent=s.join("\n"),t.appendChild(l.elt),i.TextArea=l},s=>{console.error("\uc5f4\ub78c\ud560 \uc218 \uc5c6\ub294 \ud30c\uc77c: ",s),t.textContent="\uc5f4\ub78c\ud560 \uc218 \uc5c6\ub294 \ud30c\uc77c\uc785\ub2c8\ub2e4.",this.FileInfo.else=!0})}});break;case"godot":let a;document.addEventListener("ionBackButton",this.EventListenerAct);try{let i=yield this.indexed.loadBlobFromUserPath(this.FileInfo.path+"_thumbnail.png","");a=URL.createObjectURL(i)}catch(i){}yield this.global.CreateGodotIFrame("content_viewer_canvas",{local_url:"assets/data/godot/viewer.pck",title:"ViewerEx",path:this.FileInfo.path||this.navParams.get("path"),ext:this.FileInfo.file_ext,force_logo:!0,background:a,receive_image:(i,s,l)=>(0,n.mG)(this,void 0,void 0,function*(){let f="tmp_files/modify_image.png";yield this.indexed.saveBase64ToUserPath(","+i,f),this.modalCtrl.dismiss({path:f,width:s,height:l,msg:this.HaveRelevances?this.Relevances[this.RelevanceIndex-1]:this.MessageInfo,index:this.RelevanceIndex-1})})},"create_thumbnail"),a&&URL.revokeObjectURL(a);break;case"disabled":try{yield this.file.writeFile(this.file.externalDataDirectory,`viewer_tmp.${this.FileInfo.file_ext}`,this.blob),this.fileOpener.open(this.file.externalDataDirectory+`viewer_tmp.${this.FileInfo.file_ext}`,this.FileInfo.type||`application/${this.FileInfo.file_ext}`)}catch(i){console.log("open file failed: ",i),this.p5toast.show({text:`${this.lang.text.ChatRoom.cannot_open_file}: ${i.message}`})}}})}open_bottom_modal(){this.ShowContentInfoIonic.onDidDismiss().then(t=>{this.useP5Navigator=!0}),this.useP5Navigator=!1,this.ShowContentInfoIonic.present()}modify_image(){return(0,n.mG)(this,void 0,void 0,function*(){switch(this.FileInfo.viewer){case"image":if(this.FileInfo.url){let i=yield this.loadingCtrl.create({message:this.lang.text.TodoDetail.WIP});i.present();try{let s=yield fetch(this.FileInfo.url).then(l=>l.blob());this.image_info.path=`tmp_files/external_image_edit/image_download.${this.FileInfo.file_ext}`,yield this.indexed.saveBlobToUserPath(s,this.image_info.path),this.modalCtrl.dismiss(Object.assign(Object.assign({},this.image_info),{msg:this.HaveRelevances?this.Relevances[this.RelevanceIndex-1]:this.MessageInfo,index:this.RelevanceIndex-1}))}catch(s){this.p5toast.show({text:`${this.lang.text.ContentViewer.CannotEditFile}: ${s}`})}i.dismiss()}else this.modalCtrl.dismiss(Object.assign(Object.assign({},this.image_info),{path:this.FileInfo.path,msg:this.HaveRelevances?this.Relevances[this.RelevanceIndex-1]:this.MessageInfo,index:this.RelevanceIndex-1}));break;case"text":let t=yield this.loadingCtrl.create({message:this.lang.text.TodoDetail.WIP});t.present(),this.image_info.width=this.p5canvas.TextArea.clientWidth,this.image_info.height=this.p5canvas.TextArea.scrollHeight,this.p5canvas.createCanvas(this.image_info.width,this.image_info.height),this.p5canvas.textSize(16),this.p5canvas.textWrap(this.p5canvas.WORD);let a=.05*this.p5canvas.width;this.p5canvas.text(this.p5canvas.TextArea.textContent,a,a,this.p5canvas.width-2*a),this.p5canvas.saveFrames("","png",1,1,i=>(0,n.mG)(this,void 0,void 0,function*(){try{t.dismiss(),this.image_info.path="tmp_files/text_edit/text_copy.png",yield this.indexed.saveBase64ToUserPath(i[0].imageData.replace(/"|=|\\/g,""),this.image_info.path),this.modalCtrl.dismiss(Object.assign(Object.assign({},this.image_info),{msg:this.HaveRelevances?this.Relevances[this.RelevanceIndex-1]:this.MessageInfo,index:this.RelevanceIndex-1}))}catch(s){console.log("\ud30c\uc77c \uc800\uc7a5 \uc624\ub958: ",s)}}));break;case"video":try{let i=yield this.loadingCtrl.create({message:this.lang.text.TodoDetail.WIP});i.present(),this.p5canvas.VideoMedia.pause(),this.p5canvas.createCanvas(this.image_info.width,this.image_info.height),this.p5canvas.image(this.p5canvas.VideoMedia,0,0,this.image_info.width,this.image_info.height),this.p5canvas.saveFrames("","png",1,1,s=>(0,n.mG)(this,void 0,void 0,function*(){try{i.dismiss(),this.image_info.path="tmp_files/video_edit/frame.png",yield this.indexed.saveBase64ToUserPath(s[0].imageData.replace(/"|=|\\/g,""),this.image_info.path),this.modalCtrl.dismiss(Object.assign(Object.assign({},this.image_info),{msg:this.HaveRelevances?this.Relevances[this.RelevanceIndex-1]:this.MessageInfo,index:this.RelevanceIndex-1}))}catch(l){console.log("\ud30c\uc77c \uc800\uc7a5 \uc624\ub958: ",l)}}))}catch(i){console.log("\uc7ac\uc0dd\uc911\uc778 \ube44\ub514\uc624 \uc774\ubbf8\uc9c0 \ucd94\ucd9c \uc624\ub958: ",i)}break;case"godot":this.global.godot_window.modify_image();break;default:console.log("\ud3b8\uc9d1 \ubd88\uac00 \ud30c\uc77c \uc815\ubcf4: ",this.FileInfo)}})}download_file(){"DesktopPWA"==g.n$||"MobilePWA"==g.n$?this.indexed.DownloadFileFromUserPath(this.navParams.get("path"),this.FileInfo.type,this.FileInfo.filename):this.alertCtrl.create({header:this.lang.text.ContentViewer.Filename,inputs:[{name:"filename",placeholder:this.FileInfo.filename,type:"text"}],buttons:[{text:this.lang.text.ContentViewer.saveFile,handler:t=>(0,n.mG)(this,void 0,void 0,function*(){let a=yield this.loadingCtrl.create({message:this.lang.text.TodoDetail.WIP});a.present();let i=t.filename?t.filename.replace(/:|\?|\/|\\|<|>/g,""):this.FileInfo.filename,s=yield this.indexed.loadBlobFromUserPath(this.navParams.get("path"),this.FileInfo.type);this.forceWrite&&!t.filename?this.file.writeExistingFile(this.file.externalDataDirectory,i,s).then(l=>{this.forceWrite=!1,a.dismiss(),this.p5toast.show({text:`${this.lang.text.ContentViewer.OverWriteFile}: ${i}`})}):this.file.writeFile(this.file.externalDataDirectory,i,s).then(l=>{a.dismiss(),this.p5toast.show({text:this.lang.text.ContentViewer.fileSaved})}).catch(l=>{12===(a.dismiss(),l.code)?(this.p5toast.show({text:this.lang.text.ContentViewer.AlreadyExist}),this.forceWrite=!0,this.download_file()):console.log("\uc900\ube44\ub418\uc9c0 \uc54a\uc740 \uc624\ub958 \ubc18\ud658: ",l)})})}]}).then(t=>t.present())}ShareContent(){let t=this.nakama.rearrange_channels();for(let a=t.length-1;a>=0;a--)("missing"==t[a].status||"offline"==t[a].status)&&t.splice(a,1);t.length?this.modalCtrl.create({component:A.D,componentProps:{file:this.FileInfo,channels:t}}).then(a=>{a.onDidDismiss().then(i=>{i.data&&this.modalCtrl.dismiss()}),a.present()}):this.p5toast.show({text:this.lang.text.ShareContentToOther.NoChannelToShare})}ionViewWillLeave(){return(0,n.mG)(this,void 0,void 0,function*(){switch(document.removeEventListener("ionBackButton",this.EventListenerAct),this.FileInfo.viewer){case"video":try{let i,s,a=this.p5canvas.VideoMedia.size();a.width>a.height?(i=192,s=a.height/a.width*192):(i=a.width/a.height*192,s=192),this.p5canvas.createCanvas(i,s),this.p5canvas.image(this.p5canvas.VideoMedia,0,0,i,s),this.p5canvas.fill(255,128),this.p5canvas.rect(0,0,i,s),this.p5canvas.textWrap(this.p5canvas.CHAR),this.p5canvas.textSize(16);let l=s/16;this.p5canvas.push(),this.p5canvas.translate(l/6,l/6),this.p5canvas.fill(0),this.p5canvas.text(this.FileInfo.filename,l,l,i-2*l,s-2*l),this.p5canvas.filter(this.p5canvas.BLUR,3),this.p5canvas.pop(),this.p5canvas.fill(255),this.p5canvas.text(this.FileInfo.filename,l,l,i-2*l,s-2*l),this.p5canvas.saveFrames("","png",1,1,f=>(0,n.mG)(this,void 0,void 0,function*(){try{yield this.indexed.saveBase64ToUserPath(f[0].imageData.replace(/"|=|\\/g,""),`${this.FileInfo.path}_thumbnail.png`),this.global.modulate_thumbnail(this.FileInfo,"")}catch(I){console.log("\uc378\ub124\uc77c \uc800\uc7a5 \uc624\ub958: ",I)}}))}catch(a){console.log("\uc791\uc5c5\uc911 \uc624\ub958\ubcf4\uae30: ",a)}break;case"godot":try{this.global.godot_window.filename=this.FileInfo.filename,this.global.godot_window.create_thumbnail(this.FileInfo)}catch(a){}}this.p5canvas&&this.p5canvas.remove(),this.FileURL&&URL.revokeObjectURL(this.FileURL),this.file.checkFile(this.file.externalDataDirectory,`viewer_tmp.${this.FileInfo.file_ext}`)&&this.file.removeFile(this.file.externalDataDirectory,`viewer_tmp.${this.FileInfo.file_ext}`)})}copy_url(){this.mClipboard.copy(this.FileInfo.url).catch(t=>U.Z.write(this.FileInfo.url))}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(_.IN),e.Y36(_.X1),e.Y36(M.H),e.Y36(V.b),e.Y36(x.$),e.Y36(y.F),e.Y36(_.Br),e.Y36(_.HT),e.Y36(c.u),e.Y36(b.AN),e.Y36(O.a),e.Y36(F.T))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-ionic-viewer"]],viewQuery:function(t,a){if(1&t&&e.Gf(_.ki,5),2&t){let i;e.iGM(i=e.CRH())&&(a.ShowContentInfoIonic=i.first)}},decls:25,vars:10,consts:[["id","Toolbar"],["slot","start",3,"click"],["defaultHref",""],["class","relevance_change","style","padding-right: 4px;","slot","end","name","arrow-back-circle-outline",3,"click",4,"ngIf"],["slot","end",4,"ngIf"],["class","relevance_change","style","padding-right: 16px; padding-left: 4px;","slot","end","name","arrow-forward-circle-outline",3,"click",4,"ngIf"],["id","ContentBox"],[1,"main_table_elt"],[2,"height","0"],["id","FileHeader"],["text-wrap",""],["id","menu_trigger"],["name","ellipsis-vertical"],["trigger","menu_trigger","dismissOnSelect",""],[4,"ngIf"],["trigger","ShowContentInfoIonic",3,"initialBreakpoint","breakpoints"],["slot","end","name","arrow-back-circle-outline",1,"relevance_change",2,"padding-right","4px",3,"click"],["slot","end"],["slot","end","name","arrow-forward-circle-outline",1,"relevance_change",2,"padding-right","16px","padding-left","4px",3,"click"],["button","",3,"click",4,"ngIf"],["button","","id","ShowContentInfoIonic",3,"click",4,"ngIf"],["button","",3,"click"],["button","","id","ShowContentInfoIonic",3,"click"],["class","full_screen","id","content_viewer_canvas",4,"ngIf"],["class","full_screen","style","display: flex;","id","content_viewer_canvas",4,"ngIf"],["id","content_viewer_canvas",1,"full_screen"],["id","content_viewer_canvas",1,"full_screen",2,"display","flex"],[1,"ion-align-items-center"],["size","12",1,"ion-text-center"],["color","warning","shape","round",1,"ion-align-items-center",3,"disabled","click"],[1,"ion-text-end"],[4,"ngFor","ngForOf"],[1,"ion-text-center"],[2,"width","100%","text-align","center"]],template:function(t,a){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),e._uU(3),e.qZA(),e.TgZ(4,"ion-buttons",1),e.NdJ("click",function(){return a.modalCtrl.dismiss()}),e._UZ(5,"ion-back-button",2),e.qZA(),e.YNc(6,Y,1,0,"ion-icon",3),e.YNc(7,S,2,1,"ion-label",4),e.YNc(8,$,1,0,"ion-icon",5),e.qZA()(),e.TgZ(9,"ion-content",6)(10,"table",7)(11,"tr",8)(12,"td")(13,"ion-list-header",9)(14,"ion-label",10),e._uU(15),e.qZA(),e.TgZ(16,"ion-button",11),e._UZ(17,"ion-icon",12),e.qZA(),e.TgZ(18,"ion-popover",13),e.YNc(19,z,8,4,"ng-template"),e.qZA()()()(),e.TgZ(20,"tr"),e.YNc(21,Q,3,2,"td",14),e.YNc(22,X,6,2,"td",14),e.qZA()(),e.TgZ(23,"ion-modal",15),e.YNc(24,ie,19,8,"ng-template"),e.qZA()()),2&t&&(e.xp6(3),e.Oqu(a.lang.text.ContentViewer.Title),e.xp6(3),e.Q6J("ngIf",a.HaveRelevances),e.xp6(1),e.Q6J("ngIf",a.HaveRelevances),e.xp6(1),e.Q6J("ngIf",a.HaveRelevances),e.xp6(7),e.Oqu(a.FileInfo.filename),e.xp6(6),e.Q6J("ngIf",!a.NeedDownloadFile),e.xp6(1),e.Q6J("ngIf",a.NeedDownloadFile),e.xp6(1),e.Q6J("initialBreakpoint",.5)("breakpoints",e.DdM(9,ne)))},directives:[_.Gu,_.sr,_.wd,_.Sm,_.oU,_.cs,R.O5,_.gu,_.Q$,_.W2,_.yh,_.YG,_.d8,_.q_,_.Ie,_.jY,_.Nd,_.wI,_.ki,_.rH,R.sg],styles:[".main_table_elt[_ngcontent-%COMP%]{width:100%;height:100%;border:0;margin:0}.relevance_change[_ngcontent-%COMP%]{width:25px;height:25px}"]}),o})()},549:(H,Z,h)=>{h.d(Z,{D:()=>V});var n=h(9863),_=h(5742),g=h(3996),T=h(4606),W=h(9912),A=h(9808);function U(x,y){1&x&&n._UZ(0,"div",11)}function e(x,y){if(1&x&&n._UZ(0,"img",12),2&x){const c=n.oxw().$implicit;n.Akn("online"==c.status||3==c.redirect.type&&"pending"==c.status?"filter: grayscale(0) contrast(1)":"filter: grayscale(.9) contrast(1.4)"),n.Q6J("src",c.info.img,n.LSH)}}function M(x,y){if(1&x){const c=n.EpF();n.TgZ(0,"ion-item",3),n.NdJ("click",function(){const F=n.CHM(c).$implicit;return n.oxw().go_to_chatroom(F)}),n.TgZ(1,"div",4),n.YNc(2,U,1,0,"div",5),n.qZA(),n.TgZ(3,"div",6),n.YNc(4,e,1,3,"img",7),n.qZA(),n.TgZ(5,"ion-label")(6,"div",8)(7,"table")(8,"tr")(9,"td"),n._uU(10),n.qZA(),n.TgZ(11,"td",9),n._uU(12),n.qZA()()()(),n.TgZ(13,"div",10),n._uU(14),n.qZA()()()}if(2&x){const c=y.$implicit,b=n.oxw();n.xp6(1),n.Akn("background-color: "+b.statusBar.colors[c.status||"offline"]),n.xp6(1),n.Q6J("ngIf",c.is_new),n.xp6(2),n.Q6J("ngIf",c.info),n.xp6(6),n.hij(" ",c.info?c.info.name||c.info.display_name||b.lang.text.ChatRoom.noname_chatroom:c.title||b.lang.text.ChatRoom.noname_chatroom," "),n.xp6(2),n.hij(" ","("+c.server.target+")"," "),n.xp6(2),n.hij(" ",c.last_comment||c.noti||b.lang.text.Subscribes.noMessageHistory," ")}}let V=(()=>{class x{constructor(c,b,O,F,R){this.lang=c,this.navParams=b,this.modalCtrl=O,this.statusBar=F,this.nakama=R}ngOnInit(){this.channels=this.navParams.get("channels")}go_to_chatroom(c){this.nakama.go_to_chatroom_without_admob_act(c,this.navParams.get("file")),this.modalCtrl.dismiss(!0)}}return x.\u0275fac=function(c){return new(c||x)(n.Y36(_.b),n.Y36(g.X1),n.Y36(g.IN),n.Y36(T.g),n.Y36(W.a))},x.\u0275cmp=n.Xpm({type:x,selectors:[["app-share-content-to-other"]],decls:11,vars:3,consts:[["slot","start",3,"click"],["defaultHref",""],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"],[1,"additional_form","status_bar_double"],["class","new_circle",4,"ngIf"],[1,"additional_form","bg_img_form"],["class","profile_img",3,"style","src",4,"ngIf"],[1,"form_margin","header"],[1,"server_target"],[1,"form_margin","content"],[1,"new_circle"],[1,"profile_img",3,"src"]],template:function(c,b){1&c&&(n.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),n._uU(3),n.qZA(),n.TgZ(4,"ion-buttons",0),n.NdJ("click",function(){return b.modalCtrl.dismiss()}),n._UZ(5,"ion-back-button",1),n.qZA()()(),n.TgZ(6,"ion-content")(7,"ion-item-divider")(8,"ion-label"),n._uU(9),n.qZA()(),n.YNc(10,M,15,7,"ion-item",2),n.qZA()),2&c&&(n.xp6(3),n.Oqu(b.lang.text.ShareContentToOther.Title),n.xp6(6),n.Oqu(b.lang.text.ShareContentToOther.AvailableChannels),n.xp6(1),n.Q6J("ngForOf",b.channels))},directives:[g.Gu,g.sr,g.wd,g.Sm,g.oU,g.cs,g.W2,g.rH,g.Q$,A.sg,g.Ie,A.O5],styles:[".server_target[_ngcontent-%COMP%]{color:#888;padding-left:4px}.content[_ngcontent-%COMP%]{color:#888;height:24px;display:table-cell;vertical-align:middle;padding:0 16px}"]}),x})()}}]);