"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3978],{3978:(se,F,u)=>{u.r(F),u.d(F,{UserFsDirPageModule:()=>re});var h=u(6814),U=u(95),_=u(1325),v=u(5877),g=u(5861),D=u(3641),Z=u(9745),e=u(9468),T=u(797),b=u(3857),w=u(6052),I=u(9376),P=u(6593),y=u(2372);const C=["FileSel"];function A(t,s){if(1&t){const n=e.EpF();e.TgZ(0,"ion-button",10),e.NdJ("click",function(){e.CHM(n);const r=e.oxw(3);return e.KtG(r.ExportDirectoryRecursive())}),e._uU(1),e.qZA()}if(2&t){const n=e.oxw(3);e.xp6(1),e.hij(" ",n.lang.text.UserFsDir.ExportDir," ")}}function L(t,s){if(1&t){const n=e.EpF();e.TgZ(0,"div")(1,"ion-item",5),e._UZ(2,"ion-icon",6),e.TgZ(3,"ion-label"),e._uU(4,"."),e.qZA(),e.YNc(5,A,2,1,"ion-button",7),e.TgZ(6,"ion-button",8),e.NdJ("click",function(){e.CHM(n);const r=e.oxw(2);return e.KtG(r.RemoveDirectoryRecursive())}),e._uU(7),e.qZA()(),e.TgZ(8,"ion-item",9),e.NdJ("click",function(){e.CHM(n);const r=e.oxw(2);return e.KtG(r.MoveToUpDir())}),e._UZ(9,"ion-icon",6),e.TgZ(10,"ion-label"),e._uU(11,".."),e.qZA()()()}if(2&t){const n=e.oxw(2);e.xp6(5),e.Q6J("ngIf",!n.cant_dedicated),e.xp6(2),e.hij(" ",n.lang.text.UserFsDir.RemoveCurrentDir," ")}}function E(t,s){if(1&t){const n=e.EpF();e.TgZ(0,"div")(1,"ion-item",9),e.NdJ("click",function(){e.CHM(n);const r=e.oxw(3);return e.KtG(r.SelectImportFolder())}),e._UZ(2,"ion-icon",11),e.TgZ(3,"ion-label"),e._uU(4),e.qZA()(),e.TgZ(5,"input",12),e.NdJ("change",function(r){e.CHM(n);const o=e.oxw(3);return e.KtG(o.inputImageSelected(r))}),e.qZA()()}if(2&t){const n=e.oxw(3);e.xp6(4),e.hij(" ",n.lang.text.UserFsDir.ImportFolder," ")}}function J(t,s){if(1&t){const n=e.EpF();e.TgZ(0,"div")(1,"ion-item",9),e.NdJ("click",function(){e.CHM(n);const r=e.oxw(3);return e.KtG(r.BrowseExternalFiles())}),e._UZ(2,"ion-icon",13),e.TgZ(3,"ion-label"),e._uU(4),e.qZA()()()}if(2&t){const n=e.oxw(3);e.xp6(4),e.Oqu(n.lang.text.UserFsDir.OpenExtFolder)}}function k(t,s){if(1&t&&(e.TgZ(0,"div"),e.YNc(1,E,6,1,"div",2),e.YNc(2,J,5,1,"div",2),e.qZA()),2&t){const n=e.oxw(2);e.xp6(1),e.Q6J("ngIf",n.cant_dedicated),e.xp6(1),e.Q6J("ngIf",!n.cant_dedicated)}}function N(t,s){if(1&t){const n=e.EpF();e.TgZ(0,"ion-item",9),e.NdJ("click",function(){e.CHM(n);const r=e.oxw().$implicit,o=e.oxw(2);return e.KtG(o.SelectFolder(r))}),e._UZ(1,"ion-icon",6),e.TgZ(2,"ion-label"),e._uU(3),e.qZA()()}if(2&t){const n=e.oxw().$implicit;e.xp6(3),e.Oqu(n.name)}}function O(t,s){if(1&t&&(e.TgZ(0,"div"),e.YNc(1,N,4,1,"ion-item",14),e.qZA()),2&t){const n=s.$implicit,i=e.oxw(2);e.xp6(1),e.Q6J("ngIf",i.CurrentDir==n.dir)}}function R(t,s){1&t&&e._UZ(0,"ion-icon",30)}function Y(t,s){1&t&&e._UZ(0,"ion-icon",31)}function M(t,s){1&t&&e._UZ(0,"ion-icon",32)}function B(t,s){1&t&&e._UZ(0,"ion-icon",33)}function Q(t,s){1&t&&e._UZ(0,"ion-icon",34)}function q(t,s){1&t&&e._UZ(0,"ion-icon",35)}function G(t,s){if(1&t&&(e.TgZ(0,"ion-label",36),e._uU(1),e.qZA()),2&t){const n=e.oxw(2).$implicit;e.xp6(1),e.Oqu(n.name)}}function H(t,s){if(1&t&&(e.TgZ(0,"ion-label"),e._uU(1),e.qZA()),2&t){const n=e.oxw(2).$implicit;e.xp6(1),e.Oqu(n.name)}}function S(t,s){if(1&t){const n=e.EpF();e.TgZ(0,"ion-button",37),e.NdJ("click",function(){e.CHM(n);const r=e.oxw(2).$implicit,o=e.oxw(2);return e.KtG(o.OpenFile(r))}),e._uU(1),e.qZA()}if(2&t){const n=e.oxw(4);e.xp6(1),e.hij(" ",n.lang.text.UserFsDir.Open," ")}}function $(t,s){if(1&t){const n=e.EpF();e.TgZ(0,"ion-button",37),e.NdJ("click",function(){e.CHM(n);const r=e.oxw(2).$implicit,o=e.oxw(2);return e.KtG(o.DownloadFile(r))}),e._uU(1),e.qZA()}if(2&t){const n=e.oxw(4);e.xp6(1),e.hij(" ",n.lang.text.UserFsDir.Download," ")}}function j(t,s){if(1&t){const n=e.EpF();e.TgZ(0,"div",38),e.NdJ("click",function(){e.CHM(n);const r=e.oxw(2).$implicit,o=e.oxw(2);return e.KtG(o.OpenFile(r))}),e._UZ(1,"img",39),e.qZA()}if(2&t){const n=e.oxw(2).$implicit;e.xp6(1),e.Q6J("src",n.thumbnail,e.LSH)("alt",n.name)}}function K(t,s){if(1&t){const n=e.EpF();e.TgZ(0,"ion-accordion",16)(1,"ion-item",17),e.YNc(2,R,1,0,"ion-icon",18),e.YNc(3,Y,1,0,"ion-icon",19),e.YNc(4,M,1,0,"ion-icon",20),e.YNc(5,B,1,0,"ion-icon",21),e.YNc(6,Q,1,0,"ion-icon",22),e.YNc(7,q,1,0,"ion-icon",23),e.YNc(8,G,2,1,"ion-label",24),e.YNc(9,H,2,1,"ion-label",2),e.qZA(),e.TgZ(10,"ion-list",25)(11,"ion-item",5)(12,"ion-label"),e._uU(13),e.qZA(),e.YNc(14,S,2,1,"ion-button",26),e.YNc(15,$,2,1,"ion-button",26),e.TgZ(16,"ion-button",27),e.NdJ("click",function(){e.CHM(n);const r=e.oxw(),o=r.$implicit,l=r.index,c=e.oxw(2);return e.KtG(c.RemoveFile(o,l))}),e._uU(17),e.qZA()(),e.YNc(18,j,2,2,"div",28),e.TgZ(19,"ion-item",5)(20,"ion-label"),e._uU(21),e.qZA(),e.TgZ(22,"ion-label",29),e._uU(23),e.qZA()()()()}if(2&t){const n=e.oxw().$implicit;e.oxw();const i=e.MAs(5),r=e.oxw();e.Q6J("value",n.path),e.xp6(2),e.Q6J("ngIf","image"==n.viewer),e.xp6(1),e.Q6J("ngIf","audio"==n.viewer),e.xp6(1),e.Q6J("ngIf","video"==n.viewer),e.xp6(1),e.Q6J("ngIf","text"==n.viewer),e.xp6(1),e.Q6J("ngIf","godot"==n.viewer),e.xp6(1),e.Q6J("ngIf","disabled"==n.viewer),e.xp6(1),e.Q6J("ngIf",i.value==n.path),e.xp6(1),e.Q6J("ngIf",i.value!=n.path),e.xp6(4),e.Oqu(r.lang.text.UserFsDir.Action),e.xp6(1),e.Q6J("ngIf","disabled"!=n.viewer&&"image"!=n.viewer),e.xp6(1),e.Q6J("ngIf",r.cant_dedicated),e.xp6(2),e.hij(" ",r.lang.text.UserFsDir.Delete," "),e.xp6(1),e.Q6J("ngIf","image"==n.viewer),e.xp6(3),e.Oqu(r.lang.text.UserFsDir.CreateAt),e.xp6(2),e.Oqu(n.timestamp)}}function z(t,s){if(1&t&&(e.TgZ(0,"div"),e.YNc(1,K,24,16,"ion-accordion",15),e.qZA()),2&t){const n=s.$implicit,i=e.oxw(2);e.xp6(1),e.Q6J("ngIf",i.CurrentDir==n.dir)}}function W(t,s){if(1&t&&(e.TgZ(0,"ion-list"),e.YNc(1,L,12,2,"div",2),e.YNc(2,k,3,2,"div",2),e.YNc(3,O,2,1,"div",3),e.TgZ(4,"ion-accordion-group",null,4),e.YNc(6,z,2,1,"div",3),e.qZA()()),2&t){const n=e.oxw();e.xp6(1),e.Q6J("ngIf",""!=n.CurrentDir),e.xp6(1),e.Q6J("ngIf",""==n.CurrentDir),e.xp6(1),e.Q6J("ngForOf",n.DirList),e.xp6(3),e.Q6J("ngForOf",n.FileList)}}function V(t,s){if(1&t){const n=e.EpF();e.TgZ(0,"ion-item",43),e.NdJ("click",function(){e.CHM(n);const r=e.oxw().$implicit,o=e.oxw(2);return e.KtG(o.importFolderMiddleAct(r))}),e._UZ(1,"ion-icon",6),e.TgZ(2,"ion-label"),e._uU(3),e.qZA()()}if(2&t){const n=e.oxw().$implicit;e.xp6(3),e.Oqu(n.name)}}function X(t,s){if(1&t&&(e.TgZ(0,"ion-item",44),e._UZ(1,"ion-icon",35),e.TgZ(2,"ion-label"),e._uU(3),e.qZA()()),2&t){const n=e.oxw().$implicit;e.xp6(3),e.Oqu(n.name)}}function ee(t,s){if(1&t&&(e.TgZ(0,"div"),e.YNc(1,V,4,1,"ion-item",41),e.YNc(2,X,4,1,"ion-item",42),e.qZA()),2&t){const n=s.$implicit;e.xp6(1),e.Q6J("ngIf",n.isDirectory),e.xp6(1),e.Q6J("ngIf",n.isFile)}}function ie(t,s){if(1&t){const n=e.EpF();e.TgZ(0,"ion-list")(1,"ion-item",9),e.NdJ("click",function(){e.CHM(n);const r=e.oxw();return e.KtG(r.InAppBrowser=!0)}),e._UZ(2,"ion-icon",6),e.TgZ(3,"ion-label",40),e._uU(4,"/sdcard/Android/data/org.pjcone.portal/files"),e.qZA()(),e.YNc(5,ee,3,2,"div",3),e.qZA()}if(2&t){const n=e.oxw();e.xp6(5),e.Q6J("ngForOf",n.ExternalFolder)}}const te=[{path:"",component:(()=>{var t;class s{constructor(i,r,o,l,c,d,a,p,f,x){this.modalCtrl=i,this.indexed=r,this.loadingCtrl=o,this.lang=l,this.global=c,this.p5toast=d,this.alertCtrl=a,this.sanitizer=p,this.file=f,this.navCtrl=x,this.DirList=[],this.FileList=[],this.cant_dedicated=!1,this.InAppBrowser=!0,this.is_ready=!1,this.EventListenerAct=m=>{m.detail.register(110,oe=>{this.is_ready?""==this.CurrentDir?oe():this.MoveToUpDir():(this.initLoadingElement.dismiss(),this.navCtrl.back())})},this.isCreateFolderRecursive=!1,this.ExternalFolder=[]}ngOnInit(){}ionViewWillEnter(){this.CurrentDir="",this.LoadAllIndexedFiles(),("DesktopPWA"==D.n$||"MobilePWA"==D.n$)&&(this.cant_dedicated=!0),document.addEventListener("ionBackButton",this.EventListenerAct)}LoadAllIndexedFiles(){var i=this;return(0,g.Z)(function*(){i.initLoadingElement=yield i.loadingCtrl.create({message:i.lang.text.UserFsDir.LoadingExplorer}),i.initLoadingElement.present(),i.DirList.length=0,i.FileList.length=0,yield i.indexed.GetFileListFromDB("/",function(){var r=(0,g.Z)(function*(o){for(let l=0,c=o.length;l<c;l++)yield i.indexed.GetFileInfoFromDB(o[l],d=>{let a={path:o[l],mode:d.mode,timestamp:new Date(d.timestamp).toLocaleString()};switch(a.name=a.path.substring(a.path.lastIndexOf("/")+1),a.dir=o[l].substring(0,o[l].lastIndexOf("/")),a.mode){case 33206:a.file_ext=a.name.split(".").pop(),i.global.set_viewer_category_from_ext(a),"image"==a.viewer&&i.indexed.loadBlobFromUserPath(a.path,"",p=>{let f=URL.createObjectURL(p);a.thumbnail=i.sanitizer.bypassSecurityTrustUrl(f)}),i.FileList.push(a);break;case 16893:i.DirList.push(a);break;default:console.log("\uc608\uc0c1\ud558\uc9c0 \ubabb\ud55c \ud30c\uc77c \ubaa8\ub4dc: ",a)}});i.FileList.sort((l,c)=>l.path>c.path?1:l.path<c.path?-1:0),i.DirList.sort((l,c)=>l.path>c.path?1:l.path<c.path?-1:0),i.initLoadingElement.dismiss(),i.is_ready=!0});return function(o){return r.apply(this,arguments)}}())})()}MoveToUpDir(){this.CurrentDir=this.CurrentDir.substring(0,this.CurrentDir.lastIndexOf("/")),this.FileSel.value=void 0}SelectFolder(i){this.CurrentDir=i.path,this.FileSel.value=void 0}OpenFile(i){"disabled"===i.viewer?this.p5toast.show({text:this.lang.text.UserFsDir.CannotOpenFile}):(document.removeEventListener("ionBackButton",this.EventListenerAct),this.modalCtrl.create({component:Z.B,componentProps:{info:{content:{filename:i.name,file_ext:i.file_ext,type:"",viewer:i.viewer,path:i.path}},no_edit:!0,path:i.path}}).then(r=>{r.onDidDismiss().then(o=>document.addEventListener("ionBackButton",this.EventListenerAct)),r.present()}))}DownloadFile(i){this.indexed.DownloadFileFromUserPath(i.path,"",i.name)}ExportDirectoryRecursive(){this.alertCtrl.create({header:this.lang.text.UserFsDir.ExportDirTitle,message:this.lang.text.UserFsDir.ExportDirMsg,buttons:[{text:this.lang.text.UserFsDir.ExportConfirm,handler:()=>{this.ExportDirectoryRecursiveAct()}}]}).then(i=>i.present())}ExportDirectoryRecursiveAct(){var i=this;return(0,g.Z)(function*(){let r=yield i.loadingCtrl.create({message:i.lang.text.UserFsDir.LoadingExplorer});r.present(),(yield i.indexed.GetFileListFromDB(i.CurrentDir)).forEach(function(){var l=(0,g.Z)(function*(c){let d=yield i.indexed.GetFileInfoFromDB(c),a=yield i.indexed.loadBlobFromUserPath(c,""),p=c.lastIndexOf("/"),f=c.substring(0,p),x=c.substring(p+1);i.isCreateFolderRecursive||(i.isCreateFolderRecursive=!0,yield i.CreateFolderRecursive(f));try{if(16893==d.mode)throw"\uc774\uac70 \ud3f4\ub354\uc784";yield i.file.writeFile(i.file.externalDataDirectory+f+"/",x,a,{replace:!0})}catch(m){console.error(c,": \ud30c\uc77c \uc800\uc7a5 \uc2e4\ud328: ",m)}});return function(c){return l.apply(this,arguments)}}()),i.isCreateFolderRecursive=!1,r.dismiss()})()}CreateFolderRecursive(i){var r=this;return(0,g.Z)(function*(){let o=i.lastIndexOf("/")+1,l=i.substring(0,o),c=i.substring(o);l&&(yield r.CreateFolderRecursive(i.substring(0,o-1)));try{yield r.file.createDir(r.file.externalDataDirectory+l,c,!0)}catch{}})()}BrowseExternalFiles(){var i=this;return(0,g.Z)(function*(){i.ExternalFolder.length=0,i.InAppBrowser=!1,i.ExternalFolder=yield i.file.listDir(i.file.externalApplicationStorageDirectory,"files"),i.ExternalFolder.sort(),i.ExternalFolder.sort((r,o)=>r.isDirectory?-1:1)})()}importFolderMiddleAct(i){var r=this;return(0,g.Z)(function*(){let o=yield r.loadingCtrl.create({message:r.lang.text.UserFsDir.LoadingExplorer});o.present(),yield r.importThisFolder(i),r.InAppBrowser=!0,o.dismiss()})()}importThisFolder(i){var r=this;return(0,g.Z)(function*(){let o=i.nativeURL.substring(0,i.nativeURL.length-1),l=o.lastIndexOf("/"),c=yield r.file.listDir(o.substring(0,l)+"/",o.substring(l+1));for(let d=0,a=c.length;d<a;d++)if(c[d].isDirectory)yield r.importThisFolder(c[d]);else{let p=c[d].nativeURL.split("org.pjcone.portal/files/")[1],f=c[d].nativeURL.lastIndexOf("/")+1,x=c[d].nativeURL.substring(0,f);console.log(p),console.log(x),console.log(c[d].name);try{let m=yield r.file.readAsDataURL(x,c[d].name);console.log("\ubd88\ub7ec\uc624\uae30 \uc131\uacf5: ",m)}catch(m){console.log("\ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",m)}}})()}SelectImportFolder(){this.cant_dedicated?document.getElementById("folder_sel_id").click():this.BrowseExternalFiles()}inputImageSelected(i){var r=this;return(0,g.Z)(function*(){let o=yield r.loadingCtrl.create({message:r.lang.text.UserFsDir.LoadingExplorer});o.present();for(let l=0,c=i.target.files.length;l<c;l++)yield r.indexed.saveBlobToUserPath(i.target.files[l],i.target.files[l].webkitRelativePath);r.LoadAllIndexedFiles(),o.dismiss()})()}RemoveDirectoryRecursive(){var i=this;this.alertCtrl.create({header:this.CurrentDir.substring(this.CurrentDir.lastIndexOf("/")+1),message:this.lang.text.UserFsDir.RemoveThisFolder,buttons:[{text:this.lang.text.UserFsDir.RemoveApply,handler:()=>{this.indexed.GetFileListFromDB(this.CurrentDir,r=>{r.forEach(function(){var o=(0,g.Z)(function*(l){return yield i.indexed.removeFileFromUserPath(l)});return function(l){return o.apply(this,arguments)}}());for(let o=this.DirList.length-1;o>=0;o--)0==this.DirList[o].path.indexOf(this.CurrentDir)&&this.DirList.splice(o,1);for(let o=this.FileList.length-1;o>=0;o--)0==this.FileList[o].path.indexOf(this.CurrentDir)&&this.FileList.splice(o,1);this.MoveToUpDir()})}}]}).then(r=>r.present())}RemoveFile(i,r){this.alertCtrl.create({header:this.lang.text.UserFsDir.DeleteFile,message:this.lang.text.UserFsDir.CannotBeUndo,buttons:[{text:this.lang.text.UserFsDir.DeleteAccept,handler:()=>{this.indexed.removeFileFromUserPath(i.path,()=>{this.FileList.splice(r,1)})}}]}).then(o=>o.present())}ionViewDidLeave(){this.FileList.forEach(i=>{URL.revokeObjectURL(i.thumbnail)})}ionViewWillLeave(){document.removeEventListener("ionBackButton",this.EventListenerAct)}}return(t=s).\u0275fac=function(i){return new(i||t)(e.Y36(_.IN),e.Y36(T.H),e.Y36(_.HT),e.Y36(b.b),e.Y36(w.AN),e.Y36(I.F),e.Y36(_.Br),e.Y36(P.H7),e.Y36(y.$),e.Y36(_.SH))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-user-fs-dir"]],viewQuery:function(i,r){if(1&i&&e.Gf(C,5),2&i){let o;e.iGM(o=e.CRH())&&(r.FileSel=o.first)}},decls:9,vars:3,consts:[["slot","start"],["defaultHref","portal/settings"],[4,"ngIf"],[4,"ngFor","ngForOf"],["FileSel",""],["button",""],["slot","start","name","folder"],["style","padding-right: 4px;",3,"click",4,"ngIf"],[3,"click"],["button","",3,"click"],[2,"padding-right","4px",3,"click"],["slot","start","name","arrow-down-circle"],["hidden","","type","file","id","folder_sel_id","webkitdirectory","",3,"change"],["slot","start","name","eye-outline"],["button","",3,"click",4,"ngIf"],[3,"value",4,"ngIf"],[3,"value"],["slot","header"],["slot","start","name","image",4,"ngIf"],["slot","start","name","musical-notes",4,"ngIf"],["slot","start","name","play-circle",4,"ngIf"],["slot","start","name","reader",4,"ngIf"],["slot","start","name","extension-puzzle",4,"ngIf"],["slot","start","name","document",4,"ngIf"],["text-wrap","",4,"ngIf"],["slot","content"],["class","ion-text-right",3,"click",4,"ngIf"],[1,"ion-text-end",3,"click"],["class","image_front_form",3,"click",4,"ngIf"],[1,"ion-text-end"],["slot","start","name","image"],["slot","start","name","musical-notes"],["slot","start","name","play-circle"],["slot","start","name","reader"],["slot","start","name","extension-puzzle"],["slot","start","name","document"],["text-wrap",""],[1,"ion-text-right",3,"click"],[1,"image_front_form",3,"click"],[1,"image_front_view",3,"src","alt"],["color","medium"],["button","","disabled","",3,"click",4,"ngIf"],["button","","disabled","",4,"ngIf"],["button","","disabled","",3,"click"],["button","","disabled",""]],template:function(i,r){1&i&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e._uU(3),e.qZA(),e.TgZ(4,"ion-buttons",0),e._UZ(5,"ion-back-button",1),e.qZA()()(),e.TgZ(6,"ion-content"),e.YNc(7,W,7,4,"ion-list",2),e.YNc(8,ie,6,1,"ion-list",2),e.qZA()),2&i&&(e.xp6(3),e.Oqu(r.lang.text.Settings.InAppExplorer),e.xp6(4),e.Q6J("ngIf",r.InAppBrowser),e.xp6(1),e.Q6J("ngIf",!r.InAppBrowser))},dependencies:[h.sg,h.O5,_.We,_.eh,_.oU,_.YG,_.Sm,_.W2,_.Gu,_.gu,_.Ie,_.Q$,_.q_,_.wd,_.sr,_.cs],styles:[".item.sc-ion-label-md-h[_ngcontent-%COMP%], .item[_ngcontent-%COMP%]   .sc-ion-label-md-h[_ngcontent-%COMP%]{overflow:unset}.image_front_form[_ngcontent-%COMP%]{text-align:center}.image_front_view[_ngcontent-%COMP%]{max-height:233px}"]}),s})()}];let ne=(()=>{var t;class s{}return(t=s).\u0275fac=function(i){return new(i||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[v.Bz.forChild(te),v.Bz]}),s})(),re=(()=>{var t;class s{}return(t=s).\u0275fac=function(i){return new(i||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[h.ez,U.u5,_.Pc,ne]}),s})()}}]);