"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6810],{6810:(G,E,d)=>{d.r(E),d.d(E,{EnginepptPageModule:()=>j});var S=d(6814),m=d(95),g=d(1325),b=d(5877),u=d(5861),h=d(3641),x=d(9868),e=d(9468),Z=d(3857),w=d(6052),A=d(7488);let O=(()=>{var s;class c{constructor(t){this.statusBar=t,this.list={},this.addresses=[]}initialize(t,n,o,a){if("DesktopPWA"!=h.n$&&"MobilePWA"!=h.n$){if(null!=this.list[t])return void console.warn("\ub3d9\uc77c\ud55c \uc11c\ubc84 \uad6c\uc131\uc774 \uc774\ubbf8 \uc874\uc7ac\ud568: ",this.list);this.statusBar.tools[t]="pending",this.list[t]={},this.list[t].OnConnected={},this.list[t].OnDisconnected={},this.list[t].server||(this.list[t].server=cordova.plugins.wsserver),this.check_addresses(t),this.list[t].server.start(n,{onFailure:(r,l,p)=>{this.onServerClose(t),this.stop(t)},onOpen:r=>{if(this.list[t].users?(console.log("1:1 \ub9e4\uce6d\uc774 \uc644\ub8cc\ub428"),this.list[t].server.close({uuid:r.uuid},4001,"\ud5c8\uc6a9\ub418\uc9c0 \uc54a\uc740 \uc0ac\uc6a9\uc790")):(this.list[t].users=r.uuid,this.statusBar.tools[t]="certified"),this.list[t].OnConnected){let l=Object.keys(this.list[t].OnConnected);for(let p=0,v=l.length;p<v;p++)this.list[t].OnConnected[l[p]]()}},onMessage:(r,l)=>{try{let p=JSON.parse(l);a(p)}catch(p){console.error(`Tool-server_json \ubcc0\ud658 \uc624\ub958_${l}: ${p}`)}},onClose:(r,l,p,v)=>{if(this.statusBar.tools[t]="online",delete this.list[t].users,this.list[t].OnDisconnected){let f=Object.keys(this.list[t].OnDisconnected);for(let _=0,P=f.length;_<P;_++)this.list[t].OnDisconnected[f[_]]()}},origins:[],protocols:[],tcpNoDelay:!0},(r,l)=>{this.statusBar.tools[t]="online",o&&o()},r=>{this.onServerClose(t),this.stop(t)})}else this.stop(t)}stop(t){"DesktopPWA"!=h.n$&&"MobilePWA"!=h.n$&&this.list[t].server.stop((n,o)=>{this.onServerClose(t),delete this.list[t]})}onServerClose(t){delete this.list[t].users,this.statusBar.tools[t]="missing",setTimeout(()=>{this.statusBar.tools[t]="offline"},1e3)}check_addresses(t){"DesktopPWA"!=h.n$&&"MobilePWA"!=h.n$&&(this.list[t].server||(this.list[t].server=cordova.plugins.wsserver),this.list[t].server.getInterfaces(n=>{this.addresses.length=0;let o=Object.keys(n);for(let a=0,r=o.length;a<r;a++)this.addresses=[...this.addresses,...n[o[a]].ipv4Addresses]}))}send_to(t,n){this.list[t].users&&this.list[t].server.send({uuid:this.list[t].users},n)}}return(s=c).\u0275fac=function(t){return new(t||s)(e.LFG(A.g))},s.\u0275prov=e.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),c})();var J=d(797),M=d(9376),I=d(4093);function N(s,c){if(1&s&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e._uU(3),e.qZA(),e.TgZ(4,"ion-buttons",3),e._UZ(5,"ion-back-button",4),e.qZA()()()),2&s){const i=e.oxw();e.xp6(3),e.Oqu(i.lang.text.Settings.EnginePPT)}}function B(s,c){1&s&&e._UZ(0,"div",5)}function D(s,c){if(1&s){const i=e.EpF();e.TgZ(0,"div")(1,"ion-item-divider")(2,"ion-label"),e._uU(3),e.qZA()(),e.TgZ(4,"textarea",6),e.NdJ("ngModelChange",function(n){e.CHM(i);const o=e.oxw();return e.KtG(o.RemoteDesc=n)}),e.qZA()()}if(2&s){const i=e.oxw();e.xp6(3),e.Oqu(i.lang.text.EngineWorksPPT.Manual),e.xp6(1),e.Q6J("ngModel",i.RemoteDesc)}}function F(s,c){if(1&s){const i=e.EpF();e.TgZ(0,"div")(1,"ion-item-divider")(2,"ion-label"),e._uU(3),e.qZA()(),e.TgZ(4,"ion-item")(5,"ion-input",10),e.NdJ("ngModelChange",function(n){e.CHM(i);const o=e.oxw(2);return e.KtG(o.InputAddress=n)}),e.qZA()(),e.TgZ(6,"ion-item",11),e.NdJ("click",function(){e.CHM(i);const n=e.oxw(2);return e.KtG(n.ConnectToAddress())}),e.TgZ(7,"ion-label",8),e._uU(8),e.qZA()()()}if(2&s){const i=e.oxw(2);e.xp6(3),e.Oqu(i.lang.text.EngineWorksPPT.ManualLink),e.xp6(2),e.Q6J("label",i.lang.text.EngineWorksPPT.Address)("ngModel",i.InputAddress)("placeholder",i.lang.text.EngineWorksPPT.InputAddress+" (IPv4)"),e.xp6(1),e.Q6J("disabled",i.ConnectButtonDisabled),e.xp6(2),e.Oqu(i.lang.text.EngineWorksPPT.Connect)}}function L(s,c){if(1&s){const i=e.EpF();e.TgZ(0,"div"),e.YNc(1,F,9,6,"div",0),e.TgZ(2,"ion-item-divider")(3,"ion-label"),e._uU(4),e.qZA()(),e.TgZ(5,"ion-item",7),e.NdJ("click",function(){e.CHM(i);const n=e.oxw();return e.KtG(n.buttonClickLinkInputFile())}),e.TgZ(6,"ion-label",8),e._uU(7),e.qZA()(),e.TgZ(8,"input",9),e.NdJ("change",function(n){e.CHM(i);const o=e.oxw();return e.KtG(o.inputpckselected(n))}),e.qZA()()}if(2&s){const i=e.oxw();e.xp6(1),e.Q6J("ngIf",!i.LinkedAddress&&!i.isSSLConnect),e.xp6(3),e.Oqu(i.lang.text.EngineWorksPPT.JustStart),e.xp6(3),e.Oqu(i.lang.text.EngineWorksPPT.DropFileHere),e.xp6(1),e.Q6J("id",i.engine_ppt_file_sel)}}function U(s,c){if(1&s){const i=e.EpF();e.TgZ(0,"div")(1,"ion-item",12),e._UZ(2,"div",13),e.TgZ(3,"ion-label",14),e._uU(4),e.qZA()(),e.TgZ(5,"ion-item",11),e.NdJ("click",function(){e.CHM(i);const n=e.oxw();return e.KtG(n.buttonClickSelectPckFromMobile())}),e.TgZ(6,"ion-label"),e._uU(7),e.qZA()(),e.TgZ(8,"input",9),e.NdJ("change",function(n){e.CHM(i);const o=e.oxw();return e.KtG(o.mobilepckselected(n))}),e.qZA(),e.TgZ(9,"ion-item",7),e.NdJ("click",function(){e.CHM(i);const n=e.oxw();return e.KtG(n.CreateEngineController())}),e.TgZ(10,"ion-label",8),e._uU(11),e.qZA()()()}if(2&s){const i=e.oxw();e.xp6(2),e.Akn("background-color: "+i.statusBar.colors[i.statusBar.tools.engineppt||"offline"]),e.xp6(2),e.Oqu(i.lang.text.EngineWorksPPT.RemoteServer),e.xp6(1),e.Q6J("disabled","certified"!=i.statusBar.tools.engineppt),e.xp6(2),e.Oqu(i.lang.text.EngineWorksPPT.StartFromMobile),e.xp6(1),e.Q6J("id",i.engine_ppt_mobile_sel),e.xp6(3),e.Oqu(i.lang.text.EngineWorksPPT.StartRemote)}}function H(s,c){1&s&&e._UZ(0,"div",15)}const $=[{path:"",component:(()=>{var s;class c{constructor(t,n,o,a,r,l,p,v,f){this.lang=t,this.global=n,this.toolServer=o,this.indexed=a,this.p5toast=r,this.loadingCtrl=l,this.statusBar=p,this.navCtrl=v,this.noti=f,this.EventListenerAct=_=>{_.detail.register(150,()=>{})},this.ToggleHeader=!0,this.Status="initialize",this.InputAddress="",this.LinkedAddress="",this.isSSLConnect=!1,this.engine_ppt_file_sel="",this.SelectedFile=[],this.ConnectButtonDisabled=!1,this.engine_ppt_mobile_sel=""}ngOnInit(){this.engine_ppt_file_sel=`engine_ppt_file_sel_${(new Date).getTime()}`,this.engine_ppt_mobile_sel=`engine_ppt_mobile_sel_${(new Date).getTime()}`,this.isSSLConnect="https:"==window.location.protocol}ionViewWillEnter(){this.prerequisite_check()}prerequisite_check(){this.load_info_text(),"Android"==h.n$||"iOS"==h.n$?(this.Status="initApp",this.StartRemoteContrServer()):(this.Status="initPWA","DesktopPWA"==h.n$&&setTimeout(()=>{this.CreateDrop()},50))}CreateDrop(){var t=this;let n=document.getElementById("p5Drop");this.p5canvas=new x(o=>{o.setup=()=>{let a=o.createCanvas(n.clientWidth,n.clientHeight);o.pixelDensity(1),a.parent(n),a.drop(function(){var r=(0,u.Z)(function*(l){t.StartPresentation(l.name,l.file)});return function(l){return r.apply(this,arguments)}}())},o.mouseMoved=a=>{a.dataTransfer?(n.style.pointerEvents="all",n.style.backgroundColor="#0008"):(n.style.pointerEvents="none",n.style.backgroundColor="transparent")}})}buttonClickLinkInputFile(){document.getElementById(this.engine_ppt_file_sel).click()}inputpckselected(t){var n=this;return(0,u.Z)(function*(){n.StartPresentation(t.target.files[0].name,t.target.files[0])})()}StartPresentation(t,n){var o=this;return(0,u.Z)(function*(){"pck"==t.substring(t.lastIndexOf(".")+1)?(yield o.indexed.saveBlobToUserPath(n,"engineppt/presentation_this.pck"),o.CreateEnginePPT()):o.p5toast.show({text:o.lang.text.EngineWorksPPT.FileExtPck})})()}CreateEnginePPT(){this.ToggleHeader=!1,this.Status="OnPresentation",this.p5canvas&&this.p5canvas.remove(),setTimeout(()=>{this.TempWs&&this.TempWs.readyState==this.TempWs.OPEN&&this.TempWs.close(),this.global.CreateGodotIFrame("engineppt",{local_url:"assets/data/godot/engineppt.pck",title:"EnginePPT",remoteAddr:this.LinkedAddress,p5toast:t=>{this.p5toast.show({text:t})},dismiss:()=>{this.navCtrl.back()}})},0)}load_info_text(){this.p5canvas=new x(t=>{t.noCanvas(),t.loadStrings(`assets/data/infos/${this.lang.lang}/engine_remote.txt`,n=>{this.RemoteDesc=n.join("\n")})})}StartRemoteContrServer(){this.toolServer.initialize("engineppt",12021,()=>{this.toolServer.list.engineppt.OnConnected.show_noti=()=>{this.noti.PushLocal({id:13,title:this.lang.text.EngineWorksPPT.ClientConnected,body:this.lang.text.EngineWorksPPT.UsePPTRemote,group_ln:"engineppt",smallIcon_ln:"engineppt",iconColor_ln:"478cbf",autoCancel_ln:!0},"engineppt")},this.toolServer.list.engineppt.OnDisconnected.remove_noti=()=>{this.noti.ClearNoti(13)},this.toolServer.list.engineppt.OnDisconnected.showDisconnected=()=>{"OnPresentation"==this.Status&&this.p5toast.show({text:this.lang.text.EngineWorksPPT.Disconnected})}},t=>{switch(console.log("\uc218\uc2e0\ubc1b\uc740 \uba54\uc2dc\uc9c0\ub294: ",t),t.act){case"react":let n=this.SelectedFile.shift();this.toolServer.send_to("engineppt",n?JSON.stringify({act:"part",data:n}):JSON.stringify({act:"eof"}));break;case"exit":this.Status="initApp";break;default:console.log("\uc608\uc0c1\ud558\uc9c0 \uc54a\uc740 \uc218\uc2e0\uac12: ",t)}})}ConnectToAddress(){var t=this;return(0,u.Z)(function*(){if(t.InputAddress=t.InputAddress.trim(),t.InputAddress){t.ConnectButtonDisabled=!0;try{t.LinkedAddress=yield t.CatchAvailableAddress([t.InputAddress])}catch{t.p5toast.show({text:t.lang.text.EngineWorksPPT.CannotConnect})}t.ConnectButtonDisabled=!1}else t.p5toast.show({text:t.lang.text.EngineWorksPPT.NeedAddress})})()}buttonClickSelectPckFromMobile(){document.getElementById(this.engine_ppt_mobile_sel).click()}mobilepckselected(t){var n=this;return(0,u.Z)(function*(){if(!n.toolServer.list.engineppt.users)return void n.p5toast.show({text:n.lang.text.EngineWorksPPT.NeedLink});let o=t.target.files[0].name;if("pck"!=o.substring(o.lastIndexOf(".")+1))return void n.p5toast.show({text:n.lang.text.EngineWorksPPT.FileExtPck});yield n.indexed.saveBlobToUserPath(t.target.files[0],"tmp_files/engineppt_selected.pck");let r=yield n.global.GetBase64ThroughFileReader(t.target.files[0]),p=Math.ceil(r.length/22e4);n.SelectedFile=r.match(/(.{1,220000})/g),n.toolServer.send_to("engineppt",JSON.stringify({act:"init",size:p,total:r.length}))})()}CatchAvailableAddress(t){var n=this;return new Promise(function(){var o=(0,u.Z)(function*(a,r){let l;for(let p=0,v=t.length;p<v;p++)try{l=yield new Promise(function(){var _=(0,u.Z)(function*(P,y){let W="",T=yield n.loadingCtrl.create({message:n.lang.text.EngineWorksPPT.ReceivingFile});n.TempWs=new WebSocket(`ws://${t[p]}:12021`),n.TempWs.onopen=k=>{P(t[p])},n.TempWs.onmessage=k=>{let C=JSON.parse(k.data);switch(C.act){case"init":T.present(),n.TempWs.send(JSON.stringify({act:"react"}));break;case"part":W+=C.data,n.TempWs.send(JSON.stringify({act:"react"}));break;case"eof":n.indexed.saveBase64ToUserPath(W,"engineppt/presentation_this.pck",R=>{T.dismiss(),n.CreateEnginePPT()});break;default:console.log("\uc608\uc0c1\ud558\uc9c0 \uc54a\uc740 \uc11c\ubc84 \uc218\uc2e0\uac12: ",C)}},n.TempWs.onclose=k=>{n.LinkedAddress="",T.dismiss(),"OnPresentation"!=n.Status&&n.p5toast.show({text:n.lang.text.EngineWorksPPT.Disconnected}),y("onclose")}});return function(P,y){return _.apply(this,arguments)}}());break}catch(f){console.log("CatchAvailableAddress: ",f),n.TempWs.close()}l?(n.p5toast.show({text:`${n.lang.text.EngineWorksPPT.ReadyToConnect}: ${l}`}),a(l)):(n.LinkedAddress="",r("\uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uc8fc\uc18c \uc5c6\uc74c"))});return function(a,r){return o.apply(this,arguments)}}())}CreateEngineController(){this.Status="OnPresentation",this.noti.ClearNoti(13),this.p5canvas&&this.p5canvas.remove(),document.addEventListener("ionBackButton",this.EventListenerAct),this.send_device_rotation();let t=!0,n={};setTimeout(()=>{this.global.CreateGodotIFrame("engineppt",{local_url:"assets/data/godot/engineppt.pck",title:"EnginePPTContr",pointer_pos:(o="")=>{let a=JSON.parse(o);n={...n,...a},t&&(this.toolServer.send_to("engineppt",JSON.stringify({...n})),Object.keys(n).forEach(l=>delete n[l]),t=!1,setTimeout(()=>{t=!0},60))}})},0)}send_device_rotation(){this.p5gyro=new x(t=>{t.setup=()=>{t.noCanvas()},t.draw=()=>{this.global.godot_window.set_horizontal_rot&&this.global.godot_window.set_horizontal_rot(t.rotationZ),this.global.godot_window.set_vertical_rot&&this.global.godot_window.set_vertical_rot(t.rotationX)}})}ionViewWillLeave(){document.removeEventListener("ionBackButton",this.EventListenerAct),this.toolServer.stop("engineppt"),this.indexed.removeFileFromUserPath("engineppt/presentation_this.pck"),this.TempWs&&this.TempWs.close(),this.p5canvas&&this.p5canvas.remove(),this.p5gyro&&this.p5gyro.remove(),this.noti.ClearNoti(13)}}return(s=c).\u0275fac=function(t){return new(t||s)(e.Y36(Z.b),e.Y36(w.AN),e.Y36(O),e.Y36(J.H),e.Y36(M.F),e.Y36(g.HT),e.Y36(A.g),e.Y36(g.SH),e.Y36(I.J))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-engineppt"]],decls:7,vars:6,consts:[[4,"ngIf"],["id","p5Drop","style","position: absolute; width: 100%; height: 100%; display: flex;",4,"ngIf"],["class","full_screen","style","display: flex;","id","engineppt",4,"ngIf"],["slot","start"],["defaultHref",""],["id","p5Drop",2,"position","absolute","width","100%","height","100%","display","flex"],["disabled","",1,"infobox",2,"height","280px",3,"ngModel","ngModelChange"],["button","",3,"click"],[1,"ion-text-center"],["hidden","","type","file","accept","*",3,"id","change"],[1,"ion-text-end",3,"label","ngModel","placeholder","ngModelChange"],["button","",3,"disabled","click"],["button",""],[1,"additional_form","status_bar_single"],[1,"form_margin"],["id","engineppt",1,"full_screen",2,"display","flex"]],template:function(t,n){1&t&&(e.YNc(0,N,6,1,"ion-header",0),e.TgZ(1,"ion-content"),e.YNc(2,B,1,0,"div",1),e.YNc(3,D,5,2,"div",0),e.YNc(4,L,9,4,"div",0),e.YNc(5,U,12,7,"div",0),e.YNc(6,H,1,0,"div",2),e.qZA()),2&t&&(e.Q6J("ngIf",n.ToggleHeader),e.xp6(2),e.Q6J("ngIf","initPWA"==n.Status),e.xp6(1),e.Q6J("ngIf","OnPresentation"!=n.Status),e.xp6(1),e.Q6J("ngIf","initPWA"==n.Status),e.xp6(1),e.Q6J("ngIf","initApp"==n.Status),e.xp6(1),e.Q6J("ngIf","OnPresentation"==n.Status))},dependencies:[S.O5,m.Fj,m.JJ,m.On,g.oU,g.Sm,g.W2,g.Gu,g.pK,g.Ie,g.rH,g.Q$,g.wd,g.sr,g.j9,g.cs]}),c})()}];let Y=(()=>{var s;class c{}return(s=c).\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[b.Bz.forChild($),b.Bz]}),c})(),j=(()=>{var s;class c{}return(s=c).\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[S.ez,m.u5,g.Pc,Y]}),c})()}}]);