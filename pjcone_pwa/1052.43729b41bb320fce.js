"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1052],{1052:(xe,de,y)=>{y.d(de,{S:()=>ve});var N=y(1528),j=y(9352),ue=y(5193),d=y(4496),ge=y(4500),D=y(5624),we=y(9240),me=y(5020),_e=y(4668),ye=y(3824);let ve=(()=>{var V;class re{constructor(r,o,w,e,s,f,h,L){this.lang=r,this.modalCtrl=o,this.alertCtrl=w,this.loadingCtrl=e,this.global=s,this.navParams=f,this.indexed=h,this.p5toast=L,this.BackButtonPressed=!1,this.EventListenerAct=S=>{S.detail.register(130,P=>{})},this.isMobile=!1,this.isCropMode=!1,this.WithoutSave=!0}InitBrowserBackButtonOverride(){window.history.replaceState(null,null,window.location.href),window.onpopstate=()=>{this.BackButtonPressed||(this.BackButtonPressed=!0,this.modalCtrl.dismiss())}}ngOnInit(){this.InitBrowserBackButtonOverride()}ionViewDidEnter(){var r=this;return(0,N.c)(function*(){r.AddShortCut(),document.addEventListener("ionBackButton",r.EventListenerAct),r.mainLoading=yield r.loadingCtrl.create({message:r.lang.text.voidDraw.UseThisImage}),r.create_new_canvas({width:r.navParams.data.width,height:r.navParams.data.height,path:r.navParams.data.path}),r.isMobile="DesktopPWA"!=ue.s1})()}AddShortCut(){delete this.global.p5key.KeyShortCut.Digit,this.global.p5key.KeyShortCut.HistoryAct=r=>{switch(r){case"Z":this.p5voidDraw.history_act(-1);break;case"X":this.p5voidDraw.history_act(1);break;case"C":this.isCropMode?this.p5voidDraw.apply_crop():this.p5voidDraw.change_color();break;case"V":this.p5voidDraw.set_line_weight()}},this.global.p5key.KeyShortCut.AddAct=()=>{this.p5toast.show({text:this.lang.text.voidDraw.Preparing})},this.global.p5key.KeyShortCut.SKeyAct=()=>{this.open_crop_tool()},this.global.p5key.KeyShortCut.DeleteAct=()=>{this.isCropMode?this.p5voidDraw.apply_crop():this.dismiss_draw()},this.global.p5key.KeyShortCut.FKeyAct=()=>{}}create_new_canvas(r){var o=this;return(0,N.c)(function*(){r.width=r.width||432,r.height=r.height||432,o.p5voidDraw&&o.p5voidDraw.remove(),o.create_p5voidDraw(r)})()}waiting(r){return new Promise(o=>setTimeout(()=>{o(void 0)},r))}create_p5voidDraw(r){var o=this;let w=document.getElementById("voidDraw");this.isCropMode=!1,this.p5voidDraw=new j(e=>{let s,f,h,L,S,P,R,O,H=e.createColorPicker("#000"),Z=Math.min(r.width,r.height)/100,J=1;e.setup=(0,N.c)(function*(){e.pixelDensity(1),e.noLoop(),e.noFill(),e.imageMode(e.CENTER),L=e.createCanvas(w.clientWidth,w.clientHeight),L.parent(w),v.x=e.width/2,v.y=e.height/2,e.set_line_weight=()=>{o.alertCtrl.create({header:o.lang.text.voidDraw.changeWeight,inputs:[{label:o.lang.text.voidDraw.weight,name:"weight",placeholder:`${J}`,type:"number"}],buttons:[{text:o.lang.text.voidDraw.apply,handler:l=>{l.weight&&(J=Number(l.weight))}}]}).then(l=>{p=!1,l.onWillDismiss().then(()=>{p=!0}),l.present()})},e.change_color=()=>{H.elt.click()},e.save_image=()=>{new j(l=>{l.setup=()=>{let A=l.createCanvas(s.width,s.height);l.pixelDensity(1),h&&l.image(h,0,0),s&&l.image(s,0,0);let T=A.elt.toDataURL("image/png").replace("image/png","image/octet-stream");o.modalCtrl.dismiss({name:`voidDraw_${l.year()}-${l.nf(l.month(),2)}-${l.nf(l.day(),2)}_${l.nf(l.hour(),2)}-${l.nf(l.minute(),2)}-${l.nf(l.second(),2)}.png`,img:T,loadingCtrl:o.mainLoading}),l.remove()}})},e.history_act=l=>{switch(E=e.min(e.max(0,E+l),e.DrawingStack.length),l){case 1:e.DrawingStack.length&&(R.style.fill="var(--ion-color-dark)"),E==e.DrawingStack.length&&(O.style.fill="var(--ion-color-medium)"),Q(s,e.DrawingStack[E-1]);break;case-1:e.DrawingStack.length&&(O.style.fill="var(--ion-color-dark)"),E<1?(R.style.fill="var(--ion-color-medium)",s.clear(255,255,255,255),e.redraw()):se()}},e.open_crop_tool=()=>{o.isCropMode?(o.isCropMode=!1,e.redraw()):(o.isCropMode=!0,n.x=s.width,n.y=s.height,b.x=0,b.y=0,e.redraw())},e.apply_crop=()=>{o.isMobile&&b.div(u),s.resizeCanvas(n.x,n.y),f=e.createVector(s.width/2,s.height/2),k.sub(b),se(),h.resizeCanvas(n.x,n.y),h.push(),h.background(o.navParams.data.isDarkMode?26:255),h.translate(k),e.BaseImage&&h.image(e.BaseImage,0,0),h.pop(),h.redraw(),o.isCropMode=!1,e.SetCanvasViewportInit()},S=e.createElement("table"),S.style("position: absolute; top: 0px;"),S.style(`width: 100%; height: ${m}px;`),S.style("background-color: var(--voidDraw-menu-background);"),S.parent(w);let t=S.elt.insertRow(0),i=t.insertCell(0);i.innerHTML='<ion-icon id="AddTextIcon" style="width: 27px; height: 27px" name="text"></ion-icon>',document.getElementById("AddTextIcon").style.fill="var(--ion-color-medium)",i.style.textAlign="center",i.style.cursor="pointer",i.onclick=()=>{o.p5toast.show({text:o.lang.text.voidDraw.Preparing})};let a=t.insertCell(1);a.innerHTML='<ion-icon style="width: 27px; height: 27px" name="crop"></ion-icon>',a.style.textAlign="center",a.style.cursor="pointer",a.onclick=()=>{o.open_crop_tool()};let _=t.insertCell(2);_.innerHTML='<ion-icon style="width: 27px; height: 27px" name="checkmark"></ion-icon>',_.style.textAlign="center",_.style.cursor="pointer",_.onclick=()=>{o.dismiss_draw()},P=e.createElement("table"),P.style("position: absolute; bottom: 0px;"),P.style(`width: 100%; height: ${m}px;`),P.style("background-color: var(--voidDraw-menu-background);"),P.parent(w);let C=P.elt.insertRow(0),M=C.insertCell(0);M.innerHTML='<ion-icon id="undoIcon" style="width: 27px; height: 27px" name="arrow-undo"></ion-icon>',R=document.getElementById("undoIcon"),R.style.fill="var(--ion-color-medium)",M.style.textAlign="center",M.style.cursor="pointer",M.onclick=()=>{o.p5voidDraw.history_act(-1)};let G=C.insertCell(1);G.innerHTML='<ion-icon id="redoIcon" style="width: 27px; height: 27px" name="arrow-redo"></ion-icon>',O=document.getElementById("redoIcon"),O.style.fill="var(--ion-color-medium)",G.style.textAlign="center",G.style.cursor="pointer",G.onclick=()=>{o.p5voidDraw.history_act(1)};let F=C.insertCell(2);H.parent(F),F.style.textAlign="center",F.style.cursor="pointer",F.onclick=()=>{H.elt.click()};let z=C.insertCell(3);if(z.innerHTML='<ion-icon style="width: 27px; height: 27px" name="pencil"></ion-icon>',z.style.textAlign="center",z.style.cursor="pointer",z.onclick=()=>{o.change_line_weight()},e.SetCanvasViewportInit=()=>{L.hide(),e.resizeCanvas(w.clientWidth,w.clientHeight),U.x=e.width/2,U.y=e.height/2,v.x=0,v.y=0;let l=w.clientHeight-112;u=w.clientWidth/l<s.width/s.height?w.clientWidth/s.width:l/s.height,L.show(),e.redraw()},s=e.createGraphics(r.width,r.height),f=e.createVector(s.width/2,s.height/2),s.pixelDensity(1),s.noLoop(),s.noFill(),e.ActualCanvas=s,h=e.createGraphics(r.width,r.height),h.pixelDensity(1),h.noLoop(),h.noFill(),h.background(o.navParams.data.isDarkMode?26:255),e.ImageCanvas=h,r.path){let l=yield o.indexed.loadBlobFromUserPath(r.path,""),A=URL.createObjectURL(l);e.loadImage(A,T=>{e.BaseImage=T,h.image(e.BaseImage,0,0),h.redraw(),URL.revokeObjectURL(A),e.SetCanvasViewportInit()},T=>{console.error("\uadf8\ub9bc\ud310 \ubc30\uacbd \uc774\ubbf8\uc9c0 \ubd88\ub7ec\uc624\uae30 \uc624\ub958: ",T),h.redraw(),URL.revokeObjectURL(A),e.SetCanvasViewportInit()})}else h.redraw(),e.SetCanvasViewportInit();r.width<r.height&&(Z/=u)});let v=e.createVector(),u=1,U=e.createVector(0,0),k=e.createVector(),b=e.createVector(),n=e.createVector();e.draw=()=>{if(e.clear(255,255,255,255),e.push(),e.translate(U),e.scale(u),e.translate(v),e.image(h,0,0),e.image(h,0,0),s&&e.image(h,0,0),s&&e.image(s,0,0),this.isCropMode)e.push(),e.translate(-s.width/2,-s.height/2),e.translate(b),e.noStroke(),e.fill(0,100),e.rect(0,0,n.x,n.y),e.stroke(255,0,0),e.strokeWeight(8),e.beginShape(e.LINES),e.vertex(0,0),e.vertex(n.x,0),e.vertex(n.x,0),e.vertex(n.x,.8*n.y),e.vertex(0,0),e.vertex(0,n.y),e.vertex(0,n.y),e.vertex(.8*n.x,n.y),e.stroke(255,255,0),e.vertex(.8*n.x,n.y),e.vertex(n.x,n.y),e.vertex(n.x,.8*n.y),e.vertex(n.x,n.y),e.endShape(),e.pop();else if(c&&c.pos&&c.pos.length){e.push(),e.translate(k),e.stroke(c.color),e.strokeWeight(c.weight),e.beginShape();for(let t=0,i=c.pos.length;t<i;t++)e.curveVertex(c.pos[t].x-f.x,c.pos[t].y-f.y);e.endShape(),e.pop()}e.pop()},e.DrawingStack=[];let E=0,se=()=>{s.clear(255,255,255,255);for(let t=0;t<E;t++)Q(s,e.DrawingStack[t])},Q=(t,i=c)=>{if(i.color){t.push(),t.translate(k),t.stroke(i.color),t.strokeWeight(i.weight),t.beginShape();for(let a=0,_=i.pos.length;a<_;a++)t.curveVertex(i.pos[a].x,i.pos[a].y);t.endShape(),t.pop(),t.redraw(),e.redraw()}};e.windowResized=()=>{setTimeout(()=>{e.SetCanvasViewportInit()},0)};let c={};const m=56;let q,B,ee,te,le,W,oe,ie=0,X=!1,x=!1;e.mousePressed=t=>{if(p){if(e.mouseY<m||e.mouseY>e.height-m)return void(x=!0);switch(t.which){case 1:this.isCropMode?ne():ce();break;case 3:B=e.createVector(e.mouseX,e.mouseY),W=v.copy(),q=e.createVector(e.mouseX,e.mouseY);break;case 2:e.SetCanvasViewportInit()}}};let ne=(t,i)=>{let a=I(t,i),_=b.copy().add(n).sub(e.createVector(s.width/2,s.height/2)),C=a.dist(_),M=.2*e.max(n.x,n.y);X=C<M,X?(te=e.createVector(e.mouseX,e.mouseY),oe=n.copy()):ee=e.createVector(e.mouseX,e.mouseY).sub(b.mult(u))},ce=(t,i)=>{R.style.fill="var(--ion-color-dark)",O.style.fill="var(--ion-color-medium)";let a=I(t,i);a.sub(k),a.add(f);let _={x:a.x,y:a.y},C=H.color().levels,M=`#${e.hex(C[0],2)}${e.hex(C[1],2)}${e.hex(C[2],2)}`;c={pos:[],color:M,weight:Z*J},c.pos.push(_),c.pos.push(_),e.redraw()};e.mouseDragged=t=>{if(p)switch(t.which){case 1:if(this.isCropMode&&!x){let i=e.createVector(e.mouseX,e.mouseY);X?n=oe.copy().add(te.copy().sub(i).div(-u)):b=ee.copy().sub(i).div(-u),e.redraw()}else{let i=I();i.sub(k),i.add(f),c&&c.pos&&c.pos.push({x:i.x,y:i.y}),e.redraw()}break;case 3:q=e.createVector(e.mouseX,e.mouseY),v=W.copy().add(q.sub(B).div(u)),e.redraw()}},e.mouseWheel=t=>{p&&(e.mouseY<m||e.mouseY>e.height-m?x=!0:(fe(I()),u*=t.deltaY<0?1.1:.9,e.redraw()))},e.mouseReleased=t=>{if(p){if(1===t.which&&!this.isCropMode&&!x){let i=I();i.sub(k),i.add(f);let a={x:i.x,y:i.y};c&&(c.pos.push(a),c.pos.push(a)),he()}x=!1}};let fe=t=>{U=e.createVector(e.mouseX,e.mouseY),v=t.mult(-1)},I=(t,i)=>{let a=e.createVector(t||e.mouseX,i||e.mouseY);return a.sub(U),a.div(u),a.sub(v),a},g=[],Y=!1,p=!0;e.touchStarted=t=>{if(p){if(g=t.touches,t.changedTouches[0].clientY<m||t.changedTouches[0].clientY>e.height-m)return void(x=!0);switch(Y=!0,g.length){case 1:this.isCropMode?ne(t.changedTouches[0].clientX,t.changedTouches[0].clientY-m):ce(t.changedTouches[0].clientX,t.changedTouches[0].clientY-m);break;case 2:let i=e.createVector(g[0].clientX,g[0].clientY-56),a=e.createVector(g[1].clientX,g[1].clientY-56);ie=i.dist(a),B=i.copy().add(a).div(2),W=v.copy(),le=u,c=void 0;break;default:Y=!1,e.SetCanvasViewportInit()}}},e.touchMoved=t=>{if(p&&Y){switch(g=t.touches,g.length){case 1:if(this.isCropMode&&!x){let i=e.createVector(t.changedTouches[0].clientX,t.changedTouches[0].clientY-m);X?n=oe.copy().add(te.copy().sub(i).div(-u)):b=ee.copy().sub(i).div(-u),e.redraw()}else{let i=I(t.changedTouches[0].clientX,t.changedTouches[0].clientY-m);i.sub(k),i.add(f),c&&c.pos&&c.pos.push({x:i.x,y:i.y}),e.redraw()}break;case 2:{let i=e.createVector(g[0].clientX,g[0].clientY-56),a=e.createVector(g[1].clientX,g[1].clientY-56),_=i.copy().add(a).div(2);u=i.dist(a)/ie*le,v=W.copy().add(_.sub(B).div(u)),e.redraw()}}return!1}},e.touchEnded=t=>{if(p&&t.changedTouches){switch(g=t.touches,Y=!1,g.length){case 0:if(!this.isCropMode&&!x&&c){let i=I(t.changedTouches[0].clientX,t.changedTouches[0].clientY-m);i.sub(k),i.add(f);let a={x:i.x,y:i.y};c.pos.push(a),c.pos.push(a),he()}break;case 1:if(!Y)return;Ce(),ie=0,c=void 0}x=!1}};let Ce=()=>{B=e.createVector(g[0].clientX,g[0].clientY-56),W=v.copy()},he=()=>{e.DrawingStack.length=E,c&&(e.DrawingStack.push(c),Q(s,c)),E=e.DrawingStack.length,B=void 0,x=!1,c=void 0,e.redraw()}})}new_image(){this.alertCtrl.create({header:this.lang.text.voidDraw.newDraw,inputs:[{name:"width",type:"number",placeholder:`${this.lang.text.voidDraw.width} (${this.lang.text.voidDraw.default_size}: 432)`},{name:"height",type:"number",placeholder:`${this.lang.text.voidDraw.height} (${this.lang.text.voidDraw.default_size}: 432)`}],buttons:[{text:this.lang.text.voidDraw.CreateNew,handler:o=>{o.width=o.width?Number(o.width):432,o.height=o.height?Number(o.height):432,this.create_new_canvas(o)}}]}).then(o=>o.present())}change_line_weight(){this.p5voidDraw.set_line_weight()}open_crop_tool(){this.p5voidDraw.open_crop_tool()}dismiss_draw(){this.isCropMode?this.p5voidDraw.apply_crop():(this.mainLoading.present(),this.WithoutSave=!1,this.p5voidDraw.save_image())}RemoveShortCut(){delete this.global.p5key.KeyShortCut.HistoryAct,delete this.global.p5key.KeyShortCut.AddAct,delete this.global.p5key.KeyShortCut.DeleteAct,delete this.global.p5key.KeyShortCut.SKeyAct,delete this.global.p5key.KeyShortCut.FKeyAct}ionViewWillLeave(){this.RemoveShortCut(),this.p5voidDraw&&this.p5voidDraw.remove()}ionViewDidLeave(){document.removeEventListener("ionBackButton",this.EventListenerAct),this.WithoutSave&&this.mainLoading.remove()}}return(V=re).\u0275fac=function(r){return new(r||V)(d.GI1(ge.o),d.GI1(D.qS),d.GI1(D.iW),d.GI1(D.Kg),d.GI1(me.A1),d.GI1(we.a6),d.GI1(_e.k),d.GI1(ye.O))},V.\u0275cmp=d.In1({type:V,selectors:[["app-void-draw"]],decls:8,vars:1,consts:[[1,"ion-no-border"],["slot","start",3,"click"],["defaultHref",""],["oncontextmenu","return false;"],["id","voidDraw",1,"full_screen",2,"display","flex","overflow","hidden","background-color","black"]],template:function(r,o){1&r&&(d.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),d.OEk(3),d.C$Y(),d.I0R(4,"ion-buttons",1),d.qCj("click",function(){return o.modalCtrl.dismiss()}),d.wR5(5,"ion-back-button",2),d.C$Y()()(),d.I0R(6,"ion-content",3),d.wR5(7,"div",4),d.C$Y()),2&r&&(d.yG2(3),d.cNF(o.lang.text.ChatRoom.voidDraw))},dependencies:[D.GS,D._i,D.wB,D.tM,D.Md,D.Im]}),re})()}}]);