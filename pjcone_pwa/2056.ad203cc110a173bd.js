"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2056],{2056:(w,l,n)=>{n.r(l),n.d(l,{LinkAccountPageModule:()=>R});var r=n(9808),h=n(4182),s=n(3996),u=n(9705),g=n(358),v=n(5016),t=n(9863),m=n(2313),k=n(3336),A=n(9912),f=n(2855),p=n(3496),L=n(2463),x=n(5742);function C(e,a){if(1&e&&t._UZ(0,"img",4),2&e){const i=t.oxw();t.Q6J("src",i.QRCodeSRC,t.LSH)}}const d="LinkAccount",y=[{path:"",component:(()=>{class e{constructor(i,o,c,b,S,O,Z,T){this.sanitizer=i,this.p5toast=o,this.nakama=c,this.navCtrl=b,this.wsc=S,this.indexed=O,this.device=Z,this.lang=T}ngOnInit(){this.wsc.disconnected[d]=()=>{this.navCtrl.back()},this.indexed.checkIfFileExist("link-account",i=>{this.isOverrided=i}),this.websocket=new WebSocket(`${this.wsc.socket_header}://${this.wsc.address_override||v.GA}:12020`),this.websocket.onmessage=i=>{i.data.text().then(o=>{try{let c=JSON.parse(o);if(!c.uuid)throw new Error("uuid \ubc1b\uae30 \uc2e4\ud328");this.nakama.uuid=c.uuid,this.indexed.saveTextFileToUserPath(this.nakama.uuid,"link-account"),this.p5toast.show({text:this.lang.text.LinkAccount.link_account_succ,lateable:!0}),this.nakama.logout_all_server(),this.nakama.users.self.online=!0,this.nakama.init_all_sessions(),setTimeout(()=>{this.navCtrl.back()},500)}catch(c){this.createQRCode({type:"link",value:o})}})}}removeOverrideDeviceId(){this.isOverrided=!1,this.nakama.uuid=this.device.uuid,this.indexed.removeFileFromUserPath("link-account"),this.nakama.logout_all_server()}createQRCode(i){try{let o=new g({content:`[${JSON.stringify(i)}]`,padding:4,width:16,height:16,color:"#bbb",background:"#111",ecl:"M"}).svg();this.QRCodeSRC=this.sanitizer.bypassSecurityTrustUrl(`data:image/svg+xml;base64,${btoa(o)}`)}catch(o){this.p5toast.show({text:`${this.lang.text.LinkAccount.failed_to_gen_qr}: ${o}`})}}ionViewWillLeave(){delete this.wsc.disconnected[d],this.websocket.close()}}return e.\u0275fac=function(i){return new(i||e)(t.Y36(m.H7),t.Y36(k.F),t.Y36(A.a),t.Y36(s.SH),t.Y36(f.Z),t.Y36(p.H),t.Y36(L.A),t.Y36(x.b))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-link-account"]],decls:17,vars:6,consts:[["slot","start"],["defaultHref","settings"],["style","width: 100%; height: auto;","alt","QRCodeSRC",3,"src",4,"ngIf"],["button","",3,"disabled","click"],["alt","QRCodeSRC",2,"width","100%","height","auto",3,"src"]],template:function(i,o){1&i&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t._uU(3),t.qZA(),t.TgZ(4,"ion-buttons",0),t._UZ(5,"ion-back-button",1),t.qZA()()(),t.TgZ(6,"ion-content")(7,"ion-item-divider")(8,"ion-label"),t._uU(9),t.qZA()(),t.YNc(10,C,1,1,"img",2),t.TgZ(11,"ion-item-divider")(12,"ion-label"),t._uU(13),t.qZA()(),t.TgZ(14,"ion-item",3),t.NdJ("click",function(){return o.removeOverrideDeviceId()}),t.TgZ(15,"ion-label"),t._uU(16),t.qZA()()()),2&i&&(t.xp6(3),t.Oqu(o.lang.text.Settings.takeOverUser),t.xp6(6),t.Oqu(o.lang.text.LinkAccount.use_almighty_button_to),t.xp6(1),t.Q6J("ngIf",o.QRCodeSRC),t.xp6(3),t.Oqu(o.lang.text.LinkAccount.Recovery),t.xp6(1),t.Q6J("disabled",!o.isOverrided),t.xp6(2),t.Oqu(o.lang.text.LinkAccount.recovery_device_id))},directives:[s.Gu,s.sr,s.wd,s.Sm,s.oU,s.cs,s.W2,s.rH,s.Q$,r.O5,s.Ie],styles:[""]}),e})()}];let P=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[u.Bz.forChild(y)],u.Bz]}),e})(),R=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[r.ez,h.u5,s.Pc,P]]}),e})()}}]);