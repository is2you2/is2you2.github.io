"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5929],{9373:(Z,U,u)=>{u.d(U,{I:()=>a});const a=(0,u(6400).C_)("SpeechRecognition",{web:()=>u.e(7384).then(u.bind(u,7384)).then(G=>new G.SpeechRecognitionWeb)})},8828:(Z,U,u)=>{u.d(U,{_8:()=>D,on:()=>G,wd:()=>a});var D=function($){return $.Prompt="PROMPT",$.Camera="CAMERA",$.Photos="PHOTOS",$}(D||{}),a=function($){return $.Rear="REAR",$.Front="FRONT",$}(a||{}),G=function($){return $.Uri="uri",$.Base64="base64",$.DataUrl="dataUrl",$}(G||{})},4120:(Z,U,u)=>{u.d(U,{Ut:()=>G,_8:()=>a._8,on:()=>a.on});var D=u(6400),a=u(8828);const G=(0,D.C_)("Camera",{web:()=>u.e(9028).then(u.bind(u,9028)).then($=>new $.CameraWeb)})},4580:(Z,U,u)=>{u.d(U,{m:()=>ie});var D=u(5193),a=u(4496),G=u(4500),$=u(5020),m=u(7136),Y=u(5624),J=u(9240),ee=u(4668),L=u(1368);function W(P,A){if(1&P&&(a.I0R(0,"ion-select-option",7),a.OEk(1),a.C$Y()),2&P){const S=A.$implicit;a.E7m("value",S),a.yG2(),a.oRS("",S.name," ")}}function z(P,A){if(1&P&&(a.I0R(0,"ion-select-option",7),a.OEk(1),a.C$Y()),2&P){const S=A.$implicit;a.E7m("value",S),a.yG2(),a.cNF(S.name+" ("+S.server.name+")")}}function q(P,A){if(1&P&&(a.I0R(0,"ion-select-option",7),a.OEk(1),a.C$Y()),2&P){const S=A.$implicit;a.E7m("value",S),a.yG2(),a.oRS(" ",S.urls[0],"")}}function te(P,A){if(1&P){const S=a.KQA();a.I0R(0,"ion-item",8),a.qCj("click",function(){a.usT(S);const x=a.GaO();return a.CGJ(x.scanQRCode())}),a.I0R(1,"ion-label",9),a.OEk(2),a.C$Y()()}if(2&P){const S=a.GaO();a.E7m("disabled",!S.ActKeyLength),a.yG2(2),a.cNF(S.lang.text.QuickQRShare.SendData)}}function H(P,A){if(1&P&&a.wR5(0,"img",10),2&P){const S=a.GaO();a.E7m("src",S.QRCodeSRC,a.K6U)}}let ie=(()=>{var P;class A{constructor(y,x,O,e,X,ne){this.lang=y,this.global=x,this.nakama=O,this.modalCtrl=e,this.navParams=X,this.indexed=ne,this.ActKeyLength=!1,this.userInput={servers:[],groups:[],rtcserver:[]},this.servers=[],this.groups=[],this.rtcServer=[],this.NoReturn=!1,this.BackButtonPressed=!1}InitBrowserBackButtonOverride(){window.history.replaceState(null,null,window.location.href),window.onpopstate=()=>{this.BackButtonPressed||(this.BackButtonPressed=!0,this.modalCtrl.dismiss())}}ngOnInit(){this.InitBrowserBackButtonOverride(),this.NoReturn=this.navParams.get("NoReturn"),this.servers=this.nakama.get_all_server_info(),this.groups=this.nakama.rearrange_group_list(),this.indexed.loadTextFromUserPath("servers/webrtc_server.json",(y,x)=>{y&&x&&(this.rtcServer=JSON.parse(x))});for(let y=this.groups.length-1;y>=0;y--)"missing"==this.groups[y].status&&this.groups.splice(y,1)}SelectGroupServer(y){this.userInput.servers=y.detail.value||[],this.information_changed()}SelectGroupChannel(y){this.userInput.groups=y.detail.value||[],this.information_changed()}SelectRTCServer(y){this.userInput.rtcserver=y.detail.value||[],this.information_changed()}information_changed(){this.result_address=`${D.uM}pjcone_pwa/`;let y="",x=0;for(let O=0,e=this.userInput.servers.length;O<e;O++)y+=x?"&":"?",y+="server=",y+=`${this.userInput.servers[O].name||""},${this.userInput.servers[O].address||""},${this.userInput.servers[O].useSSL||""},${this.userInput.servers[O].port||7350},${this.userInput.servers[O].key||""}`,x++;for(let O=0,e=this.userInput.groups.length;O<e;O++)y+=x?"&":"?",y+="group=",y+=`${this.userInput.groups[O].name},${this.userInput.groups[O].id}`,x++;if(this.userInput.rtcserver.length)for(let O=0,e=this.userInput.rtcserver.length;O<e;O++)y+=x?"&":"?",y+="rtcserver=",y+=`[${this.userInput.rtcserver[O].urls}],${this.userInput.rtcserver[O].username},${this.userInput.rtcserver[O].credential}`,x++;y?(this.result_address+=y,this.QRCodeSRC=this.global.readasQRCodeFromString(this.result_address),this.ActKeyLength=!0):(this.QRCodeSRC="",this.ActKeyLength=!1)}scanQRCode(){this.modalCtrl.dismiss(this.result_address)}}return(P=A).\u0275fac=function(y){return new(y||P)(a.GI1(G.o),a.GI1($.A1),a.GI1(m.h),a.GI1(Y.qS),a.GI1(J.a6),a.GI1(ee.k))},P.\u0275cmp=a.In1({type:P,selectors:[["app-qr-share"]],decls:24,vars:14,consts:[[1,"ion-no-border"],["slot","start",3,"click"],["defaultHref",""],["multiple","true",3,"label","placeholder","ionChange"],[3,"value",4,"ngFor","ngForOf"],["button","",3,"disabled","click",4,"ngIf"],["style","width: 100%; height: auto;","alt","QRCodeSRC",3,"src",4,"ngIf"],[3,"value"],["button","",3,"disabled","click"],[1,"ion-text-center"],["alt","QRCodeSRC",2,"width","100%","height","auto",3,"src"]],template:function(y,x){1&y&&(a.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),a.OEk(3),a.C$Y(),a.I0R(4,"ion-buttons",1),a.qCj("click",function(){return x.modalCtrl.dismiss()}),a.wR5(5,"ion-back-button",2),a.C$Y()()(),a.I0R(6,"ion-content")(7,"ion-item-divider")(8,"ion-label"),a.OEk(9),a.C$Y()(),a.I0R(10,"ion-item")(11,"ion-select",3),a.qCj("ionChange",function(e){return x.SelectGroupServer(e)}),a.yuY(12,W,2,2,"ion-select-option",4),a.C$Y()(),a.I0R(13,"ion-item")(14,"ion-select",3),a.qCj("ionChange",function(e){return x.SelectGroupChannel(e)}),a.yuY(15,z,2,2,"ion-select-option",4),a.C$Y()(),a.I0R(16,"ion-item")(17,"ion-select",3),a.qCj("ionChange",function(e){return x.SelectRTCServer(e)}),a.yuY(18,q,2,2,"ion-select-option",4),a.C$Y()(),a.yuY(19,te,3,2,"ion-item",5),a.I0R(20,"ion-item-divider")(21,"ion-label"),a.OEk(22),a.C$Y()(),a.yuY(23,H,1,1,"img",6),a.C$Y()),2&y&&(a.yG2(3),a.cNF(x.lang.text.Settings.quickQRshare),a.yG2(6),a.cNF(x.lang.text.QuickQRShare.SelectData),a.yG2(2),a.E7m("label",x.lang.text.QuickQRShare.GroupServer)("placeholder",x.lang.text.QuickQRShare.EmptyData),a.yG2(),a.E7m("ngForOf",x.servers),a.yG2(2),a.E7m("label",x.lang.text.QuickQRShare.Group)("placeholder",x.lang.text.QuickQRShare.EmptyData),a.yG2(),a.E7m("ngForOf",x.groups),a.yG2(2),a.E7m("label",x.lang.text.WebRTCDevManager.Title)("placeholder",x.lang.text.QuickQRShare.EmptyData),a.yG2(),a.E7m("ngForOf",x.rtcServer),a.yG2(),a.E7m("ngIf",!x.NoReturn),a.yG2(3),a.cNF(x.lang.text.QuickQRShare.ReceiveData),a.yG2(),a.E7m("ngIf",x.QRCodeSRC))},dependencies:[L.ay,L.u_,Y.GS,Y._i,Y.wB,Y.Yb,Y.S8,Y.QR,Y.Cy,Y.gd,Y.tM,Y.Md,Y.IT,Y.Im]}),A})()},5929:(Z,U,u)=>{u.r(U),u.d(U,{ChatRoomPageModule:()=>wt});var D=u(1368),a=u(4716),G=u(5624),$=u(3332),m=u(1528),Y=u(4708),J=u(9352),ee=u(4428),L=u(5193),W=u(8744),z=u(1052),q=u(5020),te=u(6756),H=u(4120),ie=u(340),P=u(4580),A=u(192),S=u(2272);const x=(0,u(6400).C_)("TextToSpeech",{web:()=>u.e(2728).then(u.bind(u,2728)).then(o=>new o.TextToSpeechWeb)});"speechSynthesis"in window&&window;var O=u(9373),e=u(4496),X=u(9240),ne=u(7136),C=u(6819),M=u(4180),p=u(4668),v=u(4500),g=u(4476),R=u(8696),T=u(3824),B=u(7756);function ae(o,_){if(1&o){const s=e.KQA();e.I0R(0,"ion-icon",29),e.qCj("click",function(){e.usT(s);const i=e.GaO();return e.CGJ(i.toggle_thumbnail())}),e.C$Y()}}function le(o,_){if(1&o){const s=e.KQA();e.I0R(0,"ion-icon",30),e.qCj("click",function(){e.usT(s);const i=e.GaO();return e.CGJ(i.toggle_thumbnail())}),e.C$Y()}}function re(o,_){if(1&o){const s=e.KQA();e.I0R(0,"div",45),e.qCj("click",function(){e.usT(s);const i=e.GaO(4);return e.CGJ(i.SetOtherAct())}),e.I0R(1,"font",46),e.OEk(2),e.C$Y()()}if(2&o){const s=e.GaO(2).$implicit;e.yG2(2),e.oRS(" ",s.msgDate," ")}}function ce(o,_){if(1&o){const s=e.KQA();e.I0R(0,"div",47),e.qCj("click",function(){e.usT(s);const i=e.GaO(2).$implicit,n=e.GaO(2);return e.CGJ(n.user_detail(i))}),e.wR5(1,"img",48),e.C$Y()}if(2&o){const s=e.GaO(2).$implicit,t=e.GaO(2);e.yG2(),e.m_g(t.nakama.users[t.isOfficial][t.target][s.sender_id].online?"filter: grayscale(0) contrast(1);":"filter: grayscale(.9) contrast(1.4);"),e.E7m("src",t.users_image[s.sender_id]||"assets/data/avatar.svg",e.K6U)}}function _e(o,_){if(1&o){const s=e.KQA();e.I0R(0,"div",49)(1,"span",34),e.qCj("click",function(){e.usT(s);const i=e.GaO(2).$implicit,n=e.GaO(2);return e.CGJ(n.user_detail(i))}),e.I0R(2,"b")(3,"font",50),e.OEk(4),e.C$Y()()(),e.I0R(5,"span",51),e.qCj("click",function(){e.usT(s);const i=e.GaO(4);return e.CGJ(i.SetOtherAct())}),e.OEk(6),e.C$Y()()}if(2&o){const s=e.GaO(2).$implicit,t=e.GaO(2);e.yG2(3),e.CI5("color","#",t.nakama.users[t.isOfficial][t.target][s.sender_id].online?s.color:"888",""),e.yG2(),e.oRS(" ",s.user_display_name||t.lang.text.Profile.noname_user,""),e.yG2(2),e.cNF(s.msgTime)}}function de(o,_){if(1&o){const s=e.KQA();e.I0R(0,"div",52),e.qCj("click",function(){e.usT(s);const i=e.GaO(2).$implicit,n=e.GaO(2);return e.CGJ(n.quickShare_act(i))}),e.OEk(1),e.C$Y()}if(2&o){const s=e.GaO(4);e.yG2(),e.oRS(" ",s.lang.text.ChatRoom.QuickShare," ")}}function he(o,_){if(1&o){const s=e.KQA();e.I0R(0,"div",52),e.qCj("click",function(){e.usT(s);const i=e.GaO(2).$implicit,n=e.GaO(2);return e.CGJ(n.JoinWebRTCMatch(i))}),e.OEk(1),e.C$Y()}if(2&o){const s=e.GaO(4);e.yG2(),e.oRS(" ",s.lang.text.ChatRoom.JoinWebRTCMatch," ")}}function ue(o,_){1&o&&e.wR5(0,"div",61)}function me(o,_){if(1&o&&(e.I0R(0,"span",62),e.OEk(1),e.C$Y()),2&o){const s=_.$implicit;e.yG2(),e.oRS(" ",s," ")}}function ge(o,_){if(1&o){const s=e.KQA();e.I0R(0,"div",57),e.qCj("click",function(){e.usT(s);const i=e.GaO(3).$implicit,n=e.GaO(2);return e.CGJ(n.file_detail(i))}),e.I0R(1,"p",58),e.OEk(2),e.C$Y(),e.yuY(3,ue,1,0,"div",59)(4,me,2,1,"span",60),e.C$Y()}if(2&o){const s=e.GaO(3).$implicit,t=e.GaO(2);e.m_g(t.info.HideAutoThumbnail?"filter: blur(6px);":""),e.yG2(2),e.oRS(" ",s.content.filename," "),e.yG2(),e.E7m("ngIf",s.content.text),e.yG2(),e.E7m("ngForOf",s.content.text)}}function fe(o,_){if(1&o){const s=e.KQA();e.I0R(0,"div",63),e.qCj("click",function(){e.usT(s);const i=e.GaO(3).$implicit,n=e.GaO(2);return e.CGJ(n.file_detail(i))}),e.wR5(1,"img",64),e.C$Y()}if(2&o){const s=e.GaO(3).$implicit,t=e.GaO(2);e.yG2(),e.m_g(t.info.HideAutoThumbnail?"filter: blur(6px);":""),e.E7m("src",s.content.thumbnail,e.K6U)("alt",s.content.filename)}}function pe(o,_){if(1&o&&(e.I0R(0,"div",65),e.OEk(1),e.C$Y()),2&o){const s=e.GaO(3).$implicit;e.yG2(),e.oRS(" ",s.content.transfer_index.index,"")}}function ve(o,_){if(1&o&&(e.I0R(0,"div",53),e.yuY(1,ge,5,5,"div",54)(2,fe,2,4,"div",55)(3,pe,2,1,"div",56),e.C$Y()),2&o){const s=e.GaO(2).$implicit;e.yG2(),e.E7m("ngIf",!s.content.thumbnail),e.yG2(),e.E7m("ngIf",s.content.thumbnail),e.yG2(),e.E7m("ngIf",s.content.transfer_index)}}function Ce(o,_){if(1&o){const s=e.KQA();e.I0R(0,"span",34),e.qCj("click",function(){e.usT(s);const i=e.GaO(7);return e.CGJ(i.SetOtherAct())}),e.OEk(1),e.C$Y()}if(2&o){const s=e.GaO().$implicit;e.m_g("font-size: "+(s.size||16)+"px"),e.yG2(),e.oRS(" ",s.text," ")}}function xe(o,_){if(1&o){const s=e.KQA();e.I0R(0,"a",73),e.qCj("click",function(){e.usT(s);const i=e.GaO(7);return e.CGJ(i.SetOtherAct())}),e.OEk(1),e.C$Y()}if(2&o){const s=e.GaO().$implicit;e.E7m("href",s.text,e.K6U),e.yG2(),e.cNF(s.text)}}function ye(o,_){if(1&o&&(e.I0R(0,"span"),e.yuY(1,Ce,2,3,"span",71)(2,xe,2,2,"a",72),e.C$Y()),2&o){const s=_.$implicit;e.yG2(),e.E7m("ngIf",!s.href),e.yG2(),e.E7m("ngIf",s.href)}}function Ie(o,_){if(1&o&&(e.I0R(0,"span",74),e.OEk(1),e.C$Y()),2&o){const s=e.GaO(6);e.yG2(),e.cNF("("+s.lang.text.ChatRoom.MsgEdited+")")}}function Re(o,_){if(1&o&&(e.I0R(0,"div",69)(1,"span"),e.yuY(2,ye,3,2,"span",33),e.C$Y(),e.yuY(3,Ie,2,1,"span",70),e.C$Y()),2&o){const s=_.$implicit,t=_.index,i=e.GaO(3).$implicit;e.yG2(2),e.E7m("ngForOf",s),e.yG2(),e.E7m("ngIf",i.content.edited&&t==i.content.msg.length-1)}}function be(o,_){if(1&o&&(e.I0R(0,"div",66)(1,"div",67),e.yuY(2,Re,4,2,"div",68),e.C$Y()()),2&o){const s=e.GaO(2).$implicit;e.yG2(),e.m_g("background-color: #"+s.color+"88"),e.yG2(),e.E7m("ngForOf",s.content.msg)}}function ke(o,_){if(1&o&&(e.I0R(0,"div",75),e.OEk(1),e.C$Y()),2&o){const s=e.GaO(4);e.yG2(),e.oRS(" ",s.lang.text.ChatRoom.YouReadHereLast,"")}}function Oe(o,_){if(1&o&&(e.I0R(0,"div"),e.yuY(1,re,3,1,"div",37),e.I0R(2,"table")(3,"tr")(4,"td",38),e.yuY(5,ce,2,3,"div",39),e.C$Y(),e.I0R(6,"td"),e.yuY(7,_e,7,3,"div",40)(8,de,2,1,"div",41)(9,he,2,1,"div",41)(10,ve,4,3,"div",42)(11,be,3,3,"div",43),e.C$Y()()(),e.yuY(12,ke,2,1,"div",44),e.C$Y()),2&o){const s=e.GaO().$implicit;e.yG2(),e.E7m("ngIf",s.showInfo&&s.showInfo.date),e.yG2(4),e.E7m("ngIf",s.showInfo&&s.showInfo.sender),e.yG2(2),e.E7m("ngIf",s.showInfo&&s.showInfo.sender),e.yG2(),e.E7m("ngIf",s.content.quickShare),e.yG2(),e.E7m("ngIf",s.content.match),e.yG2(),e.E7m("ngIf",s.content.filename),e.yG2(),e.E7m("ngIf",s.content.msg),e.yG2(),e.E7m("ngIf",s.isLastRead)}}function we(o,_){if(1&o){const s=e.KQA();e.I0R(0,"div",45),e.qCj("click",function(){e.usT(s);const i=e.GaO(4);return e.CGJ(i.SetOtherAct())}),e.I0R(1,"font",46),e.OEk(2),e.C$Y()()}if(2&o){const s=e.GaO(2).$implicit;e.yG2(2),e.oRS(" ",s.msgDate," ")}}function Te(o,_){if(1&o){const s=e.KQA();e.I0R(0,"div",49)(1,"span",82),e.qCj("click",function(){e.usT(s);const i=e.GaO(4);return e.CGJ(i.SetOtherAct())}),e.OEk(2),e.C$Y(),e.I0R(3,"span",34),e.qCj("click",function(){e.usT(s);const i=e.GaO(2).$implicit,n=e.GaO(2);return e.CGJ(n.user_detail(i))}),e.I0R(4,"b")(5,"font",50),e.OEk(6),e.C$Y()()()()}if(2&o){const s=e.GaO(2).$implicit,t=e.GaO(2);e.yG2(2),e.cNF(s.msgTime),e.yG2(3),e.CI5("color","#",t.nakama.users.self.online?s.color:"888",""),e.yG2(),e.oRS(" ",s.user_display_name||t.lang.text.Profile.noname_user,"")}}function Ge(o,_){if(1&o){const s=e.KQA();e.I0R(0,"div",83),e.qCj("click",function(){e.usT(s);const i=e.GaO(2).$implicit,n=e.GaO(2);return e.CGJ(n.quickShare_act(i))}),e.I0R(1,"div",84),e.OEk(2),e.C$Y()()}if(2&o){const s=e.GaO(4);e.yG2(2),e.oRS(" ",s.lang.text.ChatRoom.QuickShare," ")}}function $e(o,_){if(1&o){const s=e.KQA();e.I0R(0,"div",83),e.qCj("click",function(){e.usT(s);const i=e.GaO(2).$implicit,n=e.GaO(2);return e.CGJ(n.JoinWebRTCMatch(i))}),e.I0R(1,"div",84),e.OEk(2),e.C$Y()()}if(2&o){const s=e.GaO(4);e.yG2(2),e.oRS(" ",s.lang.text.ChatRoom.JoinWebRTCMatch," ")}}function Pe(o,_){1&o&&e.wR5(0,"div",61)}function Me(o,_){if(1&o&&(e.I0R(0,"span",62),e.OEk(1),e.C$Y()),2&o){const s=_.$implicit;e.yG2(),e.oRS(" ",s," ")}}function Se(o,_){if(1&o){const s=e.KQA();e.I0R(0,"div",57),e.qCj("click",function(){e.usT(s);const i=e.GaO(3).$implicit,n=e.GaO(2);return e.CGJ(n.file_detail(i))}),e.I0R(1,"p",58),e.OEk(2),e.C$Y(),e.yuY(3,Pe,1,0,"div",59)(4,Me,2,1,"span",60),e.C$Y()}if(2&o){const s=e.GaO(3).$implicit,t=e.GaO(2);e.m_g(t.info.HideAutoThumbnail?"filter: blur(6px);":""),e.yG2(2),e.oRS(" ",s.content.filename," "),e.yG2(),e.E7m("ngIf",s.content.text),e.yG2(),e.E7m("ngForOf",s.content.text)}}function Ee(o,_){if(1&o){const s=e.KQA();e.I0R(0,"div",63),e.qCj("click",function(){e.usT(s);const i=e.GaO(3).$implicit,n=e.GaO(2);return e.CGJ(n.file_detail(i))}),e.wR5(1,"img",64),e.C$Y()}if(2&o){const s=e.GaO(3).$implicit,t=e.GaO(2);e.yG2(),e.m_g(t.info.HideAutoThumbnail?"filter: blur(6px);":""),e.E7m("src",s.content.thumbnail,e.K6U)("alt",s.content.filename)}}function Fe(o,_){if(1&o&&(e.I0R(0,"div",65),e.OEk(1),e.C$Y()),2&o){const s=e.GaO(3).$implicit;e.yG2(),e.oRS(" ",s.content.transfer_index.index,"")}}function Ye(o,_){if(1&o&&(e.I0R(0,"div",85),e.yuY(1,Se,5,5,"div",54)(2,Ee,2,4,"div",55)(3,Fe,2,1,"div",56),e.C$Y()),2&o){const s=e.GaO(2).$implicit;e.yG2(),e.E7m("ngIf",!s.content.thumbnail),e.yG2(),e.E7m("ngIf",s.content.thumbnail),e.yG2(),e.E7m("ngIf",s.content.transfer_index)}}function De(o,_){if(1&o&&(e.I0R(0,"div",74),e.OEk(1),e.C$Y()),2&o){const s=e.GaO(5);e.yG2(),e.cNF("("+s.lang.text.ChatRoom.MsgEdited+")")}}function Le(o,_){if(1&o){const s=e.KQA();e.I0R(0,"span",34),e.qCj("click",function(){e.usT(s);const i=e.GaO(7);return e.CGJ(i.SetOtherAct())}),e.OEk(1),e.C$Y()}if(2&o){const s=e.GaO().$implicit;e.m_g("font-size: "+(s.size||16)+"px"),e.yG2(),e.oRS(" ",s.text," ")}}function Ae(o,_){if(1&o){const s=e.KQA();e.I0R(0,"a",73),e.qCj("click",function(){e.usT(s);const i=e.GaO(7);return e.CGJ(i.SetOtherAct())}),e.OEk(1),e.C$Y()}if(2&o){const s=e.GaO().$implicit;e.E7m("href",s.text,e.K6U),e.yG2(),e.cNF(s.text)}}function Ve(o,_){if(1&o&&(e.I0R(0,"span"),e.yuY(1,Le,2,3,"span",71)(2,Ae,2,2,"a",72),e.C$Y()),2&o){const s=_.$implicit;e.yG2(),e.E7m("ngIf",!s.href),e.yG2(),e.E7m("ngIf",s.href)}}function Ue(o,_){if(1&o&&(e.I0R(0,"div",69)(1,"span"),e.yuY(2,Ve,3,2,"span",33),e.C$Y()()),2&o){const s=_.$implicit;e.yG2(2),e.E7m("ngForOf",s)}}function Be(o,_){if(1&o&&(e.I0R(0,"div",86),e.yuY(1,De,2,1,"div",70),e.I0R(2,"div",67),e.yuY(3,Ue,3,1,"div",68),e.C$Y()()),2&o){const s=e.GaO(2).$implicit;e.yG2(),e.E7m("ngIf",s.content.edited),e.yG2(),e.m_g("background-color: #"+s.color+"88"),e.yG2(),e.E7m("ngForOf",s.content.msg)}}function Qe(o,_){if(1&o){const s=e.KQA();e.I0R(0,"div",47),e.qCj("click",function(){e.usT(s);const i=e.GaO(2).$implicit,n=e.GaO(2);return e.CGJ(n.user_detail(i))}),e.wR5(1,"img",87),e.C$Y()}if(2&o){const s=e.GaO(4);e.yG2(),e.m_g(s.nakama.users.self.online?"filter: grayscale(0) contrast(1);":"filter: grayscale(.9) contrast(1.4);"),e.E7m("src",s.nakama.users.self.img||"assets/data/avatar.svg",e.K6U)}}function je(o,_){if(1&o&&(e.I0R(0,"div",75),e.OEk(1),e.C$Y()),2&o){const s=e.GaO(4);e.yG2(),e.oRS(" ",s.lang.text.ChatRoom.YouReadHereLast,"")}}function Ke(o,_){if(1&o&&(e.I0R(0,"div",76),e.yuY(1,we,3,1,"div",37),e.I0R(2,"table",77)(3,"tr")(4,"td"),e.yuY(5,Te,7,3,"div",40)(6,Ge,3,1,"div",78)(7,$e,3,1,"div",78)(8,Ye,4,3,"div",79)(9,Be,4,4,"div",80),e.C$Y(),e.I0R(10,"td",81),e.yuY(11,Qe,2,3,"div",39),e.C$Y()()(),e.yuY(12,je,2,1,"div",44),e.C$Y()),2&o){const s=e.GaO().$implicit;e.yG2(),e.E7m("ngIf",s.showInfo&&s.showInfo.date),e.yG2(4),e.E7m("ngIf",s.showInfo&&s.showInfo.sender),e.yG2(),e.E7m("ngIf",s.content.quickShare),e.yG2(),e.E7m("ngIf",s.content.match),e.yG2(),e.E7m("ngIf",s.content.filename),e.yG2(),e.E7m("ngIf",s.content.msg),e.yG2(2),e.E7m("ngIf",s.showInfo&&s.showInfo.sender),e.yG2(),e.E7m("ngIf",s.isLastRead)}}function Ne(o,_){if(1&o&&(e.I0R(0,"div",88)(1,"div",89),e.OEk(2),e.C$Y()()),2&o){const s=e.GaO().$implicit;e.yG2(2),e.oRS(" ",s.content.noti," ")}}function He(o,_){if(1&o){const s=e.KQA();e.I0R(0,"div",34),e.qCj("click",function(){const i=e.usT(s),n=i.$implicit,l=i.index,c=e.GaO(2);return e.CGJ(c.message_detail(n,l))}),e.yuY(1,Oe,13,8,"div",11)(2,Ke,13,8,"div",35)(3,Ne,3,1,"div",36),e.C$Y()}if(2&o){const s=_.$implicit;e.yG2(),e.E7m("ngIf",!s.is_me),e.yG2(),e.E7m("ngIf",s.is_me),e.yG2(),e.E7m("ngIf",s.content.noti)}}function Je(o,_){if(1&o){const s=e.KQA();e.I0R(0,"div",83),e.qCj("click",function(){e.usT(s);const i=e.GaO().$implicit,n=e.GaO(2);return e.CGJ(n.quickShare_act(i))}),e.I0R(1,"div",84),e.OEk(2),e.C$Y()()}if(2&o){const s=e.GaO(3);e.yG2(2),e.oRS(" ",s.lang.text.ChatRoom.QuickShare," ")}}function We(o,_){1&o&&e.wR5(0,"div",61)}function ze(o,_){if(1&o&&(e.I0R(0,"span",62),e.OEk(1),e.C$Y()),2&o){const s=_.$implicit;e.yG2(),e.oRS(" ",s," ")}}function qe(o,_){if(1&o&&(e.I0R(0,"div",92)(1,"p",58),e.OEk(2),e.C$Y(),e.yuY(3,We,1,0,"div",59)(4,ze,2,1,"span",60),e.C$Y()),2&o){const s=e.GaO(2).$implicit,t=e.GaO(2);e.m_g(t.info.HideAutoThumbnail?"filter: blur(6px);":""),e.yG2(2),e.oRS(" ",s.content.filename," "),e.yG2(),e.E7m("ngIf",s.content.text),e.yG2(),e.E7m("ngForOf",s.content.text)}}function Xe(o,_){if(1&o&&(e.I0R(0,"div",93),e.wR5(1,"img",64),e.C$Y()),2&o){const s=e.GaO(2).$implicit,t=e.GaO(2);e.yG2(),e.m_g(t.info.HideAutoThumbnail?"filter: blur(6px);":""),e.E7m("src",s.content.thumbnail,e.K6U)("alt",s.content.filename)}}function Ze(o,_){if(1&o&&(e.I0R(0,"div",85),e.yuY(1,qe,5,5,"div",90)(2,Xe,2,4,"div",91),e.C$Y()),2&o){const s=e.GaO().$implicit;e.yG2(),e.E7m("ngIf",!s.content.thumbnail),e.yG2(),e.E7m("ngIf",s.content.thumbnail)}}function et(o,_){if(1&o){const s=e.KQA();e.I0R(0,"span",96),e.qCj("click",function(){e.usT(s);const i=e.GaO(6);return e.CGJ(i.SetOtherAct())}),e.OEk(1),e.C$Y()}if(2&o){const s=e.GaO().$implicit;e.yG2(),e.oRS(" ",s.text," ")}}function tt(o,_){if(1&o){const s=e.KQA();e.I0R(0,"a",97),e.qCj("click",function(){e.usT(s);const i=e.GaO(6);return e.CGJ(i.SetOtherAct())}),e.OEk(1),e.C$Y()}if(2&o){const s=e.GaO().$implicit;e.E7m("href",s.text,e.K6U),e.yG2(),e.cNF(s.text)}}function it(o,_){if(1&o&&(e.I0R(0,"span"),e.yuY(1,et,2,1,"span",94)(2,tt,2,2,"a",95),e.C$Y()),2&o){const s=_.$implicit;e.yG2(),e.E7m("ngIf",!s.href),e.yG2(),e.E7m("ngIf",s.href)}}function nt(o,_){if(1&o&&(e.I0R(0,"div"),e.yuY(1,it,3,2,"span",33),e.C$Y()),2&o){const s=_.$implicit;e.yG2(),e.E7m("ngForOf",s)}}function at(o,_){if(1&o&&(e.I0R(0,"div",86)(1,"div",67),e.yuY(2,nt,2,1,"div",33),e.C$Y()()),2&o){const s=e.GaO().$implicit;e.yG2(),e.m_g("background-color: #"+s.color+"88"),e.yG2(),e.E7m("ngForOf",s.content.msg)}}function st(o,_){if(1&o&&(e.I0R(0,"div"),e.yuY(1,Je,3,1,"div",78)(2,Ze,3,2,"div",79)(3,at,3,3,"div",80),e.C$Y()),2&o){const s=_.$implicit;e.yG2(),e.E7m("ngIf",s.content.quickShare),e.yG2(),e.E7m("ngIf",s.content.filename),e.yG2(),e.E7m("ngIf",s.content.msg)}}function ot(o,_){if(1&o){const s=e.KQA();e.I0R(0,"div")(1,"ion-item",31),e.qCj("click",function(){e.usT(s);const i=e.GaO();return e.CGJ(i.pull_msg_history())}),e.I0R(2,"ion-label"),e.OEk(3),e.C$Y()(),e.yuY(4,He,4,3,"div",32)(5,st,4,3,"div",33),e.C$Y()}if(2&o){const s=e.GaO();e.yG2(),e.E7m("disabled",void 0===s.next_cursor&&!s.ViewMsgIndex||!s.pullable),e.yG2(2),e.cNF(s.lang.text.ChatRoom.fetch_previous_chat),e.yG2(),e.E7m("ngForOf",s.ViewableMessage),e.yG2(),e.E7m("ngForOf",s.sending_msg)}}function lt(o,_){if(1&o&&(e.I0R(0,"div",10)(1,"div",98),e.wR5(2,"ion-icon",99),e.I0R(3,"div")(4,"ion-label",100),e.OEk(5),e.C$Y()()()()),2&o){const s=e.GaO();e.yG2(5),e.cNF(s.lang.text.ChatRoom.CannotOpenClosedGroup)}}function rt(o,_){if(1&o){const s=e.KQA();e.I0R(0,"tr",101),e.qCj("click",function(){e.usT(s);const i=e.GaO();return e.CGJ(i.cancel_qrshare())}),e.I0R(1,"td",102)(2,"span"),e.OEk(3),e.C$Y()()()}if(2&o){const s=e.GaO();e.yG2(3),e.cNF(s.lang.text.Settings.quickQRshare)}}function ct(o,_){if(1&o&&e.wR5(0,"img",108),2&o){const s=e.GaO(4);e.E7m("src",s.userInput.file.thumbnail,e.K6U)("alt",s.userInput.file.name)}}function _t(o,_){if(1&o&&(e.I0R(0,"div"),e.yuY(1,ct,1,2,"img",107),e.C$Y()),2&o){const s=e.GaO(3);e.yG2(),e.E7m("ngIf","image"==s.userInput.file.typeheader)}}function dt(o,_){if(1&o&&(e.I0R(0,"span"),e.OEk(1),e.C$Y()),2&o){const s=_.$implicit;e.yG2(),e.oRS(" ",s," ")}}function ht(o,_){if(1&o&&(e.I0R(0,"div",109),e.yuY(1,dt,2,1,"span",33),e.C$Y()),2&o){const s=e.GaO(3);e.yG2(),e.E7m("ngForOf",s.userInput.file.thumbnail)}}function ut(o,_){if(1&o){const s=e.KQA();e.I0R(0,"div",34),e.qCj("click",function(){e.usT(s);const i=e.GaO(2);return e.CGJ(i.removeAttach())}),e.I0R(1,"div",105),e.OEk(2),e.C$Y(),e.yuY(3,_t,2,1,"div",11)(4,ht,2,1,"div",106),e.C$Y()}if(2&o){const s=e.GaO(2);e.yG2(2),e.oRS(" ",s.userInput.file.filename," "),e.yG2(),e.E7m("ngIf",s.userInput.file.thumbnail),e.yG2(),e.E7m("ngIf","text"==s.userInput.file.typeheader)}}function mt(o,_){if(1&o&&(e.I0R(0,"tr",103)(1,"td"),e.yuY(2,ut,5,3,"div",104),e.C$Y()()),2&o){const s=e.GaO();e.yG2(2),e.E7m("ngIf",s.userInput.file)}}function gt(o,_){if(1&o){const s=e.KQA();e.I0R(0,"tr",101),e.qCj("click",function(){e.usT(s);const i=e.GaO();return e.CGJ(i.init_chatroom())}),e.I0R(1,"td",110),e.OEk(2),e.C$Y()()}if(2&o){const s=e.GaO();e.yG2(2),e.cNF(s.lang.text.ChatRoom.GoToRecent)}}function ft(o,_){if(1&o){const s=e.KQA();e.I0R(0,"span",34),e.qCj("click",function(){e.usT(s);const i=e.GaO(4);return e.CGJ(i.SetOtherAct())}),e.OEk(1),e.C$Y()}if(2&o){const s=e.GaO().$implicit;e.yG2(),e.oRS(" ",s.text," ")}}function pt(o,_){if(1&o){const s=e.KQA();e.I0R(0,"a",73),e.qCj("click",function(){e.usT(s);const i=e.GaO(4);return e.CGJ(i.SetOtherAct())}),e.OEk(1),e.C$Y()}if(2&o){const s=e.GaO().$implicit;e.E7m("href",s.text,e.K6U),e.yG2(),e.cNF(s.text)}}function vt(o,_){if(1&o&&(e.I0R(0,"span"),e.yuY(1,ft,2,1,"span",104)(2,pt,2,2,"a",72),e.C$Y()),2&o){const s=_.$implicit;e.yG2(),e.E7m("ngIf",!s.href),e.yG2(),e.E7m("ngIf",s.href)}}function Ct(o,_){if(1&o&&(e.I0R(0,"span"),e.yuY(1,vt,3,2,"span",33),e.C$Y()),2&o){const s=_.$implicit;e.yG2(),e.E7m("ngForOf",s)}}function xt(o,_){if(1&o){const s=e.KQA();e.I0R(0,"tr",101),e.qCj("click",function(){e.usT(s);const i=e.GaO();return e.CGJ(i.init_chatroom())}),e.I0R(1,"td",111)(2,"span")(3,"b"),e.OEk(4),e.C$Y()(),e.yuY(5,Ct,2,1,"span",33),e.C$Y()()}if(2&o){const s=e.GaO();e.yG2(2),e.m_g("margin-right: 8px; color: #"+s.last_message_viewer.color),e.yG2(2),e.cNF((s.last_message_viewer.is_me?s.nakama.users.self.display_name:s.nakama.users[s.isOfficial][s.target][s.last_message_viewer.user_id].display_name)||s.lang.text.Profile.noname_user),e.yG2(),e.E7m("ngForOf",s.last_message_viewer.message)}}function yt(o,_){if(1&o){const s=e.KQA();e.I0R(0,"td")(1,"ion-button",112),e.qCj("click",function(){e.usT(s);const i=e.GaO();return e.CGJ(i.GetSpeechToText())}),e.wR5(2,"ion-icon",113),e.C$Y()()}}function It(o,_){if(1&o&&e.wR5(0,"ion-icon",118),2&o){const s=e.GaO().$implicit;e.E7m("name",s.icon||"close-circle")}}function Rt(o,_){if(1&o&&e.wR5(0,"img",119),2&o){const s=e.GaO().$implicit;e.E7m("src","assets/icon/"+s.icon_img,e.K6U)("alt",s.title)}}function bt(o,_){if(1&o){const s=e.KQA();e.I0R(0,"div",114)(1,"div",115),e.qCj("click",function(){const n=e.usT(s).$implicit;return e.CGJ(n.act())}),e.yuY(2,It,1,1,"ion-icon",116)(3,Rt,1,2,"img",117),e.I0R(4,"div"),e.OEk(5),e.C$Y()()()}if(2&o){const s=_.$implicit;e.yG2(),e.m_g("cursor: "+(s.cursor||"pointer")+";"),e.E7m("hidden",s.isHide),e.yG2(),e.E7m("ngIf",s.icon),e.yG2(),e.E7m("ngIf",s.icon_img),e.yG2(2),e.cNF(s.name)}}const kt=[{path:"",component:(()=>{var o;class _{constructor(t,i,n,l,c,d,h,f,k,w,I,V,Q,j,oe,Tt,Gt){var E,r=this;this.modalCtrl=t,this.navCtrl=i,this.route=n,this.router=l,this.nakama=c,this.noti=d,this.statusBar=h,this.indexed=f,this.lang=k,this.sanitizer=w,this.global=I,this.loadingCtrl=V,this.webrtc=Q,this.p5toast=j,this.mClipboard=oe,this.alertCtrl=Tt,this.platform=Gt,this.info={},this.foundLastRead=!1,this.messages=[],this.sending_msg=[],this.temporary_open_thumbnail={},this.extended_buttons=[{icon:"settings-outline",name:this.lang.text.ChatRoom.ExtSettings,act:()=>{if(3!=this.info.redirect.type)this.extended_buttons[0].isHide=!0;else if(!this.lock_modal_open)try{this.lock_modal_open=!0,this.modalCtrl.create({component:te.q,componentProps:{info:this.nakama.groups[this.isOfficial][this.target][this.info.group_id],server:{isOfficial:this.isOfficial,target:this.target}}}).then(E=>{E.onWillDismiss().then(b=>{b.data&&(this.extended_buttons.forEach(K=>{K.isHide=!0}),this.extended_buttons[0].isHide=!1,this.extended_buttons[12].isHide=!1)}),E.onDidDismiss().then(()=>{this.ionViewDidEnter()}),this.removeShortCutKey(),E.present(),this.lock_modal_open=!1})}catch{this.lock_modal_open=!1,this.p5toast.show({text:this.lang.text.ChatRoom.AlreadyRemoved})}}},{icon:"hammer-outline",name:this.lang.text.ChatRoom.ExtSoloImage,isHide:!0,act:()=>{document.getElementById("local_channel").click()}},{icon:"image-outline",name:this.lang.text.ChatRoom.BackgroundImage,act:()=>{this.HasBackgroundImage?this.RemoveChannelBackgroundImage():document.getElementById("backgroundImage_sel").click()}},{icon_img:"voidDraw.png",name:this.lang.text.ChatRoom.voidDraw,act:(E=(0,m.c)(function*(){r.userInputTextArea||(r.userInputTextArea=document.getElementById(r.ChannelUserInputId));let K,b={};if(r.userInput.file)switch(r.userInput.file.typeheader){case"image":try{r.userInput.file.url&&(r.userInput.file.blob=yield fetch(r.userInput.file.url).then(se=>se.blob()));let F=`tmp_files/chatroom/attached.${r.userInput.file.file_ext}`;yield r.indexed.saveBlobToUserPath(r.userInput.file.blob,F);let N=document.getElementById("ChatroomSelectedImage");b.path=F,b.width=N.naturalWidth,b.height=N.naturalHeight,K=r.userInput.file.content_related_creator}catch(F){return void r.p5toast.show({text:`${r.lang.text.ContentViewer.CannotEditFile}: ${F}`})}break;case"text":b.text=r.userInput.file.thumbnail}r.modalCtrl.create({component:z.S,componentProps:b,cssClass:"fullscreen"}).then(F=>{F.onWillDismiss().then(function(){var N=(0,m.c)(function*(se){se.data&&(yield r.voidDraw_fileAct_callback(se,K))});return function(se){return N.apply(this,arguments)}}()),F.onDidDismiss().then(()=>{r.is_modal=!1,r.ionViewDidEnter()}),r.is_modal=!0,F.present()})}),function(){return E.apply(this,arguments)})},{icon:"document-attach-outline",name:this.lang.text.ChatRoom.attachments,act:()=>{this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId)),this.new_attach({detail:{value:"load"}})}},{icon:"link-outline",name:this.lang.text.ChatRoom.FileLink,act:function(){var E=(0,m.c)(function*(){if(r.userInputTextArea||(r.userInputTextArea=document.getElementById(r.ChannelUserInputId)),r.useCDN)try{return void(yield r.new_attach({detail:{value:"link"}}))}catch{}r.toggle_linked_attach()});return function(){return E.apply(this,arguments)}}()},{icon:"cloud-done-outline",name:this.lang.text.ChatRoom.UseCloud,act:()=>{this.toggle_custom_attach()}},{icon:"camera-outline",name:this.lang.text.ChatRoom.Camera,act:function(){var E=(0,m.c)(function*(){try{const b=yield H.Ut.getPhoto({quality:90,resultType:H.on.Base64,source:H._8.Camera});let K=yield r.loadingCtrl.create({message:r.lang.text.TodoDetail.WIP});K.present(),r.userInputTextArea||(r.userInputTextArea=document.getElementById(r.ChannelUserInputId)),r.userInput.file={},r.userInput.file.filename=`Camera_${(new Date).toLocaleString().replace(/:/g,"_")}.${b.format}`,r.userInput.file.file_ext=b.format,r.userInput.file.thumbnail=r.sanitizer.bypassSecurityTrustUrl("data:image/jpeg;base64,"+b.base64String),r.userInput.file.type=`image/${b.format}`,r.userInput.file.typeheader="image",r.userInput.file.content_related_creator=[{user_id:r.info.local?"local":r.nakama.servers[r.isOfficial][r.target].session.user_id,timestamp:(new Date).getTime(),display_name:r.nakama.users.self.display_name,various:"camera"}],r.userInput.file.content_creator={user_id:r.info.local?"local":r.nakama.servers[r.isOfficial][r.target].session.user_id,timestamp:(new Date).getTime(),display_name:r.nakama.users.self.display_name,various:"camera"},yield r.indexed.saveBase64ToUserPath("data:image/jpeg;base64,"+b.base64String,`tmp_files/chatroom/${r.userInput.file.filename}`,N=>{r.userInput.file.blob=new Blob([N],{type:r.userInput.file.type})}),K.dismiss()}catch{}});return function(){return E.apply(this,arguments)}}()},{icon:"server-outline",name:this.lang.text.ChatRoom.ShareInfo,act:()=>{this.modalCtrl.create({component:P.m}).then(E=>{E.onDidDismiss().then(b=>{b.data?(this.userInput.quickShare=b.data,this.inputPlaceholder=this.lang.text.ChatRoom.QuickShare_placeholder):this.cancel_qrshare(),this.ionViewDidEnter()}),this.removeShortCutKey(),E.present()})}},{icon:"call-outline",name:this.lang.text.ChatRoom.VoiceChat,act:function(){var E=(0,m.c)(function*(){try{yield r.webrtc.initialize("audio",void 0,{isOfficial:r.isOfficial,target:r.target,channel_id:r.info.id,user_id:r.info.info.id||r.info.info.user_id}),r.webrtc.CurrentMatch=yield r.nakama.servers[r.isOfficial][r.target].socket.createMatch(),yield r.nakama.servers[r.isOfficial][r.target].socket.writeChatMessage(r.info.id,{match:r.webrtc.CurrentMatch.match_id}),r.scroll_down_logs(),r.webrtc.CreateOfffer()}catch(b){console.log("webrtc \uc2dc\uc791\ub2e8\uacc4 \uc624\ub958: ",b)}});return function(){return E.apply(this,arguments)}}()},{icon:"volume-mute-outline",name:this.lang.text.ChatRoom.ReadText,act:function(){var E=(0,m.c)(function*(){r.toggle_speakermode()});return function(){return E.apply(this,arguments)}}()},{icon:"log-out-outline",name:this.lang.text.ChatRoom.LogOut,act:function(){var E=(0,m.c)(function*(){if(3!=r.info.redirect.type)try{yield r.nakama.remove_group_list(r.nakama.groups[r.isOfficial][r.target][r.info.group_id]||r.info.info,r.isOfficial,r.target,!1),yield r.nakama.servers[r.isOfficial][r.target].socket.leaveChat(r.info.id),r.nakama.channels_orig[r.isOfficial][r.target][r.info.id].status="missing",r.extended_buttons.forEach(b=>{b.isHide=!0}),r.extended_buttons[12].isHide=!1}catch(b){console.error("\ucc44\ub110\uc5d0\uc11c \ub098\uc624\uae30 \uc2e4\ud328: ",b)}else r.extended_buttons[11].isHide=!0;r.ionViewDidEnter()});return function(){return E.apply(this,arguments)}}()},{isHide:!0,name:this.lang.text.ChatRoom.RemoveHistory,icon:"close-circle-outline",act:()=>{this.alertCtrl.create({header:this.lang.text.ChatRoom.RemoveChannel,message:this.lang.text.ChatRoom.CannotUndone,buttons:[{text:this.lang.text.ChatRoom.Delete,handler:function(){var E=(0,m.c)(function*(){let b=yield r.loadingCtrl.create({message:r.lang.text.TodoDetail.WIP});b.present(),delete r.nakama.channels_orig[r.isOfficial][r.target][r.info.id];try{switch(r.info.redirect.type){case 3:yield r.nakama.remove_group_list(r.nakama.groups[r.isOfficial][r.target][r.info.group_id]||r.info.info,r.isOfficial,r.target);break;case 0:yield r.indexed.removeFileFromUserPath(`servers/${r.isOfficial}/${r.target}/groups/${r.info.id}.img`)}}catch(F){console.log("\uadf8\ub8f9 \uc774\ubbf8\uc9c0 \uc0ad\uc81c \uc624\ub958: ",F)}try{delete r.nakama.groups[r.isOfficial][r.target][r.info.group_id]}catch(F){console.log("DeleteGroupFailed: ",F)}r.nakama.remove_channel_files(r.isOfficial,r.target,r.info.id),r.nakama.save_groups_with_less_info();let K=yield r.indexed.GetFileListFromDB(`servers/${r.isOfficial}/${r.target}/channels/${r.info.id}`);for(let F=0,N=K.length;F<N;F++)b.message=`${r.lang.text.UserFsDir.DeleteFile}: ${N-F}`,yield r.indexed.removeFileFromUserPath(K[F]);b.dismiss(),r.navCtrl.pop()});return function(){return E.apply(this,arguments)}}(),cssClass:"red_font"}]}).then(E=>E.present())}}],this.is_modal=!1,this.useCDN=!0,this.useFirstCustomCDN=!0,this.HasBackgroundImage=!1,this.next_cursor="",this.prev_cursor="",this.file_sel_id="file_sel_id",this.ShowGoToBottom=!1,this.isMobile=!1,this.BackButtonPressed=!1,this.last_message_viewer={user_id:void 0,message:void 0,color:void 0,is_me:void 0},this.users_image={},this.userInput={file:void 0,quickShare:void 0,text:""},this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder,this.pullable=!0,this.ViewableMessage=[],this.ViewMsgIndex=0,this.RefreshCount=15,this.ViewCount=45,this.ShowRecentMsg=!1,this.isOfflineClosedGroup=!1,this.useSpeaker=!1,this.isSpeeching=!1,this.SpeechThese=[],this.isHistoryLoaded=!1,this.LocalHistoryList=[],this.isHidden=!0,this.ChannelUserInputId="ChannelUserInputId",this.isOtherAct=!1,this.lock_modal_open=!1}add_shortcut(){this.is_modal||this.ionViewDidEnter()}ionViewDidEnter(){this.nakama.resumeBanner(),this.global.p5key.KeyShortCut.Escape=()=>{this.navCtrl.pop()},this.global.p5key.KeyShortCut.BottomTab=i=>{document.activeElement!=document.getElementById(this.ChannelUserInputId)&&"E"===i&&this.open_ext_with_delay()};let t=[];for(let i=0,n=this.extended_buttons.length;i<n;i++)this.extended_buttons[i].isHide||t.push(this.extended_buttons[i]);this.global.p5key.KeyShortCut.Digit=i=>{!this.isHidden&&document.activeElement!=document.getElementById(this.ChannelUserInputId)&&t.length>i&&t[i].act()},this.global.p5key.KeyShortCut.EnterAct=()=>{document.activeElement!=document.getElementById(this.ChannelUserInputId)&&setTimeout(()=>{this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId)),this.userInputTextArea.focus()},0)}}new_attach(t){var i=this;return(0,m.c)(function*(){switch(t.detail.value){case"load":i.userInputTextArea||(i.userInputTextArea=document.getElementById(i.ChannelUserInputId)),document.getElementById(i.file_sel_id).click();break;case"link":try{let n;if(!i.userInput.file)try{n=yield i.mClipboard.paste()}catch{try{n=yield S.c.read()}catch(h){throw h}}try{if(i.userInput.file)throw"\uc774\ubbf8 \ud30c\uc77c\uc774 \ucca8\ubd80\ub428, \ud1a0\uae00\ub9cc \uc2dc\ub3c4";if(!(yield fetch(n)).ok)throw"URL \uad6c\uc870\uac00 \uc815\uc0c1\uc774 \uc544\ub2d8"}catch(d){throw d}let l={};l.url=n,l.content_related_creator=[{user_id:i.info.local?"local":i.nakama.servers[i.isOfficial][i.target].session.user_id,timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"link"}],l.content_creator={user_id:i.info.local?"local":i.nakama.servers[i.isOfficial][i.target].session.user_id,timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"link"};let c=l.url.split(".");l.file_ext=c.pop().split("?").shift(),l.filename=decodeURIComponent(`${c.pop().split("/").pop()||i.lang.text.ChatRoom.ExternalLinkFile}.${l.file_ext}`),i.global.set_viewer_category_from_ext(l),l.type="",l.typeheader=l.viewer,i.global.modulate_thumbnail(l,l.url),i.NeedScrollDown()&&setTimeout(()=>{i.scroll_down_logs()},100),i.userInput.file=l,i.inputPlaceholder=`(${i.lang.text.ChatRoom.FileLink}: ${i.userInput.file.filename})`}catch(n){throw console.warn("\uc778\uc2dd \ubd88\uac00\ub2a5\ud55c URL \uc815\ubcf4: ",n),"\uc778\uc2dd \ubd88\uac00\ub2a5\ud55c URL \uc815\ubcf4"}}})()}toggle_linked_attach(){var t=this;return(0,m.c)(function*(){t.useCDN=!t.useCDN,t.extended_buttons[5].icon=t.useCDN?"link-outline":"unlink-outline"})()}toggle_custom_attach(t){var i=this;return(0,m.c)(function*(){i.useFirstCustomCDN=null!=t?t:!i.useFirstCustomCDN,i.extended_buttons[6].icon=i.useFirstCustomCDN?"cloud-done-outline":"cloud-offline-outline",i.useFirstCustomCDN?localStorage.setItem("useFFSCDN",`${i.useFirstCustomCDN}`):localStorage.removeItem("useFFSCDN")})()}toggle_speakermode(t){var i=this;return(0,m.c)(function*(){if(i.useSpeaker=null!=t?t:!i.useSpeaker,i.extended_buttons[10].icon=i.useSpeaker?"volume-high-outline":"volume-mute-outline",i.useSpeaker?localStorage.setItem("useChannelSpeaker",`${i.useSpeaker}`):localStorage.removeItem("useChannelSpeaker"),!i.useSpeaker)try{yield x.stop()}catch{}})()}LoadChannelBackgroundImage(){var t=this;return(0,m.c)(function*(){try{let i=yield t.indexed.loadBlobFromUserPath(`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/backgroundImage.png`,"");t.ChangeBackgroundImage({target:{files:[i]}}),t.HasBackgroundImage=!0}catch{}})()}RemoveChannelBackgroundImage(){var t=this;return(0,m.c)(function*(){try{yield t.indexed.removeFileFromUserPath(`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/backgroundImage.png`),document.getElementById("main_table").style.backgroundImage='url("")'}catch{}t.HasBackgroundImage=!1})()}ChangeBackgroundImage(t){let i=document.getElementById("main_table"),n=t.target.files[0],l=URL.createObjectURL(n);i.style.backgroundImage=`url('${l}')`,this.indexed.saveBlobToUserPath(n,`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/backgroundImage.png`),this.HasBackgroundImage=!0,setTimeout(()=>{URL.revokeObjectURL(l)},100)}cancel_qrshare(){delete this.userInput.quickShare,this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder}inputFileSelected(t){var i=this;return(0,m.c)(function*(){if(t.target.files.length)if(1!=t.target.files.length)(yield i.alertCtrl.create({header:i.lang.text.ChatRoom.MultipleSend,message:`${i.lang.text.ChatRoom.CountFile}: ${t.target.files.length}`,buttons:[{text:i.lang.text.ChatRoom.Send,handler:(c=(0,m.c)(function*(){let d=yield i.loadingCtrl.create({message:i.lang.text.ChatRoom.MultipleSend});d.present(),i.noti.noti.schedule({id:7,title:i.lang.text.ChatRoom.MultipleSend,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://diychat",color:"b0b0b0"});for(let h=0,f=t.target.files.length;h<f;h++)d.message=`${i.lang.text.ChatRoom.MultipleSend}: ${f-h}`,i.noti.noti.schedule({id:7,title:i.lang.text.ChatRoom.MultipleSend,progressBar:{value:h,maxValue:f},sound:null,smallIcon:"res://diychat",color:"b0b0b0"}),yield i.selected_blobFile_callback_act(t.target.files[h]),yield i.send();i.noti.ClearNoti(7),d.dismiss(),setTimeout(()=>{i.scroll_down_logs()},300)}),function(){return c.apply(this,arguments)})}]})).present();else{let l=yield i.loadingCtrl.create({message:i.lang.text.TodoDetail.WIP});l.present(),yield i.selected_blobFile_callback_act(t.target.files[0]),l.dismiss()}else delete i.userInput.file,i.inputPlaceholder=i.lang.text.ChatRoom.input_placeholder;var c})()}LocalChannelImageChanged(t){var i=this;return(0,m.c)(function*(){let n=yield i.global.GetBase64ThroughFileReader(t.target.files[0]);i.nakama.limit_image_size(n,l=>{i.info.info.img=l.canvas.toDataURL(),i.indexed.saveTextFileToUserPath(i.info.info.img,`servers/${i.info.server.isOfficial}/${i.info.server.target}/groups/${i.info.id}.img`),i.p5toast.show({text:i.lang.text.ChatRoom.LocalImageChanged})})})()}InitBrowserBackButtonOverride(){window.history.pushState(null,null,window.location.href),window.onpopstate=()=>{this.BackButtonPressed||(this.BackButtonPressed=!0,this.navCtrl.back())}}ngOnInit(){var t=this;this.InitBrowserBackButtonOverride(),this.useSpeaker=!!localStorage.getItem("useChannelSpeaker"),this.toggle_speakermode(this.useSpeaker),this.useFirstCustomCDN=!!localStorage.getItem("useFFSCDN"),this.toggle_custom_attach(this.useFirstCustomCDN),this.ChatLogs=document.getElementById("chatroom_div"),this.ChatLogs.onscroll=i=>{Math.abs(this.ChatLogs.scrollHeight-(this.ChatLogs.scrollTop+this.ChatLogs.clientHeight))<1&&(this.ShowGoToBottom||this.ShowRecentMsg||this.init_last_message_viewer(),this.ShowRecentMsg&&this.pull_msg_history(!1)),this.ShowGoToBottom=this.ChatLogs.scrollHeight-220>this.ChatLogs.scrollTop+this.ChatLogs.clientHeight},this.nakama.ChatroomLinkAct=function(){var i=(0,m.c)(function*(n,l){delete t.nakama.channels_orig[t.isOfficial][t.target][t.info.id].update,t.info=n,yield t.init_chatroom(),t.userInput.file=l,t.userInput.file&&t.create_thumbnail_imported(l)});return function(n,l){return i.apply(this,arguments)}}(),this.route.queryParams.subscribe(function(){var i=(0,m.c)(function*(n){const l=t.router.getCurrentNavigation().extras.state;l&&(t.info=l.info),yield new Promise(c=>setTimeout(c,100)),yield t.init_chatroom(),t.userInput.file=l.file,t.userInput.file&&t.create_thumbnail_imported(l.file)});return function(n){return i.apply(this,arguments)}}()),"DesktopPWA"==L.s1&&setTimeout(()=>{this.CreateDrop()},0),this.isMobile="Android"==L.s1||"iOS"==L.s1}ionViewWillEnter(){document.getElementById(this.ChannelUserInputId).onpaste=t=>{let i=[];for(const n of t.clipboardData.files)n.type.startsWith("image/")&&i.push({file:n});i.length&&(1==i.length?this.selected_blobFile_callback_act(i[0].file):this.alertCtrl.create({header:this.lang.text.ChatRoom.MultipleSend,message:`${this.lang.text.ChatRoom.CountFile}: ${i.length}`,buttons:[{text:this.lang.text.ChatRoom.Send,handler:()=>{this.DropSendAct(i)}}]}).then(n=>n.present()))}}GetSpeechToText(){var t=this;return(0,m.c)(function*(){let i=yield O.I.start({language:t.lang.lang,maxResults:1,prompt:t.lang.text.ChatRoom.TalkMessage,partialResults:!0,popup:!0});t.userInput.text=i.matches[0]})()}CreateDrop(){var t=this;let i=document.getElementById("p5Drop_chatroom");this.p5canvas=new J(n=>{n.setup=()=>{let f=n.createCanvas(i.clientWidth,i.clientHeight);f.parent(i),n.pixelDensity(1),f.drop(k=>{let w=n.millis();d<w-400?(c=!1,h.length=0,h.push(k)):(c=!0,h.push(k)),d=w,clearTimeout(l),l=setTimeout((0,m.c)(function*(){if(c)t.alertCtrl.create({header:t.lang.text.ChatRoom.MultipleSend,message:`${t.lang.text.ChatRoom.CountFile}: ${h.length}`,buttons:[{text:t.lang.text.ChatRoom.Send,handler:()=>{t.DropSendAct(h)}}]}).then(I=>I.present());else{let I=yield t.loadingCtrl.create({message:t.lang.text.TodoDetail.WIP});I.present(),t.selected_blobFile_callback_act(k.file),I.dismiss()}}),400)})};let l,c=!1,d=0,h=[];n.mouseMoved=f=>{f.dataTransfer?(i.style.pointerEvents="all",i.style.backgroundColor="#0008"):(i.style.pointerEvents="none",i.style.backgroundColor="transparent")}})}DropSendAct(t){var i=this;return(0,m.c)(function*(){let n=yield i.loadingCtrl.create({message:i.lang.text.TodoDetail.WIP});n.present();for(let l=0,c=t.length;l<c;l++)yield i.selected_blobFile_callback_act(t[l].file),yield i.send();n.dismiss(),setTimeout(()=>{i.scroll_down_logs()},300)})()}selected_blobFile_callback_act(t,i=[],n="loaded",l){var c=this;return(0,m.c)(function*(){c.userInput.file={},c.userInput.file.filename=t.name,c.userInput.file.file_ext=t.name.split(".").pop()||t.type||c.lang.text.ChatRoom.unknown_ext,c.userInput.file.size=t.size,c.userInput.file.type=t.type,l&&(c.userInput.file.path=l),c.userInput.file.content_related_creator=[...i,{user_id:c.info.local?"local":c.nakama.servers[c.isOfficial][c.target].session.user_id,timestamp:(new Date).getTime(),display_name:c.nakama.users.self.display_name,various:n}],c.userInput.file.content_creator={user_id:c.info.local?"local":c.nakama.servers[c.isOfficial][c.target].session.user_id,timestamp:(new Date).getTime(),display_name:c.nakama.users.self.display_name,various:n},c.userInput.file.blob=t,c.create_selected_thumbnail(),c.inputPlaceholder=`(${c.lang.text.ChatRoom.attachments}: ${c.userInput.file.filename})`})()}create_thumbnail_imported(t){var i=this;return(0,m.c)(function*(){let n=yield i.indexed.loadBlobFromUserPath(t.path,t.type);n.name=t.filename||t.name,i.selected_blobFile_callback_act(n,t.content_related_creator,"shared",t.path)})()}create_selected_thumbnail(){var t=this;return(0,m.c)(function*(){if(t.global.set_viewer_category_from_ext(t.userInput.file),t.userInput.file.url){try{(yield fetch(t.userInput.file.url)).ok&&(t.userInput.file.thumbnail=t.userInput.file.url)}catch{}return void(t.userInput.file.typeheader=t.userInput.file.viewer)}try{t.userInput.file.thumbnail=yield t.indexed.loadBlobFromUserPath(t.userInput.file.path,t.userInput.file.type)}catch{}let i=URL.createObjectURL(t.userInput.file.blob);switch(t.userInput.file.typeheader=t.userInput.file.blob.type.split("/")[0]||t.userInput.file.viewer,setTimeout(()=>{URL.revokeObjectURL(i)},0),t.userInput.file.thumbnail=void 0,t.userInput.file.typeheader){case"image":t.userInput.file.thumbnail=t.sanitizer.bypassSecurityTrustUrl(i);break;case"text":new J(n=>{n.setup=()=>{n.noCanvas(),n.loadStrings(i,l=>{t.userInput.file.thumbnail=l,n.remove()},l=>{console.error("\ubb38\uc790\uc5f4 \ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",l),n.remove()})}})}})()}init_chatroom(){var t=this;return(0,m.c)(function*(){t.userInput.text="",delete t.userInput.quickShare,delete t.userInput.file,t.ResizeTextArea(),t.nakama.OnTransferMessage={},t.ViewableMessage.length=0,t.ViewMsgIndex=0,t.ShowGoToBottom=!1,t.ShowRecentMsg=!1,t.isHistoryLoaded=!1,t.LocalHistoryList.length=0,t.messages.length=0,t.prev_cursor="",t.next_cursor="",t.pullable=!0,t.init_last_message_viewer(),t.file_sel_id=`chatroom_${t.info.id}_${(new Date).getTime()}`,t.ChannelUserInputId=`chatroom_input_${t.info.id}_${(new Date).getTime()}`,t.noti.Current=t.info.cnoti_id,t.info.cnoti_id&&t.noti.ClearNoti(t.info.cnoti_id),t.noti.RemoveListener(`openchat${t.info.cnoti_id}`),t.isOfficial=t.info.server.isOfficial,t.target=t.info.server.target,t.info=t.nakama.channels_orig[t.isOfficial][t.target][t.info.id],t.users_image={};try{for(let i=0,n=t.info.info.users.length;i<n;i++)t.users_image[t.info.info.users[i].user.id]=t.info.info.users[i].user.img}catch{}try{t.users_image[t.info.info.id]=t.info.info.img}catch{}switch(t.LoadChannelBackgroundImage(),t.nakama.opened_page_info.channel={isOfficial:t.isOfficial,target:t.target,id:t.info.id},t.foundLastRead=t.info.last_read_id==t.info.last_comment_id,t.extended_buttons.forEach(i=>{i.isHide=!1}),t.info.redirect.type){case 2:"missing"!=t.info.status&&(t.info.redirect?"online"==t.statusBar.groupServer[t.isOfficial][t.target]&&(t.info.status=t.nakama.load_other_user(t.info.redirect.id,t.isOfficial,t.target).online?"online":"pending"):t.info.status=t.info.info.online?"online":"pending",t.extended_buttons[0].isHide=!0,t.extended_buttons[1].isHide=!0,t.extended_buttons[9].isHide="http:"==window.location.protocol&&0!=window.location.host.indexOf("localhost")||!1,t.extended_buttons[12].isHide=!0);break;case 3:"missing"!=t.info.status&&(yield t.nakama.load_groups(t.isOfficial,t.target,t.info.group_id)),t.extended_buttons[1].isHide=!0,t.extended_buttons[11].isHide=!0,delete t.extended_buttons[0].isHide,t.extended_buttons[9].isHide=!0,t.extended_buttons[12].isHide=!0;break;case 0:t.extended_buttons[0].isHide=!0,t.extended_buttons[8].isHide=!0,t.extended_buttons[9].isHide=!0,t.extended_buttons[11].isHide=!0}t.nakama.channels_orig[t.isOfficial][t.target]&&t.nakama.channels_orig[t.isOfficial][t.target][t.info.id]&&"missing"!=t.info.status&&(t.nakama.channels_orig[t.isOfficial][t.target][t.info.id].update=i=>{if(1==i.code){for(let l=0,c=t.messages.length;l<c;l++)if(t.messages[l].message_id==i.message_id){t.messages[l].content=i.content;break}return}let n="local"==i.sender_id;n||t.nakama.check_sender_and_show_name(i,t.isOfficial,t.target),i.content.filename&&t.ModulateFileEmbedMessage(i),t.info.last_read_id=t.info.last_comment_id,t.nakama.save_channels_with_less_info(),n||t.check_if_send_msg(i),1==i.code||2==i.code||t.messages.push(i),t.ViewMsgIndex+t.ViewCount==t.messages.length-1&&t.ViewMsgIndex++,t.ViewableMessage=t.messages.slice(t.ViewMsgIndex,t.ViewMsgIndex+t.ViewCount),t.modulate_chatmsg(0,t.ViewableMessage.length),t.modulate_chatmsg(t.ViewableMessage.length-1,t.ViewableMessage.length),t.ShowRecentMsg=t.messages.length>t.ViewMsgIndex+t.ViewCount,t.useSpeaker&&t.SpeechReceivedMessage(i),setTimeout(()=>{if(t.info.is_new=!1,t.nakama.has_new_channel_msg=!1,t.NeedScrollDown()&&!t.ShowRecentMsg)t.init_last_message_viewer(),t.ChatLogs.scrollTo({top:t.ChatLogs.scrollHeight,behavior:"smooth"});else{t.last_message_viewer.is_me=!!t.info.local||i.sender_id==t.nakama.servers[t.isOfficial][t.target].session.user_id,t.last_message_viewer.user_id=i.sender_id;let l=JSON.parse(JSON.stringify(i.content.msg));i.content.filename&&(l.length?l[0][0].text=`(${t.lang.text.ChatRoom.attachments}) ${l[0][0].text}`:l=[[{text:`(${t.lang.text.ChatRoom.attachments})`}]]),t.last_message_viewer.message=l,t.last_message_viewer.color=i.color}},0),t.global.godot_window&&t.global.godot_window.received_msg&&t.global.godot_window.received_msg({sender_id:i.sender_id,user_display_name:i.user_display_name,content:i.content})}),(void 0===t.info.status||"missing"==t.info.status)&&(t.extended_buttons.forEach(i=>{i.isHide=!0}),t.extended_buttons[12].isHide=!1,3==t.info.redirect.type&&(t.extended_buttons[0].isHide=!1)),t.extended_buttons[10].isHide=L.O$||"missing"==t.info.status,t.pull_msg_history(),setTimeout(()=>{t.ChatLogs.scrollTo({top:t.ChatLogs.scrollHeight,behavior:"smooth"})},500)})()}init_last_message_viewer(){delete this.last_message_viewer.user_id,delete this.last_message_viewer.message,delete this.last_message_viewer.color,delete this.last_message_viewer.is_me}NeedScrollDown(){return this.ChatLogs.scrollHeight<this.ChatLogs.scrollTop+this.ChatLogs.clientHeight+200}scroll_down_logs(){this.ShowRecentMsg||this.init_last_message_viewer(),this.ChatLogs.scrollTo({top:this.ChatLogs.scrollHeight,behavior:"smooth"})}check_if_send_msg(t){for(let i=0,n=this.sending_msg.length;i<n;i++)if(t.sender_id==this.nakama.servers[this.isOfficial][this.target].session.user_id&&t.content.local_comp==this.sending_msg[i].content.local_comp){t.content.filename&&this.auto_open_thumbnail(t),this.sending_msg.splice(i,1);break}}auto_open_thumbnail(t){try{this.temporary_open_thumbnail[t.message_id]()}catch{this.temporary_open_thumbnail[t.message_id]=()=>{this.indexed.loadBlobFromUserPath(`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${t.message_id}.${t.content.file_ext}`,t.content.type,n=>{t.content.path=`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${t.message_id}.${t.content.file_ext}`;let l=URL.createObjectURL(n);this.global.modulate_thumbnail(t.content,l),this.NeedScrollDown()&&setTimeout(()=>{this.scroll_down_logs()},100),this.nakama.WriteStorage_From_channel(t,t.content.path,this.isOfficial,this.target)}),delete this.temporary_open_thumbnail[t.message_id]}}}removeAttach(){delete this.userInput.file,this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder}pull_msg_history(t=!0){var i=this;return(0,m.c)(function*(){if(i.pullable||!t)if(i.pullable=!1,t)try{if(i.info.local)throw"Local channel";if(void 0===i.info.status||"missing"==i.info.status)throw"Channel missing";if(0!=i.ViewMsgIndex){let n=Math.min(i.ViewMsgIndex,i.RefreshCount);i.ViewMsgIndex-=n,i.ViewableMessage=i.messages.slice(i.ViewMsgIndex,i.ViewMsgIndex+i.ViewCount);for(let l=0;l<n;l++){let c;try{i.ViewableMessage[l].content.path=`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${i.ViewableMessage[l].message_id}.${i.ViewableMessage[l].content.file_ext}`;let d=yield i.indexed.loadBlobFromUserPath(i.ViewableMessage[l].content.path,i.ViewableMessage[l].content.file_ext);c=URL.createObjectURL(d)}catch{}i.global.modulate_thumbnail(i.ViewableMessage[l].content,c),i.modulate_chatmsg(l,n+1)}return i.modulate_chatmsg(0,i.ViewableMessage.length),i.ShowRecentMsg=i.messages.length>i.ViewMsgIndex+i.ViewCount,void(i.pullable=!0)}yield i.nakama.servers[i.isOfficial][i.target].client.listChannelMessages(i.nakama.servers[i.isOfficial][i.target].session,i.info.id,i.RefreshCount,!1,i.next_cursor).then(n=>{i.info.is_new=!1,n.messages.forEach(l=>{l=i.nakama.modulation_channel_message(l,i.isOfficial,i.target),i.nakama.check_sender_and_show_name(l,i.isOfficial,i.target),i.info.last_comment||(i.info.last_comment=(l.content.filename?`(${i.lang.text.ChatRoom.attachments}) `:"")+(l.content.msg||l.content.noti||"")),!i.foundLastRead&&i.info.last_read_id?i.info.last_read_id==l.message_id&&(l.isLastRead=!0,i.foundLastRead=!0,i.info.last_read_id=i.info.last_comment_id,i.nakama.save_channels_with_less_info()):i.foundLastRead=!0,i.nakama.translate_updates(l),l.content.filename&&i.ModulateFileEmbedMessage(l),i.nakama.ModulateTimeDate(l),i.nakama.content_to_hyperlink(l),2!=l.code&&i.messages.unshift(l)}),i.ViewableMessage=i.messages.slice(i.ViewMsgIndex,i.ViewMsgIndex+i.ViewCount);for(let l=0,c=i.ViewableMessage.length;l<c;l++){let d;try{if(!i.ViewableMessage[l].content.file_ext)throw"\ud30c\uc77c\uc774 \uc5c6\ub294 \uba54\uc2dc\uc9c0";if(i.ViewableMessage[l].content.url)throw"\ub9c1\ud06c\ub41c \ud30c\uc77c";i.ViewableMessage[l].content.path=`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${i.ViewableMessage[l].message_id}.${i.ViewableMessage[l].content.file_ext}`,i.indexed.checkIfFileExist(i.ViewableMessage[l].content.path,h=>{h&&i.indexed.loadBlobFromUserPath(i.ViewableMessage[l].content.path,i.ViewableMessage[l].content.file_ext,f=>{d=URL.createObjectURL(f),i.global.modulate_thumbnail(i.ViewableMessage[l].content,d)})})}catch{}i.modulate_chatmsg(l,c+1)}i.modulate_chatmsg(0,i.ViewableMessage.length),i.ShowRecentMsg=i.messages.length>i.ViewMsgIndex+i.ViewCount,i.next_cursor=n.next_cursor,i.prev_cursor=n.prev_cursor,i.pullable=!0,i.nakama.saveListedMessage(i.messages,i.info,i.isOfficial,i.target)})}catch{if(3==i.info.redirect.type&&i.nakama.groups[i.isOfficial][i.target]&&i.nakama.groups[i.isOfficial][i.target][i.info.group_id]&&!i.nakama.groups[i.isOfficial][i.target][i.info.group_id].open)return i.isOfflineClosedGroup=!0,i.next_cursor=void 0,void(i.isHistoryLoaded=!0);i.LoadLocalChatHistory()}else{let n=i.messages.length-i.ViewMsgIndex-i.ViewCount;i.ShowRecentMsg=0!=n,i.ViewMsgIndex+=Math.min(i.RefreshCount,n),i.ViewableMessage=i.messages.slice(i.ViewMsgIndex,i.ViewMsgIndex+i.ViewCount);for(let l=i.ViewableMessage.length-1;l>=0;l--){let c;try{i.ViewableMessage[l].content.path=`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${i.ViewableMessage[l].message_id}.${i.ViewableMessage[l].content.file_ext}`;let d=yield i.indexed.loadBlobFromUserPath(i.ViewableMessage[l].content.path,i.ViewableMessage[l].content.file_ext);c=URL.createObjectURL(d)}catch{}i.global.modulate_thumbnail(i.ViewableMessage[l].content,c),i.modulate_chatmsg(l,i.ViewableMessage.length)}i.pullable=!0}})()}SpeechReceivedMessage(t){try{let i=JSON.parse(JSON.stringify(t.content.msg)),n="";for(let l=0,c=i.length;l<c;l++)for(let d=0,h=i[l].length;d<h;d++)n+=i[l][d].text+" ";this.SpeechThese.push(n),this.isSpeeching||this.SpeechingTexts()}catch{}}SpeechingTexts(){var t=this;return(0,m.c)(function*(){let i=t.SpeechThese.shift();t.isSpeeching=!0,yield x.speak({text:i,lang:t.lang.lang}),t.SpeechThese.length?t.SpeechingTexts():t.isSpeeching=!1})()}LoadLocalChatHistory(){var t=this;return(0,m.c)(function*(){if(t.ViewMsgIndex>0){let i=Math.min(t.ViewableMessage.length,Math.min(t.ViewMsgIndex,t.RefreshCount));t.ViewMsgIndex-=i,t.ViewableMessage=t.messages.slice(t.ViewMsgIndex,t.ViewMsgIndex+t.ViewCount);for(let n=i-1;n>=0;n--){let l;try{t.ViewableMessage[n].content.path=`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/files/msg_${t.ViewableMessage[n].message_id}.${t.ViewableMessage[n].content.file_ext}`;let c=yield t.indexed.loadBlobFromUserPath(t.ViewableMessage[n].content.path,t.ViewableMessage[n].content.file_ext);l=URL.createObjectURL(c)}catch{}t.global.modulate_thumbnail(t.ViewableMessage[n].content,l),t.modulate_chatmsg(n,i+1)}return t.ShowRecentMsg=t.messages.length>t.ViewMsgIndex+t.ViewCount,t.pullable=0!=t.ViewMsgIndex||!!t.LocalHistoryList.length,void(t.ViewableMessage.length<t.RefreshCount&&t.LoadLocalChatHistory())}t.isHistoryLoaded?t.indexed.loadTextFromUserPath(t.LocalHistoryList.pop(),function(){var i=(0,m.c)(function*(n,l){if(n&&l){let c=JSON.parse(l.trim());for(let h=c.length-1;h>=0;h--)t.nakama.translate_updates(c[h]),c[h]=t.nakama.modulation_channel_message(c[h],t.isOfficial,t.target),t.nakama.ModulateTimeDate(c[h]),2!=c[h].code&&t.messages.unshift(c[h]);t.ViewMsgIndex=Math.max(0,c.length-t.RefreshCount),t.ViewableMessage=t.messages.slice(t.ViewMsgIndex,t.ViewMsgIndex+t.ViewCount);let d=Math.min(Math.min(c.length,t.RefreshCount),t.ViewableMessage.length);for(let h=d-1;h>=0;h--){let f;try{t.ViewableMessage[h].content.path=`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/files/msg_${t.ViewableMessage[h].message_id}.${t.ViewableMessage[h].content.file_ext}`;let k=yield t.indexed.loadBlobFromUserPath(t.ViewableMessage[h].content.path,t.ViewableMessage[h].content.file_ext);f=URL.createObjectURL(k)}catch{}t.global.modulate_thumbnail(t.ViewableMessage[h].content,f),t.modulate_chatmsg(h,d)}t.ShowRecentMsg=t.messages.length>t.ViewMsgIndex+t.ViewCount}else n&&t.LoadLocalChatHistory();t.pullable=!!t.LocalHistoryList.length});return function(n,l){return i.apply(this,arguments)}}()):t.indexed.GetFileListFromDB(`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/chats/`,i=>{t.LocalHistoryList=i,t.isHistoryLoaded=!0,t.LocalHistoryList.length&&t.indexed.loadTextFromUserPath(t.LocalHistoryList.pop(),function(){var n=(0,m.c)(function*(l,c){if(l&&c){let d=JSON.parse(c.trim());for(let h=d.length-1;h>=0;h--)t.nakama.translate_updates(d[h]),t.info.local||(d[h]=t.nakama.modulation_channel_message(d[h],t.isOfficial,t.target)),t.nakama.ModulateTimeDate(d[h]),2!=d[h].code&&t.messages.unshift(d[h]);t.ViewMsgIndex=Math.max(0,t.messages.length-t.RefreshCount),t.ViewableMessage=t.messages.slice(t.ViewMsgIndex,t.ViewMsgIndex+t.RefreshCount),t.modulate_chatmsg(0,d.length);for(let h=t.ViewableMessage.length-1;h>=0;h--){let f;try{t.ViewableMessage[h].content.path=`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/files/msg_${t.ViewableMessage[h].message_id}.${t.ViewableMessage[h].content.file_ext}`;let k=yield t.indexed.loadBlobFromUserPath(t.ViewableMessage[h].content.path,t.ViewableMessage[h].content.file_ext);f=URL.createObjectURL(k)}catch{}t.global.modulate_thumbnail(t.ViewableMessage[h].content,f),t.modulate_chatmsg(h,t.ViewableMessage.length)}t.ViewableMessage.length<t.RefreshCount&&t.LoadLocalChatHistory()}t.next_cursor=null,t.pullable=!0});return function(l,c){return n.apply(this,arguments)}}())})})()}open_ext_with_delay(){this.ScrollNearLogs(),this.isHidden=!this.isHidden}make_ext_hidden(){this.ScrollNearLogs(),"DesktopPWA"!=L.s1&&(this.isHidden=!0)}ScrollNearLogs(){this.NeedScrollDown()&&(this.ChatLogs.scrollTo({top:this.ChatLogs.scrollHeight,behavior:"smooth"}),setTimeout(()=>{this.ChatLogs.scrollTo({top:this.ChatLogs.scrollHeight,behavior:"smooth"})},150))}ResizeTextArea(){this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId)),this.userInputTextArea.style.height="36px"}check_key(t){this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId)),"DesktopPWA"==L.s1?"Enter"!=t.key||t.shiftKey||"keydown"!=t.type?setTimeout(()=>{this.ResizeTextArea(),this.userInputTextArea.style.height=this.userInputTextArea.scrollHeight+"px"},0):this.send(!0):setTimeout(()=>{this.ResizeTextArea(),this.userInputTextArea.style.height=this.userInputTextArea.scrollHeight+"px"},0)}send(t=!1){var i=this;return(0,m.c)(function*(){if(t&&("Android"==L.s1||"iOS"==L.s1))return;if(i.userInputTextArea||(i.userInputTextArea=document.getElementById(i.ChannelUserInputId)),!i.userInput.text.trim()&&!i.userInput.file&&!i.userInput.quickShare)return void setTimeout(()=>{i.userInput.text="",i.ResizeTextArea()},0);i.userInputTextArea.focus(),setTimeout(()=>{i.userInputTextArea.focus()},0),i.isHidden=!0;let n={};n.msg=i.userInput.text;let l=!1,c=!1,d="";if(i.userInput.file){n.filename=i.userInput.file.filename,n.file_ext=i.userInput.file.file_ext,n.type=i.userInput.file.type;try{n.filesize=i.userInput.file.size||i.userInput.file.blob.size,n.partsize=Math.ceil(n.filesize/q.KY)}catch{n.url=i.userInput.file.url,c=!0}if(n.msg.length>800?(d=n.msg,delete n.msg):n.msg=n.msg,n.content_creator=i.userInput.file.content_creator,n.content_related_creator=i.userInput.file.content_related_creator,!c&&i.useCDN&&!i.info.local)try{let f=i.nakama.servers[i.isOfficial][i.target].info.address,k=i.nakama.servers[i.isOfficial][i.target].info.useSSL?"https:":"http:",w=yield i.global.upload_file_to_storage(i.userInput.file,i.nakama.servers[i.isOfficial][i.target].session.user_id,k,f,i.useFirstCustomCDN);if(c=!!w,!c)throw"\ub9c1\ud06c \ub9cc\ub4e4\uae30 \uc2e4\ud328";delete n.partsize,n.url=w}catch(f){console.log("cdn \uc5c5\ub85c\ub4dc \ucc98\ub9ac \uc2e4\ud328: ",f)}l=!0;for(let f=0,k=n.content_related_creator.length;f<k;f++)delete n.content_related_creator[f].is_me,delete n.content_related_creator[f].timeDisplay,delete n.content_related_creator[f].various_display}else if(n.msg.length>800)return void i.LongTextMessageAsFile(n);i.userInput.quickShare&&(n.quickShare=i.userInput.quickShare),n.local_comp=Math.random();let h={content:JSON.parse(JSON.stringify(n))};if(i.nakama.content_to_hyperlink(h),i.info.local){let f=(new Date).getTime().toString();if(l&&!c)try{let I;if(i.useFirstCustomCDN&&(I=yield i.global.try_upload_to_user_custom_fs(i.userInput.file,i.nakama.users.self.display_name)),!I)throw"\uc5c5\ub85c\ub4dc \uc2e4\ud328";delete h.content.path,delete h.content.partsize,h.content.url=I}catch{let V=`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${f}.${i.userInput.file.file_ext}`;yield i.indexed.saveBlobToUserPath(i.userInput.file.blob,V)}delete i.userInput.quickShare,delete i.userInput.file,d&&(h.msg=d,i.LongTextMessageAsFile(h));let k=(new Date).toISOString(),w={channel_id:i.info.id,code:0,color:"888888",...h,create_time:k,update_time:k,sender_id:"local",message_id:f,user_display_name:i.nakama.users.self.display_name,is_me:!0};i.SendLocalMessage(w)}else{i.sending_msg.push(h);try{yield i.nakama.servers[i.isOfficial][i.target].socket.writeChatMessage(i.info.id,n).then(f=>{l&&!c&&i.indexed.saveBlobToUserPath(i.userInput.file.blob,`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${f.message_id}.${i.userInput.file.file_ext}`,()=>{i.auto_open_thumbnail({content:n,message_id:f.message_id})}),delete i.userInput.quickShare,delete i.userInput.file,i.userInput.text="",i.ResizeTextArea(),i.inputPlaceholder=i.lang.text.ChatRoom.input_placeholder,d&&(n.msg=d,i.LongTextMessageAsFile(n))})}catch(f){3===f.code?i.p5toast.show({text:i.lang.text.ChatRoom.FailedToJoinChannel}):(console.log("\uc624\ub958 \uac80\ud1a0 \ud544\uc694: ",f),i.p5toast.show({text:`${i.lang.text.ChatRoom.FailedToSend}: ${f.message}`})),setTimeout(()=>{i.userInput.text="",i.ResizeTextArea()},0),setTimeout(()=>{for(let k=i.sending_msg.length-1;k>=0;k--)i.sending_msg[k].content.local_comp==n.local_comp&&i.sending_msg.splice(k,1)},1500)}}})()}SendLocalMessage(t){let i=this.deserialize_text(t);this.nakama.ModulateTimeDate(t),this.nakama.channels_orig[this.isOfficial][this.target][t.channel_id].last_comment_time=t.update_time,this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].last_comment_id=t.message_id,this.nakama.rearrange_channels(),this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].update(t),this.nakama.saveListedMessage([t],this.info,this.isOfficial,this.target),this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].last_comment=(t.content.filename?`(${this.lang.text.ChatRoom.attachments}) `:"")+(i||t.content.noti||(t.content.match?this.lang.text.ChatRoom.JoinWebRTCMatch:void 0)||""),this.nakama.save_channels_with_less_info(),setTimeout(()=>{this.userInput.text="",this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId)),this.ResizeTextArea(),this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder},0)}LongTextMessageAsFile(t){var i=this;return(0,m.c)(function*(){let n=new Blob([t.msg]);yield i.indexed.saveBlobToUserPath(n,`tmp_files/chatroom/${i.lang.text.ChatRoom.LongText}_${t.msg.substring(0,10)}.txt`);let l={};l.blob=n,l.content_related_creator=[{user_id:i.info.local?"local":i.nakama.servers[i.isOfficial][i.target].session.user_id,timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"long_text"}],l.content_creator={user_id:i.info.local?"local":i.nakama.servers[i.isOfficial][i.target].session.user_id,timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"long_text"};let c=t.msg.substring(0,24);l.path=`tmp_files/chatroom/${i.lang.text.ChatRoom.LongText}_${c}~.txt`,l.file_ext="txt",l.filename=`[${i.lang.text.ChatRoom.LongText}] ${c}~.txt`,i.global.set_viewer_category_from_ext(l),l.type="text/plain",l.typeheader="text",delete t.msg,delete i.userInput.quickShare,delete i.userInput.file,i.userInput.text="",i.ResizeTextArea(),i.inputPlaceholder=i.lang.text.ChatRoom.input_placeholder,i.userInput.file=l,i.inputPlaceholder=`(${i.lang.text.ChatRoom.attachments}: ${i.userInput.file.filename})`,i.create_selected_thumbnail(),i.p5toast.show({text:i.lang.text.ChatRoom.CreateAsTextFile})})()}SetOtherAct(){this.isOtherAct=!0,setTimeout(()=>{this.isOtherAct=!1},0)}message_detail(t,i){var n=this;return(0,m.c)(function*(){if(n.isOtherAct||"offline"==n.info.status||"missing"==n.info.status||!t.is_me)return;let d,l=n.deserialize_text(t),c=l;if(t.content.viewer){try{if("image"!=t.content.viewer)throw"\uc774\ubbf8\uc9c0 \ud30c\uc77c\uc774 \uc544\ub2d8";let w=yield n.indexed.loadBlobFromUserPath(t.content.path,t.content.type);d=URL.createObjectURL(w)}catch{try{let I=yield n.indexed.loadBlobFromUserPath(`${t.content.path}_thumbnail.png`,t.content.type);d=URL.createObjectURL(I)}catch{}}c=`(${n.lang.text.ChatRoom.attachments}) ${c}`}t.content.url&&(d=t.content.thumbnail);let h=d?`<div style="text-align: center;">${c}</div>`:`<div>${c}</div>`;var w;n.alertCtrl.create({header:n.lang.text.ChatRoom.ManageChat,message:new Y.AF(d?`<div style="width: 100%;"><img src="${d}" alt="${t.content.filename}" style="border-radius: 8px; max-height: 230px; position: relative; left: 50%; transform: translateX(-50%); ${n.info.HideAutoThumbnail?"filter: blur(6px);":""}"></div>`+h:h),buttons:[{text:n.lang.text.ChatRoom.EditChat,handler:()=>{var w;n.alertCtrl.create({header:n.lang.text.ChatRoom.EditChat,inputs:[{type:"textarea",value:l,placeholder:c}],buttons:[{text:n.lang.text.ChatRoom.EditChat,handler:(w=(0,m.c)(function*(I){let V=I[0]||c,Q=!1,j=JSON.parse(JSON.stringify(t));if(j.content.msg=V,j.content.edited=!0,j.update_time=(new Date).toISOString(),n.info.local)Q=!0;else try{yield n.nakama.servers[n.isOfficial][n.target].socket.updateChatMessage(n.info.id,t.message_id,j.content),Q=!0}catch(oe){console.log("\uba54\uc2dc\uc9c0 \ud3b8\uc9d1 \uc694\uccad \uc624\ub958: ",oe)}Q&&(j.code=1,n.info.local&&(n.nakama.content_to_hyperlink(j),n.SendLocalMessage(j)))}),function(V){return w.apply(this,arguments)})}]}).then(w=>{w.onWillDismiss().then(()=>{n.ionViewDidEnter()}),n.removeShortCutKey(),w.present()})}},{text:n.lang.text.UserFsDir.Delete,cssClass:"red_font",handler:(w=(0,m.c)(function*(){if(n.info.local){if(d){let I=`servers/${n.isOfficial}/${n.target}/channels/${n.info.id}/files/msg_${t.message_id}.${t.content.file_ext}`;try{yield n.indexed.removeFileFromUserPath(I)}catch{}try{yield n.indexed.removeFileFromUserPath(`${I}_thumbnail.png`)}catch{}}}else try{if(yield n.nakama.servers[n.isOfficial][n.target].socket.removeChatMessage(n.info.id,t.message_id),d){let I=yield n.loadingCtrl.create({message:n.lang.text.UserFsDir.DeleteFile});I.present();for(let Q=0;Q<t.content.partsize;Q++){try{yield n.nakama.servers[n.isOfficial][n.target].client.deleteStorageObjects(n.nakama.servers[n.isOfficial][n.target].session,{object_ids:[{collection:`file_${t.channel_id.replace(/[.]/g,"_")}`,key:`msg_${t.message_id}_${Q}`}]})}catch{}I.message=`${n.lang.text.UserFsDir.DeleteFile}: ${t.content.filename}_${t.content.partsize-Q}`}let V=`servers/${n.isOfficial}/${n.target}/channels/${n.info.id}/files/msg_${t.message_id}.${t.content.file_ext}`;yield n.indexed.removeFileFromUserPath(V),yield n.indexed.removeFileFromUserPath(`${V}_thumbnail.png`),I.dismiss()}}catch(I){console.error("\ucc44\ub110 \uba54\uc2dc\uc9c0 \uc0ad\uc81c \uc624\ub958: ",I)}n.ViewableMessage.splice(i,1);for(let I=0,V=n.messages.length;I<V;I++)if(n.messages[I].message_id==t.message_id){n.messages.splice(I,1);break}t.code=2,n.SendLocalMessage(t);for(let I=n.ViewableMessage.length-1;I>=0;I--)n.modulate_chatmsg(I,n.ViewableMessage.length);n.p5toast.show({text:n.lang.text.ChatRoom.MsgRemoved})}),function(){return w.apply(this,arguments)})}]}).then(w=>{w.onDidDismiss().then(()=>{URL.revokeObjectURL(d),n.isOtherAct=!1}),w.present()})})()}deserialize_text(t){let i="";if(!t.content.msg)return i;for(let n=0,l=t.content.msg.length;n<l;n++){for(let c=0,d=t.content.msg[n].length;c<d;c++)i+=t.content.msg[n][c].text;n+1<l&&(i+="\n")}return i}file_detail(t){var i=this;return(0,m.c)(function*(){if(i.isOtherAct=!0,t.content.url)return i.open_viewer(t,t.content.url),void setTimeout(()=>{i.isOtherAct=!1},0);let n=`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${t.message_id}.${t.content.file_ext}`;try{if(!(yield i.indexed.checkIfFileExist(`${n}.history`)))throw"\uc378\ub124\uc77c \uc5f4\uae30";t.content.text=[i.lang.text.TodoDetail.WIP];let c=yield i.indexed.loadTextFromUserPath(`${n}.history`),d=JSON.parse(c);switch(delete t.content.text,d.type){case"upload":if(t.content.text=[i.lang.text.ChatRoom.uploading],i.nakama.WriteStorage_From_channel(t,n,i.isOfficial,i.target,d.index),t.content.transfer_index&&i.nakama.OnTransfer[i.isOfficial][i.target][t.channel_id][t.message_id].OnTransfer)throw"\uc804\uc1a1\uc791\uc5c5 \uc911, \uc378\ub124\uc77c \uc5f4\uae30";break;case"download":t.content.text=[i.lang.text.TodoDetail.WIP],yield i.nakama.ReadStorage_From_channel(t,n,i.isOfficial,i.target,d.index),i.NeedScrollDown()&&setTimeout(()=>{i.scroll_down_logs()},100)}}catch{(yield i.indexed.checkIfFileExist(n))?(t.content.text||(t.content.text=[i.lang.text.ChatRoom.downloaded]),i.indexed.loadBlobFromUserPath(n,t.content.type,d=>{t.content.path=n;let h=URL.createObjectURL(d);i.global.modulate_thumbnail(t.content,h),i.NeedScrollDown()&&setTimeout(()=>{i.scroll_down_logs()},100)}),i.open_viewer(t,n)):i.isHistoryLoaded||(t.content.text=[i.lang.text.TodoDetail.WIP],yield i.nakama.ReadStorage_From_channel(t,n,i.isOfficial,i.target),i.NeedScrollDown()&&setTimeout(()=>{i.scroll_down_logs()},400))}i.isOtherAct=!1})()}quickShare_act(t){var i=this;return(0,m.c)(function*(){i.SetOtherAct(),i.modalCtrl.create({component:A.i,componentProps:{data:t.content.quickShare}}).then(n=>n.present())})()}JoinWebRTCMatch(t){this.SetOtherAct(),this.nakama.JoinWebRTCMatch(t,this.isOfficial,this.target,this.info)}modulate_chatmsg(t,i){var n=this;return(0,m.c)(function*(){if(0!=i){if(n.ViewableMessage[t].showInfo||(n.ViewableMessage[t].showInfo={}),n.ViewableMessage[t].showInfo.date=!!n.ViewableMessage[t].msgDate,n.ViewableMessage[t].showInfo.sender=!n.ViewableMessage[t].content.noti,t-1>=0&&(n.ViewableMessage[t].showInfo.date=!!n.ViewableMessage[t].msgDate&&n.ViewableMessage[t].msgDate!=n.ViewableMessage[t-1].msgDate,n.ViewableMessage[t].showInfo.sender=!n.ViewableMessage[t].content.noti&&(n.ViewableMessage[t-1].isLastRead||n.ViewableMessage[t].sender_id!=n.ViewableMessage[t-1].sender_id||n.ViewableMessage[t-1].content.noti||n.ViewableMessage[t].msgDate!=n.ViewableMessage[t-1].msgDate||n.ViewableMessage[t].msgTime!=n.ViewableMessage[t-1].msgTime)),n.ViewableMessage[t].content.url)try{let l=yield n.indexed.loadBlobFromUserPath(`${n.ViewableMessage[t].content.path}_thumbnail.png`,"image/png"),c=URL.createObjectURL(l);return n.ViewableMessage[t].content.thumbnail=n.sanitizer.bypassSecurityTrustUrl(c),void setTimeout(()=>{URL.revokeObjectURL(c)},100)}catch{"image"==n.ViewableMessage[t].content.viewer&&n.ViewableMessage[t].content.url&&(n.ViewableMessage[t].content.thumbnail=n.ViewableMessage[t].content.url)}try{t+1<i&&(n.ViewableMessage[t+1].showInfo.date=!!n.ViewableMessage[t].msgDate&&n.ViewableMessage[t].msgDate!=n.ViewableMessage[t+1].msgDate,n.ViewableMessage[t+1].showInfo.sender=!n.ViewableMessage[t+1].content.noti&&(n.ViewableMessage[t].isLastRead||n.ViewableMessage[t].sender_id!=n.ViewableMessage[t+1].sender_id||n.ViewableMessage[t].content.noti||n.ViewableMessage[t].msgDate!=n.ViewableMessage[t+1].msgDate||n.ViewableMessage[t].msgTime!=n.ViewableMessage[t+1].msgTime))}catch{}}})()}ModulateFileEmbedMessage(t){var i=this;let n=`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${t.message_id}.${t.content.file_ext}`;t.content.path=n;try{t.content.transfer_index=this.nakama.OnTransfer[this.isOfficial][this.target][t.channel_id][t.message_id]}catch{}t.content.transfer_index||this.indexed.checkIfFileExist(`${n}.history`,l=>{l&&this.indexed.loadTextFromUserPath(`${n}.history`,(c,d)=>{if(c&&d){let h=JSON.parse(d);delete t.content.text,this.nakama.OnTransfer[this.isOfficial]||(this.nakama.OnTransfer[this.isOfficial]={}),this.nakama.OnTransfer[this.isOfficial][this.target]||(this.nakama.OnTransfer[this.isOfficial][this.target]={}),this.nakama.OnTransfer[this.isOfficial][this.target][t.channel_id]||(this.nakama.OnTransfer[this.isOfficial][this.target][t.channel_id]={}),this.nakama.OnTransfer[this.isOfficial][this.target][t.channel_id][t.message_id]||(this.nakama.OnTransfer[this.isOfficial][this.target][t.channel_id][t.message_id]={index:t.content.partsize-h.index}),t.content.transfer_index=this.nakama.OnTransfer[this.isOfficial][this.target][t.channel_id][t.message_id]}})}),this.global.set_viewer_category(t.content),this.indexed.checkIfFileExist(n,function(){var l=(0,m.c)(function*(c){if(c)t.content.text=[i.lang.text.ChatRoom.downloaded],i.indexed.loadBlobFromUserPath(n,t.content.type,d=>{t.content.path=n;let h=URL.createObjectURL(d);i.global.modulate_thumbnail(t.content,h),i.NeedScrollDown()&&setTimeout(()=>{i.scroll_down_logs()},100)});else try{let d=yield i.indexed.loadBlobFromUserPath(`${t.content.path}_thumbnail.png`,"image/png"),h=URL.createObjectURL(d);i.global.modulate_thumbnail(t.content,h)}catch{}});return function(c){return l.apply(this,arguments)}}())}toggle_thumbnail(){var t=this;return(0,m.c)(function*(){t.info.HideAutoThumbnail=!t.info.HideAutoThumbnail,t.nakama.save_channels_with_less_info()})()}open_viewer(t,i){var n=this;let l=[];for(let c=0,d=this.messages.length;c<d;c++)this.messages[c].content.filename&&l.push(this.messages[c]);this.lock_modal_open||(this.lock_modal_open=!0,this.removeShortCutKey(),this.modalCtrl.create({component:W.K,componentProps:{info:t,path:i,alt_path:i,isOfficial:this.isOfficial,target:this.target,targetDB:this.indexed.ionicDB,relevance:l,local:this.info.local},cssClass:"fullscreen"}).then(c=>{c.onDidDismiss().then(d=>{if(this.ionViewDidEnter(),d.data)switch(d.data.type){case"image":let h=[];if(d.data.msg.content.content_related_creator&&(h=[...d.data.msg.content.content_related_creator]),d.data.msg.content.content_creator){let f=!1;for(let k=0,w=h.length;k<w;k++)if(h[k].user_id==d.data.msg.content.content_creator.user_id){f=!0;break}f||h.push(d.data.msg.content.content_creator)}return void this.modalCtrl.create({component:z.S,componentProps:{path:d.data.path||i,width:d.data.width,height:d.data.height,text:d.data.text},cssClass:"fullscreen"}).then(f=>{f.onWillDismiss().then(function(){var k=(0,m.c)(function*(w){w.data&&(yield n.voidDraw_fileAct_callback(w,h))});return function(w){return k.apply(this,arguments)}}()),f.present()});case"text":this.selected_blobFile_callback_act(d.data.blob,d.data.contentRelated,"textedit")}this.noti.Current=this.info.cnoti_id,this.info.cnoti_id&&this.noti.ClearNoti(this.info.cnoti_id),this.noti.RemoveListener(`openchat${this.info.cnoti_id}`)}),this.noti.Current="IonicViewerPage",c.present(),this.nakama.removeBanner(),this.lock_modal_open=!1}))}voidDraw_fileAct_callback(t,i){var n=this;return(0,m.c)(function*(){try{n.userInput.file={},n.userInput.file.filename=t.data.name,n.userInput.file.file_ext="png",n.userInput.file.thumbnail=n.sanitizer.bypassSecurityTrustUrl(t.data.img),n.userInput.file.type="image/png",n.userInput.file.typeheader="image",i?(n.userInput.file.content_related_creator=i,n.userInput.file.content_creator={user_id:n.info.local?"local":n.nakama.servers[n.isOfficial][n.target].session.user_id,timestamp:(new Date).getTime(),display_name:n.nakama.users.self.display_name,various:"voidDraw"}):(n.userInput.file.content_related_creator=[{user_id:n.info.local?"local":n.nakama.servers[n.isOfficial][n.target].session.user_id,timestamp:(new Date).getTime(),display_name:n.nakama.users.self.display_name,various:"voidDraw"}],n.userInput.file.content_creator={user_id:n.info.local?"local":n.nakama.servers[n.isOfficial][n.target].session.user_id,timestamp:(new Date).getTime(),display_name:n.nakama.users.self.display_name,various:"voidDraw"}),yield n.indexed.saveBase64ToUserPath(t.data.img,`tmp_files/chatroom/${n.userInput.file.filename}`,l=>{n.userInput.file.blob=new Blob([l],{type:n.userInput.file.type})}),n.inputPlaceholder=`(${n.lang.text.ChatRoom.attachments}: ${n.userInput.file.filename})`}catch(l){console.error("godot-\uc774\ubbf8\uc9c0 \ud3b8\uc9d1 \uc0ac\uc6a9 \ubd88\uac00: ",l)}t.data.loadingCtrl.dismiss()})()}user_detail(t){this.lock_modal_open||(this.isOtherAct=!0,this.lock_modal_open=!0,t.is_me?this.modalCtrl.create({component:ie.w,componentProps:{isOfficial:this.info.server.isOfficial,target:this.info.server.target}}).then(i=>{i.onDidDismiss().then(n=>{this.isOtherAct=!1,this.ionViewDidEnter(),this.noti.Current=this.info.cnoti_id,this.info.cnoti_id&&this.noti.ClearNoti(this.info.cnoti_id),this.noti.RemoveListener(`openchat${this.info.cnoti_id}`)}),this.noti.Current="GroupServerPage",i.present(),this.lock_modal_open=!1}):this.modalCtrl.create({component:ee.y,componentProps:{info:{user:this.nakama.load_other_user(t.sender_id,this.isOfficial,this.target)},group:this.info,has_admin:!1}}).then(i=>{i.onDidDismiss().then(n=>{this.isOtherAct=!1,this.noti.Current=this.info.cnoti_id,this.info.cnoti_id&&this.noti.ClearNoti(this.info.cnoti_id),this.noti.RemoveListener(`openchat${this.info.cnoti_id}`)}),this.noti.Current="OthersProfilePage",i.present(),this.lock_modal_open=!1}))}ionViewWillLeave(){this.nakama.rearrange_channels(),this.nakama.channels_orig[this.isOfficial][this.target]&&this.nakama.channels_orig[this.isOfficial][this.target][this.info.id]&&delete this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].update,this.noti.Current=void 0,this.removeShortCutKey()}removeShortCutKey(){delete this.global.p5key.KeyShortCut.Escape,delete this.global.p5key.KeyShortCut.BottomTab,delete this.global.p5key.KeyShortCut.Digit,delete this.global.p5key.KeyShortCut.EnterAct}ngOnDestroy(){delete this.nakama.opened_page_info.channel,this.nakama.ChatroomLinkAct=void 0,this.p5canvas&&this.p5canvas.remove(),this.nakama.OnTransferMessage={}}}return(o=_).\u0275fac=function(t){return new(t||o)(e.GI1(G.qS),e.GI1(X.wX),e.GI1($.gV),e.GI1($.E5),e.GI1(ne.h),e.GI1(C.s),e.GI1(M.Y),e.GI1(p.k),e.GI1(v.o),e.GI1(g.mI),e.GI1(q.A1),e.GI1(G.Kg),e.GI1(R.C),e.GI1(T.O),e.GI1(B._),e.GI1(G.iW),e.GI1(X.WU))},o.\u0275cmp=e.In1({type:o,selectors:[["app-chat-room"]],decls:43,vars:20,consts:[[1,"ion-no-border"],["slot","start"],["defaultHref","portal/subscribes"],["class","top_icon","slot","end","name","eye-outline",3,"click",4,"ngIf"],["class","top_icon","slot","end","name","eye-off-outline",3,"click",4,"ngIf"],[1,"header_online_circle"],["id","p5Drop_chatroom",2,"position","absolute","width","100%","height","100%","display","flex","pointer-events","none"],["id","main_table",1,"channel_bg",2,"width","100%","height","100%","background-color","var(--chatroom-background)"],["oncontextmenu","return false;",2,"height","100%"],[2,"vertical-align","top"],["id","chatroom_div",1,"main",2,"max-width","100vw"],[4,"ngIf"],["id","chatroom_div","class","main","style","max-width: 100vw;",4,"ngIf"],[1,"thumnails"],["class","thumnail_parts",3,"click",4,"ngIf"],["class","thumnail_parts",4,"ngIf"],["id","input_table",2,"width","100%","background-color","var(--chatroom-input-background)"],["fill","clear","mode","md",1,"ion-text-center",3,"disabled","click"],["name","add"],[2,"width","100%","vertical-align","bottom"],[1,"TextAreaInput",3,"id","ngModel","placeholder","ngModelChange","keyup","keydown","click"],["fill","clear","mode","md","expand","block",3,"disabled","click"],["name","send"],["id","ext_menu",3,"hidden"],[1,"expanded"],["hidden","","type","file","id","local_channel","accept","image/*",3,"change"],["hidden","","type","file","id","backgroundImage_sel","accept","image/png",3,"change"],["hidden","","type","file","accept","*","multiple","",3,"id","change"],["style","display: inline-block;",4,"ngFor","ngForOf"],["slot","end","name","eye-outline",1,"top_icon",3,"click"],["slot","end","name","eye-off-outline",1,"top_icon",3,"click"],["button","",3,"disabled","click"],[3,"click",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[3,"click"],["class","my_message_right",4,"ngIf"],["class","notice_form",4,"ngIf"],["style","text-align: center; font-size: 16px; padding-top: 8px;",3,"click",4,"ngIf"],[1,"avatar_form"],["class","avatar_image",3,"click",4,"ngIf"],["class","message_form",4,"ngIf"],["class","quickShare_form",3,"click",4,"ngIf"],["class","file_message_form",4,"ngIf"],["class","message_content_form",4,"ngIf"],["class","read_last_here",4,"ngIf"],[2,"text-align","center","font-size","16px","padding-top","8px",3,"click"],["color","#888"],[1,"avatar_image",3,"click"],["alt","img",1,"avatar_image",3,"src"],[1,"message_form"],[3,"color"],[1,"time_form","message_span_form",3,"click"],[1,"quickShare_form",3,"click"],[1,"file_message_form"],["class","file_button",3,"style","click",4,"ngIf"],["class","file_name_form",3,"click",4,"ngIf"],["class","transfer_count",4,"ngIf"],[1,"file_button",3,"click"],[1,"file_info"],["class","text_seperator",4,"ngIf"],["class","file_info file_text_thumbnail",4,"ngFor","ngForOf"],[1,"text_seperator"],[1,"file_info","file_text_thumbnail"],[1,"file_name_form",3,"click"],[1,"file_thumbnail",3,"src","alt"],[1,"transfer_count"],[1,"message_content_form"],[1,"msg_balloon"],["class","msg_inside_balloon",4,"ngFor","ngForOf"],[1,"msg_inside_balloon"],["class","edited_form",4,"ngIf"],[3,"style","click",4,"ngIf"],["target","_system",3,"href","click",4,"ngIf"],["target","_system",3,"href","click"],[1,"edited_form"],[1,"read_last_here"],[1,"my_message_right"],[2,"display","inline-flex"],["class","my_file_message_form",3,"click",4,"ngIf"],["class","my_file_message_form",4,"ngIf"],["class","message_content_form my_file_message_form",4,"ngIf"],[1,"avatar_form","my_avatar_form"],[1,"time_form","message_span_form_me",3,"click"],[1,"my_file_message_form",3,"click"],[1,"quickShare_form"],[1,"my_file_message_form"],[1,"message_content_form","my_file_message_form"],["alt","my_img",1,"avatar_image",3,"src"],[1,"notice_form"],[1,"notice"],["class","file_button",3,"style",4,"ngIf"],["class","file_name_form",4,"ngIf"],[1,"file_button"],[1,"file_name_form"],["class","comp_local_content",3,"click",4,"ngIf"],["class","comp_local_content","target","_system",3,"href","click",4,"ngIf"],[1,"comp_local_content",3,"click"],["target","_system",1,"comp_local_content",3,"href","click"],[1,"disconnect_info"],["color","medium","name","cloud-offline-outline",2,"width","60px","height","60px"],["color","medium"],[1,"thumnail_parts",3,"click"],[2,"padding","8px","text-align","center"],[1,"thumnail_parts"],[3,"click",4,"ngIf"],[2,"text-align","center","margin-top","4px","max-width","100vw"],["style","display: grid;","class","thumnail_parts",4,"ngIf"],["id","ChatroomSelectedImage","class","image_thumbnail",3,"src","alt",4,"ngIf"],["id","ChatroomSelectedImage",1,"image_thumbnail",3,"src","alt"],[1,"thumnail_parts",2,"display","grid"],[2,"text-align","center","padding","4px 0px"],[1,"bottom_thumbnail"],["fill","clear","expand","block",3,"click"],["name","mic-outline"],[2,"display","inline-block"],[1,"ext_button",3,"hidden","click"],["slot","icon-only","style","width: 36px; height: 36px;",3,"name",4,"ngIf"],["class","ext_icon_img",3,"src","alt",4,"ngIf"],["slot","icon-only",2,"width","36px","height","36px",3,"name"],[1,"ext_icon_img",3,"src","alt"]],template:function(t,i){1&t&&(e.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),e.OEk(3),e.C$Y(),e.I0R(4,"ion-buttons",1),e.wR5(5,"ion-back-button",2),e.C$Y(),e.yuY(6,ae,1,0,"ion-icon",3)(7,le,1,0,"ion-icon",4),e.wR5(8,"div",5),e.C$Y()(),e.I0R(9,"ion-content"),e.wR5(10,"div",6),e.I0R(11,"table",7)(12,"tr",8)(13,"td",9)(14,"div",10),e.yuY(15,ot,6,4,"div",11)(16,lt,6,1,"div",12),e.C$Y(),e.I0R(17,"table",13),e.yuY(18,rt,4,1,"tr",14)(19,mt,3,1,"tr",15)(20,gt,3,1,"tr",14)(21,xt,6,4,"tr",14),e.C$Y()()(),e.I0R(22,"tr")(23,"td")(24,"div")(25,"table",16)(26,"tr")(27,"td")(28,"ion-button",17),e.qCj("click",function(){return i.open_ext_with_delay()}),e.wR5(29,"ion-icon",18),e.C$Y()(),e.I0R(30,"td",19)(31,"textarea",20),e.iHE("ngModelChange",function(l){return e.kNx(i.userInput.text,l)||(i.userInput.text=l),l}),e.qCj("keyup",function(l){return i.check_key(l)})("keydown",function(l){return i.check_key(l)})("click",function(){return i.make_ext_hidden()}),e.C$Y()(),e.yuY(32,yt,3,0,"td",11),e.I0R(33,"td")(34,"ion-button",21),e.qCj("click",function(){return i.send(!1)}),e.wR5(35,"ion-icon",22),e.C$Y()()()()()()(),e.I0R(36,"tr",23)(37,"td")(38,"div",24)(39,"input",25),e.qCj("change",function(l){return i.LocalChannelImageChanged(l)}),e.C$Y(),e.I0R(40,"input",26),e.qCj("change",function(l){return i.ChangeBackgroundImage(l)}),e.C$Y(),e.I0R(41,"input",27),e.qCj("change",function(l){return i.inputFileSelected(l)}),e.C$Y(),e.yuY(42,bt,6,6,"div",28),e.C$Y()()()()()),2&t&&(e.yG2(3),e.cNF(i.info.title||i.lang.text.ChatRoom.noname_chatroom),e.yG2(3),e.E7m("ngIf",!i.info.HideAutoThumbnail),e.yG2(),e.E7m("ngIf",i.info.HideAutoThumbnail),e.yG2(),e.m_g("background-color: "+i.statusBar.colors[i.info.status||"offline"]),e.yG2(7),e.E7m("ngIf",!i.isOfflineClosedGroup),e.yG2(),e.E7m("ngIf",i.isOfflineClosedGroup),e.yG2(2),e.E7m("ngIf",i.userInput.quickShare),e.yG2(),e.E7m("ngIf",i.userInput.file),e.yG2(),e.E7m("ngIf",i.ShowGoToBottom&&!i.last_message_viewer.user_id),e.yG2(),e.E7m("ngIf",i.last_message_viewer.user_id),e.yG2(7),e.E7m("disabled","offline"==((i.info.status?i.info.status:i.info.info.status)||"offline")),e.yG2(3),e.E7m("id",i.ChannelUserInputId),e.OKB("ngModel",i.userInput.text),e.E7m("placeholder",i.inputPlaceholder),e.yG2(),e.E7m("ngIf",i.isMobile),e.yG2(2),e.E7m("disabled",!i.info.status||"missing"==i.info.status||"offline"==i.info.status),e.yG2(2),e.E7m("hidden",i.isHidden),e.yG2(5),e.E7m("id",i.file_sel_id),e.yG2(),e.E7m("ngForOf",i.extended_buttons))},dependencies:[D.ay,D.u_,a.ot,a.ue,a._G,G.sn,G.GS,G._i,G.wB,G.Ko,G.Yb,G.QR,G.tM,G.Md,G.Im],styles:[".top_icon[_ngcontent-%COMP%]{width:28px;height:28px;padding-right:68px;cursor:pointer}.main[_ngcontent-%COMP%]{width:100%;height:100%;padding:8px;overflow-x:hidden;overflow-y:auto;scroll-behavior:smooth}.message_form[_ngcontent-%COMP%]{margin-top:8px;text-shadow:0px 0px 4px var(--chatroom-background),0px 0px 4px var(--chatroom-background),0px 0px 4px var(--chatroom-background)}.channel_bg[_ngcontent-%COMP%]{background-position:center;background-repeat:no-repeat;background-size:cover}.message_span_form[_ngcontent-%COMP%]{margin-left:8px}.message_span_form_me[_ngcontent-%COMP%]{margin-right:4px}.my_message_right[_ngcontent-%COMP%]{text-align:end;margin-bottom:-4px}.msg_balloon[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;border:16px;border-radius:16px;padding:5px 12px 8px;max-width:80vw}.msg_inside_balloon[_ngcontent-%COMP%]{text-align:start}.time_form[_ngcontent-%COMP%]{font-size:12px;color:#888}.file_message_form[_ngcontent-%COMP%]{display:flex;flex-direction:column}.my_file_message_form[_ngcontent-%COMP%]{text-align:right;text-align:-webkit-right}.file_name_form[_ngcontent-%COMP%]{margin-top:4px;max-width:192px;max-height:192px}.file_thumbnail[_ngcontent-%COMP%]{max-width:192px;max-height:192px;width:auto;height:auto;border-radius:8px}.file_info[_ngcontent-%COMP%]{margin:0 4px;text-align:start}.file_text_thumbnail[_ngcontent-%COMP%]{margin-top:2px;display:grid}.quickShare_form[_ngcontent-%COMP%]{border-radius:16px;max-width:156px;width:-moz-fit-content;width:fit-content;height:-moz-fit-content;height:fit-content;padding:8px;margin:4px 0 0;text-align:center;vertical-align:middle;word-break:keep-all;overflow:hidden;background-color:var(--chatroom-you-read-here-backgruond)}.message_content_form[_ngcontent-%COMP%]{display:inline-flex;margin:4px 0 0;place-self:flex-end}.edited_form[_ngcontent-%COMP%]{color:#888;font-size:12px;margin:0 8px;align-self:flex-end;padding-bottom:2px}.avatar_form[_ngcontent-%COMP%]{width:56px;vertical-align:top;padding:12px 8px 0 0;max-width:56px}.my_avatar_form[_ngcontent-%COMP%]{padding:12px 0 0 8px}.avatar_image[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:64px;object-fit:cover}.comp_local_content[_ngcontent-%COMP%]{color:#888}.text_seperator[_ngcontent-%COMP%]{background-color:#fff;margin-top:2px;position:relative;width:100%;height:2px}.expanded[_ngcontent-%COMP%]{height:240px;overflow-x:hidden;overflow-y:auto;scroll-behavior:smooth;text-align:center;background-color:var(--chatroom-input-background)}.ext_button[_ngcontent-%COMP%]{width:64px;height:48px;margin:24px 12px 0;text-align:center}.ext_button_icon[_ngcontent-%COMP%]{width:72px;height:72px}.file_button[_ngcontent-%COMP%]{width:160px;height:112px;overflow:hidden;background-color:gray;margin-top:4px;border-radius:8px}#send_thumbnail[_ngcontent-%COMP%]{width:100%;max-width:100vw;height:-moz-fit-content;height:fit-content;max-height:160px;transform:translateY(-100%);position:relative;background:#bbbb;padding:8px;overflow:hidden}.bottom_thumbnail[_ngcontent-%COMP%]{width:100%;max-width:100vw;max-height:96px;overflow:hidden;padding:8px}.image_thumbnail[_ngcontent-%COMP%]{width:auto;max-height:96px;height:auto;object-fit:contain;display:block;margin:auto;padding:8px}.thumnails[_ngcontent-%COMP%]{width:100%;height:-moz-fit-content;height:fit-content;position:relative;transform:translateY(-100%);background:var(--chatroom-last-msg-viewer-bg);padding:8px}.thumnail_parts[_ngcontent-%COMP%]{max-height:96px;overflow-y:scroll;max-width:100vw}.transfer_count[_ngcontent-%COMP%]{align-self:flex-end;margin-left:4px}.notice_form[_ngcontent-%COMP%]{text-align:center;margin:12px}.notice[_ngcontent-%COMP%]{font-size:12px;display:inline;background:#444;border-radius:8px;padding:4px 8px;color:#fff}.read_last_here[_ngcontent-%COMP%]{text-align:center;font-size:12px;display:inherit;background:var(--chatroom-you-read-here-backgruond);margin:4px 0;color:var(--chatroom-you-read-here-text)}.ext_icon_img[_ngcontent-%COMP%]{max-width:36px;max-height:36px}.md[_ngcontent-%COMP%]   .TextAreaInput[_ngcontent-%COMP%]{width:100%;height:36px;max-height:156px;resize:none;padding:6px;margin-top:5px;border:0;overflow:hidden;background-color:var(--chatroom-input-background)}.ios[_ngcontent-%COMP%]   .TextAreaInput[_ngcontent-%COMP%]{width:100%;height:60px;max-height:156px;resize:none;padding:6px;margin-top:5px;border:0;overflow:hidden;background-color:var(--chatroom-input-background)}"]}),_})()},{path:"ionic-viewer",loadChildren:()=>u.e(3136).then(u.bind(u,3136)).then(o=>o.IonicViewerPageModule)},{path:"void-draw",loadChildren:()=>u.e(2454).then(u.bind(u,2454)).then(o=>o.VoidDrawPageModule)},{path:"quick-share-review",loadChildren:()=>u.e(8812).then(u.bind(u,8812)).then(o=>o.QuickShareReviewPageModule)}];let Ot=(()=>{var o;class _{}return(o=_).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.a4G({type:o}),o.\u0275inj=e.s3X({imports:[$.qQ.forChild(kt),$.qQ]}),_})(),wt=(()=>{var o;class _{}return(o=_).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.a4G({type:o}),o.\u0275inj=e.s3X({imports:[D.MD,a.y,G.wZ,Ot]}),_})()},192:(Z,U,u)=>{u.d(U,{i:()=>ne});var D=u(1528),a=u(4496),G=u(4500),$=u(9240),m=u(5624),Y=u(7136),J=u(3824),ee=u(5020),L=u(1368),W=u(4716);function z(C,M){1&C&&a.wR5(0,"ion-icon",16)}function q(C,M){1&C&&a.wR5(0,"ion-icon",17)}function te(C,M){if(1&C){const p=a.KQA();a.I0R(0,"ion-accordion",7)(1,"ion-item",8),a.yuY(2,z,1,0,"ion-icon",9)(3,q,1,0,"ion-icon",10),a.I0R(4,"ion-label"),a.OEk(5),a.C$Y()(),a.I0R(6,"div",11)(7,"ion-item",4),a.qCj("click",function(){const R=a.usT(p).$implicit;return a.CGJ(R.grant=!R.grant)}),a.I0R(8,"ion-toggle",12),a.iHE("ngModelChange",function(g){const T=a.usT(p).$implicit;return a.kNx(T.grant,g)||(T.grant=g),a.CGJ(g)}),a.OEk(9),a.C$Y()(),a.I0R(10,"ion-item",13)(11,"ion-label"),a.OEk(12),a.C$Y(),a.I0R(13,"ion-label",14),a.OEk(14),a.C$Y()(),a.I0R(15,"ion-item",13)(16,"ion-label"),a.OEk(17),a.C$Y(),a.I0R(18,"ion-label",14),a.OEk(19),a.C$Y()(),a.I0R(20,"ion-item",13)(21,"ion-label"),a.OEk(22),a.C$Y(),a.I0R(23,"ion-label",14),a.OEk(24),a.C$Y()(),a.I0R(25,"ion-item",13)(26,"ion-toggle",15),a.iHE("ngModelChange",function(g){const T=a.usT(p).$implicit;return a.kNx(T.value.isSSL,g)||(T.value.isSSL=g),a.CGJ(g)}),a.OEk(27),a.C$Y()()()()}if(2&C){const p=M.$implicit,v=M.index,g=a.GaO(2);a.E7m("value",v),a.yG2(2),a.E7m("ngIf",!p.grant),a.yG2(),a.E7m("ngIf",p.grant),a.yG2(2),a.cNF(p.value.name),a.yG2(3),a.OKB("ngModel",p.grant),a.yG2(),a.cNF(g.lang.text.QuickShareReview.QuickShareGrant),a.yG2(3),a.cNF(g.lang.text.GroupServer.Address),a.yG2(2),a.cNF(p.value.address),a.yG2(3),a.cNF(g.lang.text.GroupServer.Port),a.yG2(2),a.cNF(p.value.port||7350),a.yG2(3),a.cNF(g.lang.text.GroupServer.Key),a.yG2(2),a.cNF(p.value.key||"defaultkey"),a.yG2(2),a.OKB("ngModel",p.value.isSSL),a.yG2(),a.cNF(g.lang.text.GroupServer.isSSL)}}function H(C,M){if(1&C&&(a.I0R(0,"div")(1,"ion-item-divider")(2,"ion-label"),a.OEk(3),a.C$Y()(),a.I0R(4,"ion-accordion-group"),a.yuY(5,te,28,14,"ion-accordion",6),a.C$Y()()),2&C){const p=a.GaO();a.yG2(3),a.cNF(p.lang.text.QuickShareReview.Servers),a.yG2(2),a.E7m("ngForOf",p.servers)}}function ie(C,M){1&C&&a.wR5(0,"ion-icon",16)}function P(C,M){1&C&&a.wR5(0,"ion-icon",17)}function A(C,M){if(1&C){const p=a.KQA();a.I0R(0,"ion-accordion",7)(1,"ion-item",8),a.yuY(2,ie,1,0,"ion-icon",9)(3,P,1,0,"ion-icon",10),a.I0R(4,"ion-label"),a.OEk(5),a.C$Y()(),a.I0R(6,"div",11)(7,"ion-item",4),a.qCj("click",function(){const R=a.usT(p).$implicit;return a.CGJ(R.grant=!R.grant)}),a.I0R(8,"ion-toggle",12),a.iHE("ngModelChange",function(g){const T=a.usT(p).$implicit;return a.kNx(T.grant,g)||(T.grant=g),a.CGJ(g)}),a.OEk(9),a.C$Y()()()()}if(2&C){const p=M.$implicit,v=M.index,g=a.GaO(2);a.E7m("value",v),a.yG2(2),a.E7m("ngIf",!p.grant),a.yG2(),a.E7m("ngIf",p.grant),a.yG2(2),a.cNF(p.name),a.yG2(3),a.OKB("ngModel",p.grant),a.yG2(),a.cNF(g.lang.text.QuickShareReview.QuickShareGrant)}}function S(C,M){if(1&C&&(a.I0R(0,"div")(1,"ion-item-divider")(2,"ion-label"),a.OEk(3),a.C$Y()(),a.I0R(4,"ion-accordion-group"),a.yuY(5,A,10,6,"ion-accordion",6),a.C$Y()()),2&C){const p=a.GaO();a.yG2(3),a.cNF(p.lang.text.QuickShareReview.Channels),a.yG2(2),a.E7m("ngForOf",p.groups)}}function y(C,M){1&C&&a.wR5(0,"ion-icon",16)}function x(C,M){1&C&&a.wR5(0,"ion-icon",17)}function O(C,M){if(1&C&&(a.I0R(0,"ion-item")(1,"ion-label"),a.OEk(2),a.C$Y()()),2&C){const p=M.$implicit;a.yG2(2),a.cNF(p)}}function e(C,M){if(1&C){const p=a.KQA();a.I0R(0,"ion-accordion",7)(1,"ion-item",8),a.yuY(2,y,1,0,"ion-icon",9)(3,x,1,0,"ion-icon",10),a.I0R(4,"ion-label"),a.OEk(5),a.C$Y()(),a.I0R(6,"div",11),a.yuY(7,O,3,1,"ion-item",18),a.I0R(8,"ion-item",4),a.qCj("click",function(){const R=a.usT(p).$implicit;return a.CGJ(R.grant=!R.grant)}),a.I0R(9,"ion-toggle",12),a.iHE("ngModelChange",function(g){const T=a.usT(p).$implicit;return a.kNx(T.grant,g)||(T.grant=g),a.CGJ(g)}),a.OEk(10),a.C$Y()()()()}if(2&C){const p=M.$implicit,v=M.index,g=a.GaO(2);a.E7m("value",v),a.yG2(2),a.E7m("ngIf",!p.grant),a.yG2(),a.E7m("ngIf",p.grant),a.yG2(2),a.cNF(p.value.urls[0]),a.yG2(2),a.E7m("ngForOf",p.value.urls),a.yG2(2),a.OKB("ngModel",p.grant),a.yG2(),a.cNF(g.lang.text.QuickShareReview.QuickShareGrant)}}function X(C,M){if(1&C&&(a.I0R(0,"div")(1,"ion-item-divider")(2,"ion-label"),a.OEk(3),a.C$Y()(),a.I0R(4,"ion-accordion-group"),a.yuY(5,e,11,7,"ion-accordion",6),a.C$Y()()),2&C){const p=a.GaO();a.yG2(3),a.cNF(p.lang.text.QuickShareReview.Channels),a.yG2(2),a.E7m("ngForOf",p.rtcserver)}}let ne=(()=>{var C;class M{constructor(v,g,R,T,B,ae){this.lang=v,this.navParams=g,this.modalCtrl=R,this.nakama=T,this.p5toast=B,this.global=ae,this.servers=[],this.groups=[],this.rtcserver=[],this.BackButtonPressed=!1}InitBrowserBackButtonOverride(){window.history.replaceState(null,null,window.location.href),window.onpopstate=()=>{this.BackButtonPressed||(this.BackButtonPressed=!0,this.modalCtrl.dismiss())}}ngOnInit(){var v=this;return(0,D.c)(function*(){v.InitBrowserBackButtonOverride();let g=v.navParams.get("data"),R=v.global.CatchGETs(g),T=yield v.nakama.AddressToQRCodeAct(R,!0);for(let B=0,ae=T.length;B<ae;B++)switch(T[B].type){case"server":v.servers.push(T[B]);break;case"group":v.groups.push(T[B]);break;case"rtcserver":v.rtcserver.push(T[B])}})()}apply_selected(){var v=this;return(0,D.c)(function*(){let g=[];for(let R=0,T=v.servers.length;R<T;R++)v.servers[R].grant&&g.push(v.servers[R]);for(let R=0,T=v.groups.length;R<T;R++)v.groups[R].grant&&g.push(v.groups[R]);for(let R=0,T=v.rtcserver.length;R<T;R++)v.rtcserver[R].grant&&g.push(v.rtcserver[R]);yield v.nakama.act_from_QRInfo(g),v.p5toast.show({text:v.lang.text.QuickQRShare.success_received,lateable:!0}),v.modalCtrl.dismiss()})()}}return(C=M).\u0275fac=function(v){return new(v||C)(a.GI1(G.o),a.GI1($.a6),a.GI1(m.qS),a.GI1(Y.h),a.GI1(J.O),a.GI1(ee.A1))},C.\u0275cmp=a.In1({type:C,selectors:[["app-quick-share-review"]],decls:14,vars:5,consts:[[1,"ion-no-border"],["slot","start",3,"click"],["defaultHref",""],[4,"ngIf"],["button","",3,"click"],[1,"ion-text-center"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["slot","header"],["color","danger","slot","start","name","close-outline",4,"ngIf"],["color","success","slot","start","name","checkmark-outline",4,"ngIf"],["slot","content"],[1,"ion_toggle_ignore",3,"ngModel","ngModelChange"],["button",""],[1,"ion-text-end"],["disabled","",1,"ion_toggle_ignore",3,"ngModel","ngModelChange"],["color","danger","slot","start","name","close-outline"],["color","success","slot","start","name","checkmark-outline"],[4,"ngFor","ngForOf"]],template:function(v,g){1&v&&(a.I0R(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),a.OEk(3),a.C$Y(),a.I0R(4,"ion-buttons",1),a.qCj("click",function(){return g.modalCtrl.dismiss()}),a.wR5(5,"ion-back-button",2),a.C$Y()()(),a.I0R(6,"ion-content"),a.yuY(7,H,6,2,"div",3)(8,S,6,2,"div",3)(9,X,6,2,"div",3),a.C$Y(),a.I0R(10,"ion-footer")(11,"ion-item",4),a.qCj("click",function(){return g.apply_selected()}),a.I0R(12,"ion-label",5),a.OEk(13),a.C$Y()()()),2&v&&(a.yG2(3),a.cNF(g.lang.text.QuickShareReview.Title),a.yG2(4),a.E7m("ngIf",g.servers.length),a.yG2(),a.E7m("ngIf",g.groups.length),a.yG2(),a.E7m("ngIf",g.rtcserver.length),a.yG2(4),a.cNF(g.lang.text.QuickShareReview.ApplyChecked))},dependencies:[L.ay,L.u_,W.ue,W._G,m.cm,m.qU,m.GS,m._i,m.eV,m.wB,m.Ko,m.Yb,m.S8,m.QR,m.tM,m.E$,m.Md,m.UJ,m.Im],styles:[".ion_toggle_ignore[_ngcontent-%COMP%]{pointer-events:none}"]}),M})()}}]);