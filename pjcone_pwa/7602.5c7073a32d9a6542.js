"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7602],{5087:(b,E,l)=>{l.d(E,{r:()=>x});var P=l(655),f=l(5016),i=l(9863),_=l(3996),e=l(1282),d=l(3496),w=l(5742),C=l(4433),I=l(3336);let x=(()=>{class p{constructor(c,r,g,n,t,a,o,s,v){this.modalCtrl=c,this.navParams=r,this.global=g,this.indexed=n,this.lang=t,this.file=a,this.alertCtrl=o,this.loadingCtrl=s,this.p5toast=v,this.EventListenerAct=h=>{h.detail.register(120,m=>{})}}ngOnInit(){this.FileInfo=this.navParams.get("info")}ionViewDidEnter(){document.addEventListener("ionBackButton",this.EventListenerAct),this.global.CreateGodotIFrame("viewer",{local_url:"assets/data/godot/viewer.pck",title:"ViewerEx",path:this.navParams.get("path"),ext:this.FileInfo.file_ext,force_logo:!0})}download_file(){"DesktopPWA"==f.n$||"MobilePWA"==f.n$?this.indexed.DownloadFileFromUserPath(this.navParams.get("path"),this.FileInfo.type,this.FileInfo.filename):this.alertCtrl.create({header:this.lang.text.ContentViewer.Filename,inputs:[{name:"filename",placeholder:this.FileInfo.filename,type:"text"}],buttons:[{text:this.lang.text.ContentViewer.saveFile,handler:c=>(0,P.mG)(this,void 0,void 0,function*(){let r=yield this.loadingCtrl.create({message:this.lang.text.TodoDetail.WIP});r.present();let g=c.filename?`${c.filename.replace(/:|\?|\/|\\|<|>/g,"")}.${this.FileInfo.file_ext}`:this.FileInfo.filename,n=yield this.indexed.loadBlobFromUserPath(this.navParams.get("path"),this.FileInfo.type);this.file.writeFile(this.file.externalDataDirectory,g,n).then(t=>{r.dismiss(),this.p5toast.show({text:this.lang.text.ContentViewer.fileSaved})}).catch(t=>{12===(r.dismiss(),t.code)?(this.p5toast.show({text:this.lang.text.ContentViewer.AlreadyExist}),this.download_file()):console.log("\uc900\ube44\ub418\uc9c0 \uc54a\uc740 \uc624\ub958 \ubc18\ud658: ",t)})})}]}).then(c=>c.present())}ionViewWillLeave(){document.removeEventListener("ionBackButton",this.EventListenerAct)}}return p.\u0275fac=function(c){return new(c||p)(i.Y36(_.IN),i.Y36(_.X1),i.Y36(e.A),i.Y36(d.H),i.Y36(w.b),i.Y36(C.$),i.Y36(_.Br),i.Y36(_.HT),i.Y36(I.F))},p.\u0275cmp=i.Xpm({type:p,selectors:[["app-godot-viewer"]],decls:18,vars:3,consts:[["slot","start",3,"click"],["defaultHref",""],[1,"main_table",2,"width","100%","height","100%","margin","0"],[2,"height","0"],[3,"click"],["id","viewer",1,"full_screen",2,"display","flex"]],template:function(c,r){1&c&&(i.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),i._uU(3),i.qZA(),i.TgZ(4,"ion-buttons",0),i.NdJ("click",function(){return r.modalCtrl.dismiss()}),i._UZ(5,"ion-back-button",1),i.qZA()()(),i.TgZ(6,"ion-content")(7,"table",2)(8,"tr",3)(9,"td")(10,"ion-list-header")(11,"ion-label"),i._uU(12),i.qZA(),i.TgZ(13,"ion-button",4),i.NdJ("click",function(){return r.download_file()}),i._uU(14),i.qZA()()()(),i.TgZ(15,"tr")(16,"td"),i._UZ(17,"div",5),i.qZA()()()()),2&c&&(i.xp6(3),i.Oqu(r.lang.text.ContentViewer.Title),i.xp6(9),i.Oqu(r.FileInfo.filename),i.xp6(2),i.hij("",r.lang.text.ContentViewer.Download," "))},directives:[_.Gu,_.sr,_.wd,_.Sm,_.oU,_.cs,_.W2,_.yh,_.Q$,_.YG],styles:[""]}),p})()},774:(b,E,l)=>{l.d(E,{B:()=>c});var P=l(655),f=l(5016),i=l(6505),e=l(9863),d=l(3996),w=l(3496),C=l(5742),I=l(4433),x=l(3336),p=l(9808);function u(r,g){if(1&r){const n=e.EpF();e.TgZ(0,"ion-button",8),e.NdJ("click",function(){return e.CHM(n),e.oxw().modify_image()}),e._uU(1),e.qZA()}if(2&r){const n=e.oxw();e.xp6(1),e.hij(" ",n.lang.text.ContentViewer.Edit," ")}}let c=(()=>{class r{constructor(n,t,a,o,s,v,h,m){this.modalCtrl=n,this.navParams=t,this.indexed=a,this.lang=o,this.file=s,this.p5toast=v,this.alertCtrl=h,this.loadingCtrl=m,this.image_info={}}ngOnInit(){this.FileInfo=this.navParams.get("info"),this.ContentBox=document.getElementById("ContentBox"),this.FileHeader=document.getElementById("FileHeader"),this.HasNoEditButton=this.navParams.get("no_edit")||!1,this.indexed.loadBlobFromUserPath(this.navParams.get("path"),this.FileInfo.type,n=>{this.FileURL=URL.createObjectURL(n)})}ionViewDidEnter(){let n=document.getElementById("p5canvas");switch(this.FileInfo.viewer){case"image":this.p5canvas=new i(t=>{const a="ImageEle";let o,s;t.setup=()=>{let h=t.createCanvas(n.clientWidth,n.clientHeight);h.style("margin","0"),h.style("position","relative"),h.style("pointer-events","none"),o=t.createImg(this.FileURL,this.FileInfo.filename),o.hide(),o.id(a),o.parent(n),o.style("position","relative"),o.style("width","auto"),o.style("height","auto"),setTimeout(()=>{o.show(),this.image_info.width=o.elt.naturalWidth,this.image_info.height=o.elt.naturalHeight,v()},50),("Android"==f.n$||"iOS"==f.n$)&&(s=document.createElement("iframe"),s.setAttribute("src",this.FileURL),s.setAttribute("frameborder","0"),s.setAttribute("class","full_screen"),s.setAttribute("style","position: relative; pointer-events: all"),s.hidden=!0,n.appendChild(s)),t.noLoop()};let v=()=>{o.size().height<n.offsetHeight&&(o.style("top","50%"),o.style("transform","translateY(-50%")),o.style("margin","auto")};t.windowResized=()=>{setTimeout(()=>{v()},50)},t.mouseClicked=h=>{h.target.id==a&&("DesktopPWA"==f.n$||"MobilePWA"==f.n$?window.open(this.FileURL):(o.remove(),s.hidden=!1))}});break;case"audio":this.p5canvas=new i(t=>{var a;t.setup=()=>{let s=t.createCanvas(n.clientWidth,n.clientHeight);s.style("margin","0"),s.style("position","relative"),s.style("pointer-events","none"),t.noLoop(),a=t.createAudio([this.FileURL],()=>{n.appendChild(a.elt),s.parent(n),a.elt.hidden=!0,setTimeout(()=>{o(),a.elt.hidden=!1},50),a.showControls(),a.play()})};let o=()=>{if("audio"!=this.FileInfo.viewer)return;let s=this.ContentBox.offsetWidth;a.elt.setAttribute("style","position: relative; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%);"),a.size(s,25)};t.windowResized=()=>{setTimeout(()=>{o()},50)}});break;case"video":this.p5canvas=new i(t=>{var a;t.setup=()=>{let s=t.createCanvas(n.clientWidth,n.clientHeight);s.style("margin","0"),s.style("position","relative"),s.style("pointer-events","none"),t.noLoop(),a=t.createVideo([this.FileURL],()=>{n.appendChild(a.elt),s.parent(n),a.elt.hidden=!0,setTimeout(()=>{o(),a.elt.hidden=!1},50),a.showControls(),a.play()})};let o=()=>{if("video"!=this.FileInfo.viewer)return;let s=this.ContentBox.offsetWidth,v=this.ContentBox.offsetHeight-this.FileHeader.offsetHeight,h=a.width,m=a.height;a.elt.setAttribute("style","position: relative; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%);"),h>m?(h=s,m=m/a.width*h):(m=v,h=h/a.height*m),a.size(h,m)};t.windowResized=()=>{setTimeout(()=>{o()},50)}});break;default:this.p5canvas=new i(t=>{t.setup=()=>{let a=t.createCanvas(n.clientWidth,n.clientHeight);a.style("margin","0"),a.style("position","relative"),a.style("pointer-events","none"),t.noLoop(),t.loadStrings(this.FileURL,o=>{let s=document.createElement("textarea");s.disabled=!0,s.className="infobox",s.setAttribute("style","height: 100%; display: block;"),s.textContent=o.join("\n"),n.appendChild(s)},o=>{console.error("\uc5f4\ub78c\ud560 \uc218 \uc5c6\ub294 \ud30c\uc77c: ",o),n.textContent="\uc5f4\ub78c\ud560 \uc218 \uc5c6\ub294 \ud30c\uc77c\uc785\ub2c8\ub2e4.",this.FileInfo.else=!0})}})}}modify_image(){this.modalCtrl.dismiss(this.image_info)}download_file(){"DesktopPWA"==f.n$||"MobilePWA"==f.n$?this.indexed.DownloadFileFromUserPath(this.navParams.get("path"),this.FileInfo.type,this.FileInfo.filename):this.alertCtrl.create({header:this.lang.text.ContentViewer.Filename,inputs:[{name:"filename",placeholder:this.FileInfo.filename,type:"text"}],buttons:[{text:this.lang.text.ContentViewer.saveFile,handler:n=>(0,P.mG)(this,void 0,void 0,function*(){let t=yield this.loadingCtrl.create({message:this.lang.text.TodoDetail.WIP});t.present();let a=n.filename?`${n.filename.replace(/:|\?|\/|\\|<|>/g,"")}.${this.FileInfo.file_ext}`:this.FileInfo.filename,o=yield this.indexed.loadBlobFromUserPath(this.navParams.get("path"),this.FileInfo.type);this.file.writeFile(this.file.externalDataDirectory,a,o).then(s=>{t.dismiss(),this.p5toast.show({text:this.lang.text.ContentViewer.fileSaved})}).catch(s=>{12===(t.dismiss(),s.code)?(this.p5toast.show({text:this.lang.text.ContentViewer.AlreadyExist}),this.download_file()):console.log("\uc900\ube44\ub418\uc9c0 \uc54a\uc740 \uc624\ub958 \ubc18\ud658: ",s)})})}]}).then(n=>n.present())}ionViewWillLeave(){this.p5canvas&&this.p5canvas.remove(),this.FileURL&&URL.revokeObjectURL(this.FileURL)}}return r.\u0275fac=function(n){return new(n||r)(e.Y36(d.IN),e.Y36(d.X1),e.Y36(w.H),e.Y36(C.b),e.Y36(I.$),e.Y36(x.F),e.Y36(d.Br),e.Y36(d.HT))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-ionic-viewer"]],decls:19,vars:4,consts:[["id","Toolbar"],["slot","start",3,"click"],["defaultHref",""],["id","ContentBox"],[1,"main_table_elt"],[2,"height","0"],["id","FileHeader"],[3,"click",4,"ngIf"],[3,"click"],["id","p5canvas",1,"full_screen",2,"overflow-y","scroll"]],template:function(n,t){1&n&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),e._uU(3),e.qZA(),e.TgZ(4,"ion-buttons",1),e.NdJ("click",function(){return t.modalCtrl.dismiss()}),e._UZ(5,"ion-back-button",2),e.qZA()()(),e.TgZ(6,"ion-content",3)(7,"table",4)(8,"tr",5)(9,"td")(10,"ion-list-header",6)(11,"ion-label"),e._uU(12),e.qZA(),e.YNc(13,u,2,1,"ion-button",7),e.TgZ(14,"ion-button",8),e.NdJ("click",function(){return t.download_file()}),e._uU(15),e.qZA()()()(),e.TgZ(16,"tr")(17,"td"),e._UZ(18,"div",9),e.qZA()()()()),2&n&&(e.xp6(3),e.Oqu(t.lang.text.ContentViewer.Title),e.xp6(9),e.Oqu(t.FileInfo.filename),e.xp6(1),e.Q6J("ngIf","image"==t.FileInfo.viewer&&!t.HasNoEditButton),e.xp6(2),e.hij(" ",t.lang.text.ContentViewer.Download," "))},directives:[d.Gu,d.sr,d.wd,d.Sm,d.oU,d.cs,d.W2,d.yh,d.Q$,p.O5,d.YG],styles:[".main_table_elt[_ngcontent-%COMP%]{width:100%;height:100%;border:0;margin:0}"]}),r})()}}]);