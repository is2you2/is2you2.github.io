"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7602],{5087:(L,D,d)=>{d.d(D,{r:()=>A});var E=d(655),y=d(5016),n=d(9863),m=d(3996),i=d(1282),g=d(3496),O=d(5742),F=d(4433),k=d(3336);let A=(()=>{class x{constructor(f,r,p,t,e,o,c,s,v){this.modalCtrl=f,this.navParams=r,this.global=p,this.indexed=t,this.lang=e,this.file=o,this.alertCtrl=c,this.loadingCtrl=s,this.p5toast=v,this.EventListenerAct=_=>{_.detail.register(120,h=>{})}}ngOnInit(){this.FileInfo=this.navParams.get("info")}ionViewDidEnter(){document.addEventListener("ionBackButton",this.EventListenerAct),this.global.CreateGodotIFrame("viewer",{local_url:"assets/data/godot/viewer.pck",title:"ViewerEx",path:this.navParams.get("path"),ext:this.FileInfo.file_ext,force_logo:!0,receive_image:(f,r,p)=>{this.modalCtrl.dismiss({base64:","+f,width:r,height:p})}})}snapshot_modify(){this.global.godot_window.modify_image()}download_file(){"DesktopPWA"==y.n$||"MobilePWA"==y.n$?this.indexed.DownloadFileFromUserPath(this.navParams.get("path"),this.FileInfo.type,this.FileInfo.filename):this.alertCtrl.create({header:this.lang.text.ContentViewer.Filename,inputs:[{name:"filename",placeholder:this.FileInfo.filename,type:"text"}],buttons:[{text:this.lang.text.ContentViewer.saveFile,handler:f=>(0,E.mG)(this,void 0,void 0,function*(){let r=yield this.loadingCtrl.create({message:this.lang.text.TodoDetail.WIP});r.present();let p=f.filename?`${f.filename.replace(/:|\?|\/|\\|<|>/g,"")}.${this.FileInfo.file_ext}`:this.FileInfo.filename,t=yield this.indexed.loadBlobFromUserPath(this.navParams.get("path"),this.FileInfo.type);this.file.writeFile(this.file.externalDataDirectory,p,t).then(e=>{r.dismiss(),this.p5toast.show({text:this.lang.text.ContentViewer.fileSaved})}).catch(e=>{12===(r.dismiss(),e.code)?(this.p5toast.show({text:this.lang.text.ContentViewer.AlreadyExist}),this.download_file()):console.log("\uc900\ube44\ub418\uc9c0 \uc54a\uc740 \uc624\ub958 \ubc18\ud658: ",e)})})}]}).then(f=>f.present())}ionViewWillLeave(){document.removeEventListener("ionBackButton",this.EventListenerAct)}}return x.\u0275fac=function(f){return new(f||x)(n.Y36(m.IN),n.Y36(m.X1),n.Y36(i.A),n.Y36(g.H),n.Y36(O.b),n.Y36(F.$),n.Y36(m.Br),n.Y36(m.HT),n.Y36(k.F))},x.\u0275cmp=n.Xpm({type:x,selectors:[["app-godot-viewer"]],decls:20,vars:4,consts:[["slot","start",3,"click"],["defaultHref",""],[1,"main_table",2,"width","100%","height","100%","margin","0"],[2,"height","0"],[3,"click"],["id","viewer",1,"full_screen",2,"display","flex"]],template:function(f,r){1&f&&(n.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),n._uU(3),n.qZA(),n.TgZ(4,"ion-buttons",0),n.NdJ("click",function(){return r.modalCtrl.dismiss()}),n._UZ(5,"ion-back-button",1),n.qZA()()(),n.TgZ(6,"ion-content")(7,"table",2)(8,"tr",3)(9,"td")(10,"ion-list-header")(11,"ion-label"),n._uU(12),n.qZA(),n.TgZ(13,"ion-button",4),n.NdJ("click",function(){return r.snapshot_modify()}),n._uU(14),n.qZA(),n.TgZ(15,"ion-button",4),n.NdJ("click",function(){return r.download_file()}),n._uU(16),n.qZA()()()(),n.TgZ(17,"tr")(18,"td"),n._UZ(19,"div",5),n.qZA()()()()),2&f&&(n.xp6(3),n.Oqu(r.lang.text.ContentViewer.Title),n.xp6(9),n.Oqu(r.FileInfo.filename),n.xp6(2),n.hij("",r.lang.text.ContentViewer.Edit," "),n.xp6(2),n.hij("",r.lang.text.ContentViewer.Download," "))},directives:[m.Gu,m.sr,m.wd,m.Sm,m.oU,m.cs,m.W2,m.yh,m.Q$,m.YG],styles:[""]}),x})()},774:(L,D,d)=>{d.d(D,{B:()=>f});var E=d(655),y=d(5016),n=d(6505),i=d(9863),g=d(3996),O=d(3496),F=d(5742),k=d(4433),A=d(3336),x=d(9808);function C(r,p){if(1&r){const t=i.EpF();i.TgZ(0,"ion-button",8),i.NdJ("click",function(){return i.CHM(t),i.oxw().modify_image()}),i._uU(1),i.qZA()}if(2&r){const t=i.oxw();i.xp6(1),i.hij(" ",t.lang.text.ContentViewer.Edit," ")}}let f=(()=>{class r{constructor(t,e,o,c,s,v,_,h){this.modalCtrl=t,this.navParams=e,this.indexed=o,this.lang=c,this.file=s,this.p5toast=v,this.alertCtrl=_,this.loadingCtrl=h,this.image_info={}}ngOnInit(){this.FileInfo=this.navParams.get("info"),this.ContentBox=document.getElementById("ContentBox"),this.FileHeader=document.getElementById("FileHeader"),this.HasNoEditButton=this.navParams.get("no_edit")||!1,this.indexed.loadBlobFromUserPath(this.navParams.get("path"),this.FileInfo.type,t=>{this.FileURL=URL.createObjectURL(t)})}ionViewDidEnter(){let t=document.getElementById("p5canvas");switch(this.FileInfo.viewer){case"image":this.p5canvas=new n(e=>{let o;e.setup=()=>(0,E.mG)(this,void 0,void 0,function*(){t.style.maxWidth="100%",t.style.overflow="hidden",this.ContentBox.style.overflow="hidden";let l=e.createCanvas(t.clientWidth,t.clientHeight);l.style("margin","0"),l.style("position","relative"),l.style("pointer-events","none"),t.style.backgroundImage=`url(${this.FileURL})`,t.style.backgroundRepeat="no-repeat",t.style.pointerEvents="none";let P=yield this.loadingCtrl.create({message:this.lang.text.TodoDetail.WIP});P.present(),e.loadImage(this.FileURL,a=>{this.image_info.width=a.width,this.image_info.height=a.height,s=e.createVector(a.width,a.height),c(),P.dismiss()},a=>{console.error("viewer-loadImageFailed: ",a),P.dismiss()}),("Android"==y.n$||"iOS"==y.n$)&&(o=document.createElement("iframe"),o.setAttribute("src",this.FileURL),o.setAttribute("frameborder","0"),o.setAttribute("class","full_screen"),o.setAttribute("style","position: relative; pointer-events: all"),o.hidden=!0,t.appendChild(o)),e.noLoop()});let c=()=>{t.style.backgroundSize=`${t.clientWidth}px`,t.style.backgroundPositionX="0px",t.style.backgroundPositionY=t.clientHeight/2-s.y*(t.clientWidth/s.x)/2+"px"};e.windowResized=()=>{setTimeout(()=>{c()},50)};let s,v=e.createVector(),_=e.createVector(),h=e.createVector(),I=1,T=()=>{t.style.backgroundPositionX=`${v.x+h.x}px`,t.style.backgroundPositionY=`${v.y+h.y}px`},M=(l,P)=>{let a=I,b=I*P,w=Number(t.style.backgroundPositionX.split("px")[0]),V=Number(t.style.backgroundPositionY.split("px")[0]),B=(a-b)*e.map(l.x,w,w+a,0,1),R=(a-b)/s.x*s.y*e.map(l.y,V,V+a/s.x*s.y,0,1);t.style.backgroundPositionX=`${w+B}px`,t.style.backgroundPositionY=`${V+R}px`,t.style.backgroundSize=`${b}px`};e.mousePressed=()=>{e.mouseButton==e.CENTER&&c(),"DesktopPWA"==y.n$&&(v=e.createVector(Number(t.style.backgroundPositionX.split("px")[0]),Number(t.style.backgroundPositionY.split("px")[0])),_=e.createVector(e.mouseX,e.mouseY))},e.mouseWheel=l=>{I=Number(t.style.backgroundSize.split("px")[0]),M(e.createVector(t.clientWidth/2,t.clientHeight/2),1-l.delta/1e3)},e.mouseDragged=()=>{"DesktopPWA"==y.n$&&(h=e.createVector(e.mouseX,e.mouseY),h.sub(_),T())};let W,u={},U=!1;e.touchStarted=l=>{for(let a=0,b=l.changedTouches.length;a<b;a++)u[l.changedTouches[a].identifier]=e.createVector(l.changedTouches[a].clientX,l.changedTouches[a].clientY);switch(Object.keys(u).length){case 1:v=e.createVector(Number(t.style.backgroundPositionX.split("px")[0]),Number(t.style.backgroundPositionY.split("px")[0])),_=u[l.changedTouches[0].identifier].copy();break;case 2:v=e.createVector(Number(t.style.backgroundPositionX.split("px")[0]),Number(t.style.backgroundPositionY.split("px")[0]));let a=u[0].copy();W=a.dist(u[1]),_=a.add(u[1]).div(2).copy(),I=Number(t.style.backgroundSize.split("px")[0]),T();break;default:U=!0,c()}},e.touchMoved=l=>{if(!U){for(let a=0,b=l.changedTouches.length;a<b;a++)u[l.changedTouches[a].identifier]=e.createVector(l.changedTouches[a].clientX,l.changedTouches[a].clientY);switch(Object.keys(u).length){case 1:h=u[l.changedTouches[0].identifier].copy(),h.sub(_),T();break;case 2:let a=u[0].copy(),b=a.dist(u[1]);h=a.add(u[1]).div(2).copy();let w=h.copy();h.sub(_),T(),M(w,b/W)}}},e.touchEnded=l=>{if("changedTouches"in l){for(let a=0,b=l.changedTouches.length;a<b;a++)delete u[l.changedTouches[a].identifier];switch(Object.keys(u).length){case 1:v=e.createVector(Number(t.style.backgroundPositionX.split("px")[0]),Number(t.style.backgroundPositionY.split("px")[0])),_=u[Object.keys(u)[0]].copy();break;case 0:U=!1}}}});break;case"audio":this.p5canvas=new n(e=>{var o;e.setup=()=>{let s=e.createCanvas(t.clientWidth,t.clientHeight);s.style("margin","0"),s.style("position","relative"),s.style("pointer-events","none"),e.noLoop(),o=e.createAudio([this.FileURL],()=>{t.appendChild(o.elt),s.parent(t),o.elt.hidden=!0,setTimeout(()=>{c(),o.elt.hidden=!1},50),o.showControls(),o.play()})};let c=()=>{if("audio"!=this.FileInfo.viewer)return;let s=this.ContentBox.offsetWidth;o.elt.setAttribute("style","position: relative; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%);"),o.size(s,25)};e.windowResized=()=>{setTimeout(()=>{c()},50)}});break;case"video":this.p5canvas=new n(e=>{var o;e.setup=()=>{let s=e.createCanvas(t.clientWidth,t.clientHeight);s.style("margin","0"),s.style("position","relative"),s.style("pointer-events","none"),e.noLoop(),o=e.createVideo([this.FileURL],()=>{t.appendChild(o.elt),s.parent(t),o.elt.hidden=!0,setTimeout(()=>{c(),o.elt.hidden=!1},50),o.showControls(),o.play()})};let c=()=>{if("video"!=this.FileInfo.viewer)return;let s=this.ContentBox.offsetWidth,v=this.ContentBox.offsetHeight-this.FileHeader.offsetHeight,_=o.width,h=o.height;o.elt.setAttribute("style","position: relative; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%);"),_>h?(_=s,h=h/o.width*_):(h=v,_=_/o.height*h),o.size(_,h)};e.windowResized=()=>{setTimeout(()=>{c()},50)}});break;default:this.p5canvas=new n(e=>{e.setup=()=>{let o=e.createCanvas(t.clientWidth,t.clientHeight);o.style("margin","0"),o.style("position","relative"),o.style("pointer-events","none"),e.noLoop(),e.loadStrings(this.FileURL,c=>{let s=document.createElement("textarea");s.disabled=!0,s.className="infobox",s.setAttribute("style","height: 100%; display: block;"),s.textContent=c.join("\n"),t.appendChild(s)},c=>{console.error("\uc5f4\ub78c\ud560 \uc218 \uc5c6\ub294 \ud30c\uc77c: ",c),t.textContent="\uc5f4\ub78c\ud560 \uc218 \uc5c6\ub294 \ud30c\uc77c\uc785\ub2c8\ub2e4.",this.FileInfo.else=!0})}})}}modify_image(){this.modalCtrl.dismiss(this.image_info)}download_file(){"DesktopPWA"==y.n$||"MobilePWA"==y.n$?this.indexed.DownloadFileFromUserPath(this.navParams.get("path"),this.FileInfo.type,this.FileInfo.filename):this.alertCtrl.create({header:this.lang.text.ContentViewer.Filename,inputs:[{name:"filename",placeholder:this.FileInfo.filename,type:"text"}],buttons:[{text:this.lang.text.ContentViewer.saveFile,handler:t=>(0,E.mG)(this,void 0,void 0,function*(){let e=yield this.loadingCtrl.create({message:this.lang.text.TodoDetail.WIP});e.present();let o=t.filename?`${t.filename.replace(/:|\?|\/|\\|<|>/g,"")}.${this.FileInfo.file_ext}`:this.FileInfo.filename,c=yield this.indexed.loadBlobFromUserPath(this.navParams.get("path"),this.FileInfo.type);this.file.writeFile(this.file.externalDataDirectory,o,c).then(s=>{e.dismiss(),this.p5toast.show({text:this.lang.text.ContentViewer.fileSaved})}).catch(s=>{12===(e.dismiss(),s.code)?(this.p5toast.show({text:this.lang.text.ContentViewer.AlreadyExist}),this.download_file()):console.log("\uc900\ube44\ub418\uc9c0 \uc54a\uc740 \uc624\ub958 \ubc18\ud658: ",s)})})}]}).then(t=>t.present())}ionViewWillLeave(){this.p5canvas&&this.p5canvas.remove(),this.FileURL&&URL.revokeObjectURL(this.FileURL)}}return r.\u0275fac=function(t){return new(t||r)(i.Y36(g.IN),i.Y36(g.X1),i.Y36(O.H),i.Y36(F.b),i.Y36(k.$),i.Y36(A.F),i.Y36(g.Br),i.Y36(g.HT))},r.\u0275cmp=i.Xpm({type:r,selectors:[["app-ionic-viewer"]],decls:19,vars:4,consts:[["id","Toolbar"],["slot","start",3,"click"],["defaultHref",""],["id","ContentBox"],[1,"main_table_elt"],[2,"height","0"],["id","FileHeader"],[3,"click",4,"ngIf"],[3,"click"],["id","p5canvas",1,"full_screen",2,"overflow-y","scroll"]],template:function(t,e){1&t&&(i.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),i._uU(3),i.qZA(),i.TgZ(4,"ion-buttons",1),i.NdJ("click",function(){return e.modalCtrl.dismiss()}),i._UZ(5,"ion-back-button",2),i.qZA()()(),i.TgZ(6,"ion-content",3)(7,"table",4)(8,"tr",5)(9,"td")(10,"ion-list-header",6)(11,"ion-label"),i._uU(12),i.qZA(),i.YNc(13,C,2,1,"ion-button",7),i.TgZ(14,"ion-button",8),i.NdJ("click",function(){return e.download_file()}),i._uU(15),i.qZA()()()(),i.TgZ(16,"tr")(17,"td"),i._UZ(18,"div",9),i.qZA()()()()),2&t&&(i.xp6(3),i.Oqu(e.lang.text.ContentViewer.Title),i.xp6(9),i.Oqu(e.FileInfo.filename),i.xp6(1),i.Q6J("ngIf","image"==e.FileInfo.viewer&&!e.HasNoEditButton),i.xp6(2),i.hij(" ",e.lang.text.ContentViewer.Download," "))},directives:[g.Gu,g.sr,g.wd,g.Sm,g.oU,g.cs,g.W2,g.yh,g.Q$,x.O5,g.YG],styles:[".main_table_elt[_ngcontent-%COMP%]{width:100%;height:100%;border:0;margin:0}"]}),r})()}}]);