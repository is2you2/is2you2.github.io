"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3832],{5346:(X,J,u)=>{u.d(J,{ez:()=>D});var D=function(O){return O.UTF8="utf8",O.ASCII="ascii",O.UTF16="utf16",O}(D||{})},9745:(X,J,u)=>{u.d(J,{B:()=>y});var s=u(5861),D=u(6845),U=u(9868),O=u(8049),$=u(9761),e=u(9468),p=u(1325),q=u(797),K=u(3857),E=u(2372),L=u(9376),P=u(6052),Z=u(9080),R=u(4663),V=u(4093),Y=u(6814),S=u(95);const ee=["ShowContentInfoIonic"];function te(l,h){if(1&l){const o=e.EpF();e.TgZ(0,"ion-icon",20),e.NdJ("click",function(){e.CHM(o);const i=e.oxw();return e.KtG(i.ChangeToAnother(-1))}),e.qZA()}}function ie(l,h){if(1&l&&(e.TgZ(0,"ion-label",21),e._uU(1),e.qZA()),2&l){const o=e.oxw();e.xp6(1),e.Oqu(o.RelevanceIndex+" / "+o.Relevances.length)}}function ne(l,h){if(1&l){const o=e.EpF();e.TgZ(0,"ion-icon",22),e.NdJ("click",function(){e.CHM(o);const i=e.oxw();return e.KtG(i.ChangeToAnother(1))}),e.qZA()}}function oe(l,h){if(1&l&&(e.TgZ(0,"ion-label",23),e._uU(1),e.qZA()),2&l){const o=e.oxw();e.xp6(1),e.Oqu(o.FileInfo.filename||o.FileInfo.name)}}function ae(l,h){if(1&l){const o=e.EpF();e.TgZ(0,"ion-input",24),e.NdJ("ngModelChange",function(i){e.CHM(o);const g=e.oxw();return e.KtG(g.NewTextFileName=i)}),e.qZA()}if(2&l){const o=e.oxw();e.Q6J("ngModel",o.NewTextFileName)("placeholder",o.FileInfo.filename||o.FileInfo.name)}}function le(l,h){if(1&l){const o=e.EpF();e.TgZ(0,"ion-button",25),e.NdJ("click",function(){e.CHM(o);const i=e.oxw();return e.KtG(i.close_text_edit())}),e._UZ(1,"ion-icon",26),e.qZA()}}function se(l,h){if(1&l){const o=e.EpF();e.TgZ(0,"ion-button",25),e.NdJ("click",function(){e.CHM(o);const i=e.oxw();return e.KtG(i.SaveText())}),e._UZ(1,"ion-icon",27),e.qZA()}}function re(l,h){if(1&l){const o=e.EpF();e.TgZ(0,"ion-button",28),e.NdJ("click",function(){e.CHM(o);const i=e.oxw();return e.KtG(i.DownloadAllListFiles())}),e._UZ(1,"ion-icon",29),e.qZA()}if(2&l){const o=e.oxw();e.Q6J("disabled",o.isDownloading||o.MessageInfo.content.transfer_index&&"download"==o.MessageInfo.content.transfer_index.OnTransfer)}}function ce(l,h){1&l&&(e.TgZ(0,"ion-button",30),e._UZ(1,"ion-icon",31),e.qZA())}function _e(l,h){if(1&l){const o=e.EpF();e.TgZ(0,"ion-item",34),e.NdJ("click",function(){e.CHM(o);const i=e.oxw(3);return e.KtG(i.open_text_editor())}),e.TgZ(1,"ion-label"),e._uU(2),e.qZA()()}if(2&l){const o=e.oxw(3);e.xp6(2),e.Oqu(o.lang.text.ContentViewer.EditText)}}function de(l,h){if(1&l){const o=e.EpF();e.TgZ(0,"ion-item",34),e.NdJ("click",function(){e.CHM(o);const i=e.oxw(3);return e.KtG(i.modify_image())}),e.TgZ(1,"ion-label"),e._uU(2),e.qZA()()}if(2&l){const o=e.oxw(3);e.xp6(2),e.Oqu(o.lang.text.ContentViewer.Edit)}}function ge(l,h){if(1&l){const o=e.EpF();e.TgZ(0,"ion-item",34),e.NdJ("click",function(){e.CHM(o);const i=e.oxw(3);return e.KtG(i.open_bottom_modal())}),e.TgZ(1,"ion-label"),e._uU(2),e.qZA()()}if(2&l){const o=e.oxw(3);e.xp6(2),e.Oqu(o.lang.text.ContentViewer.ContentInfo)}}function fe(l,h){if(1&l){const o=e.EpF();e.TgZ(0,"ion-item",34),e.NdJ("click",function(){e.CHM(o);const i=e.oxw(3);return e.KtG(i.ShareContent())}),e.TgZ(1,"ion-label"),e._uU(2),e.qZA()()}if(2&l){const o=e.oxw(3);e.xp6(2),e.Oqu(o.lang.text.ContentViewer.ShareContent)}}function he(l,h){if(1&l){const o=e.EpF();e.TgZ(0,"ion-item",34),e.NdJ("click",function(){e.CHM(o);const i=e.oxw(3);return e.KtG(i.download_file())}),e.TgZ(1,"ion-label"),e._uU(2),e.qZA()()}if(2&l){const o=e.oxw(3);e.xp6(2),e.Oqu(o.lang.text.ContentViewer.Download)}}function me(l,h){if(1&l){const o=e.EpF();e.TgZ(0,"ion-item",34),e.NdJ("click",function(){e.CHM(o);const i=e.oxw(3);return e.KtG(i.RemoveFile())}),e.TgZ(1,"ion-label"),e._uU(2),e.qZA()()}if(2&l){const o=e.oxw(3);e.xp6(2),e.Oqu(o.lang.text.ContentViewer.RemoveFile)}}function ue(l,h){if(1&l&&(e.TgZ(0,"ion-content")(1,"ion-list"),e.YNc(2,_e,3,1,"ion-item",33),e.YNc(3,de,3,1,"ion-item",33),e.YNc(4,ge,3,1,"ion-item",33),e.YNc(5,fe,3,1,"ion-item",33),e.YNc(6,he,3,1,"ion-item",33),e.YNc(7,me,3,1,"ion-item",33),e.qZA()()),2&l){const o=e.oxw(2);e.xp6(2),e.Q6J("ngIf",!o.NeedDownloadFile&&"text"==o.FileInfo.viewer&&!o.HasNoEditButton),e.xp6(1),e.Q6J("ngIf",!o.NeedDownloadFile&&"audio"!=o.FileInfo.viewer&&!o.HasNoEditButton),e.xp6(1),e.Q6J("ngIf",o.FileInfo.content_creator),e.xp6(1),e.Q6J("ngIf",!o.NeedDownloadFile),e.xp6(1),e.Q6J("ngIf",!o.NeedDownloadFile&&!o.FileInfo.url),e.xp6(1),e.Q6J("ngIf",!o.NeedDownloadFile&&o.OpenInChannelChat)}}function pe(l,h){1&l&&(e.TgZ(0,"ion-popover",32),e.YNc(1,ue,8,6,"ng-template"),e.qZA())}function xe(l,h){1&l&&e._UZ(0,"div",37)}function ve(l,h){1&l&&e._UZ(0,"div",38)}function Fe(l,h){if(1&l&&(e.TgZ(0,"td"),e.YNc(1,xe,1,0,"div",35),e.YNc(2,ve,1,0,"div",36),e.qZA()),2&l){const o=e.oxw();e.xp6(1),e.Q6J("ngIf","pck"!=o.FileInfo.file_ext),e.xp6(1),e.Q6J("ngIf","pck"==o.FileInfo.file_ext)}}function Ie(l,h){if(1&l){const o=e.EpF();e.TgZ(0,"td")(1,"ion-grid")(2,"ion-row",39)(3,"ion-col",40)(4,"ion-button",41),e.NdJ("click",function(){e.CHM(o);const i=e.oxw();return e.KtG(i.DownloadCurrentFile())}),e._uU(5),e.qZA()()()()()}if(2&l){const o=e.oxw();e.xp6(4),e.Q6J("disabled",o.isDownloading||o.MessageInfo.content.transfer_index&&"download"==o.MessageInfo.content.transfer_index.OnTransfer),e.xp6(1),e.hij(" ",o.MessageInfo.content.transfer_index&&"download"==o.MessageInfo.content.transfer_index.OnTransfer?o.lang.text.ContentViewer.FileDownloading:o.lang.text.ContentViewer.DownloadThisFile," ")}}function be(l,h){if(1&l){const o=e.EpF();e.TgZ(0,"ion-item",34),e.NdJ("click",function(){e.CHM(o);const i=e.oxw(2);return e.KtG(i.copy_url(i.FileInfo.url))}),e.TgZ(1,"ion-label"),e._uU(2),e.qZA(),e.TgZ(3,"ion-label",42),e._uU(4),e.qZA()()}if(2&l){const o=e.oxw(2);e.xp6(2),e.Oqu(o.lang.text.ContentInfo.SourceFrom),e.xp6(2),e.Oqu(o.content_creator.various_display)}}function we(l,h){if(1&l&&(e.TgZ(0,"ion-item")(1,"ion-label"),e._uU(2),e.qZA(),e.TgZ(3,"ion-label",42),e._uU(4),e.qZA()()),2&l){const o=e.oxw(2);e.xp6(2),e.Oqu(o.lang.text.ContentInfo.FileSize),e.xp6(2),e.Oqu(o.CurrentFileSize)}}function Te(l,h){1&l&&e._UZ(0,"ion-icon",53)}function De(l,h){1&l&&e._UZ(0,"ion-icon",54)}function _(l,h){1&l&&e._UZ(0,"ion-icon",55)}function b(l,h){1&l&&e._UZ(0,"ion-icon",56)}function c(l,h){1&l&&e._UZ(0,"ion-icon",57)}function n(l,h){1&l&&e._UZ(0,"ion-icon",58)}function a(l,h){1&l&&(e.TgZ(0,"ion-avatar"),e._UZ(1,"img",59),e.qZA())}function r(l,h){if(1&l){const o=e.EpF();e.TgZ(0,"div")(1,"div",45),e._uU(2),e.TgZ(3,"ion-chip",46),e.NdJ("click",function(){const g=e.CHM(o).$implicit,v=e.oxw(2);return e.KtG(v.toast_info(g))}),e.YNc(4,Te,1,0,"ion-icon",47),e.YNc(5,De,1,0,"ion-icon",48),e.YNc(6,_,1,0,"ion-icon",49),e.YNc(7,b,1,0,"ion-icon",50),e.YNc(8,c,1,0,"ion-icon",51),e.YNc(9,n,1,0,"ion-icon",52),e.YNc(10,a,2,0,"ion-avatar",17),e.TgZ(11,"ion-label"),e._uU(12),e.qZA()()()()}if(2&l){const o=h.$implicit,t=e.oxw(2);e.xp6(2),e.hij(" ",o.timeDisplay," "),e.xp6(2),e.Q6J("ngIf","loaded"==o.various),e.xp6(1),e.Q6J("ngIf","camera"==o.various),e.xp6(1),e.Q6J("ngIf","link"==o.various),e.xp6(1),e.Q6J("ngIf","long_text"==o.various),e.xp6(1),e.Q6J("ngIf","textedit"==o.various),e.xp6(1),e.Q6J("ngIf","shared"==o.various),e.xp6(1),e.Q6J("ngIf","voidDraw"==o.various),e.xp6(2),e.Oqu(o.publisher||o.display_name||t.lang.text.Profile.noname_user)}}function x(l,h){if(1&l){const o=e.EpF();e.TgZ(0,"ion-content")(1,"ion-item-divider")(2,"ion-label"),e._uU(3),e.qZA()(),e.TgZ(4,"ion-item",34),e.NdJ("click",function(){e.CHM(o);const i=e.oxw();return e.KtG(i.copy_url(i.content_creator.user_id))}),e.TgZ(5,"ion-label"),e._uU(6),e.qZA(),e.TgZ(7,"ion-label",42),e._uU(8),e.qZA()(),e.YNc(9,be,5,2,"ion-item",33),e.YNc(10,we,5,2,"ion-item",17),e.TgZ(11,"ion-item")(12,"ion-label"),e._uU(13),e.qZA(),e.TgZ(14,"ion-label",42),e._uU(15),e.qZA()(),e.TgZ(16,"ion-item-divider")(17,"ion-label"),e._uU(18),e.qZA()(),e.YNc(19,r,13,9,"div",43),e.TgZ(20,"ion-item",34),e.NdJ("click",function(){e.CHM(o),e.oxw();const i=e.MAs(25);return e.KtG(i.dismiss())}),e.TgZ(21,"ion-label",44),e._uU(22),e.qZA()()()}if(2&l){const o=e.oxw();e.xp6(3),e.Oqu(o.lang.text.ContentInfo.WorkLogs),e.xp6(3),e.Oqu(o.lang.text.ContentInfo.LastPost),e.xp6(2),e.hij(" ",o.content_creator.publisher||o.content_creator.display_name||o.lang.text.Profile.noname_user,""),e.xp6(1),e.Q6J("ngIf",o.content_creator.various),e.xp6(1),e.Q6J("ngIf",!o.FileInfo.url),e.xp6(3),e.Oqu(o.lang.text.ContentInfo.TimeAt),e.xp6(2),e.Oqu(o.content_creator.timeDisplay),e.xp6(3),e.Oqu(o.lang.text.ContentInfo.WorkHistory),e.xp6(1),e.Q6J("ngForOf",o.content_related_creator),e.xp6(3),e.Oqu(o.lang.text.ContentInfo.CloseModal)}}const m=function(){return[.5,1]};let y=(()=>{var l;class h{constructor(t,i,g,v,F,d,f,w,k,A,T,N){this.modalCtrl=t,this.navParams=i,this.indexed=g,this.lang=v,this.file=F,this.p5toast=d,this.alertCtrl=f,this.loadingCtrl=w,this.global=k,this.nakama=A,this.mClipboard=T,this.noti=N,this.useP5Navigator=!0,this.RelevanceIndex=0,this.HaveRelevances=!1,this.NeedDownloadFile=!1,this.isDownloading=!1,this.OpenInChannelChat=!1,this.isChannelOnline=!0,this.fromLocalChannel=!1,this.EventListenerAct=H=>{H.detail.register(120,ye=>{})},this.isTextEditMode=!1,this.NewTextFileName="",this.image_info={},this.forceWrite=!1}ngOnInit(){var t=this;return(0,s.Z)(function*(){t.fromLocalChannel=t.navParams.get("local"),t.MessageInfo=t.navParams.get("info"),t.OpenInChannelChat=void 0!==t.MessageInfo.code,t.CurrentViewId=t.MessageInfo.message_id,t.FileInfo=t.MessageInfo.content,t.ContentBox=document.getElementById("ContentBox"),t.FileHeader=document.getElementById("FileHeader"),t.isOfficial=t.navParams.get("isOfficial"),t.target=t.navParams.get("target");try{t.isChannelOnline="online"==t.nakama.channels_orig[t.isOfficial][t.target][t.MessageInfo.channel_id].info.status,t.isChannelOnline=t.isChannelOnline||"online"==t.nakama.channels_orig[t.isOfficial][t.target][t.MessageInfo.channel_id].status||"pending"==t.nakama.channels_orig[t.isOfficial][t.target][t.MessageInfo.channel_id].status}catch{}if("text"===(t.targetDB=t.navParams.get("targetDB"),t.HasNoEditButton=t.navParams.get("no_edit")||!1,t.FileInfo.is_new));else{if(t.Relevances=t.navParams.get("relevance"),t.Relevances){for(let i=0,g=t.Relevances.length;i<g;i++)if(t.Relevances[i].message_id&&t.MessageInfo.message_id){if(t.Relevances[i].message_id==t.MessageInfo.message_id){t.RelevanceIndex=i+1;break}}else if(t.Relevances[i].content.path==t.MessageInfo.content.path){t.RelevanceIndex=i+1;break}t.HaveRelevances=t.Relevances.length>1}else t.HaveRelevances=!1;t.CreateContentInfo()}})()}reinit_content_data(t){var i=this;return(0,s.Z)(function*(){if(i.NewTextFileName="",i.NeedDownloadFile=!0,i.isTextEditMode=!1,i.MessageInfo=t,i.CurrentViewId=i.MessageInfo.message_id,i.FileInfo=i.MessageInfo.content,URL.revokeObjectURL(i.FileURL),i.FileInfo.url)i.FileURL=i.FileInfo.url,i.CreateContentInfo(),i.NeedDownloadFile=!1,i.ionViewDidEnter();else{let g=i.FileInfo.path||`servers/${i.isOfficial}/${i.target}/channels/${t.channel_id}/files/msg_${t.message_id}.${t.content.file_ext}`;i.image_info.path=g,i.NeedDownloadFile=yield i.indexed.checkIfFileExist(`${g}.history`,void 0,i.targetDB);try{i.blob=yield i.indexed.loadBlobFromUserPath(g,i.FileInfo.type,void 0,i.targetDB),i.CreateContentInfo(),i.ionViewDidEnter()}catch{i.FileURL=void 0,i.blob=void 0,i.isDownloading=!1,i.NeedDownloadFile=!0,i.CreateContentInfo(),i.p5canvas&&i.p5canvas.remove(),i.p5canvas=new U(F=>{F.setup=()=>{F.noCanvas()}}),i.ChangeContentWithKeyInput()}}})()}DownloadAllListFiles(){this.alertCtrl.create({header:this.lang.text.ContentViewer.DownloadAllFiles,message:this.lang.text.ContentViewer.DownloadLoadedList,buttons:[{text:this.lang.text.ContentViewer.DownloadThisFile,handler:()=>{this.DownloadInOrder()}}]}).then(t=>t.present())}DownloadInOrder(){var t=this;return(0,s.Z)(function*(){("Android"==D.n$||"iOS"==D.n$)&&t.noti.noti.schedule({id:6,title:t.lang.text.ContentViewer.DownloadThisFile,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://diychat",color:"b0b0b0"});for(let i=0,g=t.Relevances.length;i<g;i++)t.nakama.OnTransfer[t.isOfficial]||(t.nakama.OnTransfer[t.isOfficial]={}),t.nakama.OnTransfer[t.isOfficial][t.target]||(t.nakama.OnTransfer[t.isOfficial][t.target]={}),t.nakama.OnTransfer[t.isOfficial][t.target][t.Relevances[i].channel_id]||(t.nakama.OnTransfer[t.isOfficial][t.target][t.Relevances[i].channel_id]={}),t.nakama.OnTransfer[t.isOfficial][t.target][t.Relevances[i].channel_id][t.Relevances[i].message_id]||(t.nakama.OnTransfer[t.isOfficial][t.target][t.Relevances[i].channel_id][t.Relevances[i].message_id]={});for(let i=0,g=t.Relevances.length;i<g;i++){("Android"==D.n$||"iOS"==D.n$)&&t.noti.noti.schedule({id:6,title:`${t.lang.text.ContentViewer.DownloadThisFile}: ${g-i}`,progressBar:{value:i,maxValue:g},sound:null,smallIcon:"res://diychat",color:"b0b0b0"});let v=`servers/${t.isOfficial}/${t.target}/channels/${t.Relevances[i].channel_id}/files/msg_${t.Relevances[i].message_id}.${t.Relevances[i].content.file_ext}`;if(!(yield t.indexed.checkIfFileExist(v,void 0,t.targetDB)))try{yield t.DownloadCurrentFile(i)}catch(d){console.log(d)}}t.noti.ClearNoti(6)})()}ChangeToAnother(t){let i=this.RelevanceIndex+t;i<=0||i>this.Relevances.length||(this.p5canvas&&this.p5canvas.remove(),this.RelevanceIndex=i,this.FileInfo={file_ext:""},setTimeout(()=>{this.reinit_content_data(this.Relevances[this.RelevanceIndex-1])},100))}DownloadCurrentFile(t){var i=this;return(0,s.Z)(function*(){i.isDownloading=!0;let g=0,v=i.Relevances[null!=t?t:i.RelevanceIndex-1],F=`servers/${i.isOfficial}/${i.target}/channels/${v.channel_id}/files/msg_${v.message_id}.${v.content.file_ext}`;try{let f=yield i.indexed.loadTextFromUserPath(`${F}.history`,void 0,i.targetDB);g=JSON.parse(f).index}catch{}let d=v.message_id;yield i.nakama.ReadStorage_From_channel(v,F,i.isOfficial,i.target,g),i.CurrentViewId==d&&i.reinit_content_data(v)})()}formatBytes(t,i=2){if(!+t)return"0 Bytes";const v=i<0?0:i,d=Math.floor(Math.log(t)/Math.log(1024));return`${parseFloat((t/Math.pow(1024,d)).toFixed(v))} ${["Bytes","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"][d]}`}CreateContentInfo(){try{if(this.CurrentFileSize=this.formatBytes(this.FileInfo.size||this.FileInfo.filesize),this.content_creator=this.FileInfo.content_creator,this.content_creator.timeDisplay=new Date(this.content_creator.timestamp).toLocaleString(),this.content_related_creator=this.FileInfo.content_related_creator,this.content_creator.user_id)try{this.content_creator.is_me=this.nakama.servers[this.isOfficial][this.target].session.user_id==this.content_creator.user_id}catch{}try{this.content_creator.publisher=this.content_creator.is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_creator.user_id].display_name}catch{}this.set_various_display(this.content_creator);for(let t=0,i=this.content_related_creator.length;t<i;t++){if(this.content_related_creator[t].user_id)try{this.content_related_creator[t].is_me=this.nakama.servers[this.isOfficial][this.target].session.user_id==this.content_related_creator[t].user_id}catch{}this.content_related_creator[t].timeDisplay=new Date(this.content_related_creator[t].timestamp).toLocaleString()}}catch{}try{this.content_related_creator[0].publisher=this.content_related_creator[0].is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_related_creator[0].user_id].display_name,this.content_related_creator[0].timestamp==this.content_related_creator[1].timestamp&&(this.content_related_creator[0].publisher=this.content_related_creator[1].is_me?this.nakama.users.self.display_name:this.nakama.users[this.isOfficial][this.target][this.content_related_creator[1].user_id].display_name,this.content_related_creator.splice(1,1))}catch{try{this.content_related_creator[0].publisher=this.content_related_creator[1].display_name,this.content_related_creator[0].timestamp==this.content_related_creator[1].timestamp&&(this.content_related_creator[0].publisher=this.content_related_creator[1].display_name,this.content_related_creator.splice(1,1))}catch{}try{this.content_related_creator[0].publisher||(this.content_related_creator[0].publisher=this.content_related_creator[0].display_name)}catch{}}try{this.content_related_creator.sort((t,i)=>t.timestamp>i.timestamp?-1:t.timestamp<i.timestamp?1:0)}catch{}}set_various_display(t){switch(t.various){case"camera":t.various_display=this.lang.text.GlobalAct.FromCamera;break;case"link":t.various_display=this.FileInfo.url;break;case"loaded":t.various_display=this.lang.text.GlobalAct.variousCreator;break;case"voidDraw":t.various_display=this.lang.text.GlobalAct.FromVoidDraw;break;case"long_text":t.various_display=this.lang.text.GlobalAct.FromAutoLongText;break;case"textedit":t.various_display=this.lang.text.GlobalAct.FromTextEditor;break;case"shared":t.various_display=this.lang.text.GlobalAct.SharedContent;break;default:t.various_display=this.lang.text.GlobalAct.UnknownSource}}close_text_edit(){this.FileInfo.is_new?this.modalCtrl.dismiss():this.reinit_content_data(this.MessageInfo)}ionViewDidEnter(){var t=this;return(0,s.Z)(function*(){t.FileInfo.url?t.FileURL=t.FileInfo.url:t.FileInfo.is_new||(t.blob||(t.blob=yield t.indexed.loadBlobFromUserPath(t.FileInfo.path||t.navParams.get("path"),t.FileInfo.type,void 0,t.targetDB)),t.FileURL=URL.createObjectURL(t.blob)),t.forceWrite=!1;let i=document.getElementById("content_viewer_canvas");switch(i&&(i.style.backgroundImage=""),document.removeEventListener("ionBackButton",t.EventListenerAct),t.p5canvas&&t.p5canvas.remove(),t.FileInfo.viewer){case"image":t.p5canvas=new U(d=>{d.setup=(0,s.Z)(function*(){i.style.maxWidth="100%",i.style.overflow="hidden",t.ContentBox.style.overflow="hidden",d.noCanvas();let I=d.createElement("img");I.elt.hidden=!0,I.elt.src=t.FileURL,I.elt.onload=()=>{i.style.backgroundImage=`url(${t.FileURL})`,i.style.backgroundRepeat="no-repeat",i.style.pointerEvents="none",t.image_info.width=I.elt.naturalWidth,t.image_info.height=I.elt.naturalHeight,w=d.createVector(I.elt.naturalWidth,I.elt.naturalHeight),f(),I.remove()},d.noLoop()});let f=()=>{if(t.image_info.width/t.image_info.height<i.clientWidth/i.clientHeight){let I=t.image_info.width*i.clientHeight/t.image_info.height;i.style.backgroundSize=`${I}px`,i.style.backgroundPositionX=(i.clientWidth-I)/2+"px",i.style.backgroundPositionY="0px"}else i.style.backgroundSize=`${i.clientWidth}px`,i.style.backgroundPositionX="0px",i.style.backgroundPositionY=i.clientHeight/2-w.y*(i.clientWidth/w.x)/2+"px";z=!0};d.windowResized=()=>{setTimeout(()=>{f()},50)};let w,k=d.createVector(),A=d.createVector(),T=d.createVector(),N=1,H=()=>{i.style.backgroundPositionX=`${k.x+T.x}px`,i.style.backgroundPositionY=`${k.y+T.y}px`},ye=(I,Q)=>{let C=N,B=N*Q,W=Number(i.style.backgroundPositionX.split("px")[0]),Ce=Number(i.style.backgroundPositionY.split("px")[0]),Ze=(C-B)*d.map(I.x,W,W+C,0,1),ke=(C-B)/w.x*w.y*d.map(I.y,Ce,Ce+C/w.x*w.y,0,1);i.style.backgroundPositionX=`${W+Ze}px`,i.style.backgroundPositionY=`${Ce+ke}px`,i.style.backgroundSize=`${B}px`};d.mousePressed=()=>{t.useP5Navigator&&(d.mouseButton==d.CENTER&&f(),"DesktopPWA"==D.n$&&(k=d.createVector(Number(i.style.backgroundPositionX.split("px")[0]),Number(i.style.backgroundPositionY.split("px")[0])),A=d.createVector(d.mouseX,d.mouseY)))},d.mouseWheel=I=>{t.useP5Navigator&&(N=Number(i.style.backgroundSize.split("px")[0]),ye(d.createVector(i.clientWidth/2,i.clientHeight/2),1-I.delta/1e3))},d.mouseDragged=()=>{t.useP5Navigator&&"DesktopPWA"==D.n$&&(T=d.createVector(d.mouseX,d.mouseY),T.sub(A),H())};let Pe,M={},j=!1,z=!0;d.touchStarted=I=>{if(t.useP5Navigator){for(let C=0,B=I.changedTouches.length;C<B;C++)M[I.changedTouches[C].identifier]=d.createVector(I.changedTouches[C].clientX,I.changedTouches[C].clientY);switch(Object.keys(M).length){case 1:k=d.createVector(Number(i.style.backgroundPositionX.split("px")[0]),Number(i.style.backgroundPositionY.split("px")[0])),A=M[I.changedTouches[0].identifier].copy();break;case 2:k=d.createVector(Number(i.style.backgroundPositionX.split("px")[0]),Number(i.style.backgroundPositionY.split("px")[0]));let C=M[0].copy();Pe=C.dist(M[1]),A=C.add(M[1]).div(2).copy(),N=Number(i.style.backgroundSize.split("px")[0]),H();break;default:j=!0,f()}}},d.touchMoved=I=>{if(t.useP5Navigator&&!j){for(let C=0,B=I.changedTouches.length;C<B;C++)M[I.changedTouches[C].identifier]=d.createVector(I.changedTouches[C].clientX,I.changedTouches[C].clientY);switch(Object.keys(M).length){case 1:T=M[I.changedTouches[0].identifier].copy(),T.sub(A),z||H();break;case 2:z=!1;let C=M[0].copy(),B=C.dist(M[1]);T=C.add(M[1]).div(2).copy();let W=T.copy();T.sub(A),H(),ye(W,B/Pe)}}},d.touchEnded=I=>{if(t.useP5Navigator&&"changedTouches"in I){for(let C=0,B=I.changedTouches.length;C<B;C++)delete M[I.changedTouches[C].identifier];switch(Object.keys(M).length){case 1:k=d.createVector(Number(i.style.backgroundPositionX.split("px")[0]),Number(i.style.backgroundPositionY.split("px")[0])),A=M[Object.keys(M)[0]].copy();break;case 0:z&&!j&&(T.x>50?t.ChangeToAnother(-1):T.x<-50&&t.ChangeToAnother(1)),j=!1}}}});break;case"audio":t.p5canvas=new U(d=>{var f;d.setup=()=>{d.noCanvas(),d.noLoop(),f=d.createAudio([t.FileURL],()=>{i.appendChild(f.elt),f.elt.hidden=!0,setTimeout(()=>{w(),f.elt.hidden=!1},50),f.showControls(),f.play()})};let w=()=>{let k=t.ContentBox.offsetWidth;f.elt.setAttribute("style","position: relative; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%);"),f.size(k,25)};d.windowResized=()=>{setTimeout(()=>{w()},50)}});break;case"video":t.p5canvas=new U(d=>{var f;d.setup=()=>{d.noCanvas(),d.noLoop(),f=d.createVideo([t.FileURL],()=>{i.appendChild(f.elt),f.elt.hidden=!0,setTimeout(()=>{t.image_info.width=f.elt.videoWidth,t.image_info.height=f.elt.videoHeight,w(),f.elt.hidden=!1},50),f.showControls(),f.play()}),d.VideoMedia=f};let w=()=>{let k=t.ContentBox.offsetWidth,A=t.ContentBox.offsetHeight-t.FileHeader.offsetHeight,T=f.width,N=f.height;f.elt.setAttribute("style","position: relative; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%);"),T<N?(N=A,T=T/f.height*N):(T=k,N=N/f.width*T||A/2),f.size(T,N)};d.windowResized=()=>{setTimeout(()=>{w()},50)}});break;case"text":t.p5canvas=new U(d=>{d.setup=()=>{d.noCanvas(),d.noLoop();let f=d.createElement("textarea");f.elt.disabled=!0,f.elt.className="infobox",f.elt.setAttribute("style","height: 100%; display: block;"),f.elt.textContent="",i.appendChild(f.elt),d.TextArea=f.elt,t.FileInfo.is_new?t.open_text_editor(f.elt):d.loadStrings(t.FileURL,w=>{f.elt.textContent=w.join("\n")},w=>{i.textContent=t.lang.text.ContentViewer.CannotOpenText,t.FileInfo.else=!0})}});break;case"godot":document.addEventListener("ionBackButton",t.EventListenerAct);let g,v=t.MessageInfo.message_id;try{let d=yield t.indexed.loadBlobFromUserPath((t.FileInfo.path||t.navParams.get("path"))+"_thumbnail.png","",void 0,t.targetDB);g=URL.createObjectURL(d)}catch{}!t.NeedDownloadFile&&t.CurrentViewId==v&&setTimeout((0,s.Z)(function*(){let d=!1;if(t.indexed.godotDB)try{let f=yield t.indexed.loadBlobFromUserPath(t.FileInfo.path||t.navParams.get("path"),"",void 0,t.indexed.ionicDB);yield t.indexed.GetGodotIndexedDB(),yield t.indexed.saveBlobToUserPath(f,"tmp_files/duplicate/viewer.pck",void 0,t.indexed.godotDB),d=!0}catch(f){console.log("\ub0b4\ubd80 \ud30c\uc77c \uc5c6\uc74c: ",f)}if(yield t.global.CreateGodotIFrame("content_viewer_canvas",{path:"tmp_files/duplicate/viewer.pck",alt_path:t.FileInfo.path||t.navParams.get("path"),ext:t.FileInfo.file_ext,url:t.FileInfo.url,background:g,receive_image:(f=(0,s.Z)(function*(w,k,A){let T="tmp_files/modify_image.png";yield t.indexed.saveBase64ToUserPath(","+w,T),t.modalCtrl.dismiss({type:"image",path:T,width:k,height:A,msg:t.MessageInfo,index:t.RelevanceIndex-1})}),function(k,A,T){return f.apply(this,arguments)})},"start_load_pck"),!d){try{let f=yield t.indexed.loadBlobFromUserPath(t.FileInfo.path||t.navParams.get("path"),"",void 0,t.indexed.ionicDB);yield t.indexed.GetGodotIndexedDB(),yield t.indexed.saveBlobToUserPath(f,"tmp_files/duplicate/viewer.pck",void 0,t.indexed.godotDB)}catch(f){console.log("\ub0b4\ubd80 \ud30c\uc77c \uc5c6\uc74c_dp: ",f)}yield t.global.CreateGodotIFrame("content_viewer_canvas",{path:"tmp_files/duplicate/viewer.pck",alt_path:t.FileInfo.path||t.navParams.get("path"),ext:t.FileInfo.file_ext,url:t.FileInfo.url,background:g,receive_image:function(){var f=(0,s.Z)(function*(w,k,A){let T="tmp_files/modify_image.png";yield t.indexed.saveBase64ToUserPath(","+w,T),t.modalCtrl.dismiss({type:"image",path:T,width:k,height:A,msg:t.MessageInfo,index:t.RelevanceIndex-1})});return function(k,A,T){return f.apply(this,arguments)}}()},"start_load_pck")}var f;g&&URL.revokeObjectURL(g),t.FileInfo.url?t.global.godot_window.download_url():t.global.godot_window.start_load_pck()}),100);break;case"disabled":t.p5canvas=new U(d=>{d.setup=()=>{d.noCanvas()}});let F=yield t.loadingCtrl.create({message:t.lang.text.TodoDetail.WIP});F.present(),F.dismiss(),t.download_file()}t.ChangeContentWithKeyInput()})()}ChangeContentWithKeyInput(){this.p5canvas&&(this.p5canvas.keyPressed=t=>{if(!this.isTextEditMode)switch(t.code){case"KeyA":case"ArrowLeft":this.ChangeToAnother(-1);break;case"KeyD":case"ArrowRight":this.ChangeToAnother(1);break;case"KeyS":this.NeedDownloadFile&&this.DownloadCurrentFile()}})}open_bottom_modal(){this.ShowContentInfoIonic.onDidDismiss().then(t=>{this.useP5Navigator=!0}),this.useP5Navigator=!1,this.ShowContentInfoIonic.present()}open_text_editor(t=this.p5canvas.TextArea){t.disabled=!1,setTimeout(()=>{this.isTextEditMode=!0,t.focus()},500)}SaveText(){var t=this;return(0,s.Z)(function*(){let i=new Blob([t.p5canvas.TextArea.value],{type:t.FileInfo.type});if(i.name=t.NewTextFileName||t.FileInfo.filename||t.FileInfo.name,t.OpenInChannelChat)t.modalCtrl.dismiss({type:"text",blob:i,contentRelated:t.FileInfo.content_related_creator});else{let g=yield t.loadingCtrl.create({message:t.lang.text.TodoDetail.WIP});g.present();let v=`tmp_files/texteditor/${t.FileInfo.filename||t.FileInfo.name}`;console.log(t.FileInfo),t.FileInfo.path||(t.FileInfo.path=v),yield t.indexed.saveBlobToUserPath(i,v,void 0,t.targetDB),g.dismiss(),t.p5toast.show({text:t.lang.text.ContentViewer.fileSaved}),t.modalCtrl.dismiss({type:"text",blob:i,path:v,index:t.RelevanceIndex-1})}})()}modify_image(){var t=this;return(0,s.Z)(function*(){switch(t.FileInfo.viewer){case"image":{let g=yield t.loadingCtrl.create({message:t.lang.text.TodoDetail.WIP});g.present();try{let v;t.image_info.path=t.FileInfo.path||t.navParams.get("path"),t.FileInfo.url&&(t.image_info.path="tmp_files/modify_image.png",v=yield fetch(t.FileInfo.url).then(F=>F.blob()),yield t.indexed.saveBlobToUserPath(v,t.image_info.path)),t.modalCtrl.dismiss({type:"image",...t.image_info,path:t.image_info.path,msg:t.MessageInfo,index:t.RelevanceIndex-1})}catch(v){t.p5toast.show({text:`${t.lang.text.ContentViewer.CannotEditFile}: ${v}`})}g.dismiss()}break;case"text":let i=t.p5canvas.TextArea.textContent.split("\n");t.modalCtrl.dismiss({type:"image",text:i,msg:t.MessageInfo,index:t.RelevanceIndex-1});break;case"video":try{let g=yield t.loadingCtrl.create({message:t.lang.text.TodoDetail.WIP});g.present(),t.p5canvas.pixelDensity(1),t.p5canvas.VideoMedia.pause(),t.p5canvas.VideoMedia.size(t.image_info.width,t.image_info.height),t.p5canvas.createCanvas(t.image_info.width,t.image_info.height),t.p5canvas.image(t.p5canvas.VideoMedia,0,0,t.p5canvas.width,t.p5canvas.height),t.p5canvas.saveFrames("","png",1,1,function(){var v=(0,s.Z)(function*(F){try{g.dismiss(),t.image_info.path="tmp_files/modify_image.png",yield t.indexed.saveBase64ToUserPath(F[0].imageData.replace(/"|=|\\/g,""),t.image_info.path),t.modalCtrl.dismiss({type:"image",...t.image_info,msg:t.MessageInfo,index:t.RelevanceIndex-1})}catch(d){console.log("\ud30c\uc77c \uc800\uc7a5 \uc624\ub958: ",d)}});return function(F){return v.apply(this,arguments)}}())}catch(g){console.log("\uc7ac\uc0dd\uc911\uc778 \ube44\ub514\uc624 \uc774\ubbf8\uc9c0 \ucd94\ucd9c \uc624\ub958: ",g)}break;case"godot":t.global.godot_window.modify_image();break;default:console.log("\ud3b8\uc9d1 \ubd88\uac00 \ud30c\uc77c \uc815\ubcf4: ",t.FileInfo)}})()}download_file(){"DesktopPWA"==D.n$||"MobilePWA"==D.n$?this.indexed.DownloadFileFromUserPath(this.FileInfo.path,this.FileInfo.type,this.FileInfo.filename,this.targetDB):this.alertCtrl.create({header:this.lang.text.ContentViewer.Filename,inputs:[{name:"filename",placeholder:this.FileInfo.filename,type:"text"}],buttons:[{text:this.lang.text.ContentViewer.saveFile,handler:t=>{this.DownloadFileAct(t)}}]}).then(t=>t.present())}DownloadFileAct(t){var i=this;return(0,s.Z)(function*(){let g=yield i.loadingCtrl.create({message:i.lang.text.TodoDetail.WIP});g.present();let v=t.filename?t.filename.replace(/:|\?|\/|\\|<|>/g,""):i.FileInfo.filename,F=yield i.indexed.loadBlobFromUserPath(i.FileInfo.path,i.FileInfo.type,void 0,i.targetDB);i.forceWrite&&!t.filename?i.file.writeExistingFile(i.file.externalDataDirectory,v,F).then(d=>{i.forceWrite=!1,g.dismiss(),i.p5toast.show({text:`${i.lang.text.ContentViewer.OverWriteFile}: ${v}`})}):i.file.writeFile(i.file.externalDataDirectory,v,F).then(d=>{g.dismiss(),i.p5toast.show({text:i.lang.text.ContentViewer.fileSaved})}).catch(d=>{12===(g.dismiss(),d.code)?(i.p5toast.show({text:i.lang.text.ContentViewer.AlreadyExist}),i.forceWrite=!0,i.download_file()):console.log("\uc900\ube44\ub418\uc9c0 \uc54a\uc740 \uc624\ub958 \ubc18\ud658: ",d)})})()}toast_info(t){t.various_display||this.set_various_display(t),this.p5toast.show({text:t.various_display})}ShareContent(){let t=this.nakama.rearrange_channels();for(let i=t.length-1;i>=0;i--)("missing"==t[i].status||"offline"==t[i].status)&&t.splice(i,1);t.length?this.modalCtrl.create({component:O.D,componentProps:{file:this.FileInfo,channels:t}}).then(i=>{i.onDidDismiss().then(g=>{g.data&&this.modalCtrl.dismiss()}),i.present()}):this.p5toast.show({text:this.lang.text.ShareContentToOther.NoChannelToShare})}RemoveFile(){this.alertCtrl.create({header:this.lang.text.ContentViewer.RemoveFile,message:this.FileInfo.path,buttons:[{text:this.lang.text.TodoDetail.remove,handler:()=>{this.RemoveFileAct()}}]}).then(t=>t.present())}RemoveFileAct(){var t=this;return(0,s.Z)(function*(){URL.revokeObjectURL(t.FileURL),delete t.FileInfo.thumbnail,delete t.FileInfo.text,yield t.indexed.removeFileFromUserPath(t.FileInfo.path,void 0,t.targetDB),t.RelevanceIndex-=1,t.ChangeToAnother(1)})()}ionViewWillLeave(){var t=this;return(0,s.Z)(function*(){switch(document.removeEventListener("ionBackButton",t.EventListenerAct),t.FileInfo.viewer){case"video":try{let g,v,i=t.p5canvas.VideoMedia.size();i.width>i.height?(g=192,v=i.height/i.width*192):(g=i.width/i.height*192,v=192),t.p5canvas.createCanvas(g,v),t.p5canvas.imageMode(t.p5canvas.CORNER),t.p5canvas.image(t.p5canvas.VideoMedia,0,0,g*t.image_info.width/i.width,v*t.image_info.height/i.height),t.p5canvas.fill(255,128),t.p5canvas.rect(0,0,g,v),t.p5canvas.textWrap(t.p5canvas.CHAR),t.p5canvas.textSize(16);let F=v/16;t.p5canvas.push(),t.p5canvas.translate(F/6,F/6),t.p5canvas.fill(0),t.p5canvas.text(t.FileInfo.filename,F,F,g-2*F,v-2*F),t.p5canvas.filter(t.p5canvas.BLUR,3),t.p5canvas.pop(),t.p5canvas.fill(255),t.p5canvas.text(t.FileInfo.filename,F,F,g-2*F,v-2*F),t.p5canvas.saveFrames("","png",1,1,function(){var d=(0,s.Z)(function*(f){try{let w=f[0].imageData.replace(/"|=|\\/g,"");yield t.indexed.saveBase64ToUserPath(w,`${t.FileInfo.path}_thumbnail.png`,void 0,t.targetDB),t.FileInfo.thumbnail=w,t.global.modulate_thumbnail(t.FileInfo,"")}catch(w){console.log("\uc378\ub124\uc77c \uc800\uc7a5 \uc624\ub958: ",w)}});return function(f){return d.apply(this,arguments)}}())}catch(i){console.log("\ube44\ub514\uc624 \uc378\ub124\uc77c \uc0dd\uc131 \ucde8\uc18c: ",i)}break;case"godot":try{t.global.godot_window.filename=t.FileInfo.filename||t.FileInfo.name,t.global.godot_window.create_thumbnail(t.FileInfo),(yield t.indexed.GetFileListFromDB("tmp_files",void 0,t.indexed.godotDB)).forEach(g=>t.indexed.removeFileFromUserPath(g,void 0,t.indexed.godotDB))}catch{}}t.p5canvas&&t.p5canvas.remove(),URL.revokeObjectURL(t.FileURL);try{(yield t.file.checkFile(t.file.externalDataDirectory,`viewer_tmp.${t.FileInfo.file_ext}`))&&(yield t.file.removeFile(t.file.externalDataDirectory,`viewer_tmp.${t.FileInfo.file_ext}`))}catch{}})()}copy_url(t){this.mClipboard.copy(t).catch(i=>$.Z.write(t))}}return(l=h).\u0275fac=function(t){return new(t||l)(e.Y36(p.IN),e.Y36(p.X1),e.Y36(q.H),e.Y36(K.b),e.Y36(E.$),e.Y36(L.F),e.Y36(p.Br),e.Y36(p.HT),e.Y36(P.AN),e.Y36(Z.a),e.Y36(R.T),e.Y36(V.J))},l.\u0275cmp=e.Xpm({type:l,selectors:[["app-ionic-viewer"]],viewQuery:function(t,i){if(1&t&&e.Gf(ee,5),2&t){let g;e.iGM(g=e.CRH())&&(i.ShowContentInfoIonic=g.first)}},decls:27,vars:16,consts:[[1,"ion-no-border"],["id","Toolbar"],["slot","start",3,"click"],["defaultHref",""],["class","relevance_change","style","padding-right: 4px;","slot","end","name","arrow-back-circle-outline",3,"click",4,"ngIf"],["slot","end",4,"ngIf"],["class","relevance_change","style","padding-right: 16px; padding-left: 4px;","slot","end","name","arrow-forward-circle-outline",3,"click",4,"ngIf"],["id","ContentBox"],[1,"main_table_elt"],[2,"height","0"],["id","FileHeader",2,"max-width","100vw"],["text-wrap","","style","overflow-x: auto;",4,"ngIf"],["type","text","text-warp","","style","overflow-x: auto; overflow-y: hidden;",3,"ngModel","placeholder","ngModelChange",4,"ngIf"],[3,"click",4,"ngIf"],["class","ion-align-items-center",3,"disabled","click",4,"ngIf"],["id","menu_trigger",4,"ngIf"],["trigger","menu_trigger","dismissOnSelect","",4,"ngIf"],[4,"ngIf"],[3,"initialBreakpoint","breakpoints"],["ShowContentInfoIonic",""],["slot","end","name","arrow-back-circle-outline",1,"relevance_change",2,"padding-right","4px",3,"click"],["slot","end"],["slot","end","name","arrow-forward-circle-outline",1,"relevance_change",2,"padding-right","16px","padding-left","4px",3,"click"],["text-wrap","",2,"overflow-x","auto"],["type","text","text-warp","",2,"overflow-x","auto","overflow-y","hidden",3,"ngModel","placeholder","ngModelChange"],[3,"click"],["name","close-circle-outline"],["name","save-outline"],[1,"ion-align-items-center",3,"disabled","click"],["name","code-download-outline"],["id","menu_trigger"],["name","ellipsis-vertical"],["trigger","menu_trigger","dismissOnSelect",""],["button","",3,"click",4,"ngIf"],["button","",3,"click"],["class","full_screen","style","background-color: grey;","id","content_viewer_canvas",4,"ngIf"],["class","full_screen","style","display: flex; background-color: grey;","id","content_viewer_canvas",4,"ngIf"],["id","content_viewer_canvas",1,"full_screen",2,"background-color","grey"],["id","content_viewer_canvas",1,"full_screen",2,"display","flex","background-color","grey"],[1,"ion-align-items-center"],["size","12",1,"ion-text-center"],["color","warning","shape","round",1,"ion-align-items-center",3,"disabled","click"],[1,"ion-text-end"],[4,"ngFor","ngForOf"],[1,"ion-text-center"],[1,"history_center"],["color","secondary","mode","ios","outline","true",3,"click"],["name","document-attach-outline",4,"ngIf"],["name","camera-outline",4,"ngIf"],["name","link-outline",4,"ngIf"],["name","text-outline",4,"ngIf"],["name","document-text-outline",4,"ngIf"],["name","share-social-outline",4,"ngIf"],["name","document-attach-outline"],["name","camera-outline"],["name","link-outline"],["name","text-outline"],["name","document-text-outline"],["name","share-social-outline"],["src","assets/icon/voidDraw.png"]],template:function(t,i){1&t&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-title"),e._uU(3),e.qZA(),e.TgZ(4,"ion-buttons",2),e.NdJ("click",function(){return i.modalCtrl.dismiss()}),e._UZ(5,"ion-back-button",3),e.qZA(),e.YNc(6,te,1,0,"ion-icon",4),e.YNc(7,ie,2,1,"ion-label",5),e.YNc(8,ne,1,0,"ion-icon",6),e.qZA()(),e.TgZ(9,"ion-content",7)(10,"table",8)(11,"tr",9)(12,"td")(13,"ion-list-header",10),e.YNc(14,oe,2,1,"ion-label",11),e.YNc(15,ae,1,2,"ion-input",12),e.YNc(16,le,2,0,"ion-button",13),e.YNc(17,se,2,0,"ion-button",13),e.YNc(18,re,2,1,"ion-button",14),e.YNc(19,ce,2,0,"ion-button",15),e.YNc(20,pe,2,0,"ion-popover",16),e.qZA()()(),e.TgZ(21,"tr"),e.YNc(22,Fe,3,2,"td",17),e.YNc(23,Ie,6,2,"td",17),e.qZA()(),e.TgZ(24,"ion-modal",18,19),e.YNc(26,x,23,10,"ng-template"),e.qZA()()),2&t&&(e.xp6(3),e.Oqu(i.lang.text.ContentViewer.Title),e.xp6(3),e.Q6J("ngIf",i.HaveRelevances),e.xp6(1),e.Q6J("ngIf",i.HaveRelevances),e.xp6(1),e.Q6J("ngIf",i.HaveRelevances),e.xp6(6),e.Q6J("ngIf",!i.isTextEditMode),e.xp6(1),e.Q6J("ngIf",i.isTextEditMode),e.xp6(1),e.Q6J("ngIf",i.isTextEditMode),e.xp6(1),e.Q6J("ngIf",i.isTextEditMode),e.xp6(1),e.Q6J("ngIf",i.isChannelOnline&&i.HaveRelevances&&!i.isTextEditMode&&!i.fromLocalChannel),e.xp6(1),e.Q6J("ngIf",!i.isTextEditMode),e.xp6(1),e.Q6J("ngIf",!i.isTextEditMode),e.xp6(2),e.Q6J("ngIf",!i.NeedDownloadFile),e.xp6(1),e.Q6J("ngIf",i.NeedDownloadFile),e.xp6(1),e.Q6J("initialBreakpoint",.5)("breakpoints",e.DdM(15,m)))},dependencies:[Y.sg,Y.O5,S.JJ,S.On,p.BJ,p.oU,p.YG,p.Sm,p.hM,p.wI,p.W2,p.jY,p.Gu,p.gu,p.pK,p.Ie,p.rH,p.Q$,p.q_,p.yh,p.Nd,p.wd,p.sr,p.ki,p.d8,p.j9,p.cs],styles:[".main_table_elt[_ngcontent-%COMP%]{width:100%;height:100%;border:0;margin:0}.relevance_change[_ngcontent-%COMP%]{width:25px;height:25px}.history_center[_ngcontent-%COMP%]{text-align:center}"]}),h})()},8049:(X,J,u)=>{u.d(J,{D:()=>K});var s=u(9468),D=u(3857),U=u(1325),G=u(7488),O=u(9080),$=u(6814);function e(E,L){1&E&&s._UZ(0,"div",12)}function p(E,L){if(1&E&&s._UZ(0,"img",13),2&E){const P=s.oxw().$implicit;s.Akn("online"==P.status||3==P.redirect.type&&"pending"==P.status?"filter: grayscale(0) contrast(1)":"filter: grayscale(.9) contrast(1.4)"),s.Q6J("src",P.info.img,s.LSH)}}function q(E,L){if(1&E){const P=s.EpF();s.TgZ(0,"ion-item",4),s.NdJ("click",function(){const V=s.CHM(P).$implicit,Y=s.oxw();return s.KtG(Y.go_to_chatroom(V))}),s.TgZ(1,"div",5),s.YNc(2,e,1,0,"div",6),s.qZA(),s.TgZ(3,"div",7),s.YNc(4,p,1,3,"img",8),s.qZA(),s.TgZ(5,"ion-label")(6,"div",9)(7,"table")(8,"tr")(9,"td"),s._uU(10),s.qZA(),s.TgZ(11,"td",10),s._uU(12),s.qZA()()()(),s.TgZ(13,"div",11),s._uU(14),s.qZA()()()}if(2&E){const P=L.$implicit,Z=s.oxw();s.xp6(1),s.Akn("background-color: "+Z.statusBar.colors[P.status||"offline"]),s.xp6(1),s.Q6J("ngIf",P.is_new),s.xp6(2),s.Q6J("ngIf",P.info),s.xp6(6),s.hij(" ",P.info?P.info.name||P.info.display_name||Z.lang.text.ChatRoom.noname_chatroom:P.title||Z.lang.text.ChatRoom.noname_chatroom," "),s.xp6(2),s.hij(" ","("+P.server.target+")"," "),s.xp6(2),s.hij(" ",P.last_comment||P.noti||Z.lang.text.Subscribes.noMessageHistory," ")}}let K=(()=>{var E;class L{constructor(Z,R,V,Y,S){this.lang=Z,this.navParams=R,this.modalCtrl=V,this.statusBar=Y,this.nakama=S}ngOnInit(){this.channels=this.navParams.get("channels")}go_to_chatroom(Z){this.nakama.go_to_chatroom_without_admob_act(Z,this.navParams.get("file")),this.modalCtrl.dismiss(!0)}}return(E=L).\u0275fac=function(Z){return new(Z||E)(s.Y36(D.b),s.Y36(U.X1),s.Y36(U.IN),s.Y36(G.g),s.Y36(O.a))},E.\u0275cmp=s.Xpm({type:E,selectors:[["app-share-content-to-other"]],decls:11,vars:3,consts:[[1,"ion-no-border"],["slot","start",3,"click"],["defaultHref",""],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"],[1,"additional_form","status_bar_double"],["class","new_circle",4,"ngIf"],[1,"additional_form","bg_img_form"],["class","profile_img",3,"style","src",4,"ngIf"],[1,"form_margin","header"],[1,"server_target"],[1,"form_margin","content"],[1,"new_circle"],[1,"profile_img",3,"src"]],template:function(Z,R){1&Z&&(s.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),s._uU(3),s.qZA(),s.TgZ(4,"ion-buttons",1),s.NdJ("click",function(){return R.modalCtrl.dismiss()}),s._UZ(5,"ion-back-button",2),s.qZA()()(),s.TgZ(6,"ion-content")(7,"ion-item-divider")(8,"ion-label"),s._uU(9),s.qZA()(),s.YNc(10,q,15,7,"ion-item",3),s.qZA()),2&Z&&(s.xp6(3),s.Oqu(R.lang.text.ShareContentToOther.Title),s.xp6(6),s.Oqu(R.lang.text.ShareContentToOther.AvailableChannels),s.xp6(1),s.Q6J("ngForOf",R.channels))},dependencies:[$.sg,$.O5,U.oU,U.Sm,U.W2,U.Gu,U.Ie,U.rH,U.Q$,U.wd,U.sr,U.cs],styles:[".server_target[_ngcontent-%COMP%]{color:#888;padding-left:4px}.content[_ngcontent-%COMP%]{color:#888;height:24px;display:table-cell;vertical-align:middle;padding:0 16px}"]}),L})()},3832:(X,J,u)=>{u.d(J,{P:()=>De});var s=u(5861),D=u(6845),U=u(9745),G=u(2726);u(5346);const $=(0,G.fo)("Filesystem",{web:()=>u.e(4522).then(u.bind(u,4522)).then(_=>new _.FilesystemWeb)});var e=u(9468),p=u(1325),q=u(797),K=u(3857),E=u(6052),L=u(9376),P=u(6593),Z=u(2372),R=u(4093),V=u(6814);const Y=["FileSel"];function S(_,b){if(1&_){const c=e.EpF();e.TgZ(0,"ion-icon",6),e.NdJ("click",function(){e.CHM(c);const a=e.oxw();return e.KtG(a.toggle_thumbnail())}),e.qZA()}}function ee(_,b){if(1&_){const c=e.EpF();e.TgZ(0,"ion-icon",7),e.NdJ("click",function(){e.CHM(c);const a=e.oxw();return e.KtG(a.toggle_thumbnail())}),e.qZA()}}function te(_,b){if(1&_){const c=e.EpF();e.TgZ(0,"ion-button",15),e.NdJ("click",function(){e.CHM(c);const a=e.oxw(3);return e.KtG(a.ExportDirectoryRecursive())}),e._uU(1),e.qZA()}if(2&_){const c=e.oxw(3);e.xp6(1),e.hij(" ",c.lang.text.UserFsDir.ExportDir," ")}}function ie(_,b){if(1&_){const c=e.EpF();e.TgZ(0,"div")(1,"ion-item",10),e._UZ(2,"ion-icon",11),e.TgZ(3,"ion-label"),e._uU(4,"."),e.qZA(),e.YNc(5,te,2,1,"ion-button",12),e.TgZ(6,"ion-button",13),e.NdJ("click",function(){e.CHM(c);const a=e.oxw(2);return e.KtG(a.RemoveDirectoryRecursive())}),e._uU(7),e.qZA()(),e.TgZ(8,"ion-item",14),e.NdJ("click",function(){e.CHM(c);const a=e.oxw(2);return e.KtG(a.MoveToUpDir())}),e._UZ(9,"ion-icon",11),e.TgZ(10,"ion-label"),e._uU(11,".."),e.qZA()()()}if(2&_){const c=e.oxw(2);e.xp6(5),e.Q6J("ngIf",!c.cant_dedicated),e.xp6(2),e.hij(" ",c.lang.text.UserFsDir.RemoveCurrentDir," ")}}function ne(_,b){if(1&_){const c=e.EpF();e.TgZ(0,"div")(1,"ion-item",14),e.NdJ("click",function(){e.CHM(c);const a=e.oxw(2);return e.KtG(a.SelectImportFolder())}),e._UZ(2,"ion-icon",16),e.TgZ(3,"ion-label"),e._uU(4),e.qZA()(),e.TgZ(5,"input",17),e.NdJ("change",function(a){e.CHM(c);const r=e.oxw(2);return e.KtG(r.inputImageSelected(a))}),e.qZA()()}if(2&_){const c=e.oxw(2);e.xp6(4),e.hij(" ",c.lang.text.UserFsDir.ImportFolder," ")}}function oe(_,b){if(1&_){const c=e.EpF();e.TgZ(0,"ion-item",14),e.NdJ("click",function(){e.CHM(c);const a=e.oxw().$implicit,r=e.oxw(2);return e.KtG(r.SelectFolder(a))}),e._UZ(1,"ion-icon",11),e.TgZ(2,"ion-label"),e._uU(3),e.qZA()()}if(2&_){const c=e.oxw().$implicit;e.xp6(3),e.Oqu(c.name)}}function ae(_,b){if(1&_&&(e.TgZ(0,"div"),e.YNc(1,oe,4,1,"ion-item",18),e.qZA()),2&_){const c=b.$implicit,n=e.oxw(2);e.xp6(1),e.Q6J("ngIf",n.CurrentDir==c.dir)}}function le(_,b){1&_&&e._UZ(0,"ion-icon",35)}function se(_,b){1&_&&e._UZ(0,"ion-icon",36)}function re(_,b){1&_&&e._UZ(0,"ion-icon",37)}function ce(_,b){1&_&&e._UZ(0,"ion-icon",38)}function _e(_,b){1&_&&e._UZ(0,"ion-icon",39)}function de(_,b){1&_&&e._UZ(0,"ion-icon",40)}function ge(_,b){if(1&_&&(e.TgZ(0,"ion-label",41),e._uU(1),e.qZA()),2&_){const c=e.oxw(2).$implicit;e.xp6(1),e.Oqu(c.name)}}function fe(_,b){if(1&_&&(e.TgZ(0,"ion-label"),e._uU(1),e.qZA()),2&_){const c=e.oxw(2).$implicit;e.xp6(1),e.Oqu(c.name)}}function he(_,b){if(1&_){const c=e.EpF();e.TgZ(0,"ion-button",42),e.NdJ("click",function(){e.CHM(c);const a=e.oxw(2).$implicit,r=e.oxw(2);return e.KtG(r.OpenFile(a))}),e._uU(1),e.qZA()}if(2&_){const c=e.oxw(4);e.xp6(1),e.hij(" ",c.lang.text.UserFsDir.Open," ")}}function me(_,b){if(1&_){const c=e.EpF();e.TgZ(0,"ion-button",42),e.NdJ("click",function(){e.CHM(c);const a=e.oxw(2).$implicit,r=e.oxw(2);return e.KtG(r.dismiss_page(a))}),e._uU(1),e.qZA()}if(2&_){const c=e.oxw(4);e.xp6(1),e.hij(" ",c.lang.text.UserFsDir.Select," ")}}function ue(_,b){if(1&_){const c=e.EpF();e.TgZ(0,"ion-button",42),e.NdJ("click",function(){e.CHM(c);const a=e.oxw(2).$implicit,r=e.oxw(2);return e.KtG(r.DownloadFile(a))}),e._uU(1),e.qZA()}if(2&_){const c=e.oxw(4);e.xp6(1),e.hij(" ",c.lang.text.UserFsDir.Download," ")}}function pe(_,b){if(1&_){const c=e.EpF();e.TgZ(0,"div",43),e.NdJ("click",function(){e.CHM(c);const a=e.oxw(2).$implicit,r=e.oxw(2);return e.KtG(r.OpenFile(a))}),e._UZ(1,"img",44),e.qZA()}if(2&_){const c=e.oxw(2).$implicit,n=e.oxw(2);e.xp6(1),e.Akn(n.HideThumbnail?"filter: blur(6px);":""),e.Q6J("src",c.thumbnail,e.LSH)("alt",c.name)}}function xe(_,b){if(1&_){const c=e.EpF();e.TgZ(0,"ion-accordion",20)(1,"ion-item",21),e.YNc(2,le,1,0,"ion-icon",22),e.YNc(3,se,1,0,"ion-icon",23),e.YNc(4,re,1,0,"ion-icon",24),e.YNc(5,ce,1,0,"ion-icon",25),e.YNc(6,_e,1,0,"ion-icon",26),e.YNc(7,de,1,0,"ion-icon",27),e.YNc(8,ge,2,1,"ion-label",28),e.YNc(9,fe,2,1,"ion-label",5),e._UZ(10,"ion-icon",29),e.qZA(),e.TgZ(11,"div",30)(12,"ion-item",10)(13,"ion-label"),e._uU(14),e.qZA(),e.YNc(15,he,2,1,"ion-button",31),e.YNc(16,me,2,1,"ion-button",31),e.YNc(17,ue,2,1,"ion-button",31),e.TgZ(18,"ion-button",32),e.NdJ("click",function(){e.CHM(c);const a=e.oxw(),r=a.$implicit,x=a.index,m=e.oxw(2);return e.KtG(m.RemoveFile(r,x))}),e._uU(19),e.qZA()(),e.YNc(20,pe,2,4,"div",33),e.TgZ(21,"ion-item",10)(22,"ion-label"),e._uU(23),e.qZA(),e.TgZ(24,"ion-label",34),e._uU(25),e.qZA()()()()}if(2&_){const c=e.oxw().$implicit;e.oxw();const n=e.MAs(5),a=e.oxw();e.Q6J("value",c.path),e.xp6(2),e.Q6J("ngIf","image"==c.viewer),e.xp6(1),e.Q6J("ngIf","audio"==c.viewer),e.xp6(1),e.Q6J("ngIf","video"==c.viewer),e.xp6(1),e.Q6J("ngIf","text"==c.viewer),e.xp6(1),e.Q6J("ngIf","godot"==c.viewer),e.xp6(1),e.Q6J("ngIf","disabled"==c.viewer),e.xp6(1),e.Q6J("ngIf",n.value==c.path),e.xp6(1),e.Q6J("ngIf",n.value!=c.path),e.xp6(5),e.Oqu(a.lang.text.UserFsDir.Action),e.xp6(1),e.Q6J("ngIf","disabled"!=c.viewer&&"image"!=c.viewer),e.xp6(1),e.Q6J("ngIf",a.is_file_selector),e.xp6(1),e.Q6J("ngIf",a.cant_dedicated&&!a.is_file_selector),e.xp6(2),e.hij(" ",a.lang.text.UserFsDir.Delete," "),e.xp6(1),e.Q6J("ngIf","image"==c.viewer),e.xp6(3),e.Oqu(a.lang.text.UserFsDir.CreateAt),e.xp6(2),e.Oqu(c.timestamp)}}function ve(_,b){if(1&_&&(e.TgZ(0,"div"),e.YNc(1,xe,26,17,"ion-accordion",19),e.qZA()),2&_){const c=b.$implicit,n=e.oxw(2);e.xp6(1),e.Q6J("ngIf",n.CurrentDir==c.dir||n.is_file_selector)}}function Fe(_,b){if(1&_&&(e.TgZ(0,"ion-list"),e.YNc(1,ie,12,2,"div",5),e.YNc(2,ne,6,1,"div",5),e.YNc(3,ae,2,1,"div",8),e.TgZ(4,"ion-accordion-group",null,9),e.YNc(6,ve,2,1,"div",8),e.qZA()()),2&_){const c=e.oxw();e.xp6(1),e.Q6J("ngIf",""!=c.CurrentDir),e.xp6(1),e.Q6J("ngIf",""==c.CurrentDir&&!c.is_file_selector),e.xp6(1),e.Q6J("ngForOf",c.DirList),e.xp6(3),e.Q6J("ngForOf",c.FileList)}}function Ie(_,b){if(1&_){const c=e.EpF();e.TgZ(0,"ion-item",14),e.NdJ("click",function(){e.CHM(c);const a=e.oxw().$implicit,r=e.oxw(2);return e.KtG(r.importFolderMiddleAct(a))}),e._UZ(1,"ion-icon",11),e.TgZ(2,"ion-label"),e._uU(3),e.qZA()()}if(2&_){const c=e.oxw().$implicit;e.xp6(3),e.Oqu(c.name)}}function be(_,b){if(1&_&&(e.TgZ(0,"ion-item",47),e._UZ(1,"ion-icon",40),e.TgZ(2,"ion-label"),e._uU(3),e.qZA()()),2&_){const c=e.oxw().$implicit;e.xp6(3),e.Oqu(c.name)}}function we(_,b){if(1&_&&(e.TgZ(0,"div"),e.YNc(1,Ie,4,1,"ion-item",18),e.YNc(2,be,4,1,"ion-item",46),e.qZA()),2&_){const c=b.$implicit;e.xp6(1),e.Q6J("ngIf",c.isDirectory),e.xp6(1),e.Q6J("ngIf",c.isFile)}}function Te(_,b){if(1&_){const c=e.EpF();e.TgZ(0,"ion-list")(1,"ion-item",14),e.NdJ("click",function(){e.CHM(c);const a=e.oxw();return e.KtG(a.InAppBrowser=!0)}),e._UZ(2,"ion-icon",11),e.TgZ(3,"ion-label",45),e._uU(4,"/sdcard/Android/data/org.pjcone.portal/files"),e.qZA()(),e.YNc(5,we,3,2,"div",8),e.qZA()}if(2&_){const c=e.oxw();e.xp6(5),e.Q6J("ngForOf",c.ExternalFolder)}}let De=(()=>{var _;class b{constructor(n,a,r,x,m,y,l,h,o,t,i,g){this.modalCtrl=n,this.indexed=a,this.loadingCtrl=r,this.lang=x,this.global=m,this.p5toast=y,this.alertCtrl=l,this.sanitizer=h,this.file=o,this.navCtrl=t,this.noti=i,this.navParams=g,this.DirList=[],this.FileList=[],this.cant_dedicated=!1,this.InAppBrowser=!0,this.is_ready=!1,this.is_file_selector=!1,this.HideThumbnail=!1,this.StopIndexing=!1,this.EventListenerAct=v=>{v.detail.register(110,F=>{this.is_ready?""==this.CurrentDir?F():this.MoveToUpDir():(this.initLoadingElement.dismiss(),this.is_ready=!0)})},this.isCreateFolderRecursive=!1,this.ExternalFolder=[]}toggle_thumbnail(){this.HideThumbnail=!this.HideThumbnail,localStorage.setItem("user-fs-thumbnail",this.HideThumbnail?"1":"0")}ngOnInit(){}ionViewDidEnter(){this.global.p5key.KeyShortCut.Escape=()=>{this.is_ready?""==this.CurrentDir?this.navCtrl.pop():this.MoveToUpDir():(this.initLoadingElement.dismiss(),this.is_ready=!0)}}ionViewWillEnter(){this.HideThumbnail="1"==localStorage.getItem("user-fs-thumbnail"),this.CurrentDir="",this.is_file_selector=!!this.navParams.data.modal,this.LoadAllIndexedFiles(),("DesktopPWA"==D.n$||"MobilePWA"==D.n$)&&(this.cant_dedicated=!0),document.addEventListener("ionBackButton",this.EventListenerAct)}dismiss_page(n){var a=this;return(0,s.Z)(function*(){if(a.is_file_selector){let r;n&&(r=yield a.indexed.loadBlobFromUserPath(n.path,""),r.name=n.name,r.file_ext=n.file_ext,r.user_fs=!0),a.modalCtrl.dismiss(r)}})()}LoadAllIndexedFiles(){var n=this;return(0,s.Z)(function*(){if(n.initLoadingElement=yield n.loadingCtrl.create({message:n.lang.text.UserFsDir.LoadingExplorer}),n.initLoadingElement.present(),n.DirList.length=0,n.FileList.length=0,("Android"==D.n$||"iOS"==D.n$)&&n.noti.noti.schedule({id:5,title:n.lang.text.UserFsDir.LoadingExplorer,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"}),n.is_file_selector)if(n.navParams.get("path")){let a=yield n.indexed.GetFileListFromDB(n.navParams.get("path"));yield n.ModulateIndexedFile(a)}else{let a=yield n.indexed.GetFileListFromDB("/files/"),r=yield n.indexed.GetFileListFromDB("/todo/");a.push.apply(a,r),yield n.ModulateIndexedFile(a)}else{if(n.indexed.godotDB){let r=yield n.indexed.GetFileListFromDB("/",void 0,n.indexed.godotDB);yield n.ModulateIndexedFile(r,n.indexed.godotDB)}let a=yield n.indexed.GetFileListFromDB("/");yield n.ModulateIndexedFile(a)}n.FileList.sort((a,r)=>a.path>r.path?1:a.path<r.path?-1:0),n.DirList.sort((a,r)=>a.path>r.path?1:a.path<r.path?-1:0),setTimeout(()=>{n.noti.ClearNoti(5)},100),n.initLoadingElement.dismiss(),n.is_ready=!0})()}ModulateIndexedFile(n,a=this.indexed.ionicDB){var r=this;return(0,s.Z)(function*(){for(let x=0,m=n.length;x<m;x++){if(r.StopIndexing)return;let y=`${r.lang.text.UserFsDir.LoadingExplorer}: ${n.length-x}`;("Android"==D.n$||"iOS"==D.n$)&&r.noti.noti.schedule({id:5,title:y,progressBar:{value:x,maxValue:n.length},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"}),r.initLoadingElement.message=y,yield r.indexed.GetFileInfoFromDB(n[x],l=>{let h={path:n[x],mode:l.mode,timestamp:new Date(l.timestamp).toLocaleString(),db:a};switch(h.name=h.path.substring(h.path.lastIndexOf("/")+1),h.dir=n[x].substring(0,n[x].lastIndexOf("/")),h.mode){case 33206:h.file_ext=h.name.split(".").pop(),r.global.set_viewer_category_from_ext(h),"image"==h.viewer&&r.indexed.loadBlobFromUserPath(h.path,"",o=>{let t=URL.createObjectURL(o);h.thumbnail=r.sanitizer.bypassSecurityTrustUrl(t)},a),r.FileList.push(h);break;case 16893:r.DirList.push(h);break;default:console.log("\uc608\uc0c1\ud558\uc9c0 \ubabb\ud55c \ud30c\uc77c \ubaa8\ub4dc: ",h)}},a)}})()}MoveToUpDir(){this.CurrentDir=this.CurrentDir.substring(0,this.CurrentDir.lastIndexOf("/")),this.FileSel.value=void 0}SelectFolder(n){this.CurrentDir=n.path,this.FileSel.value=void 0}OpenFile(n){if(this.CheckIfAccessable(n.path))if("disabled"===n.viewer)this.p5toast.show({text:this.lang.text.UserFsDir.CannotOpenFile});else{document.removeEventListener("ionBackButton",this.EventListenerAct);let a=[];if(this.is_file_selector&&this.navParams.data.path)for(let r=0,x=this.FileList.length;r<x;r++)a.push({content:this.FileList[r]});this.modalCtrl.create({component:U.B,componentProps:{info:{content:{filename:n.name,file_ext:n.file_ext,type:"",viewer:n.viewer,path:n.path}},targetDB:this.indexed.ionicDB,no_edit:!0,path:n.path,relevance:a},cssClass:"fullscreen"}).then(r=>{delete this.global.p5key.KeyShortCut.Escape,delete this.global.p5key.KeyShortCut.Digit,r.onDidDismiss().then(x=>{document.addEventListener("ionBackButton",this.EventListenerAct),this.ionViewDidEnter()}),r.present()})}}CheckIfAccessable(n){switch(n){case"servers/webrtc_server.json":case"servers/self/profile.json":return this.p5toast.show({text:this.lang.text.UserFsDir.PrivateAccessDenied}),!1}return!0}DownloadFile(n){this.CheckIfAccessable(n.path)&&this.indexed.DownloadFileFromUserPath(n.path,"",n.name)}ExportDirectoryRecursive(){this.alertCtrl.create({header:this.lang.text.UserFsDir.ExportDirTitle,message:this.lang.text.UserFsDir.ExportDirMsg,buttons:[{text:this.lang.text.UserFsDir.ExportConfirm,handler:()=>{this.ExportDirectoryRecursiveAct()}}]}).then(n=>n.present())}ExportDirectoryRecursiveAct(){var n=this;return(0,s.Z)(function*(){let a=yield n.loadingCtrl.create({message:n.lang.text.UserFsDir.ExportDirTitle});a.present();let r=yield n.indexed.GetFileListFromDB(n.CurrentDir);for(let x=0,m=r.length;x<m;x++){let y=yield n.indexed.GetFileInfoFromDB(r[x]),l=yield n.indexed.loadBlobFromUserPath(r[x],""),h=r[x].lastIndexOf("/"),o=r[x].substring(0,h),t=r[x].substring(h+1);n.isCreateFolderRecursive||(n.isCreateFolderRecursive=!0,yield n.CreateFolderRecursive(o));try{if(16893==y.mode)throw yield n.file.createDir(n.file.externalDataDirectory+o,t,!0),a.message=`${n.lang.text.UserFsDir.ExportDirTitle}: ${t}`,"\uc774\uac70 \ud3f4\ub354\uc784";if(!n.CheckIfAccessable(r[x]))throw"\uc5f4\ub78c \ubd88\uac00 \ud30c\uc77c \uc81c\uc678";yield n.file.writeFile(n.file.externalDataDirectory+o+"/",t,l,{replace:!0})}catch(i){console.error(r[x],": \ud30c\uc77c \uc800\uc7a5 \uc2e4\ud328: ",i)}}n.isCreateFolderRecursive=!1,a.dismiss()})()}CreateFolderRecursive(n){var a=this;return(0,s.Z)(function*(){let r=n.lastIndexOf("/")+1,x=n.substring(0,r),m=n.substring(r);x&&(yield a.CreateFolderRecursive(n.substring(0,r-1)));try{yield a.file.createDir(a.file.externalDataDirectory+x,m,!0)}catch{}})()}BrowseExternalFiles(){var n=this;return(0,s.Z)(function*(){n.ExternalFolder.length=0,n.InAppBrowser=!1,n.ExternalFolder=yield n.file.listDir(n.file.externalApplicationStorageDirectory,"files"),n.ExternalFolder.sort(),n.ExternalFolder.sort((a,r)=>a.isDirectory?-1:1)})()}importFolderMiddleAct(n){var a=this;return(0,s.Z)(function*(){let r=yield a.loadingCtrl.create({message:a.lang.text.UserFsDir.Import});r.present(),yield a.importThisFolder(n,r),a.InAppBrowser=!0,r.dismiss(),a.p5toast.show({text:a.lang.text.UserFsDir.NeedResetToApply})})()}importThisFolder(n,a){var r=this;return(0,s.Z)(function*(){let x=n.nativeURL.substring(0,n.nativeURL.length-1),m=x.lastIndexOf("/"),y=yield r.file.listDir(x.substring(0,m)+"/",x.substring(m+1));for(let l=0,h=y.length;l<h;l++)if(y[l].isDirectory)yield r.importThisFolder(y[l],a);else{let o=y[l].nativeURL.split("org.pjcone.portal/files/")[1];try{let i=(yield $.readFile({path:y[l].nativeURL})).data.replace(/"|\\|=/g,"");yield r.indexed.saveBase64ToUserPath(","+i,decodeURIComponent(o)),a.message=`${r.lang.text.UserFsDir.Import}: ${y[l].name}`}catch(t){console.log("\ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",t),r.p5toast.show({text:`${r.lang.text.UserFsDir.ImportFailed}: ${t}`})}}})()}SelectImportFolder(){this.cant_dedicated?document.getElementById("folder_sel_id").click():this.BrowseExternalFiles()}inputImageSelected(n){var a=this;return(0,s.Z)(function*(){let r=yield a.loadingCtrl.create({message:a.lang.text.UserFsDir.LoadingExplorer});r.present();for(let x=0,m=n.target.files.length;x<m;x++)yield a.indexed.saveBlobToUserPath(n.target.files[x],n.target.files[x].webkitRelativePath);a.LoadAllIndexedFiles(),r.dismiss(),a.p5toast.show({text:a.lang.text.UserFsDir.NeedResetToApply})})()}RemoveDirectoryRecursive(){var a,n=this;this.alertCtrl.create({header:this.CurrentDir.substring(this.CurrentDir.lastIndexOf("/")+1),message:this.lang.text.UserFsDir.RemoveThisFolder,buttons:[{text:this.lang.text.UserFsDir.RemoveApply,handler:(a=(0,s.Z)(function*(){let r=yield n.loadingCtrl.create({message:n.lang.text.UserFsDir.DeleteFile});r.present(),("Android"==D.n$||"iOS"==D.n$)&&n.noti.noti.schedule({id:4,title:n.lang.text.UserFsDir.DeleteFile,progressBar:{indeterminate:!0},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"});let x=yield n.indexed.GetFileListFromDB(n.CurrentDir);for(let m=0,y=x.length;m<y;m++)("Android"==D.n$||"iOS"==D.n$)&&n.noti.noti.schedule({id:5,title:`${n.lang.text.UserFsDir.DeleteFile}: ${y-m}`,progressBar:{value:m,maxValue:y},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"}),r.message=`${n.lang.text.UserFsDir.DeleteFile}: ${y-m}`,yield n.indexed.removeFileFromUserPath(x[m]);for(let m=n.DirList.length-1;m>=0;m--)0==n.DirList[m].path.indexOf(n.CurrentDir)&&n.DirList.splice(m,1);for(let m=n.FileList.length-1;m>=0;m--)0==n.FileList[m].path.indexOf(n.CurrentDir)&&n.FileList.splice(m,1);x=yield n.indexed.GetFileListFromDB(n.CurrentDir);for(let m=0,y=x.length;m<y;m++)("Android"==D.n$||"iOS"==D.n$)&&n.noti.noti.schedule({id:5,title:`${n.lang.text.UserFsDir.DeleteFile}: ${y-m}`,progressBar:{value:m,maxValue:y},sound:null,smallIcon:"res://icon_mono",color:"b0b0b0"}),r.message=`${n.lang.text.UserFsDir.DeleteFile}: ${y-m}`,yield n.indexed.removeFileFromUserPath(x[m]);for(let m=n.DirList.length-1;m>=0;m--)0==n.DirList[m].path.indexOf(n.CurrentDir)&&n.DirList.splice(m,1);for(let m=n.FileList.length-1;m>=0;m--)0==n.FileList[m].path.indexOf(n.CurrentDir)&&n.FileList.splice(m,1);n.MoveToUpDir(),r.dismiss(),setTimeout(()=>{n.noti.ClearNoti(4)},100)}),function(){return a.apply(this,arguments)})}]}).then(a=>a.present())}RemoveFile(n,a){this.alertCtrl.create({header:this.lang.text.UserFsDir.DeleteFile,message:this.lang.text.UserFsDir.CannotBeUndo,buttons:[{text:this.lang.text.UserFsDir.DeleteAccept,handler:()=>{this.indexed.removeFileFromUserPath(n.path,()=>{this.FileList.splice(a,1)})}}]}).then(r=>r.present())}ionViewDidLeave(){this.StopIndexing=!0,this.FileList.forEach(n=>{URL.revokeObjectURL(n.thumbnail)}),this.noti.ClearNoti(4),this.noti.ClearNoti(5)}ionViewWillLeave(){document.removeEventListener("ionBackButton",this.EventListenerAct),delete this.global.p5key.KeyShortCut.Escape,delete this.global.p5key.KeyShortCut.Digit}}return(_=b).\u0275fac=function(n){return new(n||_)(e.Y36(p.IN),e.Y36(q.H),e.Y36(p.HT),e.Y36(K.b),e.Y36(E.AN),e.Y36(L.F),e.Y36(p.Br),e.Y36(P.H7),e.Y36(Z.$),e.Y36(p.SH),e.Y36(R.J),e.Y36(p.X1))},_.\u0275cmp=e.Xpm({type:_,selectors:[["app-user-fs-dir"]],viewQuery:function(n,a){if(1&n&&e.Gf(Y,5),2&n){let r;e.iGM(r=e.CRH())&&(a.FileSel=r.first)}},decls:11,vars:5,consts:[[1,"ion-no-border"],["slot","start",3,"click"],["defaultHref",""],["class","top_icon","slot","end","name","eye-outline",3,"click",4,"ngIf"],["class","top_icon","slot","end","name","eye-off-outline",3,"click",4,"ngIf"],[4,"ngIf"],["slot","end","name","eye-outline",1,"top_icon",3,"click"],["slot","end","name","eye-off-outline",1,"top_icon",3,"click"],[4,"ngFor","ngForOf"],["FileSel",""],["button",""],["slot","start","name","folder"],["style","padding-right: 4px;",3,"click",4,"ngIf"],[3,"click"],["button","",3,"click"],[2,"padding-right","4px",3,"click"],["slot","start","name","arrow-down-circle"],["hidden","","type","file","id","folder_sel_id","webkitdirectory","",3,"change"],["button","",3,"click",4,"ngIf"],[3,"value",4,"ngIf"],[3,"value"],["slot","header"],["slot","start","name","image",4,"ngIf"],["slot","start","name","musical-notes",4,"ngIf"],["slot","start","name","play-circle",4,"ngIf"],["slot","start","name","reader",4,"ngIf"],["slot","start","name","extension-puzzle",4,"ngIf"],["slot","start","name","document",4,"ngIf"],["text-wrap","",4,"ngIf"],[1,"ion-accordion-toggle-icon","hide_accordion_icon"],["slot","content"],["class","ion-text-right button_dist",3,"click",4,"ngIf"],[1,"ion-text-end","button_dist",3,"click"],["class","image_front_form",3,"click",4,"ngIf"],[1,"ion-text-end"],["slot","start","name","image"],["slot","start","name","musical-notes"],["slot","start","name","play-circle"],["slot","start","name","reader"],["slot","start","name","extension-puzzle"],["slot","start","name","document"],["text-wrap",""],[1,"ion-text-right","button_dist",3,"click"],[1,"image_front_form",3,"click"],[1,"image_front_view",3,"src","alt"],["color","medium"],["button","","disabled","",4,"ngIf"],["button","","disabled",""]],template:function(n,a){1&n&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),e._uU(3),e.qZA(),e.TgZ(4,"ion-buttons",1),e.NdJ("click",function(){return a.dismiss_page()}),e._UZ(5,"ion-back-button",2),e.qZA(),e.YNc(6,S,1,0,"ion-icon",3),e.YNc(7,ee,1,0,"ion-icon",4),e.qZA()(),e.TgZ(8,"ion-content"),e.YNc(9,Fe,7,4,"ion-list",5),e.YNc(10,Te,6,1,"ion-list",5),e.qZA()),2&n&&(e.xp6(3),e.Oqu(a.lang.text.Settings.InAppExplorer),e.xp6(3),e.Q6J("ngIf",!a.HideThumbnail),e.xp6(1),e.Q6J("ngIf",a.HideThumbnail),e.xp6(2),e.Q6J("ngIf",a.InAppBrowser),e.xp6(1),e.Q6J("ngIf",!a.InAppBrowser))},dependencies:[V.sg,V.O5,p.We,p.eh,p.oU,p.YG,p.Sm,p.W2,p.Gu,p.gu,p.Ie,p.Q$,p.q_,p.wd,p.sr,p.cs],styles:[".item.sc-ion-label-md-h[_ngcontent-%COMP%], .item[_ngcontent-%COMP%]   .sc-ion-label-md-h[_ngcontent-%COMP%]{overflow:unset}.image_front_form[_ngcontent-%COMP%]{text-align:center}.image_front_view[_ngcontent-%COMP%]{max-height:233px}.top_icon[_ngcontent-%COMP%]{width:28px;height:28px;padding-right:28px;cursor:pointer}.button_dist[_ngcontent-%COMP%]{padding-left:2px}"]}),b})()}}]);