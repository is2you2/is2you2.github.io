"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4896],{4896:(Z,p,a)=>{a.d(p,{Y:()=>P});var m=a(655),g=a(6505),c=a(8888),e=a(9863),v=a(9912),k=a(3336),S=a(4606),f=a(3496),M=a(5742),i=a(3996),_=a(4182),h=a(9808);function T(o,l){if(1&o&&(e.TgZ(0,"ion-item-divider")(1,"ion-label"),e._uU(2),e.qZA()()),2&o){const t=e.oxw();e.xp6(2),e.Oqu(t.lang.text.GroupServer.JoinedServerList)}}function O(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"ion-item",13),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw().link_group(s.isOfficial,s.target)}),e._UZ(1,"div",14),e.TgZ(2,"ion-label",15)(3,"h2"),e._uU(4),e.qZA(),e.TgZ(5,"p"),e._uU(6),e.qZA()(),e.TgZ(7,"ion-button",16),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw().view_detail(s)}),e._uU(8),e.qZA(),e.TgZ(9,"ion-button",16),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw().remove_server(s.isOfficial,s.target)}),e._uU(10),e.qZA()()}if(2&o){const t=l.$implicit,n=e.oxw();e.xp6(1),e.Akn("background-color: "+n.statusBar.colors[n.statusBar.groupServer[t.isOfficial][t.target]||"offline"]),e.xp6(3),e.Oqu(t.name),e.xp6(2),e.AsE("",t.target," (",t.address,")"),e.xp6(2),e.hij(" ",n.lang.text.GroupServer.ServerDetail," "),e.xp6(2),e.hij(" ","online"==n.statusBar.groupServer[t.isOfficial][t.target]?n.lang.text.GroupServer.RemoveAccount:n.lang.text.GroupServer.RemoveUnofficial," ")}}let P=(()=>{class o{constructor(t,n,r,s,d,u){this.nakama=t,this.p5toast=n,this.statusBar=r,this.indexed=s,this.lang=d,this.modalCtrl=u,this.dedicated_info={name:void 0,address:void 0,target:void 0,port:void 0,useSSL:void 0,isOfficial:void 0,key:void 0},this.add_custom_tog=!1,this.isOverrideButtonPressed=!1}ngOnInit(){new g(t=>{t.setup=()=>{t.loadStrings(`assets/data/infos/${this.lang.lang}/group-server.txt`,n=>{this.info=n.join("\n"),t.remove()},n=>{console.error("\uadf8\ub8f9\uc11c\ubc84 \uc124\uba85 \ud30c\uc77c \ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",n),t.remove()})}}),this.servers=this.nakama.get_all_server_info(!0)}link_group(t,n){this.isOverrideButtonPressed?this.isOverrideButtonPressed=!1:("offline"==this.statusBar.groupServer[t][n]||"missing"==this.statusBar.groupServer[t][n]?(this.statusBar.groupServer[t][n]="pending",this.nakama.catch_group_server_header("pending"),this.nakama.users.self.online&&this.nakama.init_session(this.nakama.servers[t][n].info)):(this.nakama.on_socket_disconnected.group_unlink_by_user||(this.nakama.on_socket_disconnected.group_unlink_by_user=()=>{this.nakama.set_group_statusBar("offline",t,n)}),this.statusBar.groupServer[t][n]="offline",this.nakama.catch_group_server_header("offline"),this.nakama.servers[t][n].session&&this.nakama.servers[t][n].client.sessionLogout(this.nakama.servers[t][n].session,this.nakama.servers[t][n].session.token,this.nakama.servers[t][n].session.refresh_token).then(r=>{r||console.warn("\ub85c\uadf8\uc544\uc6c3 \uc624\ub958 \uac80\ud1a0 \ud544\uc694"),this.nakama.noti_origin[t]&&this.nakama.noti_origin[t][n]&&delete this.nakama.noti_origin[t][n],this.nakama.rearrange_notifications()}),this.nakama.servers[t][n].socket&&this.nakama.servers[t][n].socket.disconnect(!0),this.nakama.channels_orig[t]&&this.nakama.channels_orig[t][n]&&Object.keys(this.nakama.channels_orig[t][n]).forEach(s=>{"missing"!=this.nakama.channels_orig[t][n][s].status&&delete this.nakama.channels_orig[t][n][s].status})),this.indexed.saveTextFileToUserPath(JSON.stringify(this.statusBar.groupServer),"servers/list.json"))}add_custom_dedicated(){if(!this.add_custom_tog){if(!this.dedicated_info.name)return void this.p5toast.show({text:this.lang.text.GroupServer.NeedSetDIsplayName});this.add_custom_tog=!0,this.dedicated_info.port=this.dedicated_info.port||7350,this.dedicated_info.useSSL=this.dedicated_info.useSSL||!1,this.dedicated_info.key=this.dedicated_info.key||"defaultkey",this.nakama.add_group_server(this.dedicated_info,()=>{this.servers=this.nakama.get_all_server_info(!0),this.dedicated_info.name=void 0,this.dedicated_info.address=void 0,this.dedicated_info.target=void 0,this.dedicated_info.port=void 0,this.dedicated_info.useSSL=void 0,this.dedicated_info.isOfficial=void 0}),setTimeout(()=>{this.add_custom_tog=!1},1e3)}}view_detail(t){this.isOverrideButtonPressed=!0,this.modalCtrl.create({component:c.P,componentProps:{data:t}}).then(n=>n.present())}remove_server(t,n){return(0,m.mG)(this,void 0,void 0,function*(){this.isOverrideButtonPressed=!0;try{yield this.nakama.servers[t][n].client.rpc(this.nakama.servers[t][n].session,"remove_account_fn",{}),this.p5toast.show({text:this.lang.text.GroupServer.DeleteAccountSucc})}catch(r){this.p5toast.show({text:this.lang.text.GroupServer.DeleteAccountFailed})}"online"==this.statusBar.groupServer[t][n]&&(this.nakama.on_socket_disconnected.group_remove_by_user||(this.nakama.on_socket_disconnected.group_remove_by_user=()=>{this.nakama.set_group_statusBar("offline",t,n),delete this.statusBar.groupServer[t][n]}),yield this.nakama.servers[t][n].client.sessionLogout(this.nakama.servers[t][n].session,this.nakama.servers[t][n].session.token,this.nakama.servers[t][n].session.refresh_token),this.nakama.servers[t][n].socket&&this.nakama.servers[t][n].socket.disconnect(!0)),this.nakama.noti_origin[t]&&this.nakama.noti_origin[t][n]&&delete this.nakama.noti_origin[t][n],this.nakama.rearrange_notifications(),this.nakama.channels_orig[t]&&this.nakama.channels_orig[t][n]&&Object.keys(this.nakama.channels_orig[t][n]).forEach(s=>{this.nakama.channels_orig[t][n][s].status="missing"}),this.nakama.users[t][n]&&this.indexed.GetFileListFromDB(`servers/${t}/${n}/users/`,r=>{for(let s=0,d=r.length;s<d;s++)r[s].indexOf("profile.img")>=0&&this.indexed.removeFileFromUserPath(r[s])}),this.nakama.rearrange_channels(),this.nakama.groups[t][n]&&Object.keys(this.nakama.groups[t][n]).forEach(s=>{this.nakama.groups[t][n][s].status="missing"}),delete this.nakama.servers[t][n],this.servers=this.nakama.get_all_server_info(!0),delete this.statusBar.groupServer[t][n],this.nakama.save_groups_with_less_info(),this.indexed.saveTextFileToUserPath(JSON.stringify(this.statusBar.groupServer),"servers/list.json"),this.indexed.loadTextFromUserPath("servers/list_detail.csv",(r,s)=>{if(r&&s){let d=s.split("\n");for(let u=0,x=d.length;u<x;u++)if(d[u].split(",")[3]==n){d.splice(u,1);break}this.indexed.saveTextFileToUserPath(d.join("\n"),"servers/list_detail.csv")}})})}ionViewWillLeave(){this.nakama.on_socket_disconnected.group_unlink_by_user&&delete this.nakama.on_socket_disconnected.group_unlink_by_user,this.nakama.on_socket_disconnected.group_remove_by_user&&delete this.nakama.on_socket_disconnected.group_remove_by_user}go_back(){"GroupServerPageModule"!=this.modalCtrl.injector.source&&this.modalCtrl.dismiss()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(v.a),e.Y36(k.F),e.Y36(S.g),e.Y36(f.H),e.Y36(M.b),e.Y36(i.IN))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-group-server"]],decls:43,vars:28,consts:[["slot","start",3,"click"],["defaultHref",""],["disabled","",1,"infobox",2,"height","180px",3,"ngModel","ngModelChange"],[4,"ngIf"],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"disabled"],[1,"ion-text-right",3,"ngModel","placeholder","ngModelChange"],["placeholder","192.168.0.1",1,"ion-text-right",3,"ngModel","ngModelChange"],["disabled","","placeholder","defaultkey",1,"ion-text-right",3,"ngModel","ngModelChange"],["disabled","","type","number","placeholder","7350",1,"ion-text-right",3,"ngModel","ngModelChange"],["button","",3,"disabled","click"],["slot","end",2,"pointer-events","none",3,"ngModel","ngModelChange"],[1,"ion-text-center"],["button","",3,"click"],[1,"additional_form","status_bar_single"],[1,"form_margin"],[3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e._uU(3),e.qZA(),e.TgZ(4,"ion-buttons",0),e.NdJ("click",function(){return n.go_back()}),e._UZ(5,"ion-back-button",1),e.qZA()()(),e.TgZ(6,"ion-content")(7,"ion-item-divider")(8,"ion-label"),e._uU(9),e.qZA()(),e.TgZ(10,"textarea",2),e.NdJ("ngModelChange",function(s){return n.info=s}),e.qZA(),e.YNc(11,T,3,1,"ion-item-divider",3),e.YNc(12,O,11,7,"ion-item",4),e.TgZ(13,"ion-item-divider")(14,"ion-label"),e._uU(15),e.qZA()(),e.TgZ(16,"ion-item",5)(17,"ion-label"),e._uU(18),e.qZA(),e.TgZ(19,"ion-input",6),e.NdJ("ngModelChange",function(s){return n.dedicated_info.name=s}),e.qZA()(),e.TgZ(20,"ion-item",5)(21,"ion-label"),e._uU(22),e.qZA(),e.TgZ(23,"ion-input",6),e.NdJ("ngModelChange",function(s){return n.dedicated_info.target=s}),e.qZA()(),e.TgZ(24,"ion-item",5)(25,"ion-label"),e._uU(26),e.qZA(),e.TgZ(27,"ion-input",7),e.NdJ("ngModelChange",function(s){return n.dedicated_info.address=s}),e.qZA()(),e.TgZ(28,"ion-item",5)(29,"ion-label"),e._uU(30),e.qZA(),e.TgZ(31,"ion-input",8),e.NdJ("ngModelChange",function(s){return n.dedicated_info.key=s}),e.qZA()(),e.TgZ(32,"ion-item",5)(33,"ion-label"),e._uU(34),e.qZA(),e.TgZ(35,"ion-input",9),e.NdJ("ngModelChange",function(s){return n.dedicated_info.port=s}),e.qZA()(),e.TgZ(36,"ion-item",10),e.NdJ("click",function(){return n.dedicated_info.useSSL=!n.dedicated_info.useSSL}),e.TgZ(37,"ion-label"),e._uU(38),e.qZA(),e.TgZ(39,"ion-toggle",11),e.NdJ("ngModelChange",function(s){return n.dedicated_info.useSSL=s}),e.qZA()(),e.TgZ(40,"ion-item",10),e.NdJ("click",function(){return n.add_custom_dedicated()}),e.TgZ(41,"ion-label",12),e._uU(42),e.qZA()()()),2&t&&(e.xp6(3),e.Oqu(n.lang.text.Settings.groupServer),e.xp6(6),e.Oqu(n.lang.text.GroupServer.AboutServerAndAccount),e.xp6(1),e.Q6J("ngModel",n.info),e.xp6(1),e.Q6J("ngIf",n.nakama.servers.official.default||n.servers.length),e.xp6(1),e.Q6J("ngForOf",n.servers),e.xp6(3),e.Oqu(n.lang.text.GroupServer.RegisterServer),e.xp6(1),e.Q6J("disabled",n.add_custom_tog),e.xp6(2),e.Oqu(n.lang.text.GroupServer.DisplayName),e.xp6(1),e.Q6J("ngModel",n.dedicated_info.name)("placeholder",n.lang.text.GroupServer.DisplayName_placeholder),e.xp6(1),e.Q6J("disabled",n.add_custom_tog),e.xp6(2),e.Oqu(n.lang.text.GroupServer.DivisionName),e.xp6(1),e.Q6J("ngModel",n.dedicated_info.target)("placeholder",n.dedicated_info.name||n.lang.text.GroupServer.DivisionName_placeholder),e.xp6(1),e.Q6J("disabled",n.add_custom_tog),e.xp6(2),e.Oqu(n.lang.text.GroupServer.Address),e.xp6(1),e.Q6J("ngModel",n.dedicated_info.address),e.xp6(1),e.Q6J("disabled",n.add_custom_tog),e.xp6(2),e.Oqu(n.lang.text.GroupServer.Key),e.xp6(1),e.Q6J("ngModel",n.dedicated_info.key),e.xp6(1),e.Q6J("disabled",n.add_custom_tog),e.xp6(2),e.Oqu(n.lang.text.GroupServer.Port),e.xp6(1),e.Q6J("ngModel",n.dedicated_info.port),e.xp6(1),e.Q6J("disabled",n.add_custom_tog),e.xp6(2),e.Oqu(n.lang.text.GroupServer.isSSL),e.xp6(1),e.Q6J("ngModel",n.dedicated_info.useSSL),e.xp6(1),e.Q6J("disabled",n.add_custom_tog),e.xp6(2),e.Oqu(n.lang.text.GroupServer.submit))},directives:[i.Gu,i.sr,i.wd,i.Sm,i.oU,i.cs,i.W2,i.rH,i.Q$,_.Fj,_.JJ,_.On,h.O5,h.sg,i.Ie,i.YG,i.pK,i.j9,i.as,i.ho,i.w],styles:[""]}),o})()}}]);